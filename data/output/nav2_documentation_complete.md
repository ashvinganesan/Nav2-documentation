# Nav2 Complete Documentation

*Generated on: 2026-02-06 16:50:11*
*Source: https://docs.nav2.org*

This document contains the complete Nav2 navigation stack documentation,
consolidated from the official Nav2 documentation website.

---

## Table of Contents

- [Citations](#citations)
- [Nav2](#nav2)
- [About](#about)
  - [About and Contact](#about-and-contact)
  - [Related Projects](#related-projects)
  - [Robots Using](#robots-using)
  - [ROSCon Talks](#roscon-talks)
- [Behavior Trees](#behavior-trees)
  - [Nav2 Behavior Trees](#nav2-behavior-trees)
  - [Overview](#overview)
    - [Detailed Behavior Tree Walkthrough](#detailed-behavior-tree-walkthrough)
    - [Introduction To Nav2 Specific Nodes](#introduction-to-nav2-specific-nodes)
  - [Trees](#trees)
    - [Follow Dynamic Point](#follow-dynamic-point)
    - [Navigate on Route Graph with Recovery](#navigate-on-route-graph-with-recovery)
    - [Navigate Through Poses](#navigate-through-poses)
    - [Navigate To Pose](#navigate-to-pose)
    - [Navigate To Pose and Pause Near Goal-Obstacle](#navigate-to-pose-and-pause-near-goal-obstacle)
    - [Navigate To Pose With Consistent Replanning And If Path Becomes Invalid](#navigate-to-pose-with-consistent-replanning-and-if-path-becomes-invalid)
    - [Odometry Calibration](#odometry-calibration)
- [Commander Api](#commander-api)
  - [Simple Commander API](#simple-commander-api)
- [Concepts](#concepts)
  - [Navigation Concepts](#navigation-concepts)
- [Configuration](#configuration)
  - [Configuration Guide](#configuration-guide)
  - [Packages](#packages)
    - [AMCL](#amcl)
    - [Behavior Server](#behavior-server)
    - [Behavior Tree XML Nodes](#behavior-tree-xml-nodes)
    - [Behavior-Tree Navigator](#behavior-tree-navigator)
    - [Collision Monitor](#collision-monitor)
    - [Constrained smoother](#constrained-smoother)
    - [Controller Server](#controller-server)
    - [Costmap 2D](#costmap-2d)
    - [Coverage Server](#coverage-server)
    - [Docking Server](#docking-server)
    - [DWB Controller](#dwb-controller)
    - [Following Server](#following-server)
    - [Graceful Controller](#graceful-controller)
    - [Lifecycle Manager](#lifecycle-manager)
    - [Loopback Simulator](#loopback-simulator)
    - [Map Server](#map-server)
    - [Model Predictive Path Integral Controller](#model-predictive-path-integral-controller)
    - [NavFn Planner](#navfn-planner)
    - [Planner Server](#planner-server)
    - [Regulated Pure Pursuit](#regulated-pure-pursuit)
    - [Rotation Shim Controller](#rotation-shim-controller)
    - [Route Server](#route-server)
    - [Savitzky-Golay Smoother](#savitzky-golay-smoother)
    - [Simple Smoother](#simple-smoother)
    - [Smac Planner](#smac-planner)
    - [Smoother Server](#smoother-server)
    - [Theta Star Planner](#theta-star-planner)
    - [Velocity Smoother](#velocity-smoother)
    - [Waypoint Follower](#waypoint-follower)
    - [Bt Plugins](#bt-plugins)
      - [Actions](#actions)
        - [AppendGoalPoseToGoals](#appendgoalposetogoals)
        - [AssistedTeleop](#assistedteleop)
        - [BackUp](#backup)
        - [CancelAssistedTeleop](#cancelassistedteleop)
        - [CancelBackUp](#cancelbackup)
        - [CancelComputeAndTrackRoute](#cancelcomputeandtrackroute)
        - [CancelControl](#cancelcontrol)
        - [CancelCoverage](#cancelcoverage)
        - [CancelDriveOnHeading](#canceldriveonheading)
        - [CancelFollowObject](#cancelfollowobject)
        - [CancelSpin](#cancelspin)
        - [CancelWait](#cancelwait)
        - [ClearCostmapAroundPose](#clearcostmaparoundpose)
        - [ClearCostmapAroundRobot](#clearcostmaparoundrobot)
        - [ClearCostmapExceptRegion](#clearcostmapexceptregion)
        - [ClearEntireCostmap](#clearentirecostmap)
        - [ComputeAndTrackRoute](#computeandtrackroute)
        - [ComputeCoveragePath](#computecoveragepath)
        - [ComputePathThroughPoses](#computepaththroughposes)
        - [ComputePathToPose](#computepathtopose)
        - [ComputeRoute](#computeroute)
        - [ConcatenatePaths](#concatenatepaths)
        - [ControllerSelector](#controllerselector)
        - [DockRobot](#dockrobot)
        - [DriveOnHeading](#driveonheading)
        - [ExtractRouteNodesAsGoals](#extractroutenodesasgoals)
        - [FollowObject](#followobject)
        - [FollowPath](#followpath)
        - [GetCurrentPose](#getcurrentpose)
        - [GetNextFewGoals](#getnextfewgoals)
        - [GetPoseFromPath](#getposefrompath)
        - [GoalCheckerSelector](#goalcheckerselector)
        - [NavigateThroughPoses](#navigatethroughposes)
        - [NavigateToPose](#navigatetopose)
        - [PathHandlerSelector](#pathhandlerselector)
        - [PlannerSelector](#plannerselector)
        - [ProgressCheckerSelector](#progresscheckerselector)
        - [ReinitializeGlobalLocalization](#reinitializegloballocalization)
        - [RemoveInCollisionGoals](#removeincollisiongoals)
        - [RemovePassedGoals](#removepassedgoals)
        - [SmootherSelector](#smootherselector)
        - [SmoothPath](#smoothpath)
        - [Spin](#spin)
        - [ToggleCollisionMonitor](#togglecollisionmonitor)
        - [TruncatePath](#truncatepath)
        - [TruncatePathLocal](#truncatepathlocal)
        - [UndockRobot](#undockrobot)
        - [Wait](#wait)
      - [Conditions](#conditions)
        - [AreErrorCodesPresent](#areerrorcodespresent)
        - [ArePosesNear](#areposesnear)
        - [DistanceTraveled](#distancetraveled)
        - [GlobalUpdatedGoal](#globalupdatedgoal)
        - [GoalReached](#goalreached)
        - [GoalUpdated](#goalupdated)
        - [InitialPoseReceived](#initialposereceived)
        - [IsBatteryCharging](#isbatterycharging)
        - [IsBatteryLow](#isbatterylow)
        - [IsGoalNearby](#isgoalnearby)
        - [IsPathValid](#ispathvalid)
        - [IsPoseOccupied](#isposeoccupied)
        - [IsStopped](#isstopped)
        - [IsStuck](#isstuck)
        - [PathExpiringTimer](#pathexpiringtimer)
        - [TimeExpired](#timeexpired)
        - [TransformAvailable](#transformavailable)
        - [WouldAControllerRecoveryHelp](#wouldacontrollerrecoveryhelp)
        - [WouldAPlannerRecoveryHelp](#wouldaplannerrecoveryhelp)
        - [WouldARouteRecoveryHelp](#wouldarouterecoveryhelp)
        - [WouldASmootherRecoveryHelp](#wouldasmootherrecoveryhelp)
      - [Controls](#controls)
        - [NonblockingSequence](#nonblockingsequence)
        - [PauseResumeController](#pauseresumecontroller)
        - [PersistentSequence](#persistentsequence)
        - [PipelineSequence](#pipelinesequence)
        - [RecoveryNode](#recoverynode)
        - [RoundRobin](#roundrobin)
      - [Decorators](#decorators)
        - [DistanceController](#distancecontroller)
        - [GoalUpdatedController](#goalupdatedcontroller)
        - [GoalUpdater](#goalupdater)
        - [PathLongerOnApproach](#pathlongeronapproach)
        - [RateController](#ratecontroller)
        - [SingleTrigger](#singletrigger)
        - [SpeedController](#speedcontroller)
    - [Collision Monitor](#collision-monitor)
      - [Collision Detector Node](#collision-detector-node)
      - [Collision Monitor Node](#collision-monitor-node)
    - [Costmap Plugins](#costmap-plugins)
      - [Binary Filter Parameters](#binary-filter-parameters)
      - [Denoise Layer Parameters](#denoise-layer-parameters)
      - [Inflation Layer Parameters](#inflation-layer-parameters)
      - [Keepout Filter Parameters](#keepout-filter-parameters)
      - [Obstacle Layer Parameters](#obstacle-layer-parameters)
      - [Plugin Container Layer Parameters](#plugin-container-layer-parameters)
      - [Range Sensor Parameters](#range-sensor-parameters)
      - [Speed Filter Parameters](#speed-filter-parameters)
      - [Static Layer Parameters](#static-layer-parameters)
      - [Voxel Layer Parameters](#voxel-layer-parameters)
    - [Dwb Params](#dwb-params)
      - [DWB Controller](#dwb-controller)
      - [Kinematic Parameters](#kinematic-parameters)
      - [Publisher](#publisher)
      - [XYTheta Iterator](#xytheta-iterator)
    - [Dwb Plugins](#dwb-plugins)
      - [LimitedAccelGenerator](#limitedaccelgenerator)
      - [StandardTrajectoryGenerator](#standardtrajectorygenerator)
    - [Map Server](#map-server)
      - [Costmap Filter Info Server](#costmap-filter-info-server)
      - [Map Saver](#map-saver)
      - [Map Server](#map-server)
      - [Vector Object Server](#vector-object-server)
    - [Nav2 Controller Plugins](#nav2-controller-plugins)
      - [AxisGoalChecker](#axisgoalchecker)
      - [FeasiblePathHandler](#feasiblepathhandler)
      - [PoseProgressChecker](#poseprogresschecker)
      - [PositionGoalChecker](#positiongoalchecker)
      - [SimpleGoalChecker](#simplegoalchecker)
      - [SimpleProgressChecker](#simpleprogresschecker)
      - [StoppedGoalChecker](#stoppedgoalchecker)
    - [Nav2 Waypoint Follower Plugins](#nav2-waypoint-follower-plugins)
      - [InputAtWaypoint](#inputatwaypoint)
      - [PhotoAtWaypoint](#photoatwaypoint)
      - [WaitAtWaypoint](#waitatwaypoint)
    - [Smac](#smac)
      - [Smac 2D Planner](#smac-2d-planner)
      - [Smac Hybrid-A* Planner](#smac-hybrid-a-planner)
      - [Smac State Lattice Planner](#smac-state-lattice-planner)
    - [Trajectory Critics](#trajectory-critics)
      - [BaseObstacleCritic](#baseobstaclecritic)
      - [GoalAlignCritic](#goalaligncritic)
      - [GoalDistCritic](#goaldistcritic)
      - [ObstacleFootprintCritic](#obstaclefootprintcritic)
      - [OscillationCritic](#oscillationcritic)
      - [PathAlignCritic](#pathaligncritic)
      - [PathDistCritic](#pathdistcritic)
      - [PreferForwardCritic](#preferforwardcritic)
      - [RotateToGoalCritic](#rotatetogoalcritic)
      - [TwirlingCritic](#twirlingcritic)
- [Development Guides](#development-guides)
  - [Development Guides](#development-guides)
  - [Build Docs](#build-docs)
    - [Build and Install](#build-and-install)
    - [Build Troubleshooting Guide](#build-troubleshooting-guide)
  - [Devcontainer Docs](#devcontainer-docs)
    - [Dev Container Guide](#dev-container-guide)
    - [Dev Containers](#dev-containers)
  - [Involvement Docs](#involvement-docs)
    - [Getting Involved](#getting-involved)
- [Getting Started](#getting-started)
  - [Getting Started](#getting-started)
- [Maintainer Docs](#maintainer-docs)
  - [Maintainer Docs](#maintainer-docs)
  - [ROS Distribution Release Process](#ros-distribution-release-process)
  - [ROS Distribution Sync Process](#ros-distribution-sync-process)
- [Migration](#migration)
  - [Dashing to Eloquent](#dashing-to-eloquent)
  - [Eloquent to Foxy](#eloquent-to-foxy)
  - [Foxy to Galactic](#foxy-to-galactic)
  - [Galactic to Humble](#galactic-to-humble)
  - [Humble to Iron](#humble-to-iron)
  - [Iron to Jazzy](#iron-to-jazzy)
  - [Jazzy to Kilted](#jazzy-to-kilted)
  - [Kilted to L-turtle](#kilted-to-l-turtle)
  - [Migration Guides](#migration-guides)
- [Plugin Tutorials](#plugin-tutorials)
  - [Plugin Tutorials](#plugin-tutorials)
  - [Docs](#docs)
    - [Writing a New Behavior Plugin](#writing-a-new-behavior-plugin)
    - [Writing a New Behavior Tree Plugin](#writing-a-new-behavior-tree-plugin)
    - [Writing a New Controller Plugin](#writing-a-new-controller-plugin)
    - [Writing a New Costmap2D Plugin](#writing-a-new-costmap2d-plugin)
    - [Writing a New Navigator Plugin](#writing-a-new-navigator-plugin)
    - [Writing a New Planner Plugin](#writing-a-new-planner-plugin)
- [Plugins](#plugins)
  - [Navigation Plugins](#navigation-plugins)
- [Roadmap](#roadmap)
  - [Roadmaps](#roadmaps)
- [Setup Guides](#setup-guides)
  - [First-Time Robot Setup Guide](#first-time-robot-setup-guide)
  - [Algorithm](#algorithm)
    - [Setting Up Navigation Plugins](#setting-up-navigation-plugins)
  - [Footprint](#footprint)
    - [Setting Up the Robot’s Footprint](#setting-up-the-robots-footprint)
  - [Odom](#odom)
    - [Setting Up Odometry - Gazebo](#setting-up-odometry-gazebo)
    - [Setting Up Odometry - Gazebo Classic](#setting-up-odometry-gazebo-classic)
    - [Smoothing Odometry using Robot Localization](#smoothing-odometry-using-robot-localization)
  - [Sdf](#sdf)
    - [Setting Up The SDF - Gazebo](#setting-up-the-sdf-gazebo)
  - [Sensors](#sensors)
    - [Mapping and Localization](#mapping-and-localization)
    - [Setting Up Sensors - Gazebo](#setting-up-sensors-gazebo)
    - [Setting Up Sensors - Gazebo Classic](#setting-up-sensors-gazebo-classic)
  - [Transformation](#transformation)
    - [Setting Up Transformations](#setting-up-transformations)
  - [Urdf](#urdf)
    - [Setting Up The URDF](#setting-up-the-urdf)
- [Tuning](#tuning)
  - [Tuning Guide](#tuning-guide)
- [Tutorials](#tutorials)
  - [General Tutorials](#general-tutorials)
  - [Docs](#docs)
    - [Adding a New Nav2 Task Server](#adding-a-new-nav2-task-server)
    - [Adding a Smoother to a BT](#adding-a-smoother-to-a-bt)
    - [Camera Calibration](#camera-calibration)
    - [Docker for Development: Zero to Hero](#docker-for-development-zero-to-hero)
    - [Dynamic Object Following](#dynamic-object-following)
    - [Enhanced Safety for Nav2 using 3Laws Supervisor](#enhanced-safety-for-nav2-using-3laws-supervisor)
    - [Filtering of Noise-Induced Obstacles](#filtering-of-noise-induced-obstacles)
    - [Get Backtrace in ROS 2 / Nav2](#get-backtrace-in-ros-2-nav2)
    - [Groot - Interacting with Behavior Trees](#groot-interacting-with-behavior-trees)
    - [Groot Tutorials](#groot-tutorials)
    - [Groot2 - Interacting with Behavior Trees](#groot2-interacting-with-behavior-trees)
    - [Lidar-Free, Vision-Based Navigation](#lidar-free-vision-based-navigation)
    - [Navigating using GPS Localization](#navigating-using-gps-localization)
    - [Navigating while Mapping (SLAM)](#navigating-while-mapping-slam)
    - [Navigating with a Physical Turtlebot 3](#navigating-with-a-physical-turtlebot-3)
    - [Navigating with Keepout Zones](#navigating-with-keepout-zones)
    - [Navigating with Speed Limits](#navigating-with-speed-limits)
    - [Navigating with Vector Objects](#navigating-with-vector-objects)
    - [Profiling in ROS 2 / Nav2](#profiling-in-ros-2-nav2)
    - [ROSCon UK 2025: State Estimation for Mobile Robotics Workshop](#roscon-uk-2025-state-estimation-for-mobile-robotics-workshop)
    - [Route Server Tools](#route-server-tools)
    - [Using an External Costmap Plugin (STVL)](#using-an-external-costmap-plugin-stvl)
    - [Using Collision Monitor](#using-collision-monitor)
    - [Using Docking Server](#using-docking-server)
    - [Using Rotation Shim Controller](#using-rotation-shim-controller)
    - [Using VIO to Augment Robot Odometry](#using-vio-to-augment-robot-odometry)
    - [Isaac Perceptor](#isaac-perceptor)
      - [Rebuilding TensorRT Engine for Isaac Perceptor on Nova Carter](#rebuilding-tensorrt-engine-for-isaac-perceptor-on-nova-carter)
    - [Route Server Tools](#route-server-tools)
      - [Route Graph Generation](#route-graph-generation)
      - [Route Graph Generation LIF Editor](#route-graph-generation-lif-editor)
      - [SWAGGER Route Graph Generation](#swagger-route-graph-generation)
      - [Using the Nav2 Route Tool](#using-the-nav2-route-tool)

---

## Citations

*Source: [https://docs.nav2.org/citations.html](https://docs.nav2.org/citations.html)*

### Citations

If you use the navigation framework, an algorithm from this repository, or ideas from it
please cite this work in your papers!

S. Macenski, F. Martín, R. White, J. Clavero.
[\*\*The Marathon 2: A Navigation System\*\*](https://arxiv.org/abs/2003.00368/).
**IEEE/RSJ International Conference on Intelligent Robots and Systems (IROS), 2020.**

IROS 2020 talk on Nav2 Marathon Experiments:


```
@InProceedings{macenski2020marathon2,
author = {Macenski, Steven and Martin, Francisco and White, Ruffin and Ginés Clavero, Jonatan},
title = {The Marathon 2: A Navigation System},
booktitle = {2020 IEEE/RSJ International Conference on Intelligent Robots and Systems (IROS)},
year = {2020}
}
```

If you use any of the algorithms in Nav2 or the analysis of the algorithms in your work, please cite this work in your papers!

S. Macenski, T. Moore, DV Lu, A. Merzlyakov, M. Ferguson,
[\*\*From the desks of ROS maintainers: A survey of modern & capable mobile robotics algorithms in the robot operating system 2\*\*](https://arxiv.org/pdf/2307.15236.pdf),
**Robotics and Autonomous Systems, 2023**

```
@article{macenski2023survey,
      title={From the desks of ROS maintainers: A survey of modern & capable mobile robotics algorithms in the robot operating system 2},
      author={S. Macenski, T. Moore, DV Lu, A. Merzlyakov, M. Ferguson},
      year={2023},
      journal = {Robotics and Autonomous Systems}
}
```

Smac Planner (Hybrid A\*, State Lattice, 2D):

S. Macenski, M. Booker, J. Wallace,
[\*\*Open-Source, Cost-Aware Kinematically Feasible Planning for Mobile and Surface Robotics\*\*](https://arxiv.org/abs/2401.13078),

```
@article{macenski2024smac,
      title={Open-Source, Cost-Aware Kinematically Feasible Planning for Mobile and Surface Robotics},
      author={Steve Macenski and Matthew Booker and Josh Wallace},
      year={2024},
      journal = {Arxiv}
}
```

Regulated Pure Pursuit Controller:

S. Macenski, S. Singh, F. Martin, J. Gines,
[\*\*Regulated Pure Pursuit for Robot Path Tracking\*\*](https://arxiv.org/abs/2305.20026),
**Autonomous Robots, 2023.**

```
@article{macenski2023regulated,
      title={Regulated Pure Pursuit for Robot Path Tracking},
      author={Steve Macenski and Shrijit Singh and Francisco Martin and Jonatan Gines},
      year={2023},
      journal = {Autonomous Robots}
}
```

VSLAM and formal comparisons for service robot needs:

A. Merzlyakov, S. Macenski.
[\*\*A Comparison of Modern General-Purpose Visual SLAM Approaches\*\*](https://arxiv.org/abs/2107.07589).
**IEEE/RSJ International Conference on Intelligent Robots and Systems (IROS), 2021.**

```
@InProceedings{vslamComparison2021,
author = {Merzlyakov, Alexey and Macenski, Steven},
title = {A Comparison of Modern General-Purpose Visual SLAM Approaches},
booktitle = {2021 IEEE/RSJ International Conference on Intelligent Robots and Systems (IROS)},
year = {2021}
}
```

---

## Nav2

*Source: [https://docs.nav2.org/index.html](https://docs.nav2.org/index.html)*

### Nav2


#### Our Sponsors

[![Our Sponsors](_images/sponsors_oct_2025.png)](_images/sponsors_oct_2025.png)

#### Services

If you need professional services related to Nav2, please contact Open Navigation at [info@opennav.org](mailto:info%40opennav.org).

#### Overview

Nav2 is the professionally-supported successor of the ROS Navigation Stack deploying the same kinds of technology powering Autonomous Vehicles brought down, optimized, and reworked for mobile and surface robotics.
This project allows for mobile robots to navigate through complex environments to complete user-defined application tasks with nearly any class of robot kinematics.
Not only can it move from Point A to Point B, but it can have intermediary poses, and represent other types of tasks like object following, complete coverage navigation, and more.
Nav2 is a production-grade and high-quality navigation framework trusted by 100+ companies worldwide.

It provides perception, planning, control, localization, visualization, and much more to build highly reliable autonomous systems.
This will compute an environmental model from sensor and semantic data, dynamically path plan, compute velocities for motors, avoid obstacles, and structure higher-level robot behaviors.
To learn more about this project, such as related projects, robots using, ROS1 comparison, and maintainers, see [About and Contact](about/index.html#about).
To learn more about navigation and ROS concepts, see [Navigation Concepts](concepts/index.html#concepts).

Nav2 uses behavior trees to create customized and intelligent navigation behavior via orchestrating many independent modular servers.
A task server can be used to compute a path, control effort, behavior, or any other navigation
related task. These separate servers communicate with the behavior tree (BT)
over a ROS interface such as an action server or service.
A robot may utilize potentially many different behavior trees to allow a robot to perform many types of unique and complex tasks.

The diagram below will give you a good first-look at the structure of Nav2.
Note that it is possible to have multiple plugins for controllers, planners,
and recoveries in each of their servers. This can be used to create contextual navigation behaviors.
Each of the servers also returns status indicators back to the BT Navigator in order to enact contextual behaviors based on their results.

The expected inputs to Nav2 are TF transformations conforming to REP-105, a
map source if utilizing the Static Costmap Layer, a BT XML file, and any relevant sensor data
sources. It will then provide valid velocity commands for the motors of a holonomic or
non-holonomic robot to follow when properly configured. We currently support all of the major robot types:
holonomic, differential-drive, legged, and ackermann (car-like) base types! We support
them uniquely with both circular and arbitrarily-shaped robots for SE2 collision checking.

It has tools to:

* Load, serve, and store maps
* Localize the robot on a provided map (SLAM provides the initial map)
* Plan a complete path through the environment, even kinematically feasibly for large robots
* Control the robot to follows the path and dynamically adjust to avoid collision
* Smooth plans to be more continuous, smooth, and/or feasible
* Convert sensor data into an environmental model of the world
* Build complicated and highly-customizable robot behaviors using behavior trees
* Conduct pre-defined behaviors in case of failure, human intervention, or other
* Follow sequential waypoints comprising a mission
* Manage the system’s program lifecycle and watchdog for the servers
* Easy dynamically loaded plugins for creating customized algorithms, behaviors and so on
* Monitor raw sensor data for imminent collision or dangerous situation
* Python3 API to interact with Nav2 and its internal task servers in a pythonic manner
* A smoother on output velocities to guarantee dynamic feasibility of commands
* … and more!

[![Navigation2 Block Diagram](_images/nav2_architecture.png)](_images/nav2_architecture.png)

We also provide a set of starting plugins to get you going.
A list of all plugins can be found on [Navigation Plugins](plugins/index.html#plugins) - but they include algorithms for the spanning cross section of common behaviors and robot platform types.

#### Distributions

Nav2 is available across multiple ROS 2 distributions with varying levels of support:

|  |  |
| --- | --- |
| Rolling Ridley  Development <_images/rolling.png> | Kilted Kaiju  Active Support <_images/kilted.png> |
| Jazzy Jalisco  Active Support <_images/Jazzy.png> | Iron Irwini  End of Life <_images/iron.png> |
| Humble Hawksbill  Maintained <_images/humble.png> | Galactic Geochelone  End of Life <_images/galactic.png> |

#### Related Projects

Check out related projects to Nav2:

* [BehaviorTree.CPP](https://www.behaviortree.dev/)
* [Robot Localization](https://github.com/cra-ros-pkg/robot_localization)
* [SLAM Toolbox](https://github.com/SteveMacenski/slam_toolbox)
* [Fuse](https://github.com/locusrobotics/fuse)

---

## About

### About and Contact

*Source: [https://docs.nav2.org/about/index.html](https://docs.nav2.org/about/index.html)*

#### About and Contact

##### About

Navigation is a community effort to lower the barrier of entry of mobile robotics technology for all.
This project is one of the flagship projects along with MoveIt that acts as an applications entry point and frameworks for ROS.
Navigation in ROS 2 builds on the wild success of the original Navigation Stack (Nav Stack) in ROS (1).
This project has been used by researchers, educators, and industry for over 10 years.
There are very few projects that have lasted as long or were as successful as ROS (1) Navigation.
We would like to thank David Lu!! and Mike Ferguson for their tireless over the span of a decade to keep the Nav Stack alive and well.
Without their hard work, this project would not have been able to happen.
For a list of robots using Navigation2, see [Robots Using](robots.html#robots).

Aslas, as time moves on, so must we.
ROS (1) had a great run and those of us that build projects using it will remember it fondly(ish).
With change comes possibilities.
Navigation2 builds on the success but redesigns the framework to be more flexible and the feedback gathered over 10 years.

We strive to create an open community and encourage new ROS users and experts alike to collaborate.
However, that can’t happen without your issues, pull requests, and support.
Navigation, like all open-source projects, is kept going by a dedicated group of developers, maintainers, users, and collaborators.
We would like to thank here our current and past contributors and maintainers.

If you or your organization are interested in sponsoring Navigation or any work around it, please reach out to the current project lead.

Our current leadership team includes:

| Name | Organization | GitHub ID | Current Role |
| --- | --- | --- | --- |
| Steve Macenski | Open Navigation | [SteveMacenski](https://github.com/SteveMacenski) | Project Lead |
| Ruffin White | UC San Diego | [ruffsl](https://github.com/ruffsl) | CI Wizard |
| Joshua Wallace | Locus Robotics | [JoshuaWallace](https://github.com/jwallace42) | Main Contributor |

Our former leadership team includes:

| Name | Organization | GitHub ID | Role |
| --- | --- | --- | --- |
| Matt Hansen | Intel Corporation | [mkhansen](https://github.com/mkhansen-intel) | Former Project Lead |
| Brian Wilcox | Intel Corporation | [bpwilcox](https://github.com/bpwilcox) | Former Maintainer |
| Carl Delsey | Intel Corporation | [crdelsey](https://github.com/crdelsey) | Maintainer |
| Alexey Merzlyakov | Samsung Research | [AlexeyMerzlyakov](https://github.com/AlexeyMerzlyakov) | Maintainer |

##### Contact

If you are interested in contacting someone about Navigation, ROS 2, or related projects, please email the project leader or email [info@opennav.org](mailto:info%40opennav.org).
We intentionally make our emails easy to find.
If your inquiry relates to bugs or open-source feature requests, consider posting a ticket on our GitHub project.
If your inquiry relates to configuration support or private feature development, reach out and we may be able to connect you with
independent consultants or contractors that know this project well.

Check out the Navigation 2 [Slack](https://join.slack.com/t/navigation2/shared_invite/zt-uj428p0x-jKx8U7OzK1IOWp5TnDS2rA) community.

#### Parameters

**`Steve Macenski`**
- Type: `unknown`
- 

**`Ruffin White`**
- Type: `unknown`
- 

**`Joshua Wallace`**
- Type: `unknown`
- 

**`Matt Hansen`**
- Type: `unknown`
- 

**`Brian Wilcox`**
- Type: `unknown`
- 

**`Carl Delsey`**
- Type: `unknown`
- 

**`Alexey Merzlyakov`**
- Type: `unknown`
- 


---

### Related Projects

*Source: [https://docs.nav2.org/about/related_projects.html](https://docs.nav2.org/about/related_projects.html)*

#### Related Projects

This is a community maintained list of related repositories and projects to Navigation2.

| Name | Maintainer | Description |
| --- | --- | --- |
| [Navigation2](https://github.com/ros-navigation/navigation2) | Steve Macenski | Main ROS 2 Navigation Stack |
| [docs.nav2.org](https://github.com/ros-navigation/docs.nav2.org) | Steve Macenski | Official documentation website source code |
| [navigation2\_tutorials](https://github.com/ros-navigation/navigation2_tutorials) | Steve Macenski | Source code and examples used in the documentation tutorials |
| [navigation2\_dynamic](https://github.com/ros-navigation/navigation2_dynamic) | Steve Macenski | Tools, algorithms, and capabilities for working with dynamic obstacles in ROS 2 |
| [robot\_localization](https://github.com/cra-ros-pkg/robot_localization) | Tom Moore | State estimation software for ROS 2 used for odometry fusion and GPS transformations |
| [slam\_toolbox](https://github.com/SteveMacenski/slam_toolbox) | Steve Macenski | Default 2D SLAM library |

#### Parameters

**`Navigation2`**
- Type: `unknown`
- Main ROS 2 Navigation Stack

**`docs.nav2.org`**
- Type: `unknown`
- Official documentation website
source code

**`navigation2_tutorials`**
- Type: `unknown`
- Source code and examples used
in the documentation tutorials

**`navigation2_dynamic`**
- Type: `unknown`
- Tools, algorithms, and
capabilities for working with
dynamic obstacles in ROS 2

**`robot_localization`**
- Type: `unknown`
- State estimation software for
ROS 2 used for odometry fusion
and GPS transformations

**`slam_toolbox`**
- Type: `unknown`
- Default 2D SLAM library


---

### Robots Using

*Source: [https://docs.nav2.org/about/robots.html](https://docs.nav2.org/about/robots.html)*

#### Robots Using

It’s always helpful (and fun!) to have a list of robots using or ship with our work.
Below is a very early list of robots we have encountered using our software as examples.

Click on the images below for a link to the drivers or navigation configurations.

|  |  |  |
| --- | --- | --- |
| [Dexory](https://www.dexory.com/) | [Polymath Robotics](https://www.polymathrobotics.com/) | [Nvidia Segway Nova Carter](https://robotics.segway.com/nova-carter/) |
|
| [Angsa](https://angsa-robotics.com/en-de/roboter/) | [Firefly Automatix](https://fireflyautomatix.com/m220/) | [Kiwibot](https://www.kiwibot.com/) |
|
| [Rosie](https://tailos.com/) | [Karelics](https://karelics.fi/) | [Seasony](https://www.seasony.io/) |
|
| [Unitree G1 Humanoid](https://www.unitree.com/) | [Unitree Go2 Quadruped](https://www.unitree.com/) | [Barn Owl](https://barnowlag.com/) |
|
| [Pixel](https://pixel-robotics.eu/) | [Brisa](https://www.brisa.tech/) | [Olympics2020](https://www.tri.global/news/toyota-introduces-tris-t-tr1-a-virtual-mobility-2019-7-22/) |
|
| [Wyca Robotics](https://www.wyca-robotics.fr/) | [ElroyAir](https://elroyair.com/) | [Birds Eye](https://www.birdseyerobotics.com/) |
|
| [UBR-1](https://www.robotandchisel.com/2020/09/01/navigation2) | [Tiago Robot](https://github.com/IntelligentRoboticsLabs/marathon_ros2) | [Turtlebot2](https://github.com/kobuki-base/kobuki_ros) |
|
| [Neobotix MPO-700](https://github.com/neobotix/neo_mpo_700-2) | [Datavision Software](https://rex.software) | [Robotnik Rb1 base](https://github.com/IntelligentRoboticsLabs/marathon_ros2) |
|
| [Yunji Robot](https://en.yunjichina.com.cn/a/53.html) | [Polymath Robotics](https://www.polymathrobotics.com/) | [Karelics](https://karelics.fi/) |
|
| [Torch Technologies](https://torchtechnologies.com/) | [Australian Centre for Robotics](https://robotics.sydney.edu.au/) | [Rover Robotics](https://github.com/RoverRobotics/openrover-ros2) |
|
| [Turtlebot4](https://clearpathrobotics.com/turtlebot-4/) | [Turtlebot3](https://github.com/ROBOTIS-GIT/turtlebot3) | [Husarion ROSbot XL](https://github.com/husarion/rosbot-xl-autonomy) |
|
| [Saxion Robotics](https://www.saxion.nl/) | [Botronics](https://botronics.be/) | [Coming Soon](https://www.youtube.com/watch?v=oHg5SJYRHA0) |
|

##### Research Robots

|  |  |  |
| --- | --- | --- |
| [Waratah from Monash Nova Rocer](https://www.novarover.space/) | [walking](https://www.aztrobotics.com/walking-y2.html) | [Coming Soon](https://www.youtube.com/watch?v=oHg5SJYRHA0) |
|

---

### ROSCon Talks

*Source: [https://docs.nav2.org/about/roscon.html](https://docs.nav2.org/about/roscon.html)*

#### ROSCon Talks

Below is a list of ROSCon talks that have been given by the Nav2 team and the community which describe important features, tuning and configuration advice, and how to work with them in your applications.

##### Nav2 Developer Talks

* [ROSCon 2024: On Use of Nav2 Docking](https://vimeo.com/1024971348)
* [ROSCon FR 2023: Nav2 Whys over What’s: Navigating the Philosophies Behind the Features](https://www.youtube.com/watch?v=2W3zWO-msEo)
* [ROSCon 2023: On Use of Nav2 MPPI Controller](https://vimeo.com/879001391)
* [ROSCon 2023: Bidirectional navigation with Nav2](https://vimeo.com/879000809)
* [ROSCon 2022: On Use of Nav2 Smac Planners](https://vimeo.com/showcase/9954564/video/767157646)
* [ROSCon JP 2021: The Past, Present, and Future of Navigation](https://vimeo.com/638041661/a5306a02ab)
* [ROSCon 2021: Chronicles of Caching and Containerising CI for Nav2](https://vimeo.com/649647161)
* [ROSCon 2020: Navigation2: The Next Generation Navigation System](https://vimeo.com/showcase/7812155/video/480604621)
* [ROSCon 2019: On Use of SLAM Toolbox](https://vimeo.com/378682207)
* [ROSCon 2019: Navigation 2 Overview](https://vimeo.com/378682188)
* [ROSCon 2018: On Use of the Spatio-Temporal Voxel Layer](https://vimeo.com/292699571)

##### Community’s Talks

* [ROSCon ES 2024: Navegación robusta en ROS2](https://vimeo.com/showcase/11453818/video/1029492785)
* [ROSCon 2022: BehaviorTree.CPP 4.0. What is new and roadmap](https://vimeo.com/showcase/9954564/video/767160437)
* [ROSCon 2024: Mobile Robotics Scale-up Leveraging ROS](https://vimeo.com/1024971160)
* [ROSCon 2024: Radar Tracks for Path Planning in the presence of Dynamic Obstacles](https://vimeo.com/1024971565)

---

## Behavior Trees

### Nav2 Behavior Trees

*Source: [https://docs.nav2.org/behavior_trees/index.html](https://docs.nav2.org/behavior_trees/index.html)*

#### Nav2 Behavior Trees

* [Introduction To Nav2 Specific Nodes](overview/nav2_specific_nodes.html)
* [Detailed Behavior Tree Walkthrough](overview/detailed_behavior_tree_walkthrough.html)
* [Navigate To Pose](trees/nav_to_pose_recovery.html)
* [Navigate Through Poses](trees/nav_through_poses_recovery.html)
* [Navigate To Pose and Pause Near Goal-Obstacle](trees/nav_to_pose_and_pause_near_goal_obstacle.html)
* [Navigate To Pose With Consistent Replanning And If Path Becomes Invalid](trees/nav_to_pose_with_consistent_replanning_and_if_path_becomes_invalid.html)
* [Navigate on Route Graph with Recovery](trees/navigate_on_route_graph_w_recovery.html)
* [Follow Dynamic Point](trees/follow_point.html)
* [Odometry Calibration](trees/odometry_calibration.html)

Nav2 is an incredibly reconfigurable project. It allows users to set many different plugin types, across behavior trees, core algorithms, status checkers, and more!
This section highlights some of the example behavior tree xml files provided by default in the project to do interesting tasks.
It should be noted that these can be modified for your specific application, or used as a guide to building your own application-specific behavior tree.
These are some exemplary examples of how you can reconfigure your navigation behavior significantly by using behavior trees.
Other behavior trees are provided by Nav2 in the `nav2_bt_navigator` package, but this section highlights the important ones.

A **very** basic, but functional, navigator can be seen below.

```
<root main_tree_to_execute="MainTree">
  <BehaviorTree ID="MainTree">
    <PipelineSequence name="NavigateWithReplanning">
      <DistanceController distance="1.0">
        <ComputePathToPose goal="{goal}" path="{path}"/>
      </DistanceController>
      <FollowPath path="{path}"/>
    </PipelineSequence>
  </BehaviorTree>
</root>
```

This behavior tree will simply plan a new path to `goal` every 1 meter (set by `DistanceController`) using `ComputePathToPose`.
If a new path is computed on the `path` blackboard variable, `FollowPath` will take this `path` and follow it using the server’s default algorithm.

This tree contains:

* No recovery methods
* No retries on failure
* No selected planner or controller algorithms
* No nodes to contextually change settings for optimal performance
* No integration with automatic door, elevator, or other APIs
* No user provided custom BT nodes
* No subtrees for other behaviors like docking, following, etc.
* No use of other types of planners, like complete coverage (where useful)

All of this, and more, can be set and configured for your customized navigation logic in Nav2.

---

### Overview

#### Detailed Behavior Tree Walkthrough

*Source: [https://docs.nav2.org/behavior_trees/overview/detailed_behavior_tree_walkthrough.html](https://docs.nav2.org/behavior_trees/overview/detailed_behavior_tree_walkthrough.html)*

##### Detailed Behavior Tree Walkthrough

* [Overview](#overview)
* [Prerequisites](#prerequisites)
* [Navigate To Pose With Replanning and Recovery](#navigate-to-pose-with-replanning-and-recovery)
* [Navigation Subtree](#navigation-subtree)
* [Recovery Subtree](#recovery-subtree)

###### Overview

This document serves as a reference guide to the main behavior tree (BT) used in Nav2.

There are many example behavior trees provided in `nav2_bt_navigator/behavior_trees`,
but these sometimes have to be re-configured based on the application of the robot.
The following document will walk through the current main default BT `navigate_to_pose_w_replanning_and_recovery.xml`
in great detail.

###### Prerequisites

* Become familiar with the concept of a behavior tree before continuing with this walkthrough

  > + Read the short explanation in [navigation concepts](../../concepts/index.html)
  > + Read the general tutorial and guide (not Nav2 specific) on the [BehaviorTree CPP V4](https://www.behaviortree.dev/) website. Specifically, the “Basic Concepts” section on the BehaviorTree CPP V4 website explains the basic generic nodes that will be used that this guide will build upon.
* Become familiar with the custom [Nav2 specific BT nodes](nav2_specific_nodes.html)

###### Navigate To Pose With Replanning and Recovery

The following section will describe in detail the concept of the main and default BT currently used in Nav2, `navigate_to_pose_w_replanning_and_recovery.xml`.
This behavior tree replans the global path periodically at 1 Hz and it also has recovery actions.

> ![../../_images/overall_bt.png](../../_images/overall_bt.png)

BTs are primarily defined in XML. The tree shown above is represented in XML as follows.

```
<root BTCPP_format="4" main_tree_to_execute="MainTree">
    <BehaviorTree ID="MainTree">
        <RecoveryNode number_of_retries="6" name="NavigateRecovery">
            <PipelineSequence name="NavigateWithReplanning">
                <ControllerSelector selected_controller="{selected_controller}" default_controller="FollowPath" topic_name="controller_selector"/>
                <PlannerSelector selected_planner="{selected_planner}" default_planner="GridBased" topic_name="planner_selector"/>
                <RateController hz="1.0">
                    <RecoveryNode number_of_retries="1" name="ComputePathToPose">
                        <ComputePathToPose goal="{goal}" path="{path}" planner_id="{selected_planner}" error_code_id="{compute_path_error_code}" error_msg="{compute_path_error_msg}"/>
                        <Sequence>
                            <WouldAPlannerRecoveryHelp error_code="{compute_path_error_code}"/>
                            <ClearEntireCostmap name="ClearGlobalCostmap-Context" service_name="global_costmap/clear_entirely_global_costmap"/>
                        </Sequence>
                    </RecoveryNode>
                </RateController>
                <RecoveryNode number_of_retries="1" name="FollowPath">
                    <FollowPath path="{path}" controller_id="{selected_controller}" error_code_id="{follow_path_error_code}" error_msg="{follow_path_error_msg}"/>
                    <Sequence>
                        <WouldAControllerRecoveryHelp error_code="{follow_path_error_code}"/>
                        <ClearEntireCostmap name="ClearLocalCostmap-Context" service_name="local_costmap/clear_entirely_local_costmap"/>
                    </Sequence>
                </RecoveryNode>
            </PipelineSequence>
            <Sequence>
                <Fallback>
                    <WouldAControllerRecoveryHelp error_code="{follow_path_error_code}"/>
                    <WouldAPlannerRecoveryHelp error_code="{compute_path_error_code}"/>
                </Fallback>
                <ReactiveFallback name="RecoveryFallback">
                    <GoalUpdated/>
                    <RoundRobin name="RecoveryActions">
                        <Sequence name="ClearingActions">
                        <ClearEntireCostmap name="ClearLocalCostmap-Subtree" service_name="local_costmap/clear_entirely_local_costmap"/>
                        <ClearEntireCostmap name="ClearGlobalCostmap-Subtree" service_name="global_costmap/clear_entirely_global_costmap"/>
                        </Sequence>
                        <Spin spin_dist="1.57" error_code_id="{spin_error_code}" error_msg="{spin_error_msg}"/>
                        <Wait wait_duration="5.0" error_code_id="{wait_error_code}" error_msg="{wait_error_msg}"/>
                        <BackUp backup_dist="0.30" backup_speed="0.15" error_code_id="{backup_error_code}" error_msg="{backup_error_msg}"/>
                    </RoundRobin>
                </ReactiveFallback>
            </Sequence>
        </RecoveryNode>
    </BehaviorTree>
</root>
```

This is likely still a bit overwhelming, but this tree can be broken into two smaller subtrees that we can focus on one at a time.
These smaller subtrees are the children of the top-most `RecoveryNode`. From this point forward the `NavigateWithReplanning` subtree will be referred to as the `Navigation` subtree, and the `RecoveryFallback` subtree will be known as the `Recovery` subtree.
This can be represented in the following way:

> ![../../_images/overall_bt_w_breakdown.png](../../_images/overall_bt_w_breakdown.png)

The `Navigation` subtree mainly involves actual navigation behavior:

* calculating a path
* following a path
* contextual recovery behaviors for each of the above primary navigation behaviors

The `Recovery` subtree includes behaviors for system level failures or items that were not easily dealt with internally.

The overall BT will (hopefully) spend most of its time in the `Navigation` subtree. If either of the two main behaviors in the `Navigation` subtree fail
(path calculation or path following), contextual recoveries will be attempted.

If the contextual recoveries were still not enough, the `Navigation` subtree will return `FAILURE`.
The system will move on to the `Recovery` subtree to attempt to clear any system level navigation failures.

This happens until the `number_of_retries` for the parent `RecoveryNode` is exceeded (which by default is 6).

```
<RecoveryNode number_of_retries="6" name="NavigateRecovery">
```

###### Navigation Subtree

Now that we have gone over the control flow between the `Navigation` subtree and the `Recovery` subtree, let’s focus on the Navigation subtree.

> ![../../_images/navigation_subtree.png](../../_images/navigation_subtree.png)

The XML of this subtree is as follows:

```
<PipelineSequence name="NavigateWithReplanning">
    <ControllerSelector selected_controller="{selected_controller}" default_controller="FollowPath" topic_name="controller_selector"/>
    <PlannerSelector selected_planner="{selected_planner}" default_planner="GridBased" topic_name="planner_selector"/>
    <RateController hz="1.0">
        <RecoveryNode number_of_retries="1" name="ComputePathToPose">
            <ComputePathToPose goal="{goal}" path="{path}" planner_id="{selected_planner}" error_code_id="{compute_path_error_code}" error_msg="{compute_path_error_msg}"/>
            <Sequence>
                <WouldAPlannerRecoveryHelp error_code="{compute_path_error_code}"/>
                <ClearEntireCostmap name="ClearGlobalCostmap-Context" service_name="global_costmap/clear_entirely_global_costmap"/>
            </Sequence>
        </RecoveryNode>
    </RateController>
    <RecoveryNode number_of_retries="1" name="FollowPath">
        <FollowPath path="{path}" controller_id="{selected_controller}" error_code_id="{follow_path_error_code}" error_msg="{follow_path_error_msg}"/>
        <Sequence>
            <WouldAControllerRecoveryHelp error_code="{follow_path_error_code}"/>
            <ClearEntireCostmap name="ClearLocalCostmap-Context" service_name="local_costmap/clear_entirely_local_costmap"/>
        </Sequence>
    </RecoveryNode>
</PipelineSequence>
```

This subtree has two primary actions `ComputePathToPose` and `FollowPath`.
If either of these two actions fail, they will attempt to clear the failure contextually.
The crux of the tree can be represented with only one parent and two children nodes like this:

> ![../../_images/navigation_subtree_bare.png](../../_images/navigation_subtree_bare.png)

The parent `PipelineSequence` node allows the `ComputePathToPose` to be ticked, and once that succeeds, `FollowPath` to be ticked.
While the `FollowPath` subtree is being ticked, the `ComputePathToPose` subtree will be ticked as well. This allows for the path to be recomputed as the robot moves around.

Both the `ComputePathToPose` and the `FollowPath` follow the same general structure.

* Do the action
* If the action fails, try to see if we can contextually recover

The below is the `ComputePathToPose` subtree:

> ![../../_images/contextual_recoveries.png](../../_images/contextual_recoveries.png)

The parent `RecoveryNode` controls the flow between the action, and the contextual recovery subtree.
The contextual recoveries for both `ComputePathToPose` and `FollowPath` involve checking if the recovery could help clear the error code and clearing the relevant costmap.

Consider changing the `number_of_retries` parameter in the parent `RecoveryNode` control node if your application can tolerate more attempts at contextual recoveries before moving on to system-level recoveries.

The only differences in the BT subtree of `ComputePathToPose` and `FollowPath` are outlined below:

* The action node in the subtree:
  :   + The `ComputePathToPose` subtree centers around the `ComputePathToPose` action.
```
  + The `FollowPath` subtree centers around the `FollowPath` action.
```
* The `RateController` that decorates the `ComputePathToPose` subtree
  :   The `RateController` decorates the `ComputePathToPose` subtree to keep planning at the specified frequency. The default frequency for this BT is 1 hz.
```
  This is done to prevent the BT from flooding the planning server with too many useless requests at the tree update rate (100Hz). Consider changing this frequency to something higher or lower depending on the application and the computational cost of
  calculating the path. There are other decorators that can be used instead of the `RateController`. Consider using the `SpeedController` or `DistanceController` decorators if appropriate.
```
* The costmap that is being cleared within the contextual recovery:
  :   + The `ComputePathToPose` subtree clears the global costmap. The global costmap is the relevant costmap in the context of the planner
```
  + The `FollowPath` subtree clears the local costmap. The local costmap is the relevant costmap in the context of the controller
```

This subtree also utilizes the `PlannerSelector` and `ControllerSelector` nodes. These nodes ffer flexibility for applications that need to adjust navigation behavior on the fly.

###### Recovery Subtree

The `Recovery` subtree is the second big “half” of the Nav2 default `navigate_to_pose_w_replanning_and_recovery.xml` tree.
In short, this subtree is triggered when the `Navigation` subtree returns `FAILURE` and controls the recoveries at the system level (in the case the contextual recoveries in the `Navigation` subtree were not sufficient).

> ![../../_images/recovery_subtree.png](../../_images/recovery_subtree.png)

And the XML snippet:

```
<Sequence>
    <Fallback>
        <WouldAControllerRecoveryHelp error_code="{follow_path_error_code}"/>
        <WouldAPlannerRecoveryHelp error_code="{compute_path_error_code}"/>
    </Fallback>
    <ReactiveFallback name="RecoveryFallback">
        <GoalUpdated/>
        <RoundRobin name="RecoveryActions">
            <Sequence name="ClearingActions">
            <ClearEntireCostmap name="ClearLocalCostmap-Subtree" service_name="local_costmap/clear_entirely_local_costmap"/>
            <ClearEntireCostmap name="ClearGlobalCostmap-Subtree" service_name="global_costmap/clear_entirely_global_costmap"/>
            </Sequence>
            <Spin spin_dist="1.57" error_code_id="{spin_error_code}" error_msg="{spin_error_msg}"/>
            <Wait wait_duration="5.0" error_code_id="{wait_error_code}" error_msg="{wait_error_msg}"/>
            <BackUp backup_dist="0.30" backup_speed="0.15" error_code_id="{backup_error_code}" error_msg="{backup_error_msg}"/>
        </RoundRobin>
    </ReactiveFallback>
</Sequence>
```

At the top level, a `Sequence` ensures the following steps are executed in order:

* A `Fallback` node first checks whether planner or controller recoveries might help resolve the issue. If either returns `SUCCESS`, the fallback succeeds and the sequence proceeds to the next step.
* A `ReactiveFallback` that controls the flow between the rest of the system wide recoveries, and asynchronously checks if a new goal has been received.

If at any point the goal gets updated, this subtree will halt all children and return `SUCCESS`. This allows for quick reactions to new goals and preempt currently executing recoveries.
This should look familiar to the contextual recovery portions of the `Navigation` subtree. This is a common BT pattern to handle the situation “Unless ‘this condition’ happens, Do action A”.

These condition nodes can be extremely powerful and are typically paired with `ReactiveFallback`. It can be easy to imagine wrapping this whole `navigate_to_pose_w_replanning_and_recovery` tree
in a `ReactiveFallback` with a `isBatteryLow` condition – meaning the `navigate_to_pose_w_replanning_and_recovery` tree will execute *unless* the battery becomes low (and then enter a different subtree for docking to recharge).

If the goal is never updated, the behavior tree will go on to the `RoundRobin` node. These are the default four system-level recoveries in the BT are:

* A sequence that clears both costmaps (local, and global)
* `Spin` action
* `Wait` action
* `BackUp` action

Upon `SUCCESS` of any of the four children of the parent `RoundRobin`, the robot will attempt to renavigate in the `Navigation` subtree.
If this renavigation was not successful, the next child of the `RoundRobin` will be ticked.

For example, let’s say the robot is stuck and the `Navigation` subtree returns `FAILURE`:
(for the sake of this example, let’s assume that the goal is never updated).

1. The Costmap clearing sequence in the `Recovery` subtree is attempted, and returns `SUCCESS`. The robot now moves to `Navigation` subtree again
2. Let’s assume that clearing both costmaps was not sufficient, and the `Navigation` subtree returns `FAILURE` once again. The robot now ticks the `Recovery` subtree
3. In the `Recovery` subtree, the `Spin` action will be ticked. If this returns `SUCCESS`, then the robot will return to the main `Navigation` subtree *BUT* let’s assume that the `Spin` action returns `FAILURE`. In this case, the tree will *remain* in the `Recovery` subtree
4. Let’s say the next action, `Wait` returns `SUCCESS`. The robot will then move on to the `Navigation` subtree
5. Assume the `Navigation` subtree returns `FAILURE` (clearing the costmaps, attempting a spin, and waiting were *still* not sufficient to recover the system). The robot will move onto the `Recovery` subtree and attempt the `BackUp` action. Let’s say that the robot attempts the `BackUp` action and was able to successfully complete the action. The `BackUp` action node returns `SUCCESS` and so now we move on to the Navigation subtree again.
6. In this hypothetical scenario, let’s assume that the `BackUp` action allowed the robot to successfully navigate in the `Navigation` subtree, and the robot reaches the goal. In this case, the overall BT will still return `SUCCESS`.

If the `BackUp` action was not sufficient enough to allow the robot to become un-stuck, the above logic will go on indefinitely until the `number_of_retries` in the parent of the `Navigate` subtree and `Recovery` subtree is exceeded, or if all the system-wide recoveries in the `Recovery` subtree return `FAILURE` (this is unlikely, and likely points to some other system failure).

#### Parameters

**`The action node in the subtree:`**
- Type: `unknown`
- TheComputePathToPosesubtree centers around theComputePathToPoseaction.TheFollowPathsubtree centers around theFollowPathaction.

**`TheRateControllerthat decorates theComputePathToPosesubtree`**
- Type: `unknown`
- TheRateControllerdecorates theComputePathToPosesubtree to keep planning at the specified frequency. The default frequency for this BT is 1 hz.
This is done to prevent the BT from flooding the planning server with too many useless requests at the tree update rate (100Hz). Consider changing this frequency to something higher or lower depending on the application and the computational cost of
calculating the path. There are other decorators that can be used instead of theRateController. Consider using theSpeedControllerorDistanceControllerdecorators if appropriate.

**`The costmap that is being cleared within the contextual recovery:`**
- Type: `unknown`
- TheComputePathToPosesubtree clears the global costmap. The global costmap is the relevant costmap in the context of the plannerTheFollowPathsubtree clears the local costmap. The local costmap is the relevant costmap in the context of the controller


---

#### Introduction To Nav2 Specific Nodes

*Source: [https://docs.nav2.org/behavior_trees/overview/nav2_specific_nodes.html](https://docs.nav2.org/behavior_trees/overview/nav2_specific_nodes.html)*

##### Introduction To Nav2 Specific Nodes

Warning

Vocabulary can be a large point of confusion here when first starting out.
:   * A `Node` when discussing BTs is entirely different than a `Node` in the ROS 2 context
```
* An `ActionNode` in the context of BTs is not necessarily connected to an Action Server in the ROS 2 context (but often it is)
```

There are quite a few custom Nav2 BT nodes that are provided to be used in the Nav2 specific fashion. Some commonly used Nav2 nodes will be described below.
The full list of custom BT nodes can be found in the [nav2\_behavior\_tree plugins folder](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins).
The [configuration guide](../../configuration/packages/configuring-bt-xml.html) can also be quite useful.

###### Action Nodes

* ComputePathToPose - ComputePathToPose Action Server Client (Planner Interface)
* FollowPath - FollowPath Action Server Client (Controller Interface)
* Spin, Wait, Backup - Behaviors Action Server Client
* ClearCostmapService - ClearCostmapService Server Clients

Upon completion, these action nodes will return `SUCCESS` if the action server believes the action has been completed correctly, `RUNNING` when still running, and will return `FAILURE` otherwise. Note that in the above list,
the ClearCostmapService action node is *not* an action server client, but a service client.

###### Condition Nodes

* GoalUpdated - Checks if the goal on the goal topic has been updated
* GoalReached - Checks if the goal has been reached
* InitialPoseReceived - Checks to see if a pose on the `initial_pose` topic has been received
* isBatteryLow - Checks to see if the battery is low by listening on the battery topic

The above list of condition nodes can be used to probe particular aspects of the system. Typically they will return `SUCCESS` if the condition is true and `FAILURE` otherwise.
The key condition that is used in the default Nav2 BT is `GoalUpdated` which is checked asynchronously within particular subtrees. This condition node allows for the behavior described as “If the goal has been updated, then we must replan”.
Condition nodes are typically paired with ReactiveFallback nodes.

###### Decorator Nodes

* Distance Controller - Will tick children nodes every time the robot has traveled a certain distance
* Rate Controller - Controls the ticking of its child node at a constant frequency. The tick rate is an exposed port
* Goal Updater - Will update the goal of children nodes via ports on the BT
* Single Trigger - Will only tick its child node once, and will return `FAILURE` for all subsequent ticks
* Speed Controller - Controls the ticking of its child node at a rate proportional to the robot’s speed

###### Control: PipelineSequence

The `PipelineSequence` control node re-ticks previous children when a child returns `RUNNING`.
This node is similar to the `Sequence` node, with the additional property that the children prior to the “current” are re-ticked, (resembling the flow of water in a pipe).
If at any point a child returns `FAILURE`, all children will be halted and the parent node will also return `FAILURE`. Upon `SUCCESS` of the **last node** in the sequence, this node will halt and return `SUCCESS`.

To explain this further, here is an example BT that uses PipelineSequence.

> ![../../_images/control_pipelineSequence.png](../../_images/control_pipelineSequence.png)

```
<root main_tree_to_execute="MainTree">
    <BehaviorTree ID="MainTree">
        <PipelineSequence>
            <Action_A/>
            <Action_B/>
            <Action_C/>
        </PipelineSequence>
    </BehaviorTree>
</root>
```

1. `Action_A`, `Action_B`, and `Action_C` are all `IDLE`.
2. When the parent PipelineSequence is first ticked, let’s assume `Action_A` returns `RUNNING`. The parent node will now return `RUNNING` and no other nodes are ticked.

> ![../../_images/control_pipelineSequence_RUNNING_IDLE_IDLE.png](../../_images/control_pipelineSequence_RUNNING_IDLE_IDLE.png)

3. Now, let’s assume `Action_A` returns `SUCCESS`, `Action_B` will now get ticked and will return `RUNNING`. `Action_C` has not yet been ticked so will return `IDLE`.

> ![../../_images/control_pipelineSequence_SUCCESS_RUNNING_IDLE.png](../../_images/control_pipelineSequence_SUCCESS_RUNNING_IDLE.png)

4. `Action_A` gets ticked again and returns `RUNNING`, and `Action_B` gets re-ticked and returns `SUCCESS` and therefore the BT goes on to tick `Action_C` for the first time. Let’s assume `Action_C` returns `RUNNING`. The retick-ing of `Action_A` is what makes PipelineSequence useful.

> ![../../_images/control_pipelineSequence_RUNNING_SUCCESS_RUNNING.png](../../_images/control_pipelineSequence_RUNNING_SUCCESS_RUNNING.png)

5. All actions in the sequence will be re-ticked. Let’s assume `Action_A` still returns `RUNNING`, where as `Action_B` returns `SUCCESS` again, and `Action_C` now returns `SUCCESS` on this tick. The sequence is now complete, and therefore `Action_A` is halted, even though it was still `RUNNING`.

> ![../../_images/control_pipelineSequence_RUNNING_SUCCESS_SUCCESS.png](../../_images/control_pipelineSequence_RUNNING_SUCCESS_SUCCESS.png)

Recall that if `Action_A`, `Action_B`, or `Action_C` returned `FAILURE` at any point of time, the parent would have returned `FAILURE` and halted any children as well.

For additional details regarding the `PipelineSequence` please see the [PipelineSequence configuration guide](../../configuration/packages/bt-plugins/controls/PipelineSequence.html).

###### Control: Recovery

The Recovery control node has only two children and returns `SUCCESS` if and only if the first child returns `SUCCESS`.
If the first child returns `FAILURE`, the second child will be ticked. This loop will continue until either:

* The first child returns `SUCCESS` (which results in `SUCCESS` of the parent node)
* The second child returns `FAILURE` (which results in `FAILURE` of the parent node)
* The `number_of_retries` input parameter is violated

This node is usually used to link together an action, and a recovery action as the name suggests. The first action will typically be the “main” behavior,
and the second action will be something to be done in case of `FAILURE` of the main behavior. Often, the ticking of the second child action will promote the chance the first action will succeed.

> ![../../_images/control_recovery_node.png](../../_images/control_recovery_node.png)

```
<root main_tree_to_execute="MainTree">
    <BehaviorTree ID="MainTree">
        <RecoveryNode number_of_retries="1">
            <ComputePathToPose/>
            <ClearLocalCostmap/>
        </RecoveryNode>
    </BehaviorTree>
</root>
```

In the above example, let’s assume `ComputePathToPose` fails. `ClearLocalCostmap` will be ticked in response, and return `SUCCESS`.
Now that we have cleared the costmap, let’s say the robot is correctly able to compute the path and `ComputePathToPose` now returns `SUCCESS`. Then, the parent RecoveryNode will also return `SUCCESS` and the BT will be complete.

For additional details regarding the `RecoveryNode` please see the [RecoveryNode configuration guide](../../configuration/packages/bt-plugins/controls/RecoveryNode.html).

###### Control: RoundRobin

The RoundRobin control node ticks its children in a round robin fashion until a child returns `SUCCESS`, in which the parent node will also return `SUCCESS`.
If all children return `FAILURE` so will the parent RoundRobin.

Here is an example BT we will use to walk through the concept.

> ![../../_images/control_round_robin.png](../../_images/control_round_robin.png)

```
<root main_tree_to_execute="MainTree">
    <BehaviorTree ID="MainTree">
        <RoundRobin>
            <Action_A/>
            <Action_B/>
            <Action_C/>
        </RoundRobin>
    </BehaviorTree>
</root>
```

1. All the nodes start at `IDLE`

> ![../../_images/control_round_robin_IDLE_IDLE_IDLE.png](../../_images/control_round_robin_IDLE_IDLE_IDLE.png)

2. Upon tick of the parent node, the first child (`Action_A`) is ticked. Let’s assume on tick the child returns `RUNNING`.
In this case, no other children are ticked and the parent node returns `RUNNING` as well.

> ![../../_images/control_round_robin_RUNNING_IDLE_IDLE.png](../../_images/control_round_robin_RUNNING_IDLE_IDLE.png)

3. Upon the next tick, let’s assume that `Action_A` returns `FAILURE`.
This means that `Action_B` will get ticked next, and `Action_C` remains unticked.
Let’s assume `Action_B` returns `RUNNING` this time. That means the parent RoundRobin node will also return `RUNNING`.

> ![../../_images/control_round_robin_FAILURE_RUNNING_IDLE.png](../../_images/control_round_robin_FAILURE_RUNNING_IDLE.png)

4. Upon this next tick, let’s assume that `Action_B` returns `SUCCESS`. The parent RoundRobin will now halt all children and return `SUCCESS`.
The parent node retains this state information, and will tick `Action_C` upon the next tick rather than start from `Action_A` like Step 2 did.

> ![../../_images/control_round_robin_FAILURE_SUCCESS_IDLE.png](../../_images/control_round_robin_FAILURE_SUCCESS_IDLE.png)

5. On this tick, let’s assume `Action_C` returns `RUNNING`, and so does the parent RoundRobin. No other nodes are ticked.

> ![../../_images/control_round_robin_FAILURE_SUCCESS_RUNNING.png](../../_images/control_round_robin_FAILURE_SUCCESS_RUNNING.png)

6. On this last tick, let’s assume `Action_C` returns `FAILURE`. The parent will circle and tick `Action_A` again. `Action_A` returns `RUNNING` and so will the parent RoundRobin node. This pattern will continue indefinitely unless all children return `FAILURE`.

> ![../../_images/control_round_robin_RUNNING_IDLE_FAILURE.png](../../_images/control_round_robin_RUNNING_IDLE_FAILURE.png)

For additional details regarding the `RoundRobin` please see the [RoundRobin configuration guide](../../configuration/packages/bt-plugins/controls/RoundRobin.html).

###### Control: NonblockingSequence

The `NonblockingSequence` control node ticks all children as long as they return `SUCCESS` or `RUNNING`. This node is similar to the `PipelineSequence` node, with the additional property that all children are re-ticked as long as `SUCCESS` or `RUNNING`, instead of stopping at the latest `RUNNING` node. If at any point a child returns `FAILURE`, all children will be halted and the parent node will also return `FAILURE`. Upon `SUCCESS` of **all nodes** in the sequence, this node will halt and return `SUCCESS`.

Note that even if a node returns `SUCCESS` in a previous tick, on the next tick, the `NonblockingSequence` will still tick the successful node, possibly restarting it. This is to ensure that successful nodes do not latch a stale state while waiting for another long running node to be complete

To explain this further, here is an example BT that uses NonblockingSequence.

> ![../../_images/control_nonblockingSequence.png](../../_images/control_nonblockingSequence.png)

```
<root main_tree_to_execute="MainTree">
    <BehaviorTree ID="MainTree">
        <NonblockingSequence>
            <Action_A/>
            <Action_B/>
            <Action_C/>
        </NonblockingSequence>
    </BehaviorTree>
</root>
```

1. `Action_A`, `Action_B`, and `Action_C` are all `IDLE`.
2. When the parent NonblockingSequence is first ticked, let’s assume `Action_A` returns `RUNNING`. Following this, `Action_B` will be ticked, and let’s assume it also returns `RUNNING`. Finally, `Action_C` will be ticked, and let’s assume it also returns `RUNNING`. With three `RUNNING` children, the NonblockingSequence will return `RUNNING`

> ![../../_images/control_nonblockingSequence_RUNNING_RUNNING_RUNNING.png](../../_images/control_nonblockingSequence_RUNNING_RUNNING_RUNNING.png)

3. On the next tick of the the parent NonblockingSequence, all actions in the sequence will be re-ticked. Let’s assume `Action_A` returns `SUCCESS`, and `Action_B` and `Action_C` still return `RUNNING`. In this configuration, the NonblockingSequence still returns `RUNNING`, as there are two nodes in the children that are `RUNNING`

> ![../../_images/control_nonblockingSequence_SUCCESS_RUNNING_RUNNING.png](../../_images/control_nonblockingSequence_SUCCESS_RUNNING_RUNNING.png)

4. Now, let’s assume on the next re-tick, `Action_A` and `Action_C` return `SUCCESS`, and `Action_B` returns `RUNNING`. In this configuration, the NonblockingSequence still returns `RUNNING`, as there is still one child node that is `RUNNING`. Note that `ActionA` was re-ticked and again returned `SUCCESS` in this case, it did not skip due to previously returning SUCCESS`.

> ![../../_images/control_nonblockingSequence_SUCCESS_RUNNING_SUCCESS.png](../../_images/control_nonblockingSequence_SUCCESS_RUNNING_SUCCESS.png)

5. Finally, Let’s assume `Action_A`, `Action_B`, and `Action_C` all return `SUCCESS`. The sequence is now complete, and therefore `Action_A`, `Action_B`, and `Action_C` are all halted and NonblockingSequence returns `SUCCESS`.

> ![../../_images/control_nonblockingSequence_SUCCESS_SUCCESS_SUCCESS.png](../../_images/control_nonblockingSequence_SUCCESS_SUCCESS_SUCCESS.png)

Recall that if `Action_A`, `Action_B`, or `Action_C` returned `FAILURE` at any point of time, the parent would have returned `FAILURE` and halted any children as well.

For additional details regarding the `NonblockingSequence` please see the [NonblockingSequence configuration guide](../../configuration/packages/bt-plugins/controls/NonblockingSequence.html).

###### Control: PersistentSequence

The `PersistentSequence` is similar to the `Sequence` node, but it stores the index of the last running child in the blackboard (key: “current\_child\_idx”), and it does not reset the index on halt.

For more information see the `Sequence` BT node in BT.CPP.

```
<root main_tree_to_execute="MainTree">
    <BehaviorTree ID="MainTree">
        <Script code="current_child_idx := 0" />
        <PersistentSequence current_child_idx="{current_child_idx}">
            <Action_A/>
            <Action_B/>
            <Action_C/>
        </PersistentSequence>
    </BehaviorTree>
</root>
```

###### Control: PauseResumeController

The `PauseResumeController` is a control node that adds pause and resume functionality to a behavior tree through service calls.

It has one mandatory child for the RESUMED, and three optional for the PAUSED state, the ON\_PAUSE event and the ON\_RESUME event.
It has two input ports:

* `pause_service_name`: name of the service to pause
* `resume_service_name`: name of the service to resume

1. The controller starts in RESUMED state, and ticks it until it returns success.
2. When the pause service is called, ON\_PAUSE is ticked until completion, then the controller switches to PAUSED state.
3. In PAUSED state the PAUSED child is ticked until the state is changed, or until it returns failure.
4. When the resume service is called, ON\_RESUME is ticked until completion, then the controller switches back to RESUMED state.

The controller only returns success when the RESUMED child returns success. The controller returns failure if any child returns failure. In any other case, it returns running.

```
<PauseResumeController pause_service_name="/pause" resume_service_name="/resume">
    <!-- RESUMED branch -->

    <!-- PAUSED branch (optional) -->

    <!-- ON_PAUSE branch (optional) -->

    <!-- ON_RESUME branch (optional) -->
</PauseResumeController>
```

When the ON\_PAUSE and ON\_RESUME branches fail, the controller will return failure, halt, and the state will be reset to RESUMED. It might be desirable to retry the transition a few times before failing for real, which functionality is not built in the controller node, but is easily achievable by adding a retry node in the BT:

```
<PauseResumeController pause_service_name="/pause" resume_service_name="/resume">
    <!-- RESUMED branch -->

    <!-- PAUSED branch -->

    <RetryUntilSuccessful num_attempts="3">
        <!-- ON_PAUSE branch -->
    </RetryUntilSuccessful>

    <RetryUntilSuccessful num_attempts="3">
        <!-- ON_RESUME branch -->
    </RetryUntilSuccessful>
</PauseResumeController>
```

#### Parameters

**`Vocabulary can be a large point of confusion here when first starting out.`**
- Type: `unknown`
- ANodewhen discussing BTs is entirely different than aNodein the ROS 2 contextAnActionNodein the context of BTs is not necessarily connected to an Action Server in the ROS 2 context (but often it is)


---

### Trees

#### Follow Dynamic Point

*Source: [https://docs.nav2.org/behavior_trees/trees/follow_point.html](https://docs.nav2.org/behavior_trees/trees/follow_point.html)*

##### Follow Dynamic Point

This behavior tree implements a navigation behavior from a starting point, attempting to follow a dynamic point over time.
This “dynamic point” could be a person, another robot, a virtual carrot, anything.
The only requirement is that the pose you’d like to follow is published to the topic outlined in the `GoalUpdater` BT node.

In this tree, we replan at 1 hz just as we did in [Navigate To Pose](nav_to_pose_recovery.html#behavior-tree-nav-to-pose) using the `ComputePathToPose` node.
However, this time when we replan, we update the `goal` based on the newest information in on the updated goal topic.
After we plan a path to this dynamic point, we use the `TruncatePath` node to remove path points from the end of the path near the dynamic point.
This behavior tree node is useful so that the robot always remains at least `distance` away from the obstacle, even if it stops.
It also smooths out any off path behavior involved with trying to path plan towards a probably occupied space in the costmap.

After the new path to the dynamic point is computed and truncated, it is again passed to the controller via the `FollowPath` node.
However, note that it is under a `KeepRunningUntilFailure` decorator node ensuring the controller continues to execute until a failure mode.
This behavior tree will execute infinitely in time until the navigation request is preempted or cancelled.

```
<root main_tree_to_execute="MainTree">
  <BehaviorTree ID="MainTree">
    <PipelineSequence name="NavigateWithReplanning">
      <ControllerSelector selected_controller="{selected_controller}" default_controller="FollowPath" topic_name="controller_selector"/>
      <PlannerSelector selected_planner="{selected_planner}" default_planner="GridBased" topic_name="planner_selector"/>
      <RateController hz="1.0">
        <Sequence>
          <GoalUpdater input_goal="{goal}" output_goal="{updated_goal}">
            <ComputePathToPose goal="{updated_goal}" path="{path}" planner_id="{selected_planner}" error_code_id="{compute_path_error_code}" error_msg="{compute_path_error_msg}"/>
          </GoalUpdater>
        <TruncatePath distance="1.0" input_path="{path}" output_path="{truncated_path}"/>
        </Sequence>
      </RateController>
      <KeepRunningUntilFailure>
        <FollowPath path="{truncated_path}" controller_id="{selected_controller}" error_code_id="{follow_path_error_code}" error_msg="{follow_path_error_msg}"/>
      </KeepRunningUntilFailure>
    </PipelineSequence>
  </BehaviorTree>
</root>
```

---

#### Navigate on Route Graph with Recovery

*Source: [https://docs.nav2.org/behavior_trees/trees/navigate_on_route_graph_w_recovery.html](https://docs.nav2.org/behavior_trees/trees/navigate_on_route_graph_w_recovery.html)*

##### Navigate on Route Graph with Recovery

This behavior tree implements a different style of navigation than the other versions in this section.
Rather than using a freespace planner `ComputePathToPose` to plan a complete path to the goal, this behavior tree instead uses the Route Server to find a route to the goal through a pre-defined navigation graph.
This can be useful for navigating in large-scale environments where real-time planning in freespace for a long distance is not computationally feasible, where a map of the entire space is not possible to plan within, or where deterministic behavior and limited navigation zones/lanes/routes are demanded.

This tree computes a route through the environment using the `ComputeRoute` node which is executed on initialization and when either the goal is updated due to preemption (`GlobalUpdatedGoal`) or the current route path is invalid due to collision (`isPathValid`).
After which, if the robot’s starting pose is too far from the first route node in the graph solution, it will use freespace planning to connect the robot’s current pose to the first node in the route.
This is called the `first mile` and is computed using the `ComputePathToPose` node.
This may be removed if navigation only on the graph is required and you know that the robot will always be located on or near the graph.

The complimentary action occurs for `last mile` where the robot will use freespace planning to connect the last node in the route to the goal pose.
This is done using the `ComputePathToPose` node again and similarly can be removed if required.
The compute path, including the first and last mile paths are then smoothed in the smoother server to make the corners more natural and less sharp.
`FollowPath` is then used to follow this path.

For a detailed description of the role of the selector nodes, recovery behaviors, or fallbacks, see the other behavior tree explanations in this section.

```
<root BTCPP_format="4" main_tree_to_execute="MainTree">
  <BehaviorTree ID="MainTree">
    <RecoveryNode number_of_retries="6" name="NavigateRecovery">
      <PipelineSequence name="NavigateWithReplanning">
        <ControllerSelector selected_controller="{selected_controller}" default_controller="FollowPath" topic_name="controller_selector"/>
        <PlannerSelector selected_planner="{selected_planner}" default_planner="GridBased" topic_name="planner_selector"/>
        <RecoveryNode number_of_retries="1" name="ComputeRoute">
          <RateController hz="0.5" name="ComputeRouteRateController">
              <Fallback>
                <!-- Compute a new route if a new goal is found or the path is no longer valid -->
                <ReactiveSequence>
                  <Inverter>
                    <GlobalUpdatedGoal/>
                  </Inverter>
                  <IsPathValid path="{path}"/> <!-- Base it on the complete connected 'path', not simply the 'route_path' -->
                </ReactiveSequence>
                <Sequence name="ComputeAndSmoothRoute">
                  <!-- Compute the route -->
                  <ComputeRoute goal="{goal}" path="{route_path}" route="{route}" use_poses="true" error_code_id="{compute_route_error_code}" error_msg="{compute_route_error_msg}"/>

                  <!-- Find if the route start node is far from the robot's current pose; if so, connect them for 'first mile'. -->
                  <ReactiveSequence>
                    <GetCurrentPose current_pose="{current_pose}"/>
                    <GetPoseFromPath path="{route_path}" index="0" pose="{route_start_pose}"/>
                    <Inverter>
                      <ArePosesNear ref_pose="{current_pose}" target_pose="{route_start_pose}" tolerance="0.3"/>
                    </Inverter>
                    <ComputePathToPose goal="{route_start_pose}" path="{first_mile_path}" planner_id="{selected_planner}" error_code_id="{compute_path_error_code}" error_msg="{compute_path_error_msg}"/>
                    <ConcatenatePaths input_path1="{first_mile_path}" input_path2="{route_path}" output_path="{route_path}"/>
                  </ReactiveSequence>

                  <!-- Find if the route end node is far from the goal pose; if so, connect them for 'last mile'. -->
                  <ReactiveSequence>
                    <GetPoseFromPath path="{route_path}" index="-1" pose="{route_end_pose}"/>
                    <Inverter>
                      <ArePosesNear ref_pose="{goal}" target_pose="{route_end_pose}" tolerance="0.1"/>
                    </Inverter>
                    <ComputePathToPose start="{route_end_pose}" goal="{goal}" path="{last_mile_path}" planner_id="{selected_planner}" error_code_id="{compute_path_error_code}" error_msg="{compute_path_error_msg}"/>
                    <ConcatenatePaths input_path1="{route_path}" input_path2="{last_mile_path}" output_path="{route_path}"/>
                  </ReactiveSequence>

                  <!-- Smooth the completed route -->
                  <SmoothPath unsmoothed_path="{route_path}" smoothed_path="{path}" smoother_id="route_smoother" error_code_id="{smoother_error_code}" error_msg="{smoother_error_msg}"/>
                </Sequence>
              </Fallback>
            </RateController>
          <Sequence>
            <Fallback>
              <WouldARouteRecoveryHelp error_code="{compute_route_error_code}"/>
              <WouldAPlannerRecoveryHelp error_code="{compute_path_error_code}"/>
            </Fallback>
            <ClearEntireCostmap name="ClearGlobalCostmap-Context" service_name="global_costmap/clear_entirely_global_costmap"/>
          </Sequence>
        </RecoveryNode>
        <RecoveryNode number_of_retries="1" name="FollowPath">
          <FollowPath path="{path}" controller_id="{selected_controller}" error_code_id="{follow_path_error_code}" error_msg="{follow_path_error_msg}"/>
          <Sequence>
            <WouldAControllerRecoveryHelp error_code="{follow_path_error_code}"/>
            <ClearEntireCostmap name="ClearLocalCostmap-Context" service_name="local_costmap/clear_entirely_local_costmap"/>
          </Sequence>
        </RecoveryNode>
      </PipelineSequence>
      <Sequence>
        <Fallback>
          <WouldAControllerRecoveryHelp error_code="{follow_path_error_code}"/>
          <WouldAPlannerRecoveryHelp error_code="{compute_route_error_code}"/>
        </Fallback>
        <ReactiveFallback name="RecoveryFallback">
          <GoalUpdated/>
          <RoundRobin name="RecoveryActions">
            <Sequence name="ClearingActions">
              <ClearEntireCostmap name="ClearLocalCostmap-Subtree" service_name="local_costmap/clear_entirely_local_costmap"/>
              <ClearEntireCostmap name="ClearGlobalCostmap-Subtree" service_name="global_costmap/clear_entirely_global_costmap"/>
            </Sequence>
            <Wait wait_duration="5.0" error_code_id="{wait_error_code}" error_msg="{wait_error_msg}"/>
            <BackUp backup_dist="0.30" backup_speed="0.15" error_code_id="{backup_error_code}" error_msg="{backup_error_msg}"/>
          </RoundRobin>
        </ReactiveFallback>
      </Sequence>
    </RecoveryNode>
  </BehaviorTree>
</root>
```

---

#### Navigate Through Poses

*Source: [https://docs.nav2.org/behavior_trees/trees/nav_through_poses_recovery.html](https://docs.nav2.org/behavior_trees/trees/nav_through_poses_recovery.html)*

##### Navigate Through Poses

This behavior tree implements a navigation behavior from a starting point, through many intermediary hard pose constraints, to a final goal in freespace.
It contains both use of custom behaviors for recovery in specific sub-contexts as well as a global recovery subtree for system-level failures.
It also provides the opportunity for users to retry tasks multiple times before returning a failed state.

The `ComputePathThroughPoses` and `FollowPath` BT nodes both also specify their algorithms to utilize.
By convention we name these by the style of algorithms that they are (e.g. not `DWB` but rather `FollowPath`) such that a behavior tree or application developer need not worry about the technical specifics. They just want to use a path following controller.

In this behavior tree, we attempt to retry the entire navigation task 6 times before returning to the caller that the task has failed.
This allows the navigation system ample opportunity to try to recovery from failure conditions or wait for transient issues to pass, such as crowding from people or a temporary sensor failure.

In nominal execution, this will replan the path at every 3 seconds and pass that path onto the controller, similar to the behavior tree in [Nav2 Behavior Trees](../index.html#behavior-trees).
The planner though is now `ComputePathThroughPoses` taking a vector, `goals`, rather than a single pose `goal` to plan to.
The `RemovePassedGoals` node is used to cull out `goals` that the robot has passed on its path.
In this case, it is set to remove a pose from the poses when the robot is within `0.5` of the goal and it is the next goal in the list.
Additionally, it records the status of each waypoint (e.g. `PENDING`, `COMPLETED`, `SKIPPED` or `FAILED`) in the `waypoint_statuses`.
This is implemented such that replanning can be computed after the robot has passed by some of the intermediary poses and not continue to try to replan through them in the future.
This time, if the planner fails, it will trigger contextually aware recoveries in its subtree, clearing the global costmap.
Additional recoveries can be added here for additional context-specific recoveries, such as trying another algorithm.

Similarly, the controller has similar logic. If it fails, it also attempts a costmap clearing of the local costmap impacting the controller.
It is worth noting the `GoalUpdated` node in the reactive fallback.
This allows us to exit recovery conditions when a new goal has been passed to the navigation system through a preemption.
This ensures that the navigation system will be very responsive immediately when a new goal is issued, even when the last goal was in an attempted recovery.

If these contextual recoveries fail, this behavior tree enters the recovery subtree.
This subtree is reserved for system-level failures to help resolve issues like the robot being stuck or in a bad spot.
This subtree also has the `GoalUpdated` BT node it ticks every iteration to ensure responsiveness of new goals.
Next, the recovery subtree will tick the costmap clearing operations, spinning, waiting, and backing up.
After each of the recoveries in the subtree, the main navigation subtree will be reattempted.
If it continues to fail, the next recovery in the recovery subtree is ticked.

While this behavior tree does not make use of it, the `PlannerSelector`, `ControllerSelector`, `GoalCheckerSelector`, `ProgressCheckerSelector`, and `PathHandlerSelector` behavior tree nodes can also be helpful. Rather than hardcoding the algorithm to use (`GridBased` and `FollowPath`), these behavior tree nodes will allow a user to dynamically change the algorithm used in the navigation system via a ROS topic. It may be instead advisable to create different subtree contexts using condition nodes with specified algorithms in their most useful and unique situations. However, the selector nodes can be a useful way to change algorithms from an external application rather than via internal behavior tree control flow logic. It is better to implement changes through behavior tree methods, but we understand that many professional users have external applications to dynamically change settings of their navigators.

```
<root BTCPP_format="4" main_tree_to_execute="MainTree">
  <BehaviorTree ID="MainTree">
    <RecoveryNode number_of_retries="6" name="NavigateRecovery">
      <PipelineSequence name="NavigateWithReplanning">
        <ProgressCheckerSelector selected_progress_checker="{selected_progress_checker}" default_progress_checker="progress_checker" topic_name="progress_checker_selector"/>
        <GoalCheckerSelector selected_goal_checker="{selected_goal_checker}" default_goal_checker="general_goal_checker" topic_name="goal_checker_selector"/>
        <PathHandlerSelector selected_path_handler="{selected_path_handler}" default_path_handler="PathHandler" topic_name="path_handler_selector" />
        <ControllerSelector selected_controller="{selected_controller}" default_controller="FollowPath" topic_name="controller_selector"/>
        <PlannerSelector selected_planner="{selected_planner}" default_planner="GridBased" topic_name="planner_selector"/>
        <RateController hz="0.333">
          <RecoveryNode number_of_retries="1" name="ComputePathThroughPoses">
            <ReactiveSequence>
              <RemovePassedGoals input_goals="{goals}" output_goals="{goals}" radius="0.7" input_waypoint_statuses="{waypoint_statuses}" output_waypoint_statuses="{waypoint_statuses}"/>
              <ComputePathThroughPoses goals="{goals}" path="{path}" planner_id="{selected_planner}" error_code_id="{compute_path_error_code}" error_msg="{compute_path_error_msg}"/>
            </ReactiveSequence>
            <Sequence>
              <WouldAPlannerRecoveryHelp error_code="{compute_path_error_code}"/>
              <ClearEntireCostmap name="ClearGlobalCostmap-Context" service_name="global_costmap/clear_entirely_global_costmap"/>
            </Sequence>
          </RecoveryNode>
        </RateController>
        <RecoveryNode number_of_retries="1" name="FollowPath">
          <FollowPath path="{path}" controller_id="{selected_controller}" error_code_id="{follow_path_error_code}" error_msg="{follow_path_error_msg}" goal_checker_id="{selected_goal_checker}" progress_checker_id="{selected_progress_checker}" path_handler_id="{selected_path_handler}"/>
          <Sequence>
            <WouldAControllerRecoveryHelp error_code="{follow_path_error_code}"/>
            <ClearEntireCostmap name="ClearLocalCostmap-Context" service_name="local_costmap/clear_entirely_local_costmap"/>
          </Sequence>
        </RecoveryNode>
      </PipelineSequence>
      <Sequence>
        <Fallback>
          <WouldAControllerRecoveryHelp error_code="{follow_path_error_code}"/>
          <WouldAPlannerRecoveryHelp error_code="{compute_path_error_code}"/>
        </Fallback>
        <ReactiveFallback name="RecoveryFallback">
          <GoalUpdated/>
          <RoundRobin name="RecoveryActions">
            <Sequence name="ClearingActions">
              <ClearEntireCostmap name="ClearLocalCostmap-Subtree" service_name="local_costmap/clear_entirely_local_costmap"/>
              <ClearEntireCostmap name="ClearGlobalCostmap-Subtree" service_name="global_costmap/clear_entirely_global_costmap"/>
            </Sequence>
            <Spin name="SpinRecovery" spin_dist="1.57" error_code_id="{spin_error_code}" error_msg="{spin_error_msg}"/>
            <Wait name="WaitRecovery" wait_duration="5.0" error_code_id="{wait_error_code}" error_msg="{wait_error_msg}"/>
            <BackUp name="BackUpRecovery" backup_dist="0.30" backup_speed="0.15" error_code_id="{backup_error_code}" error_msg="{backup_error_msg}"/>
          </RoundRobin>
        </ReactiveFallback>
      </Sequence>
    </RecoveryNode>
  </BehaviorTree>
</root>
```

---

#### Navigate To Pose

*Source: [https://docs.nav2.org/behavior_trees/trees/nav_to_pose_recovery.html](https://docs.nav2.org/behavior_trees/trees/nav_to_pose_recovery.html)*

##### Navigate To Pose

This behavior tree implements a significantly more mature version of the behavior tree on [Nav2 Behavior Trees](../index.html#behavior-trees).
It navigates from a starting point to a single point goal in freespace.
It contains both use of custom recovery behaviors in specific sub-contexts as well as a global recovery subtree for system-level failures.
It also provides the opportunity for users to retry tasks multiple times before returning a failed state.

The `ComputePathToPose` and `FollowPath` BT nodes both also specify their algorithms to utilize.
By convention we name these by the style of algorithms that they are (e.g. not `DWB` but rather `FollowPath`) such that a behavior tree or application developer need not worry about the technical specifics. They just want to use a path following controller.

In this behavior tree, we attempt to retry the entire navigation task 6 times before returning to the caller that the task has failed.
This allows the navigation system ample opportunity to try to recovery from failure conditions or wait for transient issues to pass, such as crowding from people or a temporary sensor failure.

In nominal execution, this will replan the path at every second and pass that path onto the controller, similar to the behavior tree in [Nav2 Behavior Trees](../index.html#behavior-trees).
However, this time, if the planner fails, it will trigger contextually aware recovery behaviors in its subtree, clearing the global costmap.
Additional recovery behaviors can be added here for additional context-specific recoveries, such as trying another algorithm.

Similarly, the controller has similar logic. If it fails, it also attempts a costmap clearing of the local costmap impacting the controller.
It is worth noting the `GoalUpdated` node in the reactive fallback.
This allows us to exit recovery conditions when a new goal has been passed to the navigation system through a preemption.
This ensures that the navigation system will be very responsive immediately when a new goal is issued, even when the last goal was in an attempted recovery.

If these contextual recoveries fail, this behavior tree enters the recovery subtree.
This subtree is reserved for system-level failures to help resolve issues like the robot being stuck or in a bad spot.
This subtree also has the `GoalUpdated` BT node it ticks every iteration to ensure responsiveness of new goals.
Next, the recovery subtree will the recoveries: costmap clearing operations, spinning, waiting, and backing up.
After each of the recoveries in the subtree, the main navigation subtree will be reattempted.
If it continues to fail, the next recovery in the recovery subtree is ticked.

While this behavior tree does not make use of it, the `PlannerSelector`, `ControllerSelector`, `GoalCheckerSelector`, `ProgressCheckerSelector`, and `PathHandlerSelector` behavior tree nodes can also be helpful. Rather than hardcoding the algorithm to use (`GridBased` and `FollowPath`), these behavior tree nodes will allow a user to dynamically change the algorithm used in the navigation system via a ROS topic. It may be instead advisable to create different subtree contexts using condition nodes with specified algorithms in their most useful and unique situations. However, the selector nodes can be a useful way to change algorithms from an external application rather than via internal behavior tree control flow logic. It is better to implement changes through behavior tree methods, but we understand that many professional users have external applications to dynamically change settings of their navigators.

```
<root BTCPP_format="4" main_tree_to_execute="NavigateToPoseWReplanningAndRecovery">
  <BehaviorTree ID="NavigateToPoseWReplanningAndRecovery">
    <RecoveryNode number_of_retries="6" name="NavigateRecovery">
      <PipelineSequence name="NavigateWithReplanning">
        <ProgressCheckerSelector selected_progress_checker="{selected_progress_checker}" default_progress_checker="progress_checker" topic_name="progress_checker_selector"/>
        <GoalCheckerSelector selected_goal_checker="{selected_goal_checker}" default_goal_checker="general_goal_checker" topic_name="goal_checker_selector"/>
        <PathHandlerSelector selected_path_handler="{selected_path_handler}" default_path_handler="PathHandler" topic_name="path_handler_selector"/>
        <ControllerSelector selected_controller="{selected_controller}" default_controller="FollowPath" topic_name="controller_selector"/>
        <PlannerSelector selected_planner="{selected_planner}" default_planner="GridBased" topic_name="planner_selector"/>
        <RateController hz="1.0">
          <RecoveryNode number_of_retries="1" name="ComputePathToPose">
            <ComputePathToPose goal="{goal}" path="{path}" planner_id="{selected_planner}" error_code_id="{compute_path_error_code}" error_msg="{compute_path_error_msg}"/>
            <Sequence>
              <WouldAPlannerRecoveryHelp error_code="{compute_path_error_code}"/>
              <ClearEntireCostmap name="ClearGlobalCostmap-Context" service_name="global_costmap/clear_entirely_global_costmap"/>
            </Sequence>
          </RecoveryNode>
        </RateController>
        <RecoveryNode number_of_retries="1" name="FollowPath">
          <FollowPath path="{path}" controller_id="{selected_controller}" error_code_id="{follow_path_error_code}" error_msg="{follow_path_error_msg}"/>
          <Sequence>
            <WouldAControllerRecoveryHelp error_code="{follow_path_error_code}"/>
            <ClearEntireCostmap name="ClearLocalCostmap-Context" service_name="local_costmap/clear_entirely_local_costmap"/>
          </Sequence>
        </RecoveryNode>
      </PipelineSequence>
      <Sequence>
        <Fallback>
          <WouldAControllerRecoveryHelp error_code="{follow_path_error_code}"/>
          <WouldAPlannerRecoveryHelp error_code="{compute_path_error_code}"/>
        </Fallback>
        <ReactiveFallback name="RecoveryFallback">
          <GoalUpdated/>
          <RoundRobin name="RecoveryActions">
            <Sequence name="ClearingActions">
              <ClearEntireCostmap name="ClearLocalCostmap-Subtree" service_name="local_costmap/clear_entirely_local_costmap"/>
              <ClearEntireCostmap name="ClearGlobalCostmap-Subtree" service_name="global_costmap/clear_entirely_global_costmap"/>
            </Sequence>
            <Spin spin_dist="1.57" error_code_id="{spin_error_code}" error_msg="{spin_error_msg}"/>
            <Wait wait_duration="5.0" error_code_id="{wait_error_code}" error_msg="{wait_error_msg}"/>
            <BackUp backup_dist="0.30" backup_speed="0.15" error_code_id="{backup_error_code}" error_msg="{backup_error_msg}"/>
          </RoundRobin>
        </ReactiveFallback>
      </Sequence>
    </RecoveryNode>
  </BehaviorTree>
</root>
```

---

#### Navigate To Pose and Pause Near Goal-Obstacle

*Source: [https://docs.nav2.org/behavior_trees/trees/nav_to_pose_and_pause_near_goal_obstacle.html](https://docs.nav2.org/behavior_trees/trees/nav_to_pose_and_pause_near_goal_obstacle.html)*

##### Navigate To Pose and Pause Near Goal-Obstacle

Note

As a prerequisite, we encourage the users to go through the [Behavior Tree documentation](https://behaviortree.github.io/BehaviorTree.CPP/), which explains about different behaviors nodes used in these trees such as `ReactiveSequence`, `SequenceWithMemory` and `RetryUntilSuccessful`.

This behavior tree is a soft extension to the [Navigate To Pose](nav_to_pose_recovery.html#behavior-tree-nav-to-pose).
Apart from the functionalities of [Navigate To Pose](nav_to_pose_recovery.html#behavior-tree-nav-to-pose), this behavior tree allows the robot to efficiently handle an obstacle (e.g. forklift, person, or other temporary obstacles) close to the goal by pausing the robot’s navigation and wait for a user-specified time to check if the obstacle has cleared.
If the obstacle has moved during the waiting time, the robot will continue to the goal taking the shorter path. If the obstacle has not moved during the waiting time or the waiting time expires, then the robot will use the longer path around to reach the final goal location.
Ultimately, for a given task, this behavior tree aids in solving the problem of long cycle time, which is caused because of the long path generated due to the temporary obstacles present close to the goal location.

The behavior tree is depicted in the image below.
From the image, it can be noted that there is an additional branch in the Navigation Subtree known as `MonitorAndFollowPath`. This branch is created with the intention for the users to perform any kind of monitoring behavior that their robot should exhibit.
In this particular BT, the monitoring branch is exclusively utilized by `PathLongerOnApproach` BT node for checking if the global planner has decided to plan a significantly longer path for the robot on approaching the user-specified goal proximity.
If there is no significantly longer path, the monitor node goes into the `FollowPath` recovery node, which then generates the necessary control commands.

![../../_images/patience_and_recovery.png](../../_images/patience_and_recovery.png)

Once there is a significantly longer path, the child node for the `PathLongerOnApproach` node ticks.
The child node is a `RetryUntilSuccessful` decorator node, which inturns have a `SequenceWithMemory` node as its child.
Firstly, the `SequenceWithMemory` node cancels the controller server by ticking the `CancelControl` node. The cancellation of the controller server halts the further navigation of the robot.
Next, the `SequenceWithMemory` node ticks the `Wait` node, which enables the robot to wait for the given user-specified time.
Here we need to note that, the `MonitorAndFollowPath` is a `ReactiveSequence` node, therefore the `PathLongerOnApproach` node needs to return SUCCESS, before the `FollowPath` node can be ticked once again.

In the below GIF, it can be seen that the robot is approaching the goal location, but it found an obstacle in the goal proximity, because of which the global planner, plans a longer path around.
This is the point where the `PathLongerOnApproach` ticks and ticks its children, consequently cancelling the `controller_server` and waiting to see if the obstacle clears up.
In the below scenario, the obstacles do not clear, causing the robot to take the longer path.

![../../_images/nav2_patience_near_goal_and_go_around.gif](../../_images/nav2_patience_near_goal_and_go_around.gif)

Alternatively, if the obstacles are cleared, then there is a shorter path generated by the global planner.
Now, the `PathLongerOnApproach` returns SUCCESS, that cause the `FollowPath` to continue with the robot navigation.

![../../_images/nav2_patience_near_goal_and_clear_obstacle.gif](../../_images/nav2_patience_near_goal_and_clear_obstacle.gif)

Apart from the above scenarios, we also need to note that, the robot will take the longer path to the goal location if the obstacle does not clear up in the given user-specific wait time.

In conclusion, this particular BT would serve, both as an example and ready-to-use BT for an organizational specific application, that wishes to optimize its process cycle time.

```
<root main_tree_to_execute="MainTree">
  <BehaviorTree ID="MainTree">
    <RecoveryNode number_of_retries="6" name="NavigateRecovery">
      <PipelineSequence name="NavigateWithReplanning">
        <ControllerSelector selected_controller="{selected_controller}" default_controller="FollowPath" topic_name="controller_selector"/>
        <PlannerSelector selected_planner="{selected_planner}" default_planner="GridBased" topic_name="planner_selector"/>
        <RateController hz="1.0">
          <RecoveryNode number_of_retries="1" name="ComputePathToPose">
            <ComputePathToPose goal="{goal}" path="{path}" planner_id="{selected_planner}" error_code_id="{compute_path_error_code}" error_msg="{compute_path_error_msg}"/>
            <ClearEntireCostmap name="ClearGlobalCostmap-Context" service_name="global_costmap/clear_entirely_global_costmap"/>
          </RecoveryNode>
        </RateController>
        <ReactiveSequence name="MonitorAndFollowPath">
          <PathLongerOnApproach path="{path}" prox_len="3.0" length_factor="2.0">
            <RetryUntilSuccessful num_attempts="1">
              <SequenceWithMemory name="CancelingControlAndWait">
                <CancelControl name="ControlCancel"/>
                <Wait wait_duration="5.0"/>
              </SequenceWithMemory>
            </RetryUntilSuccessful>
          </PathLongerOnApproach>
          <RecoveryNode number_of_retries="1" name="FollowPath">
            <FollowPath path="{path}" controller_id="{selected_controller}" error_code_id="{follow_path_error_code}" error_msg="{follow_path_error_msg}"/>
            <ClearEntireCostmap name="ClearLocalCostmap-Context" service_name="local_costmap/clear_entirely_local_costmap"/>
          </RecoveryNode>
        </ReactiveSequence>
      </PipelineSequence>
      <ReactiveFallback name="RecoveryFallback">
        <GoalUpdated/>
        <RoundRobin name="RecoveryActions">
          <Sequence name="ClearingActions">
            <ClearEntireCostmap name="ClearLocalCostmap-Subtree" service_name="local_costmap/clear_entirely_local_costmap"/>
            <ClearEntireCostmap name="ClearGlobalCostmap-Subtree" service_name="global_costmap/clear_entirely_global_costmap"/>
          </Sequence>
          <Spin spin_dist="1.57" error_code_id="{spin_error_code}" error_msg="{spin_error_msg}"/>
          <Wait wait_duration="5.0"/>
          <BackUp backup_dist="0.30" backup_speed="0.05" error_code_id="{backup_error_code}" error_msg="{backup_error_msg}"/>
        </RoundRobin>
      </ReactiveFallback>
    </RecoveryNode>
  </BehaviorTree>
</root>
```

A complete demo of this BT can be seen in the video below:

---

#### Navigate To Pose With Consistent Replanning And If Path Becomes Invalid

*Source: [https://docs.nav2.org/behavior_trees/trees/nav_to_pose_with_consistent_replanning_and_if_path_becomes_invalid.html](https://docs.nav2.org/behavior_trees/trees/nav_to_pose_with_consistent_replanning_and_if_path_becomes_invalid.html)*

##### Navigate To Pose With Consistent Replanning And If Path Becomes Invalid

This behavior tree implements a significantly more mature version of the behavior tree on [Nav2 Behavior Trees](../index.html#behavior-trees).
It navigates from a starting point to a single point goal in freespace.
It contains both use of custom recoveries in specific sub-contexts as well as a global recovery subtree for system-level failures.
It also provides the opportunity for users to retry tasks multiple times before returning a failed state.

The `ComputePathToPose` and `FollowPath` BT nodes both also specify their algorithms to utilize.
By convention we name these by the style of algorithms that they are (e.g. not `DWB` but rather `FollowPath`) such that a behavior tree or application developer need not worry about the technical specifics. They just want to use a path following controller.

In this behavior tree, we attempt to retry the entire navigation task 6 times before returning to the caller that the task has failed.
This allows the navigation system ample opportunity to try to recovery from failure conditions or wait for transient issues to pass, such as crowding from people or a temporary sensor failure.

In nominal execution, replanning can be triggered by an a invalid previous path, a new goal or if a new path has not been created for 10 seconds.
If the planner or controller fails, it will trigger contextually aware recoveries in its subtree.
Currently, the recoveries will clear the global costmap if the planner fails and clear the local costmap if the controller fails.
Additional context-specific recoveries can be added to these subtrees.

If these contextual recoveries fail, this behavior tree enters the recovery subtree.
This subtree is reserved for system-level failures to help resolve issues like the robot being stuck or in a bad spot.
This subtree has the `GoalUpdated` BT node which ticks every iteration to ensure responsiveness of new goals.
Next, the recovery subtree will attempt the following recoveries: costmap clearing operations, spinning, waiting, and backing up.
After each of the recoveries in the subtree, the main navigation subtree will be reattempted.
If it continues to fail, the next recovery in the recovery subtree is ticked.

While this behavior tree does not make use of it, the `PlannerSelector`, `ControllerSelector`, and `GoalCheckerSelector` behavior tree nodes can also be helpful. Rather than hardcoding the algorithm to use (`GridBased` and `FollowPath`), these behavior tree nodes will allow a user to dynamically change the algorithm used in the navigation system via a ROS topic. It may be instead advisable to create different subtree contexts using condition nodes with specified algorithms in their most useful and unique situations. However, the selector nodes can be a useful way to change algorithms from an external application rather than via internal behavior tree control flow logic. It is better to implement changes through behavior tree methods, but we understand that many professional users have external applications to dynamically change settings of their navigators.

```
<root main_tree_to_execute="MainTree">
  <BehaviorTree ID="MainTree">
    <RecoveryNode number_of_retries="6" name="NavigateRecovery">
      <PipelineSequence>
        <ControllerSelector selected_controller="{selected_controller}" default_controller="FollowPath" topic_name="controller_selector"/>
        <PlannerSelector selected_planner="{selected_planner}" default_planner="GridBased" topic_name="planner_selector"/>
        <RateController hz="1.0" name="RateControllerComputePathToPose">
          <RecoveryNode number_of_retries="1" name="RecoveryComputePathToPose">
            <Fallback name="FallbackComputePathToPose">
              <ReactiveSequence name="CheckIfNewPathNeeded">
                <Inverter>
                  <GlobalUpdatedGoal/>
                </Inverter>
                <IsPathValid path="{path}"/>
              </ReactiveSequence>
              <ComputePathToPose goal="{goal}" path="{path}" planner_id="{selected_planner}" error_code_id="{compute_path_error_code}" error_msg="{compute_path_error_msg}"/>
            </Fallback>
            <ClearEntireCostmap name="ClearGlobalCostmap-Context" service_name="global_costmap/clear_entirely_global_costmap"/>
          </RecoveryNode>
        </RateController>
        <RecoveryNode number_of_retries="1" name="RecoveryFollowPath">
          <FollowPath path="{path}" controller_id="{selected_controller}" error_code_id="{follow_path_error_code}" error_msg="{follow_path_error_msg}"/>
          <ClearEntireCostmap name="ClearLocalCostmap-Context" service_name="local_costmap/clear_entirely_local_costmap"/>
        </RecoveryNode>
      </PipelineSequence>
      <ReactiveFallback name="FallbackRecoveries">
        <GoalUpdated/>
        <RoundRobin name="RecoveryActions">
          <Sequence name="ClearingActions">
            <ClearEntireCostmap name="ClearLocalCostmap-Subtree" service_name="local_costmap/clear_entirely_local_costmap"/>
            <ClearEntireCostmap name="ClearGlobalCostmap-Subtree" service_name="global_costmap/clear_entirely_global_costmap"/>
          </Sequence>
          <Spin name="SpinRecovery" spin_dist="1.57" error_code_id="{spin_error_code}" error_msg="{spin_error_msg}"/>
          <Wait name="WaitRecovery" wait_duration="5.0"/>
          <BackUp name="BackUpRecovery" backup_dist="0.30" backup_speed="0.05" error_code_id="{backup_error_code}" error_msg="{backup_error_msg}"/>
        </RoundRobin>
      </ReactiveFallback>
    </RecoveryNode>
  </BehaviorTree>
</root>
```

---

#### Odometry Calibration

*Source: [https://docs.nav2.org/behavior_trees/trees/odometry_calibration.html](https://docs.nav2.org/behavior_trees/trees/odometry_calibration.html)*

##### Odometry Calibration

This behavior tree drives the robot in a CCW square three times using the DriveOnHeading and Spin behaviors.
The robot will traverse each side of the square at 0.2 (m/s) for 2 meters before making a 90 degree turn.
This is a primitive experiment to measure odometric accuracy and can be used and repeated to tune parameters related to odometry to improve quality.

[![Alternative text](../../_images/odometry_calibration.gif)](../../_images/odometry_calibration.gif)

```
<root main_tree_to_execute="MainTree">
  <BehaviorTree ID="MainTree">
    <Repeat num_cycles="3">
      <Sequence name="Drive in a square">
        <DriveOnHeading dist_to_travel="2.0" speed="0.2" time_allowance="12"/>
        <Spin spin_dist="1.570796" is_recovery="false"/>
        <DriveOnHeading dist_to_travel="2.0" speed="0.2" time_allowance="12"/>
        <Spin spin_dist="1.570796" is_recovery="false"/>
        <DriveOnHeading dist_to_travel="2.0" speed="0.2" time_allowance="12"/>
        <Spin spin_dist="1.570796" is_recovery="false"/>
        <DriveOnHeading dist_to_travel="2.0" speed="0.2" time_allowance="12"/>
        <Spin spin_dist="1.570796" is_recovery="false"/>
      </Sequence>
    </Repeat>
  </BehaviorTree>
</root>
```

---

## Commander Api

### Simple Commander API

*Source: [https://docs.nav2.org/commander_api/index.html](https://docs.nav2.org/commander_api/index.html)*

#### Simple Commander API

##### Overview

The goal of the Nav2 Simple (Python3) Commander is to provide a “navigation as a library” capability to Python3 users. We provide an API that handles all the ROS 2 and Action Server tasks for you such that you can focus on building an application leveraging the capabilities of Nav2 (after you’ve configured it to your liking with your plugins of choice). [We also provide you with demos and examples of API usage](https://github.com/ros-navigation/navigation2/tree/main/nav2_simple_commander) to build common basic capabilities in autonomous mobile robotics in the `nav2_simple_commander` package.

A simple demonstration is shown below. Note: `goToPose()`, `goThroughPoses()`, `followWaypoints()` and similar are **non-blocking** such that you can receive and process feedback in a single-threaded application. As such while waiting for a task to be completed, the `while not nav.isTaskComplete()` design is necessary to poll for changes in the navigation completion, and if not complete some tasks of interest to your application (like processing feedback, doing something with the data the robot is collecting, or checking for faults).

You may use this simple commander preempt commands of the same type (e.g. you can preempt a `goToPose()` with another `goToPose()`) but you must explicitly cancel a current command and issue a new one if switching between `goToPose()`, `goThroughPoses()`, or `followWaypoints()`.

```
from nav2_simple_commander.robot_navigator import BasicNavigator, TaskResult
import rclpy

rclpy.init()
nav = BasicNavigator()

#### ...

nav.setInitialPose(init_pose)
nav.waitUntilNav2Active() # if autostarted, else use lifecycleStartup()

#### ...

path = nav.getPath(init_pose, goal_pose)
smoothed_path = nav.smoothPath(path)

#### ...

nav.goToPose(goal_pose)
while not nav.isTaskComplete():
  feedback = nav.getFeedback()
  if feedback.navigation_duration > 600:
    nav.cancelTask()

#### ...

result = nav.getResult()
if result == TaskResult.SUCCEEDED:
    print('Goal succeeded!')
elif result == TaskResult.CANCELED:
    print('Goal was canceled!')
elif result == TaskResult.FAILED:
    print('Goal failed!')
```

##### Commander API

The methods provided by the basic navigator are shown below, with inputs and expected returns.
If a server fails, it may throw an exception or return a None object, so please be sure to properly wrap your navigation calls in try/catch and check returns for None type.

New as of September 2023: the simple navigator constructor will accept a namespace field to support multi-robot applications or namespaced Nav2 launches.

| Robot Navigator Method | Description |
| --- | --- |
| setInitialPose(initial\_pose) | Sets the initial pose (`PoseStamped`) of the robot to localization. |
| goThroughPoses(poses, behavior\_tree=’’) | Requests the robot to drive through a set of poses (list of `PoseStamped`). |
| goToPose(pose, behavior\_tree=’’) | Requests the robot to drive to a pose (`PoseStamped`). |
| followWaypoints(poses) | Requests the robot to follow a set of waypoints (list of `PoseStamped`). This will execute the chosen `TaskExecutor` plugin at each pose. |
| followPath(path, controller\_id=’’, goal\_checker\_id=’’, progress\_checker\_id=’’, path\_handler\_id=’’) | Requests the robot to follow a path from a starting to a goal `PoseStamped`, `nav_msgs/Path`. |
| spin(spin\_dist=1.57, time\_allowance=10, disable\_collision\_checks=False) | Requests the robot to performs an in-place rotation by a given angle. |
| driveOnHeading(dist=0.15, speed=0.025, time\_allowance=10, disable\_collision\_checks=False) | Requests the robot to drive on heading by a given distance. |
| backup(backup\_dist=0.15, backup\_speed=0.025, time\_allowance=10, disable\_collision\_checks=False) | Requests the robot to back up by a given distance. |
| assistedTeleop(time\_allowance=30) | Requests the robot to run the assisted teleop action. |
| cancelTask() | Cancel an ongoing task, including route tasks. |
| isTaskComplete(task=RunningTask.NONE) | Checks if task is complete yet, times out at `100ms`. Returns `True` if completed and `False` if still going. Provide the task ID from the long-running task (follow path, compute and track route, etc) |
| getFeedback(task=RunningTask.NONE) | Gets feedback from task, returns action server feedback msg. provide the task ID for the task you are requesting. |
| getResult() | Gets final result of task, to be called after `isTaskComplete` returns `True`. Returns action server result msg. |
| getPath(start, goal, planner\_id=’’, use\_start=False) | Gets a path from a starting to a goal `PoseStamped`, `nav_msgs/Path`. |
| getPathThroughPoses(start, goals, planner\_id=’’, use\_start=False) | Gets a path through a starting to a set of goals, a list of `PoseStamped`, `nav_msgs/Path`. |
| getRoute(start, goal, use\_start=False) | Gets a route from a set start and goal nodeIDs or PoseStamped. Use Start if given, otherwises uses TF to obtain robot pose. |
| getAndTrackRoute(start, goal, use\_start=False) | Gets a route from a set of start and goal NodeIDs or PoseStamped. Uses start if given, otherwise uses TF to obtain the robot pose. |
| dockRobot(dock\_pose, dock\_type) | Attempts to dock the robot at a given docking pose and type, without using docking database of known docks. |
| dockRobot(dock\_id) | Attempts to dock the robot at a given dock ID in the database of known docks. |
| undockRobot(dock\_type=””) | Undocks robot. If docking server instance was used to dock, type is not required. |
| smoothPath(path, smoother\_id=’’, max\_duration=2.0, check\_for\_collision=False) | Smooths a given path of type `nav_msgs/Path`. |
| changeMap(map\_filepath) | Requests a change from the current map to map\_filepath’s yaml. |
| clearAllCostmaps() | Clears both the global and local costmaps. |
| clearLocalCostmap() | Clears the local costmap. |
| clearGlobalCostmap() | Clears the global costmap. |
| clearLocalCostmapAroundPose( PoseStamped, distance) | Clears the local costmap around given pose. |
| clearGlobalCostmapAroundPose( PoseStamped, distance) | Clears the global costmap around given pose. |
| clearCostmapExceptRegion( distance) | Clears the local costmap around current robot pose. |
| getGlobalCostmap() | Returns the global costmap, `nav2_msgs/Costmap`. |
| getLocalCostmap() | Returns the local costmap, `nav2_msgs/Costmap`. |
| toggleCollisionMonitor(enable) | Toggles the collision monitor on (True) or off (False). |
| followObjectByTopic(topic, max\_duration=0) | Requests the robot to follow an object by subscribing to a given topic. |
| followObjectByFrame(frame, max\_duration=0) | Requests the robot to follow an object by a given frame. |
| waitUntilNav2Active( navigator=’bt\_navigator’, localizer=’amcl’) | Blocks until Nav2 is completely online and lifecycle nodes are in the active state. To be used in conjunction with autostart or external lifecycle bringup. Custom navigator and localizer nodes can be specified |
| lifecycleStartup() | Sends a request to all lifecycle management servers to bring them into the active state, to be used if autostart is `False` and you want this program to control Nav2’s lifecycle. |
| lifecycleShutdown() | Sends a request to all lifecycle management servers to shut them down. |
| destroyNode() | Releases the resources used by the object. |

##### Costmap API

This is a Python3 API for costmap 2d messages from the stack. It provides the basic conversion, get/set, and handling semantics found in the costmap 2d C++ API.

| Costmap Method | Description |
| --- | --- |
| getSizeInCellsX() | Get map width in cells. |
| getSizeInCellsY() | Get map height in cells. |
| getSizeInMetersX() | Get x axis map size in meters. |
| getSizeInMetersY() | Get y axis map size in meters. |
| getOriginX() | Get the origin x axis of the map [m]. |
| getOriginY() | Get the origin y axis of the map [m]. |
| getResolution() | Get map resolution [m/cell]. |
| getGlobalFrameID() | Get global frame\_id. |
| getCostmapTimestamp() | Get costmap timestamp. |
| getCostXY(mx, my) | Get the cost (`np.uint8`) of a cell in the costmap using mx (`int`) , my (`int`) of Map Coordinate. |
| getCostIdx(index) | Get the cost (`np.uint8`) of a cell in the costmap using index (`int`) |
| setCost(mx, my, cost) | Set the cost (`np.uint8`) of a cell in the costmap using mx (`int`) , my (`int`) of Map Coordinate. |
| mapToWorld(mx, my) | Get the wx (`float`) [m], wy (`float`) [m] of world coordinate XY using mx (`int`), my (`int`) of map coordinate XY |
| worldToMapValidated(wx, wy) | Get the mx (`int`), my (`int`) of map coordinate XY using wx (`float`) [m], wy (`float`) [m] of world coordinate XY. If wx wy coordinates are invalid, (None,None) is returned. |
| getIndex(mx, my) | Get the index (`int`) of the cell using mx (`int`), my (`int`) of map coordinate XY |

##### Footprint Collision Checker API

This is a Python3 API for a Footprint Collision Checker.
It provides the needed methods to manipulate the coordinates
and calculate the cost of a Footprint in a given map.

| Footprint Collision Checker Method | Description |
| --- | --- |
| footprintCost(footprint) | Checks the footprint (`Polygon`) for collision at its implicit provided coordinate pose. |
| lineCost(x0, x1, y0, y1, step\_size=0.5) | Iterate over all the points along a line and check for collision. The line is defined by x0, y0, x1, y1, step\_size (`int`) or (`float`). |
| worldToMapValidated(wx, wy) | Get the mx (`int`), my (`int`) of map coordinate XY using wx (`float`) [m], wy (`float`) [m] of world coordinate XY. If wx wy coordinates are invalid, (None,None) is returned. Returns None if costmap is not defined yet through (`setCostmap(costmap)`). |
| pointCost(x, y) | Get the cost of a point in the costmap using map coordinates XY. (`int`) |
| setCostmap(costmap) | Specify which costmap to use with the footprint collision checker. (`PyCostmap2D`) |
| footprintCostAtPose(x, y, theta, footprint) | Get the cost of a footprint at a specific Pose in map coordinates. x, y, theta (`float`) footprint (`Polygon`). |

##### Examples and Demos

All of these can be found in the [package](https://github.com/ros-navigation/navigation2/tree/main/nav2_simple_commander).

[![Alternative text](../_images/readme.gif)](../_images/readme.gif)

The `nav2_simple_commander` has a few examples to highlight the API functions available to you as a user:

* `example_nav_to_pose.py` - Demonstrates the navigate to pose capabilities of the navigator, as well as a number of auxiliary methods.
* `example_nav_through_poses.py` - Demonstrates the navigate through poses capabilities of the navigator, as well as a number of auxiliary methods.
* `example_waypoint_follower.py` - Demonstrates the waypoint following capabilities of the navigator, as well as a number of auxiliary methods.
* `example_follow_path.py` - Demonstrates the path following capabilities of the navigator, as well as a number of auxiliary methods like path smoothing.
* `example_assisted_teleop.py` - Demonstrates the assisted teleop capabilities of the navigator.
* `example_route.py` - Demonstrates the route server capabilities of the navigator.

The `nav2_simple_commander` has a few demonstrations to highlight a couple of simple autonomy applications you can build using the API:

* `demo_security.py` - A simple security robot application, showing how to have a robot follow a security route using Navigate Through Poses to do a patrol route, indefinitely.
* `demo_picking.py` - A simple item picking application, showing how to have a robot drive to a specific shelf in a warehouse to either pick an item or have a person place an item into a basket and deliver it to a destination for shipping using Navigate To Pose.
* `demo_inspection.py` - A simple shelf inspection application, showing how to use the Waypoint Follower and task executors to take pictures, RFID scans, etc of shelves to analyze the current shelf statuses and locate items in the warehouse.

---

## Concepts

### Navigation Concepts

*Source: [https://docs.nav2.org/concepts/index.html](https://docs.nav2.org/concepts/index.html)*

#### Navigation Concepts

This page is to help familiarize new roboticists to the concepts of mobile robot navigation, in particular, with the concepts required to appreciating and working with this project.

##### ROS 2

ROS 2 is the core middleware used for Nav2. If you are unfamiliar with this, please visit [the ROS 2 documentation](https://docs.ros.org/en/rolling/) before continuing.

###### Action Server

Just as in ROS, action servers are a common way to control long running tasks like navigation.
This stack makes more extensive use of actions, and in some cases, without an easy topic interface.
It is more important to understand action servers as a developer in ROS 2.
Some simple CLI examples can be found in the [ROS 2 documentation](https://docs.ros.org/en/rolling/Tutorials/Understanding-ROS2-Actions.html).

Action servers are similar to a canonical service server.
A client will request some task to be completed, except, this task may take a long time.
An example would be moving the shovel up from a bulldozer or ask a robot to travel 10 meters to the right.

In this situation, action servers and clients allow us to call a long-running task in another process or thread and return a future to its result.
It is permissible at this point to block until the action is complete, however, you may want to occasionally check if the action is complete and continue to process work in the client thread.
Since it is long-running, action servers will also provide feedback to their clients.
This feedback can be anything and is defined in the ROS `.action` along with the request and result types.
In the bulldozer example, a request may be an angle, a feedback may be the angle remaining to be moved, and the result is a success or fail boolean with the end angle.
In the navigation example, a request may be a position, a feedback may be the time its been navigating for and the distance to the goal, and the result a boolean for success.

Feedback and results can be gathered synchronously by registering callbacks with the action client.
They may also be gathered by asynchronously requesting information from the shared future objects.
Both require spinning the client node to process callback groups.

Action servers are used in this stack to communicate with the highest level Behavior Tree (BT) navigator through a `NavigateToPose` action message.
They are also used for the BT navigator to communicate with the subsequent smaller action servers to compute plans, control efforts, and recoveries.
Each will have their own unique `.action` type in `nav2_msgs` for interacting with the servers.

###### Lifecycle Nodes and Bond

Lifecycle (or Managed, more correctly) nodes are unique to ROS 2.
More information can be [found here](https://design.ros2.org/articles/node_lifecycle.html).
They are nodes that contain state machine transitions for bringup and teardown of ROS 2 servers.
This helps in deterministic behavior of ROS systems in startup and shutdown.
It also helps users structure their programs in reasonable ways for commercial uses and debugging.

When a node is started, it is in the unconfigured state, only processing the node’s constructor which should **not** contain any ROS networking setup or parameter reading.
By the launch system, or the supplied lifecycle manager, the nodes need to be transitioned to inactive by configuring.
After, it is possible to activate the node by transitioning through the activating stage.

This state will allow the node to process information and be fully setup to run.
The configuration stage, triggering the `on_configure()` method, will setup all parameters, ROS networking interfaces, and for safety systems, all dynamically allocated memory.
The activation stage, triggering the `on_activate()` method, will activate the ROS networking interfaces and set any states in the program to start processing information.

To shutdown, we transition into deactivating, cleaning up, shutting down and end in the finalized state.
The networking interfaces are deactivated and stop processing, deallocate memory, exit cleanly, in those stages, respectively.

The lifecycle node framework is used extensively through out this project and all servers utilize it.
It is best convention for all ROS systems to use lifecycle nodes if it is possible.

Within Nav2, we use a wrapper of LifecycleNodes, `nav2_util LifecycleNode`.
This wrapper wraps much of the complexities of LifecycleNodes for typical applications.
It also includes a `bond` connection for the lifecycle manager to ensure that after a server transitions up, it also remains active.
If a server crashes, it lets the lifecycle manager know and transition down the system to prevent a critical failure. See [Eloquent to Foxy](../migration/Eloquent.html#eloquent-migration) for details.

---

##### Behavior Trees

Behavior trees (BT) are becoming increasingly common in complex robotics tasks.
They are a tree structure of tasks to be completed.
It creates a more scalable and human-understandable framework for defining multi-step or many state applications.
This is opposed to a finite state machine (FSM) which may have dozens of states and hundreds of transitions.
An example would be a soccer-playing robot.
Embedding the logic of soccer game play into a FSM would be challenging and error prone with many possible states and rules.
Additionally, modeling choices like to shoot at the goal from the left, right, or center, is particularly unclear.
With a BT, basic primitives, like “kick”, “walk”, “go to ball”, can be created and reused for many behaviors.
More information can be found [in this book](https://arxiv.org/abs/1709.00084).
I **strongly** recommend reading chapters 1-3 to get a good understanding of the nomenclature and workflow.
It should only take about 30 minutes.

Behavior Trees provide a formal structure for navigation logic which can be both used to create complex systems but also be verifiable and validated as provenly correct using advanced tools. Having the application logic centralized in the behavior tree and with independent task servers (which only communicate data over the tree) allows for formal analysis.

For this project, we use [BehaviorTree CPP V4](https://www.behaviortree.dev/) as the behavior tree library.
We create node plugins which can be constructed into a tree, inside the `BT Navigator`.
The node plugins are loaded into the BT and when the XML file of the tree is parsed, the registered names are associated.
At this point, we can march through the behavior tree to navigate.

One reason this library is used is its ability to load subtrees. This means that the Nav2 behavior tree can be loaded into another higher-level BT to use this project as node plugin.
An example would be in soccer play, using the Nav2 behavior tree as the “go to ball” node with a ball detection as part of a larger task.
Additionally, we supply a `NavigateToPoseAction` plugin (among others) for BT so the Nav2 stack can be called from a client application through the usual action interface.

Other systems could be used to design complex autonomous behavior, namely Hierarchical FSMs (HFSM).
Behavior Trees were selected due to popularity across the robotics and related industries and by largely user demand.
However, due to the independent task server nature of Nav2, it is not difficult to offer a `nav2_hfsm_navigator` package in the future, pending interest and contribution.

---

##### Navigation Servers

Planners and controllers are at the heart of a navigation task.
Recoveries are used to get the robot out of a bad situation or attempt to deal with various forms of issues to make the system fault-tolerant.
Smoothers can be used for additional quality improvements of the planned path.
In this section, the general concepts around them and their uses in this project are analyzed.

###### Planner, Controller, Smoother, Route, and Behavior Servers

Five of the action servers in this project are the planner, behavior, smoother, route, and controller servers.

These action servers are used to host a map of algorithm plugins to complete various tasks.
They also host the environmental representation used by the algorithm plugins to compute their outputs.

The planner, smoother and controller servers will be configured at runtime with the names (aliases) and types of algorithms to use.
These types are the pluginlib names that have been registered and the names are the aliases for the task.
An example would be the DWB controller used with name `FollowPath`, as it follows a reference path.
In this case, then all parameters for DWB would be placed in that namespace, e.g. `FollowPath.<param>`.

These three servers then expose an action interface corresponding to their task.
When the behavior tree ticks the corresponding BT node, it will call the action server to process its task.
The action server callback inside the server will call the chosen algorithm by its name (e.g. `FollowPath`) that maps to a specific algorithm.
This allows a user to abstract the algorithm used in the behavior tree to classes of algorithms.
For instance, you can have `N` plugin controllers to follow paths, dock with charger, avoid dynamic obstacles, or interface with a tool.
Having all of these plugins in the same server allows the user to make use of a single environmental representation object, which is costly to duplicate.

For the behavior server, each of the behaviors also contains their own name, however, each plugin will also expose its own special action server.
This is done because of the wide variety of behavior actions that may be created which cannot have a single simple interface to share.
The behavior server also contains a costmap subscriber to the local costmap, receiving real-time updates from the controller server, to compute its tasks.
We do this to avoid having multiple instances of the local costmap which are computationally expensive to duplicate.

The route server does not contain multiple “routing algorithms” like the planner or controller servers.
Instead, it computes a route using a navigation graph using a set of plugins for scoring edges in the graph, parsing graph files, and performing operations along the route, if necessary.
Rather than freespace planning, this computes a route using a graph that can be generated to represent lanes, areas the robot is allowed to navigate, a teach-and-repeat route, urban roadways, and more.

Alternatively, since the BT nodes are trivial plugins calling an action, new BT nodes can be created to call other action servers with other action types.
It is advisable to use the provided servers if possible at all times.
If, due to the plugin or action interfaces, a new server is needed, that can be sustained with the framework.
The new server should use the new type and plugin interface, similar to the provided servers.
A new BT node plugin will need to be created to call the new action server – however no forking or modification is required in the Nav2 repo itself by making extensive use of servers and plugins.

If you find that you require a new interface to the pluginlib definition or action type, please file a ticket and see if we can rectify that in the same interfaces.

###### Planners

The task of a planner is to compute a path to complete some objective function.
The path can also be known as a route, depending on the nomenclature and algorithm selected.
Two canonical examples are computing a plan to a goal (e.g. from current position to a goal) or complete coverage (e.g. plan to cover all free space).
The planner will have access to a global environmental representation and sensor data buffered into it.
Planners can be written to:

* Compute shortest path
* Compute complete coverage path
* Compute paths along sparse or predefined routes

The general task in Nav2 for the planner is to compute a valid, and potentially optimal, path from the current pose to a goal pose.
However, many classes of plans and routes exist which are supported.

###### Controllers

Controllers, also known as local planners in ROS 1, are the way we follow the globally computed path or complete a local task.
The controller will have access to a local environment representation to attempt to compute feasible control efforts for the base to follow.
Many controller will project the robot forward in space and compute a locally feasible path at each update iteration.
Controllers can be written to:

* Follow a path
* Dock with a charging station using detectors in the odometric frame
* Board an elevator
* Interface with a tool

The general task in Nav2 for a controller is to compute a valid control effort to follow the global plan.
However, many classes of controllers and local planners exist.
It is the goal of this project that all controller algorithms can be plugins in this server for common research and industrial tasks.

###### Behaviors

Recovery behaviors are a mainstay of fault-tolerant systems.
The goal of recoveries are to deal with unknown or failure conditions of the system and autonomously handle them.
Examples may include faults in the perception system resulting in the environmental representation being full of fake obstacles.
The clear costmap recovery would then be triggered to allow the robot to move.

Another example would be if the robot was stuck due to dynamic obstacles or poor control.
Backing up or spinning in place, if permissible, allow the robot to move from a poor location into free space it may navigate successfully.

Finally, in the case of a total failure, a recovery may be implemented to call an operator’s attention for help.
This can be done via email, SMS, Slack, Matrix, etc.

It is important to note that the behavior server can hold any behavior to share access to expensive resources like costmaps or TF buffers, not just recovery behaviors. Each may have its own API.

###### Smoothers

As criteria for optimality of the path searched by a planner are usually reduced compared to reality, additional path refinement is often beneficial.
Smoothers have been introduced for this purpose, typically responsible for reducing path raggedness and smoothing abrupt rotations,
but also for increasing distance from obstacles and high-cost areas as the smoothers have access to a global environmental representation.

Use of a separate smoother over one that is included as part of a planner is advantageous when combining different planners with different smoothers or when a specific control over smoothing is required, e.g. smoothing only a specific part of the path.

The general task in Nav2 for a smoother is to receive a path and return its improved version.
However, for different input paths, criteria of the improvements and methods of acquiring them exist, creating space for a multitude of smoothers that can be registered in this server.

###### Route

The route server is a specialized planner that computes a route using a navigation graph, rather than the freespace costmap.
The route is computed as the optimal way from the start to the goal through the set of nodes and directional edges in the pre-defined navigation graph.
This navigation graph can be generated to represent lanes, areas the robot is allowed to navigate, a teach-and-repeat route, urban roadways, and more.

###### Robot Footprints

It is worth remarking that in the cost maps, we set a robot’s footprint either as a circle of radius `robot_radius` or as a vector of points `footprint` representing an arbitrary polygon if the robot is non-circular. This can also be adjusted over time using the costmap’s `~/footprint` topic, which will update the polygon over time as needed due to changes in the robot’s state, such as movement of an attached manipulator, picking up a pallet, or other actions that adjust a robot’s shape. That polygon will then automatically be used by the planners and controllers.

###### Waypoint Following

Waypoint following is a basic feature of a navigation system. It tells our system how to use navigation to get to multiple destinations.

The `nav2_waypoint_follower` contains a waypoint following program with a plugin interface for specific task executors.
This is useful if you need to go to a given location and complete a specific task like take a picture, pick up a box, or wait for user input.
It is a nice demo application for how to use Nav2 in a sample application.

However, it could be used for more than just a sample application.
There are 2 schools of thoughts for fleet managers / dispatchers:

* Dumb robot; smart centralized dispatcher
* Smart robot; dumb centralized dispatcher

In the first, the `nav2_waypoint_follower` is fully sufficient to create a production-grade on-robot solution. Since the autonomy system / dispatcher is taking into account things like the robot’s pose, battery level, current task, and more when assigning tasks, the application on the robot just needs to worry about the task at hand and not the other complexities of the system to complete the requested task. In this situation, you should think of a request to the waypoint follower as 1 unit of work (e.g. 1 pick in a warehouse, 1 security patrole loop, 1 aisle, etc) to do a task and then return to the dispatcher for the next task or request to recharge. In this school of thought, the waypoint following application is just one step above navigation and below the system autonomy application.

In the second, the `nav2_waypoint_follower` is a nice sample application / proof of concept, but you really need your waypoint following / autonomy system on the robot to carry more weight in making a robust solution. In this case, you should use the `nav2_behavior_tree` package to create a custom application-level behavior tree using navigation to complete the task. This can include subtrees like checking for the charge status mid-task for returning to dock or handling more than 1 unit of work in a more complex task. Soon, there will be a `nav2_bt_waypoint_follower` (name subject to adjustment) that will allow you to create this application more easily. In this school of thought, the waypoint following application is more closely tied to the system autonomy, or in many cases, is the system autonomy.

Neither is better than the other, it highly depends on the tasks your robot(s) are completing, in what type of environment, and with what cloud resources available. Often this distinction is very clear for a given business case.

`nav2_waypoint_follower` also supports GPS waypoint following when global localization is provided by [robot\_localization](https://github.com/cra-ros-pkg/robot_localization/) using the `navsat_transform` node - but also may be provided by Fuse or any number of other sources.
There is an action server named `/follow_gps_waypoints` within `nav2_waypoint_follower` that can directly take in goals expressed in GPS coordinates, convert them to cartesian goals in the global frame, and execute them as cartesian waypoints.

---

##### State Estimation

Within the navigation project, there are 2 major transformations that need to be provided, according to community standards.
The `map` to `odom` transform is provided by a positioning system (localization, mapping, SLAM) and `odom` to `base_link` by an odometry system.

Note

There is **no** requirement on using a LIDAR on your robot to use the navigation system. There is no requirement to use lidar-based collision avoidance,
localization, or SLAM. However, we do provide instructions and support tried and true implementations of these things using lidars.
You can be equally as successful using a vision or depth based positioning system and using other sensors for collision avoidance.
The only requirement is that you follow the standards below with your choice of implementation.

###### Standards

[REP 105](https://www.ros.org/reps/rep-0105.html) defines the frames and conventions required for navigation and the larger ROS ecosystem.
These conventions should be followed at all times to make use of the rich positioning, odometry, and SLAM projects available in the community.

In a nutshell, REP-105 says that you must, at minimum, build a TF tree that contains a full `map` -> `odom` -> `base_link` -> `[sensor frames]` for your robot.
TF2 is the time-variant transformation library in ROS 2 we use to represent and obtain time synchronized transformations.
It is the job of the global positioning system (GPS, SLAM, Motion Capture) to, at minimum, provide the `map` -> `odom` transformation.
It is then the role of the odometry system to provide the `odom` -> `base_link` transformation.
The remainder of the transformations relative to `base_link` should be static and defined in your [URDF](http://wiki.ros.org/urdf).

###### Global Positioning: Localization and SLAM

It is the job of the global positioning system (GPS, SLAM, Motion Capture) to, at minimum, provide the `map` -> `odom` transformation.
We provide `amcl` which is an Adaptive Monte-Carlo Localization technique based on a particle filter for localization in a static map.
We also provide SLAM Toolbox as the default SLAM algorithm for use to position and generate a static map.

These methods may also produce other output including position topics, maps, or other metadata, but they must provide that transformation to be valid.
Multiple positioning methods can be fused together using robot localization, discussed more below.

###### Odometry

It is the role of the odometry system to provide the `odom` -> `base_link` transformation.
Odometry can come from many sources including LIDAR, RADAR, wheel encoders, VIO, and IMUs.
The goal of the odometry is to provide a smooth and continuous local frame based on robot motion.
The global positioning system will update the transformation relative to the global frame to account for the odometric drift.

[Robot Localization](https://github.com/cra-ros-pkg/robot_localization/) is typically used for this fusion.
It will take in `N` sensors of various types and provide a continuous and smooth odometry to TF and to a topic.
A typical mobile robotics setup may have odometry from wheel encoders, IMUs, and vision fused in this manner.

The smooth output can be used then for dead-reckoning for precise motion and updating the position of the robot accurately between global position updates.

---

##### Environmental Representation

The environmental representation is the way the robot perceives its environment.
It also acts as the central localization for various algorithms and data sources to combine their information into a single space.
This space is then used by the controllers, planners, and recoveries to compute their tasks safely and efficiently.

###### Costmaps and Layers

The current environmental representation is a costmap.
A costmap is a regular 2D grid of cells containing a cost from unknown, free, occupied, or inflated cost.
This costmap is then searched to compute a global plan or sampled to compute local control efforts.

Various costmap layers are implemented as pluginlib plugins to buffer information into the costmap.
This includes information from LIDAR, RADAR, sonar, depth images, etc.
It may be wise to process sensor data before inputting it into the costmap layer, but that is up to the developer.

Costmap layers can be created to detect and track obstacles in the scene for collision avoidance using camera or depth sensors.
Additionally, layers can be created to algorithmically change the underlying costmap based on some rule or heuristic.
Finally, they may be used to buffer live data into the 2D or 3D world for binary obstacle marking.

###### Costmap Filters

Imagine, you’re annotating a map file (or any image file) in order to have a specific action occur based on the location in the annotated map. Examples of marking/annotating might be keep out zones to avoid planning inside, or have pixels belong to maximum speeds in marked areas. This annotated map is called “filter mask”. Just like a mask overlaid on a surface, it can or cannot be same size, pose and scale as a main map. The main goal of filter mask - is to provide the ability of marking areas on maps with some additional features or behavioral changes.

Costmap filters are a costmap layer-based approach of applying spatial-dependent behavioral changes, annotated in filter masks, into the Nav2 stack.
Costmap filters are implemented as costmap plugins.
These plugins are called “filters” as they are filtering a costmap by spatial annotations marked on filter masks.
In order to make a filtered costmap and change a robot’s behavior in annotated areas, the filter plugin reads the data coming from the filter mask.
This data is being linearly transformed into a feature map in a filter space.
Having this transformed feature map along with a map/costmap, any sensor data and current robot coordinate filters can update the underlying costmap and change the behavior of the robot depending on where it is.
For example, the following functionality could be made by use of costmap filters:

* Keep-out/safety zones where robots will never enter.
* Speed restriction areas. Maximum speed of robots going inside those areas will be limited.
* Preferred lanes for robots moving in industrial environments and warehouses.

###### Other Forms

Various other forms of environmental representations exist.
These include:

* gradient maps, which are similar to costmaps but represent surface gradients to check traversibility over
* 3D costmaps, which represent the space in 3D, but then also requires 3D planning and collision checking
* Mesh maps, which are similar to gradient maps but with surface meshes at many angles
* “Vector space”, taking in sensor information and using machine learning to detect individual items and locations to track rather than buffering discrete points.

---

##### Nav2 Academic Overview

---

## Configuration

### Configuration Guide

*Source: [https://docs.nav2.org/configuration/index.html](https://docs.nav2.org/configuration/index.html)*

#### Configuration Guide

This guide provides a process through which the user can adjust the tunable parameters to obtain
the best navigation performance.

##### Core Servers

* [Behavior Server](packages/configuring-behavior-server.html)
* [Behavior-Tree Navigator](packages/configuring-bt-navigator.html)
* [Behavior Tree XML Nodes](packages/configuring-bt-xml.html)
* [Collision Monitor](packages/configuring-collision-monitor.html)
* [Controller Server](packages/configuring-controller-server.html)
* [Costmap 2D](packages/configuring-costmaps.html)
* [Docking Server](packages/configuring-docking-server.html)
* [Lifecycle Manager](packages/configuring-lifecycle.html)
* [Map Server](packages/configuring-map-server.html)
* [Planner Server](packages/configuring-planner-server.html)
* [Route Server](packages/configuring-route-server.html)
* [Smoother Server](packages/configuring-smoother-server.html)
* [Velocity Smoother](packages/configuring-velocity-smoother.html)
* [Waypoint Follower](packages/configuring-waypoint-follower.html)

##### Planners Plugins

* [NavFn Planner](packages/configuring-navfn.html)
* [Smac Planner](packages/configuring-smac-planner.html)
* [Theta Star Planner](packages/configuring-thetastar.html)

##### Controller Plugins

* [DWB Controller](packages/configuring-dwb-controller.html)
* [Graceful Controller](packages/configuring-graceful-motion-controller.html)
* [Model Predictive Path Integral Controller](packages/configuring-mppic.html)
* [Regulated Pure Pursuit](packages/configuring-regulated-pp.html)
* [Rotation Shim Controller](packages/configuring-rotation-shim-controller.html)

##### Smoother Plugins

* [Constrained smoother](packages/configuring-constrained-smoother.html)
* [Savitzky-Golay Smoother](packages/configuring-savitzky-golay-smoother.html)
* [Simple Smoother](packages/configuring-simple-smoother.html)

##### Others

* [AMCL](packages/configuring-amcl.html)
* [Coverage Server](packages/configuring-coverage-server.html)
* [Following Server](packages/configuring-following-server.html)
* [Loopback Simulator](packages/configuring-loopback-sim.html)

---

### Packages

#### AMCL

*Source: [https://docs.nav2.org/configuration/packages/configuring-amcl.html](https://docs.nav2.org/configuration/packages/configuring-amcl.html)*

##### AMCL

Source code on [Github](https://github.com/ros-navigation/navigation2/tree/main/nav2_amcl).

AMCL implements the server for taking a static map and localizing the robot within it using an Adaptive Monte-Carlo Localizer.

###### Parameters

alpha1
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.2 |
```

```
Description
:   Expected process noise in odometry’s rotation estimate from rotation.
```

alpha2
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.2 |
```

```
Description
:   Expected process noise in odometry’s rotation estimate from translation.
```

alpha3
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.2 |
```

```
Description
:   Expected process noise in odometry’s translation estimate from translation.
```

alpha4
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.2 |
```

```
Description
:   Expected process noise in odometry’s translation estimate from rotation.
```

alpha5
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.2 |
```

```
Description
:   For Omni models only: translation noise.
```

base\_frame\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “base\_footprint” |
```

```
Description
:   Robot base frame.
```

beam\_skip\_distance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description
:   Ignore beams that most particles disagree with in Likelihood field model. Maximum distance to consider skipping for (m).
```

beam\_skip\_error\_threshold
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.9 |
```

```
Description
:   Percentage of beams after not matching map to force full update due to bad convergence.
```

beam\_skip\_threshold
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.3 |
```

```
Description
:   Percentage of beams required to skip.
```

do\_beamskip
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description
:   Whether to do beam skipping in Likelihood field model.
```

global\_frame\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “map” |
```

```
Description
:   The name of the coordinate frame published by the localization system.
```

lambda\_short
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
Description
:   Exponential decay parameter for z\_short part of model.
```

laser\_likelihood\_max\_dist
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description
:   Maximum distance to do obstacle inflation on map, for use in likelihood\_field model.
```

laser\_max\_range
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 100.0 |
```

```
Description
:   Maximum scan range to be considered, -1.0 will cause the laser’s reported maximum range to be used.
```

laser\_min\_range
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | -1.0 |
```

```
Description
:   Minimum scan range to be considered, -1.0 will cause the laser’s reported minimum range to be used.
```

laser\_model\_type
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “likelihood\_field” |
```

```
Description
:   Which model to use, either beam, likelihood\_field, or likelihood\_field\_prob. Same as likelihood\_field but incorporates the beamskip feature, if enabled.
```

set\_initial\_pose
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description
:   Causes AMCL to set initial pose from the initial\_pose\* parameters instead of waiting for the initial\_pose message.
```

initial\_pose
:   |  |  |
```
| --- | --- |
| Type | Default |
| Pose2D | {x: 0.0, y: 0.0, z: 0.0, yaw: 0.0} |
```

```
Description
:   X, Y, Z, and yaw coordinates of initial pose (meters and radians) of robot base frame in global frame.
```

max\_beams
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 60 |
```

```
Description
:   How many evenly-spaced beams in each scan to be used when updating the filter.
```

max\_particles
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 2000 |
```

```
Description
:   Maximum allowed number of particles.
```

min\_particles
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 500 |
```

```
Description
:   Minimum allowed number of particles.
```

odom\_frame\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “odom” |
```

```
Description
:   Which frame to use for odometry.
```

pf\_err
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.05 |
```

```
Description
:   Particle Filter population error.
```

pf\_z
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.99 |
```

```
Description
:   Particle filter population density. 2.33 is the 99% percentile.
```

random\_seed
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | -1 |
```

```
Description
:   Seed for the particle filter RNG.
```

```
    * `random_seed >= 0`: seed the RNG with the provided value (repeatable runs).
    * `random_seed < 0` (default): seed the RNG from time (preserves historical behavior).
```

recovery\_alpha\_fast
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Exponential decay rate for the fast average weight filter, used in deciding when to recover by adding random poses. A good value might be 0.1.
```

recovery\_alpha\_slow
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Exponential decay rate for the slow average weight filter, used in deciding when to recover by adding random poses. A good value might be 0.001.
```

resample\_interval
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1 |
```

```
Description
:   Number of filter updates required before resampling.
```

robot\_model\_type
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “nav2\_amcl::DifferentialMotionModel” |
```

```
Description
:   The fully-qualified type of the plugin class. Options are “nav2\_amcl::DifferentialMotionModel” and “nav2\_amcl::OmniMotionModel”. Users can also provide their own custom motion model plugin type.
```

```
Note for users of galactic and earlier
:   The models are selectable by string key (valid options: “differential”, “omnidirectional”) rather than plugins.
```

save\_pose\_rate
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description
:   Maximum rate (Hz) at which to store the last estimated pose and covariance to the parameter server, in the variables ~initial\_pose\_\* and ~initial\_cov\_\*. This saved pose will be used on subsequent runs to initialize the filter (-1.0 to disable).
```

sigma\_hit
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.2 |
```

```
Description
:   Standard deviation for Gaussian model used in z\_hit part of the model.
```

tf\_broadcast
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description
:   Set this to false to prevent amcl from publishing the transform between the global frame and the odometry frame.
```

transform\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   Time with which to post-date the transform that is published, to indicate that this transform is valid into the future.
```

introspection\_mode
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “disabled” |
```

```
Description
:   The introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.
```

update\_min\_a
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.2 |
```

```
Description
:   Rotational movement required before performing a filter update.
```

update\_min\_d
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
Description
:   Translational movement required before performing a filter update.
```

z\_hit
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description
:   Mixture weight for z\_hit part of model, sum of all used z weight must be 1. Beam uses all 4, likelihood model uses z\_hit and z\_rand..
```

z\_max
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.05 |
```

```
Description
:   Mixture weight for z\_max part of model, sum of all used z weight must be 1. Beam uses all 4, likelihood model uses z\_hit and z\_rand.
```

z\_rand
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description
:   Mixture weight for z\_rand part of model, sum of all used z weight must be 1. Beam uses all 4, likelihood model uses z\_hit and z\_rand..
```

z\_short
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.005 |
```

```
Description
:   Mixture weight for z\_short part of model, sum of all used z weight must be 1. Beam uses all 4, likelihood model uses z\_hit and z\_rand.
```

always\_reset\_initial\_pose
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description
:   Requires that AMCL is provided an initial pose either via topic or initial\_pose\* parameter (with parameter set\_initial\_pose: true) when reset. Otherwise, by default AMCL will use the last known pose to initialize.
```

scan\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | scan |
```

```
Description
:   Laser scan topic to subscribe to.
```

map\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | map |
```

```
Description
:   Map topic to subscribe to.
```

first\_map\_only
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description
:   Allows AMCL to accept maps more than once on the map\_topic. This is especially useful when you’re using the LoadMap service in map\_server. Prior to Humble, this is `first_map_only_`.
```

bond\_heartbeat\_period
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
Description
:   The lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.
```

allow\_parameter\_qos\_overrides
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to allow QoS profiles to be overwritten with parameterized values.
```

###### Example

```
amcl:
  ros__parameters:
    alpha1: 0.2
    alpha2: 0.2
    alpha3: 0.2
    alpha4: 0.2
    alpha5: 0.2
    base_frame_id: "base_footprint"
    introspection_mode: "disabled"
    beam_skip_distance: 0.5
    beam_skip_error_threshold: 0.9
    beam_skip_threshold: 0.3
    do_beamskip: false
    global_frame_id: "map"
    lambda_short: 0.1
    laser_likelihood_max_dist: 2.0
    laser_max_range: 100.0
    laser_min_range: -1.0
    laser_model_type: "likelihood_field"
    max_beams: 60
    max_particles: 2000
    min_particles: 500
    odom_frame_id: "odom"
    pf_err: 0.05
    pf_z: 0.99
    random_seed: -1
    recovery_alpha_fast: 0.0
    recovery_alpha_slow: 0.0
    resample_interval: 1
    robot_model_type: "nav2_amcl::DifferentialMotionModel"
    save_pose_rate: 0.5
    sigma_hit: 0.2
    tf_broadcast: true
    transform_tolerance: 1.0
    update_min_a: 0.2
    update_min_d: 0.25
    z_hit: 0.5
    z_max: 0.05
    z_rand: 0.5
    z_short: 0.05
    scan_topic: scan
    map_topic: map
    set_initial_pose: false
    always_reset_initial_pose: false
    first_map_only: false
    initial_pose:
      x: 0.0
      y: 0.0
      z: 0.0
      yaw: 0.0
```

#### Parameters

**`alpha1`**
- Type: `unknown`
- TypeDefaultdouble0.2DescriptionExpected process noise in odometry’s rotation estimate from rotation.

**`alpha2`**
- Type: `unknown`
- TypeDefaultdouble0.2DescriptionExpected process noise in odometry’s rotation estimate from translation.

**`alpha3`**
- Type: `unknown`
- TypeDefaultdouble0.2DescriptionExpected process noise in odometry’s translation estimate from translation.

**`alpha4`**
- Type: `unknown`
- TypeDefaultdouble0.2DescriptionExpected process noise in odometry’s translation estimate from rotation.

**`alpha5`**
- Type: `unknown`
- TypeDefaultdouble0.2DescriptionFor Omni models only: translation noise.

**`base_frame_id`**
- Type: `unknown`
- TypeDefaultstring“base_footprint”DescriptionRobot base frame.

**`beam_skip_distance`**
- Type: `unknown`
- TypeDefaultdouble0.5DescriptionIgnore beams that most particles disagree with in Likelihood field model. Maximum distance to consider skipping for (m).

**`beam_skip_error_threshold`**
- Type: `unknown`
- TypeDefaultdouble0.9DescriptionPercentage of beams after not matching map to force full update due to bad convergence.

**`beam_skip_threshold`**
- Type: `unknown`
- TypeDefaultdouble0.3DescriptionPercentage of beams required to skip.

**`do_beamskip`**
- Type: `unknown`
- TypeDefaultboolFalseDescriptionWhether to do beam skipping in Likelihood field model.

**`global_frame_id`**
- Type: `unknown`
- TypeDefaultstring“map”DescriptionThe name of the coordinate frame published by the localization system.

**`lambda_short`**
- Type: `unknown`
- TypeDefaultdouble0.1DescriptionExponential decay parameter for z_short part of model.

**`laser_likelihood_max_dist`**
- Type: `unknown`
- TypeDefaultdouble2.0DescriptionMaximum distance to do obstacle inflation on map, for use in likelihood_field model.

**`laser_max_range`**
- Type: `unknown`
- TypeDefaultdouble100.0DescriptionMaximum scan range to be considered, -1.0 will cause the laser’s reported maximum range to be used.

**`laser_min_range`**
- Type: `unknown`
- TypeDefaultdouble-1.0DescriptionMinimum scan range to be considered, -1.0 will cause the laser’s reported minimum range to be used.

**`laser_model_type`**
- Type: `unknown`
- TypeDefaultstring“likelihood_field”DescriptionWhich model to use, either beam, likelihood_field, or likelihood_field_prob. Same as likelihood_field but incorporates the beamskip feature, if enabled.

**`set_initial_pose`**
- Type: `unknown`
- TypeDefaultboolFalseDescriptionCauses AMCL to set initial pose from the initial_pose* parameters instead of waiting for the initial_pose message.

**`initial_pose`**
- Type: `unknown`
- TypeDefaultPose2D{x: 0.0, y: 0.0, z: 0.0, yaw: 0.0}DescriptionX, Y, Z, and yaw coordinates of initial pose (meters and radians) of robot base frame in global frame.

**`max_beams`**
- Type: `unknown`
- TypeDefaultint60DescriptionHow many evenly-spaced beams in each scan to be used when updating the filter.

**`max_particles`**
- Type: `unknown`
- TypeDefaultint2000DescriptionMaximum allowed number of particles.

**`min_particles`**
- Type: `unknown`
- TypeDefaultint500DescriptionMinimum allowed number of particles.

**`odom_frame_id`**
- Type: `unknown`
- TypeDefaultstring“odom”DescriptionWhich frame to use for odometry.

**`pf_err`**
- Type: `unknown`
- TypeDefaultdouble0.05DescriptionParticle Filter population error.

**`pf_z`**
- Type: `unknown`
- TypeDefaultdouble0.99DescriptionParticle filter population density. 2.33 is the 99% percentile.

**`random_seed`**
- Type: `unknown`
- TypeDefaultint-1DescriptionSeed for the particle filter RNG.random_seed>=0: seed the RNG with the provided value (repeatable runs).random_seed<0(default): seed the RNG from time (preserves historical behavior).

**`recovery_alpha_fast`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionExponential decay rate for the fast average weight filter, used in deciding when to recover by adding random poses. A good value might be 0.1.

**`recovery_alpha_slow`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionExponential decay rate for the slow average weight filter, used in deciding when to recover by adding random poses. A good value might be 0.001.

**`resample_interval`**
- Type: `unknown`
- TypeDefaultint1DescriptionNumber of filter updates required before resampling.

**`robot_model_type`**
- Type: `unknown`
- TypeDefaultstring“nav2_amcl::DifferentialMotionModel”DescriptionThe fully-qualified type of the plugin class. Options are “nav2_amcl::DifferentialMotionModel” and “nav2_amcl::OmniMotionModel”. Users can also provide their own custom motion model plugin type.Note for users of galactic and earlierThe models are selectable by string key (valid options: “differential”, “omnidirectional”) rather than plugins.

**`save_pose_rate`**
- Type: `unknown`
- TypeDefaultdouble0.5DescriptionMaximum rate (Hz) at which to store the last estimated pose and covariance to the parameter server, in the variables ~initial_pose_* and ~initial_cov_*. This saved pose will be used on subsequent runs to initialize the filter (-1.0 to disable).

**`sigma_hit`**
- Type: `unknown`
- TypeDefaultdouble0.2DescriptionStandard deviation for Gaussian model used in z_hit part of the model.

**`tf_broadcast`**
- Type: `unknown`
- TypeDefaultboolTrueDescriptionSet this to false to prevent amcl from publishing the transform between the global frame and the odometry frame.

**`transform_tolerance`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionTime with which to post-date the transform that is published, to indicate that this transform is valid into the future.

**`introspection_mode`**
- Type: `unknown`
- TypeDefaultstring“disabled”DescriptionThe introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.

**`update_min_a`**
- Type: `unknown`
- TypeDefaultdouble0.2DescriptionRotational movement required before performing a filter update.

**`update_min_d`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionTranslational movement required before performing a filter update.

**`z_hit`**
- Type: `unknown`
- TypeDefaultdouble0.5DescriptionMixture weight for z_hit part of model, sum of all used z weight must be 1. Beam uses all 4, likelihood model uses z_hit and z_rand..

**`z_max`**
- Type: `unknown`
- TypeDefaultdouble0.05DescriptionMixture weight for z_max part of model, sum of all used z weight must be 1. Beam uses all 4, likelihood model uses z_hit and z_rand.

**`z_rand`**
- Type: `unknown`
- TypeDefaultdouble0.5DescriptionMixture weight for z_rand part of model, sum of all used z weight must be 1. Beam uses all 4, likelihood model uses z_hit and z_rand..

**`z_short`**
- Type: `unknown`
- TypeDefaultdouble0.005DescriptionMixture weight for z_short part of model, sum of all used z weight must be 1. Beam uses all 4, likelihood model uses z_hit and z_rand.

**`always_reset_initial_pose`**
- Type: `unknown`
- TypeDefaultboolFalseDescriptionRequires that AMCL is provided an initial pose either via topic or initial_pose* parameter (with parameter set_initial_pose: true) when reset. Otherwise, by default AMCL will use the last known pose to initialize.

**`scan_topic`**
- Type: `unknown`
- TypeDefaultstringscanDescriptionLaser scan topic to subscribe to.

**`map_topic`**
- Type: `unknown`
- TypeDefaultstringmapDescriptionMap topic to subscribe to.

**`first_map_only`**
- Type: `unknown`
- TypeDefaultboolFalseDescriptionAllows AMCL to accept maps more than once on the map_topic. This is especially useful when you’re using theLoadMapservice inmap_server. Prior to Humble, this isfirst_map_only_.

**`bond_heartbeat_period`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionThe lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.

**`allow_parameter_qos_overrides`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to allow QoS profiles to be overwritten with parameterized values.

**`Description`**
- Type: `unknown`
- Expected process noise in odometry’s rotation estimate from rotation.

**`Description`**
- Type: `unknown`
- Expected process noise in odometry’s rotation estimate from translation.

**`Description`**
- Type: `unknown`
- Expected process noise in odometry’s translation estimate from translation.

**`Description`**
- Type: `unknown`
- Expected process noise in odometry’s translation estimate from rotation.

**`Description`**
- Type: `unknown`
- For Omni models only: translation noise.

**`Description`**
- Type: `unknown`
- Robot base frame.

**`Description`**
- Type: `unknown`
- Ignore beams that most particles disagree with in Likelihood field model. Maximum distance to consider skipping for (m).

**`Description`**
- Type: `unknown`
- Percentage of beams after not matching map to force full update due to bad convergence.

**`Description`**
- Type: `unknown`
- Percentage of beams required to skip.

**`Description`**
- Type: `unknown`
- Whether to do beam skipping in Likelihood field model.

**`Description`**
- Type: `unknown`
- The name of the coordinate frame published by the localization system.

**`Description`**
- Type: `unknown`
- Exponential decay parameter for z_short part of model.

**`Description`**
- Type: `unknown`
- Maximum distance to do obstacle inflation on map, for use in likelihood_field model.

**`Description`**
- Type: `unknown`
- Maximum scan range to be considered, -1.0 will cause the laser’s reported maximum range to be used.

**`Description`**
- Type: `unknown`
- Minimum scan range to be considered, -1.0 will cause the laser’s reported minimum range to be used.

**`Description`**
- Type: `unknown`
- Which model to use, either beam, likelihood_field, or likelihood_field_prob. Same as likelihood_field but incorporates the beamskip feature, if enabled.

**`Description`**
- Type: `unknown`
- Causes AMCL to set initial pose from the initial_pose* parameters instead of waiting for the initial_pose message.

**`Description`**
- Type: `unknown`
- X, Y, Z, and yaw coordinates of initial pose (meters and radians) of robot base frame in global frame.

**`Description`**
- Type: `unknown`
- How many evenly-spaced beams in each scan to be used when updating the filter.

**`Description`**
- Type: `unknown`
- Maximum allowed number of particles.

**`Description`**
- Type: `unknown`
- Minimum allowed number of particles.

**`Description`**
- Type: `unknown`
- Which frame to use for odometry.

**`Description`**
- Type: `unknown`
- Particle Filter population error.

**`Description`**
- Type: `unknown`
- Particle filter population density. 2.33 is the 99% percentile.

**`Description`**
- Type: `unknown`
- Seed for the particle filter RNG.random_seed>=0: seed the RNG with the provided value (repeatable runs).random_seed<0(default): seed the RNG from time (preserves historical behavior).

**`Description`**
- Type: `unknown`
- Exponential decay rate for the fast average weight filter, used in deciding when to recover by adding random poses. A good value might be 0.1.

**`Description`**
- Type: `unknown`
- Exponential decay rate for the slow average weight filter, used in deciding when to recover by adding random poses. A good value might be 0.001.

**`Description`**
- Type: `unknown`
- Number of filter updates required before resampling.

**`Description`**
- Type: `unknown`
- The fully-qualified type of the plugin class. Options are “nav2_amcl::DifferentialMotionModel” and “nav2_amcl::OmniMotionModel”. Users can also provide their own custom motion model plugin type.

**`Note for users of galactic and earlier`**
- Type: `unknown`
- The models are selectable by string key (valid options: “differential”, “omnidirectional”) rather than plugins.

**`Description`**
- Type: `unknown`
- Maximum rate (Hz) at which to store the last estimated pose and covariance to the parameter server, in the variables ~initial_pose_* and ~initial_cov_*. This saved pose will be used on subsequent runs to initialize the filter (-1.0 to disable).

**`Description`**
- Type: `unknown`
- Standard deviation for Gaussian model used in z_hit part of the model.

**`Description`**
- Type: `unknown`
- Set this to false to prevent amcl from publishing the transform between the global frame and the odometry frame.

**`Description`**
- Type: `unknown`
- Time with which to post-date the transform that is published, to indicate that this transform is valid into the future.

**`Description`**
- Type: `unknown`
- The introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.

**`Description`**
- Type: `unknown`
- Rotational movement required before performing a filter update.

**`Description`**
- Type: `unknown`
- Translational movement required before performing a filter update.

**`Description`**
- Type: `unknown`
- Mixture weight for z_hit part of model, sum of all used z weight must be 1. Beam uses all 4, likelihood model uses z_hit and z_rand..

**`Description`**
- Type: `unknown`
- Mixture weight for z_max part of model, sum of all used z weight must be 1. Beam uses all 4, likelihood model uses z_hit and z_rand.

**`Description`**
- Type: `unknown`
- Mixture weight for z_rand part of model, sum of all used z weight must be 1. Beam uses all 4, likelihood model uses z_hit and z_rand..

**`Description`**
- Type: `unknown`
- Mixture weight for z_short part of model, sum of all used z weight must be 1. Beam uses all 4, likelihood model uses z_hit and z_rand.

**`Description`**
- Type: `unknown`
- Requires that AMCL is provided an initial pose either via topic or initial_pose* parameter (with parameter set_initial_pose: true) when reset. Otherwise, by default AMCL will use the last known pose to initialize.

**`Description`**
- Type: `unknown`
- Laser scan topic to subscribe to.

**`Description`**
- Type: `unknown`
- Map topic to subscribe to.

**`Description`**
- Type: `unknown`
- Allows AMCL to accept maps more than once on the map_topic. This is especially useful when you’re using theLoadMapservice inmap_server. Prior to Humble, this isfirst_map_only_.

**`Description`**
- Type: `unknown`
- The lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.

**`Description`**
- Type: `unknown`
- Whether to allow QoS profiles to be overwritten with parameterized values.


---

#### Behavior Server

*Source: [https://docs.nav2.org/configuration/packages/configuring-behavior-server.html](https://docs.nav2.org/configuration/packages/configuring-behavior-server.html)*

##### Behavior Server

Source code on [Github](https://github.com/ros-navigation/navigation2/tree/main/nav2_behaviors).

The Behavior Server implements the server for handling various behavior, such as recoveries and docking, requests and hosting a vector of plugins implementing various C++ behaviors.
It is also possible to implement independent behavior servers for each custom behavior, but this server will allow multiple behaviors to share resources such as costmaps and TF buffers to lower incremental costs for new behaviors.

Note: the wait recovery behavior has no parameters, the duration to wait is given in the action request.
Note: pre-Rolling/Humble this was the Recovery server, not behavior server. Launch files, behaviors and tests were all renamed.

###### Behavior Server Parameters

local\_costmap\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “local\_costmap/costmap\_raw” |
```

```
Description
:   Raw costmap topic for collision checking on the local costmap.
```

global\_costmap\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “global\_costmap/costmap\_raw” |
```

```
Description
:   Raw costmap topic for collision checking on the global costmap.
```

local\_footprint\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “local\_costmap/published\_footprint” |
```

```
Description
:   Topic for footprint in the local costmap frame.
```

global\_footprint\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “global\_costmap/published\_footprint” |
```

```
Description
:   Topic for footprint in the global costmap frame.
```

cycle\_frequency
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10.0 |
```

```
Description
:   Frequency to run behavior plugins.
```

transform\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
Description
:   TF transform tolerance.
```

local\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “odom” |
```

```
Description
:   Local reference frame.
```

global\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “map” |
```

```
Description
:   Global reference frame.
```

robot\_base\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “base\_link” |
```

```
Description
:   Robot base frame.
```

introspection\_mode
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “disabled” |
```

```
Description
:   The introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.
```

behavior\_plugins
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | {“spin”, “back\_up”, “drive\_on\_heading”, “wait”} |
```

```
Description
:   List of plugin names to use, also matches action server names.
```

```
Note
:   Each plugin namespace defined in this list needs to have a `plugin` parameter defining the type of plugin to be loaded in the namespace.
```

```
    Example:
```

        ```
        behavior_server:
          ros__parameters:
            behavior_plugins: ["spin", "backup", "drive_on_heading", "wait"]
            spin:
              plugin: "nav2_behaviors::Spin" # In Iron and older versions, "/" was used instead of "::"
            backup:
              plugin: "nav2_behaviors::BackUp" # In Iron and older versions, "/" was used instead of "::"
            drive_on_heading:
              plugin: "nav2_behaviors::DriveOnHeading" # In Iron and older versions, "/" was used instead of "::"
            wait:
              plugin: "nav2_behaviors::Wait" # In Iron and older versions, "/" was used instead of "::"
        ```

###### Default Plugins

Note

In Iron and older versions, “/” was used instead of “::”.

When the `behavior_plugins` parameter is not overridden, the following default plugins are loaded:

> |  |  |
> | --- | --- |
> | Namespace | Plugin |
> | “spin” | “nav2\_behaviors::Spin” |
> | “backup” | “nav2\_behaviors::BackUp” |
> | “drive\_on\_heading” | “nav2\_behaviors::DriveOnHeading” |
> | “wait” | “nav2\_behaviors::Wait” |

###### Spin Behavior Parameters

Spin distance is given from the action request

simulate\_ahead\_time
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description
:   Time to look ahead for collisions (s).
```

max\_rotational\_vel
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   Maximum rotational velocity (rad/s).
```

min\_rotational\_vel
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.4 |
```

```
Description
:   Minimum rotational velocity (rad/s).
```

rotational\_acc\_lim
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 3.2 |
```

```
Description
:   maximum rotational acceleration (rad/s^2).
```

enable\_stamped\_cmd\_vel
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to use geometry\_msgs::msg::Twist or geometry\_msgs::msg::TwistStamped velocity data.
    True uses TwistStamped, false uses Twist.
    Note: This parameter is default `false` in Jazzy or older! Kilted or newer uses `TwistStamped` by default.
```

###### BackUp Behavior Parameters

Backup distance, speed and time\_allowance is given from the action request.

simulate\_ahead\_time
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description
:   Time to look ahead for collisions (s).
```

enable\_stamped\_cmd\_vel
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to use geometry\_msgs::msg::Twist or geometry\_msgs::msg::TwistStamped velocity data.
    True uses TwistStamped, false uses Twist.
    Note: This parameter is default `false` in Jazzy or older! Kilted or newer uses `TwistStamped` by default.
```

backup.acceleration\_limit
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.5 |
```

```
Description
:   Maximum acceleration limit (m/s^2). This parameter limits the rate at which speed increases when moving backward.
```

backup.deceleration\_limit
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | -2.5 |
```

```
Description
:   Maximum deceleration limit (m/s^2). Negative value. This parameter limits the rate at which speed decreases when moving backward.
```

backup.minimum\_speed
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.10 |
```

```
Description
:   Minimum speed to move, the deadband velocity of the robot behavior (m/s). Positive value.
```

###### DriveOnHeading Behavior Parameters

DriveOnHeading distance, speed and time\_allowance is given from the action request.

simulate\_ahead\_time
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description
:   Time to look ahead for collisions (s).
```

enable\_stamped\_cmd\_vel
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to use geometry\_msgs::msg::Twist or geometry\_msgs::msg::TwistStamped velocity data.
    True uses TwistStamped, false uses Twist.
    Note: This parameter is default `false` in Jazzy or older! Kilted or newer uses `TwistStamped` by default.
```

bond\_heartbeat\_period
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
Description
:   The lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.
```

allow\_parameter\_qos\_overrides
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to allow QoS profiles to be overwritten with parameterized values.
```

drive\_on\_heading.acceleration\_limit
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.5 |
```

```
Description
:   Maximum acceleration limit (m/s^2).
```

drive\_on\_heading.deceleration\_limit
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | -2.5 |
```

```
Description
:   Maximum deceleration limit (m/s^2). Negative value.
```

drive\_on\_heading.minimum\_speed
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.10 |
```

```
Description
:   Minimum speed to move, the deadband velocity of the robot behavior (m/s). Positive value.
```

###### AssistedTeleop Behavior Parameters

AssistedTeleop time\_allowance is given in the action request

projection\_time
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   Time to look ahead for collisions (s).
```

simulation\_time\_step
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
Description
:   Time step for projections (s).
```

cmd\_vel\_teleop
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | cmd\_vel\_teleop |
```

```
Description
:   Topic to listen for teleop messages.
```

enable\_stamped\_cmd\_vel
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to use geometry\_msgs::msg::Twist or geometry\_msgs::msg::TwistStamped velocity data.
    True uses TwistStamped, false uses Twist.
    Note: This parameter is default `false` in Jazzy or older! Kilted or newer uses `TwistStamped` by default.
```

###### Example

```
behavior_server:
  ros__parameters:
    local_costmap_topic: local_costmap/costmap_raw
    local_footprint_topic: local_costmap/published_footprint
    global_costmap_topic: global_costmap/costmap_raw
    global_footprint_topic: global_costmap/published_footprint
    cycle_frequency: 10.0
    behavior_plugins: ["spin", "backup", "drive_on_heading", "wait", "assisted_teleop"]
    spin:
      plugin: "nav2_behaviors::Spin" # In Iron and older versions, "/" was used instead of "::"
    backup:
      plugin: "nav2_behaviors::BackUp" # In Iron and older versions, "/" was used instead of "::"
    drive_on_heading:
      plugin: "nav2_behaviors::DriveOnHeading" # In Iron and older versions, "/" was used instead of "::"
    wait:
      plugin: "nav2_behaviors::Wait" # In Iron and older versions, "/" was used instead of "::"
    assisted_teleop:
      plugin: "nav2_behaviors::AssistedTeleop" # In Iron and older versions, "/" was used instead of "::"
    local_frame: odom
    global_frame: map
    robot_base_frame: base_link
    transform_tolerance: 0.1
    simulate_ahead_time: 2.0
    max_rotational_vel: 1.0
    min_rotational_vel: 0.4
    rotational_acc_lim: 3.2
    enable_stamped_cmd_vel: true  # default false in Jazzy or older
```

#### Parameters

**`local_costmap_topic`**
- Type: `unknown`
- TypeDefaultstring“local_costmap/costmap_raw”DescriptionRaw costmap topic for collision checking on the local costmap.

**`global_costmap_topic`**
- Type: `unknown`
- TypeDefaultstring“global_costmap/costmap_raw”DescriptionRaw costmap topic for collision checking on the global costmap.

**`local_footprint_topic`**
- Type: `unknown`
- TypeDefaultstring“local_costmap/published_footprint”DescriptionTopic for footprint in the local costmap frame.

**`global_footprint_topic`**
- Type: `unknown`
- TypeDefaultstring“global_costmap/published_footprint”DescriptionTopic for footprint in the global costmap frame.

**`cycle_frequency`**
- Type: `unknown`
- TypeDefaultdouble10.0DescriptionFrequency to run behavior plugins.

**`transform_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.1DescriptionTF transform tolerance.

**`local_frame`**
- Type: `unknown`
- TypeDefaultstring“odom”DescriptionLocal reference frame.

**`global_frame`**
- Type: `unknown`
- TypeDefaultstring“map”DescriptionGlobal reference frame.

**`robot_base_frame`**
- Type: `unknown`
- TypeDefaultstring“base_link”DescriptionRobot base frame.

**`introspection_mode`**
- Type: `unknown`
- TypeDefaultstring“disabled”DescriptionThe introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.

**`behavior_plugins`**
- Type: `unknown`
- TypeDefaultvector<string>{“spin”, “back_up”, “drive_on_heading”, “wait”}DescriptionList of plugin names to use, also matches action server names.NoteEach plugin namespace defined in this list needs to have apluginparameter defining the type of plugin to be loaded in the namespace.Example:behavior_server:ros__parameters:behavior_plugins:["spin","backup","drive_on_heading","wait"]spin:plugin:"nav2_behaviors::Spin"# In Iron and older versions, "/" was used instead of "::"backup:plugin:"nav2_behaviors::BackUp"# In Iron and older versions, "/" was used instead of "::"drive_on_heading:plugin:"nav2_behaviors::DriveOnHeading"# In Iron and older versions, "/" was used instead of "::"wait:plugin:"nav2_behaviors::Wait"# In Iron and older versions, "/" was used instead of "::"

**`Description`**
- Type: `unknown`
- Raw costmap topic for collision checking on the local costmap.

**`Description`**
- Type: `unknown`
- Raw costmap topic for collision checking on the global costmap.

**`Description`**
- Type: `unknown`
- Topic for footprint in the local costmap frame.

**`Description`**
- Type: `unknown`
- Topic for footprint in the global costmap frame.

**`Description`**
- Type: `unknown`
- Frequency to run behavior plugins.

**`Description`**
- Type: `unknown`
- TF transform tolerance.

**`Description`**
- Type: `unknown`
- Local reference frame.

**`Description`**
- Type: `unknown`
- Global reference frame.

**`Description`**
- Type: `unknown`
- Robot base frame.

**`Description`**
- Type: `unknown`
- The introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.

**`Description`**
- Type: `unknown`
- List of plugin names to use, also matches action server names.

**`Note`**
- Type: `unknown`
- Each plugin namespace defined in this list needs to have apluginparameter defining the type of plugin to be loaded in the namespace.Example:behavior_server:ros__parameters:behavior_plugins:["spin","backup","drive_on_heading","wait"]spin:plugin:"nav2_behaviors::Spin"# In Iron and older versions, "/" was used instead of "::"backup:plugin:"nav2_behaviors::BackUp"# In Iron and older versions, "/" was used instead of "::"drive_on_heading:plugin:"nav2_behaviors::DriveOnHeading"# In Iron and older versions, "/" was used instead of "::"wait:plugin:"nav2_behaviors::Wait"# In Iron and older versions, "/" was used instead of "::"

**`simulate_ahead_time`**
- Type: `unknown`
- TypeDefaultdouble2.0DescriptionTime to look ahead for collisions (s).

**`max_rotational_vel`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionMaximum rotational velocity (rad/s).

**`min_rotational_vel`**
- Type: `unknown`
- TypeDefaultdouble0.4DescriptionMinimum rotational velocity (rad/s).

**`rotational_acc_lim`**
- Type: `unknown`
- TypeDefaultdouble3.2Descriptionmaximum rotational acceleration (rad/s^2).

**`enable_stamped_cmd_vel`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to use geometry_msgs::msg::Twist or geometry_msgs::msg::TwistStamped velocity data.
True uses TwistStamped, false uses Twist.
Note: This parameter is defaultfalsein Jazzy or older! Kilted or newer usesTwistStampedby default.

**`Description`**
- Type: `unknown`
- Time to look ahead for collisions (s).

**`Description`**
- Type: `unknown`
- Maximum rotational velocity (rad/s).

**`Description`**
- Type: `unknown`
- Minimum rotational velocity (rad/s).

**`Description`**
- Type: `unknown`
- maximum rotational acceleration (rad/s^2).

**`Description`**
- Type: `unknown`
- Whether to use geometry_msgs::msg::Twist or geometry_msgs::msg::TwistStamped velocity data.
True uses TwistStamped, false uses Twist.
Note: This parameter is defaultfalsein Jazzy or older! Kilted or newer usesTwistStampedby default.

**`simulate_ahead_time`**
- Type: `unknown`
- TypeDefaultdouble2.0DescriptionTime to look ahead for collisions (s).

**`enable_stamped_cmd_vel`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to use geometry_msgs::msg::Twist or geometry_msgs::msg::TwistStamped velocity data.
True uses TwistStamped, false uses Twist.
Note: This parameter is defaultfalsein Jazzy or older! Kilted or newer usesTwistStampedby default.

**`backup.acceleration_limit`**
- Type: `unknown`
- TypeDefaultdouble2.5DescriptionMaximum acceleration limit (m/s^2). This parameter limits the rate at which speed increases when moving backward.

**`backup.deceleration_limit`**
- Type: `unknown`
- TypeDefaultdouble-2.5DescriptionMaximum deceleration limit (m/s^2). Negative value. This parameter limits the rate at which speed decreases when moving backward.

**`backup.minimum_speed`**
- Type: `unknown`
- TypeDefaultdouble0.10DescriptionMinimum speed to move, the deadband velocity of the robot behavior (m/s). Positive value.

**`Description`**
- Type: `unknown`
- Time to look ahead for collisions (s).

**`Description`**
- Type: `unknown`
- Whether to use geometry_msgs::msg::Twist or geometry_msgs::msg::TwistStamped velocity data.
True uses TwistStamped, false uses Twist.
Note: This parameter is defaultfalsein Jazzy or older! Kilted or newer usesTwistStampedby default.

**`Description`**
- Type: `unknown`
- Maximum acceleration limit (m/s^2). This parameter limits the rate at which speed increases when moving backward.

**`Description`**
- Type: `unknown`
- Maximum deceleration limit (m/s^2). Negative value. This parameter limits the rate at which speed decreases when moving backward.

**`Description`**
- Type: `unknown`
- Minimum speed to move, the deadband velocity of the robot behavior (m/s). Positive value.

**`simulate_ahead_time`**
- Type: `unknown`
- TypeDefaultdouble2.0DescriptionTime to look ahead for collisions (s).

**`enable_stamped_cmd_vel`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to use geometry_msgs::msg::Twist or geometry_msgs::msg::TwistStamped velocity data.
True uses TwistStamped, false uses Twist.
Note: This parameter is defaultfalsein Jazzy or older! Kilted or newer usesTwistStampedby default.

**`bond_heartbeat_period`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionThe lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.

**`allow_parameter_qos_overrides`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to allow QoS profiles to be overwritten with parameterized values.

**`drive_on_heading.acceleration_limit`**
- Type: `unknown`
- TypeDefaultdouble2.5DescriptionMaximum acceleration limit (m/s^2).

**`drive_on_heading.deceleration_limit`**
- Type: `unknown`
- TypeDefaultdouble-2.5DescriptionMaximum deceleration limit (m/s^2). Negative value.

**`drive_on_heading.minimum_speed`**
- Type: `unknown`
- TypeDefaultdouble0.10DescriptionMinimum speed to move, the deadband velocity of the robot behavior (m/s). Positive value.

**`Description`**
- Type: `unknown`
- Time to look ahead for collisions (s).

**`Description`**
- Type: `unknown`
- Whether to use geometry_msgs::msg::Twist or geometry_msgs::msg::TwistStamped velocity data.
True uses TwistStamped, false uses Twist.
Note: This parameter is defaultfalsein Jazzy or older! Kilted or newer usesTwistStampedby default.

**`Description`**
- Type: `unknown`
- The lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.

**`Description`**
- Type: `unknown`
- Whether to allow QoS profiles to be overwritten with parameterized values.

**`Description`**
- Type: `unknown`
- Maximum acceleration limit (m/s^2).

**`Description`**
- Type: `unknown`
- Maximum deceleration limit (m/s^2). Negative value.

**`Description`**
- Type: `unknown`
- Minimum speed to move, the deadband velocity of the robot behavior (m/s). Positive value.

**`projection_time`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionTime to look ahead for collisions (s).

**`simulation_time_step`**
- Type: `unknown`
- TypeDefaultdouble0.1DescriptionTime step for projections (s).

**`cmd_vel_teleop`**
- Type: `unknown`
- TypeDefaultstringcmd_vel_teleopDescriptionTopic to listen for teleop messages.

**`enable_stamped_cmd_vel`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to use geometry_msgs::msg::Twist or geometry_msgs::msg::TwistStamped velocity data.
True uses TwistStamped, false uses Twist.
Note: This parameter is defaultfalsein Jazzy or older! Kilted or newer usesTwistStampedby default.

**`Description`**
- Type: `unknown`
- Time to look ahead for collisions (s).

**`Description`**
- Type: `unknown`
- Time step for projections (s).

**`Description`**
- Type: `unknown`
- Topic to listen for teleop messages.

**`Description`**
- Type: `unknown`
- Whether to use geometry_msgs::msg::Twist or geometry_msgs::msg::TwistStamped velocity data.
True uses TwistStamped, false uses Twist.
Note: This parameter is defaultfalsein Jazzy or older! Kilted or newer usesTwistStampedby default.

**`“spin”`**
- Type: `unknown`
- 

**`“backup”`**
- Type: `unknown`
- 

**`“drive_on_heading”`**
- Type: `unknown`
- 

**`“wait”`**
- Type: `unknown`
- 


---

#### Behavior Tree XML Nodes

*Source: [https://docs.nav2.org/configuration/packages/configuring-bt-xml.html](https://docs.nav2.org/configuration/packages/configuring-bt-xml.html)*

##### Behavior Tree XML Nodes

The [nav2\_behavior\_tree](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree) package provides several navigation-specific nodes that are pre-registered and can be included in Behavior Trees.

Check this [introduction](https://www.behaviortree.dev/docs/learn-the-basics/BT_basics) to learn how behavior trees work and the difference between actions, conditions, controls and decorators.

Consider checking out the [Groot Tutorials](../../tutorials/docs/using_groot.html#using-groot) tutorial for using Groot to visualize and modify behavior trees.

###### Action Plugins

* [Wait](bt-plugins/actions/Wait.html)
* [Spin](bt-plugins/actions/Spin.html)
* [BackUp](bt-plugins/actions/BackUp.html)
* [DriveOnHeading](bt-plugins/actions/DriveOnHeading.html)
* [AssistedTeleop](bt-plugins/actions/AssistedTeleop.html)
* [ComputePathToPose](bt-plugins/actions/ComputePathToPose.html)
* [ComputeRoute](bt-plugins/actions/ComputeRoute.html)
* [ComputeAndTrackRoute](bt-plugins/actions/ComputeAndTrackRoute.html)
* [FollowPath](bt-plugins/actions/FollowPath.html)
* [NavigateToPose](bt-plugins/actions/NavigateToPose.html)
* [ClearEntireCostmap](bt-plugins/actions/ClearEntireCostmap.html)
* [ClearCostmapExceptRegion](bt-plugins/actions/ClearCostmapExceptRegion.html)
* [ClearCostmapAroundRobot](bt-plugins/actions/ClearCostmapAroundRobot.html)
* [ClearCostmapAroundPose](bt-plugins/actions/ClearCostmapAroundPose.html)
* [ReinitializeGlobalLocalization](bt-plugins/actions/ReinitializeGlobalLocalization.html)
* [TruncatePath](bt-plugins/actions/TruncatePath.html)
* [TruncatePathLocal](bt-plugins/actions/TruncatePathLocal.html)
* [PlannerSelector](bt-plugins/actions/PlannerSelector.html)
* [ControllerSelector](bt-plugins/actions/ControllerSelector.html)
* [SmootherSelector](bt-plugins/actions/SmootherSelector.html)
* [GoalCheckerSelector](bt-plugins/actions/GoalCheckerSelector.html)
* [ProgressCheckerSelector](bt-plugins/actions/ProgressCheckerSelector.html)
* [PathHandlerSelector](bt-plugins/actions/PathHandlerSelector.html)
* [NavigateThroughPoses](bt-plugins/actions/NavigateThroughPoses.html)
* [ComputePathThroughPoses](bt-plugins/actions/ComputePathThroughPoses.html)
* [ComputeCoveragePath](bt-plugins/actions/ComputeCoveragePath.html)
* [CancelCoverage](bt-plugins/actions/CancelCoverage.html)
* [RemovePassedGoals](bt-plugins/actions/RemovePassedGoals.html)
* [RemoveInCollisionGoals](bt-plugins/actions/RemoveInCollisionGoals.html)
* [CancelControl](bt-plugins/actions/CancelControl.html)
* [CancelBackUp](bt-plugins/actions/CancelBackUp.html)
* [CancelSpin](bt-plugins/actions/CancelSpin.html)
* [CancelWait](bt-plugins/actions/CancelWait.html)
* [CancelDriveOnHeading](bt-plugins/actions/CancelDriveOnHeading.html)
* [CancelAssistedTeleop](bt-plugins/actions/CancelAssistedTeleop.html)
* [CancelComputeAndTrackRoute](bt-plugins/actions/CancelComputeAndTrackRoute.html)
* [SmoothPath](bt-plugins/actions/Smooth.html)
* [GetPoseFromPath](bt-plugins/actions/GetPoseFromPath.html)
* [DockRobot](bt-plugins/actions/DockRobot.html)
* [UndockRobot](bt-plugins/actions/UndockRobot.html)
* [ConcatenatePaths](bt-plugins/actions/ConcatenatePaths.html)
* [GetCurrentPose](bt-plugins/actions/GetCurrentPose.html)
* [AppendGoalPoseToGoals](bt-plugins/actions/AppendGoalPoseToGoals.html)
* [ExtractRouteNodesAsGoals](bt-plugins/actions/ExtractRouteNodesAsGoals.html)
* [GetNextFewGoals](bt-plugins/actions/GetNextFewGoals.html)
* [ToggleCollisionMonitor](bt-plugins/actions/ToggleCollisionMonitor.html)
* [FollowObject](bt-plugins/actions/FollowObject.html)
* [CancelFollowObject](bt-plugins/actions/CancelFollowObject.html)

###### Condition Plugins

* [GoalReached](bt-plugins/conditions/GoalReached.html)
* [TransformAvailable](bt-plugins/conditions/TransformAvailable.html)
* [DistanceTraveled](bt-plugins/conditions/DistanceTraveled.html)
* [GoalUpdated](bt-plugins/conditions/GoalUpdated.html)
* [GlobalUpdatedGoal](bt-plugins/conditions/GlobalUpdatedGoal.html)
* [InitialPoseReceived](bt-plugins/conditions/InitialPoseReceived.html)
* [IsGoalNearby](bt-plugins/conditions/IsGoalNearby.html)
* [IsStuck](bt-plugins/conditions/IsStuck.html)
* [IsStopped](bt-plugins/conditions/IsStopped.html)
* [TimeExpired](bt-plugins/conditions/TimeExpired.html)
* [IsBatteryLow](bt-plugins/conditions/IsBatteryLow.html)
* [IsPathValid](bt-plugins/conditions/IsPathValid.html)
* [IsPoseOccupied](bt-plugins/conditions/IsPoseOccupied.html)
* [PathExpiringTimer](bt-plugins/conditions/PathExpiringTimer.html)
* [AreErrorCodesPresent](bt-plugins/conditions/AreErrorCodesPresent.html)
* [WouldAControllerRecoveryHelp](bt-plugins/conditions/WouldAControllerRecoveryHelp.html)
* [WouldAPlannerRecoveryHelp](bt-plugins/conditions/WouldAPlannerRecoveryHelp.html)
* [WouldASmootherRecoveryHelp](bt-plugins/conditions/WouldASmootherRecoveryHelp.html)
* [WouldARouteRecoveryHelp](bt-plugins/conditions/WouldARouteRecoveryHelp.html)
* [IsBatteryCharging](bt-plugins/conditions/IsBatteryCharging.html)
* [ArePosesNear](bt-plugins/conditions/ArePosesNear.html)

###### Control Plugins

* [PipelineSequence](bt-plugins/controls/PipelineSequence.html)
* [RoundRobin](bt-plugins/controls/RoundRobin.html)
* [RecoveryNode](bt-plugins/controls/RecoveryNode.html)
* [NonblockingSequence](bt-plugins/controls/NonblockingSequence.html)
* [PersistentSequence](bt-plugins/controls/PersistentSequence.html)
* [PauseResumeController](bt-plugins/controls/PauseResumeController.html)

###### Decorator Plugins

* [RateController](bt-plugins/decorators/RateController.html)
* [DistanceController](bt-plugins/decorators/DistanceController.html)
* [SpeedController](bt-plugins/decorators/SpeedController.html)
* [GoalUpdater](bt-plugins/decorators/GoalUpdater.html)
* [PathLongerOnApproach](bt-plugins/decorators/PathLongerOnApproach.html)
* [SingleTrigger](bt-plugins/decorators/SingleTrigger.html)
* [GoalUpdatedController](bt-plugins/decorators/GoalUpdatedController.html)

###### Example

This Behavior Tree replans the global path periodically at 1 Hz and it also has
recovery actions.

```
<root main_tree_to_execute="MainTree">
  <BehaviorTree ID="MainTree">
    <RecoveryNode number_of_retries="6" name="NavigateRecovery">
      <PipelineSequence name="NavigateWithReplanning">
        <RateController hz="1.0">
          <RecoveryNode number_of_retries="1" name="ComputePathToPose">
            <ComputePathToPose goal="{goal}" path="{path}" planner_id="GridBased"/>
            <ReactiveFallback name="ComputePathToPoseRecoveryFallback">
              <GoalUpdated/>
              <ClearEntireCostmap name="ClearGlobalCostmap-Context" service_name="global_costmap/clear_entirely_global_costmap"/>
            </ReactiveFallback>
          </RecoveryNode>
        </RateController>
        <RecoveryNode number_of_retries="1" name="FollowPath">
          <FollowPath path="{path}" controller_id="FollowPath"/>
          <ReactiveFallback name="FollowPathRecoveryFallback">
            <GoalUpdated/>
            <ClearEntireCostmap name="ClearLocalCostmap-Context" service_name="local_costmap/clear_entirely_local_costmap"/>
          </ReactiveFallback>
        </RecoveryNode>
      </PipelineSequence>
      <ReactiveFallback name="RecoveryFallback">
        <GoalUpdated/>
        <RoundRobin name="RecoveryActions">
          <Sequence name="ClearingActions">
            <ClearEntireCostmap name="ClearLocalCostmap-Subtree" service_name="local_costmap/clear_entirely_local_costmap"/>
            <ClearEntireCostmap name="ClearGlobalCostmap-Subtree" service_name="global_costmap/clear_entirely_global_costmap"/>
          </Sequence>
          <Spin spin_dist="1.57"/>
          <Wait wait_duration="5"/>
          <BackUp backup_dist="0.15" backup_speed="0.025"/>
        </RoundRobin>
      </ReactiveFallback>
    </RecoveryNode>
  </BehaviorTree>
</root>
```

---

#### Behavior-Tree Navigator

*Source: [https://docs.nav2.org/configuration/packages/configuring-bt-navigator.html](https://docs.nav2.org/configuration/packages/configuring-bt-navigator.html)*

##### Behavior-Tree Navigator

Source code on [Github](https://github.com/ros-navigation/navigation2/tree/main/nav2_bt_navigator).

The BT Navigator (Behavior Tree Navigator) module implements the NavigateToPose, NavigateThroughPoses, and other task interfaces.
It is a Behavior Tree-based implementation of navigation that is intended to allow for flexibility
in the navigation task and provide a way to easily specify complex robot behaviors, including recovery.

Consider checking out the [Groot Tutorials](../../tutorials/docs/using_groot.html#using-groot) tutorial for using Groot to visualize and modify behavior trees.

Make sure to review all parameters for non-default navigator plugins not discussed on this page (e.g. `CoverageNavigator` or custom additions).

###### Parameters

navigators
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | {‘navigate\_to\_pose’, ‘navigate\_through\_poses’} |
```

```
Description
:   New to Iron: Plugins for navigator types implementing the `nav2_core::BehaviorTreeNavigator` interface.
    They implement custom action servers with custom interface definitions and use that data to populate and process behavior tree navigation requests. Plugin classes are defined under the same namespace, see examples below. Defaults correspond to the `NavigateToPoseNavigator` and `NavigateThroughPosesNavigator` navigators.
```

default\_nav\_to\_pose\_bt\_xml
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Path to the default behavior tree XML description for `NavigateToPose`, see [Behavior Tree XML Nodes](configuring-bt-xml.html#configuring-behavior-tree-xml) for details on this file.
    This parameter used to be `default_bt_xml_filename` pre-Galactic.
    You can use substitution to specify file path like `$(find-pkg-share my_package)/behavior_tree/my_nav_to_pose_bt.xml`. However, if left empty, the default behavior tree XML will be loaded from the `nav2_bt_navigator` package.
```

default\_nav\_through\_poses\_bt\_xml
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Path to the default behavior tree XML description for `NavigateThroughPoses`, see [Behavior Tree XML Nodes](configuring-bt-xml.html#configuring-behavior-tree-xml) for details on this file. New to Galactic after `NavigateThroughPoses` was added.
    You can use substitution to specify file path like `$(find-pkg-share my_package)/behavior_tree/my_nav_through_poses_bt.xml`. However, if left empty, the default behavior tree XML will be loaded from the `nav2_bt_navigator` package.
```

always\_reload\_bt\_xml
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Always load the requested behavior tree XML description, regardless of the name of the currently active XML.
```

plugin\_lib\_names
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | [“”] |
```

```
Description
:   List of behavior tree node shared libraries. All Nav2 BT libraries are automatically included for you, so this only needs to include your new custom plugins (new to Jazzy).
```

bt\_loop\_duration
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 10 |
```

```
Description
:   Duration (in milliseconds) for each iteration of BT execution.
```

filter\_duration
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.3 |
```

```
Description
:   Duration (secs) over which robot velocity should be smoothed.
```

default\_server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 20 |
```

```
Description
:   Default timeout value (in milliseconds) while a BT action node is waiting for acknowledgement from an action server.
    This value will be overwritten for a BT node if the input port “server\_timeout” is provided.
```

default\_cancel\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 50 |
```

```
Description
:   Default timeout (in seconds) for BT action node cancellation requests during node halt.
    This value will be overwritten for a BT node if the input port “cancel\_timeout” is provided.
```

wait\_for\_service\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1000 |
```

```
Description
:   Default timeout value (in milliseconds) while Action or Service BT nodes will waiting for acknowledgement from an service or action server on BT initialization (e.g. `wait_for_action_server(timeout)`).
    This value will be overwritten for a BT node if the input port “wait\_for\_service\_timeout” is provided.
```

introspection\_mode
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “disabled” |
```

```
Description
:   The introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.
```

transform\_tolerance
:   |  |  |  |
```
| --- | --- | --- |
| Type | Default | Unit |
| double | 0.1 | seconds |
```

```
Description
:   TF transform tolerance.
```

global\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | map |
```

```
Description
:   Reference frame.
```

robot\_base\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | base\_link |
```

```
Description
:   Robot base frame.
```

odom\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | odom |
```

```
Description
:   Topic on which odometry is published
```

error\_code\_name\_prefixes
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | [“assisted\_teleop”,  “backup”, “compute\_path”, “dock\_robot”, “drive\_on\_heading”, “follow\_path”, “nav\_thru\_poses”, “nav\_to\_pose”, “spin”, “route”, “undock\_robot”, “wait”] |
```

```
Description
:   For Kilted and newer: List of of error code name prefixes to be appended with ‘\_error\_code’ and ‘\_error\_msg’ and searched for during aborted navigator error processing.
```

error\_code\_names
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | [“compute\_path\_error\_code”,  “follow\_path\_error\_code”] |
```

```
Description
:   For Jazzy and older: List of of error codes to compare.
```

bond\_heartbeat\_period
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
Description
:   The lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.
```

allow\_parameter\_qos\_overrides
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to allow QoS profiles to be overwritten with parameterized values.
```

bt\_search\_directories
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | $(find-pkg-share nav2\_bt\_navigator)/behavior\_trees |
```

```
Description
:   List of directories that hosts behavior trees XML files. It is needed to register all behavior trees as well as subtrees.
```

###### NavigateToPose Parameters

`<navigate_to_pose_name>`.goal\_blackboard\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “goal” |
```

```
Description
:   Blackboard variable to use to supply the goal to the behavior tree for `NavigateToPose`. Should match ports of BT XML file.
```

`<navigate_to_pose_name>`.path\_blackboard\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “path” |
```

```
Description
:   Blackboard variable to get the path from the behavior tree for `NavigateToPose` feedback. Should match port names of BT XML file.
```

`<navigate_to_pose_name>`.tracking\_feedback\_blackboard\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “tracking\_feedback” |
```

```
Description
:   Blackboard variable to get the tracking feedback from the behavior tree for `NavigateToPose` feedback. Should match port names of BT XML file.
```

`<navigate_to_pose_name>`.enable\_groot\_monitoring
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description
:   Whether to enable Groot2 monitoring for this navigator.
```

`<navigate_to_pose_name>`.groot\_server\_port
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1667 |
```

```
Description
:   The port number for the Groot2 server. Note: In Groot2, you only need to specify the server port value, not the publisher port, as it is always the server port +1. Therefore, in this case, to use another navigator, the next available port would be 1669.
```

`<navigate_to_pose_name>`.search\_window
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description
:   How far (in meters) along the path the searching algorithm will look for the closest point.
```

###### NavigateThroughPoses Parameters

`<navigate_through_poses>`.goals\_blackboard\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “goals” |
```

```
Description
:   Blackboard variable to use to supply the goals to the behavior tree for `NavigateThroughPoses`. Should match ports of BT XML file.
```

`<navigate_through_poses>`.path\_blackboard\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “path” |
```

```
Description
:   Blackboard variable to get the path from the behavior tree for `NavigateThroughPoses` feedback. Should match port names of BT XML file.
```

`<navigate_through_poses>`.tracking\_feedback\_blackboard\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “tracking\_feedback” |
```

```
Description
:   Blackboard variable to get the tracking feedback from the behavior tree for `NavigateThroughPoses` feedback. Should match port names of BT XML file.
```

`<navigate_through_poses>`.waypoint\_statuses\_blackboard\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “waypoint\_statuses” |
```

```
Description
:   Blackboard variable to get the statuses of waypoints from the behavior tree for `NavigateThroughPoses` feedback/result. Should match ports of BT XML file.
```

`<navigate_through_poses>`.enable\_groot\_monitoring
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description
:   Whether to enable Groot2 monitoring for this navigator.
```

`<navigate_through_poses>`.groot\_server\_port
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1669 |
```

```
Description
:   The port number for the Groot2 server. Note: In Groot2, you only need to specify the server port value, not the publisher port, as it is always the server port +1. Therefore, in this case, to use another navigator, the next available port would be 1671.
```

`<navigate_through_poses>`.search\_window
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description
:   How far (in meters) along the path the searching algorithm will look for the closest point.
```

###### Example

```
bt_navigator:
  ros__parameters:
    global_frame: map
    robot_base_frame: base_link
    transform_tolerance: 0.1
    filter_duration: 0.3
    default_server_timeout: 20
    default_cancel_timeout: 50
    introspection_mode: "disabled"
    default_nav_to_pose_bt_xml: replace/with/path/to/bt.xml # or $(find-pkg-share my_package)/behavior_tree/my_nav_to_pose_bt.xml
    default_nav_through_poses_bt_xml: replace/with/path/to/bt.xml # or $(find-pkg-share my_package)/behavior_tree/my_nav_through_poses_bt.xml
    always_reload_bt_xml: false
    goal_blackboard_id: goal
    goals_blackboard_id: goals
    path_blackboard_id: path
    waypoint_statuses_blackboard_id: waypoint_statuses
    navigators: ['navigate_to_pose', 'navigate_through_poses']
    bt_search_directories:
      - $(find-pkg-share nav2_bt_navigator)/behavior_trees
    navigate_to_pose:
      plugin: "nav2_bt_navigator::NavigateToPoseNavigator" # In Iron and older versions, "/" was used instead of "::"
      enable_groot_monitoring: false
      groot_server_port: 1667
      search_window: 2.0
    navigate_through_poses:
      plugin: "nav2_bt_navigator::NavigateThroughPosesNavigator" # In Iron and older versions, "/" was used instead of "::"
      enable_groot_monitoring: false
      groot_server_port: 1669
      search_window: 2.0
    plugin_lib_names:
      - nav2_compute_path_to_pose_action_bt_node
      - nav2_follow_path_action_bt_node
      - nav2_back_up_action_bt_node
      - nav2_spin_action_bt_node
      - nav2_wait_action_bt_node
      - nav2_clear_costmap_service_bt_node
      - nav2_is_stuck_condition_bt_node
      - nav2_is_stopped_condition_bt_node
      - nav2_goal_reached_condition_bt_node
      - nav2_initial_pose_received_condition_bt_node
      - nav2_goal_updated_condition_bt_node
      - nav2_reinitialize_global_localization_service_bt_node
      - nav2_rate_controller_bt_node
      - nav2_distance_controller_bt_node
      - nav2_speed_controller_bt_node
      - nav2_recovery_node_bt_node
      - nav2_pipeline_sequence_bt_node
      - nav2_persistent_sequence_bt_node
      - nav2_pause_resume_controller_bt_node
      - nav2_round_robin_node_bt_node
      - nav2_transform_available_condition_bt_node
      - nav2_time_expired_condition_bt_node
      - nav2_distance_traveled_condition_bt_node
      - nav2_single_trigger_bt_node
    error_code_name_prefixes:
      - assisted_teleop
      - backup
      - compute_path
      - dock_robot
      - drive_on_heading
      - follow_path
      - nav_thru_poses
      - nav_to_pose
      - spin
      - route
      - undock_robot
      - wait
```

#### Parameters

**`navigators`**
- Type: `unknown`
- TypeDefaultvector<string>{‘navigate_to_pose’, ‘navigate_through_poses’}DescriptionNew to Iron: Plugins for navigator types implementing thenav2_core::BehaviorTreeNavigatorinterface.
They implement custom action servers with custom interface definitions and use that data to populate and process behavior tree navigation requests. Plugin classes are defined under the same namespace, see examples below. Defaults correspond to theNavigateToPoseNavigatorandNavigateThroughPosesNavigatornavigators.

**`default_nav_to_pose_bt_xml`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionPath to the default behavior tree XML description forNavigateToPose, seeBehavior Tree XML Nodesfor details on this file.
This parameter used to bedefault_bt_xml_filenamepre-Galactic.
You can use substitution to specify file path like$(find-pkg-sharemy_package)/behavior_tree/my_nav_to_pose_bt.xml. However, if left empty, the default behavior tree XML will be loaded from thenav2_bt_navigatorpackage.

**`default_nav_through_poses_bt_xml`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionPath to the default behavior tree XML description forNavigateThroughPoses, seeBehavior Tree XML Nodesfor details on this file. New to Galactic afterNavigateThroughPoseswas added.
You can use substitution to specify file path like$(find-pkg-sharemy_package)/behavior_tree/my_nav_through_poses_bt.xml. However, if left empty, the default behavior tree XML will be loaded from thenav2_bt_navigatorpackage.

**`always_reload_bt_xml`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionAlways load the requested behavior tree XML description, regardless of the name of the currently active XML.

**`plugin_lib_names`**
- Type: `unknown`
- TypeDefaultvector<string>[“”]DescriptionList of behavior tree node shared libraries. All Nav2 BT libraries are automatically included for you, so this only needs to include your new custom plugins (new to Jazzy).

**`bt_loop_duration`**
- Type: `unknown`
- TypeDefaultint10DescriptionDuration (in milliseconds) for each iteration of BT execution.

**`filter_duration`**
- Type: `unknown`
- TypeDefaultdouble0.3DescriptionDuration (secs) over which robot velocity should be smoothed.

**`default_server_timeout`**
- Type: `unknown`
- TypeDefaultint20DescriptionDefault timeout value (in milliseconds) while a BT action node is waiting for acknowledgement from an action server.
This value will be overwritten for a BT node if the input port “server_timeout” is provided.

**`default_cancel_timeout`**
- Type: `unknown`
- TypeDefaultint50DescriptionDefault timeout (in seconds) for BT action node cancellation requests during node halt.
This value will be overwritten for a BT node if the input port “cancel_timeout” is provided.

**`wait_for_service_timeout`**
- Type: `unknown`
- TypeDefaultint1000DescriptionDefault timeout value (in milliseconds) while Action or Service BT nodes will waiting for acknowledgement from an service or action server on BT initialization (e.g.wait_for_action_server(timeout)).
This value will be overwritten for a BT node if the input port “wait_for_service_timeout” is provided.

**`introspection_mode`**
- Type: `unknown`
- TypeDefaultstring“disabled”DescriptionThe introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.

**`transform_tolerance`**
- Type: `unknown`
- TypeDefaultUnitdouble0.1secondsDescriptionTF transform tolerance.

**`global_frame`**
- Type: `unknown`
- TypeDefaultstringmapDescriptionReference frame.

**`robot_base_frame`**
- Type: `unknown`
- TypeDefaultstringbase_linkDescriptionRobot base frame.

**`odom_topic`**
- Type: `unknown`
- TypeDefaultstringodomDescriptionTopic on which odometry is published

**`error_code_name_prefixes`**
- Type: `unknown`
- TypeDefaultvector<string>[“assisted_teleop”,“backup”,
“compute_path”,
“dock_robot”,
“drive_on_heading”,
“follow_path”,
“nav_thru_poses”,
“nav_to_pose”,
“spin”,
“route”,
“undock_robot”,
“wait”]DescriptionFor Kilted and newer: List of of error code name prefixes to be appended with ‘_error_code’ and ‘_error_msg’ and searched for during aborted navigator error processing.

**`error_code_names`**
- Type: `unknown`
- TypeDefaultvector<string>[“compute_path_error_code”,“follow_path_error_code”]DescriptionFor Jazzy and older: List of of error codes to compare.

**`bond_heartbeat_period`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionThe lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.

**`allow_parameter_qos_overrides`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to allow QoS profiles to be overwritten with parameterized values.

**`bt_search_directories`**
- Type: `unknown`
- TypeDefaultvector<string>$(find-pkg-share nav2_bt_navigator)/behavior_treesDescriptionList of directories that hosts behavior trees XML files. It is needed to register all behavior trees as well as subtrees.

**`Description`**
- Type: `unknown`
- New to Iron: Plugins for navigator types implementing thenav2_core::BehaviorTreeNavigatorinterface.
They implement custom action servers with custom interface definitions and use that data to populate and process behavior tree navigation requests. Plugin classes are defined under the same namespace, see examples below. Defaults correspond to theNavigateToPoseNavigatorandNavigateThroughPosesNavigatornavigators.

**`Description`**
- Type: `unknown`
- Path to the default behavior tree XML description forNavigateToPose, seeBehavior Tree XML Nodesfor details on this file.
This parameter used to bedefault_bt_xml_filenamepre-Galactic.
You can use substitution to specify file path like$(find-pkg-sharemy_package)/behavior_tree/my_nav_to_pose_bt.xml. However, if left empty, the default behavior tree XML will be loaded from thenav2_bt_navigatorpackage.

**`Description`**
- Type: `unknown`
- Path to the default behavior tree XML description forNavigateThroughPoses, seeBehavior Tree XML Nodesfor details on this file. New to Galactic afterNavigateThroughPoseswas added.
You can use substitution to specify file path like$(find-pkg-sharemy_package)/behavior_tree/my_nav_through_poses_bt.xml. However, if left empty, the default behavior tree XML will be loaded from thenav2_bt_navigatorpackage.

**`Description`**
- Type: `unknown`
- Always load the requested behavior tree XML description, regardless of the name of the currently active XML.

**`Description`**
- Type: `unknown`
- List of behavior tree node shared libraries. All Nav2 BT libraries are automatically included for you, so this only needs to include your new custom plugins (new to Jazzy).

**`Description`**
- Type: `unknown`
- Duration (in milliseconds) for each iteration of BT execution.

**`Description`**
- Type: `unknown`
- Duration (secs) over which robot velocity should be smoothed.

**`Description`**
- Type: `unknown`
- Default timeout value (in milliseconds) while a BT action node is waiting for acknowledgement from an action server.
This value will be overwritten for a BT node if the input port “server_timeout” is provided.

**`Description`**
- Type: `unknown`
- Default timeout (in seconds) for BT action node cancellation requests during node halt.
This value will be overwritten for a BT node if the input port “cancel_timeout” is provided.

**`Description`**
- Type: `unknown`
- Default timeout value (in milliseconds) while Action or Service BT nodes will waiting for acknowledgement from an service or action server on BT initialization (e.g.wait_for_action_server(timeout)).
This value will be overwritten for a BT node if the input port “wait_for_service_timeout” is provided.

**`Description`**
- Type: `unknown`
- The introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.

**`Description`**
- Type: `unknown`
- TF transform tolerance.

**`Description`**
- Type: `unknown`
- Reference frame.

**`Description`**
- Type: `unknown`
- Robot base frame.

**`Description`**
- Type: `unknown`
- Topic on which odometry is published

**`[“assisted_teleop”,`**
- Type: `unknown`
- “backup”,
“compute_path”,
“dock_robot”,
“drive_on_heading”,
“follow_path”,
“nav_thru_poses”,
“nav_to_pose”,
“spin”,
“route”,
“undock_robot”,
“wait”]

**`Description`**
- Type: `unknown`
- For Kilted and newer: List of of error code name prefixes to be appended with ‘_error_code’ and ‘_error_msg’ and searched for during aborted navigator error processing.

**`[“compute_path_error_code”,`**
- Type: `unknown`
- “follow_path_error_code”]

**`Description`**
- Type: `unknown`
- For Jazzy and older: List of of error codes to compare.

**`Description`**
- Type: `unknown`
- The lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.

**`Description`**
- Type: `unknown`
- Whether to allow QoS profiles to be overwritten with parameterized values.

**`Description`**
- Type: `unknown`
- List of directories that hosts behavior trees XML files. It is needed to register all behavior trees as well as subtrees.

**`<navigate_to_pose_name>.goal_blackboard_id`**
- Type: `unknown`
- TypeDefaultstring“goal”DescriptionBlackboard variable to use to supply the goal to the behavior tree forNavigateToPose. Should match ports of BT XML file.

**`<navigate_to_pose_name>.path_blackboard_id`**
- Type: `unknown`
- TypeDefaultstring“path”DescriptionBlackboard variable to get the path from the behavior tree forNavigateToPosefeedback. Should match port names of BT XML file.

**`<navigate_to_pose_name>.tracking_feedback_blackboard_id`**
- Type: `unknown`
- TypeDefaultstring“tracking_feedback”DescriptionBlackboard variable to get the tracking feedback from the behavior tree forNavigateToPosefeedback. Should match port names of BT XML file.

**`<navigate_to_pose_name>.enable_groot_monitoring`**
- Type: `unknown`
- TypeDefaultboolFalseDescriptionWhether to enable Groot2 monitoring for this navigator.

**`<navigate_to_pose_name>.groot_server_port`**
- Type: `unknown`
- TypeDefaultint1667DescriptionThe port number for the Groot2 server. Note: In Groot2, you only need to specify the server port value, not the publisher port, as it is always the server port +1. Therefore, in this case, to use another navigator, the next available port would be 1669.

**`<navigate_to_pose_name>.search_window`**
- Type: `unknown`
- TypeDefaultdouble2.0DescriptionHow far (in meters) along the path the searching algorithm will look for the closest point.

**`Description`**
- Type: `unknown`
- Blackboard variable to use to supply the goal to the behavior tree forNavigateToPose. Should match ports of BT XML file.

**`Description`**
- Type: `unknown`
- Blackboard variable to get the path from the behavior tree forNavigateToPosefeedback. Should match port names of BT XML file.

**`Description`**
- Type: `unknown`
- Blackboard variable to get the tracking feedback from the behavior tree forNavigateToPosefeedback. Should match port names of BT XML file.

**`Description`**
- Type: `unknown`
- Whether to enable Groot2 monitoring for this navigator.

**`Description`**
- Type: `unknown`
- The port number for the Groot2 server. Note: In Groot2, you only need to specify the server port value, not the publisher port, as it is always the server port +1. Therefore, in this case, to use another navigator, the next available port would be 1669.

**`Description`**
- Type: `unknown`
- How far (in meters) along the path the searching algorithm will look for the closest point.

**`<navigate_through_poses>.goals_blackboard_id`**
- Type: `unknown`
- TypeDefaultstring“goals”DescriptionBlackboard variable to use to supply the goals to the behavior tree forNavigateThroughPoses. Should match ports of BT XML file.

**`<navigate_through_poses>.path_blackboard_id`**
- Type: `unknown`
- TypeDefaultstring“path”DescriptionBlackboard variable to get the path from the behavior tree forNavigateThroughPosesfeedback. Should match port names of BT XML file.

**`<navigate_through_poses>.tracking_feedback_blackboard_id`**
- Type: `unknown`
- TypeDefaultstring“tracking_feedback”DescriptionBlackboard variable to get the tracking feedback from the behavior tree forNavigateThroughPosesfeedback. Should match port names of BT XML file.

**`<navigate_through_poses>.waypoint_statuses_blackboard_id`**
- Type: `unknown`
- TypeDefaultstring“waypoint_statuses”DescriptionBlackboard variable to get the statuses of waypoints from the behavior tree forNavigateThroughPosesfeedback/result. Should match ports of BT XML file.

**`<navigate_through_poses>.enable_groot_monitoring`**
- Type: `unknown`
- TypeDefaultboolFalseDescriptionWhether to enable Groot2 monitoring for this navigator.

**`<navigate_through_poses>.groot_server_port`**
- Type: `unknown`
- TypeDefaultint1669DescriptionThe port number for the Groot2 server. Note: In Groot2, you only need to specify the server port value, not the publisher port, as it is always the server port +1. Therefore, in this case, to use another navigator, the next available port would be 1671.

**`<navigate_through_poses>.search_window`**
- Type: `unknown`
- TypeDefaultdouble2.0DescriptionHow far (in meters) along the path the searching algorithm will look for the closest point.

**`Description`**
- Type: `unknown`
- Blackboard variable to use to supply the goals to the behavior tree forNavigateThroughPoses. Should match ports of BT XML file.

**`Description`**
- Type: `unknown`
- Blackboard variable to get the path from the behavior tree forNavigateThroughPosesfeedback. Should match port names of BT XML file.

**`Description`**
- Type: `unknown`
- Blackboard variable to get the tracking feedback from the behavior tree forNavigateThroughPosesfeedback. Should match port names of BT XML file.

**`Description`**
- Type: `unknown`
- Blackboard variable to get the statuses of waypoints from the behavior tree forNavigateThroughPosesfeedback/result. Should match ports of BT XML file.

**`Description`**
- Type: `unknown`
- Whether to enable Groot2 monitoring for this navigator.

**`Description`**
- Type: `unknown`
- The port number for the Groot2 server. Note: In Groot2, you only need to specify the server port value, not the publisher port, as it is always the server port +1. Therefore, in this case, to use another navigator, the next available port would be 1671.

**`Description`**
- Type: `unknown`
- How far (in meters) along the path the searching algorithm will look for the closest point.


---

#### Collision Monitor

*Source: [https://docs.nav2.org/configuration/packages/configuring-collision-monitor.html](https://docs.nav2.org/configuration/packages/configuring-collision-monitor.html)*

##### Collision Monitor

Source code and `README` with design, explanations, and metrics can be found on [Github](https://github.com/ros-navigation/navigation2/tree/main/nav2_collision_monitor).

The `nav2_collision_monitor` package contains nodes providing an additional level of robot safety, namely the Collision Monitor and the Collision Detector.
The Collision Monitor is a node providing an additional level of robot safety. It performs several collision avoidance related tasks using incoming data from the sensors, bypassing the costmap and trajectory planners, to monitor for and prevent potential collisions at the emergency-stop level.
The Collision Detector works similarly to the Collision Monitor, but does not affect the robot’s velocity. It will only inform that data from the configured sources has been detected within the configured polygons via a message to a topic.

###### Provided Nodes

The nodes listed below are inside the `nav2_collision_monitor` package. See the pages for individual configuration information.

* [Collision Monitor Node](collision_monitor/configuring-collision-monitor-node.html)
* [Collision Detector Node](collision_monitor/configuring-collision-detector-node.html)

---

#### Constrained smoother

*Source: [https://docs.nav2.org/configuration/packages/configuring-constrained-smoother.html](https://docs.nav2.org/configuration/packages/configuring-constrained-smoother.html)*

##### Constrained smoother

Source code on [Github](https://github.com/ros-navigation/navigation2/tree/main/nav2_constrained_smoother).

A smoother plugin for nav2\_smoother based on the original deprecated smoother in nav2\_smac\_planner and put into operational state by [RoboTech Vision](https://robotechvision.com/).
Suitable for applications which need planned global path to be pushed away from obstacles and/or for Reeds-Shepp motion models. It optimizes for path length, smoothness, distance from obstacles, and curvature in a large Ceres-based optimization program.

Important note: Constrained smoother uses a rather heavy optimization algorithm and thus is suggested to be used on a periodically truncated path.
[TruncatePathLocal BT Node](bt-plugins/actions/TruncatePathLocal.html) can be used for achieving a proper path length and DistanceController BT Node can be used for achieving periodicity.

Following image depicts how Constrained Smoother can improve quality of an input path (cyan, generated by an outdated version of Smac Planner, intentionally not configured optimally to highlight the power of the smoother),
increasing its smoothness and distance from obstacles. Resulting path is marked by green color. Note: last few path poses are not smoothed since TruncatePathLocal is used on this path.

[![../../_images/constrained_smoother.png](../../_images/constrained_smoother.png)](../../_images/constrained_smoother.png)

###### Smoother Server Parameters

reversing\_enabled
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to detect forward/reverse direction and cusps. Should be set to false for paths without orientations assigned
```

path\_downsampling\_factor
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1 |
```

```
Description
:   Every n-th node of the path is taken for optimization. Useful for speed-up
```

path\_upsampling\_factor
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1 |
```

```
Description
:   Upsampling factor for refining. 0 - path remains downsampled (see `path_downsampling_factor`), 1 - path is upsampled back to original granularity using cubic bezier, 2… - more upsampling
```

keep\_start\_orientation
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to prevent the start orientation from being smoothed
```

keep\_goal\_orientation
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to prevent the goal orientation from being smoothed
```

minimum\_turning\_radius
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.4 |
```

```
Description
:   Minimum turning radius the robot can perform. Can be set to 0.0 (or w\_curve can be set to 0.0 with the same effect) for diff-drive/holonomic robots
```

w\_curve
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 30.0 |
```

```
Description
:   Weight to enforce minimum\_turning\_radius
```

w\_dist
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Weight to bind path to original as optional replacement for cost weight
```

w\_smooth
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2000000.0 |
```

```
Description
:   Weight to maximize smoothness of path
```

w\_cost
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.015 |
```

```
Description
:   Weight to steer robot away from collision and cost
```

w\_cost\_cusp\_multiplier
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 3.0 |
```

```
Description
:   Option to use higher weight during forward/reverse direction change, helping optimizer to converge or add an extra obstacle avoidance at these problematic segments.
    Following image depicts improvement of the path with `w_cost_cusp_multiplier` (green) compared to one without it (purple). Original path has cyan color.
```

```
    [![../../_images/w_cost_cusp_multiplier.png](../../_images/w_cost_cusp_multiplier.png)](../../_images/w_cost_cusp_multiplier.png)
```

cusp\_zone\_length
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.5 |
```

```
Description
:   Length of the section around cusp in which nodes use `w_cost_cusp_multiplier` (w\_cost rises gradually inside the zone towards the cusp point, whose costmap weight eqals w\_cost\*w\_cost\_cusp\_multiplier)
```

cost\_check\_points
:   |  |  |
```
| --- | --- |
| Type | Default |
| array of double | [] |
```

```
Description
:   Points in robot frame to grab costmap values from. Format: [x1, y1, weight1, x2, y2, weight2, …].
```

```
    IMPORTANT: Requires much higher number of optimizer iterations to actually improve the path. Use only if you really need it (highly elongated/asymmetric robots)
```

```
    Following image depicts how two cost check points can be used to improve cost awareness of a rectangular robot.
```

```
    [![../../_images/cost_check_points.png](../../_images/cost_check_points.png)](../../_images/cost_check_points.png)
```

optimizer.max\_iterations
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 100 |
```

```
Description
:   Maximum number of optimizer iterations
```

optimizer.debug\_optimizer
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to print optimizer debug info
```

optimizer.linear\_solver\_type
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “SPARSE\_NORMAL\_CHOLESKY” |
```

```
Description
:   Linear solver type to be used by optimizer. Valid values are `SPARSE_NORMAL_CHOLESKY` and `DENSE_QR`
```

optimizer.gradient\_tol
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | 1e-10 |
```

```
Description
:   Gradient tolerance optimization termination criterion
```

optimizer.fn\_tol
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | 1e-7 |
```

```
Description
:   Function tolerance optimization termination criterion
```

optimizer.param\_tol
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | 1e-15 |
```

```
Description
:   Parameter tolerance optimization termination criterion
```

###### Example

```
smoother_server:
  ros__parameters:
    smoother_plugins: ["SmoothPath"]

    SmoothPath:
      plugin: "nav2_constrained_smoother/ConstrainedSmoother"
      reversing_enabled: true       # whether to detect forward/reverse direction and cusps. Should be set to false for paths without orientations assigned
      path_downsampling_factor: 3   # every n-th node of the path is taken. Useful for speed-up
      path_upsampling_factor: 1     # 0 - path remains downsampled, 1 - path is upsampled back to original granularity using cubic bezier, 2... - more upsampling
      keep_start_orientation: true  # whether to prevent the start orientation from being smoothed
      keep_goal_orientation: true   # whether to prevent the gpal orientation from being smoothed
      minimum_turning_radius: 0.40  # minimum turning radius the robot can perform. Can be set to 0.0 (or w_curve can be set to 0.0 with the same effect) for diff-drive/holonomic robots
      w_curve: 30.0                 # weight to enforce minimum_turning_radius
      w_dist: 0.0                   # weight to bind path to original as optional replacement for cost weight
      w_smooth: 2000000.0           # weight to maximize smoothness of path
      w_cost: 0.015                 # weight to steer robot away from collision and cost

      # Parameters used to improve obstacle avoidance near cusps (forward/reverse movement changes)
      w_cost_cusp_multiplier: 3.0   # option to use higher weight during forward/reverse direction change which is often accompanied with dangerous rotations
      cusp_zone_length: 2.5         # length of the section around cusp in which nodes use w_cost_cusp_multiplier (w_cost rises gradually inside the zone towards the cusp point, whose costmap weight eqals w_cost*w_cost_cusp_multiplier)

      # Points in robot frame to grab costmap values from. Format: [x1, y1, weight1, x2, y2, weight2, ...]
      # IMPORTANT: Requires much higher number of iterations to actually improve the path. Uncomment only if you really need it (highly elongated/asymmetric robots)
      # cost_check_points: [-0.185, 0.0, 1.0]

      optimizer:
        max_iterations: 70            # max iterations of smoother
        debug_optimizer: false        # print debug info
        gradient_tol: 5e3
        fn_tol: 1.0e-15
        param_tol: 1.0e-20
```

#### Parameters

**`reversing_enabled`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to detect forward/reverse direction and cusps. Should be set to false for paths without orientations assigned

**`path_downsampling_factor`**
- Type: `unknown`
- TypeDefaultint1DescriptionEvery n-th node of the path is taken for optimization. Useful for speed-up

**`path_upsampling_factor`**
- Type: `unknown`
- TypeDefaultint1DescriptionUpsampling factor for refining. 0 - path remains downsampled (seepath_downsampling_factor), 1 - path is upsampled back to original granularity using cubic bezier, 2… - more upsampling

**`keep_start_orientation`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to prevent the start orientation from being smoothed

**`keep_goal_orientation`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to prevent the goal orientation from being smoothed

**`minimum_turning_radius`**
- Type: `unknown`
- TypeDefaultdouble0.4DescriptionMinimum turning radius the robot can perform. Can be set to 0.0 (or w_curve can be set to 0.0 with the same effect) for diff-drive/holonomic robots

**`w_curve`**
- Type: `unknown`
- TypeDefaultdouble30.0DescriptionWeight to enforce minimum_turning_radius

**`w_dist`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionWeight to bind path to original as optional replacement for cost weight

**`w_smooth`**
- Type: `unknown`
- TypeDefaultdouble2000000.0DescriptionWeight to maximize smoothness of path

**`w_cost`**
- Type: `unknown`
- TypeDefaultdouble0.015DescriptionWeight to steer robot away from collision and cost

**`w_cost_cusp_multiplier`**
- Type: `unknown`
- TypeDefaultdouble3.0DescriptionOption to use higher weight during forward/reverse direction change, helping optimizer to converge or add an extra obstacle avoidance at these problematic segments.
Following image depicts improvement of the path withw_cost_cusp_multiplier(green) compared to one without it (purple). Original path has cyan color.

**`cusp_zone_length`**
- Type: `unknown`
- TypeDefaultdouble2.5DescriptionLength of the section around cusp in which nodes usew_cost_cusp_multiplier(w_cost rises gradually inside the zone towards the cusp point, whose costmap weight eqals w_cost*w_cost_cusp_multiplier)

**`cost_check_points`**
- Type: `unknown`
- TypeDefaultarray of double[]DescriptionPoints in robot frame to grab costmap values from. Format: [x1, y1, weight1, x2, y2, weight2, …].IMPORTANT: Requires much higher number of optimizer iterations to actually improve the path. Use only if you really need it (highly elongated/asymmetric robots)Following image depicts how two cost check points can be used to improve cost awareness of a rectangular robot.

**`optimizer.max_iterations`**
- Type: `unknown`
- TypeDefaultint100DescriptionMaximum number of optimizer iterations

**`optimizer.debug_optimizer`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to print optimizer debug info

**`optimizer.linear_solver_type`**
- Type: `unknown`
- TypeDefaultstring“SPARSE_NORMAL_CHOLESKY”DescriptionLinear solver type to be used by optimizer. Valid values areSPARSE_NORMAL_CHOLESKYandDENSE_QR

**`optimizer.gradient_tol`**
- Type: `unknown`
- TypeDefaultbool1e-10DescriptionGradient tolerance optimization termination criterion

**`optimizer.fn_tol`**
- Type: `unknown`
- TypeDefaultbool1e-7DescriptionFunction tolerance optimization termination criterion

**`optimizer.param_tol`**
- Type: `unknown`
- TypeDefaultbool1e-15DescriptionParameter tolerance optimization termination criterion

**`Description`**
- Type: `unknown`
- Whether to detect forward/reverse direction and cusps. Should be set to false for paths without orientations assigned

**`Description`**
- Type: `unknown`
- Every n-th node of the path is taken for optimization. Useful for speed-up

**`Description`**
- Type: `unknown`
- Upsampling factor for refining. 0 - path remains downsampled (seepath_downsampling_factor), 1 - path is upsampled back to original granularity using cubic bezier, 2… - more upsampling

**`Description`**
- Type: `unknown`
- Whether to prevent the start orientation from being smoothed

**`Description`**
- Type: `unknown`
- Whether to prevent the goal orientation from being smoothed

**`Description`**
- Type: `unknown`
- Minimum turning radius the robot can perform. Can be set to 0.0 (or w_curve can be set to 0.0 with the same effect) for diff-drive/holonomic robots

**`Description`**
- Type: `unknown`
- Weight to enforce minimum_turning_radius

**`Description`**
- Type: `unknown`
- Weight to bind path to original as optional replacement for cost weight

**`Description`**
- Type: `unknown`
- Weight to maximize smoothness of path

**`Description`**
- Type: `unknown`
- Weight to steer robot away from collision and cost

**`Description`**
- Type: `unknown`
- Option to use higher weight during forward/reverse direction change, helping optimizer to converge or add an extra obstacle avoidance at these problematic segments.
Following image depicts improvement of the path withw_cost_cusp_multiplier(green) compared to one without it (purple). Original path has cyan color.

**`Description`**
- Type: `unknown`
- Length of the section around cusp in which nodes usew_cost_cusp_multiplier(w_cost rises gradually inside the zone towards the cusp point, whose costmap weight eqals w_cost*w_cost_cusp_multiplier)

**`Description`**
- Type: `unknown`
- Points in robot frame to grab costmap values from. Format: [x1, y1, weight1, x2, y2, weight2, …].IMPORTANT: Requires much higher number of optimizer iterations to actually improve the path. Use only if you really need it (highly elongated/asymmetric robots)Following image depicts how two cost check points can be used to improve cost awareness of a rectangular robot.

**`Description`**
- Type: `unknown`
- Maximum number of optimizer iterations

**`Description`**
- Type: `unknown`
- Whether to print optimizer debug info

**`Description`**
- Type: `unknown`
- Linear solver type to be used by optimizer. Valid values areSPARSE_NORMAL_CHOLESKYandDENSE_QR

**`Description`**
- Type: `unknown`
- Gradient tolerance optimization termination criterion

**`Description`**
- Type: `unknown`
- Function tolerance optimization termination criterion

**`Description`**
- Type: `unknown`
- Parameter tolerance optimization termination criterion


---

#### Controller Server

*Source: [https://docs.nav2.org/configuration/packages/configuring-controller-server.html](https://docs.nav2.org/configuration/packages/configuring-controller-server.html)*

##### Controller Server

Source code on [Github](https://github.com/ros-navigation/navigation2/tree/main/nav2_controller).

The Controller Server implements the server for handling the controller requests for the stack and host a map of plugin implementations.
It will take in path and plugin names for controller, progress checker and goal checker to use and call the appropriate plugins.
It also hosts the local costmap.

###### Parameters

controller\_frequency
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 20.0 |
```

```
Description
:   Frequency to run controller (Hz).
```

costmap\_update\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.3 |
```

```
Description
:   The timeout value (seconds) for the costmap to be fully updated before a control effort can be computed.
```

use\_realtime\_priority
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Adds soft real-time prioritization to the controller server to better ensure resources to time sensitive portions of the codebase. This will set the controller’s execution thread to a higher priority than the rest of the system (`90`) to meet scheduling deadlines to have less missed loop rates. To use this feature, you use set the following inside of `/etc/security/limits.conf` to give userspace access to elevated prioritization permissions: `<username> soft rtprio 99 <username> hard rtprio 99`
```

publish\_zero\_velocity
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to publish a zero velocity command on goal exit. This is useful for stopping the robot when a goal terminates.
```

controller\_plugins
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | [‘FollowPath’] |
```

```
Description
:   List of mapped names for controller plugins for processing requests and parameters.
```

```
Note
:   Each plugin namespace defined in this list needs to have a `plugin` parameter defining the type of plugin to be loaded in the namespace.
```

```
    Example:
```

        ```
        controller_server:
          ros__parameters:
            controller_plugins: ["FollowPath"]
            FollowPath:
              plugin: "dwb_core::DWBLocalPlanner"
        ```

progress\_checker\_plugins
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | [“progress\_checker”] |
```

```
Description
:   Mapped name for progress checker plugin for checking progress made by robot. Formerly `progress_checker_plugin` for Humble and older with a single string plugin.
```

```
Note
:   The plugin namespace defined needs to have a `plugin` parameter defining the type of plugin to be loaded in the namespace.
```

```
    Example:
```

        ```
        controller_server:
          ros__parameters:
            progress_checker_plugins: ["progress_checker"] # progress_checker_plugin: "progress_checker" For Humble and older
            progress_checker:
              plugin: "nav2_controller::SimpleProgressChecker"
        ```

goal\_checker\_plugins
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | [“goal\_checker”] |
```

```
Description
:   Mapped name for goal checker plugin for checking goal is reached. When the number of the plugins is more than 2, each `FollowPath` action needs to specify the goal checker plugin name with its `goal_checker_id` field.
```

```
Note
:   The plugin namespace defined needs to have a `plugin` parameter defining the type of plugin to be loaded in the namespace.
```

```
    Example:
```

        ```
        controller_server:
          ros__parameters:
            goal_checker_plugins: ["goal_checker"]
            goal_checker:
              plugin: "nav2_controller::SimpleGoalChecker"
        ```

path\_handler\_plugins
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | [“PathHandler”] |
```

```
Description
:   Mapped name for path handler plugin for processing path from the planner. When the number of the plugins is more than 2, each `FollowPath` action needs to specify the path handler plugin name with its `path_handler_id` field.
```

```
Note
:   The plugin namespace defined needs to have a `plugin` parameter defining the type of plugin to be loaded in the namespace.
```

```
    Example:
```

        ```
        controller_server:
          ros__parameters:
            path_handler_plugins: ["PathHandler"]
            path_handler:
              plugin: "nav2_controller::FeasiblePathHandler"
        ```

min\_x\_velocity\_threshold
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0001 |
```

```
Description
:   The controller server filters the velocity portion of the odometry messages received before sending them to the controller plugin.
    Odometry values below this threshold (in m/s) will be set to 0.0.
```

min\_y\_velocity\_threshold
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0001 |
```

```
Description
:   The controller server filters the velocity portion of the odometry messages received before sending them to the controller plugin.
    Odometry values below this threshold (in m/s) will be set to 0.0. For non-holonomic robots
```

min\_theta\_velocity\_threshold
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0001 |
```

```
Description
:   The controller server filters the velocity portion of the odometry messages received before sending them to the controller plugin.
    Odometry values below this threshold (in rad/s) will be set to 0.0.
```

failure\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   The maximum duration in seconds the called controller plugin can fail (i.e. the `computeVelocityCommands` function of the plugin throwing an exception) before the `nav2_msgs::action::FollowPath` action fails.
    Setting it to the special value of -1.0 makes it infinite, 0 to disable, and any positive value for the appropriate timeout.
```

speed\_limit\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “speed\_limit” |
```

```
Description
:   Speed limiting topic name to subscribe. This could be published by Speed Filter (please refer to [Speed Filter Parameters](costmap-plugins/speed_filter.html#speed-filter) configuration page). You can also use this without the Speed Filter as well if you provide an external server to publish [these messages](https://github.com/ros-navigation/navigation2/blob/main/nav2_msgs/msg/SpeedLimit.msg).
```

odom\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “odom” |
```

```
Description
:   Topic to get instantaneous measurement of speed from.
```

odom\_duration
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.3 |
```

```
Description
:   Time (s) to buffer odometry commands to estimate the robot speed.
```

enable\_stamped\_cmd\_vel
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to use geometry\_msgs::msg::Twist or geometry\_msgs::msg::TwistStamped velocity data.
    True uses TwistStamped, false uses Twist.
    Note: This parameter is default `false` in Jazzy or older! Kilted or newer uses `TwistStamped` by default.
```

bond\_heartbeat\_period
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
Description
:   The lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.
```

introspection\_mode
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “disabled” |
```

```
Description
:   The introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.
```

allow\_parameter\_qos\_overrides
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to allow QoS profiles to be overwritten with parameterized values.
```

search\_window
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description
:   How far (in meters) along the path the searching algorithm will look for the closest point.
```

###### Provided Plugins

> The plugins listed below are inside the `nav2_controller` namespace.

* [SimpleProgressChecker](nav2_controller-plugins/simple_progress_checker.html)
* [PoseProgressChecker](nav2_controller-plugins/pose_progress_checker.html)
* [AxisGoalChecker](nav2_controller-plugins/axis_goal_checker.html)
* [SimpleGoalChecker](nav2_controller-plugins/simple_goal_checker.html)
* [StoppedGoalChecker](nav2_controller-plugins/stopped_goal_checker.html)
* [PositionGoalChecker](nav2_controller-plugins/position_goal_checker.html)
* [FeasiblePathHandler](nav2_controller-plugins/feasible_path_handler.html)

###### Default Plugins

When the `progress_checker_plugins`, `goal_checker_plugin`, `path_handler_plugin` or `controller_plugins` parameters are not overridden, the following default plugins are loaded:

> |  |  |
> | --- | --- |
> | Namespace | Plugin |
> | “progress\_checker” | “nav2\_controller::SimpleProgressChecker” |
> | “goal\_checker” | “nav2\_controller::SimpleGoalChecker” |
> | “path\_handler” | “nav2\_controller::FeasiblePathHandler” |
> | “FollowPath” | “dwb\_core::DWBLocalPlanner” |

###### Example

```
controller_server:
  ros__parameters:
    controller_frequency: 20.0
    costmap_update_timeout: 0.3
    min_x_velocity_threshold: 0.001
    min_y_velocity_threshold: 0.5
    min_theta_velocity_threshold: 0.001
    failure_tolerance: 0.3
    odom_topic: "odom"
    odom_duration: 0.3
    progress_checker_plugins: ["progress_checker"] # progress_checker_plugin: "progress_checker" For Humble and older
    goal_checker_plugins: ["goal_checker"] # goal_checker_plugin: "goal_checker" For Galactic and older
    path_handler_plguins: ["PathHandler"]
    controller_plugins: ["FollowPath"]
    progress_checker:
      plugin: "nav2_controller::SimpleProgressChecker"
      required_movement_radius: 0.5
      movement_time_allowance: 10.0
    goal_checker:
      plugin: "nav2_controller::SimpleGoalChecker"
      xy_goal_tolerance: 0.25
      yaw_goal_tolerance: 0.25
      path_length_tolerance: 1.0
      stateful: True
    PathHandler:
      plugin: "nav2_controller::FeasiblePathHandler"
      prune_distance: 2.0
      enforce_path_inversion: True
      enforce_path_rotation: False
      inversion_xy_tolerance: 0.2
      inversion_yaw_tolerance: 0.4
      minimum_rotation_angle: 0.785
      reject_unit_path: False
    FollowPath:
      plugin: "dwb_core::DWBLocalPlanner"
```

#### Parameters

**`controller_frequency`**
- Type: `unknown`
- TypeDefaultdouble20.0DescriptionFrequency to run controller (Hz).

**`costmap_update_timeout`**
- Type: `unknown`
- TypeDefaultdouble0.3DescriptionThe timeout value (seconds) for the costmap to be fully updated before a control effort can be computed.

**`use_realtime_priority`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionAdds soft real-time prioritization to the controller server to better ensure resources to time sensitive portions of the codebase. This will set the controller’s execution thread to a higher priority than the rest of the system (90) to meet scheduling deadlines to have less missed loop rates. To use this feature, you use set the following inside of/etc/security/limits.confto give userspace access to elevated prioritization permissions:<username>softrtprio99<username>hardrtprio99

**`publish_zero_velocity`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to publish a zero velocity command on goal exit. This is useful for stopping the robot when a goal terminates.

**`controller_plugins`**
- Type: `unknown`
- TypeDefaultvector<string>[‘FollowPath’]DescriptionList of mapped names for controller plugins for processing requests and parameters.NoteEach plugin namespace defined in this list needs to have apluginparameter defining the type of plugin to be loaded in the namespace.Example:controller_server:ros__parameters:controller_plugins:["FollowPath"]FollowPath:plugin:"dwb_core::DWBLocalPlanner"

**`progress_checker_plugins`**
- Type: `unknown`
- TypeDefaultvector<string>[“progress_checker”]DescriptionMapped name for progress checker plugin for checking progress made by robot. Formerlyprogress_checker_pluginfor Humble and older with a single string plugin.NoteThe plugin namespace defined needs to have apluginparameter defining the type of plugin to be loaded in the namespace.Example:controller_server:ros__parameters:progress_checker_plugins:["progress_checker"]# progress_checker_plugin: "progress_checker" For Humble and olderprogress_checker:plugin:"nav2_controller::SimpleProgressChecker"

**`goal_checker_plugins`**
- Type: `unknown`
- TypeDefaultvector<string>[“goal_checker”]DescriptionMapped name for goal checker plugin for checking goal is reached. When the number of the plugins is more than 2, eachFollowPathaction needs to specify the goal checker plugin name with itsgoal_checker_idfield.NoteThe plugin namespace defined needs to have apluginparameter defining the type of plugin to be loaded in the namespace.Example:controller_server:ros__parameters:goal_checker_plugins:["goal_checker"]goal_checker:plugin:"nav2_controller::SimpleGoalChecker"

**`path_handler_plugins`**
- Type: `unknown`
- TypeDefaultvector<string>[“PathHandler”]DescriptionMapped name for path handler plugin for processing path from the planner. When the number of the plugins is more than 2, eachFollowPathaction needs to specify the path handler plugin name with itspath_handler_idfield.NoteThe plugin namespace defined needs to have apluginparameter defining the type of plugin to be loaded in the namespace.Example:controller_server:ros__parameters:path_handler_plugins:["PathHandler"]path_handler:plugin:"nav2_controller::FeasiblePathHandler"

**`min_x_velocity_threshold`**
- Type: `unknown`
- TypeDefaultdouble0.0001DescriptionThe controller server filters the velocity portion of the odometry messages received before sending them to the controller plugin.
Odometry values below this threshold (in m/s) will be set to 0.0.

**`min_y_velocity_threshold`**
- Type: `unknown`
- TypeDefaultdouble0.0001DescriptionThe controller server filters the velocity portion of the odometry messages received before sending them to the controller plugin.
Odometry values below this threshold (in m/s) will be set to 0.0. For non-holonomic robots

**`min_theta_velocity_threshold`**
- Type: `unknown`
- TypeDefaultdouble0.0001DescriptionThe controller server filters the velocity portion of the odometry messages received before sending them to the controller plugin.
Odometry values below this threshold (in rad/s) will be set to 0.0.

**`failure_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionThe maximum duration in seconds the called controller plugin can fail (i.e. thecomputeVelocityCommandsfunction of the plugin throwing an exception) before thenav2_msgs::action::FollowPathaction fails.
Setting it to the special value of -1.0 makes it infinite, 0 to disable, and any positive value for the appropriate timeout.

**`speed_limit_topic`**
- Type: `unknown`
- TypeDefaultstring“speed_limit”DescriptionSpeed limiting topic name to subscribe. This could be published by Speed Filter (please refer toSpeed Filter Parametersconfiguration page). You can also use this without the Speed Filter as well if you provide an external server to publishthese messages.

**`odom_topic`**
- Type: `unknown`
- TypeDefaultstring“odom”DescriptionTopic to get instantaneous measurement of speed from.

**`odom_duration`**
- Type: `unknown`
- TypeDefaultdouble0.3DescriptionTime (s) to buffer odometry commands to estimate the robot speed.

**`enable_stamped_cmd_vel`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to use geometry_msgs::msg::Twist or geometry_msgs::msg::TwistStamped velocity data.
True uses TwistStamped, false uses Twist.
Note: This parameter is defaultfalsein Jazzy or older! Kilted or newer usesTwistStampedby default.

**`bond_heartbeat_period`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionThe lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.

**`introspection_mode`**
- Type: `unknown`
- TypeDefaultstring“disabled”DescriptionThe introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.

**`allow_parameter_qos_overrides`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to allow QoS profiles to be overwritten with parameterized values.

**`search_window`**
- Type: `unknown`
- TypeDefaultdouble2.0DescriptionHow far (in meters) along the path the searching algorithm will look for the closest point.

**`Description`**
- Type: `unknown`
- Frequency to run controller (Hz).

**`Description`**
- Type: `unknown`
- The timeout value (seconds) for the costmap to be fully updated before a control effort can be computed.

**`Description`**
- Type: `unknown`
- Adds soft real-time prioritization to the controller server to better ensure resources to time sensitive portions of the codebase. This will set the controller’s execution thread to a higher priority than the rest of the system (90) to meet scheduling deadlines to have less missed loop rates. To use this feature, you use set the following inside of/etc/security/limits.confto give userspace access to elevated prioritization permissions:<username>softrtprio99<username>hardrtprio99

**`Description`**
- Type: `unknown`
- Whether to publish a zero velocity command on goal exit. This is useful for stopping the robot when a goal terminates.

**`Description`**
- Type: `unknown`
- List of mapped names for controller plugins for processing requests and parameters.

**`Note`**
- Type: `unknown`
- Each plugin namespace defined in this list needs to have apluginparameter defining the type of plugin to be loaded in the namespace.Example:controller_server:ros__parameters:controller_plugins:["FollowPath"]FollowPath:plugin:"dwb_core::DWBLocalPlanner"

**`Description`**
- Type: `unknown`
- Mapped name for progress checker plugin for checking progress made by robot. Formerlyprogress_checker_pluginfor Humble and older with a single string plugin.

**`Note`**
- Type: `unknown`
- The plugin namespace defined needs to have apluginparameter defining the type of plugin to be loaded in the namespace.Example:controller_server:ros__parameters:progress_checker_plugins:["progress_checker"]# progress_checker_plugin: "progress_checker" For Humble and olderprogress_checker:plugin:"nav2_controller::SimpleProgressChecker"

**`Description`**
- Type: `unknown`
- Mapped name for goal checker plugin for checking goal is reached. When the number of the plugins is more than 2, eachFollowPathaction needs to specify the goal checker plugin name with itsgoal_checker_idfield.

**`Note`**
- Type: `unknown`
- The plugin namespace defined needs to have apluginparameter defining the type of plugin to be loaded in the namespace.Example:controller_server:ros__parameters:goal_checker_plugins:["goal_checker"]goal_checker:plugin:"nav2_controller::SimpleGoalChecker"

**`Description`**
- Type: `unknown`
- Mapped name for path handler plugin for processing path from the planner. When the number of the plugins is more than 2, eachFollowPathaction needs to specify the path handler plugin name with itspath_handler_idfield.

**`Note`**
- Type: `unknown`
- The plugin namespace defined needs to have apluginparameter defining the type of plugin to be loaded in the namespace.Example:controller_server:ros__parameters:path_handler_plugins:["PathHandler"]path_handler:plugin:"nav2_controller::FeasiblePathHandler"

**`Description`**
- Type: `unknown`
- The controller server filters the velocity portion of the odometry messages received before sending them to the controller plugin.
Odometry values below this threshold (in m/s) will be set to 0.0.

**`Description`**
- Type: `unknown`
- The controller server filters the velocity portion of the odometry messages received before sending them to the controller plugin.
Odometry values below this threshold (in m/s) will be set to 0.0. For non-holonomic robots

**`Description`**
- Type: `unknown`
- The controller server filters the velocity portion of the odometry messages received before sending them to the controller plugin.
Odometry values below this threshold (in rad/s) will be set to 0.0.

**`Description`**
- Type: `unknown`
- The maximum duration in seconds the called controller plugin can fail (i.e. thecomputeVelocityCommandsfunction of the plugin throwing an exception) before thenav2_msgs::action::FollowPathaction fails.
Setting it to the special value of -1.0 makes it infinite, 0 to disable, and any positive value for the appropriate timeout.

**`Description`**
- Type: `unknown`
- Speed limiting topic name to subscribe. This could be published by Speed Filter (please refer toSpeed Filter Parametersconfiguration page). You can also use this without the Speed Filter as well if you provide an external server to publishthese messages.

**`Description`**
- Type: `unknown`
- Topic to get instantaneous measurement of speed from.

**`Description`**
- Type: `unknown`
- Time (s) to buffer odometry commands to estimate the robot speed.

**`Description`**
- Type: `unknown`
- Whether to use geometry_msgs::msg::Twist or geometry_msgs::msg::TwistStamped velocity data.
True uses TwistStamped, false uses Twist.
Note: This parameter is defaultfalsein Jazzy or older! Kilted or newer usesTwistStampedby default.

**`Description`**
- Type: `unknown`
- The lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.

**`Description`**
- Type: `unknown`
- The introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.

**`Description`**
- Type: `unknown`
- Whether to allow QoS profiles to be overwritten with parameterized values.

**`Description`**
- Type: `unknown`
- How far (in meters) along the path the searching algorithm will look for the closest point.

**`“progress_checker”`**
- Type: `unknown`
- 

**`“goal_checker”`**
- Type: `unknown`
- 

**`“path_handler”`**
- Type: `unknown`
- 

**`“FollowPath”`**
- Type: `unknown`
- 


---

#### Costmap 2D

*Source: [https://docs.nav2.org/configuration/packages/configuring-costmaps.html](https://docs.nav2.org/configuration/packages/configuring-costmaps.html)*

##### Costmap 2D

Source code on [Github](https://github.com/ros-navigation/navigation2/tree/main/nav2_costmap_2d).

The Costmap 2D package implements a 2D grid-based costmap for environmental representations and a number of sensor processing plugins (AI outputs, depth sensor obstacle buffering, semantic information, etc).
It is used in the planner and controller servers for creating the space to check for collisions or higher cost areas to negotiate around.

###### Costmap2D ROS Parameters

always\_send\_full\_costmap
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description
:   Whether to send full costmap every update, rather than updates.
```

introspection\_mode
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “disabled” |
```

```
Description
:   The introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.
```

allow\_parameter\_qos\_overrides
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to allow QoS profiles to be overwritten with parameterized values.
```

footprint\_padding
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.01 |
```

```
Description
:   Amount to pad footprint (m).
```

footprint
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<double> | “[]” |
```

```
Description
:   Ordered set of footprint points passed in as a string, must be closed set. For example, the following defines a square base with side lengths of 0.2 meters footprint: “[ [0.1, 0.1], [0.1, -0.1], [-0.1, -0.1], [-0.1, 0.1] ]”. Note that this can also be adjusted over time using the costmap’s `~/footprint` topic, which will update the polygon over time as needed due to changes in the robot’s state, such as movement of an attached manipulator, picking up a pallet, or other actions that adjust a robot’s shape. If this parameter is set, `isPathValid` will do full collision checking.
```

global\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “map” |
```

```
Description
:   Reference frame.
```

height
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 5 |
```

```
Description
:   Height of costmap (m).
```

width
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 5 |
```

```
Description
:   Width of costmap (m).
```

lethal\_cost\_threshold
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 100 |
```

```
Description
:   Minimum cost of an occupancy grid map to be considered a lethal obstacle.
```

map\_vis\_z
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   The height of map, allows to avoid rviz visualization flickering at -0.008
```

origin\_x
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   X origin of the costmap relative to width (m).
```

origin\_y
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Y origin of the costmap relative to height (m).
```

publish\_frequency
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   Frequency to publish costmap to topic.
```

resolution
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
Description
:   Resolution of 1 pixel of the costmap, in meters.
```

robot\_base\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “base\_link” |
```

```
Description
:   Robot base frame.
```

robot\_radius
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
Description
:   Robot radius to use, if footprint coordinates not provided. If this parameter is set, `isPathValid` will do circular collision checking.
```

subscribe\_to\_stamped\_footprint
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description
:   If true, the costmap will subscribe to PolygonStamped footprint messages instead of Polygon messages. This allows the footprint to include timestamp and frame information, which can be useful for applications that need temporally-aware footprint data.
```

rolling\_window
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description
:   Whether costmap should roll with robot base frame.
```

track\_unknown\_space
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description
:   If false, treats unknown space as free space, else as unknown space.
```

transform\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.3 |
```

```
Description
:   TF transform tolerance.
```

initial\_transform\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 60.0 |
```

```
Description
:   Time to wait for the transform from robot base frame to global frame to become available. If exceeded, the configuration stage is aborted.
```

trinary\_costmap
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description
:   If occupancy grid map should be interpreted as only 3 values (free, occupied, unknown) or with its stored values.
```

unknown\_cost\_value
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 255 |
```

```
Description
:   Cost of unknown space if tracking it.
```

inscribed\_obstacle\_cost\_value
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 99 |
```

```
Description
:   The OccupancyGrid values that represents `INSCRIBED_INFLATED_OBSTACLE` during costmap conversion operations.
```

update\_frequency
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 5.0 |
```

```
Description
:   Costmap update frequency.
```

use\_maximum
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description
:   whether when combining costmaps to use the maximum cost or override.
```

plugins
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | {“static\_layer”, “obstacle\_layer”, “inflation\_layer”} |
```

```
Description
:   List of mapped plugin names for parameter namespaces and names.
```

```
Note
:   Each plugin namespace defined in this list needs to have a `plugin` parameter defining the type of plugin to be loaded in the namespace.
```

```
    Example:
```

        ```
        local_costmap:
          ros__parameters:
            plugins: ["obstacle_layer", "voxel_layer", "inflation_layer"]
            obstacle_layer:
              plugin: "nav2_costmap_2d::ObstacleLayer"
            voxel_layer:
              plugin: "nav2_costmap_2d::VoxelLayer"
            inflation_layer:
              plugin: "nav2_costmap_2d::InflationLayer"
        ```

filters
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | {} |
```

```
Description
:   List of mapped costmap filter names for parameter namespaces and names.
```

```
Note
:   Costmap filters are also loadable plugins just as ordinary costmap layers. This separation is made to avoid plugin and filter interference and places these filters on top of the combined layered costmap. As with plugins, each costmap filter namespace defined in this list needs to have a `plugin` parameter defining the type of filter plugin to be loaded in the namespace.
```

```
    Example:
```

        ```
        local_costmap:
          ros__parameters:
            filters: ["keepout_filter", "speed_filter"]
            keepout_filter:
              plugin: "nav2_costmap_2d::KeepoutFilter"
            speed_filter:
              plugin: "nav2_costmap_2d::SpeedFilter"
        ```

###### Default Plugins

When the `plugins` parameter is not overridden, the following default plugins are loaded:

> |  |  |
> | --- | --- |
> | Namespace | Plugin |
> | “static\_layer” | “nav2\_costmap\_2d::StaticLayer” |
> | “obstacle\_layer” | “nav2\_costmap\_2d::ObstacleLayer” |
> | “inflation\_layer” | “nav2\_costmap\_2d::InflationLayer” |

###### Plugin Parameters

* [Static Layer Parameters](costmap-plugins/static.html)
* [Inflation Layer Parameters](costmap-plugins/inflation.html)
* [Obstacle Layer Parameters](costmap-plugins/obstacle.html)
* [Voxel Layer Parameters](costmap-plugins/voxel.html)
* [Range Sensor Parameters](costmap-plugins/range.html)
* [Denoise Layer Parameters](costmap-plugins/denoise.html)
* [Plugin Container Layer Parameters](costmap-plugins/plugin_container.html)

###### Costmap Filters Parameters

* [Keepout Filter Parameters](costmap-plugins/keepout_filter.html)
* [Speed Filter Parameters](costmap-plugins/speed_filter.html)
* [Binary Filter Parameters](costmap-plugins/binary_filter.html)

###### Example

```
global_costmap:
  global_costmap:
    ros__parameters:
      footprint_padding: 0.03
      update_frequency: 1.0
      publish_frequency: 1.0
      global_frame: map
      robot_base_frame: base_link
      robot_radius: 0.22 # radius set and used, so no footprint points
      resolution: 0.05
      plugins: ["static_layer", "obstacle_layer", "voxel_layer", "inflation_layer"]
      obstacle_layer:
        plugin: "nav2_costmap_2d::ObstacleLayer"
        enabled: True
        observation_sources: scan
        footprint_clearing_enabled: true
        max_obstacle_height: 2.0
        combination_method: 1
        scan:
          topic: /scan
          obstacle_max_range: 2.5
          obstacle_min_range: 0.0
          raytrace_max_range: 3.0
          raytrace_min_range: 0.0
          max_obstacle_height: 2.0
          min_obstacle_height: 0.0
          clearing: True
          marking: True
          data_type: "LaserScan"
          inf_is_valid: false
      voxel_layer:
        plugin: "nav2_costmap_2d::VoxelLayer"
        enabled: True
        footprint_clearing_enabled: true
        max_obstacle_height: 2.0
        publish_voxel_map: True
        origin_z: 0.0
        z_resolution: 0.05
        z_voxels: 16
        max_obstacle_height: 2.0
        unknown_threshold: 15
        mark_threshold: 0
        observation_sources: pointcloud
        combination_method: 1
        pointcloud:  # no frame set, uses frame from message
          topic: /intel_realsense_r200_depth/points
          max_obstacle_height: 2.0
          min_obstacle_height: 0.0
          obstacle_max_range: 2.5
          obstacle_min_range: 0.0
          raytrace_max_range: 3.0
          raytrace_min_range: 0.0
          clearing: True
          marking: True
          data_type: "PointCloud2"
          transport_type: "raw"  # raw or/ with compression (zlib, draco, zstd)
      static_layer:
        plugin: "nav2_costmap_2d::StaticLayer"
        map_subscribe_transient_local: True
        enabled: true
        subscribe_to_updates: true
        transform_tolerance: 0.1
      inflation_layer:
        plugin: "nav2_costmap_2d::InflationLayer"
        enabled: true
        inflation_radius: 0.55
        cost_scaling_factor: 1.0
        inflate_unknown: false
        inflate_around_unknown: true
      always_send_full_costmap: True
      introspection_mode: "disabled"


local_costmap:
  local_costmap:
    ros__parameters:
      update_frequency: 5.0
      publish_frequency: 2.0
      global_frame: odom
      robot_base_frame: base_link
      rolling_window: true
      width: 3
      height: 3
      resolution: 0.05
      introspection_mode: "disabled"
```

#### Parameters

**`always_send_full_costmap`**
- Type: `unknown`
- TypeDefaultboolFalseDescriptionWhether to send full costmap every update, rather than updates.

**`introspection_mode`**
- Type: `unknown`
- TypeDefaultstring“disabled”DescriptionThe introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.

**`allow_parameter_qos_overrides`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to allow QoS profiles to be overwritten with parameterized values.

**`footprint_padding`**
- Type: `unknown`
- TypeDefaultdouble0.01DescriptionAmount to pad footprint (m).

**`footprint`**
- Type: `unknown`
- TypeDefaultvector<double>“[]”DescriptionOrdered set of footprint points passed in as a string, must be closed set. For example, the following defines a square base with side lengths of 0.2 metersfootprint: “[ [0.1, 0.1], [0.1, -0.1], [-0.1, -0.1], [-0.1, 0.1] ]”. Note that this can also be adjusted over time using the costmap’s~/footprinttopic, which will update the polygon over time as needed due to changes in the robot’s state, such as movement of an attached manipulator, picking up a pallet, or other actions that adjust a robot’s shape. If this parameter is set,isPathValidwill do full collision checking.

**`global_frame`**
- Type: `unknown`
- TypeDefaultstring“map”DescriptionReference frame.

**`height`**
- Type: `unknown`
- TypeDefaultint5DescriptionHeight of costmap (m).

**`width`**
- Type: `unknown`
- TypeDefaultint5DescriptionWidth of costmap (m).

**`lethal_cost_threshold`**
- Type: `unknown`
- TypeDefaultint100DescriptionMinimum cost of an occupancy grid map to be considered a lethal obstacle.

**`map_vis_z`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionThe height of map, allows to avoid rviz visualization flickering at -0.008

**`origin_x`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionX origin of the costmap relative to width (m).

**`origin_y`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionY origin of the costmap relative to height (m).

**`publish_frequency`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionFrequency to publish costmap to topic.

**`resolution`**
- Type: `unknown`
- TypeDefaultdouble0.1DescriptionResolution of 1 pixel of the costmap, in meters.

**`robot_base_frame`**
- Type: `unknown`
- TypeDefaultstring“base_link”DescriptionRobot base frame.

**`robot_radius`**
- Type: `unknown`
- TypeDefaultdouble0.1DescriptionRobot radius to use, if footprint coordinates not provided. If this parameter is set,isPathValidwill do circular collision checking.

**`subscribe_to_stamped_footprint`**
- Type: `unknown`
- TypeDefaultboolFalseDescriptionIf true, the costmap will subscribe to PolygonStamped footprint messages instead of Polygon messages. This allows the footprint to include timestamp and frame information, which can be useful for applications that need temporally-aware footprint data.

**`rolling_window`**
- Type: `unknown`
- TypeDefaultboolFalseDescriptionWhether costmap should roll with robot base frame.

**`track_unknown_space`**
- Type: `unknown`
- TypeDefaultboolFalseDescriptionIf false, treats unknown space as free space, else as unknown space.

**`transform_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.3DescriptionTF transform tolerance.

**`initial_transform_timeout`**
- Type: `unknown`
- TypeDefaultdouble60.0DescriptionTime to wait for the transform from robot base frame to global frame to become available. If exceeded, the  configuration stage is aborted.

**`trinary_costmap`**
- Type: `unknown`
- TypeDefaultboolTrueDescriptionIf occupancy grid map should be interpreted as only 3 values (free, occupied, unknown) or with its stored values.

**`unknown_cost_value`**
- Type: `unknown`
- TypeDefaultint255DescriptionCost of unknown space if tracking it.

**`inscribed_obstacle_cost_value`**
- Type: `unknown`
- TypeDefaultint99DescriptionThe OccupancyGrid values that representsINSCRIBED_INFLATED_OBSTACLEduring costmap conversion operations.

**`update_frequency`**
- Type: `unknown`
- TypeDefaultdouble5.0DescriptionCostmap update frequency.

**`use_maximum`**
- Type: `unknown`
- TypeDefaultboolFalseDescriptionwhether when combining costmaps to use the maximum cost or override.

**`plugins`**
- Type: `unknown`
- TypeDefaultvector<string>{“static_layer”, “obstacle_layer”, “inflation_layer”}DescriptionList of mapped plugin names for parameter namespaces and names.NoteEach plugin namespace defined in this list needs to have apluginparameter defining the type of plugin to be loaded in the namespace.Example:local_costmap:ros__parameters:plugins:["obstacle_layer","voxel_layer","inflation_layer"]obstacle_layer:plugin:"nav2_costmap_2d::ObstacleLayer"voxel_layer:plugin:"nav2_costmap_2d::VoxelLayer"inflation_layer:plugin:"nav2_costmap_2d::InflationLayer"

**`filters`**
- Type: `unknown`
- TypeDefaultvector<string>{}DescriptionList of mapped costmap filter names for parameter namespaces and names.NoteCostmap filters are also loadable plugins just as ordinary costmap layers. This separation is made to avoid plugin and filter interference and places these filters on top of the combined layered costmap. As  with plugins, each costmap filter namespace defined in this list needs to have apluginparameter defining the type of filter plugin to be loaded in the namespace.Example:local_costmap:ros__parameters:filters:["keepout_filter","speed_filter"]keepout_filter:plugin:"nav2_costmap_2d::KeepoutFilter"speed_filter:plugin:"nav2_costmap_2d::SpeedFilter"

**`Description`**
- Type: `unknown`
- Whether to send full costmap every update, rather than updates.

**`Description`**
- Type: `unknown`
- The introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.

**`Description`**
- Type: `unknown`
- Whether to allow QoS profiles to be overwritten with parameterized values.

**`Description`**
- Type: `unknown`
- Amount to pad footprint (m).

**`Description`**
- Type: `unknown`
- Ordered set of footprint points passed in as a string, must be closed set. For example, the following defines a square base with side lengths of 0.2 metersfootprint: “[ [0.1, 0.1], [0.1, -0.1], [-0.1, -0.1], [-0.1, 0.1] ]”. Note that this can also be adjusted over time using the costmap’s~/footprinttopic, which will update the polygon over time as needed due to changes in the robot’s state, such as movement of an attached manipulator, picking up a pallet, or other actions that adjust a robot’s shape. If this parameter is set,isPathValidwill do full collision checking.

**`Description`**
- Type: `unknown`
- Reference frame.

**`Description`**
- Type: `unknown`
- Height of costmap (m).

**`Description`**
- Type: `unknown`
- Width of costmap (m).

**`Description`**
- Type: `unknown`
- Minimum cost of an occupancy grid map to be considered a lethal obstacle.

**`Description`**
- Type: `unknown`
- The height of map, allows to avoid rviz visualization flickering at -0.008

**`Description`**
- Type: `unknown`
- X origin of the costmap relative to width (m).

**`Description`**
- Type: `unknown`
- Y origin of the costmap relative to height (m).

**`Description`**
- Type: `unknown`
- Frequency to publish costmap to topic.

**`Description`**
- Type: `unknown`
- Resolution of 1 pixel of the costmap, in meters.

**`Description`**
- Type: `unknown`
- Robot base frame.

**`Description`**
- Type: `unknown`
- Robot radius to use, if footprint coordinates not provided. If this parameter is set,isPathValidwill do circular collision checking.

**`Description`**
- Type: `unknown`
- If true, the costmap will subscribe to PolygonStamped footprint messages instead of Polygon messages. This allows the footprint to include timestamp and frame information, which can be useful for applications that need temporally-aware footprint data.

**`Description`**
- Type: `unknown`
- Whether costmap should roll with robot base frame.

**`Description`**
- Type: `unknown`
- If false, treats unknown space as free space, else as unknown space.

**`Description`**
- Type: `unknown`
- TF transform tolerance.

**`Description`**
- Type: `unknown`
- Time to wait for the transform from robot base frame to global frame to become available. If exceeded, the  configuration stage is aborted.

**`Description`**
- Type: `unknown`
- If occupancy grid map should be interpreted as only 3 values (free, occupied, unknown) or with its stored values.

**`Description`**
- Type: `unknown`
- Cost of unknown space if tracking it.

**`Description`**
- Type: `unknown`
- The OccupancyGrid values that representsINSCRIBED_INFLATED_OBSTACLEduring costmap conversion operations.

**`Description`**
- Type: `unknown`
- Costmap update frequency.

**`Description`**
- Type: `unknown`
- whether when combining costmaps to use the maximum cost or override.

**`Description`**
- Type: `unknown`
- List of mapped plugin names for parameter namespaces and names.

**`Note`**
- Type: `unknown`
- Each plugin namespace defined in this list needs to have apluginparameter defining the type of plugin to be loaded in the namespace.Example:local_costmap:ros__parameters:plugins:["obstacle_layer","voxel_layer","inflation_layer"]obstacle_layer:plugin:"nav2_costmap_2d::ObstacleLayer"voxel_layer:plugin:"nav2_costmap_2d::VoxelLayer"inflation_layer:plugin:"nav2_costmap_2d::InflationLayer"

**`Description`**
- Type: `unknown`
- List of mapped costmap filter names for parameter namespaces and names.

**`Note`**
- Type: `unknown`
- Costmap filters are also loadable plugins just as ordinary costmap layers. This separation is made to avoid plugin and filter interference and places these filters on top of the combined layered costmap. As  with plugins, each costmap filter namespace defined in this list needs to have apluginparameter defining the type of filter plugin to be loaded in the namespace.Example:local_costmap:ros__parameters:filters:["keepout_filter","speed_filter"]keepout_filter:plugin:"nav2_costmap_2d::KeepoutFilter"speed_filter:plugin:"nav2_costmap_2d::SpeedFilter"

**`“static_layer”`**
- Type: `unknown`
- 

**`“obstacle_layer”`**
- Type: `unknown`
- 

**`“inflation_layer”`**
- Type: `unknown`
- 


---

#### Coverage Server

*Source: [https://docs.nav2.org/configuration/packages/configuring-coverage-server.html](https://docs.nav2.org/configuration/packages/configuring-coverage-server.html)*

##### Coverage Server

Source code on [Github](https://github.com/open-navigation/opennav_coverage).

The Coverage Server in `opennav_coverage` implements the server for handling the complete-coverage planning requests of a given field or zone set in cartesian or GPS coordinates using the Fields2Cover library.
It can also compute coverage route and plans using a precomputed set of rows using the `opennav_row_coverage` server.
It is within the `opennav_coverage` project, not within Nav2 directly, but is planned for a longer-term integration once a few key features are available in Fields2Cover. If you wish to contribute to this effort, please let a maintainer know!

Note: All `default_` prefixed parameters can be overwritten in the action request field. When modes are not set in the Action goal, the defaults are utilized.

###### Parameters

coordinates\_in\_cartesian\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether or not requests coming into the server will be in cartesian (e.g. meters) or GPS coordinates. If GPS, they are automatically converted into UTM frame (for meters) to compute the coverage paths, then converted back into GPS for the client.
```

robot\_width
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.1 |
```

```
Description
:   The robot’s width in meters.
```

operation\_width
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.5 |
```

```
Description
:   The robot’s operational width (cleaning, planting, etc) for computing coverage swath distances
```

min\_turning\_radius
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.4 |
```

```
Description
:   The robot’s minimum turning radius for computing paths connecting route swaths (m)
```

linear\_curv\_change
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description
:   The robot’s maximum linear curvature change for computing paths connecting route swaths (1/m^2)
```

default\_allow\_overlap
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether, by default, to allow overlapping of the last row in the coverage plan to obtain coverage at the far edge. Only for `opennav_coverage`.
```

default\_headland\_type
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “CONSTANT” |
```

```
Description
:   The default headland generation method. Constant is the only valid method currently. Only for `opennav_coverage`.
```

default\_headland\_width
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description
:   The default headland width to remove from the field or zone from coverage planning. Only for `opennav_coverage`.
```

default\_swath\_type
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “LENGTH” |
```

```
Description
:   Objective to use to score swath generation candidates at different angles when using `BRUTE_FORCE` swath angle type. Options: `LENGTH`, `COVERAGE`, `NUMBER` for `opennav_coverage`. Option: `OFFSET`, `CENTER`, `ROWSARESWATHS` for `opennav_row_coverage`.
    Note that `Coverage` takes 10x longer than others.
```

default\_swath\_angle\_type
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.7e-2 |
```

```
Description
:   Mode to use for generating swaths. Need to find optimal angle by the swath generator objectives, if not given. Options: `BRUTE_FORCE`, `SET_ANGLE`. Only for `opennav_coverage`.
```

default\_step\_angle
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.7e-2 |
```

```
Description
:   The angular step size to try to find the optimal angle for route objective, when using `BRUTE_FORCE` swath angle type. Default is 1 deg in rad units. Only for `opennav_coverage`.
```

default\_swath\_angle
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | N/A |
```

```
Description
:   The optimal angle for route objective, when using `SET_ANGLE` swath angle type. Default is 1 deg in rad units. Only for `opennav_coverage`.
```

default\_route\_type
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “BOUSTROPHEDON” |
```

```
Description
:   Default order when computing routes to order swaths. Options: `BOUSTROPHEDON`, `SNAKE`, `SPIRAL`, `CUSTOM`
```

default\_custom\_order
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<int> | N/A |
```

```
Description
:   The default custom swath order for the route planner in the `CUSTOM` mode. The length of this custom order must be `>= swaths.size()`. Only relevant when using the `CUSTOM` Route Type.
```

default\_spiral\_n
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 4 |
```

```
Description
:   Default number of swaths to skip and double back on to create a spiral pattern in the route. Only relevant when using the `SPIRAL` Route Type. `SNAKE` is a special case when Spiral N = 2.
```

default\_path\_continuity\_type
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “CONTINUOUS” |
```

```
Description
:   Default continuity type when computing paths to connect routes together. Options `DISCONTINUOUS`, `CONTINUOUS`.
```

default\_path\_type
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “DUBIN” |
```

```
Description
:   Default type when computing paths to connect routes together using curves. Options: `DUBIN`, `REEDS_SHEPP`.
```

default\_turn\_point\_distance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
Description
:   Distance between points on the plan and route for sending back in paths (e.g. 0.1m). This impacts the density of the output turn paths and the overall nav paths.
```

default\_offset
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Offset to use for computing swaths from annotated rows. Only for `opennav_row_coverage`.
```

order\_ids
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | 0.0 |
```

```
Description
:   For `opennav_row_coverage`, whether to reorder the parsed rows in the order of their `id` s.
```

###### Example

```
coverage_server:
  ros__parameters:
    coordinates_in_cartesian_frame: true
    robot_width: 2.1
    operation_width: 2.5
    min_turning_radius: 0.4
    linear_curv_change: 2.0
    default_allow_overlap: true
    default_headland_width: 0.5
    default_path_continuity_type: "CONTINUOUS"
    default_path_type: "DUBINS"
    default_route_type: "BOUSTROPHEDON"
    default_swath_angle_type: "BRUTE_FORCE"
    default_swath_type: "LENGTH"
    default_turn_point_distance: 0.1
```

#### Parameters

**`coordinates_in_cartesian_frame`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether or not requests coming into the server will be in cartesian (e.g. meters) or GPS coordinates. If GPS, they are automatically converted into UTM frame (for meters) to compute the coverage paths, then converted back into GPS for the client.

**`robot_width`**
- Type: `unknown`
- TypeDefaultdouble2.1DescriptionThe robot’s width in meters.

**`operation_width`**
- Type: `unknown`
- TypeDefaultdouble2.5DescriptionThe robot’s operational width (cleaning, planting, etc) for computing coverage swath distances

**`min_turning_radius`**
- Type: `unknown`
- TypeDefaultdouble0.4DescriptionThe robot’s minimum turning radius for computing paths connecting route swaths (m)

**`linear_curv_change`**
- Type: `unknown`
- TypeDefaultdouble2.0DescriptionThe robot’s maximum linear curvature change for computing paths connecting route swaths (1/m^2)

**`default_allow_overlap`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether, by default, to allow overlapping of the last row in the coverage plan to obtain coverage at the far edge. Only foropennav_coverage.

**`default_headland_type`**
- Type: `unknown`
- TypeDefaultstring“CONSTANT”DescriptionThe default headland generation method. Constant is the only valid method currently. Only foropennav_coverage.

**`default_headland_width`**
- Type: `unknown`
- TypeDefaultdouble2.0DescriptionThe default headland width to remove from the field or zone from coverage planning. Only foropennav_coverage.

**`default_swath_type`**
- Type: `unknown`
- TypeDefaultstring“LENGTH”DescriptionObjective to use to score swath generation candidates at different angles when usingBRUTE_FORCEswath angle type. Options:LENGTH,COVERAGE,NUMBERforopennav_coverage. Option:OFFSET,CENTER,ROWSARESWATHSforopennav_row_coverage.
Note thatCoveragetakes 10x longer than others.

**`default_swath_angle_type`**
- Type: `unknown`
- TypeDefaultdouble1.7e-2DescriptionMode to use for generating swaths. Need to find optimal angle by the swath generator objectives, if not given. Options:BRUTE_FORCE,SET_ANGLE. Only foropennav_coverage.

**`default_step_angle`**
- Type: `unknown`
- TypeDefaultdouble1.7e-2DescriptionThe angular step size to try to find the optimal angle for route objective, when usingBRUTE_FORCEswath angle type. Default is 1 deg in rad units. Only foropennav_coverage.

**`default_swath_angle`**
- Type: `unknown`
- TypeDefaultdoubleN/ADescriptionThe optimal angle for route objective, when usingSET_ANGLEswath angle type. Default is 1 deg in rad units. Only foropennav_coverage.

**`default_route_type`**
- Type: `unknown`
- TypeDefaultstring“BOUSTROPHEDON”DescriptionDefault order when computing routes to order swaths. Options:BOUSTROPHEDON,SNAKE,SPIRAL,CUSTOM

**`default_custom_order`**
- Type: `unknown`
- TypeDefaultvector<int>N/ADescriptionThe default custom swath order for the route planner in theCUSTOMmode. The length of this custom order must be>=swaths.size(). Only relevant when using theCUSTOMRoute Type.

**`default_spiral_n`**
- Type: `unknown`
- TypeDefaultint4DescriptionDefault number of swaths to skip and double back on to create a spiral pattern in the route. Only relevant when using theSPIRALRoute Type.SNAKEis a special case when Spiral N = 2.

**`default_path_continuity_type`**
- Type: `unknown`
- TypeDefaultstring“CONTINUOUS”DescriptionDefault continuity type when computing paths to connect routes together. OptionsDISCONTINUOUS,CONTINUOUS.

**`default_path_type`**
- Type: `unknown`
- TypeDefaultstring“DUBIN”DescriptionDefault type when computing paths to connect routes together using curves. Options:DUBIN,REEDS_SHEPP.

**`default_turn_point_distance`**
- Type: `unknown`
- TypeDefaultdouble0.1DescriptionDistance between points on the plan and route for sending back in paths (e.g. 0.1m). This impacts the density of the output turn paths and the overall nav paths.

**`default_offset`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionOffset to use for computing swaths from annotated rows. Only foropennav_row_coverage.

**`order_ids`**
- Type: `unknown`
- TypeDefaultbool0.0DescriptionForopennav_row_coverage, whether to reorder the parsed rows in the order of theirids.

**`Description`**
- Type: `unknown`
- Whether or not requests coming into the server will be in cartesian (e.g. meters) or GPS coordinates. If GPS, they are automatically converted into UTM frame (for meters) to compute the coverage paths, then converted back into GPS for the client.

**`Description`**
- Type: `unknown`
- The robot’s width in meters.

**`Description`**
- Type: `unknown`
- The robot’s operational width (cleaning, planting, etc) for computing coverage swath distances

**`Description`**
- Type: `unknown`
- The robot’s minimum turning radius for computing paths connecting route swaths (m)

**`Description`**
- Type: `unknown`
- The robot’s maximum linear curvature change for computing paths connecting route swaths (1/m^2)

**`Description`**
- Type: `unknown`
- Whether, by default, to allow overlapping of the last row in the coverage plan to obtain coverage at the far edge. Only foropennav_coverage.

**`Description`**
- Type: `unknown`
- The default headland generation method. Constant is the only valid method currently. Only foropennav_coverage.

**`Description`**
- Type: `unknown`
- The default headland width to remove from the field or zone from coverage planning. Only foropennav_coverage.

**`Description`**
- Type: `unknown`
- Objective to use to score swath generation candidates at different angles when usingBRUTE_FORCEswath angle type. Options:LENGTH,COVERAGE,NUMBERforopennav_coverage. Option:OFFSET,CENTER,ROWSARESWATHSforopennav_row_coverage.
Note thatCoveragetakes 10x longer than others.

**`Description`**
- Type: `unknown`
- Mode to use for generating swaths. Need to find optimal angle by the swath generator objectives, if not given. Options:BRUTE_FORCE,SET_ANGLE. Only foropennav_coverage.

**`Description`**
- Type: `unknown`
- The angular step size to try to find the optimal angle for route objective, when usingBRUTE_FORCEswath angle type. Default is 1 deg in rad units. Only foropennav_coverage.

**`Description`**
- Type: `unknown`
- The optimal angle for route objective, when usingSET_ANGLEswath angle type. Default is 1 deg in rad units. Only foropennav_coverage.

**`Description`**
- Type: `unknown`
- Default order when computing routes to order swaths. Options:BOUSTROPHEDON,SNAKE,SPIRAL,CUSTOM

**`Description`**
- Type: `unknown`
- The default custom swath order for the route planner in theCUSTOMmode. The length of this custom order must be>=swaths.size(). Only relevant when using theCUSTOMRoute Type.

**`Description`**
- Type: `unknown`
- Default number of swaths to skip and double back on to create a spiral pattern in the route. Only relevant when using theSPIRALRoute Type.SNAKEis a special case when Spiral N = 2.

**`Description`**
- Type: `unknown`
- Default continuity type when computing paths to connect routes together. OptionsDISCONTINUOUS,CONTINUOUS.

**`Description`**
- Type: `unknown`
- Default type when computing paths to connect routes together using curves. Options:DUBIN,REEDS_SHEPP.

**`Description`**
- Type: `unknown`
- Distance between points on the plan and route for sending back in paths (e.g. 0.1m). This impacts the density of the output turn paths and the overall nav paths.

**`Description`**
- Type: `unknown`
- Offset to use for computing swaths from annotated rows. Only foropennav_row_coverage.

**`Description`**
- Type: `unknown`
- Foropennav_row_coverage, whether to reorder the parsed rows in the order of theirids.


---

#### Docking Server

*Source: [https://docs.nav2.org/configuration/packages/configuring-docking-server.html](https://docs.nav2.org/configuration/packages/configuring-docking-server.html)*

##### Docking Server

Source code on [Github](https://github.com/open-navigation/opennav_docking).

The Docking Server in `opennav_docking` implements a server for docking and undocking a robot.
This can be from Charging stations (i.e. docks) or non-charging docking locations such as the end of a conveyor belt or a pallet.
It uses plugin dock implementations for a particular platform to enable the framework to generalize to robots of many different kinematic models, charging methods, sensor modalities, charging-type, and so on.
It can also handle a database of many different docking locations and dock models to handle a heterogeneous environment.
This task server is designed be called by an application BT or autonomy application to dock once completed with tasks or battery is low – not within the navigate-to-pose action itself (though undock may be called from inside navigate actions!).

Thanks to NVIDIA for sponsoring this Docking Server package!

###### Parameters

controller\_frequency
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 50.0 |
```

```
Description
:   Control frequency (Hz) for vision-control loop.
```

initial\_perception\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 5.0 |
```

```
Description
:   Timeout (s) to wait to obtain initial perception of the dock.
```

wait\_charge\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 5.0 |
```

```
Description
:   Timeout (s) to wait to see if charging starts after docking.
```

dock\_approach\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 30.0 |
```

```
Description
:   Timeout (s) to attempt vision-control approach loop.
```

undock\_linear\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.05 |
```

```
Description
:   Tolerance (m) to exit the undocking control loop at staging pose.
```

undock\_angular\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.05 |
```

```
Description
:   Angular tolerance (rad) to exit undocking loop at staging pose.
```

rotation\_angular\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.05 |
```

```
Description
:   Angular tolerance (rad) to exit the rotation loop when rotate\_to\_dock is enabled.
```

max\_retries
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 3 |
```

```
Description
:   Maximum number of retries to attempt.
```

base\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “base\_link” |
```

```
Description
:   Robot’s base frame for control law.
```

fixed\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “odom” |
```

```
Description
:   Fixed frame to use, recommended to be a smooth odometry frame **not** map.
```

odom\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “odom” |
```

```
Description
:   The topic to use for the odometry data when rotate\_to\_dock is enabled.
```

odom\_duration
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.3 |
```

```
Description
:   Time (s) to buffer odometry commands to estimate the robot speed.
```

dock\_backwards
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether the robot is docking with the dock forward or backward in motion. This parameter is deprecated. Use the dock plugin’s `dock_direction` parameter instead.
```

dock\_prestaging\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description
:   L2 distance in X,Y,Theta from the staging pose to bypass navigation.
```

dock\_plugins
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | N/A |
```

```
Description
:   A set of dock plugins to load.
```

dock\_database
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   The filepath to the dock database to use for this environment. Use `docks` or this param.
```

docks
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | N/A |
```

```
Description
:   Instead of dock\_database, the set of docks specified in the params file itself. Use `dock_database` or this param.
```

navigator\_bt\_xml
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “” |
```

```
Description
:   BT XML to use for Navigator, if non-default.
```

introspection\_mode
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “disabled” |
```

```
Description
:   The introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.
```

allow\_parameter\_qos\_overrides
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to allow QoS profiles to be overwritten with parameterized values.
```

controller.k\_phi
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 3.0 |
```

```
Description
:   Ratio of the rate of change of angle relative to distance from the target. Much be > 0.
```

controller.k\_delta
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description
:   Higher values result in converging to the target more quickly.
```

controller.beta
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.4 |
```

```
Description
:   Parameter to reduce linear velocity proportional to path curvature. Increasing this linearly reduces the velocity (v(t) = v\_max / (1 + beta \* |curv|^lambda)).
```

controller.lambda
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description
:   Parameter to reduce linear velocity proportional to path curvature. Increasing this exponentially reduces the velocity (v(t) = v\_max / (1 + beta \* |curv|^lambda)).
```

controller.v\_linear\_min
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
Description
:   Minimum velocity for approaching dock.
```

controller.v\_linear\_max
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.24 |
```

```
Description
:   Maximum velocity for approaching dock.
```

controller.v\_angular\_max
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.75 |
```

```
Description
:   Maximum angular velocity for approaching dock.
```

controller.slowdown\_radius
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
Description
:   Radius to end goal to commense slow down.
```

controller.rotate\_to\_heading\_angular\_vel
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   Angular velocity (rad/s) to rotate to the goal heading when rotate\_to\_dock is enabled.
```

controller.rotate\_to\_heading\_max\_angular\_accel
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 3.2 |
```

```
Description
:   Maximum angular acceleration (rad/s^2) to rotate to the goal heading when rotate\_to\_dock is enabled.
```

controller.use\_collision\_detection
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to use collision detection to avoid obstacles.
```

controller.costmap\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “local\_costmap/costmap\_raw” |
```

```
Description
:   Raw costmap topic for collision checking.
```

controller.footprint\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “local\_costmap/published\_footprint” |
```

```
Description
:   Topic for footprint in the costmap frame.
```

controller.transform\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
Description
:   Time with which to post-date the transform that is published, to indicate that this transform is valid into the future.
```

controller.projection\_time
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   Time to look ahead for collisions (s).
```

controller.simulation\_time\_step
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
Description
:   Time step for projections (s).
```

controller.dock\_collision\_threshold
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.3 |
```

```
Description
:   Distance (m) from the dock pose to ignore collisions, i.e. the robot will not check for collisions within this distance from the dock pose, as the robot will make contact with the dock. Set to `0.0` when physical contact is not made with a dock.
```

Note: `dock_plugins` and either `docks` or `dock_database` are required.

###### SimpleChargingDock Parameters

Simple Charging Dock is a provided charging dock plugin that can handle many docks and common techniques.

<dock\_name>.staging\_x\_offset
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | -0.7 |
```

```
Description
:   Staging pose offset forward (negative) of dock pose (m).
```

<dock\_name>.staging\_yaw\_offset
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Staging pose angle relative to dock pose (rad). If `dock_direction` is set to “backward”, this angle must be faced in the opposite direction of the dock pose. However, if `rotate_to_dock` is enabled, this angle must be facing the same direction as the dock pose because the robot will rotate to the dock pose after detection.
```

<dock\_name>.use\_battery\_status
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to use the battery state message or `isDocked()` for `isCharging()`.
```

<dock\_name>.use\_external\_detection\_pose
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to use external detection topic for dock or use the databases’ pose.
```

<dock\_name>.detector\_service\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “” |
```

```
Description
:   Optional `std_srvs/Trigger` service invoked when detection starts or stops via `startDetectionProcess` / `stopDetectionProcess` if detection method accepts a service call to start and stop.
```

<dock\_name>.detector\_service\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 5.0 |
```

```
Description
:   Timeout (s) to wait for `detector_service_name` to become available and respond.
```

<dock\_name>.subscribe\_toggle
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   When true, subscribe to `detected_dock_pose` only while detection is active; otherwise keep the subscription persistent.
```

<dock\_name>.external\_detection\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   Timeout (s) at which if the newest detection update does not meet to fail.
```

<dock\_name>.external\_detection\_translation\_x
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | -0.20 |
```

```
Description
:   X offset from detected pose for docking pose (m).
```

<dock\_name>.external\_detection\_translation\_y
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Y offset from detected pose for docking pose (m).
```

<dock\_name>.external\_detection\_rotation\_yaw
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Yaw offset from detected pose for docking pose (rad).
```

<dock\_name>.external\_detection\_rotation\_pitch
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.57 |
```

```
Description
:   Pitch offset from detected pose for docking pose (rad). Note: The external detection rotation angles are setup to work out of the box with Apriltags detectors in image\_proc and isaac\_ros.
```

<dock\_name>.external\_detection\_rotation\_roll
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | -1.57 |
```

```
Description
:   Roll offset from detected pose for docking pose (rad). Note: The external detection rotation angles are setup to work out of the box with Apriltags detectors in image\_proc and isaac\_ros.
```

<dock\_name>.filter\_coef
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
Description
:   Dock external detection method filtering algorithm coefficient.
```

<dock\_name>.charging\_threshold
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description
:   Threshold of current in battery state above which `isCharging() = true`.
```

<dock\_name>.use\_stall\_detection
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether or not to use stall detection for `isDocked()` or positional threshold.
```

<dock\_name>.stall\_joint\_names
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | N/A |
```

```
Description
:   Names in `joint_states` topic of joints to track.
```

<dock\_name>.stall\_velocity\_threshold
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   The joint velocity below which to trigger `isDocked() = true`.
```

<dock\_name>.stall\_effort\_threshold
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   Current or motor effort in joint state to trigger `isDocked() = true`.
```

<dock\_name>.docking\_threshold
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.05 |
```

```
Description
:   If not using stall detection, the pose threshold to the docking pose where `isDocked() = true`.
```

<dock\_name>.dock\_direction
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “forward” |
```

```
Description
:   Whether the robot is docking with the dock forward or backward in motion. This is the replacement for the deprecated `dock_backwards` parameter. Options are “forward” or “backward”.
```

<dock\_name>.rotate\_to\_dock
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Enables backward docking without requiring a sensor for detection during the final approach. When enabled, the robot approaches the staging pose facing forward with sensor coverage for dock detection; after detection, it rotates and backs into the dock using only the initially detected pose for dead reckoning. In the undocking phase, the robot will move forward to the staging pose and then rotate to the original heading. This may also be paired with sensor detection in the reverse direction as well if available.
```

```
    Note: This parameter is only valid when the `dock_direction` is set to “backward”.
```

###### Example

```
docking_server:
  ros__parameters:
    controller_frequency: 50.0
    initial_perception_timeout: 5.0
    wait_charge_timeout: 5.0
    dock_approach_timeout: 30.0
    undock_linear_tolerance: 0.05
    undock_angular_tolerance: 0.1
    max_retries: 3
    base_frame: "base_link"
    fixed_frame: "odom"
    odom_topic: "odom"
    odom_duration: 0.3
    dock_backwards: false  # Deprecated, use dock_direction in plugin
    dock_prestaging_tolerance: 0.5
    introspection_mode: "disabled"

    # Types of docks
    dock_plugins: ['nova_carter_dock']
    nova_carter_dock:
      plugin: 'opennav_docking::SimpleChargingDock'  # Also 'opennav_docking::SimpleNonChargingDock'
      docking_threshold: 0.05
      staging_x_offset: -0.7
      use_external_detection_pose: true
      detector_service_name: '/detector/toggle'
      detector_service_timeout: 5.0
      subscribe_toggle: true
      use_battery_status: false # true
      use_stall_detection: false
      rotate_to_dock: false

      external_detection_timeout: 1.0
      external_detection_translation_x: -0.18
      external_detection_translation_y: 0.0
      external_detection_rotation_roll: -1.57
      external_detection_rotation_pitch: -1.57
      external_detection_rotation_yaw: 0.0
      filter_coef: 0.1
      dock_direction: "forward" # "backward"

    # Dock instances
    docks: ['home_dock']
    home_dock:
      type: 'nova_carter_dock'
      frame: map
      pose: [0.0, 0.0, 0.0]
      id: 'c67f50cb-e152-4720-85cc-5eb20bd85ce8'

    controller:
      k_phi: 3.0
      k_delta: 2.0
      v_linear_min: 0.15
      v_linear_max: 0.15
      v_angular_max: 0.75
      slowdown_radius: 0.25
      rotate_to_heading_angular_vel: 1.0
      rotate_to_heading_max_angular_accel: 3.2
      use_collision_detection: true
      costmap_topic: "local_costmap/costmap_raw"
      footprint_topic: "local_costmap/published_footprint"
      transform_tolerance: 0.1
      projection_time: 1.0
      simulation_time_step: 0.1
      dock_collision_threshold: 0.3
```

#### Parameters

**`controller_frequency`**
- Type: `unknown`
- TypeDefaultdouble50.0DescriptionControl frequency (Hz) for vision-control loop.

**`initial_perception_timeout`**
- Type: `unknown`
- TypeDefaultdouble5.0DescriptionTimeout (s) to wait to obtain initial perception of the dock.

**`wait_charge_timeout`**
- Type: `unknown`
- TypeDefaultdouble5.0DescriptionTimeout (s) to wait to see if charging starts after docking.

**`dock_approach_timeout`**
- Type: `unknown`
- TypeDefaultdouble30.0DescriptionTimeout (s) to attempt vision-control approach loop.

**`undock_linear_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.05DescriptionTolerance (m) to exit the undocking control loop at staging pose.

**`undock_angular_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.05DescriptionAngular tolerance (rad) to exit undocking loop at staging pose.

**`rotation_angular_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.05DescriptionAngular tolerance (rad) to exit the rotation loop when rotate_to_dock is enabled.

**`max_retries`**
- Type: `unknown`
- TypeDefaultint3DescriptionMaximum number of retries to attempt.

**`base_frame`**
- Type: `unknown`
- TypeDefaultstring“base_link”DescriptionRobot’s base frame for control law.

**`fixed_frame`**
- Type: `unknown`
- TypeDefaultstring“odom”DescriptionFixed frame to use, recommended to be a smooth odometry framenotmap.

**`odom_topic`**
- Type: `unknown`
- TypeDefaultstring“odom”DescriptionThe topic to use for the odometry data when rotate_to_dock is enabled.

**`odom_duration`**
- Type: `unknown`
- TypeDefaultdouble0.3DescriptionTime (s) to buffer odometry commands to estimate the robot speed.

**`dock_backwards`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether the robot is docking with the dock forward or backward in motion. This parameter is deprecated. Use the dock plugin’sdock_directionparameter instead.

**`dock_prestaging_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.5DescriptionL2 distance in X,Y,Theta from the staging pose to bypass navigation.

**`dock_plugins`**
- Type: `unknown`
- TypeDefaultvector<string>N/ADescriptionA set of dock plugins to load.

**`dock_database`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionThe filepath to the dock database to use for this environment. Usedocksor this param.

**`docks`**
- Type: `unknown`
- TypeDefaultvector<string>N/ADescriptionInstead ofdock_database, the set of docks specified in the params file itself. Usedock_databaseor this param.

**`navigator_bt_xml`**
- Type: `unknown`
- TypeDefaultstring“”DescriptionBT XML to use for Navigator, if non-default.

**`introspection_mode`**
- Type: `unknown`
- TypeDefaultstring“disabled”DescriptionThe introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.

**`allow_parameter_qos_overrides`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to allow QoS profiles to be overwritten with parameterized values.

**`controller.k_phi`**
- Type: `unknown`
- TypeDefaultdouble3.0DescriptionRatio of the rate of change of angle relative to distance from the target. Much be > 0.

**`controller.k_delta`**
- Type: `unknown`
- TypeDefaultdouble2.0DescriptionHigher values result in converging to the target more quickly.

**`controller.beta`**
- Type: `unknown`
- TypeDefaultdouble0.4DescriptionParameter to reduce linear velocity proportional to path curvature. Increasing this linearly reduces the velocity (v(t) = v_max / (1 + beta * |curv|^lambda)).

**`controller.lambda`**
- Type: `unknown`
- TypeDefaultdouble2.0DescriptionParameter to reduce linear velocity proportional to path curvature. Increasing this exponentially reduces the velocity (v(t) = v_max / (1 + beta * |curv|^lambda)).

**`controller.v_linear_min`**
- Type: `unknown`
- TypeDefaultdouble0.1DescriptionMinimum velocity for approaching dock.

**`controller.v_linear_max`**
- Type: `unknown`
- TypeDefaultdouble0.24DescriptionMaximum velocity for approaching dock.

**`controller.v_angular_max`**
- Type: `unknown`
- TypeDefaultdouble0.75DescriptionMaximum angular velocity for approaching dock.

**`controller.slowdown_radius`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionRadius to end goal to commense slow down.

**`controller.rotate_to_heading_angular_vel`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionAngular velocity (rad/s) to rotate to the goal heading when rotate_to_dock is enabled.

**`controller.rotate_to_heading_max_angular_accel`**
- Type: `unknown`
- TypeDefaultdouble3.2DescriptionMaximum angular acceleration (rad/s^2) to rotate to the goal heading when rotate_to_dock is enabled.

**`controller.use_collision_detection`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to use collision detection to avoid obstacles.

**`controller.costmap_topic`**
- Type: `unknown`
- TypeDefaultstring“local_costmap/costmap_raw”DescriptionRaw costmap topic for collision checking.

**`controller.footprint_topic`**
- Type: `unknown`
- TypeDefaultstring“local_costmap/published_footprint”DescriptionTopic for footprint in the costmap frame.

**`controller.transform_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.1DescriptionTime with which to post-date the transform that is published, to indicate that this transform is valid into the future.

**`controller.projection_time`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionTime to look ahead for collisions (s).

**`controller.simulation_time_step`**
- Type: `unknown`
- TypeDefaultdouble0.1DescriptionTime step for projections (s).

**`controller.dock_collision_threshold`**
- Type: `unknown`
- TypeDefaultdouble0.3DescriptionDistance (m) from the dock pose to ignore collisions, i.e. the robot will not check for collisions within this distance from the dock pose, as the robot will make contact with the dock. Set to0.0when physical contact is not made with a dock.

**`Description`**
- Type: `unknown`
- Control frequency (Hz) for vision-control loop.

**`Description`**
- Type: `unknown`
- Timeout (s) to wait to obtain initial perception of the dock.

**`Description`**
- Type: `unknown`
- Timeout (s) to wait to see if charging starts after docking.

**`Description`**
- Type: `unknown`
- Timeout (s) to attempt vision-control approach loop.

**`Description`**
- Type: `unknown`
- Tolerance (m) to exit the undocking control loop at staging pose.

**`Description`**
- Type: `unknown`
- Angular tolerance (rad) to exit undocking loop at staging pose.

**`Description`**
- Type: `unknown`
- Angular tolerance (rad) to exit the rotation loop when rotate_to_dock is enabled.

**`Description`**
- Type: `unknown`
- Maximum number of retries to attempt.

**`Description`**
- Type: `unknown`
- Robot’s base frame for control law.

**`Description`**
- Type: `unknown`
- Fixed frame to use, recommended to be a smooth odometry framenotmap.

**`Description`**
- Type: `unknown`
- The topic to use for the odometry data when rotate_to_dock is enabled.

**`Description`**
- Type: `unknown`
- Time (s) to buffer odometry commands to estimate the robot speed.

**`Description`**
- Type: `unknown`
- Whether the robot is docking with the dock forward or backward in motion. This parameter is deprecated. Use the dock plugin’sdock_directionparameter instead.

**`Description`**
- Type: `unknown`
- L2 distance in X,Y,Theta from the staging pose to bypass navigation.

**`Description`**
- Type: `unknown`
- A set of dock plugins to load.

**`Description`**
- Type: `unknown`
- The filepath to the dock database to use for this environment. Usedocksor this param.

**`Description`**
- Type: `unknown`
- Instead ofdock_database, the set of docks specified in the params file itself. Usedock_databaseor this param.

**`Description`**
- Type: `unknown`
- BT XML to use for Navigator, if non-default.

**`Description`**
- Type: `unknown`
- The introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.

**`Description`**
- Type: `unknown`
- Whether to allow QoS profiles to be overwritten with parameterized values.

**`Description`**
- Type: `unknown`
- Ratio of the rate of change of angle relative to distance from the target. Much be > 0.

**`Description`**
- Type: `unknown`
- Higher values result in converging to the target more quickly.

**`Description`**
- Type: `unknown`
- Parameter to reduce linear velocity proportional to path curvature. Increasing this linearly reduces the velocity (v(t) = v_max / (1 + beta * |curv|^lambda)).

**`Description`**
- Type: `unknown`
- Parameter to reduce linear velocity proportional to path curvature. Increasing this exponentially reduces the velocity (v(t) = v_max / (1 + beta * |curv|^lambda)).

**`Description`**
- Type: `unknown`
- Minimum velocity for approaching dock.

**`Description`**
- Type: `unknown`
- Maximum velocity for approaching dock.

**`Description`**
- Type: `unknown`
- Maximum angular velocity for approaching dock.

**`Description`**
- Type: `unknown`
- Radius to end goal to commense slow down.

**`Description`**
- Type: `unknown`
- Angular velocity (rad/s) to rotate to the goal heading when rotate_to_dock is enabled.

**`Description`**
- Type: `unknown`
- Maximum angular acceleration (rad/s^2) to rotate to the goal heading when rotate_to_dock is enabled.

**`Description`**
- Type: `unknown`
- Whether to use collision detection to avoid obstacles.

**`Description`**
- Type: `unknown`
- Raw costmap topic for collision checking.

**`Description`**
- Type: `unknown`
- Topic for footprint in the costmap frame.

**`Description`**
- Type: `unknown`
- Time with which to post-date the transform that is published, to indicate that this transform is valid into the future.

**`Description`**
- Type: `unknown`
- Time to look ahead for collisions (s).

**`Description`**
- Type: `unknown`
- Time step for projections (s).

**`Description`**
- Type: `unknown`
- Distance (m) from the dock pose to ignore collisions, i.e. the robot will not check for collisions within this distance from the dock pose, as the robot will make contact with the dock. Set to0.0when physical contact is not made with a dock.

**`<dock_name>.staging_x_offset`**
- Type: `unknown`
- TypeDefaultdouble-0.7DescriptionStaging pose offset forward (negative) of dock pose (m).

**`<dock_name>.staging_yaw_offset`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionStaging pose angle relative to dock pose (rad). Ifdock_directionis set to “backward”, this angle must be faced in the opposite direction of the dock pose. However, ifrotate_to_dockis enabled, this angle must be facing the same direction as the dock pose because the robot will rotate to the dock pose after detection.

**`<dock_name>.use_battery_status`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to use the battery state message orisDocked()forisCharging().

**`<dock_name>.use_external_detection_pose`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to use external detection topic for dock or use the databases’ pose.

**`<dock_name>.detector_service_name`**
- Type: `unknown`
- TypeDefaultstring“”DescriptionOptionalstd_srvs/Triggerservice invoked when detection starts or stops viastartDetectionProcess/stopDetectionProcessif detection method accepts a service call to start and stop.

**`<dock_name>.detector_service_timeout`**
- Type: `unknown`
- TypeDefaultdouble5.0DescriptionTimeout (s) to wait fordetector_service_nameto become available and respond.

**`<dock_name>.subscribe_toggle`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhen true, subscribe todetected_dock_poseonly while detection is active; otherwise keep the subscription persistent.

**`<dock_name>.external_detection_timeout`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionTimeout (s) at which if the newest detection update does not meet to fail.

**`<dock_name>.external_detection_translation_x`**
- Type: `unknown`
- TypeDefaultdouble-0.20DescriptionX offset from detected pose for docking pose (m).

**`<dock_name>.external_detection_translation_y`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionY offset from detected pose for docking pose (m).

**`<dock_name>.external_detection_rotation_yaw`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionYaw offset from detected pose for docking pose (rad).

**`<dock_name>.external_detection_rotation_pitch`**
- Type: `unknown`
- TypeDefaultdouble1.57DescriptionPitch offset from detected pose for docking pose (rad). Note: The external detection rotation angles are setup to work out of the box with Apriltags detectors inimage_procandisaac_ros.

**`<dock_name>.external_detection_rotation_roll`**
- Type: `unknown`
- TypeDefaultdouble-1.57DescriptionRoll offset from detected pose for docking pose (rad). Note: The external detection rotation angles are setup to work out of the box with Apriltags detectors inimage_procandisaac_ros.

**`<dock_name>.filter_coef`**
- Type: `unknown`
- TypeDefaultdouble0.1DescriptionDock external detection method filtering algorithm coefficient.

**`<dock_name>.charging_threshold`**
- Type: `unknown`
- TypeDefaultdouble0.5DescriptionThreshold of current in battery state above whichisCharging()=true.

**`<dock_name>.use_stall_detection`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether or not to use stall detection forisDocked()or positional threshold.

**`<dock_name>.stall_joint_names`**
- Type: `unknown`
- TypeDefaultvector<string>N/ADescriptionNames injoint_statestopic of joints to track.

**`<dock_name>.stall_velocity_threshold`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionThe joint velocity below which to triggerisDocked()=true.

**`<dock_name>.stall_effort_threshold`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionCurrent or motor effort in joint state to triggerisDocked()=true.

**`<dock_name>.docking_threshold`**
- Type: `unknown`
- TypeDefaultdouble0.05DescriptionIf not using stall detection, the pose threshold to the docking pose whereisDocked()=true.

**`<dock_name>.dock_direction`**
- Type: `unknown`
- TypeDefaultstring“forward”DescriptionWhether the robot is docking with the dock forward or backward in motion. This is the replacement for the deprecateddock_backwardsparameter. Options are “forward” or “backward”.

**`<dock_name>.rotate_to_dock`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionEnables backward docking without requiring a sensor for detection during the final approach. When enabled, the robot approaches the staging pose facing forward with sensor coverage for dock detection; after detection, it rotates and backs into the dock using only the initially detected pose for dead reckoning. In the undocking phase, the robot will move forward to the staging pose and then rotate to the original heading. This may also be paired with sensor detection in the reverse direction as well if available.Note: This parameter is only valid when thedock_directionis set to “backward”.

**`Description`**
- Type: `unknown`
- Staging pose offset forward (negative) of dock pose (m).

**`Description`**
- Type: `unknown`
- Staging pose angle relative to dock pose (rad). Ifdock_directionis set to “backward”, this angle must be faced in the opposite direction of the dock pose. However, ifrotate_to_dockis enabled, this angle must be facing the same direction as the dock pose because the robot will rotate to the dock pose after detection.

**`Description`**
- Type: `unknown`
- Whether to use the battery state message orisDocked()forisCharging().

**`Description`**
- Type: `unknown`
- Whether to use external detection topic for dock or use the databases’ pose.

**`Description`**
- Type: `unknown`
- Optionalstd_srvs/Triggerservice invoked when detection starts or stops viastartDetectionProcess/stopDetectionProcessif detection method accepts a service call to start and stop.

**`Description`**
- Type: `unknown`
- Timeout (s) to wait fordetector_service_nameto become available and respond.

**`Description`**
- Type: `unknown`
- When true, subscribe todetected_dock_poseonly while detection is active; otherwise keep the subscription persistent.

**`Description`**
- Type: `unknown`
- Timeout (s) at which if the newest detection update does not meet to fail.

**`Description`**
- Type: `unknown`
- X offset from detected pose for docking pose (m).

**`Description`**
- Type: `unknown`
- Y offset from detected pose for docking pose (m).

**`Description`**
- Type: `unknown`
- Yaw offset from detected pose for docking pose (rad).

**`Description`**
- Type: `unknown`
- Pitch offset from detected pose for docking pose (rad). Note: The external detection rotation angles are setup to work out of the box with Apriltags detectors inimage_procandisaac_ros.

**`Description`**
- Type: `unknown`
- Roll offset from detected pose for docking pose (rad). Note: The external detection rotation angles are setup to work out of the box with Apriltags detectors inimage_procandisaac_ros.

**`Description`**
- Type: `unknown`
- Dock external detection method filtering algorithm coefficient.

**`Description`**
- Type: `unknown`
- Threshold of current in battery state above whichisCharging()=true.

**`Description`**
- Type: `unknown`
- Whether or not to use stall detection forisDocked()or positional threshold.

**`Description`**
- Type: `unknown`
- Names injoint_statestopic of joints to track.

**`Description`**
- Type: `unknown`
- The joint velocity below which to triggerisDocked()=true.

**`Description`**
- Type: `unknown`
- Current or motor effort in joint state to triggerisDocked()=true.

**`Description`**
- Type: `unknown`
- If not using stall detection, the pose threshold to the docking pose whereisDocked()=true.

**`Description`**
- Type: `unknown`
- Whether the robot is docking with the dock forward or backward in motion. This is the replacement for the deprecateddock_backwardsparameter. Options are “forward” or “backward”.

**`Description`**
- Type: `unknown`
- Enables backward docking without requiring a sensor for detection during the final approach. When enabled, the robot approaches the staging pose facing forward with sensor coverage for dock detection; after detection, it rotates and backs into the dock using only the initially detected pose for dead reckoning. In the undocking phase, the robot will move forward to the staging pose and then rotate to the original heading. This may also be paired with sensor detection in the reverse direction as well if available.Note: This parameter is only valid when thedock_directionis set to “backward”.


---

#### DWB Controller

*Source: [https://docs.nav2.org/configuration/packages/configuring-dwb-controller.html](https://docs.nav2.org/configuration/packages/configuring-dwb-controller.html)*

##### DWB Controller

Source code on [Github](https://github.com/ros-navigation/navigation2/tree/main/nav2_dwb_controller).

The DWB controller is the default controller. It is a fork of [David Lu’s
controller](https://github.com/locusrobotics/robot_navigation/tree/master/dwb_local_planner)
modified for ROS 2 using the Dynamic Window Approach.

###### Controller

* [DWB Controller](dwb-params/controller.html)
* [XYTheta Iterator](dwb-params/iterator.html)
* [Kinematic Parameters](dwb-params/kinematic.html)
* [Publisher](dwb-params/visualization.html)

###### Plugins

The plugins listed below are inside the `dwb_plugins` namespace.

* [LimitedAccelGenerator](dwb-plugins/limited_accel_generator.html)
* [StandardTrajectoryGenerator](dwb-plugins/standard_traj_generator.html)

###### Trajectory Critics

The trajectory critics listed below are inside the `dwb_critics` namespace.

* [BaseObstacleCritic](trajectory_critics/base_obstacle.html)
* [GoalAlignCritic](trajectory_critics/goal_align.html)
* [GoalDistCritic](trajectory_critics/goal_dist.html)
* [ObstacleFootprintCritic](trajectory_critics/obstacle_footprint.html)
* [OscillationCritic](trajectory_critics/oscillation.html)
* [PathAlignCritic](trajectory_critics/path_align.html)
* [PathDistCritic](trajectory_critics/path_dist.html)
* [PreferForwardCritic](trajectory_critics/prefer_forward.html)
* [RotateToGoalCritic](trajectory_critics/rotate_to_goal.html)
* [TwirlingCritic](trajectory_critics/twirling.html)

###### Example

```
controller_server:
  ros__parameters:
    # controller server parameters (see Controller Server for more info)
    controller_frequency: 20.0
    min_x_velocity_threshold: 0.001
    min_y_velocity_threshold: 0.5
    min_theta_velocity_threshold: 0.001
    progress_checker_plugins: ["progress_checker"] # progress_checker_plugin: "progress_checker" For Humble and older
    goal_checker_plugins: ["goal_checker"]
    controller_plugins: ["FollowPath"]
    progress_checker:
      plugin: "nav2_controller::SimpleProgressChecker"
      required_movement_radius: 0.5
      movement_time_allowance: 10.0
    goal_checker:
      plugin: "nav2_controller::SimpleGoalChecker"
      xy_goal_tolerance: 0.25
      yaw_goal_tolerance: 0.25
      stateful: True
    # DWB controller parameters
    FollowPath:
      plugin: "dwb_core::DWBLocalPlanner"
      debug_trajectory_details: True
      min_vel_x: 0.0
      min_vel_y: 0.0
      max_vel_x: 0.26
      max_vel_y: 0.0
      max_vel_theta: 1.0
      min_speed_xy: 0.0
      max_speed_xy: 0.26
      min_speed_theta: 0.0
      acc_lim_x: 2.5
      acc_lim_y: 0.0
      acc_lim_theta: 3.2
      decel_lim_x: -2.5
      decel_lim_y: 0.0
      decel_lim_theta: -3.2
      vx_samples: 20
      vy_samples: 5
      vtheta_samples: 20
      sim_time: 1.7
      linear_granularity: 0.05
      angular_granularity: 0.025
      xy_goal_tolerance: 0.25
      path_length_tolerance: 1.0
      trans_stopped_velocity: 0.25
      short_circuit_trajectory_evaluation: True
      limit_vel_cmd_in_traj: False
      stateful: True
      critics: ["RotateToGoal", "Oscillation", "BaseObstacle", "GoalAlign", "PathAlign", "PathDist", "GoalDist"]
      BaseObstacle.scale: 0.02
      PathAlign.scale: 32.0
      GoalAlign.scale: 24.0
      PathAlign.forward_point_distance: 0.1
      GoalAlign.forward_point_distance: 0.1
      PathDist.scale: 32.0
      GoalDist.scale: 24.0
      RotateToGoal.scale: 32.0
      RotateToGoal.slowing_factor: 5.0
      RotateToGoal.lookahead_time: -1.0
```

---

#### Following Server

*Source: [https://docs.nav2.org/configuration/packages/configuring-following-server.html](https://docs.nav2.org/configuration/packages/configuring-following-server.html)*

##### Following Server

Source code on [Github](https://github.com/ros-navigation/navigation2/tree/main/nav2_following/opennav_following).

The Following Server in `opennav_following` implements a server for following dynamic objects from a detection topic or specific reference frame.
This server allows the robot to follow and maintain a determined distance from a detected object or specific frame,
using topic-based detection techniques or coordinate frame tracking.
The server is designed to be called by a BT application or autonomy application to follow moving objects.


###### Parameters

controller\_frequency
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 50.0 |
```

```
Description
:   Control frequency (Hz) for the following control loop.
```

detection\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description
:   Timeout (s) to wait for detection of the object to follow.
```

rotate\_to\_object\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10.0 |
```

```
Description
:   Timeout (s) to rotate searching for the object when detection is lost.
```

static\_object\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | -1.0 |
```

```
Description
:   Timeout (s) to stop following when the object remains static. If -1.0, the robot will follow indefinitely.
```

linear\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.15 |
```

```
Description
:   Linear tolerance (m) to consider that the target position has been reached.
```

angular\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.15 |
```

```
Description
:   Angular tolerance (rad) to consider that the target orientation has been reached.
```

max\_retries
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 3 |
```

```
Description
:   Maximum number of retries when detection or control fails.
```

base\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “base\_link” |
```

```
Description
:   Robot’s base frame for control law.
```

fixed\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “odom” |
```

```
Description
:   Fixed frame to use, recommended to be a smooth odometry frame **not** map.
```

filter\_coef
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
Description
:   Filter coefficient for smoothing object pose detections.
```

desired\_distance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   Desired distance (m) to maintain from the followed object.
```

skip\_orientation
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   If true, ignore the detected object’s orientation and point toward it from the robot’s position.
```

search\_by\_rotating
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   If true, the robot will rotate in place when it loses object detection to try to find it again.
```

search\_angle
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | M\_PI\_2 |
```

```
Description
:   Maximum angle (rad) to rotate when searching for the object.
```

odom\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “odom” |
```

```
Description
:   Odometry topic to use for obtaining the robot’s current velocity.
```

odom\_duration
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.3 |
```

```
Description
:   Time (s) to buffer odometry commands to estimate the robot speed.
```

transform\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
Description
:   Time with which to post-date the transform that is published, to indicate that this transform is valid into the future.
```

###### Example

```
following_server:
  ros__parameters:
    controller_frequency: 50.0
    detection_timeout: 2.0
    rotate_to_object_timeout: 10.0
    static_object_timeout: 30.0  # -1.0 for indefinite following
    linear_tolerance: 0.15
    angular_tolerance: 0.15
    max_retries: 3
    base_frame: "base_link"
    fixed_frame: "odom"
    filter_coef: 0.1
    desired_distance: 1.0
    skip_orientation: true
    search_by_rotating: false
    odom_topic: "odom"
    odom_duration: 0.3
    transform_tolerance: 0.1

    # Controller configuration (inherited from docking controller)
    controller:
      k_phi: 3.0
      k_delta: 2.0
      beta: 0.4
      lambda: 2.0
      v_linear_min: 0.1
      v_linear_max: 0.5
      v_angular_max: 1.0
      slowdown_radius: 0.15
      use_collision_detection: false
      transform_tolerance: 0.1
```

#### Parameters

**`controller_frequency`**
- Type: `unknown`
- TypeDefaultdouble50.0DescriptionControl frequency (Hz) for the following control loop.

**`detection_timeout`**
- Type: `unknown`
- TypeDefaultdouble2.0DescriptionTimeout (s) to wait for detection of the object to follow.

**`rotate_to_object_timeout`**
- Type: `unknown`
- TypeDefaultdouble10.0DescriptionTimeout (s) to rotate searching for the object when detection is lost.

**`static_object_timeout`**
- Type: `unknown`
- TypeDefaultdouble-1.0DescriptionTimeout (s) to stop following when the object remains static. If -1.0, the robot will follow indefinitely.

**`linear_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.15DescriptionLinear tolerance (m) to consider that the target position has been reached.

**`angular_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.15DescriptionAngular tolerance (rad) to consider that the target orientation has been reached.

**`max_retries`**
- Type: `unknown`
- TypeDefaultint3DescriptionMaximum number of retries when detection or control fails.

**`base_frame`**
- Type: `unknown`
- TypeDefaultstring“base_link”DescriptionRobot’s base frame for control law.

**`fixed_frame`**
- Type: `unknown`
- TypeDefaultstring“odom”DescriptionFixed frame to use, recommended to be a smooth odometry framenotmap.

**`filter_coef`**
- Type: `unknown`
- TypeDefaultdouble0.1DescriptionFilter coefficient for smoothing object pose detections.

**`desired_distance`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionDesired distance (m) to maintain from the followed object.

**`skip_orientation`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionIf true, ignore the detected object’s orientation and point toward it from the robot’s position.

**`search_by_rotating`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionIf true, the robot will rotate in place when it loses object detection to try to find it again.

**`search_angle`**
- Type: `unknown`
- TypeDefaultdoubleM_PI_2DescriptionMaximum angle (rad) to rotate when searching for the object.

**`odom_topic`**
- Type: `unknown`
- TypeDefaultstring“odom”DescriptionOdometry topic to use for obtaining the robot’s current velocity.

**`odom_duration`**
- Type: `unknown`
- TypeDefaultdouble0.3DescriptionTime (s) to buffer odometry commands to estimate the robot speed.

**`transform_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.1DescriptionTime with which to post-date the transform that is published, to indicate that this transform is valid into the future.

**`Description`**
- Type: `unknown`
- Control frequency (Hz) for the following control loop.

**`Description`**
- Type: `unknown`
- Timeout (s) to wait for detection of the object to follow.

**`Description`**
- Type: `unknown`
- Timeout (s) to rotate searching for the object when detection is lost.

**`Description`**
- Type: `unknown`
- Timeout (s) to stop following when the object remains static. If -1.0, the robot will follow indefinitely.

**`Description`**
- Type: `unknown`
- Linear tolerance (m) to consider that the target position has been reached.

**`Description`**
- Type: `unknown`
- Angular tolerance (rad) to consider that the target orientation has been reached.

**`Description`**
- Type: `unknown`
- Maximum number of retries when detection or control fails.

**`Description`**
- Type: `unknown`
- Robot’s base frame for control law.

**`Description`**
- Type: `unknown`
- Fixed frame to use, recommended to be a smooth odometry framenotmap.

**`Description`**
- Type: `unknown`
- Filter coefficient for smoothing object pose detections.

**`Description`**
- Type: `unknown`
- Desired distance (m) to maintain from the followed object.

**`Description`**
- Type: `unknown`
- If true, ignore the detected object’s orientation and point toward it from the robot’s position.

**`Description`**
- Type: `unknown`
- If true, the robot will rotate in place when it loses object detection to try to find it again.

**`Description`**
- Type: `unknown`
- Maximum angle (rad) to rotate when searching for the object.

**`Description`**
- Type: `unknown`
- Odometry topic to use for obtaining the robot’s current velocity.

**`Description`**
- Type: `unknown`
- Time (s) to buffer odometry commands to estimate the robot speed.

**`Description`**
- Type: `unknown`
- Time with which to post-date the transform that is published, to indicate that this transform is valid into the future.


---

#### Graceful Controller

*Source: [https://docs.nav2.org/configuration/packages/configuring-graceful-motion-controller.html](https://docs.nav2.org/configuration/packages/configuring-graceful-motion-controller.html)*

##### Graceful Controller

Source code on [Github](https://github.com/ros-navigation/navigation2/tree/main/nav2_graceful_controller).

The graceful controller implements a controller based on the works of Jong Jin Park and Benjamin Kuipers in “A Smooth Control Law for Graceful Motion of Differential Wheeled Mobile Robots in 2D Environment” (ICRA 2011). In this implementation, a motion\_target is set at a distance away from the robot that is exponentially stable to generate a smooth trajectory for the robot to follow.

See the package’s `README` for more complete information.

###### Graceful Controller Parameters

max\_lookahead
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   The maximum lookahead distance (m) to use when selecting a target pose for the underlying control law. Using poses that are further away will generally result in smoother operations, but simulating poses that are very far away can result in reduced performance, especially in tight or cluttered environments. If the controller cannot forward simulate to a pose this far away without colliding, it will iteratively select a target pose that is closer to the robot.
```

min\_lookahead
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
Description
:   The minimum lookahead distance (m) to use when selecting a target pose for the underlying control law. This parameter avoids instability when an unexpected obstacle appears in the path of the robot by returning failure, which typically triggers replanning.
```

k\_phi
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description
:   Ratio of the rate of change in phi to the rate of change in r. Controls the convergence of the slow subsystem. If this value is equal to zero, the controller will behave as a pure waypoint follower. A high value offers extreme scenario of pose-following where theta is reduced much faster than r. The referenced paper calls this k1.
```

k\_delta
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   Constant factor applied to the heading error feedback. Controls the convergence of the fast subsystem. The bigger the value, the robot converge faster to the reference heading. The referenced paper calls this k2.
```

beta
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.4 |
```

```
Description
:   Constant factor applied to the path curvature. This value must be positive. Determines how fast the velocity drops when the curvature increases.
```

lambda
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description
:   Constant factor applied to the path curvature. This value must be greater or equal to 1. Determines the sharpness of the curve: higher lambda implies sharper curves.
```

v\_linear\_min
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
Description
:   Minimum linear velocity (m/s).
```

v\_linear\_max
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description
:   Maximum linear velocity (m/s).
```

v\_angular\_max
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   Maximum angular velocity (rad/s) produced by the control law.
```

v\_angular\_min\_in\_place
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
Description
:   Minimum angular velocity (rad/s) produced by the control law when rotating in place. This value should be based on the minimum rotation speed controllable by the robot.
```

slowdown\_radius
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.5 |
```

```
Description
:   Radius (m) around the goal pose in which the robot will start to slow down.
```

initial\_rotation
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Enable a rotation in place to the goal before starting the path. The control law may generate large sweeping arcs to the goal pose, depending on the initial robot orientation and `k_phi`, `k_delta`.
```

initial\_rotation\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.75 |
```

```
Description
:   The difference in the path orientation and the starting robot orientation to trigger a rotate in place, if `initial_rotation` is enabled. This value is generally acceptable if continuous replanning is enabled. If not using continuous replanning, a lower value may perform better.
```

prefer\_final\_rotation
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   The control law can generate large arcs when the goal orientation is not aligned with the path. If this is enabled, the orientation of the final pose will be ignored and the robot will follow the orientation of the path and will make a final rotation in place to the goal orientation.
```

rotation\_scaling\_factor
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description
:   The scaling factor applied to the rotation in place velocity.
```

allow\_backward
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to allow the robot to move backward.
```

in\_place\_collision\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
Description
:   When performing an in-place rotation after the XY goal tolerance has been met, this is the angle (in radians) between poses to check for collision.
```

use\_collision\_detection
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to use collision detection to avoid obstacles.
```

allow\_parameter\_qos\_overrides
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to allow QoS profiles to be overwritten with parameterized values.
```

###### Example

```
controller_server:
  ros__parameters:
    controller_frequency: 20.0
    min_x_velocity_threshold: 0.001
    min_y_velocity_threshold: 0.5
    min_theta_velocity_threshold: 0.001
    progress_checker_plugins: ["progress_checker"] # progress_checker_plugin: "progress_checker" For Humble and older
    goal_checker_plugins: ["goal_checker"]
    controller_plugins: ["FollowPath"]

    progress_checker:
      plugin: "nav2_controller::SimpleProgressChecker"
      required_movement_radius: 0.5
      movement_time_allowance: 10.0
    goal_checker:
      plugin: "nav2_controller::SimpleGoalChecker"
      xy_goal_tolerance: 0.25
      yaw_goal_tolerance: 0.25
      stateful: True
    FollowPath:
      plugin: nav2_graceful_controller::GracefulController
      min_lookahead: 0.25
      max_lookahead: 1.0
      initial_rotation: true
      initial_rotation_threshold: 0.75
      prefer_final_rotation: true
      allow_backward: false
      k_phi: 2.0
      k_delta: 1.0
      beta: 0.4
      lambda: 2.0
      v_linear_min: 0.1
      v_linear_max: 0.5
      v_angular_max: 5.0
      v_angular_min_in_place: 0.25
      slowdown_radius: 1.5
```

#### Parameters

**`max_lookahead`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionThe maximum lookahead distance (m) to use when selecting a target pose for the underlying control law. Using poses that are further away will generally result in smoother operations, but simulating poses that are very far away can result in reduced performance, especially in tight or cluttered environments. If the controller cannot forward simulate to a pose this far away without colliding, it will iteratively select a target pose that is closer to the robot.

**`min_lookahead`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionThe minimum lookahead distance (m) to use when selecting a target pose for the underlying control law. This parameter avoids instability when an unexpected obstacle appears in the path of the robot by returning failure, which typically triggers replanning.

**`k_phi`**
- Type: `unknown`
- TypeDefaultdouble2.0DescriptionRatio of the rate of change in phi to the rate of change in r. Controls the convergence of the slow subsystem. If this value is equal to zero, the controller will behave as a pure waypoint follower. A high value offers extreme scenario of pose-following where theta is reduced much faster than r. The referenced paper calls thisk1.

**`k_delta`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionConstant factor applied to the heading error feedback. Controls the convergence of the fast subsystem. The bigger the value, the robot converge faster to the reference heading. The referenced paper calls thisk2.

**`beta`**
- Type: `unknown`
- TypeDefaultdouble0.4DescriptionConstant factor applied to the path curvature. This value must be positive. Determines how fast the velocity drops when the curvature increases.

**`lambda`**
- Type: `unknown`
- TypeDefaultdouble2.0DescriptionConstant factor applied to the path curvature. This value must be greater or equal to 1. Determines the sharpness of the curve: higher lambda implies sharper curves.

**`v_linear_min`**
- Type: `unknown`
- TypeDefaultdouble0.1DescriptionMinimum linear velocity (m/s).

**`v_linear_max`**
- Type: `unknown`
- TypeDefaultdouble0.5DescriptionMaximum linear velocity (m/s).

**`v_angular_max`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionMaximum angular velocity (rad/s) produced by the control law.

**`v_angular_min_in_place`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionMinimum angular velocity (rad/s) produced by the control law when rotating in place. This value should be based on the minimum rotation speed controllable by the robot.

**`slowdown_radius`**
- Type: `unknown`
- TypeDefaultdouble1.5DescriptionRadius (m) around the goal pose in which the robot will start to slow down.

**`initial_rotation`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionEnable a rotation in place to the goal before starting the path. The control law may generate large sweeping arcs to the goal pose, depending on the initial robot orientation andk_phi,k_delta.

**`initial_rotation_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.75DescriptionThe difference in the path orientation and the starting robot orientation to trigger a rotate in place, ifinitial_rotationis enabled. This value is generally acceptable if continuous replanning is enabled. If not using continuous replanning, a lower value may perform better.

**`prefer_final_rotation`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionThe control law can generate large arcs when the goal orientation is not aligned with the path. If this is enabled, the orientation of the final pose will be ignored and the robot will follow the orientation of the path and will make a final rotation in place to the goal orientation.

**`rotation_scaling_factor`**
- Type: `unknown`
- TypeDefaultdouble0.5DescriptionThe scaling factor applied to the rotation in place velocity.

**`allow_backward`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to allow the robot to move backward.

**`in_place_collision_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.1DescriptionWhen performing an in-place rotation after the XY goal tolerance has been met, this is the angle (in radians) between poses to check for collision.

**`use_collision_detection`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to use collision detection to avoid obstacles.

**`allow_parameter_qos_overrides`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to allow QoS profiles to be overwritten with parameterized values.

**`Description`**
- Type: `unknown`
- The maximum lookahead distance (m) to use when selecting a target pose for the underlying control law. Using poses that are further away will generally result in smoother operations, but simulating poses that are very far away can result in reduced performance, especially in tight or cluttered environments. If the controller cannot forward simulate to a pose this far away without colliding, it will iteratively select a target pose that is closer to the robot.

**`Description`**
- Type: `unknown`
- The minimum lookahead distance (m) to use when selecting a target pose for the underlying control law. This parameter avoids instability when an unexpected obstacle appears in the path of the robot by returning failure, which typically triggers replanning.

**`Description`**
- Type: `unknown`
- Ratio of the rate of change in phi to the rate of change in r. Controls the convergence of the slow subsystem. If this value is equal to zero, the controller will behave as a pure waypoint follower. A high value offers extreme scenario of pose-following where theta is reduced much faster than r. The referenced paper calls thisk1.

**`Description`**
- Type: `unknown`
- Constant factor applied to the heading error feedback. Controls the convergence of the fast subsystem. The bigger the value, the robot converge faster to the reference heading. The referenced paper calls thisk2.

**`Description`**
- Type: `unknown`
- Constant factor applied to the path curvature. This value must be positive. Determines how fast the velocity drops when the curvature increases.

**`Description`**
- Type: `unknown`
- Constant factor applied to the path curvature. This value must be greater or equal to 1. Determines the sharpness of the curve: higher lambda implies sharper curves.

**`Description`**
- Type: `unknown`
- Minimum linear velocity (m/s).

**`Description`**
- Type: `unknown`
- Maximum linear velocity (m/s).

**`Description`**
- Type: `unknown`
- Maximum angular velocity (rad/s) produced by the control law.

**`Description`**
- Type: `unknown`
- Minimum angular velocity (rad/s) produced by the control law when rotating in place. This value should be based on the minimum rotation speed controllable by the robot.

**`Description`**
- Type: `unknown`
- Radius (m) around the goal pose in which the robot will start to slow down.

**`Description`**
- Type: `unknown`
- Enable a rotation in place to the goal before starting the path. The control law may generate large sweeping arcs to the goal pose, depending on the initial robot orientation andk_phi,k_delta.

**`Description`**
- Type: `unknown`
- The difference in the path orientation and the starting robot orientation to trigger a rotate in place, ifinitial_rotationis enabled. This value is generally acceptable if continuous replanning is enabled. If not using continuous replanning, a lower value may perform better.

**`Description`**
- Type: `unknown`
- The control law can generate large arcs when the goal orientation is not aligned with the path. If this is enabled, the orientation of the final pose will be ignored and the robot will follow the orientation of the path and will make a final rotation in place to the goal orientation.

**`Description`**
- Type: `unknown`
- The scaling factor applied to the rotation in place velocity.

**`Description`**
- Type: `unknown`
- Whether to allow the robot to move backward.

**`Description`**
- Type: `unknown`
- When performing an in-place rotation after the XY goal tolerance has been met, this is the angle (in radians) between poses to check for collision.

**`Description`**
- Type: `unknown`
- Whether to use collision detection to avoid obstacles.

**`Description`**
- Type: `unknown`
- Whether to allow QoS profiles to be overwritten with parameterized values.


---

#### Lifecycle Manager

*Source: [https://docs.nav2.org/configuration/packages/configuring-lifecycle.html](https://docs.nav2.org/configuration/packages/configuring-lifecycle.html)*

##### Lifecycle Manager

Source code on [Github](https://github.com/ros-navigation/navigation2/tree/main/nav2_lifecycle_manager).

The Lifecycle Manager module implements the method for handling the lifecycle transition states for the stack in a deterministic way.
It will take in a set of ordered nodes to transition one-by-one into the configuration and activate states to run the stack.
It will then bring down the stack into the finalized state in the opposite order.
It will also create bond connections with the servers to ensure they are still up and transition down all nodes if any are non-responsive or crashed.

###### Parameters

node\_names
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | N/A |
```

```
Description
:   Ordered list of node names to bringup through lifecycle transition.
```

autostart
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to transition nodes to active state on startup.
```

bond\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 4.0 |
```

```
Description
:   Timeout to transition down all lifecycle nodes of this manager if a server is non-responsive, in seconds. Set to `0` to deactivate. Recommended to be always larger than 0.3s for all-local node discovery. Note: if a server cleanly exits the manager will immediately be notified.
```

attempt\_respawn\_reconnection
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to try to reconnect to servers that go down, presumably because respawn is set to `true` to re-create crashed nodes. While default to `true`, reconnections will not be made unless respawn is set to true in your launch files or your watchdog systems will bring up the server externally.
```

bond\_respawn\_max\_duration
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10.0 |
```

```
Description
:   When a server crashes or becomes non-responsive, the lifecycle manager will bring down all nodes for safety. This is the duration of which the lifecycle manager will attempt to reconnect with the failed server(s) during to recover and re-activate the system. If this passes, it will stop attempts and will require a manual re-activation once the problem is manually resolved. Units: seconds.
```

introspection\_mode
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “disabled” |
```

```
Description
:   The introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.
```

bond\_heartbeat\_period
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
Description
:   The lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.
```

allow\_parameter\_qos\_overrides
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to allow QoS profiles to be overwritten with parameterized values.
```

###### Example

```
lifecycle_manager:
  ros__parameters:
    autostart: true
    node_names: ['controller_server', 'planner_server', 'behavior_server', 'bt_navigator', 'waypoint_follower']
    bond_timeout: 4.0
    attempt_respawn_reconnection: true
    bond_respawn_max_duration: 10.0
    bond_heartbeat_period: 0.25
    introspection_mode: "disabled"
```

#### Parameters

**`node_names`**
- Type: `unknown`
- TypeDefaultvector<string>N/ADescriptionOrdered list of node names to bringup through lifecycle transition.

**`autostart`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to transition nodes to active state on startup.

**`bond_timeout`**
- Type: `unknown`
- TypeDefaultdouble4.0DescriptionTimeout to transition down all lifecycle nodes of this manager if a server is non-responsive, in seconds. Set to0to deactivate. Recommended to be always larger than 0.3s for all-local node discovery. Note: if a server cleanly exits the manager will immediately be notified.

**`attempt_respawn_reconnection`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to try to reconnect to servers that go down, presumably because respawn is set totrueto re-create crashed nodes. While default totrue, reconnections will not be made unless respawn is set to true in your launch files or your watchdog systems will bring up the server externally.

**`bond_respawn_max_duration`**
- Type: `unknown`
- TypeDefaultdouble10.0DescriptionWhen a server crashes or becomes non-responsive, the lifecycle manager will bring down all nodes for safety. This is the duration of which the lifecycle manager will attempt to reconnect with the failed server(s) during to recover and re-activate the system. If this passes, it will stop attempts and will require a manual re-activation once the problem is manually resolved. Units: seconds.

**`introspection_mode`**
- Type: `unknown`
- TypeDefaultstring“disabled”DescriptionThe introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.

**`bond_heartbeat_period`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionThe lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.

**`allow_parameter_qos_overrides`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to allow QoS profiles to be overwritten with parameterized values.

**`Description`**
- Type: `unknown`
- Ordered list of node names to bringup through lifecycle transition.

**`Description`**
- Type: `unknown`
- Whether to transition nodes to active state on startup.

**`Description`**
- Type: `unknown`
- Timeout to transition down all lifecycle nodes of this manager if a server is non-responsive, in seconds. Set to0to deactivate. Recommended to be always larger than 0.3s for all-local node discovery. Note: if a server cleanly exits the manager will immediately be notified.

**`Description`**
- Type: `unknown`
- Whether to try to reconnect to servers that go down, presumably because respawn is set totrueto re-create crashed nodes. While default totrue, reconnections will not be made unless respawn is set to true in your launch files or your watchdog systems will bring up the server externally.

**`Description`**
- Type: `unknown`
- When a server crashes or becomes non-responsive, the lifecycle manager will bring down all nodes for safety. This is the duration of which the lifecycle manager will attempt to reconnect with the failed server(s) during to recover and re-activate the system. If this passes, it will stop attempts and will require a manual re-activation once the problem is manually resolved. Units: seconds.

**`Description`**
- Type: `unknown`
- The introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.

**`Description`**
- Type: `unknown`
- The lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.

**`Description`**
- Type: `unknown`
- Whether to allow QoS profiles to be overwritten with parameterized values.


---

#### Loopback Simulator

*Source: [https://docs.nav2.org/configuration/packages/configuring-loopback-sim.html](https://docs.nav2.org/configuration/packages/configuring-loopback-sim.html)*

##### Loopback Simulator

Source code on [Github](https://github.com/ros-navigation/navigation2/tree/main/nav2_loopback_sim).

The `nav2_loopback_sim` is a stand-alone simulator to create a “loopback” for non-physical simulation to replace robot hardware, physics simulators (Gazebo, Bullet, Isaac Sim, etc).
It computes the robot’s odometry based on the command velocity’s output request to create a perfect ‘frictionless plane’-style simulation for unit testing, system testing, R&D on higher level systems, testing behaviors without concerning yourself with localization accuracy or system dynamics, and multirobot simulations.

###### Parameters

update\_duration
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.01 |
```

```
Description
:   The duration between updates (s)
```

base\_frame\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “base\_link” |
```

```
Description
:   The base frame to use.
```

odom\_frame\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “odom” |
```

```
Description
:   The odom frame to use.
```

map\_frame\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “map” |
```

```
Description
:   The map frame to use.
```

scan\_frame\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “base\_scan” |
```

```
Description
:   The scan frame to use to publish a scan
```

enable\_stamped\_cmd\_vel
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | True |
```

```
Description
:   Whether cmd\_vel is stamped or unstamped (i.e. Twist or TwistStamped).
    Note: This parameter is default `false` in Jazzy or older! Kilted or newer uses `TwistStamped` by default.
```

scan\_publish\_dur
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | 0.1 |
```

```
Description
:   The duration between publishing scan (in sec)
```

publish\_map\_odom\_tf
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | true |
```

```
Description
:   Whether or not to publish tf from `map_frame_id` to `odom_frame_id`
```

publish\_clock
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | true |
```

```
Description
:   Whether or not to publish simulated clock to `/clock`
```

scan\_range\_min
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.05 |
```

```
Description
:   Minimum measurable distance from the scan in meters. Values below this are considered invalid.
```

scan\_range\_max
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 30.0 |
```

```
Description
:   Maximum measurable distance from the scan in meters. Values beyond this are out of range.
```

scan\_angle\_min
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | -3.14 |
```

```
Description
:   Starting angle of the scan in radians (leftmost angle)
```

scan\_angle\_max
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 3.14 |
```

```
Description
:   Ending angle of the scan in radians (rightmost angle)
```

scan\_angle\_increment
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0261 |
```

```
Description
:   Angular resolution of the scan in radians (angle between consecutive measurements)
```

scan\_use\_inf
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to use `inf` for out-of-range values.
    If `false`, values are set to `scan_range_max - 0.1` instead.
```

###### Example

```
loopback_simulator:
  ros__parameters:
    base_frame_id: "base_footprint"
    odom_frame_id: "odom"
    map_frame_id: "map"
    scan_frame_id: "base_scan"  # tb4_loopback_simulator.launch.py remaps to 'rplidar_link'
    update_duration: 0.02
    scan_range_min: 0.05
    scan_range_max: 30.0
    scan_angle_min: -3.1415
    scan_angle_max: 3.1415
    scan_angle_increment: 0.02617
    scan_use_inf: true
```

#### Parameters

**`update_duration`**
- Type: `unknown`
- TypeDefaultdouble0.01DescriptionThe duration between updates (s)

**`base_frame_id`**
- Type: `unknown`
- TypeDefaultstring“base_link”DescriptionThe base frame to use.

**`odom_frame_id`**
- Type: `unknown`
- TypeDefaultstring“odom”DescriptionThe odom frame to use.

**`map_frame_id`**
- Type: `unknown`
- TypeDefaultstring“map”DescriptionThe map frame to use.

**`scan_frame_id`**
- Type: `unknown`
- TypeDefaultstring“base_scan”DescriptionThe scan frame to use to publish a scan

**`enable_stamped_cmd_vel`**
- Type: `unknown`
- TypeDefaultstringTrueDescriptionWhether cmd_vel is stamped or unstamped (i.e. Twist or TwistStamped).
Note: This parameter is defaultfalsein Jazzy or older! Kilted or newer usesTwistStampedby default.

**`scan_publish_dur`**
- Type: `unknown`
- TypeDefaultstring0.1DescriptionThe duration between publishing scan (in sec)

**`publish_map_odom_tf`**
- Type: `unknown`
- TypeDefaultstringtrueDescriptionWhether or not to publish tf frommap_frame_idtoodom_frame_id

**`publish_clock`**
- Type: `unknown`
- TypeDefaultstringtrueDescriptionWhether or not to publish simulated clock to/clock

**`scan_range_min`**
- Type: `unknown`
- TypeDefaultdouble0.05DescriptionMinimum measurable distance from the scan in meters. Values below this are considered invalid.

**`scan_range_max`**
- Type: `unknown`
- TypeDefaultdouble30.0DescriptionMaximum measurable distance from the scan in meters. Values beyond this are out of range.

**`scan_angle_min`**
- Type: `unknown`
- TypeDefaultdouble-3.14DescriptionStarting angle of the scan in radians (leftmost angle)

**`scan_angle_max`**
- Type: `unknown`
- TypeDefaultdouble3.14DescriptionEnding angle of the scan in radians (rightmost angle)

**`scan_angle_increment`**
- Type: `unknown`
- TypeDefaultdouble0.0261DescriptionAngular resolution of the scan in radians (angle between consecutive measurements)

**`scan_use_inf`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to useinffor out-of-range values.
Iffalse, values are set toscan_range_max-0.1instead.

**`Description`**
- Type: `unknown`
- The duration between updates (s)

**`Description`**
- Type: `unknown`
- The base frame to use.

**`Description`**
- Type: `unknown`
- The odom frame to use.

**`Description`**
- Type: `unknown`
- The map frame to use.

**`Description`**
- Type: `unknown`
- The scan frame to use to publish a scan

**`Description`**
- Type: `unknown`
- Whether cmd_vel is stamped or unstamped (i.e. Twist or TwistStamped).
Note: This parameter is defaultfalsein Jazzy or older! Kilted or newer usesTwistStampedby default.

**`Description`**
- Type: `unknown`
- The duration between publishing scan (in sec)

**`Description`**
- Type: `unknown`
- Whether or not to publish tf frommap_frame_idtoodom_frame_id

**`Description`**
- Type: `unknown`
- Whether or not to publish simulated clock to/clock

**`Description`**
- Type: `unknown`
- Minimum measurable distance from the scan in meters. Values below this are considered invalid.

**`Description`**
- Type: `unknown`
- Maximum measurable distance from the scan in meters. Values beyond this are out of range.

**`Description`**
- Type: `unknown`
- Starting angle of the scan in radians (leftmost angle)

**`Description`**
- Type: `unknown`
- Ending angle of the scan in radians (rightmost angle)

**`Description`**
- Type: `unknown`
- Angular resolution of the scan in radians (angle between consecutive measurements)

**`Description`**
- Type: `unknown`
- Whether to useinffor out-of-range values.
Iffalse, values are set toscan_range_max-0.1instead.


---

#### Map Server

*Source: [https://docs.nav2.org/configuration/packages/configuring-map-server.html](https://docs.nav2.org/configuration/packages/configuring-map-server.html)*

##### Map Server

Source code on [Github](https://github.com/ros-navigation/navigation2/tree/main/nav2_map_server).

The Map server package implements various components for handling grid maps, including loading, saving, and publishing maps and their metadata. Currently the following components are supported in Nav2:

* [Map Server](map_server/configuring-map-server.html)
* [Map Saver](map_server/configuring-map-saver.html)
* [Costmap Filter Info Server](map_server/configuring-costmap-filter-info-server.html)
* [Vector Object Server](map_server/configuring-vector-object-server.html)

---

#### Model Predictive Path Integral Controller

*Source: [https://docs.nav2.org/configuration/packages/configuring-mppic.html](https://docs.nav2.org/configuration/packages/configuring-mppic.html)*

##### Model Predictive Path Integral Controller

Source code on [Github](https://github.com/ros-navigation/navigation2/tree/main/nav2_mppi_controller).

[![MPPI on Turtlebot3 demo](../../_images/mppi_demo.gif)](../../_images/mppi_demo.gif)

The MPPI Controller implements a [Model Predictive Path Integral Controller](https://ieeexplore.ieee.org/document/7487277).
The new Nav2 MPPI Controller is a predictive controller - a successor to TEB and pure path tracking MPC controllers. It uses a sampling based approach to select optimal trajectories, optimizing between successive iterations. It contains plugin-based objective functions for customization and extension for various behaviors and behavioral attributes.

It works currently with Differential, Omnidirectional, and Ackermann robots.
This controller is measured to run at 100+ Hz on a modest Intel processor (4th gen i5).

The MPPI algorithm is an MPC variant that finds a control velocity for the robot using an iterative approach. Using the previous time step’s best control solution and the robot’s current state, a set of randomly sampled perturbations from a Gaussian distribution are applied. These noised controls are forward simulated to generate a set of trajectories within the robot’s motion model.
Next, these trajectories are scored using a set of plugin-based critic functions to find the best trajectory in the batch. The output scores are used to set the best control with a soft max function.
This process is then repeated a number of times and returns a converged solution. This solution is then used as the basis of the next time step’s initial control.

A powerful result of this work is the ability to utilize objective functions which are not require to be convex nor differentiable, providing greater designer flexibility in behavior.

See the package’s `README` for more complete information.

###### MPPI Parameters

motion\_model
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “DiffDrive” |
```

```
Description
:   The desired motion model to use for trajectory planning. Options are `DiffDrive`, `Omni`, or `Ackermann`. Differential drive robots may use forward/reverse and angular velocities; Omni add in lateral motion; and Ackermann adds minimum curvature constraints.
```

critics
:   |  |  |
```
| --- | --- |
| Type | Default |
| string vector | N/A |
```

```
Description
:   A vector of critic plugin functions to use, without `mppi::critic::` namespace which will be automatically added on loading.
```

iteration\_count
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1 |
```

```
Description
:   Iteration count in the MPPI algorithm. Recommended to remain as 1 and instead prefer larger batch sizes.
```

batch\_size
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1000 |
```

```
Description
:   Count of randomly sampled candidate trajectories from current optimal control sequence in a given iteration. 1000 @ 50 Hz or 2000 @ 30 Hz seems to produce good results.
```

time\_steps
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 56 |
```

```
Description
:   Number of time steps (points) in candidate trajectories
```

model\_dt
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.05 |
```

```
Description
:   Length of each time step’s `dt` timestep, in seconds. `time_steps * model_dt` is the prediction horizon.
```

vx\_std
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.2 |
```

```
Description
:   Sampling standard deviation for Vx
```

vy\_std
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.2 |
```

```
Description
:   Sampling standard deviation for Vy
```

wz\_std
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.2 |
```

```
Description
:   Sampling standard deviation for Wz (angular velocity)
```

vx\_max
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description
:   Target maximum forward velocity (m/s).
```

vy\_max
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description
:   Target maximum lateral velocity, if using `Omni` motion model (m/s).
```

vx\_min
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | -0.35 |
```

```
Description
:   Maximum reverse velocity (m/s).
```

wz\_max
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.9 |
```

```
Description
:   Maximum rotational velocity (rad/s).
```

ax\_max
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 3.0 |
```

```
Description
:   Maximum forward acceleration (m/s^2).
```

ay\_min
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | -3.0 |
```

```
Description
:   Minimum lateral acceleration in either direction, if using `Omni` motion model (m/s^2).
```

ay\_max
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 3.0 |
```

```
Description
:   Maximum lateral acceleration in either direction, if using `Omni` motion model (m/s^2).
```

ax\_min
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | -3.0 |
```

```
Description
:   Maximum deceleration along the X-axis (m/s^2).
```

az\_max
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 3.5 |
```

```
Description
:   Maximum angular acceleration (rad/s^2).
```

temperature
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.3 |
```

```
Description
:   Selectiveness of trajectories by their costs (The closer this value to 0, the “more” we take in consideration controls with less cost), 0 mean use control with best cost, huge value will lead to just taking mean of all trajectories without cost consideration.
```

gamma
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.015 |
```

```
Description
:   A trade-off between smoothness (high) and low energy (low). This is a complex parameter that likely won’t need to be changed from the default. See Section 3D-2 in “Information Theoretic Model Predictive Control: Theory and Applications to Autonomous Driving” for detailed information.
```

visualize
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to publish debugging trajectories for visualization. This can slow down the controller substantially (e.g. 1000 batches of 56 size every 30hz is a lot of data).
```

publish\_optimal\_trajectory
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to publish the optimal trajectory (pose, velocity, timestamps of via points) computed by MPC for visualization, debugging, or injection by lower-level control systems and/or collision avoidance systems that need awarenes of future velocity commands and/or poses.
```

retry\_attempt\_limit
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1 |
```

```
Description
:   Number of attempts to find feasible trajectory on failure for soft-resets before reporting total failure.
```

reset\_period
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   Required time of inactivity to reset optimizer (only in Humble due to backport ABI policies).
```

regenerate\_noises
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to regenerate noises each iteration or use single noise distribution computed on initialization and reset. Practically, this is found to work fine since the trajectories are being sampled stochastically from a normal distribution and reduces compute jittering at run-time due to thread wake-ups to resample normal distribution.
```

publish\_critics\_stats
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to publish statistics about each critic’s performance. When enabled, publishes a `nav2_msgs::msg::CriticsStats` message containing critic names, whether they changed costs, and the sum of costs added by each critic for all trajectory samples. Useful for debugging and tuning critic behavior but should not be enabled for generic runtime use.
```

open\_loop
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to use last command velocity or use odometry for MPPI initial state estimation. When enable, use last command velocity for MPPI initial state estimation.
```

TrajectoryValidator.plugin
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “mppi::DefaultOptimalTrajectoryValidator” |
```

```
Description
:   The plugin to use for validating final optimal trajectories.
```

###### Trajectory Visualization

trajectory\_step
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 5 |
```

```
Description
:   The step between trajectories to visualize to downsample candidate trajectory pool.
```

time\_step
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 3 |
```

```
Description
:   The step between points on trajectories to visualize to downsample trajectory density.
```

allow\_parameter\_qos\_overrides
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to allow QoS profiles to be overwritten with parameterized values.
```

###### Ackermann Motion Model

min\_turning\_r
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.2 |
```

```
Description
:   The minimum turning radius possible for the vehicle platform (m).
```

###### Default Optimal Trajectory Validator

This validator checks the final optimal trajectory for validity and does not collide with obstacles.
Additional validator plugins can be created to support different features like constraints on the maximum deviation from a path, collision margin, progress being made, etc.
Dynamic and kinematic constraints are not required to be checked as trajectories are guaranteed to be within the constraints of the motion model.

collision\_lookahead\_time
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description
:   The time in seconds to look ahead for potential collisions when validating the trajectory.
```

consider\_footprint
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to consider the robot’s footprint when validating the trajectory. Else, will use the center point cost of a circular robot
```

###### Constraint Critic

This critic penalizes trajectories that have components outside of the set dynamic or kinematic constraints

cost\_weight
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 4.0 |
```

```
Description
:   Weight to apply to critic term.
```

cost\_power
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1 |
```

```
Description
:   Power order to apply to term.
```

###### Goal Angle Critic

This critic incentivizes navigating to achieve the angle of the goal posewhen in reasonable proximity to goal

cost\_weight
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 3.0 |
```

```
Description
:   Weight to apply to critic term.
```

cost\_power
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1 |
```

```
Description
:   Power order to apply to term.
```

threshold\_to\_consider
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description
:   Minimal distance (m) between robot and goal above which angle goal cost considered.
```

symmetric\_yaw\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Enable symmetric goal orientation acceptance. When enabled, the critic prefers trajectories that approach the goal at either the goal orientation or the goal orientation + 180°. This is useful for symmetric robots (e.g., differential drives with sensors on both ends) that can navigate equally well in forward and backward directions and does not care which direction it ends in (i.e. MPPI decides). When enabled, the critic uses the minimum distance to either goal orientation, reducing the cost penalty for approaching from the backward direction. See [Tuning Guide](../../tuning/index.html#tuning) for detailed information.
```

###### Goal Critic

This critic incentivizes navigating spatially towards the goal when in reasonable proximity to goal

cost\_weight
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 5.0 |
```

```
Description
:   Weight to apply to critic term.
```

cost\_power
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1 |
```

```
Description
:   Power order to apply to term.
```

threshold\_to\_consider
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.4 |
```

```
Description
:   Minimal distance (m) between robot and goal above which goal distance cost considered. It is wise to start with this as being the same as your prediction horizon to have a clean hand-off with the path follower critic.
```

###### Obstacles Critic

This critic incentivizes navigating away from obstacles and critical collisions using either a circular robot point-check or full SE2 footprint check using distances from obstacles.

critical\_weight
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 20.0 |
```

```
Description
:   Weight to apply to critic for near collisions closer than `collision_margin_distance` to prevent near collisions **only** as a method of virtually inflating the footprint. This should not be used to generally influence obstacle avoidance away from critical collisions.
```

repulsion\_weight
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.5 |
```

```
Description
:   Weight to apply to critic for generally preferring routes in lower cost space. This is separated from the critical term to allow for fine tuning of obstacle behaviors with path alignment for dynamic scenes without impacting actions which may directly lead to near-collisions. This is applied within the `inflation_radius` distance from obstacles.
```

cost\_power
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1 |
```

```
Description
:   Power order to apply to term.
```

consider\_footprint
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to use point cost (if robot is circular or low compute power) or compute SE2 footprint cost.
```

collision\_cost
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 100000.0 |
```

```
Description
:   Cost to apply to a true collision in a trajectory.
```

collision\_margin\_distance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.10 |
```

```
Description
:   Margin distance (m) from collision to apply severe penalty, similar to footprint inflation. Between 0.05-0.2 is reasonable. Note that it will highly influence the controller not to enter spaces more confined than this, so ensure this parameter is set lower than the narrowest you expect the robot to need to traverse through.
```

near\_goal\_distance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.50 |
```

```
Description
:   Distance (m) near goal to stop applying preferential obstacle term to allow robot to smoothly converge to goal pose in close proximity to obstacles.
```

cost\_scaling\_factor
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10.0 |
```

```
Description
:   Exponential decay factor across inflation radius. This should be the same as for your inflation layer (Humble only)
```

inflation\_radius
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.55 |
```

```
Description
:   Radius to inflate costmap around lethal obstacles. This should be the same as for your inflation layer (Humble only)
```

inflation\_layer\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “” |
```

```
Description
:   Name of the inflation layer. If empty, it uses the last inflation layer in the costmap. If you have multiple inflation layers, you may want to specify the name of the layer to use.
```

###### Cost Critic

This critic incentivizes navigating away from obstacles and critical collisions using either a circular robot point-check or full SE2 footprint check using the costmap values.

cost\_weight
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 3.81 |
```

```
Description
:   Weight to apply to critic.
```

cost\_power
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1 |
```

```
Description
:   Power order to apply to term.
```

consider\_footprint
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to use point cost (if robot is circular or low compute power) or compute SE2 footprint cost.
```

collision\_cost
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1000000.0 |
```

```
Description
:   Cost to apply to a true collision in a trajectory.
```

near\_collision\_cost
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 253 |
```

```
Description
:   Costmap cost value to set a maximum proximity for avoidance.
```

critical\_cost
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 300.0 |
```

```
Description
:   Cost to apply to a pose with a cost higher than the near\_collision\_cost.
```

near\_goal\_distance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.50 |
```

```
Description
:   Distance (m) near goal to stop applying preferential obstacle term to allow robot to smoothly converge to goal pose in close proximity to obstacles.
```

inflation\_layer\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “” |
```

```
Description
:   Name of the inflation layer. If empty, it uses the last inflation layer in the costmap. If you have multiple inflation layers, you may want to specify the name of the layer to use.
```

trajectory\_point\_step
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 2 |
```

```
Description
:   The step to take in trajectories for evaluating them in the critic. Since trajectories are extremely dense, its unnecessary to evaluate each point and computationally expensive.
```

###### Path Align Critic

This critic incentivizes aligning with the global path, if relevant. It does not implement path following behavior.

cost\_weight
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10.0 |
```

```
Description
:   Weight to apply to critic term.
```

cost\_power
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1 |
```

```
Description
:   Power order to apply to term.
```

threshold\_to\_consider
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description
:   Distance (m) between robot and goal to **stop** considering path alignment and allow goal critics to take over.
```

offset\_from\_furthest
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 20 |
```

```
Description
:   Checks that the candidate trajectories are sufficiently far along their way tracking the path to apply the alignment critic. This ensures that path alignment is only considered when actually tracking the path, preventing awkward initialization motions preventing the robot from leaving the path to achieve the appropriate heading.
```

max\_path\_occupancy\_ratio
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.07 |
```

```
Description
:   Maximum proportion of the path that can be occupied before this critic is not considered to allow the obstacle and path follow critics to avoid obstacles while following the path’s intent in presence of dynamic objects in the scene. Between 0-1 for 0-100%.
```

use\_path\_orientations
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to consider path’s orientations in path alignment, which can be useful when paired with feasible smac planners to incentivize directional changes only where/when the smac planner requests them. If you want the robot to deviate and invert directions where the controller sees fit, keep as false. If your plans do not contain orientation information (e.g. navfn), keep as false.
```

trajectory\_point\_step
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 4 |
```

```
Description
:   The step to take in trajectories for evaluating them in the critic. Since trajectories are extremely dense, its unnecessary to evaluate each point and computationally expensive.
```

###### Path Angle Critic

This critic penalizes trajectories at a high relative angle to the path. This helps the robot make sharp turns when necessary due to large accumulated angular errors.

cost\_weight
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.2 |
```

```
Description
:   Weight to apply to critic term.
```

cost\_power
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1 |
```

```
Description
:   Power order to apply to term.
```

threshold\_to\_consider
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description
:   Distance (m) between robot and goal to **stop** considering path angles and allow goal critics to take over.
```

offset\_from\_furthest
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 20 |
```

```
Description
:   Number of path points after furthest one any trajectory achieves to compute path angle relative to.
```

max\_angle\_to\_furthest
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.785398 |
```

```
Description
:   Angular distance (rad) between robot and goal above which path angle cost starts being considered
```

mode
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 0 |
```

```
Description
:   Enum type for mode of operations for the path angle critic depending on path input types and behavioral desires. 0: Forward Preference, penalizes high path angles relative to the robot’s orientation to incentivize turning towards the path. 1: No directional preference, penalizes high path angles relative to the robot’s orientation or mirrored orientation (e.g. reverse), which ever is less, when a particular direction of travel is not preferable. 2: Consider feasible path orientation, when using a feasible path whereas the path points have orientation information (e.g. Smac Planners), consider the path’s requested direction of travel to penalize path angles such that the robot will follow the path in the requested direction.
```

###### Path Follow Critic

This critic incentivizes making progress along the path. This is what drives the robot forward along the path.

cost\_weight
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 5.0 |
```

```
Description
:   Weight to apply to critic term.
```

cost\_power
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1 |
```

```
Description
:   Power order to apply to term.
```

threshold\_to\_consider
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.4 |
```

```
Description
:   Distance (m) between robot and goal to **stop** considering path following and allow goal critics to take over. It is wise to start with this as being the same as your prediction horizon to have a clean hand-off with the goal critic.
```

offset\_from\_furthest
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 6 |
```

```
Description
:   Number of path points after furthest one any trajectory achieves to drive path tracking relative to.
```

###### Prefer Forward Critic

This critic incentivizes moving in the forward direction, rather than reversing.

cost\_weight
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 5.0 |
```

```
Description
:   Weight to apply to critic term.
```

cost\_power
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1 |
```

```
Description
:   Power order to apply to term.
```

threshold\_to\_consider
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description
:   Distance (m) between robot and goal to **stop** considering preferring forward and allow goal critics to take over.
```

###### Twirling Critic

This critic penalizes unnecessary ‘twisting’ with holonomic vehicles. It adds a constraint on the rotation angle to keep it consistent.

cost\_weight
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10.0 |
```

```
Description
:   Weight to apply to critic term.
```

cost\_power
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1 |
```

```
Description
:   Power order to apply to term.
```

###### Velocity Deadband Critic

This critic penalizes velocities that fall below the deadband threshold, helping to mitigate hardware limitations on certain platforms.

cost\_weight
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 35.0 |
```

```
Description
:   Weight to apply to critic term.
```

cost\_power
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1 |
```

```
Description
:   Power order to apply to term.
```

deadband\_velocities
:   |  |  |
```
| --- | --- |
| Type | Default |
| array of double | [0.05, 0.05, 0.05] |
```

```
Description
:   The array of deadband velocities [vx, vz, wz]. A zero array indicates that the critic will take no action.
```

###### Example

```
controller_server:
  ros__parameters:
    controller_frequency: 30.0
    FollowPath:
      plugin: "nav2_mppi_controller::MPPIController"
      time_steps: 56
      model_dt: 0.05
      batch_size: 2000
      vx_std: 0.2
      vy_std: 0.2
      wz_std: 0.4
      vx_max: 0.5
      vx_min: -0.35
      vy_max: 0.5
      wz_max: 1.9
      ax_max: 3.0
      ax_min: -3.0
      ay_min: -3.0
      ay_max: 3.0
      az_max: 3.5
      iteration_count: 1
      temperature: 0.3
      gamma: 0.015
      motion_model: "DiffDrive"
      visualize: false
      reset_period: 1.0 # (only in Humble)
      regenerate_noises: false
      TrajectoryVisualizer:
        trajectory_step: 5
        time_step: 3
      TrajectoryValidator:
        plugin: "mppi::DefaultOptimalTrajectoryValidator"
        collision_lookahead_time: 2.0
        consider_footprint: false
      AckermannConstraints:
        min_turning_r: 0.2
      critics: ["ConstraintCritic", "CostCritic", "GoalCritic", "GoalAngleCritic", "PathAlignCritic", "PathFollowCritic", "PathAngleCritic", "PreferForwardCritic"]
      ConstraintCritic:
        enabled: true
        cost_power: 1
        cost_weight: 4.0
      GoalCritic:
        enabled: true
        cost_power: 1
        cost_weight: 5.0
        threshold_to_consider: 1.4
      GoalAngleCritic:
        enabled: true
        cost_power: 1
        cost_weight: 3.0
        threshold_to_consider: 0.5
      PreferForwardCritic:
        enabled: true
        cost_power: 1
        cost_weight: 5.0
        threshold_to_consider: 0.5
      # ObstaclesCritic:
      #   enabled: true
      #   cost_power: 1
      #   repulsion_weight: 1.5
      #   critical_weight: 20.0
      #   consider_footprint: false
      #   collision_cost: 10000.0
      #   collision_margin_distance: 0.1
      #   near_goal_distance: 0.5
      #   inflation_radius: 0.55 # (only in Humble)
      #   cost_scaling_factor: 10.0 # (only in Humble)
      CostCritic:
        enabled: true
        cost_power: 1
        cost_weight: 3.81
        critical_cost: 300.0
        consider_footprint: true
        collision_cost: 1000000.0
        near_goal_distance: 1.0
        trajectory_point_step: 2
      PathAlignCritic:
        enabled: true
        cost_power: 1
        cost_weight: 14.0
        max_path_occupancy_ratio: 0.05
        trajectory_point_step: 4
        threshold_to_consider: 0.5
        offset_from_furthest: 20
        use_path_orientations: false
      PathFollowCritic:
        enabled: true
        cost_power: 1
        cost_weight: 5.0
        offset_from_furthest: 5
        threshold_to_consider: 1.4
      PathAngleCritic:
        enabled: true
        cost_power: 1
        cost_weight: 2.0
        offset_from_furthest: 4
        threshold_to_consider: 0.5
        max_angle_to_furthest: 1.0
        mode: 0
      # VelocityDeadbandCritic:
      #   enabled: true
      #   cost_power: 1
      #   cost_weight: 35.0
      #   deadband_velocities: [0.05, 0.05, 0.05]
      # TwirlingCritic:
      #   enabled: true
      #   twirling_cost_power: 1
      #   twirling_cost_weight: 10.0
```

###### Notes to Users

###### General Words of Wisdom

The `model_dt` parameter generally should be set to the duration of your control frequency. So if your control frequency is 20hz, this should be `0.05`. However, you may also set it lower **but not larger**.

Visualization of the trajectories using `visualize` uses compute resources to back out trajectories for visualization and therefore slows compute time. It is not suggested that this parameter is set to `true` during a deployed use, but is a useful debug instrument while tuning the system, but use sparingly. Visualizing 2000 batches @ 56 points at 30 hz is *a lot*.

The most common parameters you might want to start off changing are the velocity profiles (`vx_max`, `vx_min`, `wz_max`, and `vy_max` if holonomic) and the `motion_model` to correspond to your vehicle. Its wise to consider the `prune_distance` of the path plan in proportion to your maximum velocity and prediction horizon. The only deeper parameter that will likely need to be adjusted for your particular settings is the Obstacle critics’ `repulsion_weight` since the tuning of this is proprtional to your inflation layer’s radius. Higher radii should correspond to reduced `repulsion_weight` due to the penalty formation (e.g. `inflation_radius - min_dist_to_obstacle`). If this penalty is too high, the robot will slow significantly when entering cost-space from non-cost space or jitter in narrow corridors. It is noteworthy, but likely not necessary to be changed, that the Obstacle critic may use the full footprint information if `consider_footprint = true`, though comes at an increased compute cost.

Otherwise, the parameters have been closely pre-tuned by your friendly neighborhood navigator to give you a decent starting point that hopefully you only need to retune for your specific desired behavior lightly (if at all). Varying costmap parameters or maximum speeds are the actions which require the most attention, as described below:

###### Prediction Horizon, Costmap Sizing, and Offsets

As this is a predictive planner, there is some relationship between maximum speed, prediction times, std sampling, and costmap size that users should keep in mind while tuning for their application. If a controller server costmap is set to 3.0m in size, that means that with the robot in the center, there is 1.5m of information on either side of the robot. When your prediction horizon (`time_steps * model_dt`) at maximum speed (`vx_max`) is larger than this, then your robot will be artificially limited in its maximum speeds and behavior by the costmap limitation. For example, if you predict forward 3 seconds (60 steps @ 0.05s per step) at 0.5m/s maximum speed, the **minimum** required costmap radius is 1.5m - or 3m total width. The faster the robot is set to go, the higher the velocity sampling standard deviations should be in order to effectively explore the velocity space.

The same applies to the Path Follow and Align offsets from furthest. In the same example if the furthest point we can consider is already at the edge of the costmap, then further offsets are thresholded because they’re unusable. So its important while selecting these parameters to make sure that the theoretical offsets can exist on the costmap settings selected with the maximum prediction horizon and velocities desired. Setting the threshold for consideration in the path follower + goal critics as the same as your prediction horizon can make sure you have clean hand-offs between them, as the path follower will otherwise attempt to slow slightly once it reaches the final goal pose as its marker.

The Path Follow critic cannot drive velocities greater than the projectable distance of that velocity on the available path on the rolling costmap. The Path Align critic offset\_from\_furthest represents the number of path points a trajectory passes through while tracking the path. If this is set either absurdly low (e.g. 5) it can trigger when a robot is simply trying to start path tracking causing some suboptimal behaviors and local minima while starting a task. If it is set absurdly high (e.g. 50) relative to the path resolution and costmap size, then the critic may never trigger or only do so when at full-speed. A balance here is wise. A selection of this value to be ~30% of the maximum velocity distance projected is good (e.g. if a planner produces points every 2.5cm, 60 can fit on the 1.5m local costmap radius. If the max speed is 0.5m/s with a 3s prediction time, then 20 points represents 33% of the maximum speed projected over the prediction horizon onto the path). When in doubt, `prediction_horizon_s * max_speed / path_resolution / 3.0` is a good baseline.

###### Obstacle, Inflation Layer, and Path Following

There also exists a relationship between the costmap configurations and the Obstacle critic configurations. If the Obstacle critic is not well tuned with the costmap parameters (inflation radius, scale) it can cause the robot to wobble significantly as it attempts to take finitely lower-cost trajectories with a slightly lower cost in exchange for jerky motion. It may also perform awkward maneuvers when in free-space to try to maximize time in a small pocket of 0-cost over a more natural motion which involves moving into some low-costed region. Finally, it may generally refuse to go into costed space at all when starting in a free 0-cost space if the gain is set disproportionately higher than the Path Follow scoring to encourage the robot to move along the path. This is due to the critic cost of staying in free space becoming more attractive than entering even lightly costed space in exchange for progression along the task.

Thus, care should be taken to select weights of the obstacle critic in conjunction with the costmap inflation radius and scale so that a robot does not have such issues. How I (Steve, your friendly neighborhood navigator) tuned this was to first create the appropriate obstacle critic behavior desirable in conjunction with the inflation layer parameters. Its worth noting that the Obstacle critic converts the cost into a distance from obstacles, so the nature of the distribution of costs in the inflation isn’t overly significant. However, the inflation radius and the scale will define the cost at the end of the distribution where free-space meets the lowest cost value within the radius. So testing for quality behavior when going over that threshold should be considered.

As you increase or decrease your weights on the Obstacle, you may notice the aforementioned behaviors (e.g. won’t overcome free to non-free threshold). To overcome them, increase the FollowPath critic cost to increase the desire for the trajectory planner to continue moving towards the goal. Make sure to not overshoot this though, keep them balanced. A desirable outcome is smooth motion roughly in the center of spaces without significant close interactions with obstacles. It shouldn’t be perfectly following a path yet nor should the output velocity be wobbling jaggedly.

Once you have your obstacle avoidance behavior tuned and matched with an appropriate path following penalty, tune the Path Align critic to align with the path. If you design exact-path-alignment behavior, its possible to skip the obstacle critic step as highly tuning the system to follow the path will give it less ability to deviate to avoid obstacles (though it’ll slow and stop). Tuning the critic weight for the Obstacle critic high will do the job to avoid near-collisions but the repulsion weight is largely unnecessary to you. For others wanting more dynamic behavior, it *can* be beneficial to slowly lower the weight on the obstacle critic to give the path alignment critic some more room to work. If your path was generated with a cost-aware planner (like all provided by Nav2) and providing paths sufficiently far from obstacles for your satisfaction, the impact of a slightly reduced Obstacle critic with a Path Alignment critic will do you well. Not over-weighting the path align critic will allow the robot to deviate from the path to get around dynamic obstacles in the scene or other obstacles not previous considered during path planning. It is subjective as to the best behavior for your application, but it has been shown that MPPI can be an exact path tracker and/or avoid dynamic obstacles very fluidly and everywhere in between. The defaults provided are in the generally right regime for a balanced initial trade-off.

#### Parameters

**`motion_model`**
- Type: `unknown`
- TypeDefaultstring“DiffDrive”DescriptionThe desired motion model to use for trajectory planning. Options areDiffDrive,Omni, orAckermann. Differential drive robots may use forward/reverse and angular velocities; Omni add in lateral motion; and Ackermann adds minimum curvature constraints.

**`critics`**
- Type: `unknown`
- TypeDefaultstring vectorN/ADescriptionA vector of critic plugin functions to use, withoutmppi::critic::namespace which will be automatically added on loading.

**`iteration_count`**
- Type: `unknown`
- TypeDefaultint1DescriptionIteration count in the MPPI algorithm. Recommended to remain as 1 and instead prefer larger batch sizes.

**`batch_size`**
- Type: `unknown`
- TypeDefaultint1000DescriptionCount of randomly sampled candidate trajectories from current optimal control sequence in a given iteration. 1000 @ 50 Hz or 2000 @ 30 Hz seems to produce good results.

**`time_steps`**
- Type: `unknown`
- TypeDefaultint56DescriptionNumber of time steps (points) in candidate trajectories

**`model_dt`**
- Type: `unknown`
- TypeDefaultdouble0.05DescriptionLength of each time step’sdttimestep, in seconds.time_steps*model_dtis the prediction horizon.

**`vx_std`**
- Type: `unknown`
- TypeDefaultdouble0.2DescriptionSampling standard deviation for Vx

**`vy_std`**
- Type: `unknown`
- TypeDefaultdouble0.2DescriptionSampling standard deviation for Vy

**`wz_std`**
- Type: `unknown`
- TypeDefaultdouble0.2DescriptionSampling standard deviation for Wz (angular velocity)

**`vx_max`**
- Type: `unknown`
- TypeDefaultdouble0.5DescriptionTarget maximum forward velocity (m/s).

**`vy_max`**
- Type: `unknown`
- TypeDefaultdouble0.5DescriptionTarget maximum lateral velocity, if usingOmnimotion model (m/s).

**`vx_min`**
- Type: `unknown`
- TypeDefaultdouble-0.35DescriptionMaximum reverse velocity (m/s).

**`wz_max`**
- Type: `unknown`
- TypeDefaultdouble1.9DescriptionMaximum rotational velocity (rad/s).

**`ax_max`**
- Type: `unknown`
- TypeDefaultdouble3.0DescriptionMaximum forward acceleration (m/s^2).

**`ay_min`**
- Type: `unknown`
- TypeDefaultdouble-3.0DescriptionMinimum lateral acceleration in either direction, if usingOmnimotion model (m/s^2).

**`ay_max`**
- Type: `unknown`
- TypeDefaultdouble3.0DescriptionMaximum lateral acceleration in either direction, if usingOmnimotion model (m/s^2).

**`ax_min`**
- Type: `unknown`
- TypeDefaultdouble-3.0DescriptionMaximum deceleration along the X-axis (m/s^2).

**`az_max`**
- Type: `unknown`
- TypeDefaultdouble3.5DescriptionMaximum angular acceleration (rad/s^2).

**`temperature`**
- Type: `unknown`
- TypeDefaultdouble0.3DescriptionSelectiveness of trajectories by their costs (The closer this value to 0, the “more” we take in consideration controls with less cost), 0 mean use control with best cost, huge value will lead to just taking mean of all trajectories without cost consideration.

**`gamma`**
- Type: `unknown`
- TypeDefaultdouble0.015DescriptionA trade-off between smoothness (high) and low energy (low). This is a complex parameter that likely won’t need to be changed from the default. See Section 3D-2 in “Information Theoretic Model Predictive Control: Theory and Applications to Autonomous Driving” for detailed information.

**`visualize`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to publish debugging trajectories for visualization. This can slow down the controller substantially (e.g. 1000 batches of 56 size every 30hz is a lot of data).

**`publish_optimal_trajectory`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to publish the optimal trajectory (pose, velocity, timestamps of via points) computed by MPC for visualization, debugging, or injection by lower-level control systems and/or collision avoidance systems that need awarenes of future velocity commands and/or poses.

**`retry_attempt_limit`**
- Type: `unknown`
- TypeDefaultint1DescriptionNumber of attempts to find feasible trajectory on failure for soft-resets before reporting total failure.

**`reset_period`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionRequired time of inactivity to reset optimizer  (only in Humble due to backport ABI policies).

**`regenerate_noises`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to regenerate noises each iteration or use single noise distribution computed on initialization and reset. Practically, this is found to work fine since the trajectories are being sampled stochastically from a normal distribution and reduces compute jittering at run-time due to thread wake-ups to resample normal distribution.

**`publish_critics_stats`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to publish statistics about each critic’s performance. When enabled, publishes anav2_msgs::msg::CriticsStatsmessage containing critic names, whether they changed costs, and the sum of costs added by each critic for all trajectory samples. Useful for debugging and tuning critic behavior but should not be enabled for generic runtime use.

**`open_loop`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to use last command velocity or use odometry for MPPI initial state estimation. When enable, use last command velocity for MPPI initial state estimation.

**`TrajectoryValidator.plugin`**
- Type: `unknown`
- TypeDefaultstring“mppi::DefaultOptimalTrajectoryValidator”DescriptionThe plugin to use for validating final optimal trajectories.

**`Description`**
- Type: `unknown`
- The desired motion model to use for trajectory planning. Options areDiffDrive,Omni, orAckermann. Differential drive robots may use forward/reverse and angular velocities; Omni add in lateral motion; and Ackermann adds minimum curvature constraints.

**`Description`**
- Type: `unknown`
- A vector of critic plugin functions to use, withoutmppi::critic::namespace which will be automatically added on loading.

**`Description`**
- Type: `unknown`
- Iteration count in the MPPI algorithm. Recommended to remain as 1 and instead prefer larger batch sizes.

**`Description`**
- Type: `unknown`
- Count of randomly sampled candidate trajectories from current optimal control sequence in a given iteration. 1000 @ 50 Hz or 2000 @ 30 Hz seems to produce good results.

**`Description`**
- Type: `unknown`
- Number of time steps (points) in candidate trajectories

**`Description`**
- Type: `unknown`
- Length of each time step’sdttimestep, in seconds.time_steps*model_dtis the prediction horizon.

**`Description`**
- Type: `unknown`
- Sampling standard deviation for Vx

**`Description`**
- Type: `unknown`
- Sampling standard deviation for Vy

**`Description`**
- Type: `unknown`
- Sampling standard deviation for Wz (angular velocity)

**`Description`**
- Type: `unknown`
- Target maximum forward velocity (m/s).

**`Description`**
- Type: `unknown`
- Target maximum lateral velocity, if usingOmnimotion model (m/s).

**`Description`**
- Type: `unknown`
- Maximum reverse velocity (m/s).

**`Description`**
- Type: `unknown`
- Maximum rotational velocity (rad/s).

**`Description`**
- Type: `unknown`
- Maximum forward acceleration (m/s^2).

**`Description`**
- Type: `unknown`
- Minimum lateral acceleration in either direction, if usingOmnimotion model (m/s^2).

**`Description`**
- Type: `unknown`
- Maximum lateral acceleration in either direction, if usingOmnimotion model (m/s^2).

**`Description`**
- Type: `unknown`
- Maximum deceleration along the X-axis (m/s^2).

**`Description`**
- Type: `unknown`
- Maximum angular acceleration (rad/s^2).

**`Description`**
- Type: `unknown`
- Selectiveness of trajectories by their costs (The closer this value to 0, the “more” we take in consideration controls with less cost), 0 mean use control with best cost, huge value will lead to just taking mean of all trajectories without cost consideration.

**`Description`**
- Type: `unknown`
- A trade-off between smoothness (high) and low energy (low). This is a complex parameter that likely won’t need to be changed from the default. See Section 3D-2 in “Information Theoretic Model Predictive Control: Theory and Applications to Autonomous Driving” for detailed information.

**`Description`**
- Type: `unknown`
- Whether to publish debugging trajectories for visualization. This can slow down the controller substantially (e.g. 1000 batches of 56 size every 30hz is a lot of data).

**`Description`**
- Type: `unknown`
- Whether to publish the optimal trajectory (pose, velocity, timestamps of via points) computed by MPC for visualization, debugging, or injection by lower-level control systems and/or collision avoidance systems that need awarenes of future velocity commands and/or poses.

**`Description`**
- Type: `unknown`
- Number of attempts to find feasible trajectory on failure for soft-resets before reporting total failure.

**`Description`**
- Type: `unknown`
- Required time of inactivity to reset optimizer  (only in Humble due to backport ABI policies).

**`Description`**
- Type: `unknown`
- Whether to regenerate noises each iteration or use single noise distribution computed on initialization and reset. Practically, this is found to work fine since the trajectories are being sampled stochastically from a normal distribution and reduces compute jittering at run-time due to thread wake-ups to resample normal distribution.

**`Description`**
- Type: `unknown`
- Whether to publish statistics about each critic’s performance. When enabled, publishes anav2_msgs::msg::CriticsStatsmessage containing critic names, whether they changed costs, and the sum of costs added by each critic for all trajectory samples. Useful for debugging and tuning critic behavior but should not be enabled for generic runtime use.

**`Description`**
- Type: `unknown`
- Whether to use last command velocity or use odometry for MPPI initial state estimation. When enable, use last command velocity for MPPI initial state estimation.

**`Description`**
- Type: `unknown`
- The plugin to use for validating final optimal trajectories.

**`trajectory_step`**
- Type: `unknown`
- TypeDefaultint5DescriptionThe step between trajectories to visualize to downsample candidate trajectory pool.

**`time_step`**
- Type: `unknown`
- TypeDefaultint3DescriptionThe step between points on trajectories to visualize to downsample trajectory density.

**`allow_parameter_qos_overrides`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to allow QoS profiles to be overwritten with parameterized values.

**`Description`**
- Type: `unknown`
- The step between trajectories to visualize to downsample candidate trajectory pool.

**`Description`**
- Type: `unknown`
- The step between points on trajectories to visualize to downsample trajectory density.

**`Description`**
- Type: `unknown`
- Whether to allow QoS profiles to be overwritten with parameterized values.

**`min_turning_r`**
- Type: `unknown`
- TypeDefaultdouble0.2DescriptionThe minimum turning radius possible for the vehicle platform (m).

**`Description`**
- Type: `unknown`
- The minimum turning radius possible for the vehicle platform (m).

**`collision_lookahead_time`**
- Type: `unknown`
- TypeDefaultdouble2.0DescriptionThe time in seconds to look ahead for potential collisions when validating the trajectory.

**`consider_footprint`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to consider the robot’s footprint when validating the trajectory. Else, will use the center point cost of a circular robot

**`Description`**
- Type: `unknown`
- The time in seconds to look ahead for potential collisions when validating the trajectory.

**`Description`**
- Type: `unknown`
- Whether to consider the robot’s footprint when validating the trajectory. Else, will use the center point cost of a circular robot

**`cost_weight`**
- Type: `unknown`
- TypeDefaultdouble4.0DescriptionWeight to apply to critic term.

**`cost_power`**
- Type: `unknown`
- TypeDefaultint1DescriptionPower order to apply to term.

**`Description`**
- Type: `unknown`
- Weight to apply to critic term.

**`Description`**
- Type: `unknown`
- Power order to apply to term.

**`cost_weight`**
- Type: `unknown`
- TypeDefaultdouble3.0DescriptionWeight to apply to critic term.

**`cost_power`**
- Type: `unknown`
- TypeDefaultint1DescriptionPower order to apply to term.

**`threshold_to_consider`**
- Type: `unknown`
- TypeDefaultdouble0.5DescriptionMinimal distance (m) between robot and goal above which angle goal cost considered.

**`symmetric_yaw_tolerance`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionEnable symmetric goal orientation acceptance. When enabled, the critic prefers trajectories that approach the goal at either the goal orientation or the goal orientation + 180°. This is useful for symmetric robots (e.g., differential drives with sensors on both ends) that can navigate equally well in forward and backward directions and does not care which direction it ends in (i.e. MPPI decides). When enabled, the critic uses the minimum distance to either goal orientation, reducing the cost penalty for approaching from the backward direction. SeeTuning Guidefor detailed information.

**`Description`**
- Type: `unknown`
- Weight to apply to critic term.

**`Description`**
- Type: `unknown`
- Power order to apply to term.

**`Description`**
- Type: `unknown`
- Minimal distance (m) between robot and goal above which angle goal cost considered.

**`Description`**
- Type: `unknown`
- Enable symmetric goal orientation acceptance. When enabled, the critic prefers trajectories that approach the goal at either the goal orientation or the goal orientation + 180°. This is useful for symmetric robots (e.g., differential drives with sensors on both ends) that can navigate equally well in forward and backward directions and does not care which direction it ends in (i.e. MPPI decides). When enabled, the critic uses the minimum distance to either goal orientation, reducing the cost penalty for approaching from the backward direction. SeeTuning Guidefor detailed information.

**`cost_weight`**
- Type: `unknown`
- TypeDefaultdouble5.0DescriptionWeight to apply to critic term.

**`cost_power`**
- Type: `unknown`
- TypeDefaultint1DescriptionPower order to apply to term.

**`threshold_to_consider`**
- Type: `unknown`
- TypeDefaultdouble1.4DescriptionMinimal distance (m) between robot and goal above which goal distance cost considered. It is wise to start with this as being the same as your prediction horizon to have a clean hand-off with the path follower critic.

**`Description`**
- Type: `unknown`
- Weight to apply to critic term.

**`Description`**
- Type: `unknown`
- Power order to apply to term.

**`Description`**
- Type: `unknown`
- Minimal distance (m) between robot and goal above which goal distance cost considered. It is wise to start with this as being the same as your prediction horizon to have a clean hand-off with the path follower critic.

**`critical_weight`**
- Type: `unknown`
- TypeDefaultdouble20.0DescriptionWeight to apply to critic for near collisions closer thancollision_margin_distanceto prevent near collisionsonlyas a method of virtually inflating the footprint. This should not be used to generally influence obstacle avoidance away from critical collisions.

**`repulsion_weight`**
- Type: `unknown`
- TypeDefaultdouble1.5DescriptionWeight to apply to critic for generally preferring routes in lower cost space. This is separated from the critical term to allow for fine tuning of obstacle behaviors with path alignment for dynamic scenes without impacting actions which may directly lead to near-collisions. This is applied within theinflation_radiusdistance from obstacles.

**`cost_power`**
- Type: `unknown`
- TypeDefaultint1DescriptionPower order to apply to term.

**`consider_footprint`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to use point cost (if robot is circular or low compute power) or compute SE2 footprint cost.

**`collision_cost`**
- Type: `unknown`
- TypeDefaultdouble100000.0DescriptionCost to apply to a true collision in a trajectory.

**`collision_margin_distance`**
- Type: `unknown`
- TypeDefaultdouble0.10DescriptionMargin distance (m) from collision to apply severe penalty, similar to footprint inflation. Between 0.05-0.2 is reasonable. Note that it will highly influence the controller not to enter spaces more confined than this, so ensure this parameter is set lower than the narrowest you expect the robot to need to traverse through.

**`near_goal_distance`**
- Type: `unknown`
- TypeDefaultdouble0.50DescriptionDistance (m) near goal to stop applying preferential obstacle term to allow robot to smoothly converge to goal pose in close proximity to obstacles.

**`cost_scaling_factor`**
- Type: `unknown`
- TypeDefaultdouble10.0DescriptionExponential decay factor across inflation radius. This should be the same as for your inflation layer (Humble only)

**`inflation_radius`**
- Type: `unknown`
- TypeDefaultdouble0.55DescriptionRadius to inflate costmap around lethal obstacles. This should be the same as for your inflation layer (Humble only)

**`inflation_layer_name`**
- Type: `unknown`
- TypeDefaultstring“”DescriptionName of the inflation layer. If empty, it uses the last inflation layer in the costmap. If you have multiple inflation layers, you may want to specify the name of the layer to use.

**`Description`**
- Type: `unknown`
- Weight to apply to critic for near collisions closer thancollision_margin_distanceto prevent near collisionsonlyas a method of virtually inflating the footprint. This should not be used to generally influence obstacle avoidance away from critical collisions.

**`Description`**
- Type: `unknown`
- Weight to apply to critic for generally preferring routes in lower cost space. This is separated from the critical term to allow for fine tuning of obstacle behaviors with path alignment for dynamic scenes without impacting actions which may directly lead to near-collisions. This is applied within theinflation_radiusdistance from obstacles.

**`Description`**
- Type: `unknown`
- Power order to apply to term.

**`Description`**
- Type: `unknown`
- Whether to use point cost (if robot is circular or low compute power) or compute SE2 footprint cost.

**`Description`**
- Type: `unknown`
- Cost to apply to a true collision in a trajectory.

**`Description`**
- Type: `unknown`
- Margin distance (m) from collision to apply severe penalty, similar to footprint inflation. Between 0.05-0.2 is reasonable. Note that it will highly influence the controller not to enter spaces more confined than this, so ensure this parameter is set lower than the narrowest you expect the robot to need to traverse through.

**`Description`**
- Type: `unknown`
- Distance (m) near goal to stop applying preferential obstacle term to allow robot to smoothly converge to goal pose in close proximity to obstacles.

**`Description`**
- Type: `unknown`
- Exponential decay factor across inflation radius. This should be the same as for your inflation layer (Humble only)

**`Description`**
- Type: `unknown`
- Radius to inflate costmap around lethal obstacles. This should be the same as for your inflation layer (Humble only)

**`Description`**
- Type: `unknown`
- Name of the inflation layer. If empty, it uses the last inflation layer in the costmap. If you have multiple inflation layers, you may want to specify the name of the layer to use.

**`cost_weight`**
- Type: `unknown`
- TypeDefaultdouble3.81DescriptionWeight to apply to critic.

**`cost_power`**
- Type: `unknown`
- TypeDefaultint1DescriptionPower order to apply to term.

**`consider_footprint`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to use point cost (if robot is circular or low compute power) or compute SE2 footprint cost.

**`collision_cost`**
- Type: `unknown`
- TypeDefaultdouble1000000.0DescriptionCost to apply to a true collision in a trajectory.

**`near_collision_cost`**
- Type: `unknown`
- TypeDefaultint253DescriptionCostmap cost value to set a maximum proximity for avoidance.

**`critical_cost`**
- Type: `unknown`
- TypeDefaultdouble300.0DescriptionCost to apply to a pose with a cost higher than the near_collision_cost.

**`near_goal_distance`**
- Type: `unknown`
- TypeDefaultdouble0.50DescriptionDistance (m) near goal to stop applying preferential obstacle term to allow robot to smoothly converge to goal pose in close proximity to obstacles.

**`inflation_layer_name`**
- Type: `unknown`
- TypeDefaultstring“”DescriptionName of the inflation layer. If empty, it uses the last inflation layer in the costmap. If you have multiple inflation layers, you may want to specify the name of the layer to use.

**`trajectory_point_step`**
- Type: `unknown`
- TypeDefaultint2DescriptionThe step to take in trajectories for evaluating them in the critic. Since trajectories are extremely dense, its unnecessary to evaluate each point and computationally expensive.

**`Description`**
- Type: `unknown`
- Weight to apply to critic.

**`Description`**
- Type: `unknown`
- Power order to apply to term.

**`Description`**
- Type: `unknown`
- Whether to use point cost (if robot is circular or low compute power) or compute SE2 footprint cost.

**`Description`**
- Type: `unknown`
- Cost to apply to a true collision in a trajectory.

**`Description`**
- Type: `unknown`
- Costmap cost value to set a maximum proximity for avoidance.

**`Description`**
- Type: `unknown`
- Cost to apply to a pose with a cost higher than the near_collision_cost.

**`Description`**
- Type: `unknown`
- Distance (m) near goal to stop applying preferential obstacle term to allow robot to smoothly converge to goal pose in close proximity to obstacles.

**`Description`**
- Type: `unknown`
- Name of the inflation layer. If empty, it uses the last inflation layer in the costmap. If you have multiple inflation layers, you may want to specify the name of the layer to use.

**`Description`**
- Type: `unknown`
- The step to take in trajectories for evaluating them in the critic. Since trajectories are extremely dense, its unnecessary to evaluate each point and computationally expensive.

**`cost_weight`**
- Type: `unknown`
- TypeDefaultdouble10.0DescriptionWeight to apply to critic term.

**`cost_power`**
- Type: `unknown`
- TypeDefaultint1DescriptionPower order to apply to term.

**`threshold_to_consider`**
- Type: `unknown`
- TypeDefaultdouble0.5DescriptionDistance (m) between robot and goal tostopconsidering path alignment and allow goal critics to take over.

**`offset_from_furthest`**
- Type: `unknown`
- TypeDefaultint20DescriptionChecks that the candidate trajectories are sufficiently far along their way tracking the path to apply the alignment critic. This ensures that path alignment is only considered when actually tracking the path, preventing awkward initialization motions preventing the robot from leaving the path to achieve the appropriate heading.

**`max_path_occupancy_ratio`**
- Type: `unknown`
- TypeDefaultdouble0.07DescriptionMaximum proportion of the path that can be occupied before this critic is not considered to allow the obstacle and path follow critics to avoid obstacles while following the path’s intent in presence of dynamic objects in the scene. Between 0-1 for 0-100%.

**`use_path_orientations`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to consider path’s orientations in path alignment, which can be useful when paired with feasible smac planners to incentivize directional changes only where/when the smac planner requests them. If you want the robot to deviate and invert directions where the controller sees fit, keep as false. If your plans do not contain orientation information (e.g. navfn), keep as false.

**`trajectory_point_step`**
- Type: `unknown`
- TypeDefaultint4DescriptionThe step to take in trajectories for evaluating them in the critic. Since trajectories are extremely dense, its unnecessary to evaluate each point and computationally expensive.

**`Description`**
- Type: `unknown`
- Weight to apply to critic term.

**`Description`**
- Type: `unknown`
- Power order to apply to term.

**`Description`**
- Type: `unknown`
- Distance (m) between robot and goal tostopconsidering path alignment and allow goal critics to take over.

**`Description`**
- Type: `unknown`
- Checks that the candidate trajectories are sufficiently far along their way tracking the path to apply the alignment critic. This ensures that path alignment is only considered when actually tracking the path, preventing awkward initialization motions preventing the robot from leaving the path to achieve the appropriate heading.

**`Description`**
- Type: `unknown`
- Maximum proportion of the path that can be occupied before this critic is not considered to allow the obstacle and path follow critics to avoid obstacles while following the path’s intent in presence of dynamic objects in the scene. Between 0-1 for 0-100%.

**`Description`**
- Type: `unknown`
- Whether to consider path’s orientations in path alignment, which can be useful when paired with feasible smac planners to incentivize directional changes only where/when the smac planner requests them. If you want the robot to deviate and invert directions where the controller sees fit, keep as false. If your plans do not contain orientation information (e.g. navfn), keep as false.

**`Description`**
- Type: `unknown`
- The step to take in trajectories for evaluating them in the critic. Since trajectories are extremely dense, its unnecessary to evaluate each point and computationally expensive.

**`cost_weight`**
- Type: `unknown`
- TypeDefaultdouble2.2DescriptionWeight to apply to critic term.

**`cost_power`**
- Type: `unknown`
- TypeDefaultint1DescriptionPower order to apply to term.

**`threshold_to_consider`**
- Type: `unknown`
- TypeDefaultdouble0.5DescriptionDistance (m) between robot and goal tostopconsidering path angles and allow goal critics to take over.

**`offset_from_furthest`**
- Type: `unknown`
- TypeDefaultint20DescriptionNumber of path points after furthest one any trajectory achieves to compute path angle relative to.

**`max_angle_to_furthest`**
- Type: `unknown`
- TypeDefaultdouble0.785398DescriptionAngular distance (rad) between robot and goal above which path angle cost starts being considered

**`mode`**
- Type: `unknown`
- TypeDefaultint0DescriptionEnum type for mode of operations for the path angle critic depending on path input types and behavioral desires. 0: Forward Preference, penalizes high path angles relative to the robot’s orientation to incentivize turning towards the path. 1: No directional preference, penalizes high path angles relative to the robot’s orientation or mirrored orientation (e.g. reverse), which ever is less, when a particular direction of travel is not preferable. 2: Consider feasible path orientation, when using a feasible path whereas the path points have orientation information (e.g. Smac Planners), consider the path’s requested direction of travel to penalize path angles such that the robot will follow the path in the requested direction.

**`Description`**
- Type: `unknown`
- Weight to apply to critic term.

**`Description`**
- Type: `unknown`
- Power order to apply to term.

**`Description`**
- Type: `unknown`
- Distance (m) between robot and goal tostopconsidering path angles and allow goal critics to take over.

**`Description`**
- Type: `unknown`
- Number of path points after furthest one any trajectory achieves to compute path angle relative to.

**`Description`**
- Type: `unknown`
- Angular distance (rad) between robot and goal above which path angle cost starts being considered

**`Description`**
- Type: `unknown`
- Enum type for mode of operations for the path angle critic depending on path input types and behavioral desires. 0: Forward Preference, penalizes high path angles relative to the robot’s orientation to incentivize turning towards the path. 1: No directional preference, penalizes high path angles relative to the robot’s orientation or mirrored orientation (e.g. reverse), which ever is less, when a particular direction of travel is not preferable. 2: Consider feasible path orientation, when using a feasible path whereas the path points have orientation information (e.g. Smac Planners), consider the path’s requested direction of travel to penalize path angles such that the robot will follow the path in the requested direction.

**`cost_weight`**
- Type: `unknown`
- TypeDefaultdouble5.0DescriptionWeight to apply to critic term.

**`cost_power`**
- Type: `unknown`
- TypeDefaultint1DescriptionPower order to apply to term.

**`threshold_to_consider`**
- Type: `unknown`
- TypeDefaultdouble1.4DescriptionDistance (m) between robot and goal tostopconsidering path following and allow goal critics to take over. It is wise to start with this as being the same as your prediction horizon to have a clean hand-off with the goal critic.

**`offset_from_furthest`**
- Type: `unknown`
- TypeDefaultint6DescriptionNumber of path points after furthest one any trajectory achieves to drive path tracking relative to.

**`Description`**
- Type: `unknown`
- Weight to apply to critic term.

**`Description`**
- Type: `unknown`
- Power order to apply to term.

**`Description`**
- Type: `unknown`
- Distance (m) between robot and goal tostopconsidering path following and allow goal critics to take over. It is wise to start with this as being the same as your prediction horizon to have a clean hand-off with the goal critic.

**`Description`**
- Type: `unknown`
- Number of path points after furthest one any trajectory achieves to drive path tracking relative to.

**`cost_weight`**
- Type: `unknown`
- TypeDefaultdouble5.0DescriptionWeight to apply to critic term.

**`cost_power`**
- Type: `unknown`
- TypeDefaultint1DescriptionPower order to apply to term.

**`threshold_to_consider`**
- Type: `unknown`
- TypeDefaultdouble0.5DescriptionDistance (m) between robot and goal tostopconsidering preferring forward and allow goal critics to take over.

**`Description`**
- Type: `unknown`
- Weight to apply to critic term.

**`Description`**
- Type: `unknown`
- Power order to apply to term.

**`Description`**
- Type: `unknown`
- Distance (m) between robot and goal tostopconsidering preferring forward and allow goal critics to take over.

**`cost_weight`**
- Type: `unknown`
- TypeDefaultdouble10.0DescriptionWeight to apply to critic term.

**`cost_power`**
- Type: `unknown`
- TypeDefaultint1DescriptionPower order to apply to term.

**`Description`**
- Type: `unknown`
- Weight to apply to critic term.

**`Description`**
- Type: `unknown`
- Power order to apply to term.

**`cost_weight`**
- Type: `unknown`
- TypeDefaultdouble35.0DescriptionWeight to apply to critic term.

**`cost_power`**
- Type: `unknown`
- TypeDefaultint1DescriptionPower order to apply to term.

**`deadband_velocities`**
- Type: `unknown`
- TypeDefaultarray of double[0.05, 0.05, 0.05]DescriptionThe array of deadband velocities [vx, vz, wz]. A zero array indicates that the critic will take no action.

**`Description`**
- Type: `unknown`
- Weight to apply to critic term.

**`Description`**
- Type: `unknown`
- Power order to apply to term.

**`Description`**
- Type: `unknown`
- The array of deadband velocities [vx, vz, wz]. A zero array indicates that the critic will take no action.


---

#### NavFn Planner

*Source: [https://docs.nav2.org/configuration/packages/configuring-navfn.html](https://docs.nav2.org/configuration/packages/configuring-navfn.html)*

##### NavFn Planner

Source code on [Github](https://github.com/ros-navigation/navigation2/tree/main/nav2_navfn_planner).

The Navfn Planner plugin implements a wavefront Dijkstra or A\* expanded holonomic planner.

`<name>` is the corresponding planner plugin ID selected for this type.

###### Parameters

`<name>`.tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description
:   Tolerance in meters between requested goal pose and end of path.
```

`<name>`.use\_astar
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description
:   Whether to use A\*. If false, uses Dijkstra’s expansion.
```

`<name>`.allow\_unknown
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description
:   Whether to allow planning in unknown space.
```

`<name>`.use\_final\_approach\_orientation
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   If true, the last pose of the path generated by the planner will have its orientation set to the approach orientation, i.e. the orientation of the vector connecting the last two points of the path
```

allow\_parameter\_qos\_overrides
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to allow QoS profiles to be overwritten with parameterized values.
```

###### Example

```
planner_server:
  ros__parameters:
    planner_plugins: ['GridBased']
    GridBased:
      plugin: 'nav2_navfn_planner::NavfnPlanner' # In Iron and older versions, "/" was used instead of "::"
      use_astar: True
      allow_unknown: True
      tolerance: 1.0
```

#### Parameters

**`<name>.tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.5DescriptionTolerance in meters between requested goal pose and end of path.

**`<name>.use_astar`**
- Type: `unknown`
- TypeDefaultboolFalseDescriptionWhether to use A*. If false, uses Dijkstra’s expansion.

**`<name>.allow_unknown`**
- Type: `unknown`
- TypeDefaultboolTrueDescriptionWhether to allow planning in unknown space.

**`<name>.use_final_approach_orientation`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionIf true, the last pose of the path generated by the planner will have its orientation set to the approach orientation, i.e. the orientation of the vector connecting the last two points of the path

**`allow_parameter_qos_overrides`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to allow QoS profiles to be overwritten with parameterized values.

**`Description`**
- Type: `unknown`
- Tolerance in meters between requested goal pose and end of path.

**`Description`**
- Type: `unknown`
- Whether to use A*. If false, uses Dijkstra’s expansion.

**`Description`**
- Type: `unknown`
- Whether to allow planning in unknown space.

**`Description`**
- Type: `unknown`
- If true, the last pose of the path generated by the planner will have its orientation set to the approach orientation, i.e. the orientation of the vector connecting the last two points of the path

**`Description`**
- Type: `unknown`
- Whether to allow QoS profiles to be overwritten with parameterized values.


---

#### Planner Server

*Source: [https://docs.nav2.org/configuration/packages/configuring-planner-server.html](https://docs.nav2.org/configuration/packages/configuring-planner-server.html)*

##### Planner Server

Source code on [Github](https://github.com/ros-navigation/navigation2/tree/main/nav2_planner).

The Planner Server implements the server for handling the planner requests for the stack and host a map of plugin implementations.
It will take in a goal and a planner plugin name to use and call the appropriate plugin to compute a path to the goal.
It also hosts the global costmap.

###### Parameters

planner\_plugins
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | [‘GridBased’] |
```

```
Description
:   List of Mapped plugin names for parameters and processing requests.
```

```
Note
:   Each plugin namespace defined in this list needs to have a `plugin` parameter defining the type of plugin to be loaded in the namespace.
```

```
    Example:
```

        ```
        planner_server:
          ros__parameters:
            planner_plugins: ["GridBased"]
            GridBased:
              plugin: "nav2_navfn_planner::NavfnPlanner" # In Iron and older versions, "/" was used instead of "::"
        ```

allow\_partial\_planning
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Allows planner server to output partial paths in the presence of obstacles when planning through poses. Otherwise planner fails and aborts the plan request in such a case by default.
```

expected\_planner\_frequency
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 20.0 |
```

```
Description
:   Expected planner frequency. If the current frequency is less than the expected frequency, display the warning message.
```

bond\_heartbeat\_period
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
Description
:   The lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.
```

costmap\_update\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   The timeout value (seconds) for the costmap to be fully updated before a planning request.
```

introspection\_mode
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “disabled” |
```

```
Description
:   The introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.
```

allow\_parameter\_qos\_overrides
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to allow QoS profiles to be overwritten with parameterized values.
```

###### Default Plugins

When the `planner_plugins` parameter is not overridden, the following default plugins are loaded:

> |  |  |
> | --- | --- |
> | Namespace | Plugin |
> | “GridBased” | “nav2\_navfn\_planner::NavfnPlanner” |

###### Example

```
planner_server:
  ros__parameters:
    allow_partial_planning: false
    expected_planner_frequency: 20.0
    costmap_update_timeout: 1.0
    introspection_mode: "disabled"
    planner_plugins: ['GridBased']
    GridBased:
      plugin: 'nav2_navfn_planner::NavfnPlanner' # In Iron and older versions, "/" was used instead of "::"
```

#### Parameters

**`planner_plugins`**
- Type: `unknown`
- TypeDefaultvector<string>[‘GridBased’]DescriptionList of Mapped plugin names for parameters and processing requests.NoteEach plugin namespace defined in this list needs to have apluginparameter defining the type of plugin to be loaded in the namespace.Example:planner_server:ros__parameters:planner_plugins:["GridBased"]GridBased:plugin:"nav2_navfn_planner::NavfnPlanner"# In Iron and older versions, "/" was used instead of "::"

**`allow_partial_planning`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionAllows planner server to output partial paths in the presence of obstacles when planning through poses. Otherwise planner fails and aborts the plan request in such a case by default.

**`expected_planner_frequency`**
- Type: `unknown`
- TypeDefaultdouble20.0DescriptionExpected planner frequency. If the current frequency is less than the expected frequency, display the warning message.

**`bond_heartbeat_period`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionThe lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.

**`costmap_update_timeout`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionThe timeout value (seconds) for the costmap to be fully updated before a planning request.

**`introspection_mode`**
- Type: `unknown`
- TypeDefaultstring“disabled”DescriptionThe introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.

**`allow_parameter_qos_overrides`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to allow QoS profiles to be overwritten with parameterized values.

**`Description`**
- Type: `unknown`
- List of Mapped plugin names for parameters and processing requests.

**`Note`**
- Type: `unknown`
- Each plugin namespace defined in this list needs to have apluginparameter defining the type of plugin to be loaded in the namespace.Example:planner_server:ros__parameters:planner_plugins:["GridBased"]GridBased:plugin:"nav2_navfn_planner::NavfnPlanner"# In Iron and older versions, "/" was used instead of "::"

**`Description`**
- Type: `unknown`
- Allows planner server to output partial paths in the presence of obstacles when planning through poses. Otherwise planner fails and aborts the plan request in such a case by default.

**`Description`**
- Type: `unknown`
- Expected planner frequency. If the current frequency is less than the expected frequency, display the warning message.

**`Description`**
- Type: `unknown`
- The lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.

**`Description`**
- Type: `unknown`
- The timeout value (seconds) for the costmap to be fully updated before a planning request.

**`Description`**
- Type: `unknown`
- The introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.

**`Description`**
- Type: `unknown`
- Whether to allow QoS profiles to be overwritten with parameterized values.

**`“GridBased”`**
- Type: `unknown`
- 


---

#### Regulated Pure Pursuit

*Source: [https://docs.nav2.org/configuration/packages/configuring-regulated-pp.html](https://docs.nav2.org/configuration/packages/configuring-regulated-pp.html)*

##### Regulated Pure Pursuit

Source code on [Github](https://github.com/ros-navigation/navigation2/tree/main/nav2_regulated_pure_pursuit_controller).

The Regulated Pure Pursuit controller implements a variation on the Pure Pursuit controller that specifically targeting service / industrial robot needs.
It regulates the linear velocities by curvature of the path to help reduce overshoot at high speeds around blind corners allowing operations to be much more safe.
It also better follows paths than any other variation currently available of Pure Pursuit.
It also has heuristics to slow in proximity to other obstacles so that you can slow the robot automatically when nearby potential collisions.
It also implements the Adaptive lookahead point features to be scaled by velocities to enable more stable behavior in a larger range of translational speeds.
It also implements the Dynamic Window Pure Pursuit algorithm, which computes optimal velocity commands for path tracking while explicitly considering velocity and acceleration constraints.

The following videos compare Pure Pursuit (PP), Adaptive Pure Pursuit (APP), Regulated Pure Pursuit (RPP), and Dynamic Window Pure Pursuit (DWPP).

Simulation results

Real-robot experiment

See the package’s `README` for more complete information.

If you use the Regulated Pure Pursuit Controller algorithm or software from this repository, please cite this work in your papers:

* 19. Macenski, S. Singh, F. Martin, J. Gines, [Regulated Pure Pursuit for Robot Path Tracking](https://arxiv.org/abs/2305.20026). Autonomous Robots, 2023.

If you use the Dynamic Window Pure Pursuit Controller algorithm or software from this repository, please cite this work in your papers:

* 6. Ohnishi, M. Takahashi, [DWPP: Dynamic Window Pure Pursuit Considering Velocity and Acceleration Constraints](https://arxiv.org/abs/2601.15006). arXiv:2601.15006., 2026.

###### Regulated Pure Pursuit Parameters

max\_linear\_vel
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description
:   The maximum linear velocity (m/s) to use. Previously desired\_linear\_vel
```

min\_linear\_vel
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | -0.5 |
```

```
Description
:   The minimum linear velocity (m/s) used when use\_dynamic\_window is true.
```

max\_angular\_vel
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.5 |
```

```
Description
:   The maximum angular velocity (rad/s) used when use\_dynamic\_window is true.
```

min\_angular\_vel
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | -2.5 |
```

```
Description
:   The minimum angular velocity (rad/s) used when use\_dynamic\_window is true.
```

max\_linear\_accel
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.5 |
```

```
Description
:   The maximum linear acceleration (m/s^2) used when use\_dynamic\_window is true.
```

max\_linear\_decel
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | -2.5 |
```

```
Description
:   The maximum linear deceleration (m/s^2) used when use\_dynamic\_window is true.
```

max\_angular\_accel
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 3.2 |
```

```
Description
:   The maximum angular acceleration (rad/s^2) to use.
```

max\_angular\_decel
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | -3.2 |
```

```
Description
:   The maximum angular deceleration (rad/s^2) used when use\_dynamic\_window is true.
```

lookahead\_dist
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.6 |
```

```
Description
:   The lookahead distance (m) to use to find the lookahead point when `use_velocity_scaled_lookahead_dist` is `false`.
```

min\_lookahead\_dist
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.3 |
```

```
Description
:   The minimum lookahead distance (m) threshold when `use_velocity_scaled_lookahead_dist` is `true`.
```

max\_lookahead\_dist
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.9 |
```

```
Description
:   The maximum lookahead distance (m) threshold when `use_velocity_scaled_lookahead_dist` is `true`.
```

lookahead\_time
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.5 |
```

```
Description
:   The time (s) to project the velocity by when `use_velocity_scaled_lookahead_dist` is `true`. Also known as the lookahead gain.
```

rotate\_to\_heading\_angular\_vel
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.8 |
```

```
Description
:   If `use_rotate_to_heading` is `true`, this is the angular velocity to use.
```

use\_velocity\_scaled\_lookahead\_dist
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to use the velocity scaled lookahead distances or constant `lookahead_distance`.
```

min\_approach\_linear\_velocity
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.05 |
```

```
Description
:   The minimum velocity (m/s) threshold to apply when approaching the goal to ensure progress. Must be `> 0.01`.
```

approach\_velocity\_scaling\_dist
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.6 |
```

```
Description
:   The distance (m) left on the path at which to start slowing down. Should be less than the half the costmap width.
```

use\_collision\_detection
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to enable collision detection.
```

max\_allowed\_time\_to\_collision\_up\_to\_carrot
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   The time (s) to project a velocity command forward to check for collisions when `use_collision_detection` is `true`. Pre-`Humble`, this was `max_allowed_time_to_collision`.
```

use\_regulated\_linear\_velocity\_scaling
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to use the regulated features for path curvature (e.g. slow on high curvature paths).
```

use\_cost\_regulated\_linear\_velocity\_scaling
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to use the regulated features for proximity to obstacles (e.g. slow in close proximity to obstacles).
```

cost\_scaling\_dist
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.6 |
```

```
Description
:   The minimum distance from an obstacle to trigger the scaling of linear velocity, if `use_cost_regulated_linear_velocity_scaling` is enabled. The value set should be smaller or equal to the `inflation_radius` set in the inflation layer of costmap, since inflation is used to compute the distance from obstacles.
```

cost\_scaling\_gain
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   A multiplier gain, which should be <= 1.0, used to further scale the speed when an obstacle is within `cost_scaling_dist`. Lower value reduces speed more quickly.
```

regulated\_linear\_scaling\_min\_radius
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.90 |
```

```
Description
:   The turning radius (m) for which the regulation features are triggered when `use_regulated_linear_velocity_scaling` is `true`. Remember, sharper turns have smaller radii.
```

regulated\_linear\_scaling\_min\_speed
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
Description
:   The minimum speed (m/s) for which any of the regulated heuristics can send, to ensure process is still achievable even in high cost spaces with high curvature. Must be `> 0.1`.
```

use\_fixed\_curvature\_lookahead
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to use a fixed lookahead distance to compute curvature from. Since a lookahead distance may be set to vary on velocity, it can introduce a reference cycle that can be problematic for large lookahead distances.
```

curvature\_lookahead\_dist
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.6 |
```

```
Description
:   Distance to look ahead on the path to detect curvature.
```

use\_rotate\_to\_heading
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to enable rotating to rough heading and goal orientation when using holonomic planners. Recommended on for all robot types that can rotate in place.
```

```
    Note: both `use_rotate_to_heading` and `allow_reversing` cannot be set to `true` at the same time as it would result in ambiguous situations.
```

allow\_reversing
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Enables the robot to drive in the reverse direction, when the path planned involves reversing (which is represented by orientation cusps). Variants of the smac\_planner comes with the support of reversing. Checkout the [Smac Planner](configuring-smac-planner.html#configuring-smac-planner) to know more.
```

rotate\_to\_heading\_min\_angle
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.785 |
```

```
Description
:   The difference in the path orientation and the starting robot orientation (radians) to trigger a rotate in place, if `use_rotate_to_heading` is `true`.
```

use\_cancel\_deceleration
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to use deceleration when the goal is canceled.
```

cancel\_deceleration
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 3.2 |
```

```
Description
:   Linear deceleration (m/s/s) to apply when the goal is canceled.
```

interpolate\_curvature\_after\_goal
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Interpolate a carrot after the goal dedicated to the curvate calculation (to avoid oscilaltions at the end of the path). For visualization, it will be published on the `/curvature_lookahead_point` topic similarly to `/lookahead_point`
```

```
    Note: Needs `use_fixed_curvature_lookahead` to be `true`
```

stateful
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Enables stateful goal handling behavior. When set to true, the controller will persist the goal state once the robot reaches the XY tolerance. It will then focus on aligning to the goal heading without reverting to XY position corrections.
```

allow\_parameter\_qos\_overrides
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to allow QoS profiles to be overwritten with parameterized values.
```

min\_distance\_to\_obstacle
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | -1.0 |
```

```
Description
:   The shortest distance at which the robot is allowed to be from an obstacle along its trajectory. Set <= 0.0 to disable. It is limited to maximum distance of lookahead distance selected.
```

use\_dynamic\_window
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to use the Dynamic Window Pure Pursuit (DWPP) Algorithm. This algorithm computes command velocities that track the path as accurately as possible while respecting velocity and acceleration constraints. It automatically slows down in sharp turns without manual tuning, reducing path tracking errors.
    Fumiya Ohnishi and Masaki Takahashi, “Dynamic Window Pure Pursuit for Robot Path Tracking Considering Velocity and Acceleration Constraints”, the 19th International Conference on Intelligent Autonomous Systems (IAS-19), 2025.
```

###### Example

```
controller_server:
  ros__parameters:
    controller_frequency: 20.0
    min_x_velocity_threshold: 0.001
    min_y_velocity_threshold: 0.5
    min_theta_velocity_threshold: 0.001
    progress_checker_plugins: ["progress_checker"] # progress_checker_plugin: "progress_checker" For Humble and older
    goal_checker_plugins: ["goal_checker"]
    controller_plugins: ["FollowPath"]

    progress_checker:
      plugin: "nav2_controller::SimpleProgressChecker"
      required_movement_radius: 0.5
      movement_time_allowance: 10.0
    goal_checker:
      plugin: "nav2_controller::SimpleGoalChecker"
      xy_goal_tolerance: 0.25
      yaw_goal_tolerance: 0.25
      stateful: True
    FollowPath:
      plugin: "nav2_regulated_pure_pursuit_controller::RegulatedPurePursuitController"
      max_linear_vel: 0.5
      min_linear_vel: -0.5
      max_angular_vel: 2.5
      min_angular_vel: -2.5
      max_linear_accel: 2.5
      max_linear_decel: -2.5
      max_angular_accel: 3.2
      max_angular_decel: -3.2
      lookahead_dist: 0.6
      min_lookahead_dist: 0.3
      max_lookahead_dist: 0.9
      lookahead_time: 1.5
      rotate_to_heading_angular_vel: 1.8
      use_velocity_scaled_lookahead_dist: false
      min_approach_linear_velocity: 0.05
      approach_velocity_scaling_dist: 0.6
      use_collision_detection: true
      max_allowed_time_to_collision_up_to_carrot: 1.0
      use_regulated_linear_velocity_scaling: true
      use_fixed_curvature_lookahead: false
      curvature_lookahead_dist: 0.25
      use_cost_regulated_linear_velocity_scaling: false
      cost_scaling_dist: 0.3
      cost_scaling_gain: 1.0
      regulated_linear_scaling_min_radius: 0.9
      regulated_linear_scaling_min_speed: 0.25
      use_rotate_to_heading: true
      allow_reversing: false
      rotate_to_heading_min_angle: 0.785
      min_distance_to_obstacle: 0.0
      stateful: true
      use_dynamic_window: false
```

#### Parameters

**`max_linear_vel`**
- Type: `unknown`
- TypeDefaultdouble0.5DescriptionThe maximum linear velocity (m/s) to use.  Previouslydesired_linear_vel

**`min_linear_vel`**
- Type: `unknown`
- TypeDefaultdouble-0.5DescriptionThe minimum linear velocity (m/s) used whenuse_dynamic_windowistrue.

**`max_angular_vel`**
- Type: `unknown`
- TypeDefaultdouble2.5DescriptionThe maximum angular velocity (rad/s) used whenuse_dynamic_windowistrue.

**`min_angular_vel`**
- Type: `unknown`
- TypeDefaultdouble-2.5DescriptionThe minimum angular velocity (rad/s) used whenuse_dynamic_windowistrue.

**`max_linear_accel`**
- Type: `unknown`
- TypeDefaultdouble2.5DescriptionThe maximum linear acceleration (m/s^2) used whenuse_dynamic_windowistrue.

**`max_linear_decel`**
- Type: `unknown`
- TypeDefaultdouble-2.5DescriptionThe maximum linear deceleration (m/s^2) used whenuse_dynamic_windowistrue.

**`max_angular_accel`**
- Type: `unknown`
- TypeDefaultdouble3.2DescriptionThe maximum angular acceleration (rad/s^2) to use.

**`max_angular_decel`**
- Type: `unknown`
- TypeDefaultdouble-3.2DescriptionThe maximum angular deceleration (rad/s^2) used whenuse_dynamic_windowistrue.

**`lookahead_dist`**
- Type: `unknown`
- TypeDefaultdouble0.6DescriptionThe lookahead distance (m) to use to find the lookahead point whenuse_velocity_scaled_lookahead_distisfalse.

**`min_lookahead_dist`**
- Type: `unknown`
- TypeDefaultdouble0.3DescriptionThe minimum lookahead distance (m) threshold whenuse_velocity_scaled_lookahead_dististrue.

**`max_lookahead_dist`**
- Type: `unknown`
- TypeDefaultdouble0.9DescriptionThe maximum lookahead distance (m) threshold whenuse_velocity_scaled_lookahead_dististrue.

**`lookahead_time`**
- Type: `unknown`
- TypeDefaultdouble1.5DescriptionThe time (s) to project the velocity by whenuse_velocity_scaled_lookahead_dististrue. Also known as the lookahead gain.

**`rotate_to_heading_angular_vel`**
- Type: `unknown`
- TypeDefaultdouble1.8DescriptionIfuse_rotate_to_headingistrue, this is the angular velocity to use.

**`use_velocity_scaled_lookahead_dist`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to use the velocity scaled lookahead distances or constantlookahead_distance.

**`min_approach_linear_velocity`**
- Type: `unknown`
- TypeDefaultdouble0.05DescriptionThe minimum velocity (m/s) threshold to apply when approaching the goal to ensure progress. Must be>0.01.

**`approach_velocity_scaling_dist`**
- Type: `unknown`
- TypeDefaultdouble0.6DescriptionThe distance (m) left on the path at which to start slowing down. Should be less than the half the costmap width.

**`use_collision_detection`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to enable collision detection.

**`max_allowed_time_to_collision_up_to_carrot`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionThe time (s) to project a velocity command forward to check for collisions whenuse_collision_detectionistrue. Pre-Humble, this wasmax_allowed_time_to_collision.

**`use_regulated_linear_velocity_scaling`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to use the regulated features for path curvature (e.g. slow on high curvature paths).

**`use_cost_regulated_linear_velocity_scaling`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to use the regulated features for proximity to obstacles (e.g. slow in close proximity to obstacles).

**`cost_scaling_dist`**
- Type: `unknown`
- TypeDefaultdouble0.6DescriptionThe minimum distance from an obstacle to trigger the scaling of linear velocity, ifuse_cost_regulated_linear_velocity_scalingis enabled. The value set should be smaller or equal to theinflation_radiusset in the inflation layer of costmap, since inflation is used to compute the distance from obstacles.

**`cost_scaling_gain`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionA multiplier gain, which should be <= 1.0, used to further scale the speed when an obstacle is withincost_scaling_dist. Lower value reduces speed more quickly.

**`regulated_linear_scaling_min_radius`**
- Type: `unknown`
- TypeDefaultdouble0.90DescriptionThe turning radius (m) for which the regulation features are triggered whenuse_regulated_linear_velocity_scalingistrue. Remember, sharper turns have smaller radii.

**`regulated_linear_scaling_min_speed`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionThe minimum speed (m/s) for which any of the regulated heuristics can send, to ensure process is still achievable even in high cost spaces with high curvature. Must be>0.1.

**`use_fixed_curvature_lookahead`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to use a fixed lookahead distance to compute curvature from. Since a lookahead distance may be set to vary on velocity, it can introduce a reference cycle that can be problematic for large lookahead distances.

**`curvature_lookahead_dist`**
- Type: `unknown`
- TypeDefaultdouble0.6DescriptionDistance to look ahead on the path to detect curvature.

**`use_rotate_to_heading`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to enable rotating to rough heading and goal orientation when using holonomic planners. Recommended on for all robot types that can rotate in place.Note: bothuse_rotate_to_headingandallow_reversingcannot be set totrueat the same time as it would result in ambiguous situations.

**`allow_reversing`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionEnables the robot to drive in the reverse direction, when the path planned involves reversing (which is represented by orientation cusps). Variants of the smac_planner comes with the support of reversing. Checkout theSmac Plannerto know more.

**`rotate_to_heading_min_angle`**
- Type: `unknown`
- TypeDefaultdouble0.785DescriptionThe difference in the path orientation and the starting robot orientation (radians) to trigger a rotate in place, ifuse_rotate_to_headingistrue.

**`use_cancel_deceleration`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to use deceleration when the goal is canceled.

**`cancel_deceleration`**
- Type: `unknown`
- TypeDefaultdouble3.2DescriptionLinear deceleration (m/s/s) to apply when the goal is canceled.

**`interpolate_curvature_after_goal`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionInterpolate a carrot after the goal dedicated to the curvate calculation (to avoid oscilaltions at the end of the path). For visualization, it will be published on the/curvature_lookahead_pointtopic similarly to/lookahead_pointNote: Needsuse_fixed_curvature_lookaheadto betrue

**`stateful`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionEnables stateful goal handling behavior. When set to true, the controller will persist the goal state once the robot reaches the XY tolerance. It will then focus on aligning to the goal heading without reverting to XY position corrections.

**`allow_parameter_qos_overrides`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to allow QoS profiles to be overwritten with parameterized values.

**`min_distance_to_obstacle`**
- Type: `unknown`
- TypeDefaultdouble-1.0DescriptionThe shortest distance at which the robot is allowed to be from an obstacle along its trajectory. Set <= 0.0 to disable. It is limited to maximum distance of lookahead distance selected.

**`use_dynamic_window`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to use the Dynamic Window Pure Pursuit (DWPP) Algorithm. This algorithm computes command velocities that track the path as accurately as possible while respecting velocity and acceleration constraints. It automatically slows down in sharp turns without manual tuning, reducing path tracking errors.
Fumiya Ohnishi and Masaki Takahashi, “Dynamic Window Pure Pursuit for Robot Path Tracking Considering Velocity and Acceleration Constraints”, the 19th International Conference on Intelligent Autonomous Systems (IAS-19), 2025.

**`Description`**
- Type: `unknown`
- The maximum linear velocity (m/s) to use.  Previouslydesired_linear_vel

**`Description`**
- Type: `unknown`
- The minimum linear velocity (m/s) used whenuse_dynamic_windowistrue.

**`Description`**
- Type: `unknown`
- The maximum angular velocity (rad/s) used whenuse_dynamic_windowistrue.

**`Description`**
- Type: `unknown`
- The minimum angular velocity (rad/s) used whenuse_dynamic_windowistrue.

**`Description`**
- Type: `unknown`
- The maximum linear acceleration (m/s^2) used whenuse_dynamic_windowistrue.

**`Description`**
- Type: `unknown`
- The maximum linear deceleration (m/s^2) used whenuse_dynamic_windowistrue.

**`Description`**
- Type: `unknown`
- The maximum angular acceleration (rad/s^2) to use.

**`Description`**
- Type: `unknown`
- The maximum angular deceleration (rad/s^2) used whenuse_dynamic_windowistrue.

**`Description`**
- Type: `unknown`
- The lookahead distance (m) to use to find the lookahead point whenuse_velocity_scaled_lookahead_distisfalse.

**`Description`**
- Type: `unknown`
- The minimum lookahead distance (m) threshold whenuse_velocity_scaled_lookahead_dististrue.

**`Description`**
- Type: `unknown`
- The maximum lookahead distance (m) threshold whenuse_velocity_scaled_lookahead_dististrue.

**`Description`**
- Type: `unknown`
- The time (s) to project the velocity by whenuse_velocity_scaled_lookahead_dististrue. Also known as the lookahead gain.

**`Description`**
- Type: `unknown`
- Ifuse_rotate_to_headingistrue, this is the angular velocity to use.

**`Description`**
- Type: `unknown`
- Whether to use the velocity scaled lookahead distances or constantlookahead_distance.

**`Description`**
- Type: `unknown`
- The minimum velocity (m/s) threshold to apply when approaching the goal to ensure progress. Must be>0.01.

**`Description`**
- Type: `unknown`
- The distance (m) left on the path at which to start slowing down. Should be less than the half the costmap width.

**`Description`**
- Type: `unknown`
- Whether to enable collision detection.

**`Description`**
- Type: `unknown`
- The time (s) to project a velocity command forward to check for collisions whenuse_collision_detectionistrue. Pre-Humble, this wasmax_allowed_time_to_collision.

**`Description`**
- Type: `unknown`
- Whether to use the regulated features for path curvature (e.g. slow on high curvature paths).

**`Description`**
- Type: `unknown`
- Whether to use the regulated features for proximity to obstacles (e.g. slow in close proximity to obstacles).

**`Description`**
- Type: `unknown`
- The minimum distance from an obstacle to trigger the scaling of linear velocity, ifuse_cost_regulated_linear_velocity_scalingis enabled. The value set should be smaller or equal to theinflation_radiusset in the inflation layer of costmap, since inflation is used to compute the distance from obstacles.

**`Description`**
- Type: `unknown`
- A multiplier gain, which should be <= 1.0, used to further scale the speed when an obstacle is withincost_scaling_dist. Lower value reduces speed more quickly.

**`Description`**
- Type: `unknown`
- The turning radius (m) for which the regulation features are triggered whenuse_regulated_linear_velocity_scalingistrue. Remember, sharper turns have smaller radii.

**`Description`**
- Type: `unknown`
- The minimum speed (m/s) for which any of the regulated heuristics can send, to ensure process is still achievable even in high cost spaces with high curvature. Must be>0.1.

**`Description`**
- Type: `unknown`
- Whether to use a fixed lookahead distance to compute curvature from. Since a lookahead distance may be set to vary on velocity, it can introduce a reference cycle that can be problematic for large lookahead distances.

**`Description`**
- Type: `unknown`
- Distance to look ahead on the path to detect curvature.

**`Description`**
- Type: `unknown`
- Whether to enable rotating to rough heading and goal orientation when using holonomic planners. Recommended on for all robot types that can rotate in place.Note: bothuse_rotate_to_headingandallow_reversingcannot be set totrueat the same time as it would result in ambiguous situations.

**`Description`**
- Type: `unknown`
- Enables the robot to drive in the reverse direction, when the path planned involves reversing (which is represented by orientation cusps). Variants of the smac_planner comes with the support of reversing. Checkout theSmac Plannerto know more.

**`Description`**
- Type: `unknown`
- The difference in the path orientation and the starting robot orientation (radians) to trigger a rotate in place, ifuse_rotate_to_headingistrue.

**`Description`**
- Type: `unknown`
- Whether to use deceleration when the goal is canceled.

**`Description`**
- Type: `unknown`
- Linear deceleration (m/s/s) to apply when the goal is canceled.

**`Description`**
- Type: `unknown`
- Interpolate a carrot after the goal dedicated to the curvate calculation (to avoid oscilaltions at the end of the path). For visualization, it will be published on the/curvature_lookahead_pointtopic similarly to/lookahead_pointNote: Needsuse_fixed_curvature_lookaheadto betrue

**`Description`**
- Type: `unknown`
- Enables stateful goal handling behavior. When set to true, the controller will persist the goal state once the robot reaches the XY tolerance. It will then focus on aligning to the goal heading without reverting to XY position corrections.

**`Description`**
- Type: `unknown`
- Whether to allow QoS profiles to be overwritten with parameterized values.

**`Description`**
- Type: `unknown`
- The shortest distance at which the robot is allowed to be from an obstacle along its trajectory. Set <= 0.0 to disable. It is limited to maximum distance of lookahead distance selected.

**`Description`**
- Type: `unknown`
- Whether to use the Dynamic Window Pure Pursuit (DWPP) Algorithm. This algorithm computes command velocities that track the path as accurately as possible while respecting velocity and acceleration constraints. It automatically slows down in sharp turns without manual tuning, reducing path tracking errors.
Fumiya Ohnishi and Masaki Takahashi, “Dynamic Window Pure Pursuit for Robot Path Tracking Considering Velocity and Acceleration Constraints”, the 19th International Conference on Intelligent Autonomous Systems (IAS-19), 2025.


---

#### Rotation Shim Controller

*Source: [https://docs.nav2.org/configuration/packages/configuring-rotation-shim-controller.html](https://docs.nav2.org/configuration/packages/configuring-rotation-shim-controller.html)*

##### Rotation Shim Controller

Source code on [Github](https://github.com/ros-navigation/navigation2/tree/main/nav2_rotation_shim_controller).

The `nav2_rotation_shim_controller` will check the rough heading difference with respect to the robot and a newly received path. If within a threshold, it will pass the request onto the `primary_controller` to execute the task. If it is outside of the threshold, this controller will rotate the robot in place towards that path heading. Once it is within the tolerance, it will then pass off control-execution from this rotation shim controller onto the primary controller plugin. At this point, the robot’s main plugin will take control for a smooth hand off into the task.

When the `rotate_to_goal_heading` parameter is set to true, this controller is also able to take back control of the robot when reaching the XY goal tolerance of the goal checker. In this case, the robot will rotate towards the goal heading until the goal checker validate the goal and ends the current navigation task.

The `RotationShimController` is most suitable for:

* Robots that can rotate in place, such as differential and omnidirectional robots.
* Preference to rotate in place when starting to track a new path that is at a significantly different heading than the robot’s current heading – or when tuning your controller for its task makes tight rotations difficult.
* Using planners that are non-kinematically feasible, such as NavFn, Theta\*, or Smac 2D (Feasible planners such as Smac Hybrid-A\* and State Lattice will start search from the robot’s actual starting heading, requiring no rotation since their paths are guaranteed drivable by physical constraints).

See the package’s `README` for more complete information.


###### Rotation Shim Controller Parameters

angular\_dist\_threshold
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.785 |
```

```
Description
:   Maximum angular distance, in radians, away from the path heading to trigger rotation
```

angular\_disengage\_threshold
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.3925 |
```

```
Description
:   New to Jazzy, the threshold to the path’s heading before disengagement (radians). Prior to Jazzy, disengagement occurs at the `angular_dist_threshold` instead. This allows for better alignment before passing to the child controller when engaged.
```

forward\_sampling\_distance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description
:   Forward distance, in meters, along path to select a sampling point to use to approximate path heading. This distance should not be larger than the path handler’s prune distance.
```

rotate\_to\_heading\_angular\_vel
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.8 |
```

```
Description
:   Angular rotational velocity, in rad/s, to rotate to the path heading
```

primary\_controller
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Internal controller plugin to use for actual control behavior after rotating to heading
```

max\_angular\_accel
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 3.2 |
```

```
Description
:   Maximum angular acceleration for rotation to heading (rad/s/s)
```

simulate\_ahead\_time
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   Time in seconds to forward simulate a rotation command to check for collisions. If a collision is found, forwards control back to the primary controller plugin.
```

rotate\_to\_goal\_heading
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   If true, the rotationShimController will take back control of the robot when in XY tolerance of the goal and start rotating towards the goal heading.
```

rotate\_to\_heading\_once
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   If true, the rotationShimController will only rotate to heading once on a new goal, not each time a path is set.
```

closed\_loop
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   If false, the rotationShimController will use the last commanded velocity as the next iteration’s current velocity. When acceleration limits are set appropriately and the robot’s controllers are responsive, this can be a good assumption. If true, it will use odometry to estimate the robot’s current speed. In this case it is important that the source is high-rate and low-latency to account for control delay.
```

use\_path\_orientations
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   If true, the controller will use the orientations of the path points to compute the heading of the path instead of computing the heading from the path point’s relative locations. If true, the controller will use the orientations of the path points to compute the heading of the path instead of computing the heading from the path points. Use for for feasible planners like the Smac Planner which generate feasible paths with orientations for forward and reverse motion.
```

###### Example

```
controller_server:
  ros__parameters:
    controller_frequency: 20.0
    min_x_velocity_threshold: 0.001
    min_y_velocity_threshold: 0.5
    min_theta_velocity_threshold: 0.001
    progress_checker_plugins: ["progress_checker"] # progress_checker_plugin: "progress_checker" For Humble and older
    goal_checker_plugins: ["goal_checker"]
    controller_plugins: ["FollowPath"]

    progress_checker:
      plugin: "nav2_controller::SimpleProgressChecker"
      required_movement_radius: 0.5
      movement_time_allowance: 10.0
    goal_checker:
      plugin: "nav2_controller::SimpleGoalChecker"
      xy_goal_tolerance: 0.25
      yaw_goal_tolerance: 0.25
      stateful: True
    FollowPath:
      plugin: "nav2_rotation_shim_controller::RotationShimController"
      angular_dist_threshold: 0.785
      forward_sampling_distance: 0.5
      angular_disengage_threshold: 0.3925
      rotate_to_heading_angular_vel: 1.8
      max_angular_accel: 3.2
      simulate_ahead_time: 1.0
      rotate_to_goal_heading: false

      # Primary controller params can be placed here below
      primary_controller:
        plugin: "nav2_regulated_pure_pursuit_controller::RegulatedPurePursuitController"
        # ...
```

#### Parameters

**`angular_dist_threshold`**
- Type: `unknown`
- TypeDefaultdouble0.785DescriptionMaximum angular distance, in radians, away from the path heading to trigger rotation

**`angular_disengage_threshold`**
- Type: `unknown`
- TypeDefaultdouble0.3925DescriptionNew to Jazzy, the threshold to the path’s heading before disengagement (radians). Prior to Jazzy, disengagement occurs at theangular_dist_thresholdinstead. This allows for better alignment before passing to the child controller when engaged.

**`forward_sampling_distance`**
- Type: `unknown`
- TypeDefaultdouble0.5DescriptionForward distance, in meters, along path to select a sampling point to use to approximate path heading. This distance should not be larger than the path handler’s prune distance.

**`rotate_to_heading_angular_vel`**
- Type: `unknown`
- TypeDefaultdouble1.8DescriptionAngular rotational velocity, in rad/s, to rotate to the path heading

**`primary_controller`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionInternal controller plugin to use for actual control behavior after rotating to heading

**`max_angular_accel`**
- Type: `unknown`
- TypeDefaultdouble3.2DescriptionMaximum angular acceleration for rotation to heading (rad/s/s)

**`simulate_ahead_time`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionTime in seconds to forward simulate a rotation command to check for collisions. If a collision is found, forwards control back to the primary controller plugin.

**`rotate_to_goal_heading`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionIf true, the rotationShimController will take back control of the robot when in XY tolerance of the goal and start rotating towards the goal heading.

**`rotate_to_heading_once`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionIf true, the rotationShimController will only rotate to heading once on a new goal, not each time a path is set.

**`closed_loop`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionIf false, the rotationShimController will use the last commanded velocity as the next iteration’s current velocity. When acceleration limits are set appropriately and the robot’s controllers are responsive, this can be a good assumption. If true, it will use odometry to estimate the robot’s current speed. In this case it is important that the source is high-rate and low-latency to account for control delay.

**`use_path_orientations`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionIf true, the controller will use the orientations of the path points to compute the heading of the path instead of computing the heading from the path point’s relative locations. If true, the controller will use the orientations of the path points to compute the heading of the path instead of computing the heading from the path points. Use for for feasible planners like the Smac Planner which generate feasible paths with orientations for forward and reverse motion.

**`Description`**
- Type: `unknown`
- Maximum angular distance, in radians, away from the path heading to trigger rotation

**`Description`**
- Type: `unknown`
- New to Jazzy, the threshold to the path’s heading before disengagement (radians). Prior to Jazzy, disengagement occurs at theangular_dist_thresholdinstead. This allows for better alignment before passing to the child controller when engaged.

**`Description`**
- Type: `unknown`
- Forward distance, in meters, along path to select a sampling point to use to approximate path heading. This distance should not be larger than the path handler’s prune distance.

**`Description`**
- Type: `unknown`
- Angular rotational velocity, in rad/s, to rotate to the path heading

**`Description`**
- Type: `unknown`
- Internal controller plugin to use for actual control behavior after rotating to heading

**`Description`**
- Type: `unknown`
- Maximum angular acceleration for rotation to heading (rad/s/s)

**`Description`**
- Type: `unknown`
- Time in seconds to forward simulate a rotation command to check for collisions. If a collision is found, forwards control back to the primary controller plugin.

**`Description`**
- Type: `unknown`
- If true, the rotationShimController will take back control of the robot when in XY tolerance of the goal and start rotating towards the goal heading.

**`Description`**
- Type: `unknown`
- If true, the rotationShimController will only rotate to heading once on a new goal, not each time a path is set.

**`Description`**
- Type: `unknown`
- If false, the rotationShimController will use the last commanded velocity as the next iteration’s current velocity. When acceleration limits are set appropriately and the robot’s controllers are responsive, this can be a good assumption. If true, it will use odometry to estimate the robot’s current speed. In this case it is important that the source is high-rate and low-latency to account for control delay.

**`Description`**
- Type: `unknown`
- If true, the controller will use the orientations of the path points to compute the heading of the path instead of computing the heading from the path point’s relative locations. If true, the controller will use the orientations of the path points to compute the heading of the path instead of computing the heading from the path points. Use for for feasible planners like the Smac Planner which generate feasible paths with orientations for forward and reverse motion.


---

#### Route Server

*Source: [https://docs.nav2.org/configuration/packages/configuring-route-server.html](https://docs.nav2.org/configuration/packages/configuring-route-server.html)*

##### Route Server

Source code on [Github](https://github.com/ros-navigation/navigation2/tree/main/nav2_route).

The Route Server in `nav2_route` implements the server for computing routes through a predefined navigation graph rather than using freespace planning like the Planner Server.
It may be used to fully replace freespace planning when following a particular route closely or to augment the global planner with long-distance routing to a goal.
In this case, the planner will generate feasible paths with localized environmental information for only the future part of the route necessary.

The graph itself has very few rules associated with it, but may be generated manually or automatically via AI, geometric, or probabilistic techniques.
See [Route Graph Generation](../../tutorials/docs/route_server_tools/route_graph_generation.html#route-graph-generation) and [Route Graph Generation LIF Editor](../../tutorials/docs/route_server_tools/route_graph_generation_lif_editor.html#route-graph-generation-lif-editor) for a tutorial about how to generate a graph using QGIS, Rviz2 and/or LIF for structured environment applications.
You can also use sampling or procedural generation techniques to create a graph for less structured environments, for example using [NVIDIA’s SWAGGER project](https://github.com/nvidia-isaac/SWAGGER) which can generate a graph from a map image and provides utilities to convert into geojson for easy integration with Nav2 Route.
There’s also a tutorial [SWAGGER Route Graph Generation](../../tutorials/docs/route_server_tools/swagger_generation.html#route-graph-generation-swagger) to help with that process as well.

There are also several locations for customization using plugins:
\* Edge Scorer: Enables custom scoring functions for edges based on arbitrary user-defined semantic information and the chosen optimization criteria(s).
\* Route Operation: Execute a user-defined action when entering or leaving a route edge or achieving a node, including use of node and edge semantic information,
\* Route Graph Parser: Parse graph files using the chosen format (e.g. geoJSON, OpenStreetMap, etc.) and convert them into the internal graph representation.

See the package’s README file for additional information such as performance metrics, design, advice, and graph formatting.


###### Server Parameters

base\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “base\_link” |
```

```
Description
:   The base frame of the robot to use to obtain the robot’s pose from when not using the `use_start` request parameter.
```

route\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “map” |
```

```
Description
:   The frame of the route graph to plan within. If values in the graph file are not w.r.t. this frame, they will be automatically transformed.
```

path\_density
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.05 |
```

```
Description
:   The density of path-points in the output route, if using the `nav_msgs/Path` route rather than the collection of nodes and edges. This is used to upsample the route into a path that may be followed.
```

max\_iterations
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 0 |
```

```
Description
:   The maximum number of planning iterations to perform. If 0, the maximum number of iterations is used.
```

max\_planning\_time
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description
:   The maximum planning time to use.
```

smooth\_corners
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to smooth corners formed between subsequent edges after a route has been found
```

smoothing\_radius
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   Radius to fit to corners formed by edges if corner smoothing is enabled
```

costmap\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | ‘global\_costmap/costmap\_raw’ |
```

```
Description
:   The costmap to use for the server-level costmap subscriber. This is created to aid the goal intent extractor (if BFS-based terminal route node finding is enabled) and also shared with the Collision Monitor Operation and Costmap Edge Scorer if set to the same topic. Otherwise, those plugins will create their own subscribers to their respective costmap topics.
```

tracker\_update\_rate
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 50.0 |
```

```
Description
:   The update rate of the tracker (when using `ComputeAndTrackRoute` action) to check the status of path tracking and execute route operations.
```

aggregate\_blocked\_ids
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to aggregate the blocked IDs reported by route operations over the lifespan of the navigation request or only use the currently marked blocked IDs.
```

boundary\_radius\_to\_achieve\_node
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   The radius at a boundary condition (start, goal) to mark the node achieved by the tracker when using `ComputeAndTrackRoute`. Note that this is not the same as the goal tolerance, as the route or path follower (controller) will continue to run until its goal tolerance is met.
```

radius\_to\_achieve\_node
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   The radius for non-boundary conditions to mark the node as achieved once within tolerance of, when using `ComputeAndTrackRoute`. Note that this is a radius to consider achievable, however a refinement process takes place to most accurately identify when a node is reached. The radius is the trigger to start this process. Set this generously based on path tracking tolerances.
```

max\_prune\_dist\_from\_edge
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 8.0 |
```

```
Description
:   Maximum distance from an edge to consider pruning it as in-progress (i.e. if we’re to far away from an edge, it is nonsensical to prune it).
```

min\_prune\_dist\_from\_goal
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.15 |
```

```
Description
:   Minimum distance from the goal node away from the request’s goal pose (if using `use_poses`) to consider pruning as being passed, in case the goal pose is very close to the goal node, but is not exact.
```

min\_prune\_dist\_from\_start
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
Description
:   Minimum distance from the start node away from the start pose (if using `use_poses`) to consider pruning as being passed, in case the start pose is very close to the start node, but is not exact. Setting this to be ~3-5x the goal tolerance may be a good choice when doing largely on-graph navigation to connect from the start node near the robot to the route fully without pruning.
```

prune\_goal
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether pruning the goal node from the route due to it being spatially past the goal pose requested (pose requests only `use_poses`).
```

enable\_nn\_search
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to use Breadth-first search to find the nearest traversable node (true) or simply the nearest node (false) for the start and goal when using pose requests.
```

max\_nn\_search\_iterations
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 10000 |
```

```
Description
:   The maximum number of iterations to perform Breadth-first search to find the start and goal closest traversable nodes.
```

num\_nearest\_nodes
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 5 |
```

```
Description
:   The number of nearest-neighbors to extract from a Kd-tree in order to check against in the Breadth-first search.
```

graph\_filepath
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “” |
```

```
Description
:   The filepath to the graph file for loading. It may be empty on initialization, but then the graph must be set from the server’s set graph service later.
```

graph\_file\_loader
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “GeoJsonGraphFileLoader” |
```

```
Description
:   The name of the graph file loader plugin to use.
```

graph\_file\_loader.plugin
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “nav2\_route::GeoJsonGraphFileLoader” |
```

```
Description
:   The graph loading plugin to use. By default, we use `geojson`.
```

edge\_cost\_functions
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | [“DistanceScorer”, “DynamicEdgesScorer”] |
```

```
Description
:   Which edge cost functions should be used for planning purposes to score the edges. By default, we optimize for minimum distance while providing a service cost function to set arbitrary costs or mark edge as closed from a service.
```

operations
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | [“AdjustSpeedLimit”, “ReroutingService”] |
```

```
Description
:   The route operation plugins to use for `ComputeAndTrackRoute`. By default, we have a speed limit adjuster and a ROS service request rerouting operation.
```

<name>.plugin
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “” |
```

```
Description
:   The plugin to load under that name. The `edge_cost_functions.<name>` namespaces is also where plugin-specific parameters are defined.
```

introspection\_mode
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “disabled” |
```

```
Description
:   The introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.
```

allow\_parameter\_qos\_overrides
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to allow QoS profiles to be overwritten with parameterized values.
```

###### Edge Scorer Parameters

###### CostmapScorer

This edge scoring plugin will score based on the cost of the costmap over the edge.

weight
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   Relative edge scoring weighting.
```

costmap\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | global\_costmap/costmap\_raw |
```

```
Description
:   Costmap topic to use for scoring.
```

max\_cost
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 253.0 |
```

```
Description
:   Maximum cost to consider an route blocked (253.0)
```

use\_maximum
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to score based on single maximum or average
```

invalid\_on\_collision
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to consider collision status as a terminal condition
```

invalid\_off\_map
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to consider route going off the map invalid
```

check\_resolution
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1 |
```

```
Description
:   Resolution to check costs at (1 = costmap resolution, 2 = 2x costmap resolution, etc)
```

###### DistanceScorer

This edge scoring plugin will score based on the length of the edge.
If a `speed_tag` is provided, that is used to scale by the time to traverse.
This must be a percentage, if using absolute speed limits, see the `TimeScorer` plugin below.

weight
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   Relative edge scoring weighting.
```

speed\_tag
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “speed\_limit” |
```

```
Description
:   Graph metadata key to look for percentage speed limits (speed\_limit).
```

###### TimeScorer

This edge scoring plugin will score based on the time to traverse the length of the edge.
This will use the distance of the edge weighted in proportion to the absolute speed limits of the robot over an edge.
If none is set in the graph, a parameterized maximum speed will be used.
If an actual, measured time of a previous traversal is in the edge’s metadata, this will be used.

weight
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   Relative edge scoring weighting.
```

speed\_tag
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “abs\_speed\_limit” |
```

```
Description
:   Graph metadata key to look for absolute speed limits.
```

time\_tag
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “abs\_time\_taken” |
```

```
Description
:   Graph metadata key to look for abs traversal times.
```

max\_vel
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description
:   Maximum velocity to use if speed limit or time taken is not set.
```

###### PenaltyScorer

This edge scoring plugin will score based on a statically set penalty in the graph file for a particular edge.
This can be based on application known logic to weight preferences of navigation tactics in a space.

weight
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   Relative edge scoring weighting.
```

penalty\_tag
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “penalty” |
```

```
Description
:   Graph metadata key to look for penalty value.
```

###### SemanticScorer

This edge scoring plugin will score based on semantic information provided in the graph file.
It can either check for the edge’s semantic class via a parameterized key’s value **or** search all key names to match known semantic classes to apply weight (e.g. class: highway or highway: <some other application info>).

weight
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   Relative edge scoring weighting.
```

semantic\_classes
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | [] |
```

```
Description
:   The list of semantic classes in your graph that you would like to score based off of.
```

<for each class>
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | N/A |
```

```
Description
:   The cost to assign to this semantic class. For example: `highway: 8.4`.
```

semantic\_key
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | class |
```

```
Description
:   The key to search for edge’s semantic data with the edge’s metadata. If empty string, will look at key names instead.
```

###### StartPoseOrientationScorer

This edge scoring plugin will score an edge starting at the start node (vector from start->goal) based on its angular proximity to the starting pose’s orientation.
This will either score a weighted-angular distance or reject traversals that are outside of a set threshold to force the route to go down a particular direction (i.e. direction robot is already facing).

orientation\_weight
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   Relative edge scoring weighting.
```

use\_orientation\_threshold
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to use the orientation threshold for binary validity of traversal or weighted-angular distance scoring.
```

orientation\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | PI/2 |
```

```
Description
:   The angular threshold to reject edges’ angles if greater than this w.r.t. starting pose, when `use_orientation_threshold: true`.
```

###### GoalPoseOrientationScorer

This edge scoring plugin will score a an edge with terminus of the goal node (vector from start->goal) based on its angular proximity to the goal pose’s orientation.
This will either score a weighted-angular distance or reject traversals that are outside of a set threshold to force the route to go down a particular direction (i.e. direction robot wants to be facing).

orientation\_weight
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   Relative edge scoring weighting.
```

use\_orientation\_threshold
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to use the orientation threshold for binary validity of traversal or weighted-angular distance scoring.
```

orientation\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | PI/2 |
```

```
Description
:   The angular threshold to reject edges’ angles if greater than this w.r.t. goal pose, when `use_orientation_threshold: true`.
```

###### DynamicEdgesScorer

This edge scoring plugin will score based on the requested values from a 3rd party application via a service interface.
It can set dynamically any cost for any edge and also be used to close and reopen particular edges if they are blocked, in use by other robots locking out its shared use by other robots, higher cost due to overlap with other platforms in service, increased cost due to fleet manager analytics that this space is underperforming throughput, or otherwise temporarily non-traversable.
For example, if other robots report an edge to be blocked, all robots can avoid this edge/aisle/etc.

It has no parameters.

###### Route Operations Parameters

###### AdjustSpeedLimit

This route operation will check the graph at each state change (e.g. node passed) if the new edge entered contains speed limit restrictions. If so, it will publish those to the speed limit topic to be received by the controller server.

speed\_limit\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | speed\_limit |
```

```
Description
:   The topic to publish new speed limits to.
```

speed\_tag
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | speed\_limit |
```

```
Description
:   The graph’s semantic metadata key to look for speed limits under.
```

###### CollisionMonitor

This route operation will evaluate a future-looking portion of the route for validity w.r.t. collision in the costmap.
If it is blocked, it sets the edge blocked as blocked for rerouting around the blocked edge or fail the action based on `reroute_on_collision`.

costmap\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “global\_costmap/costmap\_raw” |
```

```
Description
:   The costmap topic to use for collision checking. May be local or global costmap depending on the desired collision checking horizon. If set to the same as the server’s costmap topic, then it will be shared here as well without duplicate subscriptions.
```

rate
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   The rate to collision at, rather than the tracker’s update rate since this is an expensive operation.
```

max\_cost
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 253.0 |
```

```
Description
:   The cost at or above which is considered invalid.
```

max\_collision\_dist
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 5.0 |
```

```
Description
:   The distance (meters) ahead of the robot’s position on the route to collision check during.
```

check\_resolution
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1 |
```

```
Description
:   The resolution to check at in terms of multiples of the costmap’s resolution (1 = 1 cell, 2 = every 2 cells, and so on). This reduces the computational complexity for long-range routes.
```

reroute\_on\_collision
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to reroute on collision or exit the tracking task as a failure when future collision is detected.
```

###### TimeMarker

This route operation will track times taken to traverse particular edges to write times to for later improved navigation time estimation in edge scoring.

time\_tag
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | abs\_time\_taken |
```

```
Description
:   Metadata tag to write the time taken to within an edge. Is used with the `TimeScorer` to give an improved experiential estimate of traversal times.
```

###### ReroutingService

This route operation will receive service requests from a 3rd party application to cause a rerouting request.

###### TriggerEvent

This route operation will trigger an external service when a graph node or edge contains a route operation of this name.
It uses a std\_srvs/Trigger interface and is a demonstration of the RouteOperationClient<SrvT> base class which can be used to trigger other events of other types of other names as desired (opening doors, calling elevators, etc).

###### Example

```
route_server:
  ros__parameters:

    base_frame: "base_link"                       # Robot's base frame
    route_frame: "map"                            # Global reference frame
    path_density: 0.05                            # Density of points for generating the dense nav_msgs/Path from route (m)
    max_iterations: 0                             # Maximum number of search iterations, if 0, uses maximum possible
    max_planning_time: 2.0                        # Maximum planning time (seconds)
    smoothing_corners: true                       # Whether to smooth corners formed by adjacent edges or not
    smoothing_radius: 1.0                         # Radius of corner to fit into the corner

    graph_file_loader: "GeoJsonGraphFileLoader"   # Name of default file loader
      plugin: nav2_route::GeoJsonGraphFileLoader  # file loader plugin to use
    graph_filepath: ""                            # file path to graph to use

    edge_cost_functions: ["DistanceScorer", "DynamicEdgesScorer"]  # Edge scoring cost functions to use
    DistanceScorer:
      plugin: "nav2_route::DistanceScorer"
    DynamicEdgesScorer:
      plugin: "nav2_route::DynamicEdgesScorer"

    operations: ["AdjustSpeedLimit", "ReroutingService"] # Route operations plugins to use
    AdjustSpeedLimit:
      plugin: "nav2_route::AdjustSpeedLimit"
    ReroutingService:
      plugin: "nav2_route::ReroutingService"

    tracker_update_rate: 50.0                     # Rate at which to check the status of path tracking
    aggregate_blocked_ids: false                  # Whether to aggregate the blocked IDs reported by route operations over the lifespan of the navigation request or only use the currently blocked IDs.
    boundary_radius_to_achieve_node: 1.0          # Radius (m) near boundary nodes (e.g. start/end) to enable evaluation of achievement metric
    radius_to_achieve_node: 2.0                   # Radius (m) near route nodes as preliminary condition for evaluation of achievement metric

    max_prune_dist_from_edge: 8.0                       # Max distance from an edge to consider pruning it as in-progress (e.g. if we're too far away from the edge, its nonsensical to prune it)
    min_prune_dist_from_goal: 0.15                      # Min distance from goal node away from goal pose to consider goal node pruning as considering it as being passed (in case goal pose is very close to a goal node, but not exact)
    min_prune_dist_from_start: 0.10                     # Min distance from start node away from start pose to consider start node pruning as considering it as being passed (in case start pose is very close to a start node, but not exact)
    prune_goal: true                              # Whether pruning the goal nodes from the route due to being past the goal pose requested is possible (pose requests only)
```

###### Configuring the Nav2 Route Server Demo

The Nav2 Route Server demo is a simulation of a Turtlebot4 robot navigating through a depot or a warehouse environment using the Nav2 Route Server.
The [route\_example\_launch.py](https://github.com/ros-navigation/navigation2/blob/main/nav2_simple_commander/launch/route_example_launch.py) file is used to launch the demo, and can be configured in place with the following parameters:

* `MAP_TYPE`:
  :   + Set to either `depot` or `warehouse` to choose the environment.
* `MAP_POSES_DICT`:
  :   + A dictionary containing the Gazebo spawn poses for the robot in the depot and warehouse environments.
* `ROUTE_POSES_DICT`:
  :   + A dictionary containing the start and goal poses for the robot in the depot and warehouse environments.

All the graphs files for the depot and warehouse environments are located in the [graphs](https://github.com/ros-navigation/navigation2/tree/main/nav2_bringup/graphs) directory under the `nav2_bringup` package.
These are the current visualizations of the route graphs for the depot and warehouse environments:

[![../../_images/depot_graph.png](../../_images/depot_graph.png)](../../_images/depot_graph.png)

***RViz visualization of the bidirectional route graph for the depot environment.***

[![../../_images/warehouse_graph.png](../../_images/warehouse_graph.png)](../../_images/warehouse_graph.png)

***RViz visualization of the route graph for the warehouse environment. All nodes are bidirectional, except the ones that are annotated.***

#### Parameters

**`base_frame`**
- Type: `unknown`
- TypeDefaultstring“base_link”DescriptionThe base frame of the robot to use to obtain the robot’s pose from when not using theuse_startrequest parameter.

**`route_frame`**
- Type: `unknown`
- TypeDefaultstring“map”DescriptionThe frame of the route graph to plan within. If values in the graph file are not w.r.t. this frame, they will be automatically transformed.

**`path_density`**
- Type: `unknown`
- TypeDefaultdouble0.05DescriptionThe density of path-points in the output route, if using thenav_msgs/Pathroute rather than the collection of nodes and edges. This is used to upsample the route into a path that may be followed.

**`max_iterations`**
- Type: `unknown`
- TypeDefaultint0DescriptionThe maximum number of planning iterations to perform. If 0, the maximum number of iterations is used.

**`max_planning_time`**
- Type: `unknown`
- TypeDefaultdouble2.0DescriptionThe maximum planning time to use.

**`smooth_corners`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to smooth corners formed between subsequent edges after a route has been found

**`smoothing_radius`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionRadius to fit to corners formed by edges if corner smoothing is enabled

**`costmap_topic`**
- Type: `unknown`
- TypeDefaultstring‘global_costmap/costmap_raw’DescriptionThe costmap to use for the server-level costmap subscriber. This is created to aid the goal intent extractor (if BFS-based terminal route node finding is enabled) and also shared with the Collision Monitor Operation and Costmap Edge Scorer if set to the same topic. Otherwise, those plugins will create their own subscribers to their respective costmap topics.

**`tracker_update_rate`**
- Type: `unknown`
- TypeDefaultdouble50.0DescriptionThe update rate of the tracker (when usingComputeAndTrackRouteaction) to check the status of path tracking and execute route operations.

**`aggregate_blocked_ids`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to aggregate the blocked IDs reported by route operations over the lifespan of the navigation request or only use the currently marked blocked IDs.

**`boundary_radius_to_achieve_node`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionThe radius at a boundary condition (start, goal) to mark the node achieved by the tracker when usingComputeAndTrackRoute. Note that this is not the same as the goal tolerance, as the route or path follower (controller) will continue to run until its goal tolerance is met.

**`radius_to_achieve_node`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionThe radius for non-boundary conditions to mark the node as achieved once within tolerance of, when usingComputeAndTrackRoute. Note that this is a radius to consider achievable, however a refinement process takes place to most accurately identify when a node is reached. The radius is the trigger to start this process. Set this generously based on path tracking tolerances.

**`max_prune_dist_from_edge`**
- Type: `unknown`
- TypeDefaultdouble8.0DescriptionMaximum distance from an edge to consider pruning it as in-progress (i.e. if we’re to far away from an edge, it is nonsensical to prune it).

**`min_prune_dist_from_goal`**
- Type: `unknown`
- TypeDefaultdouble0.15DescriptionMinimum distance from the goal node away from the request’s goal pose (if usinguse_poses) to consider pruning as being passed, in case the goal pose is very close to the goal node, but is not exact.

**`min_prune_dist_from_start`**
- Type: `unknown`
- TypeDefaultdouble0.1DescriptionMinimum distance from the start node away from the start pose (if usinguse_poses) to consider pruning as being passed, in case the start pose is very close to the start node, but is not exact. Setting this to be ~3-5x the goal tolerance may be a good choice when doing largely on-graph navigation to connect from the start node near the robot to the route fully without pruning.

**`prune_goal`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether pruning the goal node from the route due to it being spatially past the goal pose requested (pose requests onlyuse_poses).

**`enable_nn_search`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to use Breadth-first search to find the nearest traversable node (true) or simply the nearest node (false) for the start and goal when using pose requests.

**`max_nn_search_iterations`**
- Type: `unknown`
- TypeDefaultint10000DescriptionThe maximum number of iterations to perform Breadth-first search to find the start and goal closest traversable nodes.

**`num_nearest_nodes`**
- Type: `unknown`
- TypeDefaultint5DescriptionThe number of nearest-neighbors to extract from a Kd-tree in order to check against in the Breadth-first search.

**`graph_filepath`**
- Type: `unknown`
- TypeDefaultstring“”DescriptionThe filepath to the graph file for loading. It may be empty on initialization, but then the graph must be set from the server’s set graph service later.

**`graph_file_loader`**
- Type: `unknown`
- TypeDefaultstring“GeoJsonGraphFileLoader”DescriptionThe name of the graph file loader plugin to use.

**`graph_file_loader.plugin`**
- Type: `unknown`
- TypeDefaultstring“nav2_route::GeoJsonGraphFileLoader”DescriptionThe graph loading plugin to use. By default, we usegeojson.

**`edge_cost_functions`**
- Type: `unknown`
- TypeDefaultvector<string>[“DistanceScorer”, “DynamicEdgesScorer”]DescriptionWhich edge cost functions should be used for planning purposes to score the edges. By default, we optimize for minimum distance while providing a service cost function to set arbitrary costs or mark edge as closed from a service.

**`operations`**
- Type: `unknown`
- TypeDefaultvector<string>[“AdjustSpeedLimit”, “ReroutingService”]DescriptionThe route operation plugins to use forComputeAndTrackRoute. By default, we have a speed limit adjuster and a ROS service request rerouting operation.

**`<name>.plugin`**
- Type: `unknown`
- TypeDefaultstring“”DescriptionThe plugin to load under that name. Theedge_cost_functions.<name>namespaces is also where plugin-specific parameters are defined.

**`introspection_mode`**
- Type: `unknown`
- TypeDefaultstring“disabled”DescriptionThe introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.

**`allow_parameter_qos_overrides`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to allow QoS profiles to be overwritten with parameterized values.

**`Description`**
- Type: `unknown`
- The base frame of the robot to use to obtain the robot’s pose from when not using theuse_startrequest parameter.

**`Description`**
- Type: `unknown`
- The frame of the route graph to plan within. If values in the graph file are not w.r.t. this frame, they will be automatically transformed.

**`Description`**
- Type: `unknown`
- The density of path-points in the output route, if using thenav_msgs/Pathroute rather than the collection of nodes and edges. This is used to upsample the route into a path that may be followed.

**`Description`**
- Type: `unknown`
- The maximum number of planning iterations to perform. If 0, the maximum number of iterations is used.

**`Description`**
- Type: `unknown`
- The maximum planning time to use.

**`Description`**
- Type: `unknown`
- Whether to smooth corners formed between subsequent edges after a route has been found

**`Description`**
- Type: `unknown`
- Radius to fit to corners formed by edges if corner smoothing is enabled

**`Description`**
- Type: `unknown`
- The costmap to use for the server-level costmap subscriber. This is created to aid the goal intent extractor (if BFS-based terminal route node finding is enabled) and also shared with the Collision Monitor Operation and Costmap Edge Scorer if set to the same topic. Otherwise, those plugins will create their own subscribers to their respective costmap topics.

**`Description`**
- Type: `unknown`
- The update rate of the tracker (when usingComputeAndTrackRouteaction) to check the status of path tracking and execute route operations.

**`Description`**
- Type: `unknown`
- Whether to aggregate the blocked IDs reported by route operations over the lifespan of the navigation request or only use the currently marked blocked IDs.

**`Description`**
- Type: `unknown`
- The radius at a boundary condition (start, goal) to mark the node achieved by the tracker when usingComputeAndTrackRoute. Note that this is not the same as the goal tolerance, as the route or path follower (controller) will continue to run until its goal tolerance is met.

**`Description`**
- Type: `unknown`
- The radius for non-boundary conditions to mark the node as achieved once within tolerance of, when usingComputeAndTrackRoute. Note that this is a radius to consider achievable, however a refinement process takes place to most accurately identify when a node is reached. The radius is the trigger to start this process. Set this generously based on path tracking tolerances.

**`Description`**
- Type: `unknown`
- Maximum distance from an edge to consider pruning it as in-progress (i.e. if we’re to far away from an edge, it is nonsensical to prune it).

**`Description`**
- Type: `unknown`
- Minimum distance from the goal node away from the request’s goal pose (if usinguse_poses) to consider pruning as being passed, in case the goal pose is very close to the goal node, but is not exact.

**`Description`**
- Type: `unknown`
- Minimum distance from the start node away from the start pose (if usinguse_poses) to consider pruning as being passed, in case the start pose is very close to the start node, but is not exact. Setting this to be ~3-5x the goal tolerance may be a good choice when doing largely on-graph navigation to connect from the start node near the robot to the route fully without pruning.

**`Description`**
- Type: `unknown`
- Whether pruning the goal node from the route due to it being spatially past the goal pose requested (pose requests onlyuse_poses).

**`Description`**
- Type: `unknown`
- Whether to use Breadth-first search to find the nearest traversable node (true) or simply the nearest node (false) for the start and goal when using pose requests.

**`Description`**
- Type: `unknown`
- The maximum number of iterations to perform Breadth-first search to find the start and goal closest traversable nodes.

**`Description`**
- Type: `unknown`
- The number of nearest-neighbors to extract from a Kd-tree in order to check against in the Breadth-first search.

**`Description`**
- Type: `unknown`
- The filepath to the graph file for loading. It may be empty on initialization, but then the graph must be set from the server’s set graph service later.

**`Description`**
- Type: `unknown`
- The name of the graph file loader plugin to use.

**`Description`**
- Type: `unknown`
- The graph loading plugin to use. By default, we usegeojson.

**`Description`**
- Type: `unknown`
- Which edge cost functions should be used for planning purposes to score the edges. By default, we optimize for minimum distance while providing a service cost function to set arbitrary costs or mark edge as closed from a service.

**`Description`**
- Type: `unknown`
- The route operation plugins to use forComputeAndTrackRoute. By default, we have a speed limit adjuster and a ROS service request rerouting operation.

**`Description`**
- Type: `unknown`
- The plugin to load under that name. Theedge_cost_functions.<name>namespaces is also where plugin-specific parameters are defined.

**`Description`**
- Type: `unknown`
- The introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.

**`Description`**
- Type: `unknown`
- Whether to allow QoS profiles to be overwritten with parameterized values.

**`weight`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionRelative edge scoring weighting.

**`costmap_topic`**
- Type: `unknown`
- TypeDefaultstringglobal_costmap/costmap_rawDescriptionCostmap topic to use for scoring.

**`max_cost`**
- Type: `unknown`
- TypeDefaultdouble253.0DescriptionMaximum cost to consider an route blocked (253.0)

**`use_maximum`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to score based on single maximum or average

**`invalid_on_collision`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to consider collision status as a terminal condition

**`invalid_off_map`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to consider route going off the map invalid

**`check_resolution`**
- Type: `unknown`
- TypeDefaultint1DescriptionResolution to check costs at (1 = costmap resolution, 2 = 2x costmap resolution, etc)

**`Description`**
- Type: `unknown`
- Relative edge scoring weighting.

**`Description`**
- Type: `unknown`
- Costmap topic to use for scoring.

**`Description`**
- Type: `unknown`
- Maximum cost to consider an route blocked (253.0)

**`Description`**
- Type: `unknown`
- Whether to score based on single maximum or average

**`Description`**
- Type: `unknown`
- Whether to consider collision status as a terminal condition

**`Description`**
- Type: `unknown`
- Whether to consider route going off the map invalid

**`Description`**
- Type: `unknown`
- Resolution to check costs at (1 = costmap resolution, 2 = 2x costmap resolution, etc)

**`weight`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionRelative edge scoring weighting.

**`speed_tag`**
- Type: `unknown`
- TypeDefaultstring“speed_limit”DescriptionGraph metadata key to look for percentage speed limits (speed_limit).

**`Description`**
- Type: `unknown`
- Relative edge scoring weighting.

**`Description`**
- Type: `unknown`
- Graph metadata key to look for percentage speed limits (speed_limit).

**`weight`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionRelative edge scoring weighting.

**`speed_tag`**
- Type: `unknown`
- TypeDefaultstring“abs_speed_limit”DescriptionGraph metadata key to look for absolute speed limits.

**`time_tag`**
- Type: `unknown`
- TypeDefaultstring“abs_time_taken”DescriptionGraph metadata key to look for abs traversal times.

**`max_vel`**
- Type: `unknown`
- TypeDefaultdouble0.5DescriptionMaximum velocity to use if speed limit or time taken is not set.

**`Description`**
- Type: `unknown`
- Relative edge scoring weighting.

**`Description`**
- Type: `unknown`
- Graph metadata key to look for absolute speed limits.

**`Description`**
- Type: `unknown`
- Graph metadata key to look for abs traversal times.

**`Description`**
- Type: `unknown`
- Maximum velocity to use if speed limit or time taken is not set.

**`weight`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionRelative edge scoring weighting.

**`penalty_tag`**
- Type: `unknown`
- TypeDefaultstring“penalty”DescriptionGraph metadata key to look for penalty value.

**`Description`**
- Type: `unknown`
- Relative edge scoring weighting.

**`Description`**
- Type: `unknown`
- Graph metadata key to look for penalty value.

**`weight`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionRelative edge scoring weighting.

**`semantic_classes`**
- Type: `unknown`
- TypeDefaultvector<string>[]DescriptionThe list of semantic classes in your graph that you would like to score based off of.

**`<for each class>`**
- Type: `unknown`
- TypeDefaultdoubleN/ADescriptionThe cost to assign to this semantic class. For example:highway:8.4.

**`semantic_key`**
- Type: `unknown`
- TypeDefaultstringclassDescriptionThe key to search for edge’s semantic data with the edge’s metadata. If empty string, will look at key names instead.

**`Description`**
- Type: `unknown`
- Relative edge scoring weighting.

**`Description`**
- Type: `unknown`
- The list of semantic classes in your graph that you would like to score based off of.

**`Description`**
- Type: `unknown`
- The cost to assign to this semantic class. For example:highway:8.4.

**`Description`**
- Type: `unknown`
- The key to search for edge’s semantic data with the edge’s metadata. If empty string, will look at key names instead.

**`orientation_weight`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionRelative edge scoring weighting.

**`use_orientation_threshold`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to use the orientation threshold for binary validity of traversal or weighted-angular distance scoring.

**`orientation_tolerance`**
- Type: `unknown`
- TypeDefaultdoublePI/2DescriptionThe angular threshold to reject edges’ angles if greater than this w.r.t. starting pose, whenuse_orientation_threshold:true.

**`Description`**
- Type: `unknown`
- Relative edge scoring weighting.

**`Description`**
- Type: `unknown`
- Whether to use the orientation threshold for binary validity of traversal or weighted-angular distance scoring.

**`Description`**
- Type: `unknown`
- The angular threshold to reject edges’ angles if greater than this w.r.t. starting pose, whenuse_orientation_threshold:true.

**`orientation_weight`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionRelative edge scoring weighting.

**`use_orientation_threshold`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to use the orientation threshold for binary validity of traversal or weighted-angular distance scoring.

**`orientation_tolerance`**
- Type: `unknown`
- TypeDefaultdoublePI/2DescriptionThe angular threshold to reject edges’ angles if greater than this w.r.t. goal pose, whenuse_orientation_threshold:true.

**`Description`**
- Type: `unknown`
- Relative edge scoring weighting.

**`Description`**
- Type: `unknown`
- Whether to use the orientation threshold for binary validity of traversal or weighted-angular distance scoring.

**`Description`**
- Type: `unknown`
- The angular threshold to reject edges’ angles if greater than this w.r.t. goal pose, whenuse_orientation_threshold:true.

**`speed_limit_topic`**
- Type: `unknown`
- TypeDefaultstringspeed_limitDescriptionThe topic to publish new speed limits to.

**`speed_tag`**
- Type: `unknown`
- TypeDefaultstringspeed_limitDescriptionThe graph’s semantic metadata key to look for speed limits under.

**`Description`**
- Type: `unknown`
- The topic to publish new speed limits to.

**`Description`**
- Type: `unknown`
- The graph’s semantic metadata key to look for speed limits under.

**`costmap_topic`**
- Type: `unknown`
- TypeDefaultstring“global_costmap/costmap_raw”DescriptionThe costmap topic to use for collision checking. May be local or global costmap depending on the desired collision checking horizon. If set to the same as the server’s costmap topic, then it will be shared here as well without duplicate subscriptions.

**`rate`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionThe rate to collision at, rather than the tracker’s update rate since this is an expensive operation.

**`max_cost`**
- Type: `unknown`
- TypeDefaultdouble253.0DescriptionThe cost at or above which is considered invalid.

**`max_collision_dist`**
- Type: `unknown`
- TypeDefaultdouble5.0DescriptionThe distance (meters) ahead of the robot’s position on the route to collision check during.

**`check_resolution`**
- Type: `unknown`
- TypeDefaultint1DescriptionThe resolution to check at in terms of multiples of the costmap’s resolution (1 = 1 cell, 2 = every 2 cells, and so on). This reduces the computational complexity for long-range routes.

**`reroute_on_collision`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to reroute on collision or exit the tracking task as a failure when future collision is detected.

**`Description`**
- Type: `unknown`
- The costmap topic to use for collision checking. May be local or global costmap depending on the desired collision checking horizon. If set to the same as the server’s costmap topic, then it will be shared here as well without duplicate subscriptions.

**`Description`**
- Type: `unknown`
- The rate to collision at, rather than the tracker’s update rate since this is an expensive operation.

**`Description`**
- Type: `unknown`
- The cost at or above which is considered invalid.

**`Description`**
- Type: `unknown`
- The distance (meters) ahead of the robot’s position on the route to collision check during.

**`Description`**
- Type: `unknown`
- The resolution to check at in terms of multiples of the costmap’s resolution (1 = 1 cell, 2 = every 2 cells, and so on). This reduces the computational complexity for long-range routes.

**`Description`**
- Type: `unknown`
- Whether to reroute on collision or exit the tracking task as a failure when future collision is detected.

**`time_tag`**
- Type: `unknown`
- TypeDefaultstringabs_time_takenDescriptionMetadata tag to write the time taken to within an edge. Is used with theTimeScorerto give an improved experiential estimate of traversal times.

**`Description`**
- Type: `unknown`
- Metadata tag to write the time taken to within an edge. Is used with theTimeScorerto give an improved experiential estimate of traversal times.

**`MAP_TYPE:`**
- Type: `unknown`
- Set to eitherdepotorwarehouseto choose the environment.

**`MAP_POSES_DICT:`**
- Type: `unknown`
- A dictionary containing the Gazebo spawn poses for the robot in the depot and warehouse environments.

**`ROUTE_POSES_DICT:`**
- Type: `unknown`
- A dictionary containing the start and goal poses for the robot in the depot and warehouse environments.


---

#### Savitzky-Golay Smoother

*Source: [https://docs.nav2.org/configuration/packages/configuring-savitzky-golay-smoother.html](https://docs.nav2.org/configuration/packages/configuring-savitzky-golay-smoother.html)*

##### Savitzky-Golay Smoother

Source code on [Github](https://github.com/ros-navigation/navigation2/tree/main/nav2_smoother).

The Savitzky-Golay Smoother is a Smoother Server plugin that will take in an input path and smooth it using a simple and fast smoothing technique based on [Savitzky Golay Filters](https://en.wikipedia.org/wiki/Savitzky%E2%80%93Golay_filter). It uses a digital signal processing technique designed to reduce noise distorting a reference signal, in this case, a path.

It is useful for all types of planners, but particularly in NavFn to remove tiny artifacts that can occur near the end of paths or Theta\* to slightly soften the transition between Line of Sight line segments **without** modifying the primary path. It is very fast (<< 1ms) so is a recommended default for planners that may result in slight discontinuities. However, it will not smooth out larger scale discontinuities, oscillations, or improve smoothness. For those, use one of the other provided smoother plugins. It also provides estimated orientation vectors of the path points after smoothing.

This algorithm is deterministic and low-parameter. In the below image, some odd points from NavFn’s gradient descent are smoothed out by the smoother in the middle and end of a given path, while otherwise retaining the exact character of the path.

![../../_images/savitzky-golay-example.png](../../_images/savitzky-golay-example.png)

###### Savitzky-Golay Smoother Parameters

window\_size
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 7 |
```

```
Description
:   Size of the smoothing window. Must be an odd integer, with a minimum value of 3
```

poly\_order
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 3 |
```

```
Description
:   Order of the polynomial used to fit the samples in each smoothing window
```

do\_refinement
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description
:   Whether to smooth the smoothed results `refinement_num` times to get an improved result.
```

refinement\_num
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 2 |
```

```
Description
:   Number of times to recursively smooth a segment
```

enforce\_path\_inversion
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description
:   Whether to consider input path discontinuities as path inversions from feasible planning to be respected or smooth other them. Leave on for Smac Planner feasible planners, but may want to disable for NavFn or the Route Server.
```

###### Example

```
smoother_server:
  ros__parameters:
    costmap_topic: global_costmap/costmap_raw
    footprint_topic: global_costmap/published_footprint
    robot_base_frame: base_link
    transform_tolerance: 0.1
    smoother_plugins: ["savitzky_golay_smoother"]
    savitzky_golay_smoother:
      plugin: "nav2_smoother::SavitzkyGolaySmoother"
      window_size: 7
      poly_order: 3
      do_refinement: True
      refinement_num: 2
      enforce_path_inversion: True
```

#### Parameters

**`window_size`**
- Type: `unknown`
- TypeDefaultint7DescriptionSize of the smoothing window. Must be an odd integer, with a minimum value of 3

**`poly_order`**
- Type: `unknown`
- TypeDefaultint3DescriptionOrder of the polynomial used to fit the samples in each smoothing window

**`do_refinement`**
- Type: `unknown`
- TypeDefaultboolTrueDescriptionWhether to smooth the smoothed resultsrefinement_numtimes to get an improved result.

**`refinement_num`**
- Type: `unknown`
- TypeDefaultint2DescriptionNumber of times to recursively smooth a segment

**`enforce_path_inversion`**
- Type: `unknown`
- TypeDefaultboolTrueDescriptionWhether to consider input path discontinuities as path inversions from feasible planning to be respected or smooth other them. Leave on for Smac Planner feasible planners, but may want to disable for NavFn or the Route Server.

**`Description`**
- Type: `unknown`
- Size of the smoothing window. Must be an odd integer, with a minimum value of 3

**`Description`**
- Type: `unknown`
- Order of the polynomial used to fit the samples in each smoothing window

**`Description`**
- Type: `unknown`
- Whether to smooth the smoothed resultsrefinement_numtimes to get an improved result.

**`Description`**
- Type: `unknown`
- Number of times to recursively smooth a segment

**`Description`**
- Type: `unknown`
- Whether to consider input path discontinuities as path inversions from feasible planning to be respected or smooth other them. Leave on for Smac Planner feasible planners, but may want to disable for NavFn or the Route Server.


---

#### Simple Smoother

*Source: [https://docs.nav2.org/configuration/packages/configuring-simple-smoother.html](https://docs.nav2.org/configuration/packages/configuring-simple-smoother.html)*

##### Simple Smoother

Source code on [Github](https://github.com/ros-navigation/navigation2/tree/main/nav2_smoother).

The Simple Smoother is a Smoother Server plugin that will take in an input path and smooth it using a simple and fast smoothing technique. It weights the initial path points and the smoothed path points to create a balanced result where the path retains its high level characteristics but reduces oscillations or jagged features.

It is recommended this is paired ONLY with infeasible (e.g. 2D) planners, since this algorithm will break any kinematically feasible conditions. It is recommended users use the Constrained Smoother plugin instead with feasible plans.

###### Simple Smoother Parameters

tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0e-10 |
```

```
Description
:   Change in parameter values across path to terminate smoothing
```

do\_refinement
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description
:   Whether to smooth the smoothed path recursively to refine the quality further
```

refinement\_num
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 2 |
```

```
Description
:   Number of times to recursively attempt to smooth, must be `>= 1`.
```

max\_its
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1000 |
```

```
Description
:   Maximum number of iterations to attempt smoothing before termination
```

w\_data
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.2 |
```

```
Description
:   Weight to apply to path data given (bounds it)
```

w\_smooth
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.3 |
```

```
Description
:   Weight to apply to smooth the path (smooths it)
```

enforce\_path\_inversion
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description
:   Whether to consider input path discontinuities as path inversions from feasible planning to be respected or smooth other them. Leave on for Smac Planner feasible planners, but may want to disable for NavFn or the Route Server.
```

###### Example

```
smoother_server:
  ros__parameters:
    costmap_topic: global_costmap/costmap_raw
    footprint_topic: global_costmap/published_footprint
    robot_base_frame: base_link
    transform_tolerance: 0.1
    smoother_plugins: ["simple_smoother"]
    simple_smoother:
      plugin: "nav2_smoother::SimpleSmoother"
      tolerance: 1.0e-10
      do_refinement: True
      refinement_num: 2
      max_its: 1000
      w_data: 0.2
      w_smooth: 0.3
      enforce_path_inversion: True
```

#### Parameters

**`tolerance`**
- Type: `unknown`
- TypeDefaultdouble1.0e-10DescriptionChange in parameter values across path to terminate smoothing

**`do_refinement`**
- Type: `unknown`
- TypeDefaultboolTrueDescriptionWhether to smooth the smoothed path recursively to refine the quality further

**`refinement_num`**
- Type: `unknown`
- TypeDefaultint2DescriptionNumber of times to recursively attempt to smooth, must be>=1.

**`max_its`**
- Type: `unknown`
- TypeDefaultint1000DescriptionMaximum number of iterations to attempt smoothing before termination

**`w_data`**
- Type: `unknown`
- TypeDefaultdouble0.2DescriptionWeight to apply to path data given (bounds it)

**`w_smooth`**
- Type: `unknown`
- TypeDefaultdouble0.3DescriptionWeight to apply to smooth the path (smooths it)

**`enforce_path_inversion`**
- Type: `unknown`
- TypeDefaultboolTrueDescriptionWhether to consider input path discontinuities as path inversions from feasible planning to be respected or smooth other them. Leave on for Smac Planner feasible planners, but may want to disable for NavFn or the Route Server.

**`Description`**
- Type: `unknown`
- Change in parameter values across path to terminate smoothing

**`Description`**
- Type: `unknown`
- Whether to smooth the smoothed path recursively to refine the quality further

**`Description`**
- Type: `unknown`
- Number of times to recursively attempt to smooth, must be>=1.

**`Description`**
- Type: `unknown`
- Maximum number of iterations to attempt smoothing before termination

**`Description`**
- Type: `unknown`
- Weight to apply to path data given (bounds it)

**`Description`**
- Type: `unknown`
- Weight to apply to smooth the path (smooths it)

**`Description`**
- Type: `unknown`
- Whether to consider input path discontinuities as path inversions from feasible planning to be respected or smooth other them. Leave on for Smac Planner feasible planners, but may want to disable for NavFn or the Route Server.


---

#### Smac Planner

*Source: [https://docs.nav2.org/configuration/packages/configuring-smac-planner.html](https://docs.nav2.org/configuration/packages/configuring-smac-planner.html)*

##### Smac Planner

Source code and `README` with design, explanations, and metrics can be found on [Github](https://github.com/ros-navigation/navigation2/tree/main/nav2_smac_planner). A brief explanation can be found below, but the `README` contains the most detailed overview of the framework and planner implementations.

The Smac Planner plugin implements three A\* based planning algorithms: 2D A\*, Hybrid-A\*, and State Lattice path planners.
It is important to know that in June 2021 and December 2021, the package received a several **major** updates both improving path quality and run-times by 2-3x.

###### Provided Plugins

> The plugins listed below are inside the `nav2_smac_planner` package. See the pages for individual configuration information.

* [Smac 2D Planner](smac/configuring-smac-2d.html)
* [Smac Hybrid-A\* Planner](smac/configuring-smac-hybrid.html)
* [Smac State Lattice Planner](smac/configuring-smac-lattice.html)

###### Description

The `nav2_smac_planner` package contains an optimized templated A\* search algorithm used to create multiple A\*-based planners for multiple types of robot platforms. It uses template node types to develop different search-based planners.

We support circular differential-drive and omni-directional drive robots using the `SmacPlanner2D` planner which implements a cost-aware A\* planner. We support car-like (ackermann) and legged vehicles using the `SmacPlannerHybrid` plugin which implements a Hybrid-A\* planner. We support non-circular, arbitrary shaped, any model vehicles using the `SmacPlannerLattice` plugin which implements a State Lattice planner (e.g. omni, diff, ackermann, legged, custom). It contains control sets and generators for ackermann, legged, differential drive and omnidirectional vehicles, but you may provide your own for another robot type or to have different planning behaviors.

The last two plugins are both **kinematically feasible** and support **reversing**. They have performance similar to its 2D counter parts like 2D-A\* and NavFn via highly optimized heuristic functions and efficient programming. An example of the 3 planners can be seen below, planning a roughly 75 m path.

* Hybrid-A\* computed the path in 144ms
* State Lattice computed the path in 113ms
* 2D A\* computed the path in 243ms
* For reference: NavFn compute the path in 146ms, including some nasty path discontinuity artifacts

Usual planning times are below 100ms for some environments, occasionally approaching up to 200ms. The performance of all 3 planners is roughly comparable with naive 2D search algorithms that have long been mainstays of the ROS Navigation ecosystem, but also achieving kinematic feasibility, support for reversing, and using modern state of the art techniques.

![Paths generated by the Smac Planners](../../_images/3planners.png)

Figure 8 2D A\* (Panel 1), Hybrid-A\* (Panel 2), State Lattice (Panel 3)

---

#### Smoother Server

*Source: [https://docs.nav2.org/configuration/packages/configuring-smoother-server.html](https://docs.nav2.org/configuration/packages/configuring-smoother-server.html)*

##### Smoother Server

Source code on [Github](https://github.com/ros-navigation/navigation2/tree/main/nav2_smoother).

The Smoother Server implements the server for handling smooth path requests and hosting a vector of plugins implementing various C++ smoothers.
The server exposes an action interface for smoothing with multiple smoothers that share resources such as costmaps and TF buffers.

###### Smoother Server Parameters

costmap\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “global\_costmap/costmap\_raw” |
```

```
Description
:   Raw costmap topic for collision checking.
```

footprint\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “global\_costmap/published\_footprint” |
```

```
Description
:   Topic for footprint in the costmap frame.
```

transform\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
Description
:   TF transform tolerance.
```

robot\_base\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “base\_link” |
```

```
Description
:   Robot base frame.
```

smoother\_plugins
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | {“nav2\_smoother::SimpleSmoother”} |
```

```
Description
:   List of plugin names to use, also matches action server names.
```

```
Note
:   Each plugin namespace defined in this list needs to have a `plugin` parameter defining the type of plugin to be loaded in the namespace.
```

```
    Example:
```

        ```
        smoother_server:
          ros__parameters:
            smoother_plugins: ["simple_smoother", "curvature_smoother"]
            curvature_smoother:
              plugin: "nav2_ceres_costaware_smoother/CeresCostawareSmoother"
            simple_smoother:
              plugin: "nav2_smoother::SimpleSmoother"
        ```

introspection\_mode
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “disabled” |
```

```
Description
:   The introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.
```

bond\_heartbeat\_period
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
Description
:   The lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.
```

allow\_parameter\_qos\_overrides
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to allow QoS profiles to be overwritten with parameterized values.
```

###### Example

```
smoother_server:
  ros__parameters:
    costmap_topic: global_costmap/costmap_raw
    footprint_topic: global_costmap/published_footprint
    robot_base_frame: base_link
    transform_tolerance: 0.1
    smoother_plugins: ["simple_smoother"]
    simple_smoother:
      plugin: "nav2_smoother::SimpleSmoother"
      tolerance: 1.0e-10
      do_refinement: True
```

#### Parameters

**`costmap_topic`**
- Type: `unknown`
- TypeDefaultstring“global_costmap/costmap_raw”DescriptionRaw costmap topic for collision checking.

**`footprint_topic`**
- Type: `unknown`
- TypeDefaultstring“global_costmap/published_footprint”DescriptionTopic for footprint in the costmap frame.

**`transform_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.1DescriptionTF transform tolerance.

**`robot_base_frame`**
- Type: `unknown`
- TypeDefaultstring“base_link”DescriptionRobot base frame.

**`smoother_plugins`**
- Type: `unknown`
- TypeDefaultvector<string>{“nav2_smoother::SimpleSmoother”}DescriptionList of plugin names to use, also matches action server names.NoteEach plugin namespace defined in this list needs to have apluginparameter defining the type of plugin to be loaded in the namespace.Example:smoother_server:ros__parameters:smoother_plugins:["simple_smoother","curvature_smoother"]curvature_smoother:plugin:"nav2_ceres_costaware_smoother/CeresCostawareSmoother"simple_smoother:plugin:"nav2_smoother::SimpleSmoother"

**`introspection_mode`**
- Type: `unknown`
- TypeDefaultstring“disabled”DescriptionThe introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.

**`bond_heartbeat_period`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionThe lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.

**`allow_parameter_qos_overrides`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to allow QoS profiles to be overwritten with parameterized values.

**`Description`**
- Type: `unknown`
- Raw costmap topic for collision checking.

**`Description`**
- Type: `unknown`
- Topic for footprint in the costmap frame.

**`Description`**
- Type: `unknown`
- TF transform tolerance.

**`Description`**
- Type: `unknown`
- Robot base frame.

**`Description`**
- Type: `unknown`
- List of plugin names to use, also matches action server names.

**`Note`**
- Type: `unknown`
- Each plugin namespace defined in this list needs to have apluginparameter defining the type of plugin to be loaded in the namespace.Example:smoother_server:ros__parameters:smoother_plugins:["simple_smoother","curvature_smoother"]curvature_smoother:plugin:"nav2_ceres_costaware_smoother/CeresCostawareSmoother"simple_smoother:plugin:"nav2_smoother::SimpleSmoother"

**`Description`**
- Type: `unknown`
- The introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.

**`Description`**
- Type: `unknown`
- The lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.

**`Description`**
- Type: `unknown`
- Whether to allow QoS profiles to be overwritten with parameterized values.


---

#### Theta Star Planner

*Source: [https://docs.nav2.org/configuration/packages/configuring-thetastar.html](https://docs.nav2.org/configuration/packages/configuring-thetastar.html)*

##### Theta Star Planner

Theta Star Planner implements the Theta\* path planner meant to plan any-angled line-segment focused paths using A\*.

For the below example the planner took ~46ms (averaged value) to compute the path of 87.5m -

[![Path generated by the Theta* planner](../../_images/00-37.png)](../../_images/00-37.png)

`<name>` is the corresponding planner plugin ID selected for this type.

###### Parameters

The parameters of the planner are:

`<name>`.how\_many\_corners
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 8 |
```

```
Description
:   To choose between 4-connected (up, down, left, right) and 8-connected (all the adjacent cells) graph expansions, the accepted values are 4 and 8
```

`<name>` .w\_euc\_cost
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   Weight applied on the length of the path.
```

`<name>`.w\_traversal\_cost
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description
:   It tunes how harshly the nodes of high cost are penalised. From the above g(neigh) equation you can see that the cost-aware component of the cost function forms a parabolic curve, thus this parameter would, on increasing its value, make that curve steeper allowing for a greater differentiation (as the delta of costs would increase, when the graph becomes steep) among the nodes of different costs.
```

`<name>`.use\_final\_approach\_orientation
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   If true, the last pose of the path generated by the planner will have its orientation set to the approach orientation, i.e. the orientation of the vector connecting the last two points of the path
```

`<name>`.allow\_unknown
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description
:   Whether to allow planning in unknown space.
```

`<name>`.terminal\_checking\_interval
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 5000 |
```

```
Description
:   Number of iterations between checking if the goal has been cancelled or planner timed out
```

Note

Do go through the README file available on this repo’s link to develop a better understanding of how you could tune this planner.
This planner requires you to tune the cost\_scaling\_factor parameter of your costmap too, to get good results.

allow\_parameter\_qos\_overrides
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to allow QoS profiles to be overwritten with parameterized values.
```

###### Example

```
planner_server:
  ros__parameters:
    expected_planner_frequency: 20.0
    planner_plugins: ["GridBased"]
    GridBased:
      plugin: "nav2_theta_star_planner::ThetaStarPlanner" # In Iron and older versions, "/" was used instead of "::"
      how_many_corners: 8
      w_euc_cost: 1.0
      w_traversal_cost: 2.0
```

#### Parameters

**`<name>.how_many_corners`**
- Type: `unknown`
- TypeDefaultint8DescriptionTo choose between 4-connected (up, down, left, right) and 8-connected (all the adjacent cells) graph expansions, the accepted values are 4 and 8

**`<name>.w_euc_cost`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionWeight applied on the length of the path.

**`<name>.w_traversal_cost`**
- Type: `unknown`
- TypeDefaultdouble2.0DescriptionIt tunes how harshly the nodes of high cost are penalised. From the above g(neigh) equation you can see that the cost-aware component of the cost function forms a parabolic curve, thus this parameter would, on increasing its value, make that curve steeper allowing for a greater differentiation (as the delta of costs would increase, when the graph becomes steep) among the nodes of different costs.

**`<name>.use_final_approach_orientation`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionIf true, the last pose of the path generated by the planner will have its orientation set to the approach orientation, i.e. the orientation of the vector connecting the last two points of the path

**`<name>.allow_unknown`**
- Type: `unknown`
- TypeDefaultboolTrueDescriptionWhether to allow planning in unknown space.

**`<name>.terminal_checking_interval`**
- Type: `unknown`
- TypeDefaultint5000DescriptionNumber of iterations between checking if the goal has been cancelled or planner timed out

**`Description`**
- Type: `unknown`
- To choose between 4-connected (up, down, left, right) and 8-connected (all the adjacent cells) graph expansions, the accepted values are 4 and 8

**`Description`**
- Type: `unknown`
- Weight applied on the length of the path.

**`Description`**
- Type: `unknown`
- It tunes how harshly the nodes of high cost are penalised. From the above g(neigh) equation you can see that the cost-aware component of the cost function forms a parabolic curve, thus this parameter would, on increasing its value, make that curve steeper allowing for a greater differentiation (as the delta of costs would increase, when the graph becomes steep) among the nodes of different costs.

**`Description`**
- Type: `unknown`
- If true, the last pose of the path generated by the planner will have its orientation set to the approach orientation, i.e. the orientation of the vector connecting the last two points of the path

**`Description`**
- Type: `unknown`
- Whether to allow planning in unknown space.

**`Description`**
- Type: `unknown`
- Number of iterations between checking if the goal has been cancelled or planner timed out

**`allow_parameter_qos_overrides`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to allow QoS profiles to be overwritten with parameterized values.

**`Description`**
- Type: `unknown`
- Whether to allow QoS profiles to be overwritten with parameterized values.


---

#### Velocity Smoother

*Source: [https://docs.nav2.org/configuration/packages/configuring-velocity-smoother.html](https://docs.nav2.org/configuration/packages/configuring-velocity-smoother.html)*

##### Velocity Smoother

Source code on [Github](https://github.com/ros-navigation/navigation2/tree/main/nav2_velocity_smoother).

The `nav2_velocity_smoother` is a package containing a lifecycle-component node for smoothing velocities sent by Nav2 to robot controllers.
The aim of this package is to implement velocity, acceleration, and deadband smoothing from Nav2 to reduce wear-and-tear on robot motors and hardware controllers by smoothing out the accelerations/jerky movements that might be present with some local trajectory planners’ control efforts.
It can also interpolate velocity commands at higher rates than the controller server publishes.

See the package’s README for more information.

###### Velocity Smoother Parameters

use\_realtime\_priority
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Adds soft real-time prioritization to the controller server to better ensure resources to time sensitive portions of the codebase. This will set the controller’s execution thread to a higher priority than the rest of the system (`90`) to meet scheduling deadlines to have less missed loop rates. To use this feature, you use set the following inside of `/etc/security/limits.conf` to give userspace access to elevated prioritization permissions: `<username> soft rtprio 99 <username> hard rtprio 99`
```

smoothing\_frequency
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 20.0 |
```

```
Description
:   Frequency (Hz) to use the last received velocity command to smooth by velocity, acceleration, and deadband constraints. If set approximately to the rate of your local trajectory planner, it should smooth by acceleration constraints velocity commands. If set much higher, it will interpolate and provide a smooth set of commands to the hardware controller.
```

scale\_velocities
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether or not to adjust other components of velocity proportionally to a component’s required changes due to acceleration limits. This will try to adjust all components to follow the same direction, but still enforces acceleration limits to guarantee compliance, even if it means deviating off commanded trajectory slightly.
```

feedback
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “OPEN\_LOOP” |
```

```
Description
:   Type of feedback to use for the current state of the robot’s velocity. In `OPEN_LOOP`, it will use the last commanded velocity as the next iteration’s current velocity. When acceleration limits are set appropriately, this is a good assumption. In `CLOSED_LOOP`, it will use the odometry from the `odom` topic to estimate the robot’s current speed. In closed loop mode, it is important that the odometry is high rate and low latency, relative to the smoothing frequency.
```

max\_velocity
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<double> | [0.5, 0.0, 2.5] |
```

```
Description
:   Maximum velocities (m/s) in `[x, y, theta]` axes or `[x, y, z, roll, pitch, yaw]` for full 6-DoF support.
```

min\_velocity
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<double> | [-0.5, 0.0, -2.5] |
```

```
Description
:   Minimum velocities (m/s) in `[x, y, theta]` axes or `[x, y, z, roll, pitch, yaw]` for full 6-DoF support. This is **signed** and thus must be **negative** to reverse. Note: rotational velocities negative direction is a right-hand turn, so this should always be negative regardless of reversing preference.
```

deadband\_velocity
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<double> | [0.0, 0.0, 0.0] |
```

```
Description
:   Minimum velocities (m/s) in `[x, y, theta]` axes or `[x, y, z, roll, pitch, yaw]` for full 6-DoF support to send to the robot hardware controllers, to prevent small commands from damaging hardware controllers if that speed cannot be achieved due to stall torque.
```

velocity\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   Timeout (s) after which the velocity smoother will send a zero-ed out `Twist` command and stop publishing.
```

max\_accel
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<double> | [2.5, 0.0, 3.2] |
```

```
Description
:   Maximum acceleration to apply to each axis `[x, y, theta]` or `[x, y, z, roll, pitch, yaw]` for full 6-DoF support.
```

max\_decel
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<double> | [-2.5, 0.0, -3.2] |
```

```
Description
:   Minimum acceleration to apply to each axis `[x, y, theta]` or `[x, y, z, roll, pitch, yaw]` for full 6-DoF support. This is **signed** and thus these should generally all be **negative**.
```

odom\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “odom” |
```

```
Description
:   Topic to find robot odometry, if in `CLOSED_LOOP` operational mode.
```

odom\_duration
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
Description
:   Time (s) to buffer odometry commands to estimate the robot speed, if in `CLOSED_LOOP` operational mode.
```

enable\_stamped\_cmd\_vel
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to use geometry\_msgs::msg::Twist or geometry\_msgs::msg::TwistStamped velocity data.
    True uses TwistStamped, false uses Twist.
    Note: This parameter is default `false` in Jazzy or older! Kilted or newer uses `TwistStamped` by default.
```

stamp\_smoothed\_velocity\_with\_smoothing\_time
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to interpolate the timestamps of the smoothed geometery\_msgs:msg::TwistStamped cmd\_vel message after the last command velocity received. Only available in Jazzy as a backport of the now-default behavior in Lyrical and newer. Default is `false` for backwards compatibility.
```

bond\_heartbeat\_period
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
Description
:   The lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.
```

allow\_parameter\_qos\_overrides
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to allow QoS profiles to be overwritten with parameterized values.
```

###### Example

```
velocity_smoother:
  ros__parameters:
    smoothing_frequency: 20.0
    scale_velocities: false
    feedback: "OPEN_LOOP"
    max_velocity: [0.5, 0.0, 2.5]
    min_velocity: [-0.5, 0.0, -2.5]
    deadband_velocity: [0.0, 0.0, 0.0]
    velocity_timeout: 1.0
    max_accel: [2.5, 0.0, 3.2]
    max_decel: [-2.5, 0.0, -3.2]
    odom_topic: "odom"
    odom_duration: 0.1
    use_realtime_priority: false
    enable_stamped_cmd_vel: false
    stamp_smoothed_velocity_with_smoothing_time: false  # ONLY IN JAZZY
```

#### Parameters

**`use_realtime_priority`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionAdds soft real-time prioritization to the controller server to better ensure resources to time sensitive portions of the codebase. This will set the controller’s execution thread to a higher priority than the rest of the system (90) to meet scheduling deadlines to have less missed loop rates. To use this feature, you use set the following inside of/etc/security/limits.confto give userspace access to elevated prioritization permissions:<username>softrtprio99<username>hardrtprio99

**`smoothing_frequency`**
- Type: `unknown`
- TypeDefaultdouble20.0DescriptionFrequency (Hz) to use the last received velocity command to smooth by velocity, acceleration, and deadband constraints. If set approximately to the rate of your local trajectory planner, it should smooth by acceleration constraints velocity commands. If set much higher, it will interpolate and provide a smooth set of commands to the hardware controller.

**`scale_velocities`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether or not to adjust other components of velocity proportionally to a component’s required changes due to acceleration limits. This will try to adjust all components to follow the same direction, but still enforces acceleration limits to guarantee compliance, even if it means deviating off commanded trajectory slightly.

**`feedback`**
- Type: `unknown`
- TypeDefaultstring“OPEN_LOOP”DescriptionType of feedback to use for the current state of the robot’s velocity. InOPEN_LOOP, it will use the last commanded velocity as the next iteration’s current velocity. When acceleration limits are set appropriately, this is a good assumption. InCLOSED_LOOP, it will use the odometry from theodomtopic to estimate the robot’s current speed. In closed loop mode, it is important that the odometry is high rate and low latency, relative to the smoothing frequency.

**`max_velocity`**
- Type: `unknown`
- TypeDefaultvector<double>[0.5, 0.0, 2.5]DescriptionMaximum velocities (m/s) in[x,y,theta]axes or[x,y,z,roll,pitch,yaw]for full 6-DoF support.

**`min_velocity`**
- Type: `unknown`
- TypeDefaultvector<double>[-0.5, 0.0, -2.5]DescriptionMinimum velocities (m/s) in[x,y,theta]axes or[x,y,z,roll,pitch,yaw]for full 6-DoF support. This issignedand thus must benegativeto reverse. Note: rotational velocities negative direction is a right-hand turn, so this should always be negative regardless of reversing preference.

**`deadband_velocity`**
- Type: `unknown`
- TypeDefaultvector<double>[0.0, 0.0, 0.0]DescriptionMinimum velocities (m/s) in[x,y,theta]axes or[x,y,z,roll,pitch,yaw]for full 6-DoF support to send to the robot hardware controllers, to prevent small commands from damaging hardware controllers if that speed cannot be achieved due to stall torque.

**`velocity_timeout`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionTimeout (s) after which the velocity smoother will send a zero-ed outTwistcommand and stop publishing.

**`max_accel`**
- Type: `unknown`
- TypeDefaultvector<double>[2.5, 0.0, 3.2]DescriptionMaximum acceleration to apply to each axis[x,y,theta]or[x,y,z,roll,pitch,yaw]for full 6-DoF support.

**`max_decel`**
- Type: `unknown`
- TypeDefaultvector<double>[-2.5, 0.0, -3.2]DescriptionMinimum acceleration to apply to each axis[x,y,theta]or[x,y,z,roll,pitch,yaw]for full 6-DoF support. This issignedand thus these should generally all benegative.

**`odom_topic`**
- Type: `unknown`
- TypeDefaultstring“odom”DescriptionTopic to find robot odometry, if inCLOSED_LOOPoperational mode.

**`odom_duration`**
- Type: `unknown`
- TypeDefaultdouble0.1DescriptionTime (s) to buffer odometry commands to estimate the robot speed, if inCLOSED_LOOPoperational mode.

**`enable_stamped_cmd_vel`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to use geometry_msgs::msg::Twist or geometry_msgs::msg::TwistStamped velocity data.
True uses TwistStamped, false uses Twist.
Note: This parameter is defaultfalsein Jazzy or older! Kilted or newer usesTwistStampedby default.

**`stamp_smoothed_velocity_with_smoothing_time`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to interpolate the timestamps of the smoothedgeometery_msgs:msg::TwistStampedcmd_vel message after the last command velocity received. Only available in Jazzy as a backport of the now-default behavior in Lyrical and newer. Default isfalsefor backwards compatibility.

**`bond_heartbeat_period`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionThe lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.

**`allow_parameter_qos_overrides`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to allow QoS profiles to be overwritten with parameterized values.

**`Description`**
- Type: `unknown`
- Adds soft real-time prioritization to the controller server to better ensure resources to time sensitive portions of the codebase. This will set the controller’s execution thread to a higher priority than the rest of the system (90) to meet scheduling deadlines to have less missed loop rates. To use this feature, you use set the following inside of/etc/security/limits.confto give userspace access to elevated prioritization permissions:<username>softrtprio99<username>hardrtprio99

**`Description`**
- Type: `unknown`
- Frequency (Hz) to use the last received velocity command to smooth by velocity, acceleration, and deadband constraints. If set approximately to the rate of your local trajectory planner, it should smooth by acceleration constraints velocity commands. If set much higher, it will interpolate and provide a smooth set of commands to the hardware controller.

**`Description`**
- Type: `unknown`
- Whether or not to adjust other components of velocity proportionally to a component’s required changes due to acceleration limits. This will try to adjust all components to follow the same direction, but still enforces acceleration limits to guarantee compliance, even if it means deviating off commanded trajectory slightly.

**`Description`**
- Type: `unknown`
- Type of feedback to use for the current state of the robot’s velocity. InOPEN_LOOP, it will use the last commanded velocity as the next iteration’s current velocity. When acceleration limits are set appropriately, this is a good assumption. InCLOSED_LOOP, it will use the odometry from theodomtopic to estimate the robot’s current speed. In closed loop mode, it is important that the odometry is high rate and low latency, relative to the smoothing frequency.

**`Description`**
- Type: `unknown`
- Maximum velocities (m/s) in[x,y,theta]axes or[x,y,z,roll,pitch,yaw]for full 6-DoF support.

**`Description`**
- Type: `unknown`
- Minimum velocities (m/s) in[x,y,theta]axes or[x,y,z,roll,pitch,yaw]for full 6-DoF support. This issignedand thus must benegativeto reverse. Note: rotational velocities negative direction is a right-hand turn, so this should always be negative regardless of reversing preference.

**`Description`**
- Type: `unknown`
- Minimum velocities (m/s) in[x,y,theta]axes or[x,y,z,roll,pitch,yaw]for full 6-DoF support to send to the robot hardware controllers, to prevent small commands from damaging hardware controllers if that speed cannot be achieved due to stall torque.

**`Description`**
- Type: `unknown`
- Timeout (s) after which the velocity smoother will send a zero-ed outTwistcommand and stop publishing.

**`Description`**
- Type: `unknown`
- Maximum acceleration to apply to each axis[x,y,theta]or[x,y,z,roll,pitch,yaw]for full 6-DoF support.

**`Description`**
- Type: `unknown`
- Minimum acceleration to apply to each axis[x,y,theta]or[x,y,z,roll,pitch,yaw]for full 6-DoF support. This issignedand thus these should generally all benegative.

**`Description`**
- Type: `unknown`
- Topic to find robot odometry, if inCLOSED_LOOPoperational mode.

**`Description`**
- Type: `unknown`
- Time (s) to buffer odometry commands to estimate the robot speed, if inCLOSED_LOOPoperational mode.

**`Description`**
- Type: `unknown`
- Whether to use geometry_msgs::msg::Twist or geometry_msgs::msg::TwistStamped velocity data.
True uses TwistStamped, false uses Twist.
Note: This parameter is defaultfalsein Jazzy or older! Kilted or newer usesTwistStampedby default.

**`Description`**
- Type: `unknown`
- Whether to interpolate the timestamps of the smoothedgeometery_msgs:msg::TwistStampedcmd_vel message after the last command velocity received. Only available in Jazzy as a backport of the now-default behavior in Lyrical and newer. Default isfalsefor backwards compatibility.

**`Description`**
- Type: `unknown`
- The lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.

**`Description`**
- Type: `unknown`
- Whether to allow QoS profiles to be overwritten with parameterized values.


---

#### Waypoint Follower

*Source: [https://docs.nav2.org/configuration/packages/configuring-waypoint-follower.html](https://docs.nav2.org/configuration/packages/configuring-waypoint-follower.html)*

##### Waypoint Follower

Source code on [Github](https://github.com/ros-navigation/navigation2/tree/main/nav2_waypoint_follower).

The Waypoint Follower module implements a way of doing waypoint following using the NavigateToPose action server.
It will take in a set of ordered waypoints to follow and then try to navigate to them in order.
It also hosts a waypoint task executor plugin which can be used to perform custom behavior at a waypoint like waiting for user instruction, taking a picture, or picking up a box.
If a waypoint is not achievable, the `stop_on_failure` parameter will determine whether to continue to the next point or stop.

###### Parameters

stop\_on\_failure
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to fail action task if a single waypoint fails. If false, will continue to next waypoint.
```

loop\_rate
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 20 |
```

```
Description
:   Rate to check for results from current navigation task.
```

global\_frame\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | ‘map’ |
```

```
Description
:   The name of the global coordinate frame published by robot\_localization. Only used by the gps\_waypoint\_follower to
    convert GPS waypoints to this frame.
```

introspection\_mode
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “disabled” |
```

```
Description
:   The introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.
```

bond\_heartbeat\_period
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
Description
:   The lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.
```

allow\_parameter\_qos\_overrides
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to allow QoS profiles to be overwritten with parameterized values.
```

waypoint\_task\_executor\_plugin
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | ‘wait\_at\_waypoint’ |
```

```
Description
:   A plugin to define tasks to be executed when robot arrives to a waypoint.
```

```
Note
:   The plugin namespace defined needs to have a `plugin` parameter defining the type of plugin to be loaded in the namespace.
```

```
    Example:
```

        ```
        waypoint_follower:
          ros__parameters:
            waypoint_task_executor_plugin: "wait_at_waypoint"
            wait_at_waypoint:
              plugin: "nav2_waypoint_follower::WaitAtWaypoint"
              enabled: True
              waypoint_pause_duration: 0
        ```

###### Provided Plugins

> The plugins listed below are inside the `nav2_waypoint_follower` namespace.

* [WaitAtWaypoint](nav2_waypoint_follower-plugins/wait_at_waypoint.html)
* [PhotoAtWaypoint](nav2_waypoint_follower-plugins/photo_at_waypoint.html)
* [InputAtWaypoint](nav2_waypoint_follower-plugins/input_at_waypoint.html)

###### Default Plugin

> |  |  |
> | --- | --- |
> | Namespace | Plugin |
> | “wait\_at\_waypoint” | “nav2\_waypoint\_follower::WaitAtWaypoint” |

###### Example

```
waypoint_follower:
  ros__parameters:
    loop_rate: 20
    stop_on_failure: false
    waypoint_task_executor_plugin: "wait_at_waypoint"
    introspection_mode: "disabled"
      wait_at_waypoint:
        plugin: "nav2_waypoint_follower::WaitAtWaypoint"
        enabled: True
        waypoint_pause_duration: 0
```

#### Parameters

**`stop_on_failure`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to fail action task if a single waypoint fails. If false, will continue to next waypoint.

**`loop_rate`**
- Type: `unknown`
- TypeDefaultint20DescriptionRate to check for results from current navigation task.

**`global_frame_id`**
- Type: `unknown`
- TypeDefaultstring‘map’DescriptionThe name of the global coordinate frame published by robot_localization. Only used by the gps_waypoint_follower to
convert GPS waypoints to this frame.

**`introspection_mode`**
- Type: `unknown`
- TypeDefaultstring“disabled”DescriptionThe introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.

**`bond_heartbeat_period`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionThe lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.

**`allow_parameter_qos_overrides`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to allow QoS profiles to be overwritten with parameterized values.

**`waypoint_task_executor_plugin`**
- Type: `unknown`
- TypeDefaultstring‘wait_at_waypoint’DescriptionA plugin to define tasks to be executed when robot arrives to a waypoint.NoteThe plugin namespace defined needs to have apluginparameter defining the type of plugin to be loaded in the namespace.Example:waypoint_follower:ros__parameters:waypoint_task_executor_plugin:"wait_at_waypoint"wait_at_waypoint:plugin:"nav2_waypoint_follower::WaitAtWaypoint"enabled:Truewaypoint_pause_duration:0

**`Description`**
- Type: `unknown`
- Whether to fail action task if a single waypoint fails. If false, will continue to next waypoint.

**`Description`**
- Type: `unknown`
- Rate to check for results from current navigation task.

**`Description`**
- Type: `unknown`
- The name of the global coordinate frame published by robot_localization. Only used by the gps_waypoint_follower to
convert GPS waypoints to this frame.

**`Description`**
- Type: `unknown`
- The introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.

**`Description`**
- Type: `unknown`
- The lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.

**`Description`**
- Type: `unknown`
- Whether to allow QoS profiles to be overwritten with parameterized values.

**`Description`**
- Type: `unknown`
- A plugin to define tasks to be executed when robot arrives to a waypoint.

**`Note`**
- Type: `unknown`
- The plugin namespace defined needs to have apluginparameter defining the type of plugin to be loaded in the namespace.Example:waypoint_follower:ros__parameters:waypoint_task_executor_plugin:"wait_at_waypoint"wait_at_waypoint:plugin:"nav2_waypoint_follower::WaitAtWaypoint"enabled:Truewaypoint_pause_duration:0

**`“wait_at_waypoint”`**
- Type: `unknown`
- 


---

#### Bt Plugins

##### Actions

###### AppendGoalPoseToGoals

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/AppendGoalPoseToGoals.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/AppendGoalPoseToGoals.html)*

###### AppendGoalPoseToGoals

Appends a goal `PoseStamped` to the end of a `goals` vector.
May be useful to add in the final task goal pose to a list of goals extracted from Route nodes (or other sources of future goals).

###### Input Ports

goal\_pose
:   |  |  |
```
| --- | --- |
| Type | Default |
| geometry\_msgs/PoseStamped | N/A |
```

```
Description
:   Goal pose to append to the `goals` vector.
```

input\_goals
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs/Goals | N/A |
```

```
Description
:   Input goals vector to append to.
```

###### Output Ports

output\_goals
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs/Goals | N/A |
```

```
Description
:   Output goals vector appended to.
```

###### Example

```
<AppendGoalPoseToGoals goal_pose="{goal}" input_goals="{goal_poses}" output_goals="{goal_poses}"/>
```

#### Parameters

**`goal_pose`**
- Type: `unknown`
- TypeDefaultgeometry_msgs/PoseStampedN/ADescriptionGoal pose to append to thegoalsvector.

**`input_goals`**
- Type: `unknown`
- TypeDefaultnav_msgs/GoalsN/ADescriptionInput goals vector to append to.

**`Description`**
- Type: `unknown`
- Goal pose to append to thegoalsvector.

**`Description`**
- Type: `unknown`
- Input goals vector to append to.

**`output_goals`**
- Type: `unknown`
- TypeDefaultnav_msgs/GoalsN/ADescriptionOutput goals vector appended to.

**`Description`**
- Type: `unknown`
- Output goals vector appended to.


---

###### AssistedTeleop

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/AssistedTeleop.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/AssistedTeleop.html)*

###### AssistedTeleop

Invokes the AssistedTeleop ROS 2 action server, which filters teleop twist commands to prevent
collisions. This is used in nav2 Behavior Trees as a recovery behavior or a regular behavior.
The [nav2\_behaviors](https://github.com/ros-navigation/navigation2/tree/main/nav2_behaviors) module implements the AssistedTeleop action server.

###### Input Ports

is\_recovery
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | false |
```

```
Description
:   If true increment the recovery counter.
```

time\_allowance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10.0 |
```

```
Description
:   Time to invoke behavior for, if exceeds considers it a stuck condition or failure case (seconds).
```

server\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Action server name.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10 |
```

```
Description
:   Action server timeout (ms).
```

error\_code\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| uint16 | N/A |
```

```
Description
:   Assisted teleop error code. See `AssistedTeleop` action message for the enumerated set of error codes.
```

error\_msg
:   |  |  |
```
| --- | --- |
| Type | Default |
| uint16 | N/A |
```

```
Description
:   Assisted teleop error message. See `AssistedTeleop` action message for the enumerated set of error codes.
```

###### Example

```
<AssistedTeleop is_recovery="false" server_name="assisted_teleop_server" server_timeout="10"
                error_code_id="{assisted_teleop_error_code}" error_msg="{assisted_teleop_error_msg}"/>
```

#### Parameters

**`is_recovery`**
- Type: `unknown`
- TypeDefaultdoublefalseDescriptionIf true increment the recovery counter.

**`time_allowance`**
- Type: `unknown`
- TypeDefaultdouble10.0DescriptionTime to invoke behavior for, if exceeds considers it a stuck condition or failure case (seconds).

**`server_name`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionAction server name.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble10DescriptionAction server timeout (ms).

**`error_code_id`**
- Type: `unknown`
- TypeDefaultuint16N/ADescriptionAssisted teleop error code. SeeAssistedTeleopaction message for the enumerated set of error codes.

**`error_msg`**
- Type: `unknown`
- TypeDefaultuint16N/ADescriptionAssisted teleop error message. SeeAssistedTeleopaction message for the enumerated set of error codes.

**`Description`**
- Type: `unknown`
- If true increment the recovery counter.

**`Description`**
- Type: `unknown`
- Time to invoke behavior for, if exceeds considers it a stuck condition or failure case (seconds).

**`Description`**
- Type: `unknown`
- Action server name.

**`Description`**
- Type: `unknown`
- Action server timeout (ms).

**`Description`**
- Type: `unknown`
- Assisted teleop error code. SeeAssistedTeleopaction message for the enumerated set of error codes.

**`Description`**
- Type: `unknown`
- Assisted teleop error message. SeeAssistedTeleopaction message for the enumerated set of error codes.


---

###### BackUp

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/BackUp.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/BackUp.html)*

###### BackUp

Invokes the BackUp ROS 2 action server, which causes the robot to back up by a specific displacement.
It performs an linear translation by a given distance.
This is used in nav2 Behavior Trees as a recovery behavior. The nav2\_behaviors module implements the BackUp action server.

###### Input Ports

backup\_dist
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | -0.15 |
```

```
Description
:   Total distance to backup (m).
```

backup\_speed
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.025 |
```

```
Description
:   Backup speed (m/s).
```

time\_allowance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10.0 |
```

```
Description
:   Time to invoke behavior for, if exceeds considers it a stuck condition or failure case (seconds).
```

server\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Action server name.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10 |
```

```
Description
:   Action server timeout (ms).
```

disable\_collision\_checks
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Disable collision checking.
```

###### Output Ports

error\_code\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| uint16 | N/A |
```

```
Description
:   Backup error code. See `BackUp` action message for the enumerated set of error codes.
```

error\_msg
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Backup error message. See `BackUp` action message for the enumerated set of error codes.
```

###### Example

```
<BackUp backup_dist="-0.2" backup_speed="0.05" server_name="backup_server" server_timeout="10" disable_collision_checks="false"
        error_code_id="{backup_error_code}" error_msg="{backup_error_msg}"/>
```

#### Parameters

**`backup_dist`**
- Type: `unknown`
- TypeDefaultdouble-0.15DescriptionTotal distance to backup (m).

**`backup_speed`**
- Type: `unknown`
- TypeDefaultdouble0.025DescriptionBackup speed (m/s).

**`time_allowance`**
- Type: `unknown`
- TypeDefaultdouble10.0DescriptionTime to invoke behavior for, if exceeds considers it a stuck condition or failure case (seconds).

**`server_name`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionAction server name.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble10DescriptionAction server timeout (ms).

**`disable_collision_checks`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionDisable collision checking.

**`Description`**
- Type: `unknown`
- Total distance to backup (m).

**`Description`**
- Type: `unknown`
- Backup speed (m/s).

**`Description`**
- Type: `unknown`
- Time to invoke behavior for, if exceeds considers it a stuck condition or failure case (seconds).

**`Description`**
- Type: `unknown`
- Action server name.

**`Description`**
- Type: `unknown`
- Action server timeout (ms).

**`Description`**
- Type: `unknown`
- Disable collision checking.

**`error_code_id`**
- Type: `unknown`
- TypeDefaultuint16N/ADescriptionBackup error code. SeeBackUpaction message for the enumerated set of error codes.

**`error_msg`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionBackup error message. SeeBackUpaction message for the enumerated set of error codes.

**`Description`**
- Type: `unknown`
- Backup error code. SeeBackUpaction message for the enumerated set of error codes.

**`Description`**
- Type: `unknown`
- Backup error message. SeeBackUpaction message for the enumerated set of error codes.


---

###### CancelAssistedTeleop

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/CancelAssistedTeleop.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/CancelAssistedTeleop.html)*

###### CancelAssistedTeleop

Used to cancel the AssistedTeleop action that is part of the behavior server. The server address can be remapped using the `server_name` input port.

###### Input Ports

service\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Service name, if not using default of `assisted_teleop` due to remapping.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10 |
```

```
Description
:   Server timeout (ms).
```

###### Example

```
<CancelAssistedTeleop server_name="assisted_teleop" server_timeout="10"/>
```

#### Parameters

**`service_name`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionService name, if not using default ofassisted_teleopdue to remapping.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble10DescriptionServer timeout (ms).

**`Description`**
- Type: `unknown`
- Service name, if not using default ofassisted_teleopdue to remapping.

**`Description`**
- Type: `unknown`
- Server timeout (ms).


---

###### CancelBackUp

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/CancelBackUp.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/CancelBackUp.html)*

###### CancelBackUp

Used to cancel the backup action that is part of the behavior server. The server address can be remapped using the `server_name` input port.

###### Input Ports

service\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Service name, if not using default of `backup` due to remapping.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10 |
```

```
Description
:   Server timeout (ms).
```

###### Example

```
<CancelBackUp server_name="BackUp" server_timeout="10"/>
```

#### Parameters

**`service_name`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionService name, if not using default ofbackupdue to remapping.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble10DescriptionServer timeout (ms).

**`Description`**
- Type: `unknown`
- Service name, if not using default ofbackupdue to remapping.

**`Description`**
- Type: `unknown`
- Server timeout (ms).


---

###### CancelComputeAndTrackRoute

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/CancelComputeAndTrackRoute.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/CancelComputeAndTrackRoute.html)*

###### CancelComputeAndTrackRoute

Used to cancel the compute and track route action that is part of the behavior server. The server address can be remapped using the `server_name` input port.

###### Input Ports

service\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Service name, if not using default of `compute_and_track_route` due to remapping.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10 |
```

```
Description
:   Server timeout (ms).
```

###### Example

```
<CancelComputeAndTrackRoute server_name="compute_and_track_route" server_timeout="10"/>
```

#### Parameters

**`service_name`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionService name, if not using default ofcompute_and_track_routedue to remapping.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble10DescriptionServer timeout (ms).

**`Description`**
- Type: `unknown`
- Service name, if not using default ofcompute_and_track_routedue to remapping.

**`Description`**
- Type: `unknown`
- Server timeout (ms).


---

###### CancelControl

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/CancelControl.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/CancelControl.html)*

###### CancelControl

Used to cancel the goals given to the controllers’ action server. The server address can be remapped using the `server_name` input port.

###### Input Ports

service\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Service name.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10 |
```

```
Description
:   Server timeout (ms).
```

###### Example

```
<CancelControl server_name="FollowPath" server_timeout="10"/>
```

#### Parameters

**`service_name`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionService name.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble10DescriptionServer timeout (ms).

**`Description`**
- Type: `unknown`
- Service name.

**`Description`**
- Type: `unknown`
- Server timeout (ms).


---

###### CancelCoverage

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/CancelCoverage.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/CancelCoverage.html)*

###### CancelCoverage

Used to cancel the goals given to the complete coverage action server. The server address can be remapped using the `server_name` input port.

###### Input Ports

service\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Service name.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10 |
```

```
Description
:   Server timeout (ms).
```

###### Example

```
<CancelCoverage server_name="compute_complete_coverage" server_timeout="10"/>
```

#### Parameters

**`service_name`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionService name.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble10DescriptionServer timeout (ms).

**`Description`**
- Type: `unknown`
- Service name.

**`Description`**
- Type: `unknown`
- Server timeout (ms).


---

###### CancelDriveOnHeading

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/CancelDriveOnHeading.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/CancelDriveOnHeading.html)*

###### CancelDriveOnHeading

Used to cancel the drive on heading action that is part of the behavior server. The server address can be remapped using the `server_name` input port.

###### Input Ports

service\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Service name, if not using default of `drive_on_heading` due to remapping.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10 |
```

```
Description
:   Server timeout (ms).
```

###### Example

```
<CancelDriveOnHeading server_name="drive_on_heading" server_timeout="10"/>
```

#### Parameters

**`service_name`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionService name, if not using default ofdrive_on_headingdue to remapping.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble10DescriptionServer timeout (ms).

**`Description`**
- Type: `unknown`
- Service name, if not using default ofdrive_on_headingdue to remapping.

**`Description`**
- Type: `unknown`
- Server timeout (ms).


---

###### CancelFollowObject

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/CancelFollowObject.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/CancelFollowObject.html)*

###### CancelFollowObject

Used to cancel the goals given to the follow object action server. The server address can be remapped using the `server_name` input port.

###### Input Ports

service\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Service name.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10 |
```

```
Description
:   Server timeout (ms).
```

###### Example

```
<CancelFollowObject server_name="follow_object" server_timeout="10"/>
```

#### Parameters

**`service_name`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionService name.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble10DescriptionServer timeout (ms).

**`Description`**
- Type: `unknown`
- Service name.

**`Description`**
- Type: `unknown`
- Server timeout (ms).


---

###### CancelSpin

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/CancelSpin.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/CancelSpin.html)*

###### CancelSpin

Used to cancel the spin action that is part of the behavior server. The server address can be remapped using the `server_name` input port.

###### Input Ports

service\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Service name, if not using default of `spin` due to remapping.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10 |
```

```
Description
:   Server timeout (ms).
```

###### Example

```
<CancelSpin server_name="Spin" server_timeout="10"/>
```

#### Parameters

**`service_name`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionService name, if not using default ofspindue to remapping.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble10DescriptionServer timeout (ms).

**`Description`**
- Type: `unknown`
- Service name, if not using default ofspindue to remapping.

**`Description`**
- Type: `unknown`
- Server timeout (ms).


---

###### CancelWait

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/CancelWait.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/CancelWait.html)*

###### CancelWait

Used to cancel the wait action that is part of the behavior server. The server address can be remapped using the `server_name` input port.

###### Input Ports

service\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Service name, if not using default of `wait` due to remapping.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10 |
```

```
Description
:   Server timeout (ms).
```

###### Example

```
<CancelWait server_name="Wait" server_timeout="10"/>
```

#### Parameters

**`service_name`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionService name, if not using default ofwaitdue to remapping.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble10DescriptionServer timeout (ms).

**`Description`**
- Type: `unknown`
- Service name, if not using default ofwaitdue to remapping.

**`Description`**
- Type: `unknown`
- Server timeout (ms).


---

###### ClearCostmapAroundPose

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/ClearCostmapAroundPose.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/ClearCostmapAroundPose.html)*

###### ClearCostmapAroundPose

Action to call a costmap clearing around a given pose server.

###### Input Ports

pose
:   |  |  |
```
| --- | --- |
| Type | Default |
| geometry\_msgs::msg::PoseStamped | N/A |
```

```
Description
:   Pose around which to clear the costmap
```

reset\_distance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   Distance from the pose under which obstacles are cleared
```

service\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   costmap service name responsible for clearing the costmap.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10 |
```

```
Description
:   Action server timeout (ms).
```

###### Example

```
<ClearCostmapAroundPose name="ClearLocalCostmapAroundPose"
                        service_name="local_costmap/clear_around_pose_local_costmap"
                        pose="{goal_pose}"
                        reset_distance="2.0"/>
```

#### Parameters

**`pose`**
- Type: `unknown`
- TypeDefaultgeometry_msgs::msg::PoseStampedN/ADescriptionPose around which to clear the costmap

**`reset_distance`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionDistance from the pose under which obstacles are cleared

**`service_name`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptioncostmap service name responsible for clearing the costmap.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble10DescriptionAction server timeout (ms).

**`Description`**
- Type: `unknown`
- Pose around which to clear the costmap

**`Description`**
- Type: `unknown`
- Distance from the pose under which obstacles are cleared

**`Description`**
- Type: `unknown`
- costmap service name responsible for clearing the costmap.

**`Description`**
- Type: `unknown`
- Action server timeout (ms).


---

###### ClearCostmapAroundRobot

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/ClearCostmapAroundRobot.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/ClearCostmapAroundRobot.html)*

###### ClearCostmapAroundRobot

Action to call a costmap clearing around robot server.

###### Input Ports

reset\_distance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1 |
```

```
Description
:   side size of the square area centered on the robot that will be cleared on the costmap (the rest of the costmap won’t)
```

service\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   costmap service name responsible for clearing the costmap.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10 |
```

```
Description
:   Action server timeout (ms).
```

###### Example

```
<ClearCostmapAroundRobot name="ClearLocalCostmap-Subtree" service_name="local_costmap/clear_around_local_costmap"/>
```

#### Parameters

**`reset_distance`**
- Type: `unknown`
- TypeDefaultdouble1Descriptionside size of the square area centered on the robot that will be cleared on the costmap (the rest of the costmap won’t)

**`service_name`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptioncostmap service name responsible for clearing the costmap.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble10DescriptionAction server timeout (ms).

**`Description`**
- Type: `unknown`
- side size of the square area centered on the robot that will be cleared on the costmap (the rest of the costmap won’t)

**`Description`**
- Type: `unknown`
- costmap service name responsible for clearing the costmap.

**`Description`**
- Type: `unknown`
- Action server timeout (ms).


---

###### ClearCostmapExceptRegion

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/ClearCostmapExceptRegion.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/ClearCostmapExceptRegion.html)*

###### ClearCostmapExceptRegion

Action to call a costmap clearing except region server.

###### Input Ports

reset\_distance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1 |
```

```
Description
:   side size of the square area centered on the robot that will not be cleared on the costmap (all the rest of the costmap will)
```

service\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   costmap service name responsible for clearing the costmap.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10 |
```

```
Description
:   Action server timeout (ms).
```

###### Example

```
<ClearCostmapExceptRegion name="ClearLocalCostmap-Subtree" service_name="local_costmap/clear_except_local_costmap"/>
```

#### Parameters

**`reset_distance`**
- Type: `unknown`
- TypeDefaultdouble1Descriptionside size of the square area centered on the robot that will not be cleared on the costmap (all the rest of the costmap will)

**`service_name`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptioncostmap service name responsible for clearing the costmap.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble10DescriptionAction server timeout (ms).

**`Description`**
- Type: `unknown`
- side size of the square area centered on the robot that will not be cleared on the costmap (all the rest of the costmap will)

**`Description`**
- Type: `unknown`
- costmap service name responsible for clearing the costmap.

**`Description`**
- Type: `unknown`
- Action server timeout (ms).


---

###### ClearEntireCostmap

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/ClearEntireCostmap.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/ClearEntireCostmap.html)*

###### ClearEntireCostmap

Action to call a costmap clearing server.

###### Input Ports

service\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   costmap service name responsible for clearing the costmap.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10 |
```

```
Description
:   Action server timeout (ms).
```

###### Example

```
<ClearEntireCostmap name="ClearLocalCostmap-Subtree" service_name="local_costmap/clear_entirely_local_costmap"/>
```

#### Parameters

**`service_name`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptioncostmap service name responsible for clearing the costmap.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble10DescriptionAction server timeout (ms).

**`Description`**
- Type: `unknown`
- costmap service name responsible for clearing the costmap.

**`Description`**
- Type: `unknown`
- Action server timeout (ms).


---

###### ComputeAndTrackRoute

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/ComputeAndTrackRoute.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/ComputeAndTrackRoute.html)*

###### ComputeAndTrackRoute

Invokes the ComputeAndTrackRoute ROS 2 action server, which is implemented by the [nav2\_route](https://github.com/ros-navigation/navigation2/tree/main/nav2_route) module.
The server address can be remapped using the `server_name` input port.

###### Input Ports

start
:   |  |  |
```
| --- | --- |
| Type | Default |
| geometry\_msgs::msg::PoseStamped | N/A |
```

```
Description
:   Start pose. Optional. Only used if not left empty. Takes in a blackboard variable, e.g. “{start}”.
```

goal
:   |  |  |
```
| --- | --- |
| Type | Default |
| geometry\_msgs::msg::PoseStamped | N/A |
```

```
Description
:   Goal pose. Takes in a blackboard variable, e.g. “{goal}”.
```

start\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | N/A |
```

```
Description
:   Start node ID to use.
```

goal\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | N/A |
```

```
Description
:   Goal node ID to use.
```

use\_start
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to use the start or use TF to obtain the robot’s start pose.
```

use\_poses
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to use the start and goal poses or start and goal node IDs.
```

server\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Action server name.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10 |
```

```
Description
:   Action server timeout (ms).
```

###### Output Ports

execution\_time
:   |  |  |
```
| --- | --- |
| Type | Default |
| builtin\_interfaces::msg::Duration | N/A |
```

```
Description
:   Time it took to compute the route.
```

error\_code\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| uint16 | N/A |
```

```
Description
:   Compute route error code. See `ComputeAndTrackRoute` action message for the enumerated set of error codes.
```

error\_msg
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Compute route error message. See `ComputeAndTrackRoute` action message for the enumerated set of error codes.
```

###### Example

```
<ComputeAndTrackRoute start="{start}" goal="{goal}" use_poses="{true}" use_start="{true}" server_name="ComputeAndTrackRoute" server_timeout="10"
                   error_code_id="{compute_route_error_code}" error_msg="{compute_route_error_msg}"/>
```

#### Parameters

**`start`**
- Type: `unknown`
- TypeDefaultgeometry_msgs::msg::PoseStampedN/ADescriptionStart pose. Optional. Only used if not left empty. Takes in a blackboard variable, e.g. “{start}”.

**`goal`**
- Type: `unknown`
- TypeDefaultgeometry_msgs::msg::PoseStampedN/ADescriptionGoal pose. Takes in a blackboard variable, e.g. “{goal}”.

**`start_id`**
- Type: `unknown`
- TypeDefaultintN/ADescriptionStart node ID to use.

**`goal_id`**
- Type: `unknown`
- TypeDefaultintN/ADescriptionGoal node ID to use.

**`use_start`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to use the start or use TF to obtain the robot’s start pose.

**`use_poses`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to use the start and goal poses or start and goal node IDs.

**`server_name`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionAction server name.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble10DescriptionAction server timeout (ms).

**`Description`**
- Type: `unknown`
- Start pose. Optional. Only used if not left empty. Takes in a blackboard variable, e.g. “{start}”.

**`Description`**
- Type: `unknown`
- Goal pose. Takes in a blackboard variable, e.g. “{goal}”.

**`Description`**
- Type: `unknown`
- Start node ID to use.

**`Description`**
- Type: `unknown`
- Goal node ID to use.

**`Description`**
- Type: `unknown`
- Whether to use the start or use TF to obtain the robot’s start pose.

**`Description`**
- Type: `unknown`
- Whether to use the start and goal poses or start and goal node IDs.

**`Description`**
- Type: `unknown`
- Action server name.

**`Description`**
- Type: `unknown`
- Action server timeout (ms).

**`execution_time`**
- Type: `unknown`
- TypeDefaultbuiltin_interfaces::msg::DurationN/ADescriptionTime it took to compute the route.

**`error_code_id`**
- Type: `unknown`
- TypeDefaultuint16N/ADescriptionCompute route error code. SeeComputeAndTrackRouteaction message for the enumerated set of error codes.

**`error_msg`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionCompute route error message. SeeComputeAndTrackRouteaction message for the enumerated set of error codes.

**`Description`**
- Type: `unknown`
- Time it took to compute the route.

**`Description`**
- Type: `unknown`
- Compute route error code. SeeComputeAndTrackRouteaction message for the enumerated set of error codes.

**`Description`**
- Type: `unknown`
- Compute route error message. SeeComputeAndTrackRouteaction message for the enumerated set of error codes.


---

###### ComputeCoveragePath

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/ComputeCoveragePath.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/ComputeCoveragePath.html)*

###### ComputeCoveragePath

Invokes the ComputeCoveragePath ROS 2 action server, which is implemented by the [opennav\_coverage](https://github.com/open-navigation/opennav_coverage) server module.
The server address can be remapped using the `server_name` input port.
This server can take in both cartesian and GPS coordinates and is implemented using the `Fields2Cover` library.

###### Input Ports

generate\_headland
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether or not to generate a headland of the field or polygon to compute coverage of
```

generate\_route
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether or not to generate a route, e.g. an ordered set of swaths
```

generate\_path
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether or not to generate a path, e.g. adding path connectors to the ordered route
```

file\_field
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   The filepath to the field’s GML file to use, if not specifying the field via `polygons`
```

file\_field\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 0 |
```

```
Description
:   The ID of the field in the GML File to use, if multiple exist in the same file. This is the ordered number of the fields in the file.
```

polygons
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<geometry\_msgs::msg::Polygon> | N/A |
```

```
Description
:   The polygons of the field, if not specifying via a GML file. The first polygon should be the outermost region, whereas additional polygons are voids.
```

polygons\_frame\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “map” |
```

```
Description
:   The polygon’s frame ID, since the GML file provides the frame ID for its format, this is the frame ID for user-defined input `polygons`.
```

###### Output Ports

nav\_path
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs::msg::Path | N/A |
```

```
Description
:   Path created by action server in the form of a navigation path. Takes in a blackboard variable, e.g. “{path}”.
```

coverage\_path
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<PathComponents> | N/A |
```

```
Description
:   An ordered set of swaths and turns corresponding to the coverage path when its important to distinguish between turns and swaths for applications. A `opennav_coverage::utils::PathComponentsIterator` object is provided to help make this easy to use by iterating through the outputs’s path components to return you the next swath and turn one at a time.
```

error\_code\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| uint16 | N/A |
```

```
Description
:   Compute coverage error code. See `ComputeCoveragePath` action message for the enumerated set of error codes.
```

error\_msg
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Compute coverage error message. See `ComputeCoveragePath` action message for the enumerated set of error codes.
```

###### Example

```
<ComputeCoveragePath file_field="{field_filepath}" nav_path="{path}" coverage_path="{cov_path}" server_name="ComputeCoverage" server_timeout="10" error_code_id="{compute_coverage_error_code}" error_msg="{compute_coverage_error_msg}"/>
```

Note: the blackboard IDs for the path, error code, and more may be adjusted, but need to match the corresponding parameters in the `CoverageNavigator` plugin to set on the blackboard for use from the action server.

#### Parameters

**`generate_headland`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether or not to generate a headland of the field or polygon to compute coverage of

**`generate_route`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether or not to generate a route, e.g. an ordered set of swaths

**`generate_path`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether or not to generate a path, e.g. adding path connectors to the ordered route

**`file_field`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionThe filepath to the field’s GML file to use, if not specifying the field viapolygons

**`file_field_id`**
- Type: `unknown`
- TypeDefaultint0DescriptionThe ID of the field in the GML File to use, if multiple exist in the same file. This is the ordered number of the fields in the file.

**`polygons`**
- Type: `unknown`
- TypeDefaultvector<geometry_msgs::msg::Polygon>N/ADescriptionThe polygons of the field, if not specifying via a GML file. The first polygon should be the outermost region, whereas additional polygons are voids.

**`polygons_frame_id`**
- Type: `unknown`
- TypeDefaultstring“map”DescriptionThe polygon’s frame ID, since the GML file provides the frame ID for its format, this is the frame ID for user-defined inputpolygons.

**`Description`**
- Type: `unknown`
- Whether or not to generate a headland of the field or polygon to compute coverage of

**`Description`**
- Type: `unknown`
- Whether or not to generate a route, e.g. an ordered set of swaths

**`Description`**
- Type: `unknown`
- Whether or not to generate a path, e.g. adding path connectors to the ordered route

**`Description`**
- Type: `unknown`
- The filepath to the field’s GML file to use, if not specifying the field viapolygons

**`Description`**
- Type: `unknown`
- The ID of the field in the GML File to use, if multiple exist in the same file. This is the ordered number of the fields in the file.

**`Description`**
- Type: `unknown`
- The polygons of the field, if not specifying via a GML file. The first polygon should be the outermost region, whereas additional polygons are voids.

**`Description`**
- Type: `unknown`
- The polygon’s frame ID, since the GML file provides the frame ID for its format, this is the frame ID for user-defined inputpolygons.

**`nav_path`**
- Type: `unknown`
- TypeDefaultnav_msgs::msg::PathN/ADescriptionPath created by action server in the form of a navigation path. Takes in a blackboard variable, e.g. “{path}”.

**`coverage_path`**
- Type: `unknown`
- TypeDefaultvector<PathComponents>N/ADescriptionAn ordered set of swaths and turns corresponding to the coverage path when its important to distinguish between turns and swaths for applications. Aopennav_coverage::utils::PathComponentsIteratorobject is provided to help make this easy to use by iterating through the outputs’s path components to return you the next swath and turn one at a time.

**`error_code_id`**
- Type: `unknown`
- TypeDefaultuint16N/ADescriptionCompute coverage error code. SeeComputeCoveragePathaction message for the enumerated set of error codes.

**`error_msg`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionCompute coverage error message. SeeComputeCoveragePathaction message for the enumerated set of error codes.

**`Description`**
- Type: `unknown`
- Path created by action server in the form of a navigation path. Takes in a blackboard variable, e.g. “{path}”.

**`Description`**
- Type: `unknown`
- An ordered set of swaths and turns corresponding to the coverage path when its important to distinguish between turns and swaths for applications. Aopennav_coverage::utils::PathComponentsIteratorobject is provided to help make this easy to use by iterating through the outputs’s path components to return you the next swath and turn one at a time.

**`Description`**
- Type: `unknown`
- Compute coverage error code. SeeComputeCoveragePathaction message for the enumerated set of error codes.

**`Description`**
- Type: `unknown`
- Compute coverage error message. SeeComputeCoveragePathaction message for the enumerated set of error codes.


---

###### ComputePathThroughPoses

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/ComputePathThroughPoses.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/ComputePathThroughPoses.html)*

###### ComputePathThroughPoses

Invokes the ComputePathThroughPoses ROS 2 action server, which is implemented by the [nav2\_planner](https://github.com/ros-navigation/navigation2/tree/main/nav2_planner) module.
The server address can be remapped using the `server_name` input port.

###### Input Ports

start
:   |  |  |
```
| --- | --- |
| Type | Default |
| geometry\_msgs::msg::PoseStamped | N/A |
```

```
Description
:   Start pose. Optional. Only used if not left empty. Takes in a blackboard variable, e.g. “{start}”.
```

goals
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs::msg::Goals | N/A |
```

```
Description
:   Goal poses. Takes in a blackboard variable, e.g. “{goals}”.
```

planner\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Mapped name to the planner plugin type to use, e.g. GridBased.
```

server\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Action server name.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10 |
```

```
Description
:   Action server timeout (ms).
```

###### Output Ports

path
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs::msg::Path | N/A |
```

```
Description
:   Path created by action server. Takes in a blackboard variable, e.g. “{path}”.
```

last\_reached\_index
:   |  |  |
```
| --- | --- |
| Type | Default |
| int16 | -1 |
```

```
Description
:   In the case of a partial plan, index of the last reached pose from the goals list. Otherwise -1 which also corresponds to ComputePathThroughPosesResult::ALL\_GOALS if a full plan through all the goals was possible.
```

error\_code\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| uint16 | N/A |
```

```
Description
:   Compute path through poses error code. See `ComputePathThroughPoses` action message for the enumerated set of error codes.
```

error\_msg
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Compute path through poses error message. See `ComputePathThroughPoses` action message for the enumerated set of error codes.
```

###### Example

```
<ComputePathThroughPoses goals="{goals}" path="{path}" planner_id="GridBased" server_name="ComputePathThroughPoses" server_timeout="10" error_code_id="{compute_path_error_code}" error_msg="{compute_path_error_msg}"/>
```

#### Parameters

**`start`**
- Type: `unknown`
- TypeDefaultgeometry_msgs::msg::PoseStampedN/ADescriptionStart pose. Optional. Only used if not left empty. Takes in a blackboard variable, e.g. “{start}”.

**`goals`**
- Type: `unknown`
- TypeDefaultnav_msgs::msg::GoalsN/ADescriptionGoal poses. Takes in a blackboard variable, e.g. “{goals}”.

**`planner_id`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionMapped name to the planner plugin type to use, e.g. GridBased.

**`server_name`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionAction server name.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble10DescriptionAction server timeout (ms).

**`Description`**
- Type: `unknown`
- Start pose. Optional. Only used if not left empty. Takes in a blackboard variable, e.g. “{start}”.

**`Description`**
- Type: `unknown`
- Goal poses. Takes in a blackboard variable, e.g. “{goals}”.

**`Description`**
- Type: `unknown`
- Mapped name to the planner plugin type to use, e.g. GridBased.

**`Description`**
- Type: `unknown`
- Action server name.

**`Description`**
- Type: `unknown`
- Action server timeout (ms).

**`path`**
- Type: `unknown`
- TypeDefaultnav_msgs::msg::PathN/ADescriptionPath created by action server. Takes in a blackboard variable, e.g. “{path}”.

**`last_reached_index`**
- Type: `unknown`
- TypeDefaultint16-1DescriptionIn the case of a partial plan, index of the last reached pose from the goals list. Otherwise -1 which also corresponds to ComputePathThroughPosesResult::ALL_GOALS if a full plan through all the goals was possible.

**`error_code_id`**
- Type: `unknown`
- TypeDefaultuint16N/ADescriptionCompute path through poses error code. SeeComputePathThroughPosesaction message for the enumerated set of error codes.

**`error_msg`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionCompute path through poses error message. SeeComputePathThroughPosesaction message for the enumerated set of error codes.

**`Description`**
- Type: `unknown`
- Path created by action server. Takes in a blackboard variable, e.g. “{path}”.

**`Description`**
- Type: `unknown`
- In the case of a partial plan, index of the last reached pose from the goals list. Otherwise -1 which also corresponds to ComputePathThroughPosesResult::ALL_GOALS if a full plan through all the goals was possible.

**`Description`**
- Type: `unknown`
- Compute path through poses error code. SeeComputePathThroughPosesaction message for the enumerated set of error codes.

**`Description`**
- Type: `unknown`
- Compute path through poses error message. SeeComputePathThroughPosesaction message for the enumerated set of error codes.


---

###### ComputePathToPose

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/ComputePathToPose.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/ComputePathToPose.html)*

###### ComputePathToPose

Invokes the ComputePathToPose ROS 2 action server, which is implemented by the [nav2\_planner](https://github.com/ros-navigation/navigation2/tree/main/nav2_planner) module.
The server address can be remapped using the `server_name` input port.

###### Input Ports

start
:   |  |  |
```
| --- | --- |
| Type | Default |
| geometry\_msgs::msg::PoseStamped | N/A |
```

```
Description
:   Start pose. Optional. Used as the planner start pose instead of the current robot pose, if `use_start` is not false (i.e. not provided or set to true). Takes in a blackboard variable, e.g. “{start}”.
```

use\_start
:   |  |  |
```
| --- | --- |
| Type | Default |
| geometry\_msgs::msg::PoseStamped | N/A |
```

```
Description
:   Optional. For using or not using (i.e. ignoring) the provided start pose `start`. Takes in a blackboard variable, e.g. “{use\_start}”.
```

goal
:   |  |  |
```
| --- | --- |
| Type | Default |
| geometry\_msgs::msg::PoseStamped | N/A |
```

```
Description
:   Goal pose. Takes in a blackboard variable, e.g. “{goal}”.
```

planner\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Mapped name to the planner plugin type to use, e.g. GridBased.
```

server\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Action server name.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10 |
```

```
Description
:   Action server timeout (ms).
```

###### Output Ports

path
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs::msg::Path | N/A |
```

```
Description
:   Path created by action server. Takes in a blackboard variable, e.g. “{path}”.
```

error\_code\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| uint16 | N/A |
```

```
Description
:   Compute path to pose error code. See `ComputePathToPose` action message for the enumerated set of error codes.
```

error\_msg
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Compute path to pose error message. See `ComputePathToPose` action message for the enumerated set of error codes.
```

###### Example

```
<ComputePathToPose goal="{goal}" path="{path}" planner_id="GridBased" server_name="ComputePathToPose" server_timeout="10"
                   error_code_id="{compute_path_error_code}" error_msg="{compute_path_error_msg}"/>
```

#### Parameters

**`start`**
- Type: `unknown`
- TypeDefaultgeometry_msgs::msg::PoseStampedN/ADescriptionStart pose. Optional. Used as the planner start pose instead of the current robot pose, ifuse_startis not false (i.e. not provided or set to true). Takes in a blackboard variable, e.g. “{start}”.

**`use_start`**
- Type: `unknown`
- TypeDefaultgeometry_msgs::msg::PoseStampedN/ADescriptionOptional. For using or not using (i.e. ignoring) the provided start posestart. Takes in a blackboard variable, e.g. “{use_start}”.

**`goal`**
- Type: `unknown`
- TypeDefaultgeometry_msgs::msg::PoseStampedN/ADescriptionGoal pose. Takes in a blackboard variable, e.g. “{goal}”.

**`planner_id`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionMapped name to the planner plugin type to use, e.g. GridBased.

**`server_name`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionAction server name.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble10DescriptionAction server timeout (ms).

**`Description`**
- Type: `unknown`
- Start pose. Optional. Used as the planner start pose instead of the current robot pose, ifuse_startis not false (i.e. not provided or set to true). Takes in a blackboard variable, e.g. “{start}”.

**`Description`**
- Type: `unknown`
- Optional. For using or not using (i.e. ignoring) the provided start posestart. Takes in a blackboard variable, e.g. “{use_start}”.

**`Description`**
- Type: `unknown`
- Goal pose. Takes in a blackboard variable, e.g. “{goal}”.

**`Description`**
- Type: `unknown`
- Mapped name to the planner plugin type to use, e.g. GridBased.

**`Description`**
- Type: `unknown`
- Action server name.

**`Description`**
- Type: `unknown`
- Action server timeout (ms).

**`path`**
- Type: `unknown`
- TypeDefaultnav_msgs::msg::PathN/ADescriptionPath created by action server. Takes in a blackboard variable, e.g. “{path}”.

**`error_code_id`**
- Type: `unknown`
- TypeDefaultuint16N/ADescriptionCompute path to pose error code. SeeComputePathToPoseaction message for the enumerated set of error codes.

**`error_msg`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionCompute path to pose error message. SeeComputePathToPoseaction message for the enumerated set of error codes.

**`Description`**
- Type: `unknown`
- Path created by action server. Takes in a blackboard variable, e.g. “{path}”.

**`Description`**
- Type: `unknown`
- Compute path to pose error code. SeeComputePathToPoseaction message for the enumerated set of error codes.

**`Description`**
- Type: `unknown`
- Compute path to pose error message. SeeComputePathToPoseaction message for the enumerated set of error codes.


---

###### ComputeRoute

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/ComputeRoute.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/ComputeRoute.html)*

###### ComputeRoute

Invokes the ComputeRoute ROS 2 action server, which is implemented by the [nav2\_route](https://github.com/ros-navigation/navigation2/tree/main/nav2_route) module.
The server address can be remapped using the `server_name` input port.

###### Input Ports

start
:   |  |  |
```
| --- | --- |
| Type | Default |
| geometry\_msgs::msg::PoseStamped | N/A |
```

```
Description
:   Start pose. Optional. Only used if not left empty. Takes in a blackboard variable, e.g. “{start}”.
```

goal
:   |  |  |
```
| --- | --- |
| Type | Default |
| geometry\_msgs::msg::PoseStamped | N/A |
```

```
Description
:   Goal pose. Takes in a blackboard variable, e.g. “{goal}”.
```

start\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | N/A |
```

```
Description
:   Start node ID to use.
```

goal\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | N/A |
```

```
Description
:   Goal node ID to use.
```

use\_start
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to use the start or use TF to obtain the robot’s start pose.
```

use\_poses
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to use the start and goal poses or start and goal node IDs.
```

server\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Action server name.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10 |
```

```
Description
:   Action server timeout (ms).
```

###### Output Ports

route
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav2\_msgs::msg::Route | N/A |
```

```
Description
:   Route created by action server. Takes in a blackboard variable, e.g. “{route}”.
```

path
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs::msg::Path | N/A |
```

```
Description
:   Path created by action server. Takes in a blackboard variable, e.g. “{path}”.
```

planning\_time
:   |  |  |
```
| --- | --- |
| Type | Default |
| builtin\_interfaces::msg::Duration | N/A |
```

```
Description
:   Time it took to compute the route.
```

error\_code\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| uint16 | N/A |
```

```
Description
:   Compute route error code. See `ComputeRoute` action message for the enumerated set of error codes.
```

error\_msg
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Compute route error message. See `ComputeRoute` action message for the enumerated set of error codes.
```

###### Example

```
<ComputeRoute start="{start}" goal="{goal}" use_poses="{true}" use_start="{true}" path="{path}" server_name="ComputeRoute" server_timeout="10"
                   error_code_id="{compute_route_error_code}" error_msg="{compute_route_error_msg}"/>
```

#### Parameters

**`start`**
- Type: `unknown`
- TypeDefaultgeometry_msgs::msg::PoseStampedN/ADescriptionStart pose. Optional. Only used if not left empty. Takes in a blackboard variable, e.g. “{start}”.

**`goal`**
- Type: `unknown`
- TypeDefaultgeometry_msgs::msg::PoseStampedN/ADescriptionGoal pose. Takes in a blackboard variable, e.g. “{goal}”.

**`start_id`**
- Type: `unknown`
- TypeDefaultintN/ADescriptionStart node ID to use.

**`goal_id`**
- Type: `unknown`
- TypeDefaultintN/ADescriptionGoal node ID to use.

**`use_start`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to use the start or use TF to obtain the robot’s start pose.

**`use_poses`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to use the start and goal poses or start and goal node IDs.

**`server_name`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionAction server name.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble10DescriptionAction server timeout (ms).

**`Description`**
- Type: `unknown`
- Start pose. Optional. Only used if not left empty. Takes in a blackboard variable, e.g. “{start}”.

**`Description`**
- Type: `unknown`
- Goal pose. Takes in a blackboard variable, e.g. “{goal}”.

**`Description`**
- Type: `unknown`
- Start node ID to use.

**`Description`**
- Type: `unknown`
- Goal node ID to use.

**`Description`**
- Type: `unknown`
- Whether to use the start or use TF to obtain the robot’s start pose.

**`Description`**
- Type: `unknown`
- Whether to use the start and goal poses or start and goal node IDs.

**`Description`**
- Type: `unknown`
- Action server name.

**`Description`**
- Type: `unknown`
- Action server timeout (ms).

**`route`**
- Type: `unknown`
- TypeDefaultnav2_msgs::msg::RouteN/ADescriptionRoute created by action server. Takes in a blackboard variable, e.g. “{route}”.

**`path`**
- Type: `unknown`
- TypeDefaultnav_msgs::msg::PathN/ADescriptionPath created by action server. Takes in a blackboard variable, e.g. “{path}”.

**`planning_time`**
- Type: `unknown`
- TypeDefaultbuiltin_interfaces::msg::DurationN/ADescriptionTime it took to compute the route.

**`error_code_id`**
- Type: `unknown`
- TypeDefaultuint16N/ADescriptionCompute route error code. SeeComputeRouteaction message for the enumerated set of error codes.

**`error_msg`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionCompute route error message. SeeComputeRouteaction message for the enumerated set of error codes.

**`Description`**
- Type: `unknown`
- Route created by action server. Takes in a blackboard variable, e.g. “{route}”.

**`Description`**
- Type: `unknown`
- Path created by action server. Takes in a blackboard variable, e.g. “{path}”.

**`Description`**
- Type: `unknown`
- Time it took to compute the route.

**`Description`**
- Type: `unknown`
- Compute route error code. SeeComputeRouteaction message for the enumerated set of error codes.

**`Description`**
- Type: `unknown`
- Compute route error message. SeeComputeRouteaction message for the enumerated set of error codes.


---

###### ConcatenatePaths

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/ConcatenatePaths.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/ConcatenatePaths.html)*

###### ConcatenatePaths

Concatenates two paths into a single path, in order such that the output is `input_path1 + input_path2`.
May be used with multiple of these calls sequentially to concatenate multiple paths.

###### Input Ports

input\_path1
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs/Path | N/A |
```

```
Description
:   First path to concatenate.
```

input\_path2
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs/Path | N/A |
```

```
Description
:   Second path to concatenate.
```

###### Output Ports

input\_path2
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs/Path | N/A |
```

```
Description
:   Output concatenated path.
```

###### Example

```
<ConcatenatePaths input_path1="{main_path}" input_path2="{last_mile_path}" output_path="{path}"/>
```

#### Parameters

**`input_path1`**
- Type: `unknown`
- TypeDefaultnav_msgs/PathN/ADescriptionFirst path to concatenate.

**`input_path2`**
- Type: `unknown`
- TypeDefaultnav_msgs/PathN/ADescriptionSecond path to concatenate.

**`Description`**
- Type: `unknown`
- First path to concatenate.

**`Description`**
- Type: `unknown`
- Second path to concatenate.

**`input_path2`**
- Type: `unknown`
- TypeDefaultnav_msgs/PathN/ADescriptionOutput concatenated path.

**`Description`**
- Type: `unknown`
- Output concatenated path.


---

###### ControllerSelector

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/ControllerSelector.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/ControllerSelector.html)*

###### ControllerSelector

It is used to select the Controller that will be used by the Controller server. It subscribes to the `controller_selector` topic to receive command messages with the name of the Controller to be used. It is commonly used before of the FollowPathAction. The `selected_controller` output port is passed to `controller_id` input port of the FollowPathAction. If none is provided on the topic, the `default_controller` is used.

Any publisher to this topic needs to be configured with some QoS defined as `reliable` and `transient local`.

###### Input Ports

topic\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | controller\_selector |
```

```
Description
:   The name of the topic used to received select command messages. This is used to support multiple ControllerSelector nodes.
```

default\_controller
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   The default value for the selected Controller if no message is received from the input topic.
```

###### Output Ports

selected\_controller
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   The output selected Controller id. This selected\_controller string is usually passed to the FollowPath behavior via the controller\_id input port.
```

###### Example

```
<ControllerSelector selected_controller="{selected_controller}" default_controller="FollowPath" topic_name="controller_selector"/>
```

#### Parameters

**`topic_name`**
- Type: `unknown`
- TypeDefaultstringcontroller_selectorDescriptionThe name of the topic used to received select command messages. This is used to support multiple ControllerSelector nodes.

**`default_controller`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionThe default value for the selected Controller if no message is received from the input topic.

**`Description`**
- Type: `unknown`
- The name of the topic used to received select command messages. This is used to support multiple ControllerSelector nodes.

**`Description`**
- Type: `unknown`
- The default value for the selected Controller if no message is received from the input topic.

**`selected_controller`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionThe output selected Controller id. This selected_controller string is usually passed to the FollowPath behavior via the controller_id input port.

**`Description`**
- Type: `unknown`
- The output selected Controller id. This selected_controller string is usually passed to the FollowPath behavior via the controller_id input port.


---

###### DockRobot

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/DockRobot.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/DockRobot.html)*

###### DockRobot

Invokes the DockRobot ROS 2 action server, which is implemented by the docking server.

It is used to dock the robot to a docking station.

###### Input Ports

use\_dock\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to use the dock’s ID or dock pose fields.
```

dock\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Dock ID or name to use.
```

dock\_pose
:   |  |  |
```
| --- | --- |
| Type | Default |
| geometry\_msgs/PoseStamped | N/A |
```

```
Description
:   The dock pose, if not using dock id.
```

dock\_type
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   The dock plugin type, if using dock pose.
```

max\_staging\_time
:   |  |  |
```
| --- | --- |
| Type | Default |
| float | 1000.0 |
```

```
Description
:   Maximum time to navigate to the staging pose.
```

navigate\_to\_staging\_pose
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to autonomously navigate to staging pose.
```

###### Output Ports

success
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   If the action was successful.
```

error\_code\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| uint16 | 0 |
```

```
Description
:   Dock robot error code. See `DockRobot` action message for the enumerated set of error codes.
```

error\_msg
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | 0 |
```

```
Description
:   Dock robot error message. See `DockRobot` action message for the enumerated set of error codes.
```

num\_retries
:   |  |  |
```
| --- | --- |
| Type | Default |
| uint16 | 0 |
```

```
Description
:   The number of retries executed.
```

###### Example

```
<DockRobot dock_id="{dock_id}" error_code_id="{dock_error_code}" error_msg="{dock_error_msg}"/>
```

#### Parameters

**`use_dock_id`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to use the dock’s ID or dock pose fields.

**`dock_id`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionDock ID or name to use.

**`dock_pose`**
- Type: `unknown`
- TypeDefaultgeometry_msgs/PoseStampedN/ADescriptionThe dock pose, if not using dock id.

**`dock_type`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionThe dock plugin type, if using dock pose.

**`max_staging_time`**
- Type: `unknown`
- TypeDefaultfloat1000.0DescriptionMaximum time to navigate to the staging pose.

**`navigate_to_staging_pose`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to autonomously navigate to staging pose.

**`Description`**
- Type: `unknown`
- Whether to use the dock’s ID or dock pose fields.

**`Description`**
- Type: `unknown`
- Dock ID or name to use.

**`Description`**
- Type: `unknown`
- The dock pose, if not using dock id.

**`Description`**
- Type: `unknown`
- The dock plugin type, if using dock pose.

**`Description`**
- Type: `unknown`
- Maximum time to navigate to the staging pose.

**`Description`**
- Type: `unknown`
- Whether to autonomously navigate to staging pose.

**`success`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionIf the action was successful.

**`error_code_id`**
- Type: `unknown`
- TypeDefaultuint160DescriptionDock robot error code. SeeDockRobotaction message for the enumerated set of error codes.

**`error_msg`**
- Type: `unknown`
- TypeDefaultstring0DescriptionDock robot error message. SeeDockRobotaction message for the enumerated set of error codes.

**`num_retries`**
- Type: `unknown`
- TypeDefaultuint160DescriptionThe number of retries executed.

**`Description`**
- Type: `unknown`
- If the action was successful.

**`Description`**
- Type: `unknown`
- Dock robot error code. SeeDockRobotaction message for the enumerated set of error codes.

**`Description`**
- Type: `unknown`
- Dock robot error message. SeeDockRobotaction message for the enumerated set of error codes.

**`Description`**
- Type: `unknown`
- The number of retries executed.


---

###### DriveOnHeading

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/DriveOnHeading.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/DriveOnHeading.html)*

###### DriveOnHeading

Invokes the DriveOnHeading ROS 2 action server, which causes the robot to drive on the current heading by a specific displacement.
It performs a linear translation by a given distance. The nav2\_behaviors module implements the DriveOnHeading action server.

###### Input Ports

dist\_to\_travel
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.15 |
```

```
Description
:   Distance to travel (m).
```

speed
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.025 |
```

```
Description
:   Speed at which to travel (m/s).
```

time\_allowance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10.0 |
```

```
Description
:   Time to invoke behavior for, if exceeds considers it a stuck condition or failure case (seconds).
```

server\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Action server name.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10 |
```

```
Description
:   Action server timeout (ms).
```

disable\_collision\_checks
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Disable collision checking.
```

###### Output Ports

error\_code\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| uint16 | N/A |
```

```
Description
:   Drive on heading error code. See `DriveOnHeading` action message for the enumerated set of error codes.
```

error\_msg
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Drive on heading error message. See `DriveOnHeading` action message for the enumerated set of error codes.
```

###### Example

```
<DriveOnHeading dist_to_travel="0.2" speed="0.05" server_name="backup_server" server_timeout="10" disable_collision_checks="false"
                error_code_id="{drive_on_heading_error_code}" error_msg="{drive_on_heading_error_msg}"/>
```

#### Parameters

**`dist_to_travel`**
- Type: `unknown`
- TypeDefaultdouble0.15DescriptionDistance to travel (m).

**`speed`**
- Type: `unknown`
- TypeDefaultdouble0.025DescriptionSpeed at which to travel (m/s).

**`time_allowance`**
- Type: `unknown`
- TypeDefaultdouble10.0DescriptionTime to invoke behavior for, if exceeds considers it a stuck condition or failure case (seconds).

**`server_name`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionAction server name.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble10DescriptionAction server timeout (ms).

**`disable_collision_checks`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionDisable collision checking.

**`Description`**
- Type: `unknown`
- Distance to travel (m).

**`Description`**
- Type: `unknown`
- Speed at which to travel (m/s).

**`Description`**
- Type: `unknown`
- Time to invoke behavior for, if exceeds considers it a stuck condition or failure case (seconds).

**`Description`**
- Type: `unknown`
- Action server name.

**`Description`**
- Type: `unknown`
- Action server timeout (ms).

**`Description`**
- Type: `unknown`
- Disable collision checking.

**`error_code_id`**
- Type: `unknown`
- TypeDefaultuint16N/ADescriptionDrive on heading error code. SeeDriveOnHeadingaction message for the enumerated set of error codes.

**`error_msg`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionDrive on heading error message. SeeDriveOnHeadingaction message for the enumerated set of error codes.

**`Description`**
- Type: `unknown`
- Drive on heading error code. SeeDriveOnHeadingaction message for the enumerated set of error codes.

**`Description`**
- Type: `unknown`
- Drive on heading error message. SeeDriveOnHeadingaction message for the enumerated set of error codes.


---

###### ExtractRouteNodesAsGoals

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/ExtractRouteNodesAsGoals.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/ExtractRouteNodesAsGoals.html)*

###### ExtractRouteNodesAsGoals

Concatenates two paths into a single path, in order such that the output is `input_path1 + input_path2`.
May be used with multiple of these calls sequentially to concatenate multiple paths.

###### Input Ports

route
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav2\_msgs/Route | N/A |
```

```
Description
:   Route to convert its `nodes` into Goals.
```

###### Output Ports

goals
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs/Goals | N/A |
```

```
Description
:   Goals comparing the route’s `nodes`.
```

###### Example

```
<ExtractRouteNodesAsGoals route="{route}" goals="{route_goals}"/>
```

#### Parameters

**`route`**
- Type: `unknown`
- TypeDefaultnav2_msgs/RouteN/ADescriptionRoute to convert itsnodesinto Goals.

**`Description`**
- Type: `unknown`
- Route to convert itsnodesinto Goals.

**`goals`**
- Type: `unknown`
- TypeDefaultnav_msgs/GoalsN/ADescriptionGoals comparing the route’snodes.

**`Description`**
- Type: `unknown`
- Goals comparing the route’snodes.


---

###### FollowObject

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/FollowObject.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/FollowObject.html)*

###### FollowObject

Invokes the FollowObject ROS 2 action server, it will dynamically follow an object while maintaining a defined distance.
The server address can be remapped using the `server_name` input port.

###### Input Ports

pose\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | dynamic\_pose |
```

```
Description
:   Topic to publish the pose of the object to follow.
```

max\_duration
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   The maximum duration to follow the object.
```

tracked\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Target frame to follow.
```

server\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Action server name.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10 |
```

```
Description
:   Action server timeout (ms).
```

###### Output Ports

error\_code\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| uint16 | N/A |
```

```
Description
:   Follow object error code. See `FollowObject` action for the enumerated set of error code definitions.
```

error\_msg
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Follow object error message. See `FollowObject` action for the enumerated set of error code definitions.
```

###### Example

```
<FollowObject name="FollowPerson" pose_topic="/person_pose" max_duration="0.0"/>
```

#### Parameters

**`pose_topic`**
- Type: `unknown`
- TypeDefaultstringdynamic_poseDescriptionTopic to publish the pose of the object to follow.

**`max_duration`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionThe maximum duration to follow the object.

**`tracked_frame`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionTarget frame to follow.

**`server_name`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionAction server name.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble10DescriptionAction server timeout (ms).

**`Description`**
- Type: `unknown`
- Topic to publish the pose of the object to follow.

**`Description`**
- Type: `unknown`
- The maximum duration to follow the object.

**`Description`**
- Type: `unknown`
- Target frame to follow.

**`Description`**
- Type: `unknown`
- Action server name.

**`Description`**
- Type: `unknown`
- Action server timeout (ms).

**`error_code_id`**
- Type: `unknown`
- TypeDefaultuint16N/ADescriptionFollow object error code. SeeFollowObjectaction for the enumerated set of error code definitions.

**`error_msg`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionFollow object error message. SeeFollowObjectaction for the enumerated set of error code definitions.

**`Description`**
- Type: `unknown`
- Follow object error code. SeeFollowObjectaction for the enumerated set of error code definitions.

**`Description`**
- Type: `unknown`
- Follow object error message. SeeFollowObjectaction for the enumerated set of error code definitions.


---

###### FollowPath

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/FollowPath.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/FollowPath.html)*

###### FollowPath

Invokes the FollowPath ROS 2 action server, which is implemented by the controller plugin modules loaded.
The server address can be remapped using the `server_name` input port.

###### Input Ports

path
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Takes in a blackboard variable containing the path to follow, eg. “{path}”.
```

controller\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Mapped name of the controller plugin type to use, e.g. FollowPath.
```

goal\_checker\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Mapped name of the goal checker plugin type to use, e.g. SimpleGoalChecker.
```

progress\_checker\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Mapped name of the progress checker plugin type to use, e.g. SimpleProgressChecker.
```

path\_handler\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Mapped name of the path handler plugin type to use, e.g. FeasiblePathHandler.
```

server\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Action server name.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10 |
```

```
Description
:   Action server timeout (ms).
```

###### Output Ports

error\_code\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| uint16 | N/A |
```

```
Description
:   Follow path error code. See `FollowPath` action for the enumerated set of error code definitions.
```

error\_msg
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Follow path error message. See `FollowPath` action for the enumerated set of error code definitions.
```

tracking\_feedback
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav2\_msgs::msg::TrackingFeedback | N/A |
```

```
Description
:   Tracking feedback message from the controller server, including cross track error, current path index, remaining path length, etc.
```

###### Example

```
<FollowPath path="{path}" controller_id="FollowPath" goal_checker_id="precise_goal_checker" path_handler_id="PathHandler" server_name="FollowPath" server_timeout="10" error_code_id="{follow_path_error_code}" error_msg="{follow_path_error_msg}" tracking_feedback="{tracking_feedback}"/>
```

#### Parameters

**`path`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionTakes in a blackboard variable containing the path to follow, eg. “{path}”.

**`controller_id`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionMapped name of the controller plugin type to use, e.g. FollowPath.

**`goal_checker_id`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionMapped name of the goal checker plugin type to use, e.g. SimpleGoalChecker.

**`progress_checker_id`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionMapped name of the progress checker plugin type to use, e.g. SimpleProgressChecker.

**`path_handler_id`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionMapped name of the path handler plugin type to use, e.g. FeasiblePathHandler.

**`server_name`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionAction server name.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble10DescriptionAction server timeout (ms).

**`Description`**
- Type: `unknown`
- Takes in a blackboard variable containing the path to follow, eg. “{path}”.

**`Description`**
- Type: `unknown`
- Mapped name of the controller plugin type to use, e.g. FollowPath.

**`Description`**
- Type: `unknown`
- Mapped name of the goal checker plugin type to use, e.g. SimpleGoalChecker.

**`Description`**
- Type: `unknown`
- Mapped name of the progress checker plugin type to use, e.g. SimpleProgressChecker.

**`Description`**
- Type: `unknown`
- Mapped name of the path handler plugin type to use, e.g. FeasiblePathHandler.

**`Description`**
- Type: `unknown`
- Action server name.

**`Description`**
- Type: `unknown`
- Action server timeout (ms).

**`error_code_id`**
- Type: `unknown`
- TypeDefaultuint16N/ADescriptionFollow path error code. SeeFollowPathaction for the enumerated set of error code definitions.

**`error_msg`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionFollow path error message. SeeFollowPathaction for the enumerated set of error code definitions.

**`tracking_feedback`**
- Type: `unknown`
- TypeDefaultnav2_msgs::msg::TrackingFeedbackN/ADescriptionTracking feedback message from the controller server, including cross track error, current path index, remaining path length, etc.

**`Description`**
- Type: `unknown`
- Follow path error code. SeeFollowPathaction for the enumerated set of error code definitions.

**`Description`**
- Type: `unknown`
- Follow path error message. SeeFollowPathaction for the enumerated set of error code definitions.

**`Description`**
- Type: `unknown`
- Tracking feedback message from the controller server, including cross track error, current path index, remaining path length, etc.


---

###### GetCurrentPose

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/GetCurrentPose.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/GetCurrentPose.html)*

###### GetCurrentPose

Obtains the current pose from TF and places it on the blackboard for other nodes to use.

###### Input Ports

robot\_base\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Robot base frame to transform poses to if not given in the same frame. If not provided, uses the BT Navigator’s `base_frame` setting automatically.
```

global\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Global frame to transform poses to if not given in the same frame. If not provided, uses the BT Navigator’s `global_frame` setting automatically.
```

###### Output Ports

current\_pose
:   |  |  |
```
| --- | --- |
| Type | Default |
| geometry\_msgs::msg::PoseStamped | N/A |
```

```
Description
:   The current pose in the global frame.
```

###### Example

```
<GetCurrentPose current_pose="{current_pose}"/>
```

#### Parameters

**`robot_base_frame`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionRobot base frame to transform poses to if not given in the same frame. If not provided, uses the BT Navigator’sbase_framesetting automatically.

**`global_frame`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionGlobal frame to transform poses to if not given in the same frame. If not provided, uses the BT Navigator’sglobal_framesetting automatically.

**`Description`**
- Type: `unknown`
- Robot base frame to transform poses to if not given in the same frame. If not provided, uses the BT Navigator’sbase_framesetting automatically.

**`Description`**
- Type: `unknown`
- Global frame to transform poses to if not given in the same frame. If not provided, uses the BT Navigator’sglobal_framesetting automatically.

**`current_pose`**
- Type: `unknown`
- TypeDefaultgeometry_msgs::msg::PoseStampedN/ADescriptionThe current pose in the global frame.

**`Description`**
- Type: `unknown`
- The current pose in the global frame.


---

###### GetNextFewGoals

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/GetNextFewGoals.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/GetNextFewGoals.html)*

###### GetNextFewGoals

Extracts only the next `N` goals from a list of goals to send to a later task that only needs localized future knowledge.

###### Input Ports

num\_goals
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | N/A |
```

```
Description
:   How many of the goals to take from the input goals.
```

input\_goals
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs/Goals | N/A |
```

```
Description
:   Input goals list.
```

###### Output Ports

output\_goals
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs/Goals | N/A |
```

```
Description
:   The output pruned goals list.
```

###### Example

```
<GetNextFewGoals num_goals="3" input_goals="{goal_poses}" output_goals="{planning_goals}"/>
```

#### Parameters

**`num_goals`**
- Type: `unknown`
- TypeDefaultintN/ADescriptionHow many of the goals to take from the input goals.

**`input_goals`**
- Type: `unknown`
- TypeDefaultnav_msgs/GoalsN/ADescriptionInput goals list.

**`Description`**
- Type: `unknown`
- How many of the goals to take from the input goals.

**`Description`**
- Type: `unknown`
- Input goals list.

**`output_goals`**
- Type: `unknown`
- TypeDefaultnav_msgs/GoalsN/ADescriptionThe output pruned goals list.

**`Description`**
- Type: `unknown`
- The output pruned goals list.


---

###### GetPoseFromPath

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/GetPoseFromPath.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/GetPoseFromPath.html)*

###### GetPoseFromPath

Gets a pose from a particular index on the path. Use `-1` to get the last pose, `-2` for second to last, and so on.

###### Input Ports

path
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs/Path | N/A |
```

```
Description
:   Path to extract pose from
```

index
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 0 |
```

```
Description
:   Index from path to use. Use `-1` to get the last pose, `-2` for second to last, and so on.
```

###### Output Ports

pose
:   |  |  |
```
| --- | --- |
| Type | Default |
| geometry\_msgs/PoseStamped | N/A |
```

```
Description
:   Pose from path, with the Path’s set header.
```

###### Example

```
<GetPoseFromPath path="{path}" index="-1" pose="{goal}"/>
```

#### Parameters

**`path`**
- Type: `unknown`
- TypeDefaultnav_msgs/PathN/ADescriptionPath to extract pose from

**`index`**
- Type: `unknown`
- TypeDefaultint0DescriptionIndex from path to use. Use-1to get the last pose,-2for second to last, and so on.

**`Description`**
- Type: `unknown`
- Path to extract pose from

**`Description`**
- Type: `unknown`
- Index from path to use. Use-1to get the last pose,-2for second to last, and so on.

**`pose`**
- Type: `unknown`
- TypeDefaultgeometry_msgs/PoseStampedN/ADescriptionPose from path, with the Path’s set header.

**`Description`**
- Type: `unknown`
- Pose from path, with the Path’s set header.


---

###### GoalCheckerSelector

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/GoalCheckerSelector.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/GoalCheckerSelector.html)*

###### GoalCheckerSelector

It is used to select the GoalChecker that will be used by the goal\_checker server. It subscribes to the `goal_checker_selector` topic to receive command messages with the name of the GoalChecker to be used. It is commonly used before of the FollowPathAction. The `selected_goal_checker` output port is passed to `goal_checker_id` input port of the FollowPathAction. If none is provided on the topic, the `default_goal_checker` is used.

Any publisher to this topic needs to be configured with some QoS defined as `reliable` and `transient local`.

###### Input Ports

topic\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | goal\_checker\_selector |
```

```
Description
:   The name of the topic used to received select command messages. This is used to support multiple GoalCheckerSelector nodes.
```

default\_goal\_checker
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   The default value for the selected GoalChecker if no message is received from the input topic.
```

###### Output Ports

selected\_goal\_checker
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   The output selected GoalChecker id. This selected\_goal\_checker string is usually passed to the FollowPath behavior via the goal\_checker\_id input port.
```

###### Example

```
<GoalCheckerSelector selected_goal_checker="{selected_goal_checker}" default_goal_checker="precise_goal_checker" topic_name="goal_checker_selector"/>
```

#### Parameters

**`topic_name`**
- Type: `unknown`
- TypeDefaultstringgoal_checker_selectorDescriptionThe name of the topic used to received select command messages. This is used to support multiple GoalCheckerSelector nodes.

**`default_goal_checker`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionThe default value for the selected GoalChecker if no message is received from the input topic.

**`Description`**
- Type: `unknown`
- The name of the topic used to received select command messages. This is used to support multiple GoalCheckerSelector nodes.

**`Description`**
- Type: `unknown`
- The default value for the selected GoalChecker if no message is received from the input topic.

**`selected_goal_checker`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionThe output selected GoalChecker id. This selected_goal_checker string is usually passed to the FollowPath behavior via the goal_checker_id input port.

**`Description`**
- Type: `unknown`
- The output selected GoalChecker id. This selected_goal_checker string is usually passed to the FollowPath behavior via the goal_checker_id input port.


---

###### NavigateThroughPoses

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/NavigateThroughPoses.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/NavigateThroughPoses.html)*

###### NavigateThroughPoses

Invokes the NavigateThroughPoses ROS 2 action server, which is implemented by the [bt\_navigator](https://github.com/ros-navigation/navigation2/tree/main/nav2_bt_navigator) module.

###### Input Ports

goals
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs::msg::Goals | N/A |
```

```
Description
:   Goal poses. Takes in a blackboard variable, e.g. “{goals}”.
```

server\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Action server name.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10 |
```

```
Description
:   Action server timeout (ms).
```

behavior\_tree
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Behavior tree absolute path or ID. If none is specified, NavigateThroughPoses action server uses a default behavior tree.
```

###### Output Ports

error\_code\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| uint16 | N/A |
```

```
Description
:   The lowest error code in the list of the error\_code\_name\_prefixes parameter.
```

error\_msg
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   The error message associated with the lowest error code in the list of the error\_code\_name\_prefixes parameter.
```

###### Example

```
<NavigateThroughPoses goals="{goals}" server_name="NavigateThroughPoses" server_timeout="10"
                      error_code_id="{navigate_through_poses_error_code}" error_msg="{navigate_through_poses_error_msg}"
                      behavior_tree="<some-path>/behavior_trees/navigate_through_poses_w_replanning_and_recovery.xml"/>
```

#### Parameters

**`goals`**
- Type: `unknown`
- TypeDefaultnav_msgs::msg::GoalsN/ADescriptionGoal poses. Takes in a blackboard variable, e.g. “{goals}”.

**`server_name`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionAction server name.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble10DescriptionAction server timeout (ms).

**`behavior_tree`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionBehavior tree absolute path or ID. If none is specified, NavigateThroughPoses action server uses a default behavior tree.

**`Description`**
- Type: `unknown`
- Goal poses. Takes in a blackboard variable, e.g. “{goals}”.

**`Description`**
- Type: `unknown`
- Action server name.

**`Description`**
- Type: `unknown`
- Action server timeout (ms).

**`Description`**
- Type: `unknown`
- Behavior tree absolute path or ID. If none is specified, NavigateThroughPoses action server uses a default behavior tree.

**`error_code_id`**
- Type: `unknown`
- TypeDefaultuint16N/ADescriptionThe lowest error code in the list of theerror_code_name_prefixesparameter.

**`error_msg`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionThe error message associated with the lowest error code in the list of theerror_code_name_prefixesparameter.

**`Description`**
- Type: `unknown`
- The lowest error code in the list of theerror_code_name_prefixesparameter.

**`Description`**
- Type: `unknown`
- The error message associated with the lowest error code in the list of theerror_code_name_prefixesparameter.


---

###### NavigateToPose

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/NavigateToPose.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/NavigateToPose.html)*

###### NavigateToPose

Invokes the NavigateToPose ROS 2 action server, which is implemented by the [bt\_navigator](https://github.com/ros-navigation/navigation2/tree/main/nav2_bt_navigator) module.

###### Input Ports

goal
:   |  |  |
```
| --- | --- |
| Type | Default |
| PoseStamped | N/A |
```

```
Description
:   Takes in a blackboard variable containing the goal, eg. “{goal}”.
```

server\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Action server name.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10 |
```

```
Description
:   Action server timeout (ms).
```

behavior\_tree
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Behavior tree absolute path or ID. If none is specified, NavigateToPose action server uses a default behavior tree.
```

###### Output Ports

error\_code\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| uint16 | N/A |
```

```
Description
:   The lowest error code in the list of the error\_code\_names\_prefixes + \_error\_code suffix parameter.
```

error\_msg
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   The error messages associated with the lowest error code in the list of the error\_code\_name\_prefixes + \_error\_code parameter.
```

###### Example

```
<NavigateToPose goal="{goal}" server_name="NavigateToPose" server_timeout="10"
                error_code_id="{navigate_to_pose_error_code}" error_msg="{navigate_to_pose_error_msg}"
                behavior_tree="NavigateThroughPosesWReplanningAndRecovery"/>
```

#### Parameters

**`goal`**
- Type: `unknown`
- TypeDefaultPoseStampedN/ADescriptionTakes in a blackboard variable containing the goal, eg. “{goal}”.

**`server_name`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionAction server name.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble10DescriptionAction server timeout (ms).

**`behavior_tree`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionBehavior tree absolute path or ID. If none is specified, NavigateToPose action server uses a default behavior tree.

**`Description`**
- Type: `unknown`
- Takes in a blackboard variable containing the goal, eg. “{goal}”.

**`Description`**
- Type: `unknown`
- Action server name.

**`Description`**
- Type: `unknown`
- Action server timeout (ms).

**`Description`**
- Type: `unknown`
- Behavior tree absolute path or ID. If none is specified, NavigateToPose action server uses a default behavior tree.

**`error_code_id`**
- Type: `unknown`
- TypeDefaultuint16N/ADescriptionThe lowest error code in the list of theerror_code_names_prefixes+_error_codesuffix parameter.

**`error_msg`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionThe error messages associated with the lowest error code in the list of theerror_code_name_prefixes+_error_codeparameter.

**`Description`**
- Type: `unknown`
- The lowest error code in the list of theerror_code_names_prefixes+_error_codesuffix parameter.

**`Description`**
- Type: `unknown`
- The error messages associated with the lowest error code in the list of theerror_code_name_prefixes+_error_codeparameter.


---

###### PathHandlerSelector

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/PathHandlerSelector.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/PathHandlerSelector.html)*

###### PathHandlerSelector

It is used to select the PathHandler that will be used by the controller server. It subscribes to the `path_handler_selector` topic to receive command messages with the name of the PathHandler to be used. It is commonly used before of the FollowPathAction. The `selected_path_handler` output port is passed to `path_handler_id` input port of the FollowPathAction. If none is provided on the topic, the `default_path_handler` is used.

Any publisher to this topic needs to be configured with some QoS defined as `reliable` and `transient local`.

###### Input Ports

topic\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | path\_handler\_selector |
```

```
Description
:   The name of the topic used to received select command messages. This is used to support multiple PathHandlerSelector nodes.
```

default\_path\_handler
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   The default value for the selected PathHandler if no message is received from the input topic.
```

###### Output Ports

selected\_path\_handler
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   The output selected PathHandler id. This selected\_path\_handler string is usually passed to the FollowPath behavior via the path\_handler\_id input port.
```

###### Example

```
<PathHandlerSelector selected_path_handler="{selected_path_handler}" default_path_handler="PathHandler" topic_name="path_handler_selector"/>
```

#### Parameters

**`topic_name`**
- Type: `unknown`
- TypeDefaultstringpath_handler_selectorDescriptionThe name of the topic used to received select command messages. This is used to support multiple PathHandlerSelector nodes.

**`default_path_handler`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionThe default value for the selected PathHandler if no message is received from the input topic.

**`Description`**
- Type: `unknown`
- The name of the topic used to received select command messages. This is used to support multiple PathHandlerSelector nodes.

**`Description`**
- Type: `unknown`
- The default value for the selected PathHandler if no message is received from the input topic.

**`selected_path_handler`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionThe output selected PathHandler id. This selected_path_handler string is usually passed to the FollowPath behavior via the path_handler_id input port.

**`Description`**
- Type: `unknown`
- The output selected PathHandler id. This selected_path_handler string is usually passed to the FollowPath behavior via the path_handler_id input port.


---

###### PlannerSelector

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/PlannerSelector.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/PlannerSelector.html)*

###### PlannerSelector

It is used to select the planner that will be used by the planner server. It subscribes to the `planner_selector` topic to receive command messages with the name of the planner to be used. It is commonly used before of the ComputePathToPoseAction. The `selected_planner` output port is passed to `planner_id` input port of the ComputePathToPoseAction. If none is provided on the topic, the `default_planner` is used.

Any publisher to this topic needs to be configured with some QoS defined as `reliable` and `transient local`.

###### Input Ports

topic\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | planner\_selector |
```

```
Description
:   The name of the topic used to received select command messages. This is used to support multiple PlannerSelector nodes.
```

default\_planner
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   The default value for the selected planner if no message is received from the input topic.
```

###### Output Ports

selected\_planner
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   The output selected planner id. This selected\_planner string is usually passed to the ComputePathToPose behavior via the planner\_id input port.
```

###### Example

```
<PlannerSelector selected_planner="{selected_planner}" default_planner="GridBased" topic_name="planner_selector"/>
```

#### Parameters

**`topic_name`**
- Type: `unknown`
- TypeDefaultstringplanner_selectorDescriptionThe name of the topic used to received select command messages. This is used to support multiple PlannerSelector nodes.

**`default_planner`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionThe default value for the selected planner if no message is received from the input topic.

**`Description`**
- Type: `unknown`
- The name of the topic used to received select command messages. This is used to support multiple PlannerSelector nodes.

**`Description`**
- Type: `unknown`
- The default value for the selected planner if no message is received from the input topic.

**`selected_planner`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionThe output selected planner id. This selected_planner string is usually passed to the ComputePathToPose behavior via the planner_id input port.

**`Description`**
- Type: `unknown`
- The output selected planner id. This selected_planner string is usually passed to the ComputePathToPose behavior via the planner_id input port.


---

###### ProgressCheckerSelector

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/ProgressCheckerSelector.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/ProgressCheckerSelector.html)*

###### ProgressCheckerSelector

It is used to select the ProgressChecker that will be used by the progress\_checker server. It subscribes to the `progress_checker_selector` topic to receive command messages with the name of the ProgressChecker to be used. It is commonly used before of the FollowPathAction. The `selected_progress_checker` output port is passed to `progress_checker_id` input port of the FollowPathAction. If none is provided on the topic, the `default_progress_checker` is used.

Any publisher to this topic needs to be configured with some QoS defined as `reliable` and `transient local`.

###### Input Ports

topic\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | progress\_checker\_selector |
```

```
Description
:   The name of the topic used to received select command messages. This is used to support multiple ProgressCheckerSelector nodes.
```

default\_progress\_checker
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   The default value for the selected ProgressChecker if no message is received from the input topic.
```

###### Output Ports

selected\_progress\_checker
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   The output selected ProgressChecker id. This selected\_progress\_checker string is usually passed to the FollowPath behavior via the progress\_checker\_id input port.
```

###### Example

```
<ProgressCheckerSelector selected_progress_checker="{selected_progress_checker}" default_progress_checker="precise_progress_checker" topic_name="progress_checker_selector"/>
```

#### Parameters

**`topic_name`**
- Type: `unknown`
- TypeDefaultstringprogress_checker_selectorDescriptionThe name of the topic used to received select command messages. This is used to support multiple ProgressCheckerSelector nodes.

**`default_progress_checker`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionThe default value for the selected ProgressChecker if no message is received from the input topic.

**`Description`**
- Type: `unknown`
- The name of the topic used to received select command messages. This is used to support multiple ProgressCheckerSelector nodes.

**`Description`**
- Type: `unknown`
- The default value for the selected ProgressChecker if no message is received from the input topic.

**`selected_progress_checker`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionThe output selected ProgressChecker id. This selected_progress_checker string is usually passed to the FollowPath behavior via the progress_checker_id input port.

**`Description`**
- Type: `unknown`
- The output selected ProgressChecker id. This selected_progress_checker string is usually passed to the FollowPath behavior via the progress_checker_id input port.


---

###### ReinitializeGlobalLocalization

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/ReinitializeGlobalLocalization.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/ReinitializeGlobalLocalization.html)*

###### ReinitializeGlobalLocalization

Used to trigger global relocalization using AMCL in case of severe delocalization or kidnapped robot problem.

###### Input Ports

service\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Service name.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10 |
```

```
Description
:   Server timeout (ms).
```

###### Example

```
<ReinitializeGlobalLocalization service_name="reinitialize_global_localization"/>
```

#### Parameters

**`service_name`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionService name.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble10DescriptionServer timeout (ms).

**`Description`**
- Type: `unknown`
- Service name.

**`Description`**
- Type: `unknown`
- Server timeout (ms).


---

###### RemoveInCollisionGoals

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/RemoveInCollisionGoals.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/RemoveInCollisionGoals.html)*

###### RemoveInCollisionGoals

Looks over the input port `goals` and removes any waypoint that has a point or footprint cost above a certain threshold.
This may be used to cull goal points passed from `ComputePathThroughPoses` to avoid waiting indefinitely on occupied waypoints.

###### Input Ports

service\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | /global\_costmap/get\_cost\_global\_costmap |
```

```
Description
:   costmap service name responsible for getting the cost.
```

input\_goals
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs::msg::Goals | N/A |
```

```
Description
:   A vector of goals to check if in collision
```

cost\_threshold
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 254.0 |
```

```
Description
:   The cost threshold above which a waypoint is considered in collision and should be removed. If `use_footprint = false`, consider setting to 253 for occupied.
```

use\_footprint
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to use the footprint cost or the point cost.
```

consider\_unknown\_as\_obstacle
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to consider unknown cost (255) as obstacle.
```

input\_waypoint\_statuses
:   |  |  |
```
| --- | --- |
| Type | Default |
| std::vector<nav2\_msgs::msg::WaypointStatus> | N/A |
```

```
Description
:   Original waypoint\_statuses to mark waypoint status from.
```

###### Output Ports

output\_goals
:   |  |  |
```
| --- | --- |
| Type | Default |
| geometry\_msgs::msg::PoseStamped | N/A |
```

```
Description
:   A vector of goals containing only those that are not in collision.
```

output\_waypoint\_statuses
:   |  |  |
```
| --- | --- |
| Type | Default |
| std::vector<nav2\_msgs::msg::WaypointStatus> | N/A |
```

```
Description
:   Waypoint\_statuses with in-collision waypoints marked.
```

###### Example

```
<RemoveInCollisionGoals input_goals="{goals}" output_goals="{goals}" cost_threshold="254.0" use_footprint="true" service_name="/global_costmap/get_cost_global_costmap" input_waypoint_statuses="{waypoint_statuses}" output_waypoint_statuses="{waypoint_statuses}" />
```

#### Parameters

**`service_name`**
- Type: `unknown`
- TypeDefaultstring/global_costmap/get_cost_global_costmapDescriptioncostmap service name responsible for getting the cost.

**`input_goals`**
- Type: `unknown`
- TypeDefaultnav_msgs::msg::GoalsN/ADescriptionA vector of goals to check if in collision

**`cost_threshold`**
- Type: `unknown`
- TypeDefaultdouble254.0DescriptionThe cost threshold above which a waypoint is considered in collision and should be removed. Ifuse_footprint=false, consider setting to 253 for occupied.

**`use_footprint`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to use the footprint cost or the point cost.

**`consider_unknown_as_obstacle`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to consider unknown cost (255) as obstacle.

**`input_waypoint_statuses`**
- Type: `unknown`
- TypeDefaultstd::vector<nav2_msgs::msg::WaypointStatus>N/ADescriptionOriginal waypoint_statuses to mark waypoint status from.

**`Description`**
- Type: `unknown`
- costmap service name responsible for getting the cost.

**`Description`**
- Type: `unknown`
- A vector of goals to check if in collision

**`Description`**
- Type: `unknown`
- The cost threshold above which a waypoint is considered in collision and should be removed. Ifuse_footprint=false, consider setting to 253 for occupied.

**`Description`**
- Type: `unknown`
- Whether to use the footprint cost or the point cost.

**`Description`**
- Type: `unknown`
- Whether to consider unknown cost (255) as obstacle.

**`Description`**
- Type: `unknown`
- Original waypoint_statuses to mark waypoint status from.

**`output_goals`**
- Type: `unknown`
- TypeDefaultgeometry_msgs::msg::PoseStampedN/ADescriptionA vector of goals containing only those that are not in collision.

**`output_waypoint_statuses`**
- Type: `unknown`
- TypeDefaultstd::vector<nav2_msgs::msg::WaypointStatus>N/ADescriptionWaypoint_statuses with in-collision waypoints marked.

**`Description`**
- Type: `unknown`
- A vector of goals containing only those that are not in collision.

**`Description`**
- Type: `unknown`
- Waypoint_statuses with in-collision waypoints marked.


---

###### RemovePassedGoals

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/RemovePassedGoals.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/RemovePassedGoals.html)*

###### RemovePassedGoals

Looks over the input port `goals` and removes any point that the robot is in close proximity to or has recently passed.
This is used to cull goal points that have been passed from `ComputePathThroughPoses` to enable replanning to only the current task goals.

###### Input Ports

radius
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description
:   The radius (m) in proximity to the viapoint for the BT node to remove from the list as having passed.
```

robot\_base\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “base\_link” |
```

```
Description
:   Robot base frame.
```

input\_goals
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs::msg::Goals | N/A |
```

```
Description
:   A vector of goals to check if it passed any in the current iteration.
```

input\_waypoint\_statuses
:   |  |  |
```
| --- | --- |
| Type | Default |
| std::vector<nav2\_msgs::msg::WaypointStatus> | N/A |
```

```
Description
:   Original waypoint\_statuses to mark waypoint status from.
```

###### Output Ports

output\_goals
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs::msg::Goals | N/A |
```

```
Description
:   A vector of goals with goals removed in proximity to the robot
```

output\_waypoint\_statuses
:   |  |  |
```
| --- | --- |
| Type | Default |
| std::vector<nav2\_msgs::msg::WaypointStatus> | N/A |
```

```
Description
:   Waypoint\_statuses with passed waypoints marked.
```

###### Example

```
<RemovePassedGoals radius="0.6" input_goals="{goals}" output_goals="{goals}" input_waypoint_statuses="{waypoint_statuses}" output_waypoint_statuses="{waypoint_statuses}"/>
```

#### Parameters

**`radius`**
- Type: `unknown`
- TypeDefaultdouble0.5DescriptionThe radius (m) in proximity to the viapoint for the BT node to remove from the list as having passed.

**`robot_base_frame`**
- Type: `unknown`
- TypeDefaultstring“base_link”DescriptionRobot base frame.

**`input_goals`**
- Type: `unknown`
- TypeDefaultnav_msgs::msg::GoalsN/ADescriptionA vector of goals to check if it passed any in the current iteration.

**`input_waypoint_statuses`**
- Type: `unknown`
- TypeDefaultstd::vector<nav2_msgs::msg::WaypointStatus>N/ADescriptionOriginal waypoint_statuses to mark waypoint status from.

**`Description`**
- Type: `unknown`
- The radius (m) in proximity to the viapoint for the BT node to remove from the list as having passed.

**`Description`**
- Type: `unknown`
- Robot base frame.

**`Description`**
- Type: `unknown`
- A vector of goals to check if it passed any in the current iteration.

**`Description`**
- Type: `unknown`
- Original waypoint_statuses to mark waypoint status from.

**`output_goals`**
- Type: `unknown`
- TypeDefaultnav_msgs::msg::GoalsN/ADescriptionA vector of goals with goals removed in proximity to the robot

**`output_waypoint_statuses`**
- Type: `unknown`
- TypeDefaultstd::vector<nav2_msgs::msg::WaypointStatus>N/ADescriptionWaypoint_statuses with passed waypoints marked.

**`Description`**
- Type: `unknown`
- A vector of goals with goals removed in proximity to the robot

**`Description`**
- Type: `unknown`
- Waypoint_statuses with passed waypoints marked.


---

###### SmootherSelector

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/SmootherSelector.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/SmootherSelector.html)*

###### SmootherSelector

It is used to select the Smoother that will be used by the Smoother server. It subscribes to the `smoother_selector` topic to receive command messages with the name of the Smoother to be used. It is commonly used before of the FollowPathAction. If none is provided on the topic, the `default_smoother` is used.

Any publisher to this topic needs to be configured with some QoS defined as `reliable` and `transient local`.

###### Input Ports

topic\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | smoother\_selector |
```

```
Description
:   The name of the topic used to received select command messages. This is used to support multiple SmootherSelector nodes.
```

default\_smoother
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   The default value for the selected Smoother if no message is received from the input topic.
```

###### Output Ports

selected\_smoother
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   The output selected Smoother id.
```

###### Example

```
<SmootherSelector selected_smoother="{selected_smoother}" default_smoother="SimpleSmoother" topic_name="smoother_selector"/>
```

#### Parameters

**`topic_name`**
- Type: `unknown`
- TypeDefaultstringsmoother_selectorDescriptionThe name of the topic used to received select command messages. This is used to support multiple SmootherSelector nodes.

**`default_smoother`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionThe default value for the selected Smoother if no message is received from the input topic.

**`Description`**
- Type: `unknown`
- The name of the topic used to received select command messages. This is used to support multiple SmootherSelector nodes.

**`Description`**
- Type: `unknown`
- The default value for the selected Smoother if no message is received from the input topic.

**`selected_smoother`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionThe output selected Smoother id.

**`Description`**
- Type: `unknown`
- The output selected Smoother id.


---

###### SmoothPath

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/Smooth.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/Smooth.html)*

###### SmoothPath

Invokes the SmoothPath action API in the smoother server to smooth a given path plan.

###### Input Ports

unsmoothed\_path
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   The blackboard variable or hard-coded input path to smooth
```

max\_smoothing\_duration
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 3.0 |
```

```
Description
:   Maximum time to smooth for (seconds)
```

check\_for\_collisions
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to check the output smoothed path for collisions.
```

smoother\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   The smoother plugin ID to use for smoothing in the smoother server
```

###### Output Ports

smoothed\_path
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   The output blackboard variable to assign the smoothed path to
```

smoothing\_duration
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | N/A |
```

```
Description
:   The actual duration used for smoothing
```

was\_completed
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | N/A |
```

```
Description
:   Indicates if the smoothing process was completed. Will return `false` if `check_for_collisions` is set to `true` and a collision is detected.
```

error\_code\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| uint16 | N/A |
```

```
Description
:   Follow smoother error code. See `SmoothPath` action for the enumerated set of error code definitions.
```

error\_msg
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Follow smoother error message. See `SmoothPath` action for the enumerated set of error code definitions.
```

###### Example

```
<SmoothPath unsmoothed_path="{path}" smoothed_path="{path}" max_smoothing_duration="3.0" smoother_id="simple_smoother" check_for_collisions="false" smoothing_duration="{smoothing_duration_used}" was_completed="{smoothing_completed}" error_code_id="{smoothing_path_error_code}" error_msg="{smoothing_path_error_msg}"/>
```

#### Parameters

**`unsmoothed_path`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionThe blackboard variable or hard-coded input path to smooth

**`max_smoothing_duration`**
- Type: `unknown`
- TypeDefaultdouble3.0DescriptionMaximum time to smooth for (seconds)

**`check_for_collisions`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to check the output smoothed path for collisions.

**`smoother_id`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionThe smoother plugin ID to use for smoothing in the smoother server

**`Description`**
- Type: `unknown`
- The blackboard variable or hard-coded input path to smooth

**`Description`**
- Type: `unknown`
- Maximum time to smooth for (seconds)

**`Description`**
- Type: `unknown`
- Whether to check the output smoothed path for collisions.

**`Description`**
- Type: `unknown`
- The smoother plugin ID to use for smoothing in the smoother server

**`smoothed_path`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionThe output blackboard variable to assign the smoothed path to

**`smoothing_duration`**
- Type: `unknown`
- TypeDefaultdoubleN/ADescriptionThe actual duration used for smoothing

**`was_completed`**
- Type: `unknown`
- TypeDefaultboolN/ADescriptionIndicates if the smoothing process was completed. Will returnfalseifcheck_for_collisionsis set totrueand a collision is detected.

**`error_code_id`**
- Type: `unknown`
- TypeDefaultuint16N/ADescriptionFollow smoother error code. SeeSmoothPathaction for the enumerated set of error code definitions.

**`error_msg`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionFollow smoother error message. SeeSmoothPathaction for the enumerated set of error code definitions.

**`Description`**
- Type: `unknown`
- The output blackboard variable to assign the smoothed path to

**`Description`**
- Type: `unknown`
- The actual duration used for smoothing

**`Description`**
- Type: `unknown`
- Indicates if the smoothing process was completed. Will returnfalseifcheck_for_collisionsis set totrueand a collision is detected.

**`Description`**
- Type: `unknown`
- Follow smoother error code. SeeSmoothPathaction for the enumerated set of error code definitions.

**`Description`**
- Type: `unknown`
- Follow smoother error message. SeeSmoothPathaction for the enumerated set of error code definitions.


---

###### Spin

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/Spin.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/Spin.html)*

###### Spin

Invokes the Spin ROS 2 action server, which is implemented by the [nav2\_behaviors](https://github.com/ros-navigation/navigation2/tree/main/nav2_behaviors) module.
It performs an in-place rotation by a given angle.
This action is used in nav2 Behavior Trees as a recovery behavior.

###### Input Ports

spin\_dist
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.57 |
```

```
Description
:   Spin distance (radians).
```

time\_allowance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10.0 |
```

```
Description
:   Time to invoke behavior for, if exceeds considers it a stuck condition or failure case (seconds).
```

server\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Action server name.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10 |
```

```
Description
:   Action server timeout (ms).
```

is\_recovery
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description
:   True if the action is being used as a recovery.
```

disable\_collision\_checks
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Disable collision checking.
```

###### Output Ports

error\_code\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| uint16 | N/A |
```

```
Description
:   Spin error code. See `Spin` action message for the enumerated set of error codes.
```

error\_msg
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Spin error message. See `Spin` action message for the enumerated set of error codes.
```

###### Example

```
<Spin spin_dist="1.57" server_name="spin" server_timeout="10" is_recovery="true" disable_collision_checks="false"
      error_code_id="{spin_error_code}" error_msg="{spin_error_msg}"/>
```

#### Parameters

**`spin_dist`**
- Type: `unknown`
- TypeDefaultdouble1.57DescriptionSpin distance (radians).

**`time_allowance`**
- Type: `unknown`
- TypeDefaultdouble10.0DescriptionTime to invoke behavior for, if exceeds considers it a stuck condition or failure case (seconds).

**`server_name`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionAction server name.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble10DescriptionAction server timeout (ms).

**`is_recovery`**
- Type: `unknown`
- TypeDefaultboolTrueDescriptionTrue if the action is being used as a recovery.

**`disable_collision_checks`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionDisable collision checking.

**`Description`**
- Type: `unknown`
- Spin distance (radians).

**`Description`**
- Type: `unknown`
- Time to invoke behavior for, if exceeds considers it a stuck condition or failure case (seconds).

**`Description`**
- Type: `unknown`
- Action server name.

**`Description`**
- Type: `unknown`
- Action server timeout (ms).

**`Description`**
- Type: `unknown`
- True if the action is being used as a recovery.

**`Description`**
- Type: `unknown`
- Disable collision checking.

**`error_code_id`**
- Type: `unknown`
- TypeDefaultuint16N/ADescriptionSpin error code. SeeSpinaction message for the enumerated set of error codes.

**`error_msg`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionSpin error message. SeeSpinaction message for the enumerated set of error codes.

**`Description`**
- Type: `unknown`
- Spin error code. SeeSpinaction message for the enumerated set of error codes.

**`Description`**
- Type: `unknown`
- Spin error message. SeeSpinaction message for the enumerated set of error codes.


---

###### ToggleCollisionMonitor

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/ToggleCollisionMonitor.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/ToggleCollisionMonitor.html)*

###### ToggleCollisionMonitor

Calls the ToggleCollisionMonitor service. Used to toggle the collision monitor on (enabled) and off (disabled).

###### Input Ports

enable
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to enable or disable the collision monitor.
```

service\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Service name.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10 |
```

```
Description
:   Server timeout (ms).
```

###### Example

```
<ToggleCollisionMonitor enable="false" service_name="collision_monitor/toggle"/>
```

#### Parameters

**`enable`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to enable or disable the collision monitor.

**`service_name`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionService name.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble10DescriptionServer timeout (ms).

**`Description`**
- Type: `unknown`
- Whether to enable or disable the collision monitor.

**`Description`**
- Type: `unknown`
- Service name.

**`Description`**
- Type: `unknown`
- Server timeout (ms).


---

###### TruncatePath

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/TruncatePath.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/TruncatePath.html)*

###### TruncatePath

A custom control node, which modifies a path making it shorter. It removes parts of the path closer than a distance to the goal pose. The resulting last pose of the path orientates the robot to the original goal pose.

###### Input Ports

input\_path
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs/Path | N/A |
```

```
Description
:   The original path to be truncated.
```

distance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   The distance to the original goal for truncating the path.
```

###### Output Ports

output\_path
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs/Path | N/A |
```

```
Description
:   The resulting truncated path.
```

###### Example

```
<TruncatePath distance="1.0" input_path="{path}" output_path="{truncated_path}"/>
```

#### Parameters

**`input_path`**
- Type: `unknown`
- TypeDefaultnav_msgs/PathN/ADescriptionThe original path to be truncated.

**`distance`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionThe distance to the original goal for truncating the path.

**`Description`**
- Type: `unknown`
- The original path to be truncated.

**`Description`**
- Type: `unknown`
- The distance to the original goal for truncating the path.

**`output_path`**
- Type: `unknown`
- TypeDefaultnav_msgs/PathN/ADescriptionThe resulting truncated path.

**`Description`**
- Type: `unknown`
- The resulting truncated path.


---

###### TruncatePathLocal

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/TruncatePathLocal.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/TruncatePathLocal.html)*

###### TruncatePathLocal

A custom control node, which modifies a path making it shorter. It removes parts of the path which are more distant than specified forward/backward distance around robot

###### Input Ports

input\_path
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs/Path | N/A |
```

```
Description
:   The original path to be truncated.
```

distance\_forward
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 8.0 |
```

```
Description
:   The trimming distance in forward direction.
```

distance\_backward
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 4.0 |
```

```
Description
:   The trimming distance in backward direction.
```

robot\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “base\_link” |
```

```
Description
:   Robot base frame id.
```

transform\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.2 |
```

```
Description
:   Robot pose lookup tolerance.
```

pose
:   |  |  |
```
| --- | --- |
| Type | Default |
| geometry\_msgs/PoseStamped | N/A |
```

```
Description
:   Manually specified pose to be used alternatively to current robot pose.
```

angular\_distance\_weight
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Weight of angular distance relative to positional distance when finding which path pose is closest to robot. Not applicable on paths without orientations assigned.
```

max\_robot\_pose\_search\_dist
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | infinity |
```

```
Description
:   Maximum forward integrated distance along the path (starting from the last detected pose) to bound the search for the closest pose to the robot. When set to infinity (default), whole path is searched every time.
```

###### Output Ports

output\_path
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs/Path | N/A |
```

```
Description
:   The resulting truncated path.
```

###### Example

```
<TruncatePathLocal input_path="{path}" output_path="{path_local}" distance_forward="3.5" distance_backward="2.0" robot_frame="base_link"/>
```

#### Parameters

**`input_path`**
- Type: `unknown`
- TypeDefaultnav_msgs/PathN/ADescriptionThe original path to be truncated.

**`distance_forward`**
- Type: `unknown`
- TypeDefaultdouble8.0DescriptionThe trimming distance in forward direction.

**`distance_backward`**
- Type: `unknown`
- TypeDefaultdouble4.0DescriptionThe trimming distance in backward direction.

**`robot_frame`**
- Type: `unknown`
- TypeDefaultstring“base_link”DescriptionRobot base frame id.

**`transform_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.2DescriptionRobot pose lookup tolerance.

**`pose`**
- Type: `unknown`
- TypeDefaultgeometry_msgs/PoseStampedN/ADescriptionManually specified pose to be used alternatively to current robot pose.

**`angular_distance_weight`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionWeight of angular distance relative to positional distance when finding which path pose is closest to robot. Not applicable on paths without orientations assigned.

**`max_robot_pose_search_dist`**
- Type: `unknown`
- TypeDefaultdoubleinfinityDescriptionMaximum forward integrated distance along the path (starting from the last detected pose) to bound the search for the closest pose to the robot. When set to infinity (default), whole path is searched every time.

**`Description`**
- Type: `unknown`
- The original path to be truncated.

**`Description`**
- Type: `unknown`
- The trimming distance in forward direction.

**`Description`**
- Type: `unknown`
- The trimming distance in backward direction.

**`Description`**
- Type: `unknown`
- Robot base frame id.

**`Description`**
- Type: `unknown`
- Robot pose lookup tolerance.

**`Description`**
- Type: `unknown`
- Manually specified pose to be used alternatively to current robot pose.

**`Description`**
- Type: `unknown`
- Weight of angular distance relative to positional distance when finding which path pose is closest to robot. Not applicable on paths without orientations assigned.

**`Description`**
- Type: `unknown`
- Maximum forward integrated distance along the path (starting from the last detected pose) to bound the search for the closest pose to the robot. When set to infinity (default), whole path is searched every time.

**`output_path`**
- Type: `unknown`
- TypeDefaultnav_msgs/PathN/ADescriptionThe resulting truncated path.

**`Description`**
- Type: `unknown`
- The resulting truncated path.


---

###### UndockRobot

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/UndockRobot.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/UndockRobot.html)*

###### UndockRobot

Invokes the UndockRobot ROS 2 action server, which is implemented by the docking server.

It is used to undock the robot from a docking station.

###### Input Ports

dock\_type
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   The dock plugin type, if not previous instance used for docking.
```

max\_undocking\_time
:   |  |  |
```
| --- | --- |
| Type | Default |
| float | 30.0 |
```

```
Description
:   Maximum time to get back to the staging pose.
```

###### Output Ports

success
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   If the action was successful.
```

error\_code\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| uint16 | 0 |
```

```
Description
:   Dock robot error code. See `UndockRobot` action message for the enumerated set of error codes.
```

error\_msg
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | 0 |
```

```
Description
:   Dock robot error message. See `UndockRobot` action message for the enumerated set of error codes.
```

###### Example

```
<UndockRobot dock_type="{dock_type}" error_code_id={undock_error_code} error_msg={undock_error_msg}/>
```

#### Parameters

**`dock_type`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionThe dock plugin type, if not previous instance used for docking.

**`max_undocking_time`**
- Type: `unknown`
- TypeDefaultfloat30.0DescriptionMaximum time to get back to the staging pose.

**`Description`**
- Type: `unknown`
- The dock plugin type, if not previous instance used for docking.

**`Description`**
- Type: `unknown`
- Maximum time to get back to the staging pose.

**`success`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionIf the action was successful.

**`error_code_id`**
- Type: `unknown`
- TypeDefaultuint160DescriptionDock robot error code. SeeUndockRobotaction message for the enumerated set of error codes.

**`error_msg`**
- Type: `unknown`
- TypeDefaultstring0DescriptionDock robot error message. SeeUndockRobotaction message for the enumerated set of error codes.

**`Description`**
- Type: `unknown`
- If the action was successful.

**`Description`**
- Type: `unknown`
- Dock robot error code. SeeUndockRobotaction message for the enumerated set of error codes.

**`Description`**
- Type: `unknown`
- Dock robot error message. SeeUndockRobotaction message for the enumerated set of error codes.


---

###### Wait

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/actions/Wait.html](https://docs.nav2.org/configuration/packages/bt-plugins/actions/Wait.html)*

###### Wait

Invokes the Wait ROS 2 action server, which is implemented by the [nav2\_behaviors](https://github.com/ros-navigation/navigation2/tree/main/nav2_behaviors) module.
This action is used in nav2 Behavior Trees as a recovery behavior.

###### Input Ports

wait\_duration
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   Wait time (s).
```

server\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Action server name.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10 |
```

```
Description
:   Action server timeout (ms).
```

###### Output Ports

error\_code\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| uint16 | N/A |
```

```
Description
:   Wait error code. See `Wait` action message for the enumerated set of error codes.
```

error\_msg
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Wait error message. See `Wait` action message for the enumerated set of error codes.
```

###### Example

```
<Wait wait_duration="1.0" server_name="wait_server" server_timeout="10"
      error_code_id="{wait_error_code}" error_msg="{wait_error_msg}"/>
```

#### Parameters

**`wait_duration`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionWait time (s).

**`server_name`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionAction server name.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble10DescriptionAction server timeout (ms).

**`Description`**
- Type: `unknown`
- Wait time (s).

**`Description`**
- Type: `unknown`
- Action server name.

**`Description`**
- Type: `unknown`
- Action server timeout (ms).

**`error_code_id`**
- Type: `unknown`
- TypeDefaultuint16N/ADescriptionWait error code. SeeWaitaction message for the enumerated set of error codes.

**`error_msg`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionWait error message. SeeWaitaction message for the enumerated set of error codes.

**`Description`**
- Type: `unknown`
- Wait error code. SeeWaitaction message for the enumerated set of error codes.

**`Description`**
- Type: `unknown`
- Wait error message. SeeWaitaction message for the enumerated set of error codes.


---

##### Conditions

###### AreErrorCodesPresent

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/conditions/AreErrorCodesPresent.html](https://docs.nav2.org/configuration/packages/bt-plugins/conditions/AreErrorCodesPresent.html)*

###### AreErrorCodesPresent

Checks the if the provided error code matches any error code within a set.

If the active error code is a match, the node returns `SUCCESS`. Otherwise, it returns `FAILURE`.

###### Input Ports

error\_code
:   |  |  |
```
| --- | --- |
| Type | Default |
| unsigned short | N/A |
```

```
Description
:   The active error code to compare against.
```

error\_codes\_to\_check
:   |  |  |
```
| --- | --- |
| Type | Default |
| std::set<unsigned short> | N/A |
```

```
Description
:   The set of error codes you wish to compare against the active error code.
```

###### Example

Error codes to check are defined in another port.

```
<AreErrorCodesPresent error_code="{error_code}" error_codes_to_check="{error_codes_to_check}"/>
```

Error codes to check are defined to be 101, 107 and 119.

```
<AreErrorCodesPresent error_code="{error_code}" error_codes_to_check="101;107;119"/>
```

#### Parameters

**`error_code`**
- Type: `unknown`
- TypeDefaultunsigned shortN/ADescriptionThe active error code to compare against.

**`error_codes_to_check`**
- Type: `unknown`
- TypeDefaultstd::set<unsigned short>N/ADescriptionThe set of error codes you wish to compare against the active error code.

**`Description`**
- Type: `unknown`
- The active error code to compare against.

**`Description`**
- Type: `unknown`
- The set of error codes you wish to compare against the active error code.


---

###### ArePosesNear

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/conditions/ArePosesNear.html](https://docs.nav2.org/configuration/packages/bt-plugins/conditions/ArePosesNear.html)*

###### ArePosesNear

Checks if two poses are nearby. If the input poses are in different frames, it will automatically transform both to the global frame.

###### Input Ports

ref\_pose
:   |  |  |
```
| --- | --- |
| Type | Default |
| geometry\_msgs::msg::PoseStamped | N/A |
```

```
Description
:   Takes in a blackboard variable containing the initial pose to check.
```

target\_pose
:   |  |  |
```
| --- | --- |
| Type | Default |
| geometry\_msgs::msg::PoseStamped | N/A |
```

```
Description
:   Takes in a blackboard variable containing the other pose to check against.
```

global\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Global frame to transform poses to if not given in the same frame. If not provided, uses the BT Navigator’s `global_frame` setting automatically.
```

tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.50 |
```

```
Description
:   Tolerance to check poses if nearby with respect to.
```

###### Example

```
<ArePosesNear ref_pose="{init_pose}" target_pose="{goal_pose}" tolerance="0.10"/>
```

#### Parameters

**`ref_pose`**
- Type: `unknown`
- TypeDefaultgeometry_msgs::msg::PoseStampedN/ADescriptionTakes in a blackboard variable containing the initial pose to check.

**`target_pose`**
- Type: `unknown`
- TypeDefaultgeometry_msgs::msg::PoseStampedN/ADescriptionTakes in a blackboard variable containing the other pose to check against.

**`global_frame`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionGlobal frame to transform poses to if not given in the same frame. If not provided, uses the BT Navigator’sglobal_framesetting automatically.

**`tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.50DescriptionTolerance to check poses if nearby with respect to.

**`Description`**
- Type: `unknown`
- Takes in a blackboard variable containing the initial pose to check.

**`Description`**
- Type: `unknown`
- Takes in a blackboard variable containing the other pose to check against.

**`Description`**
- Type: `unknown`
- Global frame to transform poses to if not given in the same frame. If not provided, uses the BT Navigator’sglobal_framesetting automatically.

**`Description`**
- Type: `unknown`
- Tolerance to check poses if nearby with respect to.


---

###### DistanceTraveled

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/conditions/DistanceTraveled.html](https://docs.nav2.org/configuration/packages/bt-plugins/conditions/DistanceTraveled.html)*

###### DistanceTraveled

Node that returns success when a configurable distance has been traveled.

###### Parameters

transform\_tolerance
:   Defined and declared in [Behavior-Tree Navigator](../../configuring-bt-navigator.html#configuring-bt-navigator).

###### Example

```
bt_navigator:
  ros__parameters:
    # other bt_navigator parameters
    transform_tolerance: 0.1
```

###### Input Ports

distance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   The distance that must travel before returning success (m).
```

global\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “map” |
```

```
Description
:   Reference frame.
```

robot\_base\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “base\_link” |
```

```
Description
:   Robot base frame.
```

###### Example

```
<DistanceTraveled distance="0.8" global_frame="map" robot_base_frame="base_link"/>
```

#### Parameters

**`transform_tolerance`**
- Type: `unknown`
- Defined and declared inBehavior-Tree Navigator.

**`distance`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionThe distance that must travel before returning success (m).

**`global_frame`**
- Type: `unknown`
- TypeDefaultstring“map”DescriptionReference frame.

**`robot_base_frame`**
- Type: `unknown`
- TypeDefaultstring“base_link”DescriptionRobot base frame.

**`Description`**
- Type: `unknown`
- The distance that must travel before returning success (m).

**`Description`**
- Type: `unknown`
- Reference frame.

**`Description`**
- Type: `unknown`
- Robot base frame.


---

###### GlobalUpdatedGoal

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/conditions/GlobalUpdatedGoal.html](https://docs.nav2.org/configuration/packages/bt-plugins/conditions/GlobalUpdatedGoal.html)*

###### GlobalUpdatedGoal

Checks if the global navigation goal has changed in the blackboard.
Returns failure if the goal is the same, if it changes, it returns success.

This node differs from the GoalUpdated by retaining the state of the current goal/goals throughout each tick of the BehaviorTree
such that it will update on any “global” change to the goal.

###### Input Ports

goal
:   |  |  |
```
| --- | --- |
| Type | Default |
| geometry\_msgs::msg::PoseStamped | “{goal}” |
```

```
Description
:   Destination to check. Takes in a blackboard variable, “{goal}” if not specified.
```

goals
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs::msg::Goals | “{goals}” |
```

```
Description
:   Vector of goals to check. Takes in a blackboard variable, “{goals}” if not specified.
```

###### Example

```
<GlobalUpdatedGoal/>
```

#### Parameters

**`goal`**
- Type: `unknown`
- TypeDefaultgeometry_msgs::msg::PoseStamped“{goal}”DescriptionDestination to check. Takes in a blackboard variable, “{goal}” if not specified.

**`goals`**
- Type: `unknown`
- TypeDefaultnav_msgs::msg::Goals“{goals}”DescriptionVector of goals to check. Takes in a blackboard variable, “{goals}” if not specified.

**`Description`**
- Type: `unknown`
- Destination to check. Takes in a blackboard variable, “{goal}” if not specified.

**`Description`**
- Type: `unknown`
- Vector of goals to check. Takes in a blackboard variable, “{goals}” if not specified.


---

###### GoalReached

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/conditions/GoalReached.html](https://docs.nav2.org/configuration/packages/bt-plugins/conditions/GoalReached.html)*

###### GoalReached

Checks the distance to the goal, if the distance to goal is less than the pre-defined threshold, the tree returns SUCCESS, otherwise it returns FAILURE.

###### Parameter

transform\_tolerance
:   Defined and declared in [Behavior-Tree Navigator](../../configuring-bt-navigator.html#configuring-bt-navigator).

goal\_reached\_tol
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
Description
:   Tolerance of accepting pose as the goal (m).
```

###### Example

```
bt_navigator:
  ros__parameters:
    # other bt_navigator parameters
    transform_tolerance: 0.1
    goal_reached_tol: 0.25
```

###### Input Ports

goal
:   |  |  |
```
| --- | --- |
| Type | Default |
| geometry\_msgs::msg::PoseStamped | N/A |
```

```
Description
:   Destination to check. Takes in a blackboard variable, e.g. “{goal}”.
    The global reference frame is taken from the goal’s header frame\_id field.
```

robot\_base\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “base\_link” |
```

```
Description
:   Robot base frame.
```

###### Example

```
<GoalReached goal="{goal}" robot_base_frame="base_link"/>
```

#### Parameters

**`transform_tolerance`**
- Type: `unknown`
- Defined and declared inBehavior-Tree Navigator.

**`goal_reached_tol`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionTolerance of accepting pose as the goal (m).

**`Description`**
- Type: `unknown`
- Tolerance of accepting pose as the goal (m).

**`goal`**
- Type: `unknown`
- TypeDefaultgeometry_msgs::msg::PoseStampedN/ADescriptionDestination to check. Takes in a blackboard variable, e.g. “{goal}”.
The global reference frame is taken from the goal’s headerframe_idfield.

**`robot_base_frame`**
- Type: `unknown`
- TypeDefaultstring“base_link”DescriptionRobot base frame.

**`Description`**
- Type: `unknown`
- Destination to check. Takes in a blackboard variable, e.g. “{goal}”.
The global reference frame is taken from the goal’s headerframe_idfield.

**`Description`**
- Type: `unknown`
- Robot base frame.


---

###### GoalUpdated

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/conditions/GoalUpdated.html](https://docs.nav2.org/configuration/packages/bt-plugins/conditions/GoalUpdated.html)*

###### GoalUpdated

Checks if the global navigation goal, or a vector of goals, has changed in the blackboard.
Returns failure if the goal is the same, if it changes, it returns success.

###### Input Ports

goal
:   |  |  |
```
| --- | --- |
| Type | Default |
| geometry\_msgs::msg::PoseStamped | “{goal}” |
```

```
Description
:   Destination to check. Takes in a blackboard variable, “{goal}” if not specified.
```

goals
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs::msg::Goals | “{goals}” |
```

```
Description
:   Vector of goals to check. Takes in a blackboard variable, “{goals}” if not specified.
```

###### Example

```
<GoalUpdated/>
```

#### Parameters

**`goal`**
- Type: `unknown`
- TypeDefaultgeometry_msgs::msg::PoseStamped“{goal}”DescriptionDestination to check. Takes in a blackboard variable, “{goal}” if not specified.

**`goals`**
- Type: `unknown`
- TypeDefaultnav_msgs::msg::Goals“{goals}”DescriptionVector of goals to check. Takes in a blackboard variable, “{goals}” if not specified.

**`Description`**
- Type: `unknown`
- Destination to check. Takes in a blackboard variable, “{goal}” if not specified.

**`Description`**
- Type: `unknown`
- Vector of goals to check. Takes in a blackboard variable, “{goals}” if not specified.


---

###### InitialPoseReceived

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/conditions/InitialPoseReceived.html](https://docs.nav2.org/configuration/packages/bt-plugins/conditions/InitialPoseReceived.html)*

###### InitialPoseReceived

Node that returns success when the initial pose is sent to AMCL via /initial\_pose`.

###### Input Ports

initial\_pose\_received
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | “{initial\_pose\_received}” |
```

```
Description
:   Success if the value in the port is true. Takes in a blackboard variable,
    :   “{initial\_pose\_received}” if not specified.
```

###### Example

```
<InitialPoseReceived/>
```

#### Parameters

**`initial_pose_received`**
- Type: `unknown`
- TypeDefaultbool“{initial_pose_received}”DescriptionSuccess if the value in the port is true. Takes in a blackboard variable,“{initial_pose_received}” if not specified.

**`Description`**
- Type: `unknown`
- Success if the value in the port is true. Takes in a blackboard variable,“{initial_pose_received}” if not specified.

**`Success if the value in the port is true. Takes in a blackboard variable,`**
- Type: `unknown`
- “{initial_pose_received}” if not specified.


---

###### IsBatteryCharging

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/conditions/IsBatteryCharging.html](https://docs.nav2.org/configuration/packages/bt-plugins/conditions/IsBatteryCharging.html)*

###### IsBatteryCharging

Checks if the battery is charging by subscribing to a `sensor_msgs/BatteryState` topic and checking if the power\_supply\_status is `POWER_SUPPLY_STATUS_CHARGING`.
Returns SUCCESS in that case, FAILURE otherwise.

###### Input Ports

battery\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “/battery\_status” |
```

```
Description
:   Topic for battery info.
```

###### Example

```
<IsBatteryCharging battery_topic="/battery_status"/>
```

#### Parameters

**`battery_topic`**
- Type: `unknown`
- TypeDefaultstring“/battery_status”DescriptionTopic for battery info.

**`Description`**
- Type: `unknown`
- Topic for battery info.


---

###### IsBatteryLow

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/conditions/IsBatteryLow.html](https://docs.nav2.org/configuration/packages/bt-plugins/conditions/IsBatteryLow.html)*

###### IsBatteryLow

Checks if battery is low by subscribing to a `sensor_msgs/BatteryState` topic and checking if battery percentage/voltage is below a specified minimum value.
By default percentage (in range 0 to 1) is used to check for low battery. Set the `is_voltage` parameter to true to use voltage.
Returns SUCCESS when battery percentage/voltage is lower than the specified value, FAILURE otherwise.

###### Input Ports

min\_battery
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Min battery percentage or voltage before triggering.
```

battery\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “/battery\_status” |
```

```
Description
:   Topic for battery info.
```

is\_voltage
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   If true voltage will be used to check for low battery.
```

###### Example

```
<IsBatteryLow min_battery="0.5" battery_topic="/battery_status" is_voltage="false"/>
```

#### Parameters

**`min_battery`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionMin battery percentage or voltage before triggering.

**`battery_topic`**
- Type: `unknown`
- TypeDefaultstring“/battery_status”DescriptionTopic for battery info.

**`is_voltage`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionIf true voltage will be used to check for low battery.

**`Description`**
- Type: `unknown`
- Min battery percentage or voltage before triggering.

**`Description`**
- Type: `unknown`
- Topic for battery info.

**`Description`**
- Type: `unknown`
- If true voltage will be used to check for low battery.


---

###### IsGoalNearby

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/conditions/IsGoalNearby.html](https://docs.nav2.org/configuration/packages/bt-plugins/conditions/IsGoalNearby.html)*

###### IsGoalNearby

Checks if the robot is near the goal by computing the remaining path length from the robot’s current position to the goal. Returns SUCCESS when the remaining path length is less than the proximity threshold, otherwise returns FAILURE.

###### Parameter

transform\_tolerance
:   Defined and declared in [Behavior-Tree Navigator](../../configuring-bt-navigator.html#configuring-bt-navigator).

###### Example

```
bt_navigator:
  ros__parameters:
    # other bt_navigator parameters
    transform_tolerance: 0.1
```

###### Input Ports

path
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs::msg::Path | N/A |
```

```
Description
:   The planned path to evaluate.
```

proximity\_threshold
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   The remaining path length (in meters) considered as “nearby”. When the remaining distance along the path is less than this threshold, the condition returns SUCCESS.
```

max\_robot\_pose\_search\_dist
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | -1.0 |
```

```
Description
:   Maximum forward integrated distance along the path (starting from the last detected pose) to bound the search for the closest pose to the robot. When set to a negative value (default), the entire path is searched every time. Setting this to a positive value (e.g., 1.0-2.0 meters) can improve performance when this BT node is ticked frequently to address looping or crossed paths (when present).
```

global\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “map” |
```

```
Description
:   The global reference frame.
```

robot\_base\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “base\_link” |
```

```
Description
:   Robot base frame.
```

###### Example

```
<IsGoalNearby path="{path}" proximity_threshold="1.0" />
```

#### Parameters

**`transform_tolerance`**
- Type: `unknown`
- Defined and declared inBehavior-Tree Navigator.

**`path`**
- Type: `unknown`
- TypeDefaultnav_msgs::msg::PathN/ADescriptionThe planned path to evaluate.

**`proximity_threshold`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionThe remaining path length (in meters) considered as “nearby”. When the remaining distance along the path is less than this threshold, the condition returns SUCCESS.

**`max_robot_pose_search_dist`**
- Type: `unknown`
- TypeDefaultdouble-1.0DescriptionMaximum forward integrated distance along the path (starting from the last detected pose) to bound the search for the closest pose to the robot. When set to a negative value (default), the entire path is searched every time. Setting this to a positive value (e.g., 1.0-2.0 meters) can improve performance when this BT node is ticked frequently to address looping or crossed paths (when present).

**`global_frame`**
- Type: `unknown`
- TypeDefaultstring“map”DescriptionThe global reference frame.

**`robot_base_frame`**
- Type: `unknown`
- TypeDefaultstring“base_link”DescriptionRobot base frame.

**`Description`**
- Type: `unknown`
- The planned path to evaluate.

**`Description`**
- Type: `unknown`
- The remaining path length (in meters) considered as “nearby”. When the remaining distance along the path is less than this threshold, the condition returns SUCCESS.

**`Description`**
- Type: `unknown`
- Maximum forward integrated distance along the path (starting from the last detected pose) to bound the search for the closest pose to the robot. When set to a negative value (default), the entire path is searched every time. Setting this to a positive value (e.g., 1.0-2.0 meters) can improve performance when this BT node is ticked frequently to address looping or crossed paths (when present).

**`Description`**
- Type: `unknown`
- The global reference frame.

**`Description`**
- Type: `unknown`
- Robot base frame.


---

###### IsPathValid

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/conditions/IsPathValid.html](https://docs.nav2.org/configuration/packages/bt-plugins/conditions/IsPathValid.html)*

###### IsPathValid

Checks to see if the global path is valid. If there is an
obstacle along the path, the condition returns FAILURE, otherwise
it returns SUCCESS. Optionally checks specific costmap layers and
can use a custom footprint for validation.

###### Input Ports

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 20.0 |
```

```
Description
:   Service response timeout (ms).
```

path
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs::msg::Path | N/A |
```

```
Description
:   The global path to check for validity.
```

max\_cost
:   |  |  |
```
| --- | --- |
| Type | Default |
| unsigned int | 254 |
```

```
Description
:   The maximum allowable cost for the path to be considered valid.
```

consider\_unknown\_as\_obstacle
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to consider unknown cost (255) as obstacle.
```

layer\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “” |
```

```
Description
:   Name of the specific costmap layer to check against.
    If empty, checks against the full costmap.
```

footprint
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “” |
```

```
Description
:   Custom footprint specification as a bracketed array of arrays,
    e.g., “[[x1,y1],[x2,y2],…]”. If empty, uses the robot’s
    configured footprint.
```

check\_full\_path
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to check all poses in the path (true) or stop at the
    first invalid pose (false). When true, all collision poses
    are reported.
```

###### Output Ports

collision\_poses
:   |  |  |
```
| --- | --- |
| Type | Default |
| std::vector<geometry\_msgs::msg::PoseStamped> | N/A |
```

```
Description
:   Vector of poses in the path that are in collision or invalid.
    Empty if the path is valid.
```

###### Example

```
<IsPathValid
  server_timeout="10"
  path="{path}"
  max_cost="100"
  consider_unknown_as_obstacle="false"
  layer_name=""
  footprint=""
  check_full_path="false"
  collision_poses="{collision_poses}" />
```

With custom footprint:

```
<IsPathValid
  path="{path}"
  footprint="[[0.5,0.5],[0.5,-0.5],[-0.5,-0.5],[-0.5,0.5]]"
  collision_poses="{collision_poses}" />
```

Checking a specific costmap layer:

```
<IsPathValid
  path="{path}"
  layer_name="obstacle_layer"
  check_full_path="true"
  collision_poses="{collision_poses}" />
```

#### Parameters

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble20.0DescriptionService response timeout (ms).

**`path`**
- Type: `unknown`
- TypeDefaultnav_msgs::msg::PathN/ADescriptionThe global path to check for validity.

**`max_cost`**
- Type: `unknown`
- TypeDefaultunsigned int254DescriptionThe maximum allowable cost for the path to be considered valid.

**`consider_unknown_as_obstacle`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to consider unknown cost (255) as obstacle.

**`layer_name`**
- Type: `unknown`
- TypeDefaultstring“”DescriptionName of the specific costmap layer to check against.
If empty, checks against the full costmap.

**`footprint`**
- Type: `unknown`
- TypeDefaultstring“”DescriptionCustom footprint specification as a bracketed array of arrays,
e.g., “[[x1,y1],[x2,y2],…]”. If empty, uses the robot’s
configured footprint.

**`check_full_path`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to check all poses in the path (true) or stop at the
first invalid pose (false). When true, all collision poses
are reported.

**`Description`**
- Type: `unknown`
- Service response timeout (ms).

**`Description`**
- Type: `unknown`
- The global path to check for validity.

**`Description`**
- Type: `unknown`
- The maximum allowable cost for the path to be considered valid.

**`Description`**
- Type: `unknown`
- Whether to consider unknown cost (255) as obstacle.

**`Description`**
- Type: `unknown`
- Name of the specific costmap layer to check against.
If empty, checks against the full costmap.

**`Description`**
- Type: `unknown`
- Custom footprint specification as a bracketed array of arrays,
e.g., “[[x1,y1],[x2,y2],…]”. If empty, uses the robot’s
configured footprint.

**`Description`**
- Type: `unknown`
- Whether to check all poses in the path (true) or stop at the
first invalid pose (false). When true, all collision poses
are reported.

**`collision_poses`**
- Type: `unknown`
- TypeDefaultstd::vector<geometry_msgs::msg::PoseStamped>N/ADescriptionVector of poses in the path that are in collision or invalid.
Empty if the path is valid.

**`Description`**
- Type: `unknown`
- Vector of poses in the path that are in collision or invalid.
Empty if the path is valid.


---

###### IsPoseOccupied

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/conditions/IsPoseOccupied.html](https://docs.nav2.org/configuration/packages/bt-plugins/conditions/IsPoseOccupied.html)*

###### IsPoseOccupied

Checks to see if the pose is occupied. If it is occupied, the condition returns SUCCESS, otherwise
it returns FAILURE.

###### Input Ports

pose
:   |  |  |
```
| --- | --- |
| Type | Default |
| geometry\_msgs/PoseStamped | N/A |
```

```
Description
:   Pose to check if it is occupied.
```

service\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | /global\_costmap/get\_cost\_global\_costmap |
```

```
Description
:   costmap service name responsible for getting the cost.
```

cost\_threshold
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 254.0 |
```

```
Description
:   The cost threshold above which a waypoint is considered in collision and should be removed. If `use_footprint = false`, consider setting to 253 for occupied.
```

use\_footprint
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to use the footprint cost or the point cost.
```

server\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 20.0 |
```

```
Description
:   Service response timeout (ms).
```

consider\_unknown\_as\_obstacle
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to consider unknown cost (255) as obstacle.
```

###### Example

```
<IsPoseOccupied server_timeout="10" pose="{goal}"/>
```

#### Parameters

**`pose`**
- Type: `unknown`
- TypeDefaultgeometry_msgs/PoseStampedN/ADescriptionPose to check if it is occupied.

**`service_name`**
- Type: `unknown`
- TypeDefaultstring/global_costmap/get_cost_global_costmapDescriptioncostmap service name responsible for getting the cost.

**`cost_threshold`**
- Type: `unknown`
- TypeDefaultdouble254.0DescriptionThe cost threshold above which a waypoint is considered in collision and should be removed. Ifuse_footprint=false, consider setting to 253 for occupied.

**`use_footprint`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to use the footprint cost or the point cost.

**`server_timeout`**
- Type: `unknown`
- TypeDefaultdouble20.0DescriptionService response timeout (ms).

**`consider_unknown_as_obstacle`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to consider unknown cost (255) as obstacle.

**`Description`**
- Type: `unknown`
- Pose to check if it is occupied.

**`Description`**
- Type: `unknown`
- costmap service name responsible for getting the cost.

**`Description`**
- Type: `unknown`
- The cost threshold above which a waypoint is considered in collision and should be removed. Ifuse_footprint=false, consider setting to 253 for occupied.

**`Description`**
- Type: `unknown`
- Whether to use the footprint cost or the point cost.

**`Description`**
- Type: `unknown`
- Service response timeout (ms).

**`Description`**
- Type: `unknown`
- Whether to consider unknown cost (255) as obstacle.


---

###### IsStopped

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/conditions/IsStopped.html](https://docs.nav2.org/configuration/packages/bt-plugins/conditions/IsStopped.html)*

###### IsStopped

BT node that tracks robot odometry and returns SUCCESS if robot is considered stopped for long enough,
RUNNING if stopped but not for long enough and FAILURE otherwise

###### Input Port

velocity\_threshold
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.01 |
```

```
Description
:   Velocity threshold below which robot is considered stopped
```

duration\_stopped
:   |  |  |
```
| --- | --- |
| Type | Default |
| int (ms) | 1000 |
```

```
Description
:   Duration (ms) the velocity must remain below the threshold
```

###### Example

```
<IsStopped velocity_threshold="0.01" duration_stopped="1000"/>
```

#### Parameters

**`velocity_threshold`**
- Type: `unknown`
- TypeDefaultdouble0.01DescriptionVelocity threshold below which robot is considered stopped

**`duration_stopped`**
- Type: `unknown`
- TypeDefaultint (ms)1000DescriptionDuration (ms) the velocity must remain below the threshold

**`Description`**
- Type: `unknown`
- Velocity threshold below which robot is considered stopped

**`Description`**
- Type: `unknown`
- Duration (ms) the velocity must remain below the threshold


---

###### IsStuck

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/conditions/IsStuck.html](https://docs.nav2.org/configuration/packages/bt-plugins/conditions/IsStuck.html)*

###### IsStuck

Determines if the robot is not progressing towards the goal.
If the robot is stuck and not progressing, the condition returns
SUCCESS, otherwise it returns FAILURE.

###### Example

```
<IsStuck/>
```

---

###### PathExpiringTimer

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/conditions/PathExpiringTimer.html](https://docs.nav2.org/configuration/packages/bt-plugins/conditions/PathExpiringTimer.html)*

###### PathExpiringTimer

Checks if the timer has expired. Returns success if the timer has expired, otherwise it returns failure.
The timer will reset if the path gets updated.

###### Input Ports

seconds
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   Time to check if expired.
```

path
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs::msg::Path | N/A |
```

```
Description
:   Check if path has been updated to enable timer reset.
```

###### Example

```
<PathExpiringTimer seconds="15" path="{path}"/>
```

#### Parameters

**`seconds`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionTime to check if expired.

**`path`**
- Type: `unknown`
- TypeDefaultnav_msgs::msg::PathN/ADescriptionCheck if path has been updated to enable timer reset.

**`Description`**
- Type: `unknown`
- Time to check if expired.

**`Description`**
- Type: `unknown`
- Check if path has been updated to enable timer reset.


---

###### TimeExpired

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/conditions/TimeExpired.html](https://docs.nav2.org/configuration/packages/bt-plugins/conditions/TimeExpired.html)*

###### TimeExpired

Node that returns success when a time duration has passed

seconds
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   The time passed to return success (s).
```

###### Example

```
<TimeExpired seconds="1.0"/>
```

#### Parameters

**`seconds`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionThe time passed to return success (s).

**`Description`**
- Type: `unknown`
- The time passed to return success (s).


---

###### TransformAvailable

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/conditions/TransformAvailable.html](https://docs.nav2.org/configuration/packages/bt-plugins/conditions/TransformAvailable.html)*

###### TransformAvailable

Checks if a TF transform is available. Returns failure if it cannot be found. Once found, it will always return success. Useful for initial condition checks.

###### Input Ports

child
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “” |
```

```
Description
:   Child frame for transform.
```

parent
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “” |
```

```
Description
:   Parent frame for transform.
```

###### Example

```
<TransformAvailable parent="odom" child="base_link"/>
```

#### Parameters

**`child`**
- Type: `unknown`
- TypeDefaultstring“”DescriptionChild frame for transform.

**`parent`**
- Type: `unknown`
- TypeDefaultstring“”DescriptionParent frame for transform.

**`Description`**
- Type: `unknown`
- Child frame for transform.

**`Description`**
- Type: `unknown`
- Parent frame for transform.


---

###### WouldAControllerRecoveryHelp

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/conditions/WouldAControllerRecoveryHelp.html](https://docs.nav2.org/configuration/packages/bt-plugins/conditions/WouldAControllerRecoveryHelp.html)*

###### WouldAControllerRecoveryHelp

Checks if the active controller server error code is UNKNOWN, PATIENCE\_EXCEEDED, FAILED\_TO\_MAKE\_PROGRESS, or NO\_VALID\_CONTROL.

If the active error code is a match, the node returns `SUCCESS`. Otherwise, it returns `FAILURE`.

###### Input Port

error\_code
:   |  |  |
```
| --- | --- |
| Type | Default |
| unsigned short | N/A |
```

```
Description
:   The active error code to compare against. This should match the controller server error code.
```

###### Example

```
<WouldAControllerRecoveryHelp error_code="{follow_path_error_code}"/>
```

#### Parameters

**`error_code`**
- Type: `unknown`
- TypeDefaultunsigned shortN/ADescriptionThe active error code to compare against. This should match the controller server error code.

**`Description`**
- Type: `unknown`
- The active error code to compare against. This should match the controller server error code.


---

###### WouldAPlannerRecoveryHelp

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/conditions/WouldAPlannerRecoveryHelp.html](https://docs.nav2.org/configuration/packages/bt-plugins/conditions/WouldAPlannerRecoveryHelp.html)*

###### WouldAPlannerRecoveryHelp

Checks if the active planner server error code is UNKNOWN, NO\_VALID\_PATH, or TIMEOUT.

If the active error code is a match, the node returns `SUCCESS`. Otherwise, it returns `FAILURE`.

###### Input Port

error\_code
:   |  |  |
```
| --- | --- |
| Type | Default |
| unsigned short | N/A |
```

```
Description
:   The active error code to compare against. This should match the planner server error code.
```

###### Example

```
<WouldAPlannerRecoveryHelp error_code="{compute_path_to_pose_error_code}"/>
```

#### Parameters

**`error_code`**
- Type: `unknown`
- TypeDefaultunsigned shortN/ADescriptionThe active error code to compare against. This should match the planner server error code.

**`Description`**
- Type: `unknown`
- The active error code to compare against. This should match the planner server error code.


---

###### WouldARouteRecoveryHelp

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/conditions/WouldARouteRecoveryHelp.html](https://docs.nav2.org/configuration/packages/bt-plugins/conditions/WouldARouteRecoveryHelp.html)*

###### WouldARouteRecoveryHelp

Checks if the active route server error code is UNKNOWN, NO\_VALID\_ROUTE, or TIMEOUT.

If the active error code is a match, the node returns `SUCCESS`. Otherwise, it returns `FAILURE`.

###### Input Port

error\_code
:   |  |  |
```
| --- | --- |
| Type | Default |
| unsigned short | N/A |
```

```
Description
:   The active error code to compare against. This should match the route server error code.
```

###### Example

```
<WouldARouteRecoveryHelp error_code="{compute_route_to_pose_error_code}"/>
```

#### Parameters

**`error_code`**
- Type: `unknown`
- TypeDefaultunsigned shortN/ADescriptionThe active error code to compare against. This should match the route server error code.

**`Description`**
- Type: `unknown`
- The active error code to compare against. This should match the route server error code.


---

###### WouldASmootherRecoveryHelp

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/conditions/WouldASmootherRecoveryHelp.html](https://docs.nav2.org/configuration/packages/bt-plugins/conditions/WouldASmootherRecoveryHelp.html)*

###### WouldASmootherRecoveryHelp

Checks if the active smoother server error code is UNKNOWN, TIMEOUT, FAILED\_TO\_SMOOTH\_PATH, or SMOOTHED\_PATH\_IN\_COLLISION.

If the active error code is a match, the node returns `SUCCESS`. Otherwise, it returns `FAILURE`.

###### Input Port

error\_code
:   |  |  |
```
| --- | --- |
| Type | Default |
| unsigned short | N/A |
```

```
Description
:   The active error code to compare against. This should match the smoother server error code.
```

###### Example

```
<WouldASmootherRecoveryHelp error_code="{smoother_error_code}"/>
```

#### Parameters

**`error_code`**
- Type: `unknown`
- TypeDefaultunsigned shortN/ADescriptionThe active error code to compare against. This should match the smoother server error code.

**`Description`**
- Type: `unknown`
- The active error code to compare against. This should match the smoother server error code.


---

##### Controls

###### NonblockingSequence

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/controls/NonblockingSequence.html](https://docs.nav2.org/configuration/packages/bt-plugins/controls/NonblockingSequence.html)*

###### NonblockingSequence

Ticks all child nodes until they all return SUCCESS. If any of the child nodes return RUNNING, it will continue to tick the subsequent nodes. This node will once again tick through all the child nodes if it is ticked itself. If at any time a child returns FAILURE, that stops all children and returns FAILURE overall.

###### Example

```
<NonblockingSequence>
    <!--Add tree components here--->
</NonblockingSequence>
```

---

###### PauseResumeController

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/controls/PauseResumeController.html](https://docs.nav2.org/configuration/packages/bt-plugins/controls/PauseResumeController.html)*

###### PauseResumeController

Controlled through service calls to pause and resume the execution of the tree.
It has one mandatory child for the RESUMED, and three optional for the PAUSED state, the ON\_PAUSE event and the ON\_RESUME event.
It has two input ports:

* pause\_service\_name: name of the service to pause
* resume\_service\_name: name of the service to resume

The controller starts in RESUMED state, and ticks it until it returns success.
When the pause service is called, ON\_PAUSE is ticked until completion, then the controller switches to PAUSED state.
When the resume service is called, ON\_RESUME is ticked until completion, then the controller switches back to RESUMED state.

The controller only returns success when the RESUMED child returns success.
The controller returns failure if any child returns failure.
In any other case, it returns running.

###### Example

```
<PauseResumeController pause_service_name="/pause" resume_service_name="/resume">
    <!-- RESUMED branch (mandatory) -->

    <!-- PAUSED branch (optional) -->

    <!-- ON_PAUSE branch (optional) -->

    <!-- ON_RESUME branch (optional) -->
</PauseResumeController>
```

When the ON\_PAUSE and ON\_RESUME branches fail, the controller will return failure, halt, and the state will be reset to RESUMED. It might be desirable to retry the transition a few times before failing for real, which functionality is not built in the controller node, but is easily achievable by adding a retry node in the BT:

```
<PauseResumeController pause_service_name="/pause" resume_service_name="/resume">
    <!-- RESUMED branch -->

    <!-- PAUSED branch -->

    <RetryUntilSuccessful num_attempts="3">
        <!-- ON_PAUSE branch -->
    </RetryUntilSuccessful>

    <RetryUntilSuccessful num_attempts="3">
        <!-- ON_RESUME branch -->
    </RetryUntilSuccessful>
</PauseResumeController>
```

---

###### PersistentSequence

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/controls/PersistentSequence.html](https://docs.nav2.org/configuration/packages/bt-plugins/controls/PersistentSequence.html)*

###### PersistentSequence

The PersistentSequenceNode is similar to the SequenceNode, but it stores the index of the last running child in the blackboard (key: current\_child\_idx), and it does not reset the index when it got halted. It used to tick children in an ordered sequence. If any child returns RUNNING, previous children will NOT be ticked again.
This can be helpful paired with the `PauseResumeController`.

* If all the children return SUCCESS, this node returns SUCCESS.
* If a child returns RUNNING, this node returns RUNNING. Loop is NOT restarted, the same running child will be ticked again.
* If a child returns FAILURE, stop the loop and return FAILURE. Restart the loop only if (reset\_on\_failure == true)

###### Example

```
<Script code="current_child_idx := 0" />
<PersistentSequence current_child_idx="{current_child_idx}">
    <!-- Child nodes here -->
</PersistentSequence>
```

---

###### PipelineSequence

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/controls/PipelineSequence.html](https://docs.nav2.org/configuration/packages/bt-plugins/controls/PipelineSequence.html)*

###### PipelineSequence

Ticks the first child till it succeeds, then ticks the first and second children till the second one succeeds.
It then ticks the first, second, and third children until the third succeeds, and so on, and so on. If at any
time a child returns RUNNING, that doesn’t change the behavior. If at any time a child returns FAILURE, that
stops all children and returns FAILURE overall.

###### Example

```
<PipelineSequence>
    <!--Add tree components here--->
</PipelineSequence>
```

---

###### RecoveryNode

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/controls/RecoveryNode.html](https://docs.nav2.org/configuration/packages/bt-plugins/controls/RecoveryNode.html)*

###### RecoveryNode

The RecoveryNode is a control flow node with two children.
It returns SUCCESS if and only if the first child returns SUCCESS.
The second child will be executed only if the first child returns FAILURE.
If the second child SUCCEEDS, then the first child will be executed again.
The user can specify how many times the recovery actions should be taken before returning FAILURE.
In nav2, the RecoveryNode is included in Behavior Trees to implement recovery actions upon failures.

###### Input Ports

number\_of\_retries
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1 |
```

```
Description
:   Number of retries.
```

###### Example

```
<RecoveryNode number_of_retries="1">
    <!--Add tree components here--->
</RecoveryNode>
```

#### Parameters

**`number_of_retries`**
- Type: `unknown`
- TypeDefaultint1DescriptionNumber of retries.

**`Description`**
- Type: `unknown`
- Number of retries.


---

###### RoundRobin

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/controls/RoundRobin.html](https://docs.nav2.org/configuration/packages/bt-plugins/controls/RoundRobin.html)*

###### RoundRobin

Custom control flow node used to create a round-robin behavior for children BT nodes.

###### Input Ports

wrap\_around
:   | Type | Default |
```
| --- | --- |
| bool | false |
```

```
Description
:   Controls wrap-around behavior. When `false`, the node returns FAILURE instead of wrapping to the first child after all children have been attempted. When `true`, the node wraps around to the first child and continues the round-robin behavior.
```

###### Example

```
<RoundRobin wrap_around="false">
    <!--Add tree components here--->
</RoundRobin>
```

#### Parameters

**`wrap_around`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionControls wrap-around behavior. Whenfalse, the node returns FAILURE instead of wrapping to the first child after all children have been attempted. Whentrue, the node wraps around to the first child and continues the round-robin behavior.

**`Description`**
- Type: `unknown`
- Controls wrap-around behavior. Whenfalse, the node returns FAILURE instead of wrapping to the first child after all children have been attempted. Whentrue, the node wraps around to the first child and continues the round-robin behavior.


---

##### Decorators

###### DistanceController

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/decorators/DistanceController.html](https://docs.nav2.org/configuration/packages/bt-plugins/decorators/DistanceController.html)*

###### DistanceController

A node that controls the tick rate for its child based on the distance traveled.
The distance to be traveled before replanning can be supplied to the node as a parameter.
The node returns RUNNING when it is not ticking its child. Currently, in the navigation
stack, the `DistanceController` is used to adjust the rate at which the `ComputePathToPose` and `GoalReached` nodes are ticked.

###### Input Ports

distance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   The distance travelled to trigger an action such as planning a path (m).
```

global\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “map” |
```

```
Description
:   Reference frame.
```

robot\_base\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “base\_link” |
```

```
Description
:   Robot base frame.
```

###### Example

```
<DistanceController distance="0.5" global_frame="map" robot_base_frame="base_link">
  <!--Add tree components here--->
</DistanceController>
```

#### Parameters

**`distance`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionThe distance travelled to trigger an action such as planning a path (m).

**`global_frame`**
- Type: `unknown`
- TypeDefaultstring“map”DescriptionReference frame.

**`robot_base_frame`**
- Type: `unknown`
- TypeDefaultstring“base_link”DescriptionRobot base frame.

**`Description`**
- Type: `unknown`
- The distance travelled to trigger an action such as planning a path (m).

**`Description`**
- Type: `unknown`
- Reference frame.

**`Description`**
- Type: `unknown`
- Robot base frame.


---

###### GoalUpdatedController

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/decorators/GoalUpdatedController.html](https://docs.nav2.org/configuration/packages/bt-plugins/decorators/GoalUpdatedController.html)*

###### GoalUpdatedController

Checks if the global navigation goal, or a vector of goals, has changed in the blackboard. The node ticks its child if the goal was updated.

###### Input Ports

goal
:   |  |  |
```
| --- | --- |
| Type | Default |
| geometry\_msgs::msg::PoseStamped | “{goal}” |
```

```
Description
:   Destination to check. Takes in a blackboard variable, “{goal}” if not specified.
```

goals
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs::msg::Goals | “{goals}” |
```

```
Description
:   Vector of goals to check. Takes in a blackboard variable, “{goals}” if not specified.
```

###### Example

```
<GoalUpdatedController goal="{goal}" goals="{goals}">
  <!--Add tree components here--->
</GoalUpdatedController>
```

#### Parameters

**`goal`**
- Type: `unknown`
- TypeDefaultgeometry_msgs::msg::PoseStamped“{goal}”DescriptionDestination to check. Takes in a blackboard variable, “{goal}” if not specified.

**`goals`**
- Type: `unknown`
- TypeDefaultnav_msgs::msg::Goals“{goals}”DescriptionVector of goals to check. Takes in a blackboard variable, “{goals}” if not specified.

**`Description`**
- Type: `unknown`
- Destination to check. Takes in a blackboard variable, “{goal}” if not specified.

**`Description`**
- Type: `unknown`
- Vector of goals to check. Takes in a blackboard variable, “{goals}” if not specified.


---

###### GoalUpdater

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/decorators/GoalUpdater.html](https://docs.nav2.org/configuration/packages/bt-plugins/decorators/GoalUpdater.html)*

###### GoalUpdater

A custom control node, which updates the goal(s) pose(s). It subscribes to a topic in which it can receive (an) updated goal(s) pose(s) to use instead of the one(s) commanded in action. It is useful for dynamic object following tasks.

###### Parameters

goal\_updater\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “goal\_update” |
```

```
Description
:   The topic to receive the updated goal pose
```

goals\_updater\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “goals\_update” |
```

```
Description
:   The topic to receive the updated goals poses
```

###### Input Ports

input\_goal
:   |  |  |
```
| --- | --- |
| Type | Default |
| geometry\_msgs/PoseStamped | N/A |
```

```
Description
:   The original goal pose
```

input\_goals
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs/Goals | N/A |
```

```
Description
:   The original goals poses
```

###### Output Ports

output\_goal
:   |  |  |
```
| --- | --- |
| Type | Default |
| geometry\_msgs/PoseStamped | N/A |
```

```
Description
:   The resulting updated goal. If no goal received by subscription, it will be the input\_goal
```

output\_goals
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs/Goals | N/A |
```

```
> Description
> :   The resulting updated goals. If no goals received by subscription, it will be the input\_goals
```

###### Example

```
<GoalUpdater input_goal="{goal}" input_goals="{goals}" output_goal="{goal}" output_goals="{goals}">
  <!--Add tree components here--->
</GoalUpdater>
```

#### Parameters

**`goal_updater_topic`**
- Type: `unknown`
- TypeDefaultstring“goal_update”DescriptionThe topic to receive the updated goal pose

**`goals_updater_topic`**
- Type: `unknown`
- TypeDefaultstring“goals_update”DescriptionThe topic to receive the updated goals poses

**`Description`**
- Type: `unknown`
- The topic to receive the updated goal pose

**`Description`**
- Type: `unknown`
- The topic to receive the updated goals poses

**`input_goal`**
- Type: `unknown`
- TypeDefaultgeometry_msgs/PoseStampedN/ADescriptionThe original goal pose

**`input_goals`**
- Type: `unknown`
- TypeDefaultnav_msgs/GoalsN/ADescriptionThe original goals poses

**`Description`**
- Type: `unknown`
- The original goal pose

**`Description`**
- Type: `unknown`
- The original goals poses

**`output_goal`**
- Type: `unknown`
- TypeDefaultgeometry_msgs/PoseStampedN/ADescriptionThe resulting updated goal. If no goal received by subscription, it will be the input_goal

**`output_goals`**
- Type: `unknown`
- TypeDefaultnav_msgs/GoalsN/ADescriptionThe resulting updated goals. If no goals received by subscription, it will be the input_goals

**`Description`**
- Type: `unknown`
- The resulting updated goal. If no goal received by subscription, it will be the input_goal

**`Description`**
- Type: `unknown`
- The resulting updated goals. If no goals received by subscription, it will be the input_goals


---

###### PathLongerOnApproach

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/decorators/PathLongerOnApproach.html](https://docs.nav2.org/configuration/packages/bt-plugins/decorators/PathLongerOnApproach.html)*

###### PathLongerOnApproach

This node checks if the newly generated global path is significantly larger than the old global path in the user-defined robot’s goal proximity and triggers their corresponding children. This allows users to enact special behaviors before a robot attempts to execute a path significantly longer than the prior path when close to a goal (e.g. going around an dynamic obstacle that may just need a few seconds to move out of the way).

###### Input Ports

path
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs::msg::Path | N/A |
```

```
Description
:   Path created by action server. Takes in a blackboard variable, e.g. “{path}”.
```

prox\_len
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 3.0 |
```

```
Description
:   Proximity length (m) for the path to be longer on approach.
```

length\_factor
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description
:   Length multiplication factor to check if the path is significantly longer.
```

###### Example

```
<PathLongerOnApproach path="{path}" prox_len="3.0" length_factor="2.0">
  <!--Add tree components here--->
</PathLongerOnApproach>
```

#### Parameters

**`path`**
- Type: `unknown`
- TypeDefaultnav_msgs::msg::PathN/ADescriptionPath created by action server. Takes in a blackboard variable, e.g. “{path}”.

**`prox_len`**
- Type: `unknown`
- TypeDefaultdouble3.0DescriptionProximity length (m) for the path to be longer on approach.

**`length_factor`**
- Type: `unknown`
- TypeDefaultdouble2.0DescriptionLength multiplication factor to check if the path is significantly longer.

**`Description`**
- Type: `unknown`
- Path created by action server. Takes in a blackboard variable, e.g. “{path}”.

**`Description`**
- Type: `unknown`
- Proximity length (m) for the path to be longer on approach.

**`Description`**
- Type: `unknown`
- Length multiplication factor to check if the path is significantly longer.


---

###### RateController

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/decorators/RateController.html](https://docs.nav2.org/configuration/packages/bt-plugins/decorators/RateController.html)*

###### RateController

A node that throttles the tick rate for its child.
The tick rate can be supplied to the node as a parameter.
The node returns RUNNING when it is not ticking its child.
Currently, in the navigation stack, the `RateController` is
used to adjust the rate at which the `ComputePathToPose` and `GoalReached` nodes are ticked.

###### Input Ports

hz
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10.0 |
```

```
Description
:   Rate to throttle an action or a group of actions.
```

###### Example

```
<RateController hz="1.0">
    <!--Add tree components here--->
</RateController>
```

#### Parameters

**`hz`**
- Type: `unknown`
- TypeDefaultdouble10.0DescriptionRate to throttle an action or a group of actions.

**`Description`**
- Type: `unknown`
- Rate to throttle an action or a group of actions.


---

###### SingleTrigger

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/decorators/SingleTrigger.html](https://docs.nav2.org/configuration/packages/bt-plugins/decorators/SingleTrigger.html)*

###### SingleTrigger

This node triggers its child only once and returns FAILURE for every succeeding tick.

###### Example

```
<SingleTrigger>
  <!--Add tree components here--->
</SingleTrigger>
```

---

###### SpeedController

*Source: [https://docs.nav2.org/configuration/packages/bt-plugins/decorators/SpeedController.html](https://docs.nav2.org/configuration/packages/bt-plugins/decorators/SpeedController.html)*

###### SpeedController

A node that controls the tick rate for its child based on current robot speed.
The maximum and minimum replanning rates can be supplied to the node as parameters along with maximum and minimum speed.
The node returns RUNNING when it is not ticking its child. Currently, in the navigation
stack, the `SpeedController` is used to adjust the rate at which the `ComputePathToPose` and `GoalReached` nodes are ticked.

###### Input Ports

min\_rate
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
Description
:   The minimum rate at which child node can be ticked (hz).
```

max\_rate
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   The maximum rate at which child node can be ticked (hz).
```

min\_speed
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   The minimum robot speed below which the child node is ticked at minimum rate (m/s).
```

max\_speed
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description
:   The maximum robot speed above which the child node is ticked at maximum rate (m/s).
```

goal
:   |  |  |
```
| --- | --- |
| Type | Default |
| geometry\_msgs::msg::PoseStamped | “{goal}” |
```

```
Description
:   Destination to check. Takes in a blackboard variable, “{goal}” if not specified.
```

goals
:   |  |  |
```
| --- | --- |
| Type | Default |
| nav\_msgs::msg::Goals | “{goals}” |
```

```
Description
:   Vector of goals to check. Takes in a blackboard variable, “{goals}” if not specified.
```

###### Example

```
<SpeedController min_rate="0.1" max_rate="1.0" min_speed="0.0" max_speed="0.5" filter_duration="0.3">
  <!--Add tree components here--->
</SpeedController>
```

#### Parameters

**`min_rate`**
- Type: `unknown`
- TypeDefaultdouble0.1DescriptionThe minimum rate at which child node can be ticked (hz).

**`max_rate`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionThe maximum rate at which child node can be ticked (hz).

**`min_speed`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionThe minimum robot speed below which the child node is ticked at minimum rate (m/s).

**`max_speed`**
- Type: `unknown`
- TypeDefaultdouble0.5DescriptionThe maximum robot speed above which the child node is ticked at maximum rate (m/s).

**`goal`**
- Type: `unknown`
- TypeDefaultgeometry_msgs::msg::PoseStamped“{goal}”DescriptionDestination to check. Takes in a blackboard variable, “{goal}” if not specified.

**`goals`**
- Type: `unknown`
- TypeDefaultnav_msgs::msg::Goals“{goals}”DescriptionVector of goals to check. Takes in a blackboard variable, “{goals}” if not specified.

**`Description`**
- Type: `unknown`
- The minimum rate at which child node can be ticked (hz).

**`Description`**
- Type: `unknown`
- The maximum rate at which child node can be ticked (hz).

**`Description`**
- Type: `unknown`
- The minimum robot speed below which the child node is ticked at minimum rate (m/s).

**`Description`**
- Type: `unknown`
- The maximum robot speed above which the child node is ticked at maximum rate (m/s).

**`Description`**
- Type: `unknown`
- Destination to check. Takes in a blackboard variable, “{goal}” if not specified.

**`Description`**
- Type: `unknown`
- Vector of goals to check. Takes in a blackboard variable, “{goals}” if not specified.


---

#### Collision Monitor

##### Collision Detector Node

*Source: [https://docs.nav2.org/configuration/packages/collision_monitor/configuring-collision-detector-node.html](https://docs.nav2.org/configuration/packages/collision_monitor/configuring-collision-detector-node.html)*

###### Collision Detector Node

The Collision Detector is a node similar to the Collision Monitor, so it is recommended to read the [Using Collision Monitor](../../../tutorials/docs/using_collision_monitor.html#collision-monitor-tutorial) tutorial first.

In some cases, the user may want to be informed about the detected obstacles without affecting the robot’s velocity and instead take a different action within an external node. For example, the user may want to blink LEDs or sound an alarm when the robot is close to an obstacle.
Another use case could be to detect data points in particular regions (e.g extremely close to the sensor) and warn of malfunctioning sensors. For this purpose, the Collision Detector node was introduced.
It works similarly to the Collision Monitor, but does not affect the robot’s velocity. It will only inform that data from the configured sources has been detected within the configured polygons via message to the `collision_detector_state` topic.

See the package’s `README` for more information.

###### Features

Similarly to the Collision Monitor, the Collision Detector uses robot’s relative polygons to define “zones”.
However, unlike the Collision Monitor that uses different behavior models, the Collision Detector does not use any of them and therefore the action\_type should always be set to none. If set to anything else, it will throw an error

The zones around the robot and the data sources are the same as for the Collision Monitor, with the exception of the footprint polygon, which is not supported by the Collision Detector.

###### Parameters

frequency
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10.0 |
```

```
Description:
:   Frequency of the main loop that checks for detections.
```

base\_frame\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “base\_footprint” |
```

```
Description:
:   Robot base frame.
```

odom\_frame\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “odom” |
```

```
Description:
:   Which frame to use for odometry.
```

transform\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
Description
:   Time with which to post-date the transform that is published, to indicate that this transform is valid into the future.
```

source\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description:
:   Maximum time interval in which source data is considered as valid. If no new data is received within this interval, an additional warning will be displayed. Setting `source_timeout: 0.0` disables it. This parameter can be overridden per observation source.
```

base\_shift\_correction
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description:
:   Whether to correct source data towards to base frame movement, considering the difference between current time and latest source time. If enabled, produces more accurate sources positioning in the robot base frame, at the cost of slower performance. This will cause average delays for `~1/(2*odom_rate)` per each `cmd_vel` calculation cycle. However, disabling this option for better performance is not recommended for the fast moving robots, where during the typical rate of data sources, robot could move unacceptably far. Thus reasonable odometry rates are recommended (~100 hz).
```

polygons
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | N/A |
```

```
Description:
:   List of zones to check for data points. Causes an error, if not specialized.
```

observation\_sources
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | N/A |
```

```
Description:
:   List of data sources (laser scanners, pointclouds, etc…). Causes an error, if not specialized.
```

###### Polygons parameters

`<polygon name>` is the corresponding polygon name ID selected for this type.

`<polygon_name>`.type
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description:
:   Type of polygon shape. Available values are `polygon`, `circle`. Causes an error, if not specialized.
```

`<polygon_name>`.points
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description:
:   Polygon vertices, listed in `"[[p1.x, p1.y], [p2.x, p2.y], [p3.x, p3.y], ...]"` format (e.g. `"[[0.5, 0.25], [0.5, -0.25], [0.0, -0.25], [0.0, 0.25]]"` for the square in the front). Used for `polygon` type. Minimum 3 points for a triangle polygon. If not specified, the collision detector will use dynamic polygon subscription to `polygon_sub_topic`
```

`<polygon_name>`.polygon\_sub\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description:
:   Topic to listen the polygon points from. Causes an error, if not specified **and** points are also not specified. If both `points` and `polygon_sub_topic` are specified, the static `points` takes priority.
```

`<polygon_name>`.radius
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | N/A |
```

```
Description:
:   Circle radius. Used for `circle` type. Causes an error, if not specialized.
```

`<polygon_name>`.action\_type
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description:
:   Only `none` action type is supported (more options available for collision monitor)
```

`<polygon_name>`.min\_points
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 4 |
```

```
Description:
:   Minimum number of data readings within a zone to trigger the action. Former `max_points` parameter for Humble, that meant the maximum number of data readings within a zone to not trigger the action). `min_points` is equal to `max_points + 1` value.
```

`<polygon_name>`.visualize
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description:
:   Whether to publish the polygon in a separate topic.
```

`<polygon_name>`.polygon\_pub\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | <polygon\_name> |
```

```
Description:
:   Topic name to publish a polygon to. Used only if `visualize` is true.
```

`<source name>`.enabled
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description:
:   Whether to use this source for collision detection. (Can be dynamically set)
```

###### Observation sources parameters

`<source name>` is the corresponding data source name ID selected for this type.

`<source name>`.type
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “scan” |
```

```
Description:
:   Type of polygon shape. Could be `scan`, `pointcloud`, `range` or `polygon`.
```

`<source name>`.transport\_type
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “raw” |
```

```
Description:
:   For `pointcloud` data, specify the transport plugin to use:
```

```
* raw: No compression. Default; highest bandwidth usage.
* draco: Lossy compression via Google.
* zlib: Lossless compression via Zlib compression.
* zstd: Lossless compression via Zstd compression.
```

```
See the [known transports](https://github.com/ros-perception/point_cloud_transport_plugins) for more details.
```

`<source name>`.topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “scan” |
```

```
Description:
:   Topic to listen the source data from.
```

`<source name>`.min\_height
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.05 |
```

```
Description:
:   Minimum height the PointCloud projection to 2D space started from. Applicable for `pointcloud` type.
```

`<source name>`.max\_height
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description:
:   Maximum height the PointCloud projection to 2D space ended with. Applicable for `pointcloud` type.
```

`<source name>`.obstacles\_angle
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | PI / 180 (1 degree) |
```

```
Description:
:   Angle increment (in radians) between nearby obstacle points at the range arc. Two outermost points from the field of view are not taken into account (they will always exist regardless of this value). Applicable for `range` type.
```

`<source name>`.sampling\_distance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
Description:
:   Internally the polygon is sampled for collision detection. sampling\_distance is the distance between sampled points of the polygon. Applicable for `polygon` source type.
```

`<source name>`.enabled
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description:
:   Whether to use this source for collision detection. (Can be dynamically set)
```

`<source name>`.source\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | (node parameter `source_timeout` value) |
```

```
Description:
:   Maximum time interval in which source data is considered as valid. If no new data is received within this interval, an additional warning will be displayed. Setting `source_timeout: 0.0` disables it. Overrides node parameter for each source individually, if desired.
```

bond\_heartbeat\_period
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
Description
:   The lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.
```

allow\_parameter\_qos\_overrides
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to allow QoS profiles to be overwritten with parameterized values.
```

###### Example

Here is an example of configuration YAML for the Collision Detector.

```
collision_detector:
  ros__parameters:
    base_frame_id: "base_footprint"
    odom_frame_id: "odom"
    transform_tolerance: 0.5
    source_timeout: 5.0
    base_shift_correction: True
    polygons: ["PolygonFront"]
    PolygonFront:
      type: "polygon"
      points: "[[0.3, 0.3], [0.3, -0.3], [0.0, -0.3], [0.0, 0.3]]"
      action_type: "none"
      min_points: 4
      visualize: True
      polygon_pub_topic: "polygon_front"
    observation_sources: ["scan"]
    scan:
      source_timeout: 0.2
      type: "scan"
      topic: "scan"
      enabled: True
    pointcloud:
      type: "pointcloud"
      topic: "/intel_realsense_r200_depth/points"
      transport_type: "raw"  # raw or/ with compression (zlib, draco, zstd)
      min_height: 0.1
      max_height: 0.5
      enabled: True
```

#### Parameters

**`frequency`**
- Type: `unknown`
- TypeDefaultdouble10.0Description:Frequency of the main loop that checks for detections.

**`base_frame_id`**
- Type: `unknown`
- TypeDefaultstring“base_footprint”Description:Robot base frame.

**`odom_frame_id`**
- Type: `unknown`
- TypeDefaultstring“odom”Description:Which frame to use for odometry.

**`transform_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.1DescriptionTime with which to post-date the transform that is published, to indicate that this transform is valid into the future.

**`source_timeout`**
- Type: `unknown`
- TypeDefaultdouble2.0Description:Maximum time interval in which source data is considered as valid. If no new data is received within this interval, an additional warning will be displayed. Settingsource_timeout:0.0disables it. This parameter can be overridden per observation source.

**`base_shift_correction`**
- Type: `unknown`
- TypeDefaultboolTrueDescription:Whether to correct source data towards to base frame movement, considering the difference between current time and latest source time. If enabled, produces more accurate sources positioning in the robot base frame, at the cost of slower performance. This will cause average delays for~1/(2*odom_rate)per eachcmd_velcalculation cycle. However, disabling this option for better performance is not recommended for the fast moving robots, where during the typical rate of data sources, robot could move unacceptably far. Thus reasonable odometry rates are recommended (~100 hz).

**`polygons`**
- Type: `unknown`
- TypeDefaultvector<string>N/ADescription:List of zones to check for data points. Causes an error, if not specialized.

**`observation_sources`**
- Type: `unknown`
- TypeDefaultvector<string>N/ADescription:List of data sources (laser scanners, pointclouds, etc…). Causes an error, if not specialized.

**`Description:`**
- Type: `unknown`
- Frequency of the main loop that checks for detections.

**`Description:`**
- Type: `unknown`
- Robot base frame.

**`Description:`**
- Type: `unknown`
- Which frame to use for odometry.

**`Description`**
- Type: `unknown`
- Time with which to post-date the transform that is published, to indicate that this transform is valid into the future.

**`Description:`**
- Type: `unknown`
- Maximum time interval in which source data is considered as valid. If no new data is received within this interval, an additional warning will be displayed. Settingsource_timeout:0.0disables it. This parameter can be overridden per observation source.

**`Description:`**
- Type: `unknown`
- Whether to correct source data towards to base frame movement, considering the difference between current time and latest source time. If enabled, produces more accurate sources positioning in the robot base frame, at the cost of slower performance. This will cause average delays for~1/(2*odom_rate)per eachcmd_velcalculation cycle. However, disabling this option for better performance is not recommended for the fast moving robots, where during the typical rate of data sources, robot could move unacceptably far. Thus reasonable odometry rates are recommended (~100 hz).

**`Description:`**
- Type: `unknown`
- List of zones to check for data points. Causes an error, if not specialized.

**`Description:`**
- Type: `unknown`
- List of data sources (laser scanners, pointclouds, etc…). Causes an error, if not specialized.

**`<polygon_name>.type`**
- Type: `unknown`
- TypeDefaultstringN/ADescription:Type of polygon shape. Available values arepolygon,circle. Causes an error, if not specialized.

**`<polygon_name>.points`**
- Type: `unknown`
- TypeDefaultstringN/ADescription:Polygon vertices, listed in"[[p1.x,p1.y],[p2.x,p2.y],[p3.x,p3.y],...]"format (e.g."[[0.5,0.25],[0.5,-0.25],[0.0,-0.25],[0.0,0.25]]"for the square in the front). Used forpolygontype. Minimum 3 points for a triangle polygon. If not specified, the collision detector will use dynamic polygon subscription topolygon_sub_topic

**`<polygon_name>.polygon_sub_topic`**
- Type: `unknown`
- TypeDefaultstringN/ADescription:Topic to listen the polygon points from. Causes an error, if not specifiedandpoints are also not specified. If bothpointsandpolygon_sub_topicare specified, the staticpointstakes priority.

**`<polygon_name>.radius`**
- Type: `unknown`
- TypeDefaultdoubleN/ADescription:Circle radius. Used forcircletype. Causes an error, if not specialized.

**`<polygon_name>.action_type`**
- Type: `unknown`
- TypeDefaultstringN/ADescription:Onlynoneaction type is supported (more options available for collision monitor)

**`<polygon_name>.min_points`**
- Type: `unknown`
- TypeDefaultint4Description:Minimum number of data readings within a zone to trigger the action. Formermax_pointsparameter for Humble, that meant the maximum number of data readings within a zone to not trigger the action).min_pointsis equal tomax_points+1value.

**`<polygon_name>.visualize`**
- Type: `unknown`
- TypeDefaultboolFalseDescription:Whether to publish the polygon in a separate topic.

**`<polygon_name>.polygon_pub_topic`**
- Type: `unknown`
- TypeDefaultstring<polygon_name>Description:Topic name to publish a polygon to. Used only ifvisualizeis true.

**`<sourcename>.enabled`**
- Type: `unknown`
- TypeDefaultboolTrueDescription:Whether to use this source for collision detection. (Can be dynamically set)

**`Description:`**
- Type: `unknown`
- Type of polygon shape. Available values arepolygon,circle. Causes an error, if not specialized.

**`Description:`**
- Type: `unknown`
- Polygon vertices, listed in"[[p1.x,p1.y],[p2.x,p2.y],[p3.x,p3.y],...]"format (e.g."[[0.5,0.25],[0.5,-0.25],[0.0,-0.25],[0.0,0.25]]"for the square in the front). Used forpolygontype. Minimum 3 points for a triangle polygon. If not specified, the collision detector will use dynamic polygon subscription topolygon_sub_topic

**`Description:`**
- Type: `unknown`
- Topic to listen the polygon points from. Causes an error, if not specifiedandpoints are also not specified. If bothpointsandpolygon_sub_topicare specified, the staticpointstakes priority.

**`Description:`**
- Type: `unknown`
- Circle radius. Used forcircletype. Causes an error, if not specialized.

**`Description:`**
- Type: `unknown`
- Onlynoneaction type is supported (more options available for collision monitor)

**`Description:`**
- Type: `unknown`
- Minimum number of data readings within a zone to trigger the action. Formermax_pointsparameter for Humble, that meant the maximum number of data readings within a zone to not trigger the action).min_pointsis equal tomax_points+1value.

**`Description:`**
- Type: `unknown`
- Whether to publish the polygon in a separate topic.

**`Description:`**
- Type: `unknown`
- Topic name to publish a polygon to. Used only ifvisualizeis true.

**`Description:`**
- Type: `unknown`
- Whether to use this source for collision detection. (Can be dynamically set)

**`<sourcename>.type`**
- Type: `unknown`
- TypeDefaultstring“scan”Description:Type of polygon shape. Could bescan,pointcloud,rangeorpolygon.

**`<sourcename>.transport_type`**
- Type: `unknown`
- TypeDefaultstring“raw”Description:Forpointclouddata, specify the transport plugin to use:raw: No compression. Default; highest bandwidth usage.draco: Lossy compression via Google.zlib: Lossless compression via Zlib compression.zstd: Lossless compression via Zstd compression.See theknown transportsfor more details.

**`<sourcename>.topic`**
- Type: `unknown`
- TypeDefaultstring“scan”Description:Topic to listen the source data from.

**`<sourcename>.min_height`**
- Type: `unknown`
- TypeDefaultdouble0.05Description:Minimum height the PointCloud projection to 2D space started from. Applicable forpointcloudtype.

**`<sourcename>.max_height`**
- Type: `unknown`
- TypeDefaultdouble0.5Description:Maximum height the PointCloud projection to 2D space ended with. Applicable forpointcloudtype.

**`<sourcename>.obstacles_angle`**
- Type: `unknown`
- TypeDefaultdoublePI / 180 (1 degree)Description:Angle increment (in radians) between nearby obstacle points at the range arc. Two outermost points from the field of view are not taken into account (they will always exist regardless of this value). Applicable forrangetype.

**`<sourcename>.sampling_distance`**
- Type: `unknown`
- TypeDefaultdouble0.1Description:Internally the polygon is sampled for collision detection. sampling_distance is the distance between sampled points of the polygon. Applicable forpolygonsource type.

**`<sourcename>.enabled`**
- Type: `unknown`
- TypeDefaultboolTrueDescription:Whether to use this source for collision detection. (Can be dynamically set)

**`<sourcename>.source_timeout`**
- Type: `unknown`
- TypeDefaultdouble(node parametersource_timeoutvalue)Description:Maximum time interval in which source data is considered as valid. If no new data is received within this interval, an additional warning will be displayed. Settingsource_timeout:0.0disables it. Overrides node parameter for each source individually, if desired.

**`bond_heartbeat_period`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionThe lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.

**`allow_parameter_qos_overrides`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to allow QoS profiles to be overwritten with parameterized values.

**`Description:`**
- Type: `unknown`
- Type of polygon shape. Could bescan,pointcloud,rangeorpolygon.

**`Description:`**
- Type: `unknown`
- Forpointclouddata, specify the transport plugin to use:

**`Description:`**
- Type: `unknown`
- Topic to listen the source data from.

**`Description:`**
- Type: `unknown`
- Minimum height the PointCloud projection to 2D space started from. Applicable forpointcloudtype.

**`Description:`**
- Type: `unknown`
- Maximum height the PointCloud projection to 2D space ended with. Applicable forpointcloudtype.

**`Description:`**
- Type: `unknown`
- Angle increment (in radians) between nearby obstacle points at the range arc. Two outermost points from the field of view are not taken into account (they will always exist regardless of this value). Applicable forrangetype.

**`Description:`**
- Type: `unknown`
- Internally the polygon is sampled for collision detection. sampling_distance is the distance between sampled points of the polygon. Applicable forpolygonsource type.

**`Description:`**
- Type: `unknown`
- Whether to use this source for collision detection. (Can be dynamically set)

**`Description:`**
- Type: `unknown`
- Maximum time interval in which source data is considered as valid. If no new data is received within this interval, an additional warning will be displayed. Settingsource_timeout:0.0disables it. Overrides node parameter for each source individually, if desired.

**`Description`**
- Type: `unknown`
- The lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.

**`Description`**
- Type: `unknown`
- Whether to allow QoS profiles to be overwritten with parameterized values.


---

##### Collision Monitor Node

*Source: [https://docs.nav2.org/configuration/packages/collision_monitor/configuring-collision-monitor-node.html](https://docs.nav2.org/configuration/packages/collision_monitor/configuring-collision-monitor-node.html)*

###### Collision Monitor Node

The Collision Monitor is a node providing an additional level of robot safety.
It performs several collision avoidance related tasks using incoming data from the sensors, bypassing the costmap and trajectory planners, to monitor for and prevent potential collisions at the emergency-stop level.

This is analogous to safety sensor and hardware features; take in laser scans from a real-time certified safety scanner, detect if there is to be an imminent collision in a configurable bounding box, and either emergency-stop the certified robot controller or slow the robot to avoid such collision.
However, this node is done at the CPU level with any form of sensor.
As such, this does not provide hard real-time safety certifications, but uses the same types of techniques with the same types of data for users that do not have safety-rated laser sensors, safety-rated controllers, or wish to use any type of data input (e.g. pointclouds from depth or stereo or range sensors).

This is a useful and integral part of large heavy industrial robots, or robots moving with high velocities, around people or other dynamic agents (e.g. other robots) as a safety mechanism for high-response emergency stopping.
The costmaps / trajectory planners will handle most situations, but this is to handle obstacles that virtually appear out of no where (from the robot’s perspective) or approach the robot at such high speed it needs to immediately stop to prevent collision.

See the package’s `README` for more complete information. For more information how to bring-up your own Collision Monitor node, please refer to the [Using Collision Monitor](../../../tutorials/docs/using_collision_monitor.html#collision-monitor-tutorial) tutorial.

Also, the practical demonstration of Collision Monitor abilities presented at 6th ROS Developers Day 2023, could be found below:


###### Features

The Collision Monitor uses polygons relative the robot’s base frame origin to define “zones”.
Data that fall into these zones trigger an operation depending on the model being used.
A given instance of the Collision Monitor can have many zones with different models at the same time.
When multiple zones trigger at once, the most aggressive one is used (e.g. stop > slow 50% > slow 10%).

The following models of safety behaviors are employed by Collision Monitor:

* **Stop model**: Define a zone and a point threshold. If `min_points` or more obstacle points appear inside this area, stop the robot until the obstacles will disappear.
* **Slowdown model**: Define a zone around the robot and slow the maximum speed for a `slowdown_ratio`, if `min_points` or more points will appear inside the area.
* **Limit model**: Define a zone around the robot and restricts the maximum linear and angular velocities to `linear_limit` and `angular_limit` values accordingly, if `min_points` or more points will appear inside the area.
* **Approach model**: Using the current robot speed, estimate the time to collision to sensor data. If the time is less than `time_before_collision` seconds (0.5, 2, 5, etc…), the robot will slow such that it is now at least `time_before_collision` seconds to collision. The effect here would be to keep the robot always `time_before_collision` seconds from any collision.

The zones around the robot can take the following shapes:

* Arbitrary user-defined polygon relative to the robot base frame, which can be static in a configuration file or dynamically changing via a topic interface.
* Robot footprint polygon, which is used in the approach behavior model only. Will use the static user-defined polygon or the footprint topic to allow it to be dynamically adjusted over time.
* Circle: is made for the best performance and could be used in the cases where the zone or robot footprint could be approximated by round shape.
* VelocityPolygon: allow switching of polygons based on the command velocity. This is useful for robots to set different safety zones based on their velocity (e.g. a robot that has a larger safety zone when moving at 1.0 m/s than when moving at 0.5 m/s).

All shapes (`Polygon`, `Circle` and `VelocityPolygon`) are derived from base `Polygon` class, so without loss of generality they would be called as “polygons”.
Subscribed footprint is also having the same properties as other polygons, but it is being obtained a footprint topic for the Approach Model.

The data may be obtained from different data sources:

* Laser scanners (`sensor_msgs::msg::LaserScan` messages)
* PointClouds (`sensor_msgs::msg::PointCloud2` messages)
* IR/Sonars (`sensor_msgs::msg::Range` messages)
* Costmap (`nav2_msgs::msg::Costmap` messages)

Warning

**⚠️ when using CostmapSource**
Collision Monitor normally **bypasses the costmap** to minimize reaction latency using fresh sensor data.
Use at your own caution or when using external costmap sources from derived sources.

###### Parameters

enabled
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description:
:   Sets the initial state. This can come in handy when the robot is docked/inside any of the zones at startup and the node needs to be disabled then.
    Please note that is not a dynamic parameter, there’s `/toggle` service interface
    and [BT Node](https://docs.nav2.org/configuration/packages/bt-plugins/actions/ToggleCollisionMonitor.html) to update this state later at runtime.
```

base\_frame\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “base\_footprint” |
```

```
Description:
:   Robot base frame.
```

odom\_frame\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “odom” |
```

```
Description:
:   Which frame to use for odometry.
```

cmd\_vel\_in\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “cmd\_vel\_smoothed” |
```

```
Description:
:   Input `cmd_vel` topic with desired robot velocity.
    Please note, pre-`Jazzy` this was set to `cmd_vel_raw` by default.
```

cmd\_vel\_out\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “cmd\_vel” |
```

```
Description:
:   Output `cmd_vel` topic with output produced by Collision Monitor velocities.
```

state\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “” |
```

```
Description:
:   Output the currently activated polygon action type and name. Optional parameter. No publisher will be created if it is unspecified.
```

transform\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
Description
:   Time with which to post-date the transform that is published, to indicate that this transform is valid into the future.
```

source\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description:
:   Maximum time interval in which source data is considered as valid. If no new data is received within this interval, the robot will be stopped. Setting `source_timeout: 0.0` disables this blocking mechanism. This parameter can be overridden per observation source.
```

base\_shift\_correction
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description:
:   Whether to correct source data towards to base frame movement, considering the difference between current time and latest source time. If enabled, produces more accurate sources positioning in the robot base frame, at the cost of slower performance. This will cause average delays for `~1/(2*odom_rate)` per each `cmd_vel` calculation cycle. However, disabling this option for better performance is not recommended for the fast moving robots, where during the typical rate of data sources, robot could move unacceptably far. Thus reasonable odometry rates are recommended (~100 hz).
```

stop\_pub\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description:
:   Timeout, after which zero-velocity ceases to be published. It could be used for other overrode systems outside Nav2 are trying to bring the robot out of a state close to a collision, or to allow a standing robot to go into sleep mode.
```

polygons
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | N/A |
```

```
Description:
:   List of zones (stop/slowdown/limit bounding boxes, footprint, approach circle, etc…). Causes an error, if not specialized.
```

observation\_sources
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | N/A |
```

```
Description:
:   List of data sources (laser scanners, pointclouds, etc…). Causes an error, if not specialized.
```

use\_realtime\_priority
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Adds soft real-time prioritization to the controller server to better ensure resources to time sensitive portions of the codebase. This will set the controller’s execution thread to a higher priority than the rest of the system (`90`) to meet scheduling deadlines to have less missed loop rates. To use this feature, you use set the following inside of `/etc/security/limits.conf` to give userspace access to elevated prioritization permissions: `<username> soft rtprio 99 <username> hard rtprio 99`
```

enable\_stamped\_cmd\_vel
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to use geometry\_msgs::msg::Twist or geometry\_msgs::msg::TwistStamped velocity data.
    True uses TwistStamped, false uses Twist.
    Note: This parameter is default `false` in Jazzy or older! Kilted or newer uses `TwistStamped` by default.
```

###### Polygons parameters

`<polygon name>` is the corresponding polygon name ID selected for this type.

`<polygon_name>`.type
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description:
:   Type of polygon shape. Available values are `polygon`, `circle`. Causes an error, if not specialized.
```

`<polygon_name>`.points
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description:
:   Polygon vertices, listed in `"[[p1.x, p1.y], [p2.x, p2.y], [p3.x, p3.y], ...]"` format (e.g. `"[[0.5, 0.25], [0.5, -0.25], [0.0, -0.25], [0.0, 0.25]]"` for the square in the front). Used for `polygon` type. Minimum 3 points for a triangle polygon. If not specified, the collision monitor will use dynamic polygon subscription to `polygon_sub_topic` for points in the `stop`/`slowdown`/`limit` action types, or footprint subscriber to `footprint_topic` for `approach` action type.
```

`<polygon_name>`.polygon\_sub\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description:
:   For `polygon` type, topic to listen the polygon points from. For `circle` type, topic to listen the circle radius from. Applicable for `stop`/`slowdown`/`limit` action types. Causes an error if not specified **and** static polygon geometry (using parameter `points` for `polygon` type or `radius` for `circle` type) is also not specified. If both static polygon geometry and `polygon_sub_topic` are specified, the static parameter takes priority.
```

`<polygon_name>`.footprint\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “local\_costmap/published\_footprint” |
```

```
Description:
:   Topic to listen the robot footprint from. Applicable only for `polygon` type and `approach` action type. If both `points` and `footprint_topic` are specified, the static `points` takes priority.
```

`<polygon_name>`.polygon\_subscribe\_transient\_local
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description:
:   QoS durability setting for the incoming polygon or footprint topic subscription.
```

`<polygon_name>`.radius
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | N/A |
```

```
Description:
:   Circle radius. Used for `circle` type. If not specified, the collision monitor will use dynamic polygon subscription to `polygon_sub_topic` for circle radius in the `stop`/`slowdown`/`limit` action types.
```

`<polygon_name>`.action\_type
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description:
:   Zone behavior model. Available values are `stop`, `slowdown`, `limit`, `approach`. Causes an error, if not specialized.
```

`<polygon_name>`.min\_points
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 4 |
```

```
Description:
:   Minimum number of data readings within a zone to trigger the action. Former `max_points` parameter for Humble, that meant the maximum number of data readings within a zone to not trigger the action). `min_points` is equal to `max_points + 1` value.
```

`<polygon_name>`.slowdown\_ratio
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description:
:   Robot slowdown (share of its actual speed). Applicable for `slowdown` action type.
```

`<polygon_name>`.linear\_limit
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description:
:   Robot linear speed limit. Applicable for `limit` action type.
```

`<polygon_name>`.angular\_limit
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description:
:   Robot angular speed limit. Applicable for `limit` action type.
```

`<polygon_name>`.time\_before\_collision
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description:
:   Time before collision in seconds. Maximum simulation time used in collision prediction. Higher values mean lower performance. Applicable for `approach` action type.
```

`<polygon_name>`.simulation\_time\_step
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
Description:
:   Time iteration step for robot movement simulation during collision prediction. Higher values mean lower prediction accuracy but better performance. Applicable for `approach` action type.
```

`<polygon_name>`.visualize
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description:
:   Whether to publish the polygon in a separate topic.
```

`<polygon_name>`.polygon\_pub\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | <polygon\_name> |
```

```
Description:
:   Topic name to publish a polygon to. Used only if `visualize` is true.
```

`<polygon_name name>`.enabled
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description:
:   Whether to use this polygon for collision monitoring. (Can be dynamically set)
```

###### VelocityPolygon parameters

All previous Polygon parameters apply, in addition to the following unique parameters for VelocityPolygon.

`<vel_poly>`.holonomic
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description:
:   Whether to use holonomic or non-holonomic robot model for collision prediction. For holonomic robot model, the resultant velocity will be used to compare the linear velocity range. Additionally, there will be 2 more parameters, `direction_start_angle` and `direction_end_angle`, to specify the resultant velocity direction.
```

`<vel_poly>`.velocity\_polygons
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | N/A |
```

```
Description:
:   List of sub polygons for switching based on the robot’s current velocity. When velocity is covered by multiple sub polygons, the first sub polygon in the list will be used. Causes an error, if not specified.
```

`<vel_poly>.<subpoly>`.points
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | N/A |
```

```
Description:
:   Polygon vertices, listed in `"[[p1.x, p1.y], [p2.x, p2.y], [p3.x, p3.y], ...]"` format (e.g. `"[[0.5, 0.25], [0.5, -0.25], [0.0, -0.25], [0.0, 0.25]]"` for the square in the front). Used for `polygon` type. Minimum 3 points for a triangle polygon. Causes an error, if not specified.
```

`<vel_poly>.<subpoly>`.linear\_min
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | N/A |
```

```
Description:
:   Minimum linear velocity for the sub polygon. In holonomic mode, this is the minimum resultant velocity. Causes an error, if not specified.
```

`<vel_poly>.<subpoly>`.linear\_max
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | N/A |
```

```
Description:
:   Maximum linear velocity for the sub polygon. In holonomic mode, this is the maximum resultant velocity. Causes an error, if not specified.
```

`<vel_poly>.<subpoly>`.theta\_min
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | N/A |
```

```
Description:
:   Minimum angular velocity for the sub polygon. Causes an error, if not specified.
```

`<vel_poly>.<subpoly>`.theta\_max
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | N/A |
```

```
Description:
:   Maximum angular velocity for the sub polygon. Causes an error, if not specified.
```

`<vel_poly>.<subpoly>`.direction\_start\_angle
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | -PI |
```

```
Description:
:   Start angle of the movement direction(for holomic robot only). Refer to the [Example](#example) section for the common configurations. Applicable for holonomic mode only.
```

`<vel_poly>.<subpoly>`.direction\_end\_angle
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | PI |
```

```
Description:
:   End angle of the movement direction(for holomic robot only). Refer to the [Example](#example) section for the common configurations. Applicable for holonomic mode only.
```

###### Observation sources parameters

`<source name>` is the corresponding data source name ID selected for this type.

`<source name>`.type
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “scan” |
```

```
Description:
:   Type of polygon shape. Could be `scan`, `pointcloud`, `range`, `polygon` or `costmap`.
```

`<source name>`.transport\_type
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “raw” |
```

```
Description:
:   For `pointcloud` data, specify the transport plugin to use:
```

```
* raw: No compression. Default; highest bandwidth usage.
* draco: Lossy compression via Google.
* zlib: Lossless compression via Zlib compression.
* zstd: Lossless compression via Zstd compression.
```

```
See the [known transports](https://github.com/ros-perception/point_cloud_transport_plugins) for more details.
```

`<source name>`.topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “scan” |
```

```
Description:
:   Topic to listen the source data from.
```

`<source name>`.min\_height
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.05 |
```

```
Description:
:   Minimum height the PointCloud projection to 2D space started from. Applicable for `pointcloud` type.
```

`<source name>`.max\_height
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description:
:   Maximum height the PointCloud projection to 2D space ended with. Applicable for `pointcloud` type.
```

`<source name>`.use\_global\_height
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description:
:   Set true for pointcloud sources containing a “height” field relative to a real world ground contour. The “height” field will be used for the min and max height checks instead of the “z” field and will not be transformed as it is assumed that height is already global frame referenced. Applicable for `pointcloud` type.
```

`<source name>`.min\_range
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description:
:   Minimum range threshold for PointCloud points. Points closer than this distance (measured as Euclidean distance from sensor origin) will be filtered out before processing. Useful for eliminating noise and invalid readings very close to the sensor. Applicable for `pointcloud` type.
```

`<source name>`.obstacles\_angle
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | PI / 180 (1 degree) |
```

```
Description:
:   Angle increment (in radians) between nearby obstacle points at the range arc. Two outermost points from the field of view are not taken into account (they will always exist regardless of this value). Applicable for `range` type.
```

`<source name>`.sampling\_distance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
Description:
:   Internally the polygon is sampled for collision detection. sampling\_distance is the distance between sampled points of the polygon. Applicable for `polygon` source type.
```

`<source name>`.enabled
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description:
:   Whether to use this source for collision monitoring. (Can be dynamically set)
```

`<source name>`.source\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | (node parameter `source_timeout` value) |
```

```
Description:
:   Maximum time interval in which source data is considered as valid. If no new data is received within this interval, the robot will be stopped. Setting `source_timeout: 0.0` disables this blocking mechanism. Overrides node parameter for each source individually, if desired.
```

`<source name>`.cost\_threshold
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 253 |
```

```
Description:
:   For `costmap` sources only. Minimum cell cost (0–255) to be treated as an
    obstacle. By default this matches inscribed/lethal cells (253–254) and ignores
    lower-cost cells.
```

`<source name>`.treat\_unknown\_as\_obstacle
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description:
:   For `costmap` sources only. If `true`, cells with cost `255` (`NO_INFORMATION`)
    will also be turned into obstacle points. Set to `false` if your costmap has
    large unknown areas you don’t want to trigger Collision Monitor.
```

bond\_heartbeat\_period
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
Description
:   The lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.
```

allow\_parameter\_qos\_overrides
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to allow QoS profiles to be overwritten with parameterized values.
```

###### Example

Here is an example illustrating the common configurations for holonomic robots that cover multiple directions of the resultant velocity:

[![../../../_images/holonomic_examples.png](../../../_images/holonomic_examples.png)](../../../_images/holonomic_examples.png)

Here is an example of configuration YAML for the Collision Monitor.

```
collision_monitor:
  ros__parameters:
    enabled: True
    base_frame_id: "base_footprint"
    odom_frame_id: "odom"
    cmd_vel_in_topic: "cmd_vel_smoothed"
    cmd_vel_out_topic: "cmd_vel"
    state_topic: "collision_monitor_state"
    transform_tolerance: 0.5
    source_timeout: 5.0
    base_shift_correction: True
    stop_pub_timeout: 2.0
    enable_stamped_cmd_vel: True  # False for Jazzy or older
    use_realtime_priority: false
    polygons: ["PolygonStop", "PolygonSlow", "FootprintApproach"]
    PolygonStop:
      type: "circle"
      radius: 0.3
      action_type: "stop"
      min_points: 4  # max_points: 3 for Humble
      visualize: True
      polygon_pub_topic: "polygon_stop"
      enabled: True
    PolygonSlow:
      type: "polygon"
      points: "[[1.0, 1.0], [1.0, -1.0], [-0.5, -1.0], [-0.5, 1.0]]"
      action_type: "slowdown"
      min_points: 4  # max_points: 3 for Humble
      slowdown_ratio: 0.3
      visualize: True
      polygon_pub_topic: "polygon_slowdown"
      enabled: True
    PolygonLimit:
      type: "polygon"
      points: "[[0.5, 0.5], [0.5, -0.5], [-0.5, -0.5], [-0.5, 0.5]]"
      action_type: "limit"
      min_points: 4  # max_points: 3 for Humble
      linear_limit: 0.4
      angular_limit: 0.5
      visualize: True
      polygon_pub_topic: "polygon_limit"
      enabled: True
    FootprintApproach:
      type: "polygon"
      action_type: "approach"
      footprint_topic: "/local_costmap/published_footprint"
      time_before_collision: 2.0
      simulation_time_step: 0.02
      min_points: 6  # max_points: 5 for Humble
      visualize: False
      enabled: True
    VelocityPolygonStop:
      type: "velocity_polygon"
      action_type: "stop"
      min_points: 6
      visualize: True
      enabled: True
      polygon_pub_topic: "velocity_polygon_stop"
      velocity_polygons: ["rotation", "translation_forward", "translation_backward", "stopped"]
      holonomic: false
      rotation:
        points: "[[0.3, 0.3], [0.3, -0.3], [-0.3, -0.3], [-0.3, 0.3]]"
        linear_min: 0.0
        linear_max: 0.05
        theta_min: -1.0
        theta_max: 1.0
      translation_forward:
        points: "[[0.35, 0.3], [0.35, -0.3], [-0.2, -0.3], [-0.2, 0.3]]"
        linear_min: 0.0
        linear_max: 1.0
        theta_min: -1.0
        theta_max: 1.0
      translation_backward:
        points: "[[0.2, 0.3], [0.2, -0.3], [-0.35, -0.3], [-0.35, 0.3]]"
        linear_min: -1.0
        linear_max: 0.0
        theta_min: -1.0
        theta_max: 1.0
      # This is the last polygon to be checked, it should cover the entire range of robot's velocities
      # It is used as the stopped polygon when the robot is not moving and as a fallback if the velocity
      # is not covered by any of the other sub-polygons
      stopped:
        points: "[[0.25, 0.25], [0.25, -0.25], [-0.25, -0.25], [-0.25, 0.25]]"
        linear_min: -1.0
        linear_max: 1.0
        theta_min: -1.0
        theta_max: 1.0
    observation_sources: ["scan", "pointcloud"]
    scan:
      source_timeout: 0.2
      type: "scan"
      topic: "/scan"
      enabled: True
    pointcloud:
      type: "pointcloud"
      topic: "/intel_realsense_r200_depth/points"
      transport_type: "raw"  # raw or/ with compression (zlib, draco, zstd)
      min_height: 0.1
      max_height: 0.5
      min_range: 0.2
      enabled: True
    # costmap:
    #   type: "costmap"   # relative, respects namespaces
    #   topic: "local_costmap/costmap"
    #   cost_threshold: 254
    #   enabled: True
    #   treat_unknown_as_obstacle: True
```

#### Parameters

**`enabled`**
- Type: `unknown`
- TypeDefaultboolTrueDescription:Sets the initial state. This can come in handy when the robot is docked/inside any of the zones at startup and the node needs to be disabled then.
Please note that is not a dynamic parameter, there’s/toggleservice interface
andBT Nodeto update this state later at runtime.

**`base_frame_id`**
- Type: `unknown`
- TypeDefaultstring“base_footprint”Description:Robot base frame.

**`odom_frame_id`**
- Type: `unknown`
- TypeDefaultstring“odom”Description:Which frame to use for odometry.

**`cmd_vel_in_topic`**
- Type: `unknown`
- TypeDefaultstring“cmd_vel_smoothed”Description:Inputcmd_veltopic with desired robot velocity.
Please note, pre-Jazzythis was set tocmd_vel_rawby default.

**`cmd_vel_out_topic`**
- Type: `unknown`
- TypeDefaultstring“cmd_vel”Description:Outputcmd_veltopic with output produced by Collision Monitor velocities.

**`state_topic`**
- Type: `unknown`
- TypeDefaultstring“”Description:Output the currently activated polygon action type and name. Optional parameter. No publisher will be created if it is unspecified.

**`transform_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.1DescriptionTime with which to post-date the transform that is published, to indicate that this transform is valid into the future.

**`source_timeout`**
- Type: `unknown`
- TypeDefaultdouble2.0Description:Maximum time interval in which source data is considered as valid. If no new data is received within this interval, the robot will be stopped. Settingsource_timeout:0.0disables this blocking mechanism. This parameter can be overridden per observation source.

**`base_shift_correction`**
- Type: `unknown`
- TypeDefaultboolTrueDescription:Whether to correct source data towards to base frame movement, considering the difference between current time and latest source time. If enabled, produces more accurate sources positioning in the robot base frame, at the cost of slower performance. This will cause average delays for~1/(2*odom_rate)per eachcmd_velcalculation cycle. However, disabling this option for better performance is not recommended for the fast moving robots, where during the typical rate of data sources, robot could move unacceptably far. Thus reasonable odometry rates are recommended (~100 hz).

**`stop_pub_timeout`**
- Type: `unknown`
- TypeDefaultdouble1.0Description:Timeout, after which zero-velocity ceases to be published. It could be used for other overrode systems outside Nav2 are trying to bring the robot out of a state close to a collision, or to allow a standing robot to go into sleep mode.

**`polygons`**
- Type: `unknown`
- TypeDefaultvector<string>N/ADescription:List of zones (stop/slowdown/limit bounding boxes, footprint, approach circle, etc…). Causes an error, if not specialized.

**`observation_sources`**
- Type: `unknown`
- TypeDefaultvector<string>N/ADescription:List of data sources (laser scanners, pointclouds, etc…). Causes an error, if not specialized.

**`use_realtime_priority`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionAdds soft real-time prioritization to the controller server to better ensure resources to time sensitive portions of the codebase. This will set the controller’s execution thread to a higher priority than the rest of the system (90) to meet scheduling deadlines to have less missed loop rates. To use this feature, you use set the following inside of/etc/security/limits.confto give userspace access to elevated prioritization permissions:<username>softrtprio99<username>hardrtprio99

**`enable_stamped_cmd_vel`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to use geometry_msgs::msg::Twist or geometry_msgs::msg::TwistStamped velocity data.
True uses TwistStamped, false uses Twist.
Note: This parameter is defaultfalsein Jazzy or older! Kilted or newer usesTwistStampedby default.

**`Description:`**
- Type: `unknown`
- Sets the initial state. This can come in handy when the robot is docked/inside any of the zones at startup and the node needs to be disabled then.
Please note that is not a dynamic parameter, there’s/toggleservice interface
andBT Nodeto update this state later at runtime.

**`Description:`**
- Type: `unknown`
- Robot base frame.

**`Description:`**
- Type: `unknown`
- Which frame to use for odometry.

**`Description:`**
- Type: `unknown`
- Inputcmd_veltopic with desired robot velocity.
Please note, pre-Jazzythis was set tocmd_vel_rawby default.

**`Description:`**
- Type: `unknown`
- Outputcmd_veltopic with output produced by Collision Monitor velocities.

**`Description:`**
- Type: `unknown`
- Output the currently activated polygon action type and name. Optional parameter. No publisher will be created if it is unspecified.

**`Description`**
- Type: `unknown`
- Time with which to post-date the transform that is published, to indicate that this transform is valid into the future.

**`Description:`**
- Type: `unknown`
- Maximum time interval in which source data is considered as valid. If no new data is received within this interval, the robot will be stopped. Settingsource_timeout:0.0disables this blocking mechanism. This parameter can be overridden per observation source.

**`Description:`**
- Type: `unknown`
- Whether to correct source data towards to base frame movement, considering the difference between current time and latest source time. If enabled, produces more accurate sources positioning in the robot base frame, at the cost of slower performance. This will cause average delays for~1/(2*odom_rate)per eachcmd_velcalculation cycle. However, disabling this option for better performance is not recommended for the fast moving robots, where during the typical rate of data sources, robot could move unacceptably far. Thus reasonable odometry rates are recommended (~100 hz).

**`Description:`**
- Type: `unknown`
- Timeout, after which zero-velocity ceases to be published. It could be used for other overrode systems outside Nav2 are trying to bring the robot out of a state close to a collision, or to allow a standing robot to go into sleep mode.

**`Description:`**
- Type: `unknown`
- List of zones (stop/slowdown/limit bounding boxes, footprint, approach circle, etc…). Causes an error, if not specialized.

**`Description:`**
- Type: `unknown`
- List of data sources (laser scanners, pointclouds, etc…). Causes an error, if not specialized.

**`Description`**
- Type: `unknown`
- Adds soft real-time prioritization to the controller server to better ensure resources to time sensitive portions of the codebase. This will set the controller’s execution thread to a higher priority than the rest of the system (90) to meet scheduling deadlines to have less missed loop rates. To use this feature, you use set the following inside of/etc/security/limits.confto give userspace access to elevated prioritization permissions:<username>softrtprio99<username>hardrtprio99

**`Description`**
- Type: `unknown`
- Whether to use geometry_msgs::msg::Twist or geometry_msgs::msg::TwistStamped velocity data.
True uses TwistStamped, false uses Twist.
Note: This parameter is defaultfalsein Jazzy or older! Kilted or newer usesTwistStampedby default.

**`<polygon_name>.type`**
- Type: `unknown`
- TypeDefaultstringN/ADescription:Type of polygon shape. Available values arepolygon,circle. Causes an error, if not specialized.

**`<polygon_name>.points`**
- Type: `unknown`
- TypeDefaultstringN/ADescription:Polygon vertices, listed in"[[p1.x,p1.y],[p2.x,p2.y],[p3.x,p3.y],...]"format (e.g."[[0.5,0.25],[0.5,-0.25],[0.0,-0.25],[0.0,0.25]]"for the square in the front). Used forpolygontype. Minimum 3 points for a triangle polygon. If not specified, the collision monitor will use dynamic polygon subscription topolygon_sub_topicfor points in thestop/slowdown/limitaction types, or footprint subscriber tofootprint_topicforapproachaction type.

**`<polygon_name>.polygon_sub_topic`**
- Type: `unknown`
- TypeDefaultstringN/ADescription:Forpolygontype, topic to listen the polygon points from. Forcircletype, topic to listen the circle radius from. Applicable forstop/slowdown/limitaction types. Causes an error if not specifiedandstatic polygon geometry (using parameterpointsforpolygontype orradiusforcircletype) is also not specified. If both static polygon geometry andpolygon_sub_topicare specified, the static parameter takes priority.

**`<polygon_name>.footprint_topic`**
- Type: `unknown`
- TypeDefaultstring“local_costmap/published_footprint”Description:Topic to listen the robot footprint from. Applicable only forpolygontype andapproachaction type. If bothpointsandfootprint_topicare specified, the staticpointstakes priority.

**`<polygon_name>.polygon_subscribe_transient_local`**
- Type: `unknown`
- TypeDefaultboolFalseDescription:QoS durability setting for the incoming polygon or footprint topic subscription.

**`<polygon_name>.radius`**
- Type: `unknown`
- TypeDefaultdoubleN/ADescription:Circle radius. Used forcircletype. If not specified, the collision monitor will use dynamic polygon subscription topolygon_sub_topicfor circle radius in thestop/slowdown/limitaction types.

**`<polygon_name>.action_type`**
- Type: `unknown`
- TypeDefaultstringN/ADescription:Zone behavior model. Available values arestop,slowdown,limit,approach. Causes an error, if not specialized.

**`<polygon_name>.min_points`**
- Type: `unknown`
- TypeDefaultint4Description:Minimum number of data readings within a zone to trigger the action. Formermax_pointsparameter for Humble, that meant the maximum number of data readings within a zone to not trigger the action).min_pointsis equal tomax_points+1value.

**`<polygon_name>.slowdown_ratio`**
- Type: `unknown`
- TypeDefaultdouble0.5Description:Robot slowdown (share of its actual speed). Applicable forslowdownaction type.

**`<polygon_name>.linear_limit`**
- Type: `unknown`
- TypeDefaultdouble0.5Description:Robot linear speed limit. Applicable forlimitaction type.

**`<polygon_name>.angular_limit`**
- Type: `unknown`
- TypeDefaultdouble0.5Description:Robot angular speed limit. Applicable forlimitaction type.

**`<polygon_name>.time_before_collision`**
- Type: `unknown`
- TypeDefaultdouble2.0Description:Time before collision in seconds. Maximum simulation time used in collision prediction. Higher values mean lower performance. Applicable forapproachaction type.

**`<polygon_name>.simulation_time_step`**
- Type: `unknown`
- TypeDefaultdouble0.1Description:Time iteration step for robot movement simulation during collision prediction. Higher values mean lower prediction accuracy but better performance. Applicable forapproachaction type.

**`<polygon_name>.visualize`**
- Type: `unknown`
- TypeDefaultboolFalseDescription:Whether to publish the polygon in a separate topic.

**`<polygon_name>.polygon_pub_topic`**
- Type: `unknown`
- TypeDefaultstring<polygon_name>Description:Topic name to publish a polygon to. Used only ifvisualizeis true.

**`<polygon_namename>.enabled`**
- Type: `unknown`
- TypeDefaultboolTrueDescription:Whether to use this polygon for collision monitoring. (Can be dynamically set)

**`Description:`**
- Type: `unknown`
- Type of polygon shape. Available values arepolygon,circle. Causes an error, if not specialized.

**`Description:`**
- Type: `unknown`
- Polygon vertices, listed in"[[p1.x,p1.y],[p2.x,p2.y],[p3.x,p3.y],...]"format (e.g."[[0.5,0.25],[0.5,-0.25],[0.0,-0.25],[0.0,0.25]]"for the square in the front). Used forpolygontype. Minimum 3 points for a triangle polygon. If not specified, the collision monitor will use dynamic polygon subscription topolygon_sub_topicfor points in thestop/slowdown/limitaction types, or footprint subscriber tofootprint_topicforapproachaction type.

**`Description:`**
- Type: `unknown`
- Forpolygontype, topic to listen the polygon points from. Forcircletype, topic to listen the circle radius from. Applicable forstop/slowdown/limitaction types. Causes an error if not specifiedandstatic polygon geometry (using parameterpointsforpolygontype orradiusforcircletype) is also not specified. If both static polygon geometry andpolygon_sub_topicare specified, the static parameter takes priority.

**`Description:`**
- Type: `unknown`
- Topic to listen the robot footprint from. Applicable only forpolygontype andapproachaction type. If bothpointsandfootprint_topicare specified, the staticpointstakes priority.

**`Description:`**
- Type: `unknown`
- QoS durability setting for the incoming polygon or footprint topic subscription.

**`Description:`**
- Type: `unknown`
- Circle radius. Used forcircletype. If not specified, the collision monitor will use dynamic polygon subscription topolygon_sub_topicfor circle radius in thestop/slowdown/limitaction types.

**`Description:`**
- Type: `unknown`
- Zone behavior model. Available values arestop,slowdown,limit,approach. Causes an error, if not specialized.

**`Description:`**
- Type: `unknown`
- Minimum number of data readings within a zone to trigger the action. Formermax_pointsparameter for Humble, that meant the maximum number of data readings within a zone to not trigger the action).min_pointsis equal tomax_points+1value.

**`Description:`**
- Type: `unknown`
- Robot slowdown (share of its actual speed). Applicable forslowdownaction type.

**`Description:`**
- Type: `unknown`
- Robot linear speed limit. Applicable forlimitaction type.

**`Description:`**
- Type: `unknown`
- Robot angular speed limit. Applicable forlimitaction type.

**`Description:`**
- Type: `unknown`
- Time before collision in seconds. Maximum simulation time used in collision prediction. Higher values mean lower performance. Applicable forapproachaction type.

**`Description:`**
- Type: `unknown`
- Time iteration step for robot movement simulation during collision prediction. Higher values mean lower prediction accuracy but better performance. Applicable forapproachaction type.

**`Description:`**
- Type: `unknown`
- Whether to publish the polygon in a separate topic.

**`Description:`**
- Type: `unknown`
- Topic name to publish a polygon to. Used only ifvisualizeis true.

**`Description:`**
- Type: `unknown`
- Whether to use this polygon for collision monitoring. (Can be dynamically set)

**`<vel_poly>.holonomic`**
- Type: `unknown`
- TypeDefaultboolFalseDescription:Whether to use holonomic or non-holonomic robot model for collision prediction. For holonomic robot model, the resultant velocity will be used to compare the linear velocity range. Additionally, there will be 2 more parameters,direction_start_angleanddirection_end_angle, to specify the resultant velocity direction.

**`<vel_poly>.velocity_polygons`**
- Type: `unknown`
- TypeDefaultvector<string>N/ADescription:List of sub polygons for switching based on the robot’s current velocity. When velocity is covered by multiple sub polygons, the first sub polygon in the list will be used. Causes an error, if not specified.

**`<vel_poly>.<subpoly>.points`**
- Type: `unknown`
- TypeDefaultvector<string>N/ADescription:Polygon vertices, listed in"[[p1.x,p1.y],[p2.x,p2.y],[p3.x,p3.y],...]"format (e.g."[[0.5,0.25],[0.5,-0.25],[0.0,-0.25],[0.0,0.25]]"for the square in the front). Used forpolygontype. Minimum 3 points for a triangle polygon. Causes an error, if not specified.

**`<vel_poly>.<subpoly>.linear_min`**
- Type: `unknown`
- TypeDefaultdoubleN/ADescription:Minimum linear velocity for the sub polygon. In holonomic mode, this is the minimum resultant velocity. Causes an error, if not specified.

**`<vel_poly>.<subpoly>.linear_max`**
- Type: `unknown`
- TypeDefaultdoubleN/ADescription:Maximum linear velocity for the sub polygon. In holonomic mode, this is the maximum resultant velocity. Causes an error, if not specified.

**`<vel_poly>.<subpoly>.theta_min`**
- Type: `unknown`
- TypeDefaultdoubleN/ADescription:Minimum angular velocity for the sub polygon. Causes an error, if not specified.

**`<vel_poly>.<subpoly>.theta_max`**
- Type: `unknown`
- TypeDefaultdoubleN/ADescription:Maximum angular velocity for the sub polygon. Causes an error, if not specified.

**`<vel_poly>.<subpoly>.direction_start_angle`**
- Type: `unknown`
- TypeDefaultdouble-PIDescription:Start angle of the movement direction(for holomic robot only). Refer to theExamplesection for the common configurations. Applicable forholonomicmode only.

**`<vel_poly>.<subpoly>.direction_end_angle`**
- Type: `unknown`
- TypeDefaultdoublePIDescription:End angle of the movement direction(for holomic robot only). Refer to theExamplesection for the common configurations. Applicable forholonomicmode only.

**`Description:`**
- Type: `unknown`
- Whether to use holonomic or non-holonomic robot model for collision prediction. For holonomic robot model, the resultant velocity will be used to compare the linear velocity range. Additionally, there will be 2 more parameters,direction_start_angleanddirection_end_angle, to specify the resultant velocity direction.

**`Description:`**
- Type: `unknown`
- List of sub polygons for switching based on the robot’s current velocity. When velocity is covered by multiple sub polygons, the first sub polygon in the list will be used. Causes an error, if not specified.

**`Description:`**
- Type: `unknown`
- Polygon vertices, listed in"[[p1.x,p1.y],[p2.x,p2.y],[p3.x,p3.y],...]"format (e.g."[[0.5,0.25],[0.5,-0.25],[0.0,-0.25],[0.0,0.25]]"for the square in the front). Used forpolygontype. Minimum 3 points for a triangle polygon. Causes an error, if not specified.

**`Description:`**
- Type: `unknown`
- Minimum linear velocity for the sub polygon. In holonomic mode, this is the minimum resultant velocity. Causes an error, if not specified.

**`Description:`**
- Type: `unknown`
- Maximum linear velocity for the sub polygon. In holonomic mode, this is the maximum resultant velocity. Causes an error, if not specified.

**`Description:`**
- Type: `unknown`
- Minimum angular velocity for the sub polygon. Causes an error, if not specified.

**`Description:`**
- Type: `unknown`
- Maximum angular velocity for the sub polygon. Causes an error, if not specified.

**`Description:`**
- Type: `unknown`
- Start angle of the movement direction(for holomic robot only). Refer to theExamplesection for the common configurations. Applicable forholonomicmode only.

**`Description:`**
- Type: `unknown`
- End angle of the movement direction(for holomic robot only). Refer to theExamplesection for the common configurations. Applicable forholonomicmode only.

**`<sourcename>.type`**
- Type: `unknown`
- TypeDefaultstring“scan”Description:Type of polygon shape. Could bescan,pointcloud,range,polygonorcostmap.

**`<sourcename>.transport_type`**
- Type: `unknown`
- TypeDefaultstring“raw”Description:Forpointclouddata, specify the transport plugin to use:raw: No compression. Default; highest bandwidth usage.draco: Lossy compression via Google.zlib: Lossless compression via Zlib compression.zstd: Lossless compression via Zstd compression.See theknown transportsfor more details.

**`<sourcename>.topic`**
- Type: `unknown`
- TypeDefaultstring“scan”Description:Topic to listen the source data from.

**`<sourcename>.min_height`**
- Type: `unknown`
- TypeDefaultdouble0.05Description:Minimum height the PointCloud projection to 2D space started from. Applicable forpointcloudtype.

**`<sourcename>.max_height`**
- Type: `unknown`
- TypeDefaultdouble0.5Description:Maximum height the PointCloud projection to 2D space ended with. Applicable forpointcloudtype.

**`<sourcename>.use_global_height`**
- Type: `unknown`
- TypeDefaultboolfalseDescription:Set true for pointcloud sources containing a “height” field relative to a real world ground contour. The “height” field will be used for the min and max height checks instead of the “z” field and will not be transformed as it is assumed that height is already global frame referenced. Applicable forpointcloudtype.

**`<sourcename>.min_range`**
- Type: `unknown`
- TypeDefaultdouble0.0Description:Minimum range threshold for PointCloud points. Points closer than this distance (measured as Euclidean distance from sensor origin) will be filtered out before processing. Useful for eliminating noise and invalid readings very close to the sensor. Applicable forpointcloudtype.

**`<sourcename>.obstacles_angle`**
- Type: `unknown`
- TypeDefaultdoublePI / 180 (1 degree)Description:Angle increment (in radians) between nearby obstacle points at the range arc. Two outermost points from the field of view are not taken into account (they will always exist regardless of this value). Applicable forrangetype.

**`<sourcename>.sampling_distance`**
- Type: `unknown`
- TypeDefaultdouble0.1Description:Internally the polygon is sampled for collision detection. sampling_distance is the distance between sampled points of the polygon. Applicable forpolygonsource type.

**`<sourcename>.enabled`**
- Type: `unknown`
- TypeDefaultboolTrueDescription:Whether to use this source for collision monitoring. (Can be dynamically set)

**`<sourcename>.source_timeout`**
- Type: `unknown`
- TypeDefaultdouble(node parametersource_timeoutvalue)Description:Maximum time interval in which source data is considered as valid. If no new data is received within this interval, the robot will be stopped. Settingsource_timeout:0.0disables this blocking mechanism. Overrides node parameter for each source individually, if desired.

**`<sourcename>.cost_threshold`**
- Type: `unknown`
- TypeDefaultint253Description:Forcostmapsources only. Minimum cell cost (0–255) to be treated as an
obstacle. By default this matches inscribed/lethal cells (253–254) and ignores
lower-cost cells.

**`<sourcename>.treat_unknown_as_obstacle`**
- Type: `unknown`
- TypeDefaultbooltrueDescription:Forcostmapsources only. Iftrue, cells with cost255(NO_INFORMATION)
will also be turned into obstacle points. Set tofalseif your costmap has
large unknown areas you don’t want to trigger Collision Monitor.

**`bond_heartbeat_period`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionThe lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.

**`allow_parameter_qos_overrides`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to allow QoS profiles to be overwritten with parameterized values.

**`Description:`**
- Type: `unknown`
- Type of polygon shape. Could bescan,pointcloud,range,polygonorcostmap.

**`Description:`**
- Type: `unknown`
- Forpointclouddata, specify the transport plugin to use:

**`Description:`**
- Type: `unknown`
- Topic to listen the source data from.

**`Description:`**
- Type: `unknown`
- Minimum height the PointCloud projection to 2D space started from. Applicable forpointcloudtype.

**`Description:`**
- Type: `unknown`
- Maximum height the PointCloud projection to 2D space ended with. Applicable forpointcloudtype.

**`Description:`**
- Type: `unknown`
- Set true for pointcloud sources containing a “height” field relative to a real world ground contour. The “height” field will be used for the min and max height checks instead of the “z” field and will not be transformed as it is assumed that height is already global frame referenced. Applicable forpointcloudtype.

**`Description:`**
- Type: `unknown`
- Minimum range threshold for PointCloud points. Points closer than this distance (measured as Euclidean distance from sensor origin) will be filtered out before processing. Useful for eliminating noise and invalid readings very close to the sensor. Applicable forpointcloudtype.

**`Description:`**
- Type: `unknown`
- Angle increment (in radians) between nearby obstacle points at the range arc. Two outermost points from the field of view are not taken into account (they will always exist regardless of this value). Applicable forrangetype.

**`Description:`**
- Type: `unknown`
- Internally the polygon is sampled for collision detection. sampling_distance is the distance between sampled points of the polygon. Applicable forpolygonsource type.

**`Description:`**
- Type: `unknown`
- Whether to use this source for collision monitoring. (Can be dynamically set)

**`Description:`**
- Type: `unknown`
- Maximum time interval in which source data is considered as valid. If no new data is received within this interval, the robot will be stopped. Settingsource_timeout:0.0disables this blocking mechanism. Overrides node parameter for each source individually, if desired.

**`Description:`**
- Type: `unknown`
- Forcostmapsources only. Minimum cell cost (0–255) to be treated as an
obstacle. By default this matches inscribed/lethal cells (253–254) and ignores
lower-cost cells.

**`Description:`**
- Type: `unknown`
- Forcostmapsources only. Iftrue, cells with cost255(NO_INFORMATION)
will also be turned into obstacle points. Set tofalseif your costmap has
large unknown areas you don’t want to trigger Collision Monitor.

**`Description`**
- Type: `unknown`
- The lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.

**`Description`**
- Type: `unknown`
- Whether to allow QoS profiles to be overwritten with parameterized values.


---

#### Costmap Plugins

##### Binary Filter Parameters

*Source: [https://docs.nav2.org/configuration/packages/costmap-plugins/binary_filter.html](https://docs.nav2.org/configuration/packages/costmap-plugins/binary_filter.html)*

###### Binary Filter Parameters

Binary Filter - is a Costmap Filter that publishes a boolean topic, flipping binary state when the encoded filter space value (corresponding to the filter mask point where the robot is) is higher than given threshold. It then flips back when lower or equal.

Filter space value is being calculated as: `Fv = base + multiplier * mask_value`, where `base` and `multiplier` are being published in a filter info by Costmap Filter Info Server. The example of usage are include: camera operating on/off to turn off cameras in sensitive areas, headlights switch on/off for moving indoors to outdoors, smart house light triggering, etc.

![../../../_images/binary_filter.png](../../../_images/binary_filter.png)

<filter name>: is the corresponding plugin name selected for this type.

`<filter name>`.enabled
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description
:   Whether it is enabled.
```

`<filter name>`.filter\_info\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Name of the incoming [CostmapFilterInfo](https://github.com/ros-navigation/navigation2/blob/main/nav2_msgs/msg/CostmapFilterInfo.msg) topic having filter-related information. Published by Costmap Filter Info Server along with filter mask topic. For more details about Map and Costmap Filter Info servers configuration please refer to the [Map Server](../configuring-map-server.html#configuring-map-server) configuration page.
```

`<filter name>`.transform\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
Description
:   Time with which to post-date the transform that is published, to indicate that this transform is valid into the future. Used when filter mask and current costmap layer are in different frames.
```

`<filter name>`.default\_state
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Default state of binary filter.
```

`<filter name>`.binary\_state\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “binary\_state” |
```

```
Description
:   Topic of `std_msgs::msg::Bool` type to publish binary filter state to.
```

`<filter name>`.flip\_threshold
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 50.0 |
```

```
Descrioption
:   Threshold for binary state flipping. Filter values higher than this threshold, will set binary state to non-default.
```

###### Example

```
global_costmap:
  global_costmap:
    ros__parameters:
    ...
    plugins: ["static_layer", "obstacle_layer", "inflation_layer"]
    filters: ["binary_filter"]
    ...
    binary_filter:
      plugin: "nav2_costmap_2d::BinaryFilter"
      enabled: True
      filter_info_topic: "/costmap_filter_info"
      transform_tolerance: 0.1
      default_state: False
      binary_state_topic: "/binary_state"
      flip_threshold: 50.0
```

#### Parameters

**`<filtername>.enabled`**
- Type: `unknown`
- TypeDefaultboolTrueDescriptionWhether it is enabled.

**`<filtername>.filter_info_topic`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionName of the incomingCostmapFilterInfotopic having filter-related information. Published by Costmap Filter Info Server along with filter mask topic. For more details about Map and Costmap Filter Info servers configuration please refer to theMap Serverconfiguration page.

**`<filtername>.transform_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.1DescriptionTime with which to post-date the transform that is published, to indicate that this transform is valid into the future. Used when filter mask and current costmap layer are in different frames.

**`<filtername>.default_state`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionDefault state of binary filter.

**`<filtername>.binary_state_topic`**
- Type: `unknown`
- TypeDefaultstring“binary_state”DescriptionTopic ofstd_msgs::msg::Booltype to publish binary filter state to.

**`<filtername>.flip_threshold`**
- Type: `unknown`
- TypeDefaultdouble50.0DescrioptionThreshold for binary state flipping. Filter values higher than this threshold, will set binary state to non-default.

**`Description`**
- Type: `unknown`
- Whether it is enabled.

**`Description`**
- Type: `unknown`
- Name of the incomingCostmapFilterInfotopic having filter-related information. Published by Costmap Filter Info Server along with filter mask topic. For more details about Map and Costmap Filter Info servers configuration please refer to theMap Serverconfiguration page.

**`Description`**
- Type: `unknown`
- Time with which to post-date the transform that is published, to indicate that this transform is valid into the future. Used when filter mask and current costmap layer are in different frames.

**`Description`**
- Type: `unknown`
- Default state of binary filter.

**`Description`**
- Type: `unknown`
- Topic ofstd_msgs::msg::Booltype to publish binary filter state to.

**`Descrioption`**
- Type: `unknown`
- Threshold for binary state flipping. Filter values higher than this threshold, will set binary state to non-default.


---

##### Denoise Layer Parameters

*Source: [https://docs.nav2.org/configuration/packages/costmap-plugins/denoise.html](https://docs.nav2.org/configuration/packages/costmap-plugins/denoise.html)*

###### Denoise Layer Parameters

This layer attempts to remove simple noise that may exist in a costmap’s layers due to sensor noise or discrete raycasting errors.

`<denoise layer>` is the corresponding plugin name selected for this type.

`<denoise layer>`.enabled
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description
:   Whether it is enabled.
```

`<denoise layer>`.minimal\_group\_size
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 2 |
```

```
Description
:   The minimum number of adjacent obstacles that should not be discarded as noise.
```

```
    If 1 or less, all obstacles will be kept.
```

```
    If 2, standalone obstacles (without neighbors in adjacent cells) will be removed.
```

```
    If N, obstacles groups smaller than N will be removed.
```

`<denoise layer>`.group\_connectivity\_type
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 8 |
```

```
Description
:   Obstacles connectivity type (is the way in which obstacles relate to their neighbors).
    Must be 4 or 8.
```

```
    4 - adjacent obstacles are connected horizontally and vertically.
```

```
    8 - adjacent obstacles are connected horizontally, vertically and diagonally.
```

###### Example

```
local_costmap:
  local_costmap:
    ros__parameters:
      ...
      plugins: ["voxel_layer", "denoise_layer", "inflation_layer"]
      ...
      denoise_layer:
        plugin: "nav2_costmap_2d::DenoiseLayer"
        enabled: true
        minimal_group_size: 2
        group_connectivity_type: 8
```

#### Parameters

**`<denoiselayer>.enabled`**
- Type: `unknown`
- TypeDefaultboolTrueDescriptionWhether it is enabled.

**`<denoiselayer>.minimal_group_size`**
- Type: `unknown`
- TypeDefaultint2DescriptionThe minimum number of adjacent obstacles that should not be discarded as noise.If 1 or less, all obstacles will be kept.If 2, standalone obstacles (without neighbors in adjacent cells) will be removed.If N, obstacles groups smaller than N will be removed.

**`<denoiselayer>.group_connectivity_type`**
- Type: `unknown`
- TypeDefaultint8DescriptionObstacles connectivity type (is the way in which obstacles relate to their neighbors).
Must be 4 or 8.4 - adjacent obstacles are connected horizontally and vertically.8 - adjacent obstacles are connected horizontally, vertically and diagonally.

**`Description`**
- Type: `unknown`
- Whether it is enabled.

**`Description`**
- Type: `unknown`
- The minimum number of adjacent obstacles that should not be discarded as noise.If 1 or less, all obstacles will be kept.If 2, standalone obstacles (without neighbors in adjacent cells) will be removed.If N, obstacles groups smaller than N will be removed.

**`Description`**
- Type: `unknown`
- Obstacles connectivity type (is the way in which obstacles relate to their neighbors).
Must be 4 or 8.4 - adjacent obstacles are connected horizontally and vertically.8 - adjacent obstacles are connected horizontally, vertically and diagonally.


---

##### Inflation Layer Parameters

*Source: [https://docs.nav2.org/configuration/packages/costmap-plugins/inflation.html](https://docs.nav2.org/configuration/packages/costmap-plugins/inflation.html)*

###### Inflation Layer Parameters

This layer places an exponential decay functions around obstacles to increase cost to traverse near collision. It also places a lethal cost around obstacles within the robot’s fully inscribed radius - even if a robot is non-circular for optimized first-order collision checking.

`<inflation layer>` is the corresponding plugin name selected for this type.

`<inflation layer>`.enabled
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description
:   Whether it is enabled.
```

`<inflation layer>`.inflation\_radius
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.55 |
```

```
Description
:   Radius to inflate costmap around lethal obstacles.
```

`<inflation layer>`.cost\_scaling\_factor
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10.0 |
```

```
Description
:   Exponential decay factor across inflation radius.
```

`<inflation layer>`.inflate\_unknown
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description
:   Whether to inflate unknown cells as if lethal.
```

`<inflation layer>`.inflate\_around\_unknown
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description
:   Whether to inflate unknown cells.
```

#### Parameters

**`<inflationlayer>.enabled`**
- Type: `unknown`
- TypeDefaultboolTrueDescriptionWhether it is enabled.

**`<inflationlayer>.inflation_radius`**
- Type: `unknown`
- TypeDefaultdouble0.55DescriptionRadius to inflate costmap around lethal obstacles.

**`<inflationlayer>.cost_scaling_factor`**
- Type: `unknown`
- TypeDefaultdouble10.0DescriptionExponential decay factor across inflation radius.

**`<inflationlayer>.inflate_unknown`**
- Type: `unknown`
- TypeDefaultboolFalseDescriptionWhether to inflate unknown cells as if lethal.

**`<inflationlayer>.inflate_around_unknown`**
- Type: `unknown`
- TypeDefaultboolFalseDescriptionWhether to inflate unknown cells.

**`Description`**
- Type: `unknown`
- Whether it is enabled.

**`Description`**
- Type: `unknown`
- Radius to inflate costmap around lethal obstacles.

**`Description`**
- Type: `unknown`
- Exponential decay factor across inflation radius.

**`Description`**
- Type: `unknown`
- Whether to inflate unknown cells as if lethal.

**`Description`**
- Type: `unknown`
- Whether to inflate unknown cells.


---

##### Keepout Filter Parameters

*Source: [https://docs.nav2.org/configuration/packages/costmap-plugins/keepout_filter.html](https://docs.nav2.org/configuration/packages/costmap-plugins/keepout_filter.html)*

###### Keepout Filter Parameters

Keepout Filter - is a Costmap Filter that enforces robot to avoid keepout areas or stay on preferred lanes, by updating corresponding costmap layer using filter mask information.

Note: As Costmap Filters does not have the inflation layer applied to them (since inflation is not sensible for a speed or other non-occupation zone type), it may be beneficial to add a separate inflation layer into the vector of filters when using only a keepout zone. Some planners (e.g. Smac Feasible) will use the cost of the center point for a collision checking optimization before doing full SE2 footprint checks. Without inflation, the planner will not respect the Keepout Zone on it extremities – but will still respect it for the robot centers. If you wish to have a Keepout Zone for any part of the robot base while using a feasible planner, please enable the inflation layer.

<filter name>: is the corresponding plugin name selected for this type.

`<filter name>`.enabled
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description
:   Whether it is enabled.
```

`<filter name>`.filter\_info\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Name of the incoming [CostmapFilterInfo](https://github.com/ros-navigation/navigation2/blob/main/nav2_msgs/msg/CostmapFilterInfo.msg) topic having filter-related information. Published by Costmap Filter Info Server along with filter mask topic. For more details about Map and Costmap Filter Info servers configuration please refer to the [Map Server](../configuring-map-server.html#configuring-map-server) configuration page.
```

`<filter name>`.override\_lethal\_cost
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description
:   When true, check if the robot is in a lethal keepout zone, if so, replaces those lethal costs with lethal\_override\_cost.
```

`<filter name>`.lethal\_override\_cost
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 252 |
```

```
Description
:   The cost value written into those cells instead of lethal cost when override is active. Default sets cost very high to incentivize leaving the area as soon as possible.
```

`<filter name>`.transform\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
Description
:   Time with which to post-date the transform that is published, to indicate that this transform is valid into the future. Used when filter mask and current costmap layer are in different frames.
```

###### Example

```
global_costmap:
  global_costmap:
    ros__parameters:
      ...
      plugins: ["static_layer", "obstacle_layer", "inflation_layer"]
      filters: ["keepout_filter"]
      ...
      keepout_filter:
        plugin: "nav2_costmap_2d::KeepoutFilter"
        enabled: True
        filter_info_topic: "/costmap_filter_info"
        transform_tolerance: 0.1
        override_lethal_cost: True
        lethal_override_cost: 200
...
local_costmap:
  local_costmap:
    ros__parameters:
      ...
      plugins: ["voxel_layer", "inflation_layer"]
      filters: ["keepout_filter"]
      ...
      keepout_filter:
        plugin: "nav2_costmap_2d::KeepoutFilter"
        enabled: True
        filter_info_topic: "/costmap_filter_info"
        transform_tolerance: 0.1
        override_lethal_cost: True
        lethal_override_cost: 200
```

#### Parameters

**`<filtername>.enabled`**
- Type: `unknown`
- TypeDefaultboolTrueDescriptionWhether it is enabled.

**`<filtername>.filter_info_topic`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionName of the incomingCostmapFilterInfotopic having filter-related information. Published by Costmap Filter Info Server along with filter mask topic. For more details about Map and Costmap Filter Info servers configuration please refer to theMap Serverconfiguration page.

**`<filtername>.override_lethal_cost`**
- Type: `unknown`
- TypeDefaultboolFalseDescriptionWhen true, check if the robot is in a lethal keepout zone, if so, replaces those lethal costs with lethal_override_cost.

**`<filtername>.lethal_override_cost`**
- Type: `unknown`
- TypeDefaultdouble252DescriptionThe cost value written into those cells instead of lethal cost when override is active. Default sets cost very high to incentivize leaving the area as soon as possible.

**`<filtername>.transform_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.1DescriptionTime with which to post-date the transform that is published, to indicate that this transform is valid into the future. Used when filter mask and current costmap layer are in different frames.

**`Description`**
- Type: `unknown`
- Whether it is enabled.

**`Description`**
- Type: `unknown`
- Name of the incomingCostmapFilterInfotopic having filter-related information. Published by Costmap Filter Info Server along with filter mask topic. For more details about Map and Costmap Filter Info servers configuration please refer to theMap Serverconfiguration page.

**`Description`**
- Type: `unknown`
- When true, check if the robot is in a lethal keepout zone, if so, replaces those lethal costs with lethal_override_cost.

**`Description`**
- Type: `unknown`
- The cost value written into those cells instead of lethal cost when override is active. Default sets cost very high to incentivize leaving the area as soon as possible.

**`Description`**
- Type: `unknown`
- Time with which to post-date the transform that is published, to indicate that this transform is valid into the future. Used when filter mask and current costmap layer are in different frames.


---

##### Obstacle Layer Parameters

*Source: [https://docs.nav2.org/configuration/packages/costmap-plugins/obstacle.html](https://docs.nav2.org/configuration/packages/costmap-plugins/obstacle.html)*

###### Obstacle Layer Parameters

This costmap layer implements a plugin that uses 2D raycasting for 2D lidars, depth, or other sensors. It contains a 2D costmap model within it that manages the planning space by the parameters specified below.

`<obstacle layer>` is the corresponding plugin name selected for this type.

`<data source>` is the corresponding observation source name for that sources parameters.

`<obstacle layer>`.enabled
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description
:   Whether it is enabled.
```

`<obstacle layer>`.footprint\_clearing\_enabled
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description
:   Clear any occupied cells under robot footprint.
```

`<obstacle layer>`.min\_obstacle\_height
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Minimum height to add return to occupancy grid.
```

`<obstacle layer>`.max\_obstacle\_height
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description
:   Maximum height to add return to occupancy grid.
```

`<obstacle layer>`.combination\_method
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1 |
```

```
Description
:   Enum for method to add data to master costmap. Must be 0, 1 or 2, default to 1 (see below).
```

```
0 - Overwrite: Overwrite master costmap with every valid observation.
```

```
1 - Max: Sets the new value to the maximum of the master\_grid’s value and this layer’s value.
```

```
This is the default.
```

```
2 - MaxWithoutUnknownOverwrite: Sets the new value to the maximum of the master\_grid’s
```

```
value and this layer’s value. If the master value is NO\_INFORMATION, it is NOT overwritten.
```

```
It can be used to make sure that the static map is the dominant source of information, and
```

```
prevent the robot to go through places that are not present in the static map.
```

`<obstacle layer>`.tf\_filter\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.05 |
```

```
Description
:   Tolerance for the `tf2_ros::MessageFilter`.
```

`<obstacle layer>`.observation\_sources
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | {“”} |
```

```
Description
:   namespace of sources of data.
```

`<obstacle layer>.<data source>`.topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “” |
```

```
Description
:   Topic of data.
```

```
Relative topics will be relative to the node’s parent namespace.
For example, if you specify topic: scan in the obstacle\_layer of a local\_costmap and you launch your bringup with a tb4 namespace:
```

```
* User chosen namespace is tb4.
* User chosen topic is scan.
* Topic will be remapped to /tb4/scan without local\_costmap.
* Use global topic /scan if you do not wish the node namespace to apply.
```

`<obstacle layer>.<data source>`.sensor\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “” |
```

```
Description
:   Frame of sensor, to use if not provided by message. If empty, uses message frame\_id.
```

`<obstacle layer>.<data source>`.observation\_persistence
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   How long to store messages in a buffer to add to costmap before removing them (s).
```

`<obstacle layer>.<data source>`.expected\_update\_rate
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Expected rate to get new data from sensor.
```

`<obstacle layer>.<data source>`.data\_type
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “LaserScan” |
```

```
Description
:   Data type of input, LaserScan or PointCloud2.
```

`<obstacle layer>.<data source>`.transport\_type
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “raw” |
```

```
Description
:   For `PointCloud2` data, specify the transport plugin to use:
```

```
* raw: No compression. Default; highest bandwidth usage.
* draco: Lossy compression via Google.
* zlib: Lossless compression via Zlib compression.
* zstd: Lossless compression via Zstd compression.
```

```
See the [known transports](https://github.com/ros-perception/point_cloud_transport_plugins) for more details.
```

`<obstacle layer>.<data source>`.min\_obstacle\_height
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Minimum height to add return to occupancy grid.
```

`<obstacle layer>.<data source>`.max\_obstacle\_height
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Maximum height to add return to occupancy grid.
```

`<obstacle layer>.<data source>`.inf\_is\_valid
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description
:   Are infinite returns from laser scanners valid measurements to raycast.
```

`<obstacle layer>.<data source>`.marking
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description
:   Whether source should mark in costmap.
```

`<obstacle layer>.<data source>`.clearing
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description
:   Whether source should raytrace clear in costmap.
```

`<obstacle layer>.<data source>`.obstacle\_max\_range
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.5 |
```

```
Description
:   Maximum range to mark obstacles in costmap.
```

`<obstacle layer>.<data source>`.obstacle\_min\_range
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Minimum range to mark obstacles in costmap.
```

`<obstacle layer>.<data source>`.raytrace\_max\_range
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 3.0 |
```

```
Description
:   Maximum range to raytrace clear obstacles from costmap.
```

`<obstacle layer>.<data source>`.raytrace\_min\_range
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Minimum range to raytrace clear obstacles from costmap.
```

#### Parameters

**`<obstaclelayer>.enabled`**
- Type: `unknown`
- TypeDefaultboolTrueDescriptionWhether it is enabled.

**`<obstaclelayer>.footprint_clearing_enabled`**
- Type: `unknown`
- TypeDefaultboolTrueDescriptionClear any occupied cells under robot footprint.

**`<obstaclelayer>.min_obstacle_height`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionMinimum height to add return to occupancy grid.

**`<obstaclelayer>.max_obstacle_height`**
- Type: `unknown`
- TypeDefaultdouble2.0DescriptionMaximum height to add return to occupancy grid.

**`<obstaclelayer>.combination_method`**
- Type: `unknown`
- TypeDefaultint1DescriptionEnum for method to add data to master costmap. Must be 0, 1 or 2, default to 1 (see below).0 - Overwrite: Overwrite master costmap with every valid observation.1 - Max: Sets the new value to the maximum of the master_grid’s value and this layer’s value.This is the default.2 - MaxWithoutUnknownOverwrite: Sets the new value to the maximum of the master_grid’svalue and this layer’s value. If the master value is NO_INFORMATION, it is NOT overwritten.It can be used to make sure that the static map is the dominant source of information, andprevent the robot to go through places that are not present in the static map.

**`<obstaclelayer>.tf_filter_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.05DescriptionTolerance for thetf2_ros::MessageFilter.

**`<obstaclelayer>.observation_sources`**
- Type: `unknown`
- TypeDefaultvector<string>{“”}Descriptionnamespace of sources of data.

**`<obstaclelayer>.<datasource>.topic`**
- Type: `unknown`
- TypeDefaultstring“”DescriptionTopic of data.Relative topics will be relative to the node’s parent namespace.
For example, if you specifytopic: scanin theobstacle_layerof alocal_costmapand you launch your bringup with atb4namespace:User chosen namespace istb4.User chosen topic isscan.Topic will be remapped to/tb4/scanwithoutlocal_costmap.Use global topic/scanif you do not wish the node namespace to apply.

**`<obstaclelayer>.<datasource>.sensor_frame`**
- Type: `unknown`
- TypeDefaultstring“”DescriptionFrame of sensor, to use if not provided by message. If empty, uses message frame_id.

**`<obstaclelayer>.<datasource>.observation_persistence`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionHow long to store messages in a buffer to add to costmap before removing them (s).

**`<obstaclelayer>.<datasource>.expected_update_rate`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionExpected rate to get new data from sensor.

**`<obstaclelayer>.<datasource>.data_type`**
- Type: `unknown`
- TypeDefaultstring“LaserScan”DescriptionData type of input, LaserScan or PointCloud2.

**`<obstaclelayer>.<datasource>.transport_type`**
- Type: `unknown`
- TypeDefaultstring“raw”DescriptionForPointCloud2data, specify the transport plugin to use:raw: No compression. Default; highest bandwidth usage.draco: Lossy compression via Google.zlib: Lossless compression via Zlib compression.zstd: Lossless compression via Zstd compression.See theknown transportsfor more details.

**`<obstaclelayer>.<datasource>.min_obstacle_height`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionMinimum height to add return to occupancy grid.

**`<obstaclelayer>.<datasource>.max_obstacle_height`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionMaximum height to add return to occupancy grid.

**`<obstaclelayer>.<datasource>.inf_is_valid`**
- Type: `unknown`
- TypeDefaultboolFalseDescriptionAre infinite returns from laser scanners valid measurements to raycast.

**`<obstaclelayer>.<datasource>.marking`**
- Type: `unknown`
- TypeDefaultboolTrueDescriptionWhether source should mark in costmap.

**`<obstaclelayer>.<datasource>.clearing`**
- Type: `unknown`
- TypeDefaultboolFalseDescriptionWhether source should raytrace clear in costmap.

**`<obstaclelayer>.<datasource>.obstacle_max_range`**
- Type: `unknown`
- TypeDefaultdouble2.5DescriptionMaximum range to mark obstacles in costmap.

**`<obstaclelayer>.<datasource>.obstacle_min_range`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionMinimum range to mark obstacles in costmap.

**`<obstaclelayer>.<datasource>.raytrace_max_range`**
- Type: `unknown`
- TypeDefaultdouble3.0DescriptionMaximum range to raytrace clear obstacles from costmap.

**`<obstaclelayer>.<datasource>.raytrace_min_range`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionMinimum range to raytrace clear obstacles from costmap.

**`Description`**
- Type: `unknown`
- Whether it is enabled.

**`Description`**
- Type: `unknown`
- Clear any occupied cells under robot footprint.

**`Description`**
- Type: `unknown`
- Minimum height to add return to occupancy grid.

**`Description`**
- Type: `unknown`
- Maximum height to add return to occupancy grid.

**`Description`**
- Type: `unknown`
- Enum for method to add data to master costmap. Must be 0, 1 or 2, default to 1 (see below).

**`Description`**
- Type: `unknown`
- Tolerance for thetf2_ros::MessageFilter.

**`Description`**
- Type: `unknown`
- namespace of sources of data.

**`Description`**
- Type: `unknown`
- Topic of data.

**`Description`**
- Type: `unknown`
- Frame of sensor, to use if not provided by message. If empty, uses message frame_id.

**`Description`**
- Type: `unknown`
- How long to store messages in a buffer to add to costmap before removing them (s).

**`Description`**
- Type: `unknown`
- Expected rate to get new data from sensor.

**`Description`**
- Type: `unknown`
- Data type of input, LaserScan or PointCloud2.

**`Description`**
- Type: `unknown`
- ForPointCloud2data, specify the transport plugin to use:

**`Description`**
- Type: `unknown`
- Minimum height to add return to occupancy grid.

**`Description`**
- Type: `unknown`
- Maximum height to add return to occupancy grid.

**`Description`**
- Type: `unknown`
- Are infinite returns from laser scanners valid measurements to raycast.

**`Description`**
- Type: `unknown`
- Whether source should mark in costmap.

**`Description`**
- Type: `unknown`
- Whether source should raytrace clear in costmap.

**`Description`**
- Type: `unknown`
- Maximum range to mark obstacles in costmap.

**`Description`**
- Type: `unknown`
- Minimum range to mark obstacles in costmap.

**`Description`**
- Type: `unknown`
- Maximum range to raytrace clear obstacles from costmap.

**`Description`**
- Type: `unknown`
- Minimum range to raytrace clear obstacles from costmap.


---

##### Plugin Container Layer Parameters

*Source: [https://docs.nav2.org/configuration/packages/costmap-plugins/plugin_container.html](https://docs.nav2.org/configuration/packages/costmap-plugins/plugin_container.html)*

###### Plugin Container Layer Parameters

This implements a costmap layer which combines costmap layers within a submap, which can then be integrated with other submaps in the same parent costmap. An example would be the use of different inflation layers for different sensors, objects, or static layers

`<plugin container layer>` is the corresponding plugin name selected for this type.

`<plugin container layer>`.enabled
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description
:   Whether it is enabled.
```

`<plugin container layer>`.plugins
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | {} |
```

```
Description
:   List of mapped costmap layer names for parameter namespaces and names.
```

```
Note
:   Costmap filters are presently unsupported
```

###### Example

```
global_costmap:
  ros__parameters:
    update_frequency: 1.0
    publish_frequency: 1.0
    global_frame: map
    robot_base_frame: base_link
    robot_radius: 0.22
    resolution: 0.05
    track_unknown_space: true

    plugins: ["plugin_container_static_layer", "plugin_container_obstacle_layer"]

    plugin_container_static_layer:
      plugin: "nav2_costmap_2d::PluginContainerLayer"
      enabled: True
      combination_method: 1
      plugins: ["static_layer", "inflation_layer"]
      static_layer:
        plugin: "nav2_costmap_2d::StaticLayer"
        map_subscribe_transient_local: True
      inflation_layer:
        plugin: "nav2_costmap_2d::InflationLayer"
        cost_scaling_factor: 2.0
        inflation_radius: 0.5

    plugin_container_obstacle_layer:
      plugin: "nav2_costmap_2d::PluginContainerLayer"
      enabled: True
      combination_method: 1
      plugins: ["obstacle_layer", "inflation_layer"]
      obstacle_layer:
        plugin: "nav2_costmap_2d::ObstacleLayer"
        enabled: True
        observation_sources: scan
        scan:
          topic: /scan
          max_obstacle_height: 2.0
          clearing: True
          marking: True
          data_type: "LaserScan"
          raytrace_max_range: 3.0
          raytrace_min_range: 0.0
          obstacle_max_range: 2.5
          obstacle_min_range: 0.0
      inflation_layer:
        plugin: "nav2_costmap_2d::InflationLayer"
        cost_scaling_factor: 3.0
        inflation_radius: 1.0
```

The above example settings, when applied to the Nav2 turtlebot simulation would give the following costmap on startup

![Costmap generated by plugin container layer](../../../_images/plugin_container_layer.png)

Figure 7 Costmap generated by turtlebot using example plugin container layer settings

#### Parameters

**`<plugincontainerlayer>.enabled`**
- Type: `unknown`
- TypeDefaultboolTrueDescriptionWhether it is enabled.

**`<plugincontainerlayer>.plugins`**
- Type: `unknown`
- TypeDefaultvector<string>{}DescriptionList of mapped costmap layer names for parameter namespaces and names.NoteCostmap filters are presently unsupported

**`Description`**
- Type: `unknown`
- Whether it is enabled.

**`Description`**
- Type: `unknown`
- List of mapped costmap layer names for parameter namespaces and names.

**`Note`**
- Type: `unknown`
- Costmap filters are presently unsupported


---

##### Range Sensor Parameters

*Source: [https://docs.nav2.org/configuration/packages/costmap-plugins/range.html](https://docs.nav2.org/configuration/packages/costmap-plugins/range.html)*

###### Range Sensor Parameters

This costmap layer implements a plugin that processes sonar, IR, or other 1-D sensors for collision avoidance.

`<range layer>` is the corresponding plugin name selected for this type.

`<range layer>`.enabled
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description
:   Whether it is enabled.
```

`<range layer>`.topics
:   |  |  |
```
| --- | --- |
| Type Default |  |
| vector<string> | [“”] |
```

```
Description
:   Range topics to subscribe to.
```

```
Relative topics will be relative to the node’s parent namespace.
For example, if you specify topics: [range1, /range2] in the range\_layer of a local\_costmap and you launch your bringup with a tb4 namespace:
```

```
* User chosen namespace is tb4.
* User chosen topics are [range1, /range2].
* Topic will be remapped to /tb4/range1, without local\_costmap, and /range2.
* Use global topics such as /range2 if you do not wish the node namespace to apply.
```

`<range layer>`.phi
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.2 |
```

```
Description
:   Phi value.
```

`<range layer>`.inflate\_cone
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   Inflate the triangular area covered by the sensor (percentage).
```

`<range layer>`.no\_readings\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   If zero, this parameter has no effect. Otherwise if the layer does
    not receive sensor data for this amount of time,
    the layer will warn the user and the layer will be marked as not current.
```

`<range layer>`.clear\_threshold
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.2 |
```

```
Description
:   Probability below which cells are marked as free.
```

`<range layer>`.mark\_threshold
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.8 |
```

```
Description
:   Probability above which cells are marked as occupied.
```

`<range layer>`.clear\_on\_max\_reading
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description
:   Whether to clear the sensor readings on max range.
```

`<range layer>`.input\_sensor\_type
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | ALL |
```

```
Description
:   Input sensor type is either ALL (automatic selection), VARIABLE (min range != max range), or FIXED (min range == max range).
```

#### Parameters

**`<rangelayer>.enabled`**
- Type: `unknown`
- TypeDefaultboolTrueDescriptionWhether it is enabled.

**`<rangelayer>.topics`**
- Type: `unknown`
- Type Defaultvector<string>[“”]DescriptionRange topics to subscribe to.Relative topics will be relative to the node’s parent namespace.
For example, if you specifytopics: [range1, /range2]in therange_layerof alocal_costmapand you launch your bringup with atb4namespace:User chosen namespace istb4.User chosen topics are [range1,/range2].Topic will be remapped to/tb4/range1, withoutlocal_costmap, and/range2.Use global topics such as/range2if you do not wish the node namespace to apply.

**`<rangelayer>.phi`**
- Type: `unknown`
- TypeDefaultdouble1.2DescriptionPhi value.

**`<rangelayer>.inflate_cone`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionInflate the triangular area covered by the sensor (percentage).

**`<rangelayer>.no_readings_timeout`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionIf zero, this parameter has no effect. Otherwise if the layer does
not receive sensor data for this amount of time,
the layer will warn the user and the layer will be marked as not current.

**`<rangelayer>.clear_threshold`**
- Type: `unknown`
- TypeDefaultdouble0.2DescriptionProbability below which cells are marked as free.

**`<rangelayer>.mark_threshold`**
- Type: `unknown`
- TypeDefaultdouble0.8DescriptionProbability above which cells are marked as occupied.

**`<rangelayer>.clear_on_max_reading`**
- Type: `unknown`
- TypeDefaultboolFalseDescriptionWhether to clear the sensor readings on max range.

**`<rangelayer>.input_sensor_type`**
- Type: `unknown`
- TypeDefaultstringALLDescriptionInput sensor type is either ALL (automatic selection), VARIABLE (min range != max range), or FIXED (min range == max range).

**`Description`**
- Type: `unknown`
- Whether it is enabled.

**`Description`**
- Type: `unknown`
- Range topics to subscribe to.

**`Description`**
- Type: `unknown`
- Phi value.

**`Description`**
- Type: `unknown`
- Inflate the triangular area covered by the sensor (percentage).

**`Description`**
- Type: `unknown`
- If zero, this parameter has no effect. Otherwise if the layer does
not receive sensor data for this amount of time,
the layer will warn the user and the layer will be marked as not current.

**`Description`**
- Type: `unknown`
- Probability below which cells are marked as free.

**`Description`**
- Type: `unknown`
- Probability above which cells are marked as occupied.

**`Description`**
- Type: `unknown`
- Whether to clear the sensor readings on max range.

**`Description`**
- Type: `unknown`
- Input sensor type is either ALL (automatic selection), VARIABLE (min range != max range), or FIXED (min range == max range).


---

##### Speed Filter Parameters

*Source: [https://docs.nav2.org/configuration/packages/costmap-plugins/speed_filter.html](https://docs.nav2.org/configuration/packages/costmap-plugins/speed_filter.html)*

###### Speed Filter Parameters

Speed Filter - is a Costmap Filter that restricting maximum velocity of robot. The areas where robot should slow down and values of maximum allowed velocities are encoded at filter mask. Filter mask published by Map Server, goes in a pair with filter info topic published by Costmap Filter Info Server. Speed Filter itself publishes a speed restricting messages which are targeted for a Controller in order to make the robot to not exceed the required velocity.


<filter name>: is the corresponding plugin name selected for this type.

`<filter name>`.enabled
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description
:   Whether it is enabled.
```

`<filter name>`.filter\_info\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Name of the incoming [CostmapFilterInfo](https://github.com/ros-navigation/navigation2/blob/main/nav2_msgs/msg/CostmapFilterInfo.msg) topic having filter-related information. Published by Costmap Filter Info Server along with filter mask topic. For more details about Map and Costmap Filter Info servers configuration please refer to the [Map Server](../configuring-map-server.html#configuring-map-server) configuration page.
```

`<filter name>`.speed\_limit\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “speed\_limit” |
```

```
Description
:   Topic to publish speed limit to. The [messages](https://github.com/ros-navigation/navigation2/blob/main/nav2_msgs/msg/SpeedLimit.msg) have the following fields’ meaning:
```

```
    * `percentage`: speed limit is expressed in percentage if `true` or in absolute values in `false` case. This parameter is set depending on `type` field of `CostmapFilterInfo` message.
    * `speed_limit`: non-zero values show maximum allowed speed expressed in a percent of maximum robot speed or in absolute value depending on `percentage` value. Zero value means no speed restriction (independently on `percentage`). `speed_limit` is being linearly converted from `OccupancyGrid` filter mask value as: `speed_limit = base + multiplier * mask_value`, where `base` and `multiplier` coefficients are taken from `CostmapFilterInfo` message.
```

```
      Note
      :   `speed_limit` expressed in a percent should belong to `(0.0 .. 100.0]` range.
```

```
    This topic will be used by a Controller Server. Please refer to [Controller Server](../configuring-controller-server.html#configuring-controller-server) configuration page to set it appropriately.
```

`<filter name>`.transform\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
Description
:   Time with which to post-date the transform that is published, to indicate that this transform is valid into the future. Used when filter mask and current costmap layer are in different frames.
```

###### Example

```
global_costmap:
  global_costmap:
    ros__parameters:
    ...
    plugins: ["static_layer", "obstacle_layer", "inflation_layer"]
    filters: ["speed_filter"]
    ...
    speed_filter:
      plugin: "nav2_costmap_2d::SpeedFilter"
      enabled: True
      filter_info_topic: "/costmap_filter_info"
      speed_limit_topic: "/speed_limit"
      transform_tolerance: 0.1
```

#### Parameters

**`<filtername>.enabled`**
- Type: `unknown`
- TypeDefaultboolTrueDescriptionWhether it is enabled.

**`<filtername>.filter_info_topic`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionName of the incomingCostmapFilterInfotopic having filter-related information. Published by Costmap Filter Info Server along with filter mask topic. For more details about Map and Costmap Filter Info servers configuration please refer to theMap Serverconfiguration page.

**`<filtername>.speed_limit_topic`**
- Type: `unknown`
- TypeDefaultstring“speed_limit”DescriptionTopic to publish speed limit to. Themessageshave the following fields’ meaning:percentage: speed limit is expressed in percentage iftrueor in absolute values infalsecase. This parameter is set depending ontypefield ofCostmapFilterInfomessage.speed_limit: non-zero values show maximum allowed speed expressed in a percent of maximum robot speed or in absolute value depending onpercentagevalue. Zero value means no speed restriction (independently onpercentage).speed_limitis being linearly converted fromOccupancyGridfilter mask value as:speed_limit=base+multiplier*mask_value, wherebaseandmultipliercoefficients are taken fromCostmapFilterInfomessage.Notespeed_limitexpressed in a percent should belong to(0.0..100.0]range.This topic will be used by a Controller Server. Please refer toController Serverconfiguration page to set it appropriately.

**`<filtername>.transform_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.1DescriptionTime with which to post-date the transform that is published, to indicate that this transform is valid into the future. Used when filter mask and current costmap layer are in different frames.

**`Description`**
- Type: `unknown`
- Whether it is enabled.

**`Description`**
- Type: `unknown`
- Name of the incomingCostmapFilterInfotopic having filter-related information. Published by Costmap Filter Info Server along with filter mask topic. For more details about Map and Costmap Filter Info servers configuration please refer to theMap Serverconfiguration page.

**`Description`**
- Type: `unknown`
- Topic to publish speed limit to. Themessageshave the following fields’ meaning:percentage: speed limit is expressed in percentage iftrueor in absolute values infalsecase. This parameter is set depending ontypefield ofCostmapFilterInfomessage.speed_limit: non-zero values show maximum allowed speed expressed in a percent of maximum robot speed or in absolute value depending onpercentagevalue. Zero value means no speed restriction (independently onpercentage).speed_limitis being linearly converted fromOccupancyGridfilter mask value as:speed_limit=base+multiplier*mask_value, wherebaseandmultipliercoefficients are taken fromCostmapFilterInfomessage.Notespeed_limitexpressed in a percent should belong to(0.0..100.0]range.This topic will be used by a Controller Server. Please refer toController Serverconfiguration page to set it appropriately.

**`Note`**
- Type: `unknown`
- speed_limitexpressed in a percent should belong to(0.0..100.0]range.

**`Description`**
- Type: `unknown`
- Time with which to post-date the transform that is published, to indicate that this transform is valid into the future. Used when filter mask and current costmap layer are in different frames.


---

##### Static Layer Parameters

*Source: [https://docs.nav2.org/configuration/packages/costmap-plugins/static.html](https://docs.nav2.org/configuration/packages/costmap-plugins/static.html)*

###### Static Layer Parameters

This implements a costmap layer taking in a map from either SLAM or `map_server` (or other) to place into the costmap. It resizes the costmap to its size and places the static obstacles on the planning space.

`<static layer>` is the corresponding plugin name selected for this type.

`<static layer>`.enabled
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description
:   Whether it is enabled.
```

`<static layer>`.footprint\_clearing\_enabled
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description
:   Clear any occupied cells under robot footprint.
```

`<static layer>`.restore\_cleared\_footprint
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description
:   Restore map after clearing the area the footprint occupied.
```

```
If `footprint_clearing_enabled` is false, this parameter is ignored.
```

`<static layer>`.subscribe\_to\_updates
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description
:   Subscribe to static map updates after receiving first.
```

`<static layer>`.map\_subscribe\_transient\_local
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description
:   QoS settings for map topic.
```

`<static layer>`.transform\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   TF tolerance.
```

`<static layer>`.map\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “map” |
```

```
Description
:   Map topic to subscribe to.
```

```
Relative topics will be relative to the node’s parent namespace.
For example, if you specify map\_topic: map in the static\_layer of a global\_costmap and you launch your bringup with a tb4 namespace:
```

```
* User chosen namespace is tb4.
* User chosen topic is map.
* Topic will be remapped to /tb4/map without global\_costmap.
* Use global topic /map if you do not wish the node namespace to apply.
```

#### Parameters

**`<staticlayer>.enabled`**
- Type: `unknown`
- TypeDefaultboolTrueDescriptionWhether it is enabled.

**`<staticlayer>.footprint_clearing_enabled`**
- Type: `unknown`
- TypeDefaultboolFalseDescriptionClear any occupied cells under robot footprint.

**`<staticlayer>.restore_cleared_footprint`**
- Type: `unknown`
- TypeDefaultboolTrueDescriptionRestore map after clearing the area the footprint occupied.Iffootprint_clearing_enabledis false, this parameter is ignored.

**`<staticlayer>.subscribe_to_updates`**
- Type: `unknown`
- TypeDefaultboolFalseDescriptionSubscribe to static map updates after receiving first.

**`<staticlayer>.map_subscribe_transient_local`**
- Type: `unknown`
- TypeDefaultboolTrueDescriptionQoS settings for map topic.

**`<staticlayer>.transform_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionTF tolerance.

**`<staticlayer>.map_topic`**
- Type: `unknown`
- TypeDefaultstring“map”DescriptionMap topic to subscribe to.Relative topics will be relative to the node’s parent namespace.
For example, if you specifymap_topic: mapin thestatic_layerof aglobal_costmapand you launch your bringup with atb4namespace:User chosen namespace istb4.User chosen topic ismap.Topic will be remapped to/tb4/mapwithoutglobal_costmap.Use global topic/mapif you do not wish the node namespace to apply.

**`Description`**
- Type: `unknown`
- Whether it is enabled.

**`Description`**
- Type: `unknown`
- Clear any occupied cells under robot footprint.

**`Description`**
- Type: `unknown`
- Restore map after clearing the area the footprint occupied.

**`Description`**
- Type: `unknown`
- Subscribe to static map updates after receiving first.

**`Description`**
- Type: `unknown`
- QoS settings for map topic.

**`Description`**
- Type: `unknown`
- TF tolerance.

**`Description`**
- Type: `unknown`
- Map topic to subscribe to.


---

##### Voxel Layer Parameters

*Source: [https://docs.nav2.org/configuration/packages/costmap-plugins/voxel.html](https://docs.nav2.org/configuration/packages/costmap-plugins/voxel.html)*

###### Voxel Layer Parameters

This costmap layer implements a plugin that uses 3D raycasting for depth, 3D, or other sensors. It contains a 3D environmental model within it that manages the planning space and squashes down to 2D for planning and control by the parameters specified below.

`<voxel layer>` is the corresponding plugin name selected for this type.

`<data source>` is the corresponding observation source name for that sources parameters.

`<voxel layer>`.enabled
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description
:   Whether it is enabled.
```

`<voxel layer>`.footprint\_clearing\_enabled
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description
:   Clear any occupied cells under robot footprint.
```

`<voxel layer>`.min\_obstacle\_height
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Minimum height to add return to occupancy grid.
```

`<voxel layer>`.max\_obstacle\_height
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description
:   Maximum height to add return to occupancy grid.
```

`<voxel layer>`.z\_voxels
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 10 |
```

```
Description
:   Number of voxels high to mark, maximum 16.
```

`<voxel layer>`.origin\_z
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Where to start marking voxels (m).
```

`<voxel layer>`.z\_resolution
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.2 |
```

```
Description
:   Resolution of voxels in height (m).
```

`<voxel layer>`.unknown\_threshold
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 15 |
```

```
Description
:   Minimum number of empty voxels in a column to mark as unknown in 2D occupancy grid.
```

`<voxel layer>`.mark\_threshold
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 0 |
```

```
Description
:   Minimum number of voxels in a column to mark as occupied in 2D occupancy grid.
```

`<voxel layer>`.combination\_method
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1 |
```

```
Description
:   Enum for method to add data to master costmap. Must be 0, 1 or 2, default to 1 (see below).
```

```
0 - Overwrite: Overwrite master costmap with every valid observation.
```

```
1 - Max: Sets the new value to the maximum of the master\_grid’s value and this layer’s value.
```

```
This is the default.
```

```
2 - MaxWithoutUnknownOverwrite: Sets the new value to the maximum of the master\_grid’s
```

```
value and this layer’s value. If the master value is NO\_INFORMATION, it is NOT overwritten.
```

```
It can be used to make sure that the static map is the dominant source of information, and
```

```
prevent the robot to go through places that are not present in the static map.
```

`<voxel layer>`.publish\_voxel\_map
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description
:   Whether to publish 3D voxel grid for debug, computationally expensive.
```

`<voxel layer>`.tf\_filter\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.05 |
```

```
Description
:   Tolerance for the `tf2_ros::MessageFilter`.
```

`<voxel layer>`.observation\_sources
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | {“”} |
```

```
Description
:   namespace of sources of data.
```

`<voxel layer>.<data source>`.topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “” |
```

```
Description
:   Topic of data.
```

```
Relative topics will be relative to the node’s parent namespace.
For example, if you specify topic: scan in the voxel\_layer of a local\_costmap and you launch your bringup with a tb4 namespace:
```

```
* User chosen namespace is tb4.
* User chosen topic is scan.
* Topic will be remapped to /tb4/scan without local\_costmap.
* Use global topic /scan if you do not wish the node namespace to apply.
```

`<voxel layer>.<data source>`.sensor\_frame
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “” |
```

```
Description
:   Frame of sensor, to use if not provided by message. If empty, uses message frame\_id.
```

`<voxel layer>.<data source>`.observation\_persistence
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   How long to store messages in a buffer to add to costmap before removing them (s).
```

`<voxel layer>.<data source>`.expected\_update\_rate
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Expected rate to get new data from sensor.
```

`<voxel layer>.<data source>`.data\_type
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “LaserScan” |
```

```
Description
:   Data type of input, LaserScan or PointCloud2.
```

`<voxel layer>.<data source>`.transport\_type
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “raw” |
```

```
Description
:   For `PointCloud2` data, specify the transport plugin to use:
```

```
* raw: No compression. Default; highest bandwidth usage.
* draco: Lossy compression via Google.
* zlib: Lossless compression via Zlib compression.
* zstd: Lossless compression via Zstd compression.
```

```
See the [known transports](https://github.com/ros-perception/point_cloud_transport_plugins) for more details.
```

`<voxel layer>.<data source>`.min\_obstacle\_height
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Minimum height to add return to occupancy grid.
```

`<voxel layer>.<data source>`.max\_obstacle\_height
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Maximum height to add return to occupancy grid.
```

`<voxel layer>.<data source>`.inf\_is\_valid
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description
:   Are infinite returns from laser scanners valid measurements to raycast.
```

`<voxel layer>.<data source>`.marking
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description
:   Whether source should mark in costmap.
```

`<voxel layer>.<data source>`.clearing
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description
:   Whether source should raytrace clear in costmap.
```

`<voxel layer>.<data source>`.obstacle\_max\_range
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.5 |
```

```
Description
:   Maximum range to mark obstacles in costmap.
```

`<voxel layer>.<data source>`.obstacle\_min\_range
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Minimum range to mark obstacles in costmap.
```

`<voxel layer>.<data source>`.raytrace\_max\_range
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 3.0 |
```

```
Description
:   Maximum range to raytrace clear obstacles from costmap.
```

`<voxel layer>.<data source>`.raytrace\_min\_range
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Minimum range to raytrace clear obstacles from costmap.
```

#### Parameters

**`<voxellayer>.enabled`**
- Type: `unknown`
- TypeDefaultboolTrueDescriptionWhether it is enabled.

**`<voxellayer>.footprint_clearing_enabled`**
- Type: `unknown`
- TypeDefaultboolTrueDescriptionClear any occupied cells under robot footprint.

**`<voxellayer>.min_obstacle_height`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionMinimum height to add return to occupancy grid.

**`<voxellayer>.max_obstacle_height`**
- Type: `unknown`
- TypeDefaultdouble2.0DescriptionMaximum height to add return to occupancy grid.

**`<voxellayer>.z_voxels`**
- Type: `unknown`
- TypeDefaultint10DescriptionNumber of voxels high to mark, maximum 16.

**`<voxellayer>.origin_z`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionWhere to start marking voxels (m).

**`<voxellayer>.z_resolution`**
- Type: `unknown`
- TypeDefaultdouble0.2DescriptionResolution of voxels in height (m).

**`<voxellayer>.unknown_threshold`**
- Type: `unknown`
- TypeDefaultint15DescriptionMinimum number of empty voxels in a column to mark as unknown in 2D occupancy grid.

**`<voxellayer>.mark_threshold`**
- Type: `unknown`
- TypeDefaultint0DescriptionMinimum number of voxels in a column to mark as occupied in 2D occupancy grid.

**`<voxellayer>.combination_method`**
- Type: `unknown`
- TypeDefaultint1DescriptionEnum for method to add data to master costmap. Must be 0, 1 or 2, default to 1 (see below).0 - Overwrite: Overwrite master costmap with every valid observation.1 - Max: Sets the new value to the maximum of the master_grid’s value and this layer’s value.This is the default.2 - MaxWithoutUnknownOverwrite: Sets the new value to the maximum of the master_grid’svalue and this layer’s value. If the master value is NO_INFORMATION, it is NOT overwritten.It can be used to make sure that the static map is the dominant source of information, andprevent the robot to go through places that are not present in the static map.

**`<voxellayer>.publish_voxel_map`**
- Type: `unknown`
- TypeDefaultboolFalseDescriptionWhether to publish 3D voxel grid for debug, computationally expensive.

**`<voxellayer>.tf_filter_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.05DescriptionTolerance for thetf2_ros::MessageFilter.

**`<voxellayer>.observation_sources`**
- Type: `unknown`
- TypeDefaultvector<string>{“”}Descriptionnamespace of sources of data.

**`<voxellayer>.<datasource>.topic`**
- Type: `unknown`
- TypeDefaultstring“”DescriptionTopic of data.Relative topics will be relative to the node’s parent namespace.
For example, if you specifytopic: scanin thevoxel_layerof alocal_costmapand you launch your bringup with atb4namespace:User chosen namespace istb4.User chosen topic isscan.Topic will be remapped to/tb4/scanwithoutlocal_costmap.Use global topic/scanif you do not wish the node namespace to apply.

**`<voxellayer>.<datasource>.sensor_frame`**
- Type: `unknown`
- TypeDefaultstring“”DescriptionFrame of sensor, to use if not provided by message. If empty, uses message frame_id.

**`<voxellayer>.<datasource>.observation_persistence`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionHow long to store messages in a buffer to add to costmap before removing them (s).

**`<voxellayer>.<datasource>.expected_update_rate`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionExpected rate to get new data from sensor.

**`<voxellayer>.<datasource>.data_type`**
- Type: `unknown`
- TypeDefaultstring“LaserScan”DescriptionData type of input, LaserScan or PointCloud2.

**`<voxellayer>.<datasource>.transport_type`**
- Type: `unknown`
- TypeDefaultstring“raw”DescriptionForPointCloud2data, specify the transport plugin to use:raw: No compression. Default; highest bandwidth usage.draco: Lossy compression via Google.zlib: Lossless compression via Zlib compression.zstd: Lossless compression via Zstd compression.See theknown transportsfor more details.

**`<voxellayer>.<datasource>.min_obstacle_height`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionMinimum height to add return to occupancy grid.

**`<voxellayer>.<datasource>.max_obstacle_height`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionMaximum height to add return to occupancy grid.

**`<voxellayer>.<datasource>.inf_is_valid`**
- Type: `unknown`
- TypeDefaultboolFalseDescriptionAre infinite returns from laser scanners valid measurements to raycast.

**`<voxellayer>.<datasource>.marking`**
- Type: `unknown`
- TypeDefaultboolTrueDescriptionWhether source should mark in costmap.

**`<voxellayer>.<datasource>.clearing`**
- Type: `unknown`
- TypeDefaultboolFalseDescriptionWhether source should raytrace clear in costmap.

**`<voxellayer>.<datasource>.obstacle_max_range`**
- Type: `unknown`
- TypeDefaultdouble2.5DescriptionMaximum range to mark obstacles in costmap.

**`<voxellayer>.<datasource>.obstacle_min_range`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionMinimum range to mark obstacles in costmap.

**`<voxellayer>.<datasource>.raytrace_max_range`**
- Type: `unknown`
- TypeDefaultdouble3.0DescriptionMaximum range to raytrace clear obstacles from costmap.

**`<voxellayer>.<datasource>.raytrace_min_range`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionMinimum range to raytrace clear obstacles from costmap.

**`Description`**
- Type: `unknown`
- Whether it is enabled.

**`Description`**
- Type: `unknown`
- Clear any occupied cells under robot footprint.

**`Description`**
- Type: `unknown`
- Minimum height to add return to occupancy grid.

**`Description`**
- Type: `unknown`
- Maximum height to add return to occupancy grid.

**`Description`**
- Type: `unknown`
- Number of voxels high to mark, maximum 16.

**`Description`**
- Type: `unknown`
- Where to start marking voxels (m).

**`Description`**
- Type: `unknown`
- Resolution of voxels in height (m).

**`Description`**
- Type: `unknown`
- Minimum number of empty voxels in a column to mark as unknown in 2D occupancy grid.

**`Description`**
- Type: `unknown`
- Minimum number of voxels in a column to mark as occupied in 2D occupancy grid.

**`Description`**
- Type: `unknown`
- Enum for method to add data to master costmap. Must be 0, 1 or 2, default to 1 (see below).

**`Description`**
- Type: `unknown`
- Whether to publish 3D voxel grid for debug, computationally expensive.

**`Description`**
- Type: `unknown`
- Tolerance for thetf2_ros::MessageFilter.

**`Description`**
- Type: `unknown`
- namespace of sources of data.

**`Description`**
- Type: `unknown`
- Topic of data.

**`Description`**
- Type: `unknown`
- Frame of sensor, to use if not provided by message. If empty, uses message frame_id.

**`Description`**
- Type: `unknown`
- How long to store messages in a buffer to add to costmap before removing them (s).

**`Description`**
- Type: `unknown`
- Expected rate to get new data from sensor.

**`Description`**
- Type: `unknown`
- Data type of input, LaserScan or PointCloud2.

**`Description`**
- Type: `unknown`
- ForPointCloud2data, specify the transport plugin to use:

**`Description`**
- Type: `unknown`
- Minimum height to add return to occupancy grid.

**`Description`**
- Type: `unknown`
- Maximum height to add return to occupancy grid.

**`Description`**
- Type: `unknown`
- Are infinite returns from laser scanners valid measurements to raycast.

**`Description`**
- Type: `unknown`
- Whether source should mark in costmap.

**`Description`**
- Type: `unknown`
- Whether source should raytrace clear in costmap.

**`Description`**
- Type: `unknown`
- Maximum range to mark obstacles in costmap.

**`Description`**
- Type: `unknown`
- Minimum range to mark obstacles in costmap.

**`Description`**
- Type: `unknown`
- Maximum range to raytrace clear obstacles from costmap.

**`Description`**
- Type: `unknown`
- Minimum range to raytrace clear obstacles from costmap.


---

#### Dwb Params

##### DWB Controller

*Source: [https://docs.nav2.org/configuration/packages/dwb-params/controller.html](https://docs.nav2.org/configuration/packages/dwb-params/controller.html)*

###### DWB Controller

###### Parameters

`<dwb plugin>`: DWB plugin name defined in the **controller\_plugin\_ids** parameter in [Controller Server](../configuring-controller-server.html#configuring-controller-server).

`<dwb plugin>`.critics
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | N/A |
```

```
Description
:   List of critic plugins to use.
```

`<dwb plugin>`.default\_critic\_namespaces
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | [“dwb\_critics”] |
```

```
Description
:   Namespaces to load critics in.
```

`<dwb plugin>`.debug\_trajectory\_details
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Publish debug information (on what topic???).
```

`<dwb plugin>`.trajectory\_generator\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “dwb\_plugins::StandardTrajectoryGenerator” |
```

```
Description
:   Trajectory generator plugin name.
```

`<dwb plugin>`.goal\_checker\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “dwb\_plugins::SimpleGoalChecker” |
```

```
Description
:   Goal checker plugin name.
```

`<dwb plugin>`.short\_circuit\_trajectory\_evaluation
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Stop evaluating scores after best score is found.
```

`<dwb plugin>`.path\_distance\_bias (Legacy)
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | N/A |
```

```
Description
:   Old version of PathAlign.scale, use that instead.
```

`<dwb plugin>`.goal\_distance\_bias (Legacy)
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | N/A |
```

```
Description
:   Old version of GoalAlign.scale, use that instead.
```

`<dwb plugin>`.occdist\_scale (Legacy)
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | N/A |
```

```
Description
:   Old version of ObstacleFootprint.scale, use that instead.
```

`<dwb plugin>`.max\_scaling\_factor (Legacy)
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | N/A |
```

```
Description
:   Old version of ObstacleFootprint.max\_scaling\_factor, use that instead.
```

`<dwb plugin>`.scaling\_speed (Legacy)
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | N/A |
```

```
Description
:   Old version of ObstacleFootprint.scaling\_speed, use that instead.
```

`<dwb plugin>`.PathAlign.scale
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 32.0 |
```

```
Description
:   Scale for path align critic, overriding local default.
```

`<dwb plugin>`.GoalAlign.scale
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 24.0 |
```

```
Description
:   Scale for goal align critic, overriding local default.
```

`<dwb plugin>`.PathDist.scale
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 32.0 |
```

```
Description
:   Scale for path distance critic, overriding local default.
```

`<dwb plugin>`.GoalDist.scale
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 24.0 |
```

```
Description
:   Scale for goal distance critic, overriding local default.
```

#### Parameters

**`<dwbplugin>.critics`**
- Type: `unknown`
- TypeDefaultvector<string>N/ADescriptionList of critic plugins to use.

**`<dwbplugin>.default_critic_namespaces`**
- Type: `unknown`
- TypeDefaultvector<string>[“dwb_critics”]DescriptionNamespaces to load critics in.

**`<dwbplugin>.debug_trajectory_details`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionPublish debug information (on what topic???).

**`<dwbplugin>.trajectory_generator_name`**
- Type: `unknown`
- TypeDefaultstring“dwb_plugins::StandardTrajectoryGenerator”DescriptionTrajectory generator plugin name.

**`<dwbplugin>.goal_checker_name`**
- Type: `unknown`
- TypeDefaultstring“dwb_plugins::SimpleGoalChecker”DescriptionGoal checker plugin name.

**`<dwbplugin>.short_circuit_trajectory_evaluation`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionStop evaluating scores after best score is found.

**`<dwbplugin>.path_distance_bias`**
- Type: `unknown`
- TypeDefaultdoubleN/ADescriptionOld version of PathAlign.scale, use that instead.

**`<dwbplugin>.goal_distance_bias`**
- Type: `unknown`
- TypeDefaultdoubleN/ADescriptionOld version of GoalAlign.scale, use that instead.

**`<dwbplugin>.occdist_scale`**
- Type: `unknown`
- TypeDefaultdoubleN/ADescriptionOld version of ObstacleFootprint.scale, use that instead.

**`<dwbplugin>.max_scaling_factor`**
- Type: `unknown`
- TypeDefaultdoubleN/ADescriptionOld version of ObstacleFootprint.max_scaling_factor, use that instead.

**`<dwbplugin>.scaling_speed`**
- Type: `unknown`
- TypeDefaultdoubleN/ADescriptionOld version of ObstacleFootprint.scaling_speed, use that instead.

**`<dwbplugin>.PathAlign.scale`**
- Type: `unknown`
- TypeDefaultdouble32.0DescriptionScale for path align critic, overriding local default.

**`<dwbplugin>.GoalAlign.scale`**
- Type: `unknown`
- TypeDefaultdouble24.0DescriptionScale for goal align critic, overriding local default.

**`<dwbplugin>.PathDist.scale`**
- Type: `unknown`
- TypeDefaultdouble32.0DescriptionScale for path distance critic, overriding local default.

**`<dwbplugin>.GoalDist.scale`**
- Type: `unknown`
- TypeDefaultdouble24.0DescriptionScale for goal distance critic, overriding local default.

**`Description`**
- Type: `unknown`
- List of critic plugins to use.

**`Description`**
- Type: `unknown`
- Namespaces to load critics in.

**`Description`**
- Type: `unknown`
- Publish debug information (on what topic???).

**`Description`**
- Type: `unknown`
- Trajectory generator plugin name.

**`Description`**
- Type: `unknown`
- Goal checker plugin name.

**`Description`**
- Type: `unknown`
- Stop evaluating scores after best score is found.

**`Description`**
- Type: `unknown`
- Old version of PathAlign.scale, use that instead.

**`Description`**
- Type: `unknown`
- Old version of GoalAlign.scale, use that instead.

**`Description`**
- Type: `unknown`
- Old version of ObstacleFootprint.scale, use that instead.

**`Description`**
- Type: `unknown`
- Old version of ObstacleFootprint.max_scaling_factor, use that instead.

**`Description`**
- Type: `unknown`
- Old version of ObstacleFootprint.scaling_speed, use that instead.

**`Description`**
- Type: `unknown`
- Scale for path align critic, overriding local default.

**`Description`**
- Type: `unknown`
- Scale for goal align critic, overriding local default.

**`Description`**
- Type: `unknown`
- Scale for path distance critic, overriding local default.

**`Description`**
- Type: `unknown`
- Scale for goal distance critic, overriding local default.


---

##### Kinematic Parameters

*Source: [https://docs.nav2.org/configuration/packages/dwb-params/kinematic.html](https://docs.nav2.org/configuration/packages/dwb-params/kinematic.html)*

###### Kinematic Parameters

###### Parameters

`<dwb plugin>`: DWB plugin name defined in the **controller\_plugin\_ids** parameter in [Controller Server](../configuring-controller-server.html#configuring-controller-server).

`<dwb plugin>`.max\_vel\_theta
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Maximum angular velocity (rad/s).
```

`<dwb plugin>`.min\_speed\_xy
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Minimum translational speed (m/s).
```

`<dwb plugin>`.max\_speed\_xy
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Maximum translational speed (m/s).
```

`<dwb plugin>`.min\_speed\_theta
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Minimum angular speed (rad/s).
```

`<dwb plugin>`.min\_vel\_x
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Minimum velocity X (m/s).
```

`<dwb plugin>`.min\_vel\_y
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Minimum velocity Y (m/s).
```

`<dwb plugin>`.max\_vel\_x
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Maximum velocity X (m/s).
```

`<dwb plugin>`.max\_vel\_y
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Maximum velocity Y (m/s).
```

`<dwb plugin>`.acc\_lim\_x
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Maximum acceleration X (m/s^2).
```

`<dwb plugin>`.acc\_lim\_y
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Maximum acceleration Y (m/s^2).
```

`<dwb plugin>`.acc\_lim\_theta
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Maximum acceleration rotation (rad/s^2).
```

`<dwb plugin>`.decel\_lim\_x
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Maximum deceleration X (m/s^2).
```

`<dwb plugin>`.decel\_lim\_y
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Maximum deceleration Y (m/s^2).
```

`<dwb plugin>`.decel\_lim\_theta
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Maximum deceleration rotation (rad/s^2).
```

#### Parameters

**`<dwbplugin>.max_vel_theta`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionMaximum angular velocity (rad/s).

**`<dwbplugin>.min_speed_xy`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionMinimum translational speed (m/s).

**`<dwbplugin>.max_speed_xy`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionMaximum translational speed (m/s).

**`<dwbplugin>.min_speed_theta`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionMinimum angular speed (rad/s).

**`<dwbplugin>.min_vel_x`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionMinimum velocity X (m/s).

**`<dwbplugin>.min_vel_y`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionMinimum velocity Y (m/s).

**`<dwbplugin>.max_vel_x`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionMaximum velocity X (m/s).

**`<dwbplugin>.max_vel_y`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionMaximum velocity Y (m/s).

**`<dwbplugin>.acc_lim_x`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionMaximum acceleration X (m/s^2).

**`<dwbplugin>.acc_lim_y`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionMaximum acceleration Y (m/s^2).

**`<dwbplugin>.acc_lim_theta`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionMaximum acceleration rotation (rad/s^2).

**`<dwbplugin>.decel_lim_x`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionMaximum deceleration X (m/s^2).

**`<dwbplugin>.decel_lim_y`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionMaximum deceleration Y (m/s^2).

**`<dwbplugin>.decel_lim_theta`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionMaximum deceleration rotation (rad/s^2).

**`Description`**
- Type: `unknown`
- Maximum angular velocity (rad/s).

**`Description`**
- Type: `unknown`
- Minimum translational speed (m/s).

**`Description`**
- Type: `unknown`
- Maximum translational speed (m/s).

**`Description`**
- Type: `unknown`
- Minimum angular speed (rad/s).

**`Description`**
- Type: `unknown`
- Minimum velocity X (m/s).

**`Description`**
- Type: `unknown`
- Minimum velocity Y (m/s).

**`Description`**
- Type: `unknown`
- Maximum velocity X (m/s).

**`Description`**
- Type: `unknown`
- Maximum velocity Y (m/s).

**`Description`**
- Type: `unknown`
- Maximum acceleration X (m/s^2).

**`Description`**
- Type: `unknown`
- Maximum acceleration Y (m/s^2).

**`Description`**
- Type: `unknown`
- Maximum acceleration rotation (rad/s^2).

**`Description`**
- Type: `unknown`
- Maximum deceleration X (m/s^2).

**`Description`**
- Type: `unknown`
- Maximum deceleration Y (m/s^2).

**`Description`**
- Type: `unknown`
- Maximum deceleration rotation (rad/s^2).


---

##### Publisher

*Source: [https://docs.nav2.org/configuration/packages/dwb-params/visualization.html](https://docs.nav2.org/configuration/packages/dwb-params/visualization.html)*

###### Publisher

###### Parameters

`<dwb plugin>`: DWB plugin name defined in the **controller\_plugin\_ids** parameter in [Controller Server](../configuring-controller-server.html#configuring-controller-server).

`<dwb plugin>`.publish\_evaluation
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to publish the local plan evaluation.
```

`<dwb plugin>`.publish\_local\_plan
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to publish the local planner’s plan.
```

`<dwb plugin>`.publish\_trajectories
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to publish debug trajectories.
```

`<dwb plugin>`.publish\_cost\_grid\_pc
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to publish the cost grid.
```

`<dwb plugin>`.marker\_lifetime
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
Description
:   How long for the marker to remain.
```

#### Parameters

**`<dwbplugin>.publish_evaluation`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to publish the local plan evaluation.

**`<dwbplugin>.publish_local_plan`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to publish the local planner’s plan.

**`<dwbplugin>.publish_trajectories`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to publish debug trajectories.

**`<dwbplugin>.publish_cost_grid_pc`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to publish the cost grid.

**`<dwbplugin>.marker_lifetime`**
- Type: `unknown`
- TypeDefaultdouble0.1DescriptionHow long for the marker to remain.

**`Description`**
- Type: `unknown`
- Whether to publish the local plan evaluation.

**`Description`**
- Type: `unknown`
- Whether to publish the local planner’s plan.

**`Description`**
- Type: `unknown`
- Whether to publish debug trajectories.

**`Description`**
- Type: `unknown`
- Whether to publish the cost grid.

**`Description`**
- Type: `unknown`
- How long for the marker to remain.


---

##### XYTheta Iterator

*Source: [https://docs.nav2.org/configuration/packages/dwb-params/iterator.html](https://docs.nav2.org/configuration/packages/dwb-params/iterator.html)*

###### XYTheta Iterator

###### Parameters

`<dwb plugin>`: DWB plugin name defined in the **controller\_plugin\_ids** parameter in [Controller Server](../configuring-controller-server.html#configuring-controller-server).

`<dwb plugin>`.vx\_samples
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 20 |
```

```
Description
:   Number of velocity samples in the X velocity direction.
```

`<dwb plugin>`.vy\_samples
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 5 |
```

```
Description
:   Number of velocity samples in the Y velocity direction.
```

`<dwb plugin>`.vtheta\_samples
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 20 |
```

```
Description
:   Number of velocity samples in the angular directions.
```

#### Parameters

**`<dwbplugin>.vx_samples`**
- Type: `unknown`
- TypeDefaultint20DescriptionNumber of velocity samples in the X velocity direction.

**`<dwbplugin>.vy_samples`**
- Type: `unknown`
- TypeDefaultint5DescriptionNumber of velocity samples in the Y velocity direction.

**`<dwbplugin>.vtheta_samples`**
- Type: `unknown`
- TypeDefaultint20DescriptionNumber of velocity samples in the angular directions.

**`Description`**
- Type: `unknown`
- Number of velocity samples in the X velocity direction.

**`Description`**
- Type: `unknown`
- Number of velocity samples in the Y velocity direction.

**`Description`**
- Type: `unknown`
- Number of velocity samples in the angular directions.


---

#### Dwb Plugins

##### LimitedAccelGenerator

*Source: [https://docs.nav2.org/configuration/packages/dwb-plugins/limited_accel_generator.html](https://docs.nav2.org/configuration/packages/dwb-plugins/limited_accel_generator.html)*

###### LimitedAccelGenerator

`<dwb plugin>`: DWB plugin name defined in the **controller\_plugin\_ids** parameter in [Controller Server](../configuring-controller-server.html#configuring-controller-server).

###### Parameters

`<dwb plugin>`.sim\_time
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.7 |
```

```
> Description
> :   Time to simulate ahead by (s).
```

#### Parameters

**`<dwbplugin>.sim_time`**
- Type: `unknown`
- TypeDefaultdouble1.7DescriptionTime to simulate ahead by (s).

**`Description`**
- Type: `unknown`
- Time to simulate ahead by (s).


---

##### StandardTrajectoryGenerator

*Source: [https://docs.nav2.org/configuration/packages/dwb-plugins/standard_traj_generator.html](https://docs.nav2.org/configuration/packages/dwb-plugins/standard_traj_generator.html)*

###### StandardTrajectoryGenerator

###### Parameters

`<dwb plugin>`: DWB plugin name defined in the **controller\_plugin\_ids** parameter in [Controller Server](../configuring-controller-server.html#configuring-controller-server).

`<dwb plugin>`.sim\_time
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.7 |
```

```
> Description
> :   Time to simulate ahead by (s).
```

`<dwb plugin>`.discretize\_by\_time
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
> Description
> :   If true, forward simulate by time. If False, forward simulate by linear and angular granularity.
```

`<dwb plugin>`.time\_granularity
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
> Description
> :   Time ahead to project.
```

`<dwb plugin>`.linear\_granularity
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
> Description
> :   Linear distance forward to project.
```

`<dwb plugin>`.angular\_granularity
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.025 |
```

```
> Description
> :   Angular distance to project.
```

`<dwb plugin>`.include\_last\_point
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
> Description
> :   Whether to include the last pose in the trajectory.
```

`<dwb plugin>`.limit\_vel\_cmd\_in\_traj
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
> Description
> :   Whether to limit velocity command in trajectory using sampled velocity instead of the commanded velocity.
```

#### Parameters

**`<dwbplugin>.sim_time`**
- Type: `unknown`
- TypeDefaultdouble1.7DescriptionTime to simulate ahead by (s).

**`<dwbplugin>.discretize_by_time`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionIf true, forward simulate by time. If False, forward simulate by linear and angular granularity.

**`<dwbplugin>.time_granularity`**
- Type: `unknown`
- TypeDefaultdouble0.5DescriptionTime ahead to project.

**`<dwbplugin>.linear_granularity`**
- Type: `unknown`
- TypeDefaultdouble0.5DescriptionLinear distance forward to project.

**`<dwbplugin>.angular_granularity`**
- Type: `unknown`
- TypeDefaultdouble0.025DescriptionAngular distance to project.

**`<dwbplugin>.include_last_point`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to include the last pose in the trajectory.

**`<dwbplugin>.limit_vel_cmd_in_traj`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to limit velocity command in trajectory using sampled velocity instead of the commanded velocity.

**`Description`**
- Type: `unknown`
- Time to simulate ahead by (s).

**`Description`**
- Type: `unknown`
- If true, forward simulate by time. If False, forward simulate by linear and angular granularity.

**`Description`**
- Type: `unknown`
- Time ahead to project.

**`Description`**
- Type: `unknown`
- Linear distance forward to project.

**`Description`**
- Type: `unknown`
- Angular distance to project.

**`Description`**
- Type: `unknown`
- Whether to include the last pose in the trajectory.

**`Description`**
- Type: `unknown`
- Whether to limit velocity command in trajectory using sampled velocity instead of the commanded velocity.


---

#### Map Server

##### Costmap Filter Info Server

*Source: [https://docs.nav2.org/configuration/packages/map_server/configuring-costmap-filter-info-server.html](https://docs.nav2.org/configuration/packages/map_server/configuring-costmap-filter-info-server.html)*

###### Costmap Filter Info Server

The costmap filter info server is responsible for providing information about the [Costmap Filters](../../../migration/Foxy.html#costmap-filters) being used in the navigation stack. It publishes costmap filter mask specific metadata on a configured topic. This metadata is used by other components in the system to interpret the values in the costmap filter masks.

###### Costmap Filter Info Server Parameters

type
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 0 |
```

```
Description
:   Type of costmap filter used. This is an enum for the type of filter this should be interpreted as. We provide the following pre-defined types:
```

```
    * 0: keepout zones / preferred lanes filter
    * 1: speed filter, speed limit is specified in % of maximum speed
    * 2: speed filter, speed limit is specified in absolute value (m/s)
    * 3: binary filter
```

filter\_info\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “costmap\_filter\_info” |
```

```
Description
:   Topic to publish costmap filter information to.
```

mask\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “filter\_mask” |
```

```
Description
:   Topic to publish filter mask to. The value of this parameter should be in accordance with `topic_name` parameter of Map Server tuned to filter mask publishing.
```

base
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Base of `OccupancyGrid` mask value -> filter space value linear conversion which is being proceeded as:
    `filter_space_value = base + multiplier * mask_value`
```

multiplier
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description
:   Multiplier of `OccupancyGrid` mask value -> filter space value linear conversion which is being proceeded as:
    `filter_space_value = base + multiplier * mask_value`
```

bond\_heartbeat\_period
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
Description
:   The lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.
```

allow\_parameter\_qos\_overrides
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to allow QoS profiles to be overwritten with parameterized values.
```

###### Example

```
map_server:
  ros__parameters:
    yaml_filename: "turtlebot3_world.yaml"
    topic_name: "map"
    frame_id: "map"
    introspection_mode: "disabled"

map_saver:
  ros__parameters:
    save_map_timeout: 5.0
    free_thresh_default: 0.25
    occupied_thresh_default: 0.65
    introspection_mode: "disabled"

costmap_filter_info_server:
  ros__parameters:
    type: 1
    filter_info_topic: "costmap_filter_info"
    mask_topic: "filter_mask"
    base: 0.0
    multiplier: 0.25
```

#### Parameters

**`type`**
- Type: `unknown`
- TypeDefaultint0DescriptionType of costmap filter used. This is an enum for the type of filter this should be interpreted as. We provide the following pre-defined types:0: keepout zones / preferred lanes filter1: speed filter, speed limit is specified in % of maximum speed2: speed filter, speed limit is specified in absolute value (m/s)3: binary filter

**`filter_info_topic`**
- Type: `unknown`
- TypeDefaultstring“costmap_filter_info”DescriptionTopic to publish costmap filter information to.

**`mask_topic`**
- Type: `unknown`
- TypeDefaultstring“filter_mask”DescriptionTopic to publish filter mask to. The value of this parameter should be in accordance withtopic_nameparameter of Map Server tuned to filter mask publishing.

**`base`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionBase ofOccupancyGridmask value -> filter space value linear conversion which is being proceeded as:filter_space_value=base+multiplier*mask_value

**`multiplier`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionMultiplier ofOccupancyGridmask value -> filter space value linear conversion which is being proceeded as:filter_space_value=base+multiplier*mask_value

**`bond_heartbeat_period`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionThe lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.

**`allow_parameter_qos_overrides`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to allow QoS profiles to be overwritten with parameterized values.

**`Description`**
- Type: `unknown`
- Type of costmap filter used. This is an enum for the type of filter this should be interpreted as. We provide the following pre-defined types:0: keepout zones / preferred lanes filter1: speed filter, speed limit is specified in % of maximum speed2: speed filter, speed limit is specified in absolute value (m/s)3: binary filter

**`Description`**
- Type: `unknown`
- Topic to publish costmap filter information to.

**`Description`**
- Type: `unknown`
- Topic to publish filter mask to. The value of this parameter should be in accordance withtopic_nameparameter of Map Server tuned to filter mask publishing.

**`Description`**
- Type: `unknown`
- Base ofOccupancyGridmask value -> filter space value linear conversion which is being proceeded as:filter_space_value=base+multiplier*mask_value

**`Description`**
- Type: `unknown`
- Multiplier ofOccupancyGridmask value -> filter space value linear conversion which is being proceeded as:filter_space_value=base+multiplier*mask_value

**`Description`**
- Type: `unknown`
- The lifecycle node bond mechanism publishing period (on the /bond topic). Disabled if inferior or equal to 0.0.

**`Description`**
- Type: `unknown`
- Whether to allow QoS profiles to be overwritten with parameterized values.


---

##### Map Saver

*Source: [https://docs.nav2.org/configuration/packages/map_server/configuring-map-saver.html](https://docs.nav2.org/configuration/packages/map_server/configuring-map-saver.html)*

###### Map Saver

The map saver server runs in the background and saves maps based on service requests. There exists a map saver CLI similar to ROS 1 as well for a single map save.

###### Map Saver Parameters

save\_map\_timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 2.0 |
```

```
Description
:   Timeout to attempt saving the map (seconds).
```

free\_thresh\_default
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
Description
:   Free space maximum probability threshold value for occupancy grid.
```

occupied\_thresh\_default
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.65 |
```

```
Description
:   Occupied space minimum probability threshold value for occupancy grid.
```

introspection\_mode
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “disabled” |
```

```
Description
:   The introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.
```

#### Parameters

**`save_map_timeout`**
- Type: `unknown`
- TypeDefaultint2.0DescriptionTimeout to attempt saving the map (seconds).

**`free_thresh_default`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionFree space maximum probability threshold value for occupancy grid.

**`occupied_thresh_default`**
- Type: `unknown`
- TypeDefaultdouble0.65DescriptionOccupied space minimum probability threshold value for occupancy grid.

**`introspection_mode`**
- Type: `unknown`
- TypeDefaultstring“disabled”DescriptionThe introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.

**`Description`**
- Type: `unknown`
- Timeout to attempt saving the map (seconds).

**`Description`**
- Type: `unknown`
- Free space maximum probability threshold value for occupancy grid.

**`Description`**
- Type: `unknown`
- Occupied space minimum probability threshold value for occupancy grid.

**`Description`**
- Type: `unknown`
- The introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.


---

##### Map Server

*Source: [https://docs.nav2.org/configuration/packages/map_server/configuring-map-server.html](https://docs.nav2.org/configuration/packages/map_server/configuring-map-server.html)*

###### Map Server

The Map Server implements the server for handling the map load requests for the stack and hosts a map topic.

###### Map Server Parameters

yaml\_filename
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description
:   Path to map yaml file. Note from Rolling + Iron-Turtle forward: This parameter can set either from the yaml file or using the launch configuration parameter `map`. If we set it on launch commandline / launch configuration default, we override the yaml default. If you would like the specify your map file in yaml, remove the launch default so it is not overridden in Nav2’s default launch files. Before Iron: `yaml_filename` must be set in the yaml (even if a bogus value) so that our launch scripts can overwrite it with launch values.
```

topic\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “map” |
```

```
Description
:   Topic to publish loaded map to.
```

frame\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “map” |
```

```
Description
:   Frame to publish loaded map in.
```

introspection\_mode
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “disabled” |
```

```
Description
:   The introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.
```

#### Parameters

**`yaml_filename`**
- Type: `unknown`
- TypeDefaultstringN/ADescriptionPath to map yaml file. Note from Rolling + Iron-Turtle forward: This parameter can set either from the yaml file or using the launch configuration parametermap. If we set it on launch commandline / launch configuration default, we override the yaml default. If you would like the specify your map file in yaml, remove the launch default so it is not overridden in Nav2’s default launch files. Before Iron:yaml_filenamemust be set in the yaml (even if a bogus value) so that our launch scripts can overwrite it with launch values.

**`topic_name`**
- Type: `unknown`
- TypeDefaultstring“map”DescriptionTopic to publish loaded map to.

**`frame_id`**
- Type: `unknown`
- TypeDefaultstring“map”DescriptionFrame to publish loaded map in.

**`introspection_mode`**
- Type: `unknown`
- TypeDefaultstring“disabled”DescriptionThe introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.

**`Description`**
- Type: `unknown`
- Path to map yaml file. Note from Rolling + Iron-Turtle forward: This parameter can set either from the yaml file or using the launch configuration parametermap. If we set it on launch commandline / launch configuration default, we override the yaml default. If you would like the specify your map file in yaml, remove the launch default so it is not overridden in Nav2’s default launch files. Before Iron:yaml_filenamemust be set in the yaml (even if a bogus value) so that our launch scripts can overwrite it with launch values.

**`Description`**
- Type: `unknown`
- Topic to publish loaded map to.

**`Description`**
- Type: `unknown`
- Frame to publish loaded map in.

**`Description`**
- Type: `unknown`
- The introspection mode for services and actions. Options are “disabled”, “metadata”, “contents”.


---

##### Vector Object Server

*Source: [https://docs.nav2.org/configuration/packages/map_server/configuring-vector-object-server.html](https://docs.nav2.org/configuration/packages/map_server/configuring-vector-object-server.html)*

###### Vector Object Server

The Vector Object Server implements a server that puts vector objects (such as polygons and circles) on OccupancyGrid raster map. The output raster map is being published by Vector Object server, and it could be used anywhere in the Nav2 stack or outside it.

The main application of Vector Object server is to output raster maps of polygon objects or regions with existing costmaps of environment, targeting for robot navigation purposes (for example for dynamic obstacles simulation/highlighting, sensors noise removal, black-out areas on maps, synthetic testing purposes, and much more).
Rather than rastering vector objects each iteration or at run-time, it is done one-time on startup, and served to costmap layers or other consumers improving performance.
A typical setup model for this is a Nav2 stack with Costmap Filters enabled, running in conjunction with a Vector Object server, which produces vectorised OccupancyGrid maps as input masks for the Costmap Filters:

[![../../../_images/vo_design.png](../../../_images/vo_design.png)](../../../_images/vo_design.png)

These vector shapes could be added by using ROS input parameters as well as being handled by the following service calls: `AddShapes.srv` which adds new shapes or modifies existing ones, `RemoveShapes.srv` which removes any or all shapes from the map `GetShapes.srv` which returns all shapes on the map.

Each vector shape is being handled by its `unique_identifier_msgs/UUID`. Developers can choose whether to specify it manually for a new shape, or have it generated automatically by the Vector Object server. The UUID can always be obtained by making a `GetShapes.srv` request and getting the response with all shapes’ UUIDs and their properties.

The Vector Object server places shapes on the map. Each vector object has its own value in the range from `{-1}, [0..100]`, which matches the OccupancyGrid values. Vector objects can be overlapped with each other by using one of the global overlapping rules: (a) **sequential overlapping** in the same order as vector objects arrived on the server, or (b) taking the **maximum / minimum value** from all vector objects and the map background (if it is known).

This page describes all the configuration parameters of the Vector Object server. For more information on how to navigate with your own Vector Object server, please refer to the [Navigating with Vector Objects](../../../tutorials/docs/navigation2_with_vector_objects.html#navigation2-with-vector-objects) tutorial.

###### Features

* The following vector shapes are currently supported for placing on a map:

  + Polygons
  + Circles
* Polygons can be filled with any value or drawn as a polygonal chain, if it is not supposed to be a closed shape:

[![../../../_images/polygon_closed.png](../../../_images/polygon_closed.png)](../../../_images/polygon_closed.png)

* Circles can be filled with any value or drawn without any fill (only the circle boundary is placed on the map):

[![../../../_images/circle_fill.png](../../../_images/circle_fill.png)](../../../_images/circle_fill.png)

* Vector shapes could be set once during the Vector Object server startup as ROS-parameters, and added/modified/removed over the time using the following service calls:

  + `AddShapes.srv`: adds new shapes or modifies existing ones
  + `RemoveShapes.srv`: removes any or all shapes from the map
  + `GetShapes.srv`: gets all shapes and their properties
* Vector shapes are being identified by their UUID (`unique_identifier_msgs/UUID`), which is generated automatically for a new shape, or could be given manually by the developer.
* Vector shapes can be placed in any frame:

  + If at least one of the shapes is set in a different frame than the map, a dynamic update model will be enabled: this shape can move over the time, output map will be published dynamically with a given rate.
  + If all shapes are set in the same frame as map, map will be published/updated once: at startup of Vector Object server and on each call of `AddShapes.srv` or `RemoveShapes.srv` to change the shape.

###### Covered use-cases

Using Vector Object server publishing an output map as input mask to [Costmap Filters](../../../migration/Foxy.html#costmap-filters) allows the following example use-cases using polygon, vector representations of areas rather than rastered masks:

* No-access zone
* Speed-restriction areas
* Virtual obstacles on costmap
* Geofence / outer boundary and inner virtual obstacles
* Robot footprint (or any other moving objects) replacement
* Hiding some areas from costmap
* Sensors noise removal
* Dynamic objects simulation/highlighting
* Other testing purposes

###### Parameters

map\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “vo\_map” |
```

```
Description:
:   Output topic, publishing an OccupancyGrid map with vector objects put on it.
```

global\_frame\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “map” |
```

```
Description:
:   The name of the coordinate frame where the map is being published at.
```

resolution
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.05 |
```

```
Description:
:   Output map resolution in meters.
```

default\_value
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | -1 (unknown) |
```

```
Description:
:   Default OccupancyGrid value to fill the background of output map with.
```

overlay\_type
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 0 |
```

```
Description:
:   How one vector object to be overlaid with other and the map.
    The following values are supported:
```

```
    > * 0 (`OVERLAY_SEQ`): Vector objects are superimposed in the order in which they have arrived.
    > * 1 (`OVERLAY_MAX`): Maximum value from vector objects and map is being chosen.
    > * 2 (`OVERLAY_MIN`): Minimum value from vector objects and map is being chosen. Unknown OccupancyGrid value is always being overrode, when it is possible.
```

update\_frequency
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
Description:
:   Output map update frequency (when dynamic update model is switched-on).
```

transform\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
Description:
:   Transform tolerance for the case when any of the shapes are placed in different than map’s frame.
```

shapes
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<string> | {} |
```

```
Description:
:   List of vector objects (polygons and circles). Empty by-default.
```

###### Shapes parameters

`<shape_name>` - is the corresponding shape name string selected for this vector object.

`<shape_name>`.type
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description:
:   Type of vector object shape. Available values are `polygon` and `circle`. Causes an error, if not specialized.
```

`<shape_name>`.uuid
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | N/A |
```

```
Description:
:   UUID of the shape specified in `12345678-9abc-def0-1234-56789abcdef0` format. Parameter is optional and could be skipped: if not specialized, Vector Object server will automatically generate a new one for the shape.
```

`<shape_name>`.frame\_id
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “” |
```

```
Description:
:   Frame ID of the given shape. Empty value is being treated as map’s global frame.
```

`<shape_name>`.value
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 100 (occupied) |
```

```
Description:
:   Shape’s value to be put on map with.
```

###### Parameters applicable for polygons only

`<shape_name>`.points
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<double> | N/A |
```

```
Description:
:   Polygon vertices, listed in `[p1.x, p1.y, p2.x, p2.y, p3.x, p3.y, ...]` format (e.g. `[0.5, 0.5, 0.5, -0.5, -0.5, -0.5, -0.5, 0.5]` for the square). Minimum 3 points for a triangle polygon. Causes an error, if not specialized incorrectly (less than 6 or odd number of items in the vector) or not specialized.
```

`<shape_name>`.closed
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description:
:   Whether the polygon is closed (and filled), or drawn as polygonal chain otherwise.
```

###### Parameters applicable for circles only

`<shape_name>`.center
:   |  |  |
```
| --- | --- |
| Type | Default |
| vector<double> | N/A |
```

```
Description:
:   Center of the circle, listed in `{center.x, center.y}` format (e.g. `{0.2, 0.3}`). Should contain exactly 2 items: X and Y coordinate of the circle’s center in a given frame. Otherwise, causes an error.
```

`<shape_name>`.radius
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | N/A |
```

```
Description:
:   Circle radius. Causes an error, if less than zero or not specialized.
```

`<shape_name>`.fill
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description:
:   Whether the circle to be filled with a given value, or drawn only circle’s border otherwise.
```

###### Example

Here is an example of configuration YAML for the Vector Object server:

```
vector_object_server:
  ros__parameters:
    map_topic: "vo_map"
    global_frame_id: "map"
    resolution: 0.05
    default_value: -1
    overlay_type: 0
    update_frequency: 1.0
    transform_tolerance: 0.1
    shapes: ["Poly", "CircleA", "CircleB"]
    Poly:
      type: "polygon"
      frame_id: "map"
      closed: True
      value: 100
      points: [0.3, 0.3, 0.3, -0.3, 0.0, -0.3, 0.0, 0.3]
    CircleA:
      type: "circle"
      frame_id: "map"
      fill: True
      value: 10
      center: [3.0, 3.0]
      radius: 0.5
      uuid: "7b3f3d7d-135c-4b6c-aca1-7a84d1050505"
    CircleB:
      type: "circle"
      frame_id: "map"
      fill: False
      value: 90
      center: [3.5, 3.5]
      radius: 1.5
```

For this, Vector Object server will produce the following map:

[![../../../_images/vo_config_map.png](../../../_images/vo_config_map.png)](../../../_images/vo_config_map.png)

#### Parameters

**`map_topic`**
- Type: `unknown`
- TypeDefaultstring“vo_map”Description:Output topic, publishing an OccupancyGrid map with vector objects put on it.

**`global_frame_id`**
- Type: `unknown`
- TypeDefaultstring“map”Description:The name of the coordinate frame where the map is being published at.

**`resolution`**
- Type: `unknown`
- TypeDefaultdouble0.05Description:Output map resolution in meters.

**`default_value`**
- Type: `unknown`
- TypeDefaultint-1 (unknown)Description:Default OccupancyGrid value to fill the background of output map with.

**`overlay_type`**
- Type: `unknown`
- TypeDefaultint0Description:How one vector object to be overlaid with other and the map.
The following values are supported:0 (OVERLAY_SEQ): Vector objects are superimposed in the order in which they have arrived.1 (OVERLAY_MAX): Maximum value from vector objects and map is being chosen.2 (OVERLAY_MIN): Minimum value from vector objects and map is being chosen. Unknown OccupancyGrid value is always being overrode, when it is possible.

**`update_frequency`**
- Type: `unknown`
- TypeDefaultdouble1.0Description:Output map update frequency (when dynamic update model is switched-on).

**`transform_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.1Description:Transform tolerance for the case when any of the shapes are placed in different than map’s frame.

**`shapes`**
- Type: `unknown`
- TypeDefaultvector<string>{}Description:List of vector objects (polygons and circles). Empty by-default.

**`Description:`**
- Type: `unknown`
- Output topic, publishing an OccupancyGrid map with vector objects put on it.

**`Description:`**
- Type: `unknown`
- The name of the coordinate frame where the map is being published at.

**`Description:`**
- Type: `unknown`
- Output map resolution in meters.

**`Description:`**
- Type: `unknown`
- Default OccupancyGrid value to fill the background of output map with.

**`Description:`**
- Type: `unknown`
- How one vector object to be overlaid with other and the map.
The following values are supported:0 (OVERLAY_SEQ): Vector objects are superimposed in the order in which they have arrived.1 (OVERLAY_MAX): Maximum value from vector objects and map is being chosen.2 (OVERLAY_MIN): Minimum value from vector objects and map is being chosen. Unknown OccupancyGrid value is always being overrode, when it is possible.

**`Description:`**
- Type: `unknown`
- Output map update frequency (when dynamic update model is switched-on).

**`Description:`**
- Type: `unknown`
- Transform tolerance for the case when any of the shapes are placed in different than map’s frame.

**`Description:`**
- Type: `unknown`
- List of vector objects (polygons and circles). Empty by-default.

**`<shape_name>.type`**
- Type: `unknown`
- TypeDefaultstringN/ADescription:Type of vector object shape. Available values arepolygonandcircle. Causes an error, if not specialized.

**`<shape_name>.uuid`**
- Type: `unknown`
- TypeDefaultstringN/ADescription:UUID of the shape specified in12345678-9abc-def0-1234-56789abcdef0format. Parameter is optional and could be skipped: if not specialized, Vector Object server will automatically generate a new one for the shape.

**`<shape_name>.frame_id`**
- Type: `unknown`
- TypeDefaultstring“”Description:Frame ID of the given shape. Empty value is being treated as map’s global frame.

**`<shape_name>.value`**
- Type: `unknown`
- TypeDefaultint100 (occupied)Description:Shape’s value to be put on map with.

**`Description:`**
- Type: `unknown`
- Type of vector object shape. Available values arepolygonandcircle. Causes an error, if not specialized.

**`Description:`**
- Type: `unknown`
- UUID of the shape specified in12345678-9abc-def0-1234-56789abcdef0format. Parameter is optional and could be skipped: if not specialized, Vector Object server will automatically generate a new one for the shape.

**`Description:`**
- Type: `unknown`
- Frame ID of the given shape. Empty value is being treated as map’s global frame.

**`Description:`**
- Type: `unknown`
- Shape’s value to be put on map with.

**`<shape_name>.points`**
- Type: `unknown`
- TypeDefaultvector<double>N/ADescription:Polygon vertices, listed in[p1.x,p1.y,p2.x,p2.y,p3.x,p3.y,...]format (e.g.[0.5,0.5,0.5,-0.5,-0.5,-0.5,-0.5,0.5]for the square). Minimum 3 points for a triangle polygon. Causes an error, if not specialized incorrectly (less than 6 or odd number of items in the vector) or not specialized.

**`<shape_name>.closed`**
- Type: `unknown`
- TypeDefaultbooltrueDescription:Whether the polygon is closed (and filled), or drawn as polygonal chain otherwise.

**`Description:`**
- Type: `unknown`
- Polygon vertices, listed in[p1.x,p1.y,p2.x,p2.y,p3.x,p3.y,...]format (e.g.[0.5,0.5,0.5,-0.5,-0.5,-0.5,-0.5,0.5]for the square). Minimum 3 points for a triangle polygon. Causes an error, if not specialized incorrectly (less than 6 or odd number of items in the vector) or not specialized.

**`Description:`**
- Type: `unknown`
- Whether the polygon is closed (and filled), or drawn as polygonal chain otherwise.

**`<shape_name>.center`**
- Type: `unknown`
- TypeDefaultvector<double>N/ADescription:Center of the circle, listed in{center.x,center.y}format (e.g.{0.2,0.3}). Should contain exactly 2 items: X and Y coordinate of the circle’s center in a given frame. Otherwise, causes an error.

**`<shape_name>.radius`**
- Type: `unknown`
- TypeDefaultdoubleN/ADescription:Circle radius. Causes an error, if less than zero or not specialized.

**`<shape_name>.fill`**
- Type: `unknown`
- TypeDefaultbooltrueDescription:Whether the circle to be filled with a given value, or drawn only circle’s border otherwise.

**`Description:`**
- Type: `unknown`
- Center of the circle, listed in{center.x,center.y}format (e.g.{0.2,0.3}). Should contain exactly 2 items: X and Y coordinate of the circle’s center in a given frame. Otherwise, causes an error.

**`Description:`**
- Type: `unknown`
- Circle radius. Causes an error, if less than zero or not specialized.

**`Description:`**
- Type: `unknown`
- Whether the circle to be filled with a given value, or drawn only circle’s border otherwise.


---

#### Nav2 Controller Plugins

##### AxisGoalChecker

*Source: [https://docs.nav2.org/configuration/packages/nav2_controller-plugins/axis_goal_checker.html](https://docs.nav2.org/configuration/packages/nav2_controller-plugins/axis_goal_checker.html)*

###### AxisGoalChecker

Checks whether the robot has reached the goal pose by projecting the robot’s position onto the path direction defined by the last segment of the path. This goal checker uses the last two poses of the path (`before_goal_pose` and `goal_pose`) to determine the path direction and then checks if the robot is within tolerance along that axis.

Unlike simple distance-based goal checkers, the AxisGoalChecker allows independent control of tolerances along the path direction (`along_path_tolerance`) and perpendicular to it (`cross_track_tolerance`). This is particularly useful for applications where precise alignment along a specific axis is more important than radial distance from the goal.

![AxisGoalChecker Illustration](../../../_images/axis_goal_checker.png)

###### Parameters

`<nav2_controller plugin>`: nav2\_controller plugin name defined in the **goal\_checker\_plugin\_id** parameter in [Controller Server](../configuring-controller-server.html#configuring-controller-server).

`<nav2_controller plugin>`.along\_path\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
> Description
> :   Tolerance for the projected distance along the path direction (m). This checks how far ahead or behind the goal the robot is when projected onto the path axis.
```

`<nav2_controller plugin>`.cross\_track\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
> Description
> :   Tolerance for the perpendicular distance from the path direction (m). This checks how far to the left or right of the path axis the robot is.
```

`<nav2_controller plugin>`.path\_length\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
> Description
> :   Maximum path length to consider for goal checking (m). If the remaining path length exceeds this value, the goal check is skipped. This prevents premature goal acceptance when far from the goal.
```

`<nav2_controller plugin>`.is\_overshoot\_valid
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
> Description
> :   Whether to allow overshooting past the goal along the path direction. When false (default), uses `fabs(projected_distance) < along_path_tolerance` for symmetric tolerance. When true, uses `projected_distance < along_path_tolerance`, allowing the robot to be any distance past the goal but still requiring it to be within tolerance if before the goal.
```

#### Parameters

**`<nav2_controllerplugin>.along_path_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionTolerance for the projected distance along the path direction (m). This checks how far ahead or behind the goal the robot is when projected onto the path axis.

**`<nav2_controllerplugin>.cross_track_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionTolerance for the perpendicular distance from the path direction (m). This checks how far to the left or right of the path axis the robot is.

**`<nav2_controllerplugin>.path_length_tolerance`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionMaximum path length to consider for goal checking (m). If the remaining path length exceeds this value, the goal check is skipped. This prevents premature goal acceptance when far from the goal.

**`<nav2_controllerplugin>.is_overshoot_valid`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to allow overshooting past the goal along the path direction. When false (default), usesfabs(projected_distance)<along_path_tolerancefor symmetric tolerance. When true, usesprojected_distance<along_path_tolerance, allowing the robot to be any distance past the goal but still requiring it to be within tolerance if before the goal.

**`Description`**
- Type: `unknown`
- Tolerance for the projected distance along the path direction (m). This checks how far ahead or behind the goal the robot is when projected onto the path axis.

**`Description`**
- Type: `unknown`
- Tolerance for the perpendicular distance from the path direction (m). This checks how far to the left or right of the path axis the robot is.

**`Description`**
- Type: `unknown`
- Maximum path length to consider for goal checking (m). If the remaining path length exceeds this value, the goal check is skipped. This prevents premature goal acceptance when far from the goal.

**`Description`**
- Type: `unknown`
- Whether to allow overshooting past the goal along the path direction. When false (default), usesfabs(projected_distance)<along_path_tolerancefor symmetric tolerance. When true, usesprojected_distance<along_path_tolerance, allowing the robot to be any distance past the goal but still requiring it to be within tolerance if before the goal.


---

##### FeasiblePathHandler

*Source: [https://docs.nav2.org/configuration/packages/nav2_controller-plugins/feasible_path_handler.html](https://docs.nav2.org/configuration/packages/nav2_controller-plugins/feasible_path_handler.html)*

###### FeasiblePathHandler

Transforms the global plan into the local costmap frame, prunes it to the relevant portion
within the costmap bounds, and handles in-place rotation and cusp pruning.

###### Parameters

`<nav2_controller plugin>`: nav2\_controller plugin name defined in the **path\_handler\_plugin\_id** parameter in [Controller Server](../configuring-controller-server.html#configuring-controller-server).

`<nav2_controller plugin>`.reject\_unit\_path
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   If enabled, the path handler will reject a path that contains only a single pose.
```

`<nav2_controller plugin>`.prune\_distance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description
:   Distance ahead of nearest point on path to robot to prune path to (m). This distance should be at least as great as the furthest distance of interest by a critic (i.e. for maximum velocity projection forward, threshold to consider).
```

`<nav2_controller plugin>`.max\_robot\_pose\_search\_dist
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | Costmap size / 2 |
```

```
Description
:   Max integrated distance ahead of robot pose to search for nearest path point in case of path looping.
```

`<nav2_controller plugin>`.enforce\_path\_inversion
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   If true, it will prune paths containing cusping points for segments changing directions (e.g. path inversions) such that the controller will be forced to change directions at or very near the planner’s requested inversion point. In addition, these cusping points will also be treated by the critics as local goals that the robot will attempt to reach. This is targeting Smac Planner users with feasible paths who need their robots to switch directions where specifically requested.
```

`<nav2_controller plugin>`.enforce\_path\_rotation
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   If true, the controller will detect in-place rotation segments (where translation is near zero) and prune the remaining poses after the rotation point. This forces the robot to explicitly perform the rotation before proceeding along the rest of the path.
    This is particularly useful for feasible planners (e.g., Smac Planner) where direction changes are intentionally introduced and must be respected during execution.
```

`<nav2_controller plugin>`.minimum\_rotation\_angle
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.785 |
```

```
Description
:   The minimum accumulated rotation (in radians) required to classify a segment as an in-place rotation. 0.785 rad = 45 deg.
```

`<nav2_controller plugin>`.inversion\_xy\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.2 |
```

```
Description
:   Cartesian proximity (m) to path inversion point to be considered “achieved” to pass on the rest of the path after path inversion.
```

`<nav2_controller plugin>`.inversion\_yaw\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.4 |
```

```
Description
:   Angular proximity (radians) to path inversion point to be considered “achieved” to pass on the rest of the path after path inversion. 0.4 rad = 23 deg.
```

###### Example

```
PathHandler:
    plugin: "nav2_controller::FeasiblePathHandler"
    prune_distance: 2.0
    enforce_path_inversion: True
    enforce_path_rotation: False
    inversion_xy_tolerance: 0.2
    inversion_yaw_tolerance: 0.4
    minimum_rotation_angle: 0.785
    reject_unit_path: False
```

#### Parameters

**`<nav2_controllerplugin>.reject_unit_path`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionIf enabled, the path handler will reject a path that contains only a single pose.

**`<nav2_controllerplugin>.prune_distance`**
- Type: `unknown`
- TypeDefaultdouble2.0DescriptionDistance ahead of nearest point on path to robot to prune path to (m). This distance should be at least as great as the furthest distance of interest by a critic (i.e. for maximum velocity projection forward, threshold to consider).

**`<nav2_controllerplugin>.max_robot_pose_search_dist`**
- Type: `unknown`
- TypeDefaultdoubleCostmap size / 2DescriptionMax integrated distance ahead of robot pose to search for nearest path point in case of path looping.

**`<nav2_controllerplugin>.enforce_path_inversion`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionIf true, it will prune paths containing cusping points for segments changing directions (e.g. path inversions) such that the controller will be forced to change directions at or very near the planner’s requested inversion point. In addition, these cusping points will also be treated by the critics as local goals that the robot will attempt to reach. This is targeting Smac Planner users with feasible paths who need their robots to switch directions where specifically requested.

**`<nav2_controllerplugin>.enforce_path_rotation`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionIf true, the controller will detect in-place rotation segments (where translation is near zero) and prune the remaining poses after the rotation point. This forces the robot to explicitly perform the rotation before proceeding along the rest of the path.
This is particularly useful for feasible planners (e.g., Smac Planner) where direction changes are intentionally introduced and must be respected during execution.

**`<nav2_controllerplugin>.minimum_rotation_angle`**
- Type: `unknown`
- TypeDefaultdouble0.785DescriptionThe minimum accumulated rotation (in radians) required to classify a segment as an in-place rotation. 0.785 rad = 45 deg.

**`<nav2_controllerplugin>.inversion_xy_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.2DescriptionCartesian proximity (m) to path inversion point to be considered “achieved” to pass on the rest of the path after path inversion.

**`<nav2_controllerplugin>.inversion_yaw_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.4DescriptionAngular proximity (radians) to path inversion point to be considered “achieved” to pass on the rest of the path after path inversion. 0.4 rad = 23 deg.

**`Description`**
- Type: `unknown`
- If enabled, the path handler will reject a path that contains only a single pose.

**`Description`**
- Type: `unknown`
- Distance ahead of nearest point on path to robot to prune path to (m). This distance should be at least as great as the furthest distance of interest by a critic (i.e. for maximum velocity projection forward, threshold to consider).

**`Description`**
- Type: `unknown`
- Max integrated distance ahead of robot pose to search for nearest path point in case of path looping.

**`Description`**
- Type: `unknown`
- If true, it will prune paths containing cusping points for segments changing directions (e.g. path inversions) such that the controller will be forced to change directions at or very near the planner’s requested inversion point. In addition, these cusping points will also be treated by the critics as local goals that the robot will attempt to reach. This is targeting Smac Planner users with feasible paths who need their robots to switch directions where specifically requested.

**`Description`**
- Type: `unknown`
- If true, the controller will detect in-place rotation segments (where translation is near zero) and prune the remaining poses after the rotation point. This forces the robot to explicitly perform the rotation before proceeding along the rest of the path.
This is particularly useful for feasible planners (e.g., Smac Planner) where direction changes are intentionally introduced and must be respected during execution.

**`Description`**
- Type: `unknown`
- The minimum accumulated rotation (in radians) required to classify a segment as an in-place rotation. 0.785 rad = 45 deg.

**`Description`**
- Type: `unknown`
- Cartesian proximity (m) to path inversion point to be considered “achieved” to pass on the rest of the path after path inversion.

**`Description`**
- Type: `unknown`
- Angular proximity (radians) to path inversion point to be considered “achieved” to pass on the rest of the path after path inversion. 0.4 rad = 23 deg.


---

##### PoseProgressChecker

*Source: [https://docs.nav2.org/configuration/packages/nav2_controller-plugins/pose_progress_checker.html](https://docs.nav2.org/configuration/packages/nav2_controller-plugins/pose_progress_checker.html)*

###### PoseProgressChecker

Checks whether the robot has made progress based on translation and rotation.

###### Parameters

`<nav2_controller plugin>`: nav2\_controller plugin name defined in the **progress\_checker\_plugin\_id** parameter in [Controller Server](../configuring-controller-server.html#configuring-controller-server).

`<nav2_controller plugin>`.required\_movement\_radius
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description
:   Minimum amount a robot must move to be progressing to goal (m).
```

`<nav2_controller plugin>`.required\_movement\_angle
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description
:   Minimum amount a robot must rotate to be progressing to goal (rad).
```

`<nav2_controller plugin>`.movement\_time\_allowance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10.0 |
```

```
Description
:   Maximum amount of time a robot has to move the minimum radius or the mnimum angle (s).
```

#### Parameters

**`<nav2_controllerplugin>.required_movement_radius`**
- Type: `unknown`
- TypeDefaultdouble0.5DescriptionMinimum amount a robot must move to be progressing to goal (m).

**`<nav2_controllerplugin>.required_movement_angle`**
- Type: `unknown`
- TypeDefaultdouble0.5DescriptionMinimum amount a robot must rotate to be progressing to goal (rad).

**`<nav2_controllerplugin>.movement_time_allowance`**
- Type: `unknown`
- TypeDefaultdouble10.0DescriptionMaximum amount of time a robot has to move the minimum radius or the mnimum angle (s).

**`Description`**
- Type: `unknown`
- Minimum amount a robot must move to be progressing to goal (m).

**`Description`**
- Type: `unknown`
- Minimum amount a robot must rotate to be progressing to goal (rad).

**`Description`**
- Type: `unknown`
- Maximum amount of time a robot has to move the minimum radius or the mnimum angle (s).


---

##### PositionGoalChecker

*Source: [https://docs.nav2.org/configuration/packages/nav2_controller-plugins/position_goal_checker.html](https://docs.nav2.org/configuration/packages/nav2_controller-plugins/position_goal_checker.html)*

###### PositionGoalChecker

Checks whether the robot has reached the goal pose.

###### Parameters

`<nav2_controller plugin>`: nav2\_controller plugin name defined in the **goal\_checker\_plugin\_id** parameter in [Controller Server](../configuring-controller-server.html#configuring-controller-server).

`<nav2_controller plugin>`.xy\_goal\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
> Description
> :   Tolerance to meet goal completion criteria (m).
```

`<nav2_controller plugin>`.path\_length\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
> Description
> :   Tolerance to meet goal completion criteria (m).
```

`<nav2_controller plugin>`.stateful
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
> Description
> :   Whether to check for XY position tolerance after rotating to goal orientation in case of minor localization changes.
```

#### Parameters

**`<nav2_controllerplugin>.xy_goal_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionTolerance to meet goal completion criteria (m).

**`<nav2_controllerplugin>.path_length_tolerance`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionTolerance to meet goal completion criteria (m).

**`<nav2_controllerplugin>.stateful`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to check for XY position tolerance after rotating to goal orientation in case of minor localization changes.

**`Description`**
- Type: `unknown`
- Tolerance to meet goal completion criteria (m).

**`Description`**
- Type: `unknown`
- Tolerance to meet goal completion criteria (m).

**`Description`**
- Type: `unknown`
- Whether to check for XY position tolerance after rotating to goal orientation in case of minor localization changes.


---

##### SimpleGoalChecker

*Source: [https://docs.nav2.org/configuration/packages/nav2_controller-plugins/simple_goal_checker.html](https://docs.nav2.org/configuration/packages/nav2_controller-plugins/simple_goal_checker.html)*

###### SimpleGoalChecker

Checks whether the robot has reached the goal pose.

###### Parameters

`<nav2_controller plugin>`: nav2\_controller plugin name defined in the **goal\_checker\_plugin\_id** parameter in [Controller Server](../configuring-controller-server.html#configuring-controller-server).

`<nav2_controller plugin>`.xy\_goal\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
> Description
> :   Tolerance to meet goal completion criteria (m).
```

`<nav2_controller plugin>`.yaw\_goal\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
> Description
> :   Tolerance to meet goal completion criteria (rad).
```

`<nav2_controller plugin>`.path\_length\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
> Description
> :   Tolerance to meet goal completion criteria (m).
```

`<nav2_controller plugin>`.stateful
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
> Description
> :   Whether to check for XY position tolerance after rotating to goal orientation in case of minor localization changes.
```

`<nav2_controller plugin>`.symmetric\_yaw\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
> Description
> :   Enable symmetric goal orientation acceptance. When enabled, the robot accepts the goal as reached when oriented at either the goal orientation or the goal orientation + 180°. This is useful for symmetric robots (e.g., differential drives with sensors on both ends) that can navigate equally well in forward and backward directions and does not care which direction it ends in (i.e. controller algorithm decides). See [Tuning Guide](../../../tuning/index.html#tuning) for detailed information.
```

#### Parameters

**`<nav2_controllerplugin>.xy_goal_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionTolerance to meet goal completion criteria (m).

**`<nav2_controllerplugin>.yaw_goal_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionTolerance to meet goal completion criteria (rad).

**`<nav2_controllerplugin>.path_length_tolerance`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionTolerance to meet goal completion criteria (m).

**`<nav2_controllerplugin>.stateful`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to check for XY position tolerance after rotating to goal orientation in case of minor localization changes.

**`<nav2_controllerplugin>.symmetric_yaw_tolerance`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionEnable symmetric goal orientation acceptance. When enabled, the robot accepts the goal as reached when oriented at either the goal orientation or the goal orientation + 180°. This is useful for symmetric robots (e.g., differential drives with sensors on both ends) that can navigate equally well in forward and backward directions and does not care which direction it ends in (i.e. controller algorithm decides). SeeTuning Guidefor detailed information.

**`Description`**
- Type: `unknown`
- Tolerance to meet goal completion criteria (m).

**`Description`**
- Type: `unknown`
- Tolerance to meet goal completion criteria (rad).

**`Description`**
- Type: `unknown`
- Tolerance to meet goal completion criteria (m).

**`Description`**
- Type: `unknown`
- Whether to check for XY position tolerance after rotating to goal orientation in case of minor localization changes.

**`Description`**
- Type: `unknown`
- Enable symmetric goal orientation acceptance. When enabled, the robot accepts the goal as reached when oriented at either the goal orientation or the goal orientation + 180°. This is useful for symmetric robots (e.g., differential drives with sensors on both ends) that can navigate equally well in forward and backward directions and does not care which direction it ends in (i.e. controller algorithm decides). SeeTuning Guidefor detailed information.


---

##### SimpleProgressChecker

*Source: [https://docs.nav2.org/configuration/packages/nav2_controller-plugins/simple_progress_checker.html](https://docs.nav2.org/configuration/packages/nav2_controller-plugins/simple_progress_checker.html)*

###### SimpleProgressChecker

Checks whether the robot has made positional progress.

###### Parameters

`<nav2_controller plugin>`: nav2\_controller plugin name defined in the **progress\_checker\_plugin\_id** parameter in [Controller Server](../configuring-controller-server.html#configuring-controller-server).

`<nav2_controller plugin>`.required\_movement\_radius
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description
:   Minimum amount a robot must move to be progressing to goal (m).
```

`<nav2_controller plugin>`.movement\_time\_allowance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10.0 |
```

```
Description
:   Maximum amount of time a robot has to move the minimum radius (s).
```

#### Parameters

**`<nav2_controllerplugin>.required_movement_radius`**
- Type: `unknown`
- TypeDefaultdouble0.5DescriptionMinimum amount a robot must move to be progressing to goal (m).

**`<nav2_controllerplugin>.movement_time_allowance`**
- Type: `unknown`
- TypeDefaultdouble10.0DescriptionMaximum amount of time a robot has to move the minimum radius (s).

**`Description`**
- Type: `unknown`
- Minimum amount a robot must move to be progressing to goal (m).

**`Description`**
- Type: `unknown`
- Maximum amount of time a robot has to move the minimum radius (s).


---

##### StoppedGoalChecker

*Source: [https://docs.nav2.org/configuration/packages/nav2_controller-plugins/stopped_goal_checker.html](https://docs.nav2.org/configuration/packages/nav2_controller-plugins/stopped_goal_checker.html)*

###### StoppedGoalChecker

Checks whether the robot has reached the goal pose and come to a stop.

###### Parameters

`<nav2_controller plugin>`: nav2\_controller plugin name defined in the **goal\_checker\_plugin\_id** parameter in [Controller Server](../configuring-controller-server.html#configuring-controller-server).

`<nav2_controller plugin>`.trans\_stopped\_velocity
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
> Description
> :   Velocity below is considered to be stopped at tolerance met (m/s).
```

`<nav2_controller plugin>`.rot\_stopped\_velocity
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
> Description
> :   Velocity below is considered to be stopped at tolerance met (rad/s).
```

`<nav2_controller plugin>`.xy\_goal\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
> Description
> :   Tolerance to meet goal completion criteria (m).
```

`<nav2_controller plugin>`.yaw\_goal\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
> Description
> :   Tolerance to meet goal completion criteria (rad).
```

`<nav2_controller plugin>`.path\_length\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
> Description
> :   Tolerance to meet goal completion criteria (m).
```

`<nav2_controller plugin>`.stateful
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
> Description
> :   Whether to check for XY position tolerance after rotating to goal orientation in case of minor localization changes.
```

`<nav2_controller plugin>`.symmetric\_yaw\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
> Description
> :   Enable symmetric goal orientation acceptance. When enabled, the robot accepts the goal as reached when oriented at either the goal orientation or the goal orientation + 180°. This is useful for symmetric robots (e.g., differential drives with sensors on both ends) that can navigate equally well in forward and backward directions and does not care which direction it ends in (i.e. controller algorithm decides). See [Tuning Guide](../../../tuning/index.html#tuning) for detailed information.
```

#### Parameters

**`<nav2_controllerplugin>.trans_stopped_velocity`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionVelocity below is considered to be stopped at tolerance met (m/s).

**`<nav2_controllerplugin>.rot_stopped_velocity`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionVelocity below is considered to be stopped at tolerance met (rad/s).

**`<nav2_controllerplugin>.xy_goal_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionTolerance to meet goal completion criteria (m).

**`<nav2_controllerplugin>.yaw_goal_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionTolerance to meet goal completion criteria (rad).

**`<nav2_controllerplugin>.path_length_tolerance`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionTolerance to meet goal completion criteria (m).

**`<nav2_controllerplugin>.stateful`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to check for XY position tolerance after rotating to goal orientation in case of minor localization changes.

**`<nav2_controllerplugin>.symmetric_yaw_tolerance`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionEnable symmetric goal orientation acceptance. When enabled, the robot accepts the goal as reached when oriented at either the goal orientation or the goal orientation + 180°. This is useful for symmetric robots (e.g., differential drives with sensors on both ends) that can navigate equally well in forward and backward directions and does not care which direction it ends in (i.e. controller algorithm decides). SeeTuning Guidefor detailed information.

**`Description`**
- Type: `unknown`
- Velocity below is considered to be stopped at tolerance met (m/s).

**`Description`**
- Type: `unknown`
- Velocity below is considered to be stopped at tolerance met (rad/s).

**`Description`**
- Type: `unknown`
- Tolerance to meet goal completion criteria (m).

**`Description`**
- Type: `unknown`
- Tolerance to meet goal completion criteria (rad).

**`Description`**
- Type: `unknown`
- Tolerance to meet goal completion criteria (m).

**`Description`**
- Type: `unknown`
- Whether to check for XY position tolerance after rotating to goal orientation in case of minor localization changes.

**`Description`**
- Type: `unknown`
- Enable symmetric goal orientation acceptance. When enabled, the robot accepts the goal as reached when oriented at either the goal orientation or the goal orientation + 180°. This is useful for symmetric robots (e.g., differential drives with sensors on both ends) that can navigate equally well in forward and backward directions and does not care which direction it ends in (i.e. controller algorithm decides). SeeTuning Guidefor detailed information.


---

#### Nav2 Waypoint Follower Plugins

##### InputAtWaypoint

*Source: [https://docs.nav2.org/configuration/packages/nav2_waypoint_follower-plugins/input_at_waypoint.html](https://docs.nav2.org/configuration/packages/nav2_waypoint_follower-plugins/input_at_waypoint.html)*

###### InputAtWaypoint

Lets robot to wait for external input, with timeout, at a waypoint.

###### Parameters

`<nav2_waypoint_follower plugin>`: nav2\_waypoint\_follower plugin name defined in the **waypoint\_task\_executor\_plugin\_id** parameter in [Waypoint Follower](../configuring-waypoint-follower.html#configuring-waypoint-follower).

`<nav2_waypoint_follower plugin>`.enabled
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether waypoint\_task\_executor plugin is enabled.
```

`<nav2_waypoint_follower plugin>`.timeout
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10.0 |
```

```
Description
:   Amount of time in seconds to wait for user input before moving on to the next waypoint.
```

`<nav2_waypoint_follower plugin>`.input\_topic
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “input\_at\_waypoint/input” |
```

```
Description
:   Topic input is published to to indicate to move to the next waypoint, in std\_msgs/Empty.
```

allow\_parameter\_qos\_overrides
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to allow QoS profiles to be overwritten with parameterized values.
```

#### Parameters

**`<nav2_waypoint_followerplugin>.enabled`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether waypoint_task_executor plugin is enabled.

**`<nav2_waypoint_followerplugin>.timeout`**
- Type: `unknown`
- TypeDefaultdouble10.0DescriptionAmount of time in seconds to wait for user input before moving on to the next waypoint.

**`<nav2_waypoint_followerplugin>.input_topic`**
- Type: `unknown`
- TypeDefaultstring“input_at_waypoint/input”DescriptionTopic input is published to to indicate to move to the next waypoint, instd_msgs/Empty.

**`allow_parameter_qos_overrides`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to allow QoS profiles to be overwritten with parameterized values.

**`Description`**
- Type: `unknown`
- Whether waypoint_task_executor plugin is enabled.

**`Description`**
- Type: `unknown`
- Amount of time in seconds to wait for user input before moving on to the next waypoint.

**`Description`**
- Type: `unknown`
- Topic input is published to to indicate to move to the next waypoint, instd_msgs/Empty.

**`Description`**
- Type: `unknown`
- Whether to allow QoS profiles to be overwritten with parameterized values.


---

##### PhotoAtWaypoint

*Source: [https://docs.nav2.org/configuration/packages/nav2_waypoint_follower-plugins/photo_at_waypoint.html](https://docs.nav2.org/configuration/packages/nav2_waypoint_follower-plugins/photo_at_waypoint.html)*

###### PhotoAtWaypoint

Run-time plugin that takes photos at waypoint arrivals when using waypoint follower node. Saves the taken photos to specified directory. The name for taken photos are determined by
the waypoint index and timestamp(seconds). For instance `/home/atas/0_1602582820.png` is an sample taken image, where `0_1602582820` is the file name determined by waypoint
index and time stamp. The leading digit in file name implies the waypoint index and the rest of digits at righthand side implies the time stamp when the photo was taken.

###### Parameters

`<nav2_waypoint_follower plugin>`: nav2\_waypoint\_follower plugin name defined in the **waypoint\_task\_executor\_plugin\_id** parameter in [Waypoint Follower](../configuring-waypoint-follower.html#configuring-waypoint-follower).

`<nav2_waypoint_follower plugin>`.enabled
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether waypoint\_task\_executor plugin is enabled.
```

`<nav2_waypoint_follower plugin>`.camera\_image\_topic\_name
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “/camera/color/image\_raw” |
```

```
Description
:   Camera image topic name to subscribe
```

`<nav2_waypoint_follower plugin>`.save\_images\_dir
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “/tmp/waypoint\_images” |
```

```
Description
:   Path to directory to save taken photos at waypoint arrivals.
```

`<nav2_waypoint_follower plugin>`.image\_format
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “png” |
```

```
Description
:   Desired image format.
```

allow\_parameter\_qos\_overrides
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to allow QoS profiles to be overwritten with parameterized values.
```

#### Parameters

**`<nav2_waypoint_followerplugin>.enabled`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether waypoint_task_executor plugin is enabled.

**`<nav2_waypoint_followerplugin>.camera_image_topic_name`**
- Type: `unknown`
- TypeDefaultstring“/camera/color/image_raw”DescriptionCamera image topic name to subscribe

**`<nav2_waypoint_followerplugin>.save_images_dir`**
- Type: `unknown`
- TypeDefaultstring“/tmp/waypoint_images”DescriptionPath to directory to save taken photos at waypoint arrivals.

**`<nav2_waypoint_followerplugin>.image_format`**
- Type: `unknown`
- TypeDefaultstring“png”DescriptionDesired image format.

**`allow_parameter_qos_overrides`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to allow QoS profiles to be overwritten with parameterized values.

**`Description`**
- Type: `unknown`
- Whether waypoint_task_executor plugin is enabled.

**`Description`**
- Type: `unknown`
- Camera image topic name to subscribe

**`Description`**
- Type: `unknown`
- Path to directory to save taken photos at waypoint arrivals.

**`Description`**
- Type: `unknown`
- Desired image format.

**`Description`**
- Type: `unknown`
- Whether to allow QoS profiles to be overwritten with parameterized values.


---

##### WaitAtWaypoint

*Source: [https://docs.nav2.org/configuration/packages/nav2_waypoint_follower-plugins/wait_at_waypoint.html](https://docs.nav2.org/configuration/packages/nav2_waypoint_follower-plugins/wait_at_waypoint.html)*

###### WaitAtWaypoint

Lets robot to pause for a specified amount of time after reaching each waypoints.

###### Parameters

`<nav2_waypoint_follower plugin>`: nav2\_waypoint\_follower plugin name defined in the **waypoint\_task\_executor\_plugin\_id** parameter in [Waypoint Follower](../configuring-waypoint-follower.html#configuring-waypoint-follower).

`<nav2_waypoint_follower plugin>`.enabled
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether waypoint\_task\_executor plugin is enabled.
```

`<nav2_waypoint_follower plugin>`.waypoint\_pause\_duration
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 0 |
```

```
Description
:   Amount of time in milliseconds, for robot to sleep/wait after each waypoint is reached. If zero, robot will directly continue to next waypoint.
```

#### Parameters

**`<nav2_waypoint_followerplugin>.enabled`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether waypoint_task_executor plugin is enabled.

**`<nav2_waypoint_followerplugin>.waypoint_pause_duration`**
- Type: `unknown`
- TypeDefaultint0DescriptionAmount of time in milliseconds, for robot to sleep/wait after each waypoint is reached. If zero, robot will directly continue to next waypoint.

**`Description`**
- Type: `unknown`
- Whether waypoint_task_executor plugin is enabled.

**`Description`**
- Type: `unknown`
- Amount of time in milliseconds, for robot to sleep/wait after each waypoint is reached. If zero, robot will directly continue to next waypoint.


---

#### Smac

##### Smac 2D Planner

*Source: [https://docs.nav2.org/configuration/packages/smac/configuring-smac-2d.html](https://docs.nav2.org/configuration/packages/smac/configuring-smac-2d.html)*

###### Smac 2D Planner

[![Paths generated by the Smac 2D-A*](../../../_images/2d_test.png)](../../../_images/2d_test.png)

This planner implements a cost-aware holonomic A\* algorithm within the Smac Planner framework sharing the same code and behaviors as the Hybrid-A\* and State Lattice planners.

`<name>` is the corresponding planner plugin ID selected for this type.

###### Parameters

`<name>`.tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.125 |
```

```
Description
:   Tolerance in meters between requested goal pose and end of path.
```

`<name>`.downsample\_costmap
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description
:   Whether to downsample costmap to another resolution for search.
```

`<name>`.downsampling\_factor
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1 |
```

```
Description
:   Multiplier factor to downsample costmap by (e.g. if 5cm costmap at 2 `downsample_factor`, 10cm output).
```

`<name>`.allow\_unknown
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description
:   Whether to allow traversing/search in unknown space.
```

`<name>`.max\_iterations
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1000000 |
```

```
Description
:   Maximum number of search iterations before failing to limit compute time, disabled by -1.
```

`<name>`.max\_on\_approach\_iterations
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1000 |
```

```
Description
:   Maximum number of iterations after the search is within `tolerance` before returning approximate path with best heuristic if exact path is not found.
```

`<name>`.terminal\_checking\_interval
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 5000 |
```

```
Description
:   Number of iterations between checking if the goal has been cancelled or planner timed out
```

`<name>`.max\_planning\_time
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description
:   Maximum planning time in seconds.
```

`<name>`.cost\_travel\_multiplier
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description
:   Cost multiplier to apply to search to steer away from high cost areas. Larger values will place in the center of aisles more exactly (if non-FREE cost potential field exists) but take slightly longer to compute. To optimize for speed, a value of 1.0 is reasonable. A reasonable tradeoff value is 2.0. A value of 0.0 effective disables steering away from obstacles and acts like a naive binary search A\*.
```

`<name>`.use\_final\_approach\_orientation
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   If true, the last pose of the path generated by the planner will have its orientation set to the approach orientation, i.e. the orientation of the vector connecting the last two points of the path
```

`<name>`.smoother.max\_iterations
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1000 |
```

```
Description
:   The maximum number of iterations the smoother has to smooth the path, to bound potential computation.
```

`<name>`.smoother.w\_smooth
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.3 |
```

```
Description
:   Weight for smoother to apply to smooth out the data points
```

`<name>`.smoother.w\_data
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.2 |
```

```
Description
:   Weight for smoother to apply to retain original data information
```

`<name>`.smoother.tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1e-10 |
```

```
Description
:   Parameter tolerance change amount to terminate smoothing session
```

`<name>`.smoother.do\_refinement
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Performs extra refinement smoothing runs. Essentially, this recursively calls the smoother using the output from the last smoothing cycle to further smooth the path for macro-trends.
```

`<name>`.smoother.refinement\_num
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 2 |
```

```
Description
:   Number of times to recursively attempt to smooth, must be `>= 1`.
```

allow\_parameter\_qos\_overrides
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to allow QoS profiles to be overwritten with parameterized values.
```

###### Example

```
planner_server:
  ros__parameters:
    planner_plugins: ["GridBased"]

    GridBased:
      plugin: "nav2_smac_planner::SmacPlanner2D" # In Iron and older versions, "/" was used instead of "::"
      tolerance: 0.125                      # tolerance for planning if unable to reach exact pose, in meters
      downsample_costmap: false             # whether or not to downsample the map
      downsampling_factor: 1                # multiplier for the resolution of the costmap layer (e.g. 2 on a 5cm costmap would be 10cm)
      allow_unknown: true                   # allow traveling in unknown space
      max_iterations: 1000000               # maximum total iterations to search for before failing (in case unreachable), set to -1 to disable
      max_on_approach_iterations: 1000      # maximum number of iterations to attempt to reach goal once in tolerance
      max_planning_time: 2.0                # max time in s for planner to plan, smooth
      cost_travel_multiplier: 2.0           # Cost multiplier to apply to search to steer away from high cost areas. Larger values will place in the center of aisles more exactly (if non-`FREE` cost potential field exists) but take slightly longer to compute. To optimize for speed, a value of 1.0 is reasonable. A reasonable tradeoff value is 2.0. A value of 0.0 effective disables steering away from obstacles and acts like a naive binary search A*.
      use_final_approach_orientation: false # Whether to set the final path pose at the goal's orientation to the requested orientation (false) or in line with the approach angle so the robot doesn't rotate to heading (true)
      smoother:
        max_iterations: 1000
        w_smooth: 0.3
        w_data: 0.2
        tolerance: 1.0e-10
```

#### Parameters

**`<name>.tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.125DescriptionTolerance in meters between requested goal pose and end of path.

**`<name>.downsample_costmap`**
- Type: `unknown`
- TypeDefaultboolFalseDescriptionWhether to downsample costmap to another resolution for search.

**`<name>.downsampling_factor`**
- Type: `unknown`
- TypeDefaultint1DescriptionMultiplier factor to downsample costmap by (e.g. if 5cm costmap at 2downsample_factor, 10cm output).

**`<name>.allow_unknown`**
- Type: `unknown`
- TypeDefaultboolTrueDescriptionWhether to allow traversing/search in unknown space.

**`<name>.max_iterations`**
- Type: `unknown`
- TypeDefaultint1000000DescriptionMaximum number of search iterations before failing to limit compute time, disabled by -1.

**`<name>.max_on_approach_iterations`**
- Type: `unknown`
- TypeDefaultint1000DescriptionMaximum number of iterations after the search is withintolerancebefore returning approximate path with best heuristic if exact path is not found.

**`<name>.terminal_checking_interval`**
- Type: `unknown`
- TypeDefaultint5000DescriptionNumber of iterations between checking if the goal has been cancelled or planner timed out

**`<name>.max_planning_time`**
- Type: `unknown`
- TypeDefaultdouble2.0DescriptionMaximum planning time in seconds.

**`<name>.cost_travel_multiplier`**
- Type: `unknown`
- TypeDefaultdouble2.0DescriptionCost multiplier to apply to search to steer away from high cost areas. Larger values will place in the center of aisles more exactly (if non-FREEcost potential field exists) but take slightly longer to compute. To optimize for speed, a value of 1.0 is reasonable. A reasonable tradeoff value is 2.0. A value of 0.0 effective disables steering away from obstacles and acts like a naive binary search A*.

**`<name>.use_final_approach_orientation`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionIf true, the last pose of the path generated by the planner will have its orientation set to the approach orientation, i.e. the orientation of the vector connecting the last two points of the path

**`<name>.smoother.max_iterations`**
- Type: `unknown`
- TypeDefaultint1000DescriptionThe maximum number of iterations the smoother has to smooth the path, to bound potential computation.

**`<name>.smoother.w_smooth`**
- Type: `unknown`
- TypeDefaultdouble0.3DescriptionWeight for smoother to apply to smooth out the data points

**`<name>.smoother.w_data`**
- Type: `unknown`
- TypeDefaultdouble0.2DescriptionWeight for smoother to apply to retain original data information

**`<name>.smoother.tolerance`**
- Type: `unknown`
- TypeDefaultdouble1e-10DescriptionParameter tolerance change amount to terminate smoothing session

**`<name>.smoother.do_refinement`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionPerforms extra refinement smoothing runs. Essentially, this recursively calls the smoother using the output from the last smoothing cycle to further smooth the path for macro-trends.

**`<name>.smoother.refinement_num`**
- Type: `unknown`
- TypeDefaultint2DescriptionNumber of times to recursively attempt to smooth, must be>=1.

**`allow_parameter_qos_overrides`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to allow QoS profiles to be overwritten with parameterized values.

**`Description`**
- Type: `unknown`
- Tolerance in meters between requested goal pose and end of path.

**`Description`**
- Type: `unknown`
- Whether to downsample costmap to another resolution for search.

**`Description`**
- Type: `unknown`
- Multiplier factor to downsample costmap by (e.g. if 5cm costmap at 2downsample_factor, 10cm output).

**`Description`**
- Type: `unknown`
- Whether to allow traversing/search in unknown space.

**`Description`**
- Type: `unknown`
- Maximum number of search iterations before failing to limit compute time, disabled by -1.

**`Description`**
- Type: `unknown`
- Maximum number of iterations after the search is withintolerancebefore returning approximate path with best heuristic if exact path is not found.

**`Description`**
- Type: `unknown`
- Number of iterations between checking if the goal has been cancelled or planner timed out

**`Description`**
- Type: `unknown`
- Maximum planning time in seconds.

**`Description`**
- Type: `unknown`
- Cost multiplier to apply to search to steer away from high cost areas. Larger values will place in the center of aisles more exactly (if non-FREEcost potential field exists) but take slightly longer to compute. To optimize for speed, a value of 1.0 is reasonable. A reasonable tradeoff value is 2.0. A value of 0.0 effective disables steering away from obstacles and acts like a naive binary search A*.

**`Description`**
- Type: `unknown`
- If true, the last pose of the path generated by the planner will have its orientation set to the approach orientation, i.e. the orientation of the vector connecting the last two points of the path

**`Description`**
- Type: `unknown`
- The maximum number of iterations the smoother has to smooth the path, to bound potential computation.

**`Description`**
- Type: `unknown`
- Weight for smoother to apply to smooth out the data points

**`Description`**
- Type: `unknown`
- Weight for smoother to apply to retain original data information

**`Description`**
- Type: `unknown`
- Parameter tolerance change amount to terminate smoothing session

**`Description`**
- Type: `unknown`
- Performs extra refinement smoothing runs. Essentially, this recursively calls the smoother using the output from the last smoothing cycle to further smooth the path for macro-trends.

**`Description`**
- Type: `unknown`
- Number of times to recursively attempt to smooth, must be>=1.

**`Description`**
- Type: `unknown`
- Whether to allow QoS profiles to be overwritten with parameterized values.


---

##### Smac Hybrid-A* Planner

*Source: [https://docs.nav2.org/configuration/packages/smac/configuring-smac-hybrid.html](https://docs.nav2.org/configuration/packages/smac/configuring-smac-hybrid.html)*

###### Smac Hybrid-A\* Planner

[![Paths generated by the Smac Hybrid-A*](../../../_images/hybrid_144.png)](../../../_images/hybrid_144.png)

This plugin implements a cost-aware Hybrid-A\* global path planner with motion primitives proportionally sized to the minimum required to leave a user’s costmap cell allowing for finite moves.

`<name>` is the corresponding planner plugin ID selected for this type.

###### Parameters

`<name>`.downsample\_costmap
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | False |
```

```
Description
:   Whether to downsample costmap to another resolution for search.
```

`<name>`.downsampling\_factor
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1 |
```

```
Description
:   Multiplier factor to downsample costmap by (e.g. if 5cm costmap at 2 `downsample_factor`, 10cm output).
```

`<name>`.allow\_unknown
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description
:   Whether to allow traversing/search in unknown space.
```

`<name>`.tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
Description
:   If an exact path cannot be found, the tolerance (as measured by the heuristic cost-to-goal) that would be acceptable to diverge from the requested pose.
```

`<name>`.max\_iterations
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1000000 |
```

```
Description
:   Maximum number of search iterations before failing to limit compute time, disabled by -1.
```

`<name>`.max\_on\_approach\_iterations
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1000 |
```

```
Description
:   Maximum number of iterations once a visited node is within the goal tolerances to continue to try to find an exact match before returning the best path solution within tolerances. Negative values convert to infinite.
```

`<name>`.terminal\_checking\_interval
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 5000 |
```

```
Description
:   Number of iterations between checking if the goal has been cancelled or planner timed out
```

`<name>`.max\_planning\_time
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 5.0 |
```

```
Description
:   Maximum planning time in seconds.
```

`<name>`.analytic\_expansion\_ratio
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 3.5 |
```

```
Description
:   Planner will attempt to complete an analytic expansions in a frequency proportional to this value and the minimum heuristic.
```

`<name>`.analytic\_expansion\_max\_length
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 3.0 |
```

```
Description
:   If the length is too far, reject this expansion. This prevents shortcutting of search with its penalty functions far out from the goal itself (e.g. so we don’t reverse half-way across open maps or cut through high cost zones). This should never be smaller than 4-5x the minimum turning radius being used, or planning times will begin to spike.
```

`<name>`.analytic\_expansion\_max\_cost
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 200.0 |
```

```
Description
:   For Hybrid/Lattice nodes: The maximum single cost for any part of an analytic expansion to contain and be considered valid (except when necessary on approach to goal). This allows for removing of potential shortcutting into higher cost spaces than you might otherwise desire
```

`<name>`.analytic\_expansion\_max\_cost\_override
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   For Hybrid/Lattice nodes: Whether or not to override the maximum cost setting if within critical distance to goal (ie probably required). If expansion is within 2\*pi\*min\_r of the goal, then it will override the max cost if `false`.
```

`<name>`.motion\_model\_for\_search
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “DUBIN” |
```

```
Description
:   Motion model enum string to search with. For Hybrid-A\* node, default is “DUBIN”. Options for SE2 are DUBIN or REEDS\_SHEPP.
```

`<name>`.angle\_quantization\_bins
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 72 |
```

```
Description
:   Number of angular bins to use for SE2 search. This can be any even number, but a good baseline is 64 or 72 (for 5 degree increments).
```

`<name>`.minimum\_turning\_radius
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.4 |
```

```
Description
:   Minimum turning radius in meters of vehicle. Also used in the smoother to compute maximum curvature. Must be greater than 0.
```

`<name>`.reverse\_penalty
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description
:   Heuristic penalty to apply to SE2 node if searching in reverse direction. Only used in `REEDS_SHEPP` motion model.
```

`<name>`.change\_penalty
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.0 |
```

```
Description
:   Heuristic penalty to apply to SE2 node if changing direction (e.g. left to right) in search. Disabled by default after change to guarantee admissibility of the Hybrid-A\* planner.
```

`<name>`.non\_straight\_penalty
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.20 |
```

```
Description
:   Heuristic penalty to apply to SE2 node if searching in non-straight direction.
```

`<name>`.cost\_penalty
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description
:   Heuristic penalty to apply to SE2 node for cost at pose. Allows Hybrid-A\* to be cost aware.
```

`<name>`.retrospective\_penalty
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.015 |
```

```
Description
:   Heuristic penalty to apply to SE2 node penalty. Causes Hybrid-A\* to prefer later maneuvers before earlier ones along the path. Saves search time since earlier (shorter) branches are not expanded until it is necessary. Must be >= 0.0 and <= 1.0. Must be 0.0 to be fully admissible.
```

`<name>`.lookup\_table\_size
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 20.0 |
```

```
Description
:   Size of the dubin/reeds-sheep distance window to cache, in meters.
```

`<name>`.debug\_visualizations
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to publish expansions on the `/expansions` topic as an array of poses and the path’s footprints on the `/planned_footprints` topic. WARNING: heavy to compute and to display, for debug only as it degrades the performance.
```

`<name>`.cache\_obstacle\_heuristic
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Advanced feature: Cache the obstacle map dynamic programming distance expansion heuristic between subsequent replannings of the same goal location. Dramatically speeds up replanning performance (40x) if costmap is largely static.
```

`<name>`.allow\_primitive\_interpolation
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Advanced feature: Allows a user to add additional primitives to the exploration set to interpolate between the angular quantization jumps between the normal primitive set (e.g. left, right, straight). This generates additional primitives such that every angular bin between the furthest-left and furthest-right are represented in the primitive set for exploration. That way, if the settings (e.x. 0.4 turning rad, 5cm costmap, 72 bins) jump by 3 quantizations, you can explore not simply 0,3,6,9,… but the full 1,2,3,4,5,6,7,8,9,… set. This typically comes at an increased computation time, but can remove “zig-zag”-like behavior when your base primitive set is significantly not representative. It may come at less compute times when used in more confined settings like hallways whereas it can follow a narrow heuristic channel better. When this is enabled, users should take care to re-tune `angle_quantization_bins`, since such a large number is not required. To continue with the previous example, when enabled, it is the same as `angle_quantization_bins` set to 24 (e.g. `24 * 3 = 72`), so 32 might be a good selection to start with to get higher quality without substantial changes in compute time.
```

`<name>`.downsample\_obstacle\_heuristic
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Advanced feature: This allows a user to disable downsampling of the obstacle heuristic’s costmap representation to search at the costmap’s full-resolution. This will come at increased up-front costs while searching for the 2D approximate route to the goal in exchange for less search iterations and a slightly more smooth path. With `smooth_path` on, this increased smoothness is noticeable but not massively different. When combined with all of the advanced features however, it can contribute to a better overall plan in exchange for some compute time. This scales with map size and complexity of the path plan requested. For simpler maps / paths, this may actually improve performance due to low up-front search times and lower iterations.
```

`<name>`.use\_quadratic\_cost\_penalty
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Advanced feature: This allows a user to specify a quadratic traversal and heuristic cost computation (e.g. `cost * cost`) rather than linear. This will speed up the planner since the optimal channel for feasible search is deeper and prunes search branches more aggressively. This will also create overall much smoother paths since search will not attempt to refine itself to stay in the center of wide aisleways or open spaces to reduce low finite costs. However, the smoothness and less sensitivity to cost also makes it come somewhat closer to obstacles. Broadly speaking the change and non-straight penalties can be disabled when this feature is in use. The cost penalty and inflation layer parameters may need to be adjusted when enabling this parameter to create optimal performance.
```

`<name>`.smooth\_path
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   If true, does simple and fast smoothing post-processing to the path from search
```

`<name>`.smoother.max\_iterations
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1000 |
```

```
Description
:   The maximum number of iterations the smoother has to smooth the path, to bound potential computation.
```

`<name>`.smoother.w\_smooth
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.3 |
```

```
Description
:   Weight for smoother to apply to smooth out the data points
```

`<name>`.smoother.w\_data
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.2 |
```

```
Description
:   Weight for smoother to apply to retain original data information
```

`<name>`.smoother.tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1e-10 |
```

```
Description
:   Parameter tolerance change amount to terminate smoothing session
```

`<name>`.smoother.do\_refinement
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Performs extra refinement smoothing runs. Essentially, this recursively calls the smoother using the output from the last smoothing cycle to further smooth the path for macro-trends. This typically improves quality especially in the Hybrid-A\* planner due to the extra “wobbling” it can have due to the very small primitive lengths but may cause the path to get slightly closer to some obstacles.
```

`<name>`.smoother.refinement\_num
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 2 |
```

```
Description
:   Number of times to recursively attempt to smooth, must be `>= 1`.
```

`<name>`.goal\_heading\_mode
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “DEFAULT” |
```

```
Description
:   Goal heading mode enum string to plan goal with multiple orientation. Options are “DEFAULT”, “BIDIRECTIONAL” and “ALL\_DIRECTION”. With default mode, the planner will plan the goal with the orientation of the goal pose as was sent by the user. With the “BIDIRECTIONAL” mode, the planner will plan the goal with the orientation of the goal pose and with orientation 180 degree offset from the goal pose orientation. For “ALL\_DIRECTION” mode, the planner will plan the goal with the orientation of the goal pose and all the possible orientation based on the angle quantization bins. For both the “BIDIRECTIONAL” and “ALL\_DIRECTION” mode, the planner returns the path with the minimum cost.
```

`<name>`.coarse\_search\_resolution
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 4 |
```

```
Description
:   Number of goal heading bins to skip during the coarse search phase of analytic expansion goal-finding. When a goal is found, a fine search is performed to determine the exact path during full-resolution. This parameter is only used when the goal heading mode is set to “ALL\_DIRECTION” and It helps to reduce search time of analytic expansions.
```

allow\_parameter\_qos\_overrides
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to allow QoS profiles to be overwritten with parameterized values.
```

###### Example

```
planner_server:
  ros__parameters:
    planner_plugins: ["GridBased"]

    GridBased:
      plugin: "nav2_smac_planner::SmacPlannerHybrid" # In Iron and older versions, "/" was used instead of "::"
      downsample_costmap: false           # whether or not to downsample the map
      downsampling_factor: 1              # multiplier for the resolution of the costmap layer (e.g. 2 on a 5cm costmap would be 10cm)
      tolerance: 0.25                     # dist-to-goal heuristic cost (distance) for valid tolerance endpoints if exact goal cannot be found.
      allow_unknown: true                 # allow traveling in unknown space
      max_iterations: 1000000             # maximum total iterations to search for before failing (in case unreachable), set to -1 to disable
      max_on_approach_iterations: 1000    # Maximum number of iterations after within tolerances to continue to try to find exact solution
      max_planning_time: 5.0              # max time in s for planner to plan, smooth
      motion_model_for_search: "DUBIN"    # Hybrid-A* Dubin, Redds-Shepp
      angle_quantization_bins: 72         # Number of angle bins for search
      analytic_expansion_ratio: 3.5       # The ratio to attempt analytic expansions during search for final approach.
      analytic_expansion_max_length: 3.0  # For Hybrid/Lattice nodes: The maximum length of the analytic expansion to be considered valid to prevent unsafe shortcutting
      analytic_expansion_max_cost: 200.0  # The maximum single cost for any part of an analytic expansion to contain and be valid, except when necessary on approach to goal
      analytic_expansion_max_cost_override: false  #  Whether or not to override the maximum cost setting if within critical distance to goal (ie probably required)
      minimum_turning_radius: 0.40        # minimum turning radius in m of path / vehicle
      reverse_penalty: 2.0                # Penalty to apply if motion is reversing, must be => 1
      change_penalty: 0.0                 # Penalty to apply if motion is changing directions (L to R), must be >= 0
      non_straight_penalty: 1.2           # Penalty to apply if motion is non-straight, must be => 1
      cost_penalty: 2.0                   # Penalty to apply to higher cost areas when adding into the obstacle map dynamic programming distance expansion heuristic. This drives the robot more towards the center of passages. A value between 1.3 - 3.5 is reasonable.
      retrospective_penalty: 0.015
      lookup_table_size: 20.0             # Size of the dubin/reeds-sheep distance window to cache, in meters.
      cache_obstacle_heuristic: false     # Cache the obstacle map dynamic programming distance expansion heuristic between subsequent replannings of the same goal location. Dramatically speeds up replanning performance (40x) if costmap is largely static.
      debug_visualizations: false         # For Hybrid nodes: Whether to publish expansions on the /expansions topic as an array of poses (the orientation has no meaning) and the path's footprints on the /planned_footprints topic. WARNING: heavy to compute and to display, for debug only as it degrades the performance.
      use_quadratic_cost_penalty: False
      downsample_obstacle_heuristic: True
      allow_primitive_interpolation: False
      coarse_search_resolution: 4         # Number of bins to skip when doing a coarse search for the path. Only used for all_direction goal heading mode.
      goal_heading_mode: "DEFAULT"        # DEFAULT, BIDIRECTIONAL, ALL_DIRECTION
      smooth_path: True                   # If true, does a simple and quick smoothing post-processing to the path

      smoother:
        max_iterations: 1000
        w_smooth: 0.3
        w_data: 0.2
        tolerance: 1.0e-10
        do_refinement: true
        refinement_num: 2
```

#### Parameters

**`<name>.downsample_costmap`**
- Type: `unknown`
- TypeDefaultboolFalseDescriptionWhether to downsample costmap to another resolution for search.

**`<name>.downsampling_factor`**
- Type: `unknown`
- TypeDefaultint1DescriptionMultiplier factor to downsample costmap by (e.g. if 5cm costmap at 2downsample_factor, 10cm output).

**`<name>.allow_unknown`**
- Type: `unknown`
- TypeDefaultboolTrueDescriptionWhether to allow traversing/search in unknown space.

**`<name>.tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionIf an exact path cannot be found, the tolerance (as measured by the heuristic cost-to-goal) that would be acceptable to diverge from the requested pose.

**`<name>.max_iterations`**
- Type: `unknown`
- TypeDefaultint1000000DescriptionMaximum number of search iterations before failing to limit compute time, disabled by -1.

**`<name>.max_on_approach_iterations`**
- Type: `unknown`
- TypeDefaultint1000DescriptionMaximum number of iterations once a visited node is within the goal tolerances to continue to try to find an exact match before returning the best path solution within tolerances. Negative values convert to infinite.

**`<name>.terminal_checking_interval`**
- Type: `unknown`
- TypeDefaultint5000DescriptionNumber of iterations between checking if the goal has been cancelled or planner timed out

**`<name>.max_planning_time`**
- Type: `unknown`
- TypeDefaultdouble5.0DescriptionMaximum planning time in seconds.

**`<name>.analytic_expansion_ratio`**
- Type: `unknown`
- TypeDefaultdouble3.5DescriptionPlanner will attempt to complete an analytic expansions in a frequency proportional to this value and the minimum heuristic.

**`<name>.analytic_expansion_max_length`**
- Type: `unknown`
- TypeDefaultdouble3.0DescriptionIf the length is too far, reject this expansion. This prevents shortcutting of search with its penalty functions far out from the goal itself (e.g. so we don’t reverse half-way across open maps or cut through high cost zones). This should never be smaller than 4-5x the minimum turning radius being used, or planning times will begin to spike.

**`<name>.analytic_expansion_max_cost`**
- Type: `unknown`
- TypeDefaultdouble200.0DescriptionFor Hybrid/Lattice nodes: The maximum single cost for any part of an analytic expansion to contain and be considered valid (except when necessary on approach to goal). This allows for removing of potential shortcutting into higher cost spaces than you might otherwise desire

**`<name>.analytic_expansion_max_cost_override`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionFor Hybrid/Lattice nodes: Whether or not to override the maximum cost setting if within critical distance to goal (ie probably required). If expansion is within 2*pi*min_r of the goal, then it will override the max cost iffalse.

**`<name>.motion_model_for_search`**
- Type: `unknown`
- TypeDefaultstring“DUBIN”DescriptionMotion model enum string to search with. For Hybrid-A* node, default is “DUBIN”. Options for SE2 are DUBIN or REEDS_SHEPP.

**`<name>.angle_quantization_bins`**
- Type: `unknown`
- TypeDefaultint72DescriptionNumber of angular bins to use for SE2 search. This can be any even number, but a good baseline is 64 or 72 (for 5 degree increments).

**`<name>.minimum_turning_radius`**
- Type: `unknown`
- TypeDefaultdouble0.4DescriptionMinimum turning radius in meters of vehicle. Also used in the smoother to compute maximum curvature. Must be greater than 0.

**`<name>.reverse_penalty`**
- Type: `unknown`
- TypeDefaultdouble2.0DescriptionHeuristic penalty to apply to SE2 node if searching in reverse direction. Only used inREEDS_SHEPPmotion model.

**`<name>.change_penalty`**
- Type: `unknown`
- TypeDefaultdouble0.0DescriptionHeuristic penalty to apply to SE2 node if changing direction (e.g. left to right) in search. Disabled by default after change to guarantee admissibility of the Hybrid-A* planner.

**`<name>.non_straight_penalty`**
- Type: `unknown`
- TypeDefaultdouble1.20DescriptionHeuristic penalty to apply to SE2 node if searching in non-straight direction.

**`<name>.cost_penalty`**
- Type: `unknown`
- TypeDefaultdouble2.0DescriptionHeuristic penalty to apply to SE2 node for cost at pose. Allows Hybrid-A* to be cost aware.

**`<name>.retrospective_penalty`**
- Type: `unknown`
- TypeDefaultdouble0.015DescriptionHeuristic penalty to apply to SE2 node penalty. Causes Hybrid-A* to prefer later maneuvers before earlier ones along the path. Saves search time since earlier (shorter) branches are not expanded until it is necessary. Must be >= 0.0 and <= 1.0. Must be0.0to be fully admissible.

**`<name>.lookup_table_size`**
- Type: `unknown`
- TypeDefaultdouble20.0DescriptionSize of the dubin/reeds-sheep distance window to cache, in meters.

**`<name>.debug_visualizations`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to publish expansions on the/expansionstopic as an array of poses and the path’s footprints on the/planned_footprintstopic. WARNING: heavy to compute and to display, for debug only as it degrades the performance.

**`<name>.cache_obstacle_heuristic`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionAdvanced feature: Cache the obstacle map dynamic programming distance expansion heuristic between subsequent replannings of the same goal location. Dramatically speeds up replanning performance (40x) if costmap is largely static.

**`<name>.allow_primitive_interpolation`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionAdvanced feature: Allows a user to add additional primitives to the exploration set to interpolate between the angular quantization jumps between the normal primitive set (e.g. left, right, straight). This generates additional primitives such that every angular bin between the furthest-left and furthest-right are represented in the primitive set for exploration. That way, if the settings (e.x. 0.4 turning rad, 5cm costmap, 72 bins) jump by 3 quantizations, you can explore not simply 0,3,6,9,… but the full 1,2,3,4,5,6,7,8,9,… set. This typically comes at an increased computation time, but can remove “zig-zag”-like behavior when your base primitive set is significantly not representative. It may come at less compute times when used in more confined settings like hallways whereas it can follow a narrow heuristic channel better. When this is enabled, users should take care to re-tuneangle_quantization_bins, since such a large number is not required. To continue with the previous example, when enabled, it is the same asangle_quantization_binsset to 24 (e.g.24*3=72), so 32 might be a good selection to start with to get higher quality without substantial changes in compute time.

**`<name>.downsample_obstacle_heuristic`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionAdvanced feature: This allows a user to disable downsampling of the obstacle heuristic’s costmap representation to search at the costmap’s full-resolution. This will come at increased up-front costs while searching for the 2D approximate route to the goal in exchange for less search iterations and a slightly more smooth path. Withsmooth_pathon, this increased smoothness is noticeable but not massively different. When combined with all of the advanced features however, it can contribute to a better overall plan in exchange for some compute time. This scales with map size and complexity of the path plan requested. For simpler maps / paths, this may actually improve performance due to low up-front search times and lower iterations.

**`<name>.use_quadratic_cost_penalty`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionAdvanced feature: This allows a user to specify a quadratic traversal and heuristic cost computation (e.g.cost*cost) rather than linear. This will speed up the planner since the optimal channel for feasible search is deeper and prunes search branches more aggressively. This will also create overall much smoother paths since search will not attempt to refine itself to stay in the center of wide aisleways or open spaces to reduce low finite costs. However, the smoothness and less sensitivity to cost also makes it come somewhat closer to obstacles. Broadly speaking the change and non-straight penalties can be disabled when this feature is in use. The cost penalty and inflation layer parameters may need to be adjusted when enabling this parameter to create optimal performance.

**`<name>.smooth_path`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionIf true, does simple and fast smoothing post-processing to the path from search

**`<name>.smoother.max_iterations`**
- Type: `unknown`
- TypeDefaultint1000DescriptionThe maximum number of iterations the smoother has to smooth the path, to bound potential computation.

**`<name>.smoother.w_smooth`**
- Type: `unknown`
- TypeDefaultdouble0.3DescriptionWeight for smoother to apply to smooth out the data points

**`<name>.smoother.w_data`**
- Type: `unknown`
- TypeDefaultdouble0.2DescriptionWeight for smoother to apply to retain original data information

**`<name>.smoother.tolerance`**
- Type: `unknown`
- TypeDefaultdouble1e-10DescriptionParameter tolerance change amount to terminate smoothing session

**`<name>.smoother.do_refinement`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionPerforms extra refinement smoothing runs. Essentially, this recursively calls the smoother using the output from the last smoothing cycle to further smooth the path for macro-trends. This typically improves quality especially in the Hybrid-A* planner due to the extra “wobbling” it can have due to the very small primitive lengths but may cause the path to get slightly closer to some obstacles.

**`<name>.smoother.refinement_num`**
- Type: `unknown`
- TypeDefaultint2DescriptionNumber of times to recursively attempt to smooth, must be>=1.

**`<name>.goal_heading_mode`**
- Type: `unknown`
- TypeDefaultstring“DEFAULT”DescriptionGoal heading mode enum string to plan goal with multiple orientation. Options are “DEFAULT”, “BIDIRECTIONAL” and “ALL_DIRECTION”. With default mode, the planner will plan the goal with the orientation of the goal pose as was sent by the user. With the “BIDIRECTIONAL” mode, the planner will plan the goal with the orientation of the goal pose and with orientation 180 degree offset from the goal pose orientation. For “ALL_DIRECTION” mode, the planner will plan the goal with the orientation of the goal pose and all the possible orientation based on the angle quantization bins. For both the “BIDIRECTIONAL” and “ALL_DIRECTION” mode, the planner returns the path with the minimum cost.

**`<name>.coarse_search_resolution`**
- Type: `unknown`
- TypeDefaultint4DescriptionNumber of goal heading bins to skip during the coarse search phase of analytic expansion goal-finding. When a goal is found, a fine search is performed to determine the exact path during full-resolution. This parameter is only used when the goal heading mode is set to “ALL_DIRECTION” and It helps to reduce search time of analytic expansions.

**`allow_parameter_qos_overrides`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to allow QoS profiles to be overwritten with parameterized values.

**`Description`**
- Type: `unknown`
- Whether to downsample costmap to another resolution for search.

**`Description`**
- Type: `unknown`
- Multiplier factor to downsample costmap by (e.g. if 5cm costmap at 2downsample_factor, 10cm output).

**`Description`**
- Type: `unknown`
- Whether to allow traversing/search in unknown space.

**`Description`**
- Type: `unknown`
- If an exact path cannot be found, the tolerance (as measured by the heuristic cost-to-goal) that would be acceptable to diverge from the requested pose.

**`Description`**
- Type: `unknown`
- Maximum number of search iterations before failing to limit compute time, disabled by -1.

**`Description`**
- Type: `unknown`
- Maximum number of iterations once a visited node is within the goal tolerances to continue to try to find an exact match before returning the best path solution within tolerances. Negative values convert to infinite.

**`Description`**
- Type: `unknown`
- Number of iterations between checking if the goal has been cancelled or planner timed out

**`Description`**
- Type: `unknown`
- Maximum planning time in seconds.

**`Description`**
- Type: `unknown`
- Planner will attempt to complete an analytic expansions in a frequency proportional to this value and the minimum heuristic.

**`Description`**
- Type: `unknown`
- If the length is too far, reject this expansion. This prevents shortcutting of search with its penalty functions far out from the goal itself (e.g. so we don’t reverse half-way across open maps or cut through high cost zones). This should never be smaller than 4-5x the minimum turning radius being used, or planning times will begin to spike.

**`Description`**
- Type: `unknown`
- For Hybrid/Lattice nodes: The maximum single cost for any part of an analytic expansion to contain and be considered valid (except when necessary on approach to goal). This allows for removing of potential shortcutting into higher cost spaces than you might otherwise desire

**`Description`**
- Type: `unknown`
- For Hybrid/Lattice nodes: Whether or not to override the maximum cost setting if within critical distance to goal (ie probably required). If expansion is within 2*pi*min_r of the goal, then it will override the max cost iffalse.

**`Description`**
- Type: `unknown`
- Motion model enum string to search with. For Hybrid-A* node, default is “DUBIN”. Options for SE2 are DUBIN or REEDS_SHEPP.

**`Description`**
- Type: `unknown`
- Number of angular bins to use for SE2 search. This can be any even number, but a good baseline is 64 or 72 (for 5 degree increments).

**`Description`**
- Type: `unknown`
- Minimum turning radius in meters of vehicle. Also used in the smoother to compute maximum curvature. Must be greater than 0.

**`Description`**
- Type: `unknown`
- Heuristic penalty to apply to SE2 node if searching in reverse direction. Only used inREEDS_SHEPPmotion model.

**`Description`**
- Type: `unknown`
- Heuristic penalty to apply to SE2 node if changing direction (e.g. left to right) in search. Disabled by default after change to guarantee admissibility of the Hybrid-A* planner.

**`Description`**
- Type: `unknown`
- Heuristic penalty to apply to SE2 node if searching in non-straight direction.

**`Description`**
- Type: `unknown`
- Heuristic penalty to apply to SE2 node for cost at pose. Allows Hybrid-A* to be cost aware.

**`Description`**
- Type: `unknown`
- Heuristic penalty to apply to SE2 node penalty. Causes Hybrid-A* to prefer later maneuvers before earlier ones along the path. Saves search time since earlier (shorter) branches are not expanded until it is necessary. Must be >= 0.0 and <= 1.0. Must be0.0to be fully admissible.

**`Description`**
- Type: `unknown`
- Size of the dubin/reeds-sheep distance window to cache, in meters.

**`Description`**
- Type: `unknown`
- Whether to publish expansions on the/expansionstopic as an array of poses and the path’s footprints on the/planned_footprintstopic. WARNING: heavy to compute and to display, for debug only as it degrades the performance.

**`Description`**
- Type: `unknown`
- Advanced feature: Cache the obstacle map dynamic programming distance expansion heuristic between subsequent replannings of the same goal location. Dramatically speeds up replanning performance (40x) if costmap is largely static.

**`Description`**
- Type: `unknown`
- Advanced feature: Allows a user to add additional primitives to the exploration set to interpolate between the angular quantization jumps between the normal primitive set (e.g. left, right, straight). This generates additional primitives such that every angular bin between the furthest-left and furthest-right are represented in the primitive set for exploration. That way, if the settings (e.x. 0.4 turning rad, 5cm costmap, 72 bins) jump by 3 quantizations, you can explore not simply 0,3,6,9,… but the full 1,2,3,4,5,6,7,8,9,… set. This typically comes at an increased computation time, but can remove “zig-zag”-like behavior when your base primitive set is significantly not representative. It may come at less compute times when used in more confined settings like hallways whereas it can follow a narrow heuristic channel better. When this is enabled, users should take care to re-tuneangle_quantization_bins, since such a large number is not required. To continue with the previous example, when enabled, it is the same asangle_quantization_binsset to 24 (e.g.24*3=72), so 32 might be a good selection to start with to get higher quality without substantial changes in compute time.

**`Description`**
- Type: `unknown`
- Advanced feature: This allows a user to disable downsampling of the obstacle heuristic’s costmap representation to search at the costmap’s full-resolution. This will come at increased up-front costs while searching for the 2D approximate route to the goal in exchange for less search iterations and a slightly more smooth path. Withsmooth_pathon, this increased smoothness is noticeable but not massively different. When combined with all of the advanced features however, it can contribute to a better overall plan in exchange for some compute time. This scales with map size and complexity of the path plan requested. For simpler maps / paths, this may actually improve performance due to low up-front search times and lower iterations.

**`Description`**
- Type: `unknown`
- Advanced feature: This allows a user to specify a quadratic traversal and heuristic cost computation (e.g.cost*cost) rather than linear. This will speed up the planner since the optimal channel for feasible search is deeper and prunes search branches more aggressively. This will also create overall much smoother paths since search will not attempt to refine itself to stay in the center of wide aisleways or open spaces to reduce low finite costs. However, the smoothness and less sensitivity to cost also makes it come somewhat closer to obstacles. Broadly speaking the change and non-straight penalties can be disabled when this feature is in use. The cost penalty and inflation layer parameters may need to be adjusted when enabling this parameter to create optimal performance.

**`Description`**
- Type: `unknown`
- If true, does simple and fast smoothing post-processing to the path from search

**`Description`**
- Type: `unknown`
- The maximum number of iterations the smoother has to smooth the path, to bound potential computation.

**`Description`**
- Type: `unknown`
- Weight for smoother to apply to smooth out the data points

**`Description`**
- Type: `unknown`
- Weight for smoother to apply to retain original data information

**`Description`**
- Type: `unknown`
- Parameter tolerance change amount to terminate smoothing session

**`Description`**
- Type: `unknown`
- Performs extra refinement smoothing runs. Essentially, this recursively calls the smoother using the output from the last smoothing cycle to further smooth the path for macro-trends. This typically improves quality especially in the Hybrid-A* planner due to the extra “wobbling” it can have due to the very small primitive lengths but may cause the path to get slightly closer to some obstacles.

**`Description`**
- Type: `unknown`
- Number of times to recursively attempt to smooth, must be>=1.

**`Description`**
- Type: `unknown`
- Goal heading mode enum string to plan goal with multiple orientation. Options are “DEFAULT”, “BIDIRECTIONAL” and “ALL_DIRECTION”. With default mode, the planner will plan the goal with the orientation of the goal pose as was sent by the user. With the “BIDIRECTIONAL” mode, the planner will plan the goal with the orientation of the goal pose and with orientation 180 degree offset from the goal pose orientation. For “ALL_DIRECTION” mode, the planner will plan the goal with the orientation of the goal pose and all the possible orientation based on the angle quantization bins. For both the “BIDIRECTIONAL” and “ALL_DIRECTION” mode, the planner returns the path with the minimum cost.

**`Description`**
- Type: `unknown`
- Number of goal heading bins to skip during the coarse search phase of analytic expansion goal-finding. When a goal is found, a fine search is performed to determine the exact path during full-resolution. This parameter is only used when the goal heading mode is set to “ALL_DIRECTION” and It helps to reduce search time of analytic expansions.

**`Description`**
- Type: `unknown`
- Whether to allow QoS profiles to be overwritten with parameterized values.


---

##### Smac State Lattice Planner

*Source: [https://docs.nav2.org/configuration/packages/smac/configuring-smac-lattice.html](https://docs.nav2.org/configuration/packages/smac/configuring-smac-lattice.html)*

###### Smac State Lattice Planner

[![Paths generated by the Smac State Lattice](../../../_images/state_reverse.png)](../../../_images/state_reverse.png)

This planner implements a generic state lattice global path planner using precomputed, offline minimum control sets. The package also contains a python utility for computing minimum control sets based on minimum curvature constraints, in-place rotations, and omnidirectional moves. Though, any other minimum control set may be used as long as it follows the file format specification in the package’s README file.

`<name>` is the corresponding planner plugin ID selected for this type.

Note: State Lattice does not have the costmap downsampler due to the minimum control sets being tied with map resolutions on generation. The minimum turning radius is also not a parameter in State Lattice since this was specified at the minimum control set pre-computation phase. See the Smac Planner package to generate custom control sets for your vehicle or use one of our pre-generated examples.

The image above you can see the reverse expansion enabled, such that the robot can back into a tight requested spot close to an obstacle.

###### Parameters

`<name>`.allow\_unknown
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | True |
```

```
Description
:   Whether to allow traversing/search in unknown space.
```

`<name>`.tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
Description
:   If an exact path cannot be found, the tolerance (as measured by the heuristic cost-to-goal) that would be acceptable to diverge from the requested pose in distance-to-goal.
```

`<name>`.max\_iterations
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1000000 |
```

```
Description
:   Maximum number of search iterations before failing to limit compute time, disabled by -1.
```

`<name>`.max\_on\_approach\_iterations
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1000 |
```

```
Description
:   Maximum number of iterations once a visited node is within the goal tolerances to continue to try to find an exact match before returning the best path solution within tolerances.
```

`<name>`.terminal\_checking\_interval
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 5000 |
```

```
Description
:   Number of iterations between checking if the goal has been cancelled or planner timed out
```

`<name>`.max\_planning\_time
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 5.0 |
```

```
Description
:   Maximum planning time in seconds.
```

`<name>`.analytic\_expansion\_ratio
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 3.5 |
```

```
Description
:   SE2 node will attempt to complete an analytic expansion with frequency proportional to this value and the minimum heuristic. Negative values convert to infinite.
```

`<name>`.analytic\_expansion\_max\_length
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 3.0 |
```

```
Description
:   If the length is too far, reject this expansion. This prevents shortcutting of search with its penalty functions far out from the goal itself (e.g. so we don’t reverse half-way across open maps or cut through high cost zones). This should never be smaller than 4-5x the minimum turning radius being used, or planning times will begin to spike.
```

`<name>`.analytic\_expansion\_max\_cost
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 200.0 |
```

```
Description
:   For Hybrid/Lattice nodes: The maximum single cost for any part of an analytic expansion to contain and be considered valid (except when necessary on approach to goal). This allows for removing of potential shortcutting into higher cost spaces than you might otherwise desire
```

`<name>`.analytic\_expansion\_max\_cost\_override
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   For Hybrid/Lattice nodes: Whether or not to override the maximum cost setting if within critical distance to goal (ie probably required). If expansion is within 2\*pi\*min\_r of the goal, then it will override the max cost if `false`.
```

`<name>`.reverse\_penalty
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description
:   Heuristic penalty to apply to SE2 node if searching in reverse direction. Only used in `allow_reverse_expansion = true`.
```

`<name>`.change\_penalty
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.05 |
```

```
Description
:   Heuristic penalty to apply to SE2 node if changing direction (e.g. left to right) in search.
```

`<name>`.non\_straight\_penalty
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.05 |
```

```
Description
:   Heuristic penalty to apply to SE2 node if searching in non-straight direction.
```

`<name>`.cost\_penalty
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 2.0 |
```

```
Description
:   Heuristic penalty to apply to SE2 node for cost at pose. Allows State Lattice to be cost aware.
```

`<name>`.rotation\_penalty
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 5.0 |
```

```
Description
:   Penalty to apply for rotations in place, if minimum control set contains in-place rotations. This should always be set sufficiently high to weight against in-place rotations unless strictly necessary for obstacle avoidance or there may be frequent discontinuities in the plan where the plan requests the robot to rotate in place to short-cut an otherwise smooth forward-moving path for marginal path distance savings.
```

`<name>`.retrospective\_penalty
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.015 |
```

```
Description
:   Heuristic penalty to apply to SE2 node penalty. Causes State Lattice to prefer later maneuvers before earlier ones along the path. Saves search time since earlier (shorter) branches are not expanded until it is necessary. Must be >= 0.0 and <= 1.0. Must be 0.0 to be fully admissible.
```

`<name>`.lattice\_filepath
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “” |
```

```
Description
:   The filepath to the state lattice minimum control set graph, this will default to a 16 bin, 0.5m turning radius control set located in `test/` for basic testing and evaluation (opposed to Hybrid-A\*’s default of 0.5m).
```

`<name>`.lookup\_table\_size
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 20.0 |
```

```
Description
:   Size of the dubin/reeds-sheep distance window to cache, in meters.
```

`<name>`.cache\_obstacle\_heuristic
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Cache the obstacle map dynamic programming distance expansion heuristic between subsequent replannings of the same goal location. Dramatically speeds up replanning performance (40x) if costmap is largely static.
```

`<name>`.allow\_reverse\_expansion
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   If true, allows the robot to use the primitives to expand in the mirrored opposite direction of the current robot’s orientation (to reverse).
```

`<name>`.debug\_visualizations
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Whether to publish expansions on the `/expansions` topic as an array of poses and the path’s footprints on the `/planned_footprints` topic. WARNING: heavy to compute and to display, for debug only as it degrades the performance. Lattice expansions show end-points of primitives, not intermediary steps as seen in dense path outputs.
```

`<name>`.smooth\_path
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   If true, does simple and fast smoothing post-processing to the path from search
```

`<name>`.smoother.max\_iterations
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1000 |
```

```
Description
:   The maximum number of iterations the smoother has to smooth the path, to bound potential computation.
```

`<name>`.smoother.w\_smooth
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.3 |
```

```
Description
:   Weight for smoother to apply to smooth out the data points
```

`<name>`.smoother.w\_data
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.2 |
```

```
Description
:   Weight for smoother to apply to retain original data information
```

`<name>`.smoother.tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1e-10 |
```

```
Description
:   Parameter tolerance change amount to terminate smoothing session
```

`<name>`.smoother.do\_refinement
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Performs extra refinement smoothing runs. Essentially, this recursively calls the smoother using the output from the last smoothing cycle to further smooth the path for macro-trends. This typically improves quality especially in the Hybrid-A\* planner but can be helpful on the state lattice planner to reduce the “blocky” movements in State Lattice caused by the limited number of headings.
```

`<name>`.smoother.refinement\_num
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 2 |
```

```
Description
:   Number of times to recursively attempt to smooth, must be `>= 1`.
```

`<name>`.goal\_heading\_mode
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “DEFAULT” |
```

```
Description
:   Goal heading mode enum string to plan goal with multiple orientation. Options are “DEFAULT”, “BIDIRECTIONAL” and “ALL\_DIRECTION”. With default mode, the planner will plan the goal with the orientation of the goal pose as was sent by the user. With the “BIDIRECTIONAL” mode, the planner will plan the goal with the orientation of the goal pose and with orientation 180 degree offset from the goal pose orientation. For “ALL\_DIRECTION” mode, the planner will plan the goal with the orientation of the goal pose and all the possible orientation based on the angle quantization bins. For both the “BIDIRECTIONAL” and “ALL\_DIRECTION” mode, the planner returns the path with the minimum cost.
```

`<name>`.coarse\_search\_resolution
:   |  |  |
```
| --- | --- |
| Type | Default |
| int | 1 |
```

```
Description
:   Number of goal heading bins to skip during the coarse search phase of analytic expansion goal-finding. When a goal is found, a fine search is performed to determine the exact path during full-resolution. This parameter is only used when the goal heading mode is set to “ALL\_DIRECTION” and It helps to reduce search time of analytic expansions. g the coarse search phase of analytic expansion goal-finding. When a goal is found, a fine search is performed to determine the exact path during full-resolution. This parameter is only used when the goal heading mode is set to “ALL\_DIRECTION” and it helps to reduce search time of analytic expansions. It is recommended to only do coarser search if the number of bins are > 24. Otherwise, leave as 1 (fine search).
```

`<name>`.downsample\_obstacle\_heuristic
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Advanced feature: This allows a user to disable downsampling of the obstacle heuristic’s costmap representation to search at the costmap’s full-resolution. This will come at increased up-front costs while searching for the 2D approximate route to the goal in exchange for less search iterations and a slightly more smooth path. With `smooth_path` on, this increased smoothness is noticeable but not massively different. When combined with all of the advanced features however, it can contribute to a better overall plan in exchange for some compute time. This scales with map size and complexity of the path plan requested. For simpler maps / paths, this may actually improve performance due to low up-front search times and lower iterations.
```

`<name>`.use\_quadratic\_cost\_penalty
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
Description
:   Advanced feature: This allows a user to specify a quadratic traversal and heuristic cost computation (e.g. `cost * cost`) rather than linear. This will speed up the planner since the optimal channel for feasible search is deeper and prunes search branches more aggressively. This will also create overall much smoother paths since search will not attempt to refine itself to stay in the center of wide aisleways or open spaces to reduce low finite costs. However, the smoothness and less sensitivity to cost also makes it come somewhat closer to obstacles. Broadly speaking the change and non-straight penalties can be disabled when this feature is in use. The cost penalty and inflation layer parameters may need to be adjusted when enabling this parameter to create optimal performance.
```

allow\_parameter\_qos\_overrides
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | true |
```

```
Description
:   Whether to allow QoS profiles to be overwritten with parameterized values.
```

###### Example

```
planner_server:
  ros__parameters:
    planner_plugins: ["GridBased"]

    GridBased:
      plugin: "nav2_smac_planner::SmacPlannerLattice" # In Iron and older versions, "/" was used instead of "::"
      allow_unknown: true                 # Allow traveling in unknown space
      tolerance: 0.25                     # dist-to-goal heuristic cost (distance) for valid tolerance endpoints if exact goal cannot be found.
      max_iterations: 1000000             # Maximum total iterations to search for before failing (in case unreachable), set to -1 to disable
      max_on_approach_iterations: 1000    # Maximum number of iterations after within tolerances to continue to try to find exact solution
      max_planning_time: 5.0              # Max time in s for planner to plan, smooth
      analytic_expansion_ratio: 3.5       # The ratio to attempt analytic expansions during search for final approach.
      analytic_expansion_max_length: 3.0  # For Hybrid/Lattice nodes The maximum length of the analytic expansion to be considered valid to prevent unsafe shortcutting
      analytic_expansion_max_cost: 200.0  # The maximum single cost for any part of an analytic expansion to contain and be valid, except when necessary on approach to goal
      analytic_expansion_max_cost_override: false  #  Whether or not to override the maximum cost setting if within critical distance to goal (ie probably required)
      downsample_obstacle_heuristic: true   # Downsample the obstacle map dynamic programming distance expansion heuristic to speed up search at the cost of some path quality
      use_quadratic_cost_penalty: false   # Use quadratic cost penalty for traversal and heuristic cost computations rather than linear
      reverse_penalty: 2.0                # Penalty to apply if motion is reversing, must be => 1
      change_penalty: 0.05                # Penalty to apply if motion is changing directions (L to R), must be >= 0
      non_straight_penalty: 1.05          # Penalty to apply if motion is non-straight, must be => 1
      cost_penalty: 2.0                   # Penalty to apply to higher cost areas when adding into the obstacle map dynamic programming distance expansion heuristic. This drives the robot more towards the center of passages. A value between 1.3 - 3.5 is reasonable.
      rotation_penalty: 5.0               # Penalty to apply to in-place rotations, if minimum control set contains them
      retrospective_penalty: 0.015
      lattice_filepath: ""                # The filepath to the state lattice graph
      lookup_table_size: 20.0             # Size of the dubin/reeds-sheep distance window to cache, in meters.
      cache_obstacle_heuristic: false     # Cache the obstacle map dynamic programming distance expansion heuristic between subsequent replannings of the same goal location. Dramatically speeds up replanning performance (40x) if costmap is largely static.
      allow_reverse_expansion: false      # If true, allows the robot to use the primitives to expand in the mirrored opposite direction of the current robot's orientation (to reverse).
      coarse_search_resolution: 1         # Number of bins to skip when doing a coarse search for the path. Only used for all_direction goal heading mode.
      goal_heading_mode: "DEFAULT"        # DEFAULT, BIDIRECTIONAL, ALL_DIRECTION
      smooth_path: True                   # If true, does a simple and quick smoothing post-processing to the path
      smoother:
        max_iterations: 1000
        w_smooth: 0.3
        w_data: 0.2
        tolerance: 1.0e-10
        do_refinement: true
        refinement_num: 2
```

#### Parameters

**`<name>.allow_unknown`**
- Type: `unknown`
- TypeDefaultboolTrueDescriptionWhether to allow traversing/search in unknown space.

**`<name>.tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionIf an exact path cannot be found, the tolerance (as measured by the heuristic cost-to-goal) that would be acceptable to diverge from the requested pose in distance-to-goal.

**`<name>.max_iterations`**
- Type: `unknown`
- TypeDefaultint1000000DescriptionMaximum number of search iterations before failing to limit compute time, disabled by -1.

**`<name>.max_on_approach_iterations`**
- Type: `unknown`
- TypeDefaultint1000DescriptionMaximum number of iterations once a visited node is within the goal tolerances to continue to try to find an exact match before returning the best path solution within tolerances.

**`<name>.terminal_checking_interval`**
- Type: `unknown`
- TypeDefaultint5000DescriptionNumber of iterations between checking if the goal has been cancelled or planner timed out

**`<name>.max_planning_time`**
- Type: `unknown`
- TypeDefaultdouble5.0DescriptionMaximum planning time in seconds.

**`<name>.analytic_expansion_ratio`**
- Type: `unknown`
- TypeDefaultdouble3.5DescriptionSE2 node will attempt to complete an analytic expansion with frequency proportional to this value and the minimum heuristic. Negative values convert to infinite.

**`<name>.analytic_expansion_max_length`**
- Type: `unknown`
- TypeDefaultdouble3.0DescriptionIf the length is too far, reject this expansion. This prevents shortcutting of search with its penalty functions far out from the goal itself (e.g. so we don’t reverse half-way across open maps or cut through high cost zones). This should never be smaller than 4-5x the minimum turning radius being used, or planning times will begin to spike.

**`<name>.analytic_expansion_max_cost`**
- Type: `unknown`
- TypeDefaultdouble200.0DescriptionFor Hybrid/Lattice nodes: The maximum single cost for any part of an analytic expansion to contain and be considered valid (except when necessary on approach to goal). This allows for removing of potential shortcutting into higher cost spaces than you might otherwise desire

**`<name>.analytic_expansion_max_cost_override`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionFor Hybrid/Lattice nodes: Whether or not to override the maximum cost setting if within critical distance to goal (ie probably required). If expansion is within 2*pi*min_r of the goal, then it will override the max cost iffalse.

**`<name>.reverse_penalty`**
- Type: `unknown`
- TypeDefaultdouble2.0DescriptionHeuristic penalty to apply to SE2 node if searching in reverse direction. Only used inallow_reverse_expansion=true.

**`<name>.change_penalty`**
- Type: `unknown`
- TypeDefaultdouble0.05DescriptionHeuristic penalty to apply to SE2 node if changing direction (e.g. left to right) in search.

**`<name>.non_straight_penalty`**
- Type: `unknown`
- TypeDefaultdouble1.05DescriptionHeuristic penalty to apply to SE2 node if searching in non-straight direction.

**`<name>.cost_penalty`**
- Type: `unknown`
- TypeDefaultdouble2.0DescriptionHeuristic penalty to apply to SE2 node for cost at pose. Allows State Lattice to be cost aware.

**`<name>.rotation_penalty`**
- Type: `unknown`
- TypeDefaultdouble5.0DescriptionPenalty to apply for rotations in place, if minimum control set contains in-place rotations. This should always be set sufficiently high to weight against in-place rotations unless strictly necessary for obstacle avoidance or there may be frequent discontinuities in the plan where the plan requests the robot to rotate in place to short-cut an otherwise smooth forward-moving path for marginal path distance savings.

**`<name>.retrospective_penalty`**
- Type: `unknown`
- TypeDefaultdouble0.015DescriptionHeuristic penalty to apply to SE2 node penalty. Causes State Lattice to prefer later maneuvers before earlier ones along the path. Saves search time since earlier (shorter) branches are not expanded until it is necessary. Must be >= 0.0 and <= 1.0. Must be0.0to be fully admissible.

**`<name>.lattice_filepath`**
- Type: `unknown`
- TypeDefaultstring“”DescriptionThe filepath to the state lattice minimum control set graph, this will default to a 16 bin, 0.5m turning radius control set located intest/for basic testing and evaluation (opposed to Hybrid-A*’s default of 0.5m).

**`<name>.lookup_table_size`**
- Type: `unknown`
- TypeDefaultdouble20.0DescriptionSize of the dubin/reeds-sheep distance window to cache, in meters.

**`<name>.cache_obstacle_heuristic`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionCache the obstacle map dynamic programming distance expansion heuristic between subsequent replannings of the same goal location. Dramatically speeds up replanning performance (40x) if costmap is largely static.

**`<name>.allow_reverse_expansion`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionIf true, allows the robot to use the primitives to expand in the mirrored opposite direction of the current robot’s orientation (to reverse).

**`<name>.debug_visualizations`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to publish expansions on the/expansionstopic as an array of poses and the path’s footprints on the/planned_footprintstopic. WARNING: heavy to compute and to display, for debug only as it degrades the performance. Lattice expansions show end-points of primitives, not intermediary steps as seen in dense path outputs.

**`<name>.smooth_path`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionIf true, does simple and fast smoothing post-processing to the path from search

**`<name>.smoother.max_iterations`**
- Type: `unknown`
- TypeDefaultint1000DescriptionThe maximum number of iterations the smoother has to smooth the path, to bound potential computation.

**`<name>.smoother.w_smooth`**
- Type: `unknown`
- TypeDefaultdouble0.3DescriptionWeight for smoother to apply to smooth out the data points

**`<name>.smoother.w_data`**
- Type: `unknown`
- TypeDefaultdouble0.2DescriptionWeight for smoother to apply to retain original data information

**`<name>.smoother.tolerance`**
- Type: `unknown`
- TypeDefaultdouble1e-10DescriptionParameter tolerance change amount to terminate smoothing session

**`<name>.smoother.do_refinement`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionPerforms extra refinement smoothing runs. Essentially, this recursively calls the smoother using the output from the last smoothing cycle to further smooth the path for macro-trends. This typically improves quality especially in the Hybrid-A* planner but can be helpful on the state lattice planner to reduce the “blocky” movements in State Lattice caused by the limited number of headings.

**`<name>.smoother.refinement_num`**
- Type: `unknown`
- TypeDefaultint2DescriptionNumber of times to recursively attempt to smooth, must be>=1.

**`<name>.goal_heading_mode`**
- Type: `unknown`
- TypeDefaultstring“DEFAULT”DescriptionGoal heading mode enum string to plan goal with multiple orientation. Options are “DEFAULT”, “BIDIRECTIONAL” and “ALL_DIRECTION”. With default mode, the planner will plan the goal with the orientation of the goal pose as was sent by the user. With the “BIDIRECTIONAL” mode, the planner will plan the goal with the orientation of the goal pose and with orientation 180 degree offset from the goal pose orientation. For “ALL_DIRECTION” mode, the planner will plan the goal with the orientation of the goal pose and all the possible orientation based on the angle quantization bins. For both the “BIDIRECTIONAL” and “ALL_DIRECTION” mode, the planner returns the path with the minimum cost.

**`<name>.coarse_search_resolution`**
- Type: `unknown`
- TypeDefaultint1DescriptionNumber of goal heading bins to skip during the coarse search phase of analytic expansion goal-finding. When a goal is found, a fine search is performed to determine the exact path during full-resolution. This parameter is only used when the goal heading mode is set to “ALL_DIRECTION” and It helps to reduce search time of analytic expansions. g the coarse search phase of analytic expansion goal-finding. When a goal is found, a fine search is performed to determine the exact path during full-resolution. This parameter is only used when the goal heading mode is set to “ALL_DIRECTION” and it helps to reduce search time of analytic expansions. It is recommended to only do coarser search if the number of bins are > 24. Otherwise, leave as 1 (fine search).

**`<name>.downsample_obstacle_heuristic`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionAdvanced feature: This allows a user to disable downsampling of the obstacle heuristic’s costmap representation to search at the costmap’s full-resolution. This will come at increased up-front costs while searching for the 2D approximate route to the goal in exchange for less search iterations and a slightly more smooth path. Withsmooth_pathon, this increased smoothness is noticeable but not massively different. When combined with all of the advanced features however, it can contribute to a better overall plan in exchange for some compute time. This scales with map size and complexity of the path plan requested. For simpler maps / paths, this may actually improve performance due to low up-front search times and lower iterations.

**`<name>.use_quadratic_cost_penalty`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionAdvanced feature: This allows a user to specify a quadratic traversal and heuristic cost computation (e.g.cost*cost) rather than linear. This will speed up the planner since the optimal channel for feasible search is deeper and prunes search branches more aggressively. This will also create overall much smoother paths since search will not attempt to refine itself to stay in the center of wide aisleways or open spaces to reduce low finite costs. However, the smoothness and less sensitivity to cost also makes it come somewhat closer to obstacles. Broadly speaking the change and non-straight penalties can be disabled when this feature is in use. The cost penalty and inflation layer parameters may need to be adjusted when enabling this parameter to create optimal performance.

**`allow_parameter_qos_overrides`**
- Type: `unknown`
- TypeDefaultbooltrueDescriptionWhether to allow QoS profiles to be overwritten with parameterized values.

**`Description`**
- Type: `unknown`
- Whether to allow traversing/search in unknown space.

**`Description`**
- Type: `unknown`
- If an exact path cannot be found, the tolerance (as measured by the heuristic cost-to-goal) that would be acceptable to diverge from the requested pose in distance-to-goal.

**`Description`**
- Type: `unknown`
- Maximum number of search iterations before failing to limit compute time, disabled by -1.

**`Description`**
- Type: `unknown`
- Maximum number of iterations once a visited node is within the goal tolerances to continue to try to find an exact match before returning the best path solution within tolerances.

**`Description`**
- Type: `unknown`
- Number of iterations between checking if the goal has been cancelled or planner timed out

**`Description`**
- Type: `unknown`
- Maximum planning time in seconds.

**`Description`**
- Type: `unknown`
- SE2 node will attempt to complete an analytic expansion with frequency proportional to this value and the minimum heuristic. Negative values convert to infinite.

**`Description`**
- Type: `unknown`
- If the length is too far, reject this expansion. This prevents shortcutting of search with its penalty functions far out from the goal itself (e.g. so we don’t reverse half-way across open maps or cut through high cost zones). This should never be smaller than 4-5x the minimum turning radius being used, or planning times will begin to spike.

**`Description`**
- Type: `unknown`
- For Hybrid/Lattice nodes: The maximum single cost for any part of an analytic expansion to contain and be considered valid (except when necessary on approach to goal). This allows for removing of potential shortcutting into higher cost spaces than you might otherwise desire

**`Description`**
- Type: `unknown`
- For Hybrid/Lattice nodes: Whether or not to override the maximum cost setting if within critical distance to goal (ie probably required). If expansion is within 2*pi*min_r of the goal, then it will override the max cost iffalse.

**`Description`**
- Type: `unknown`
- Heuristic penalty to apply to SE2 node if searching in reverse direction. Only used inallow_reverse_expansion=true.

**`Description`**
- Type: `unknown`
- Heuristic penalty to apply to SE2 node if changing direction (e.g. left to right) in search.

**`Description`**
- Type: `unknown`
- Heuristic penalty to apply to SE2 node if searching in non-straight direction.

**`Description`**
- Type: `unknown`
- Heuristic penalty to apply to SE2 node for cost at pose. Allows State Lattice to be cost aware.

**`Description`**
- Type: `unknown`
- Penalty to apply for rotations in place, if minimum control set contains in-place rotations. This should always be set sufficiently high to weight against in-place rotations unless strictly necessary for obstacle avoidance or there may be frequent discontinuities in the plan where the plan requests the robot to rotate in place to short-cut an otherwise smooth forward-moving path for marginal path distance savings.

**`Description`**
- Type: `unknown`
- Heuristic penalty to apply to SE2 node penalty. Causes State Lattice to prefer later maneuvers before earlier ones along the path. Saves search time since earlier (shorter) branches are not expanded until it is necessary. Must be >= 0.0 and <= 1.0. Must be0.0to be fully admissible.

**`Description`**
- Type: `unknown`
- The filepath to the state lattice minimum control set graph, this will default to a 16 bin, 0.5m turning radius control set located intest/for basic testing and evaluation (opposed to Hybrid-A*’s default of 0.5m).

**`Description`**
- Type: `unknown`
- Size of the dubin/reeds-sheep distance window to cache, in meters.

**`Description`**
- Type: `unknown`
- Cache the obstacle map dynamic programming distance expansion heuristic between subsequent replannings of the same goal location. Dramatically speeds up replanning performance (40x) if costmap is largely static.

**`Description`**
- Type: `unknown`
- If true, allows the robot to use the primitives to expand in the mirrored opposite direction of the current robot’s orientation (to reverse).

**`Description`**
- Type: `unknown`
- Whether to publish expansions on the/expansionstopic as an array of poses and the path’s footprints on the/planned_footprintstopic. WARNING: heavy to compute and to display, for debug only as it degrades the performance. Lattice expansions show end-points of primitives, not intermediary steps as seen in dense path outputs.

**`Description`**
- Type: `unknown`
- If true, does simple and fast smoothing post-processing to the path from search

**`Description`**
- Type: `unknown`
- The maximum number of iterations the smoother has to smooth the path, to bound potential computation.

**`Description`**
- Type: `unknown`
- Weight for smoother to apply to smooth out the data points

**`Description`**
- Type: `unknown`
- Weight for smoother to apply to retain original data information

**`Description`**
- Type: `unknown`
- Parameter tolerance change amount to terminate smoothing session

**`Description`**
- Type: `unknown`
- Performs extra refinement smoothing runs. Essentially, this recursively calls the smoother using the output from the last smoothing cycle to further smooth the path for macro-trends. This typically improves quality especially in the Hybrid-A* planner but can be helpful on the state lattice planner to reduce the “blocky” movements in State Lattice caused by the limited number of headings.

**`Description`**
- Type: `unknown`
- Number of times to recursively attempt to smooth, must be>=1.

**`Description`**
- Type: `unknown`
- Goal heading mode enum string to plan goal with multiple orientation. Options are “DEFAULT”, “BIDIRECTIONAL” and “ALL_DIRECTION”. With default mode, the planner will plan the goal with the orientation of the goal pose as was sent by the user. With the “BIDIRECTIONAL” mode, the planner will plan the goal with the orientation of the goal pose and with orientation 180 degree offset from the goal pose orientation. For “ALL_DIRECTION” mode, the planner will plan the goal with the orientation of the goal pose and all the possible orientation based on the angle quantization bins. For both the “BIDIRECTIONAL” and “ALL_DIRECTION” mode, the planner returns the path with the minimum cost.

**`Description`**
- Type: `unknown`
- Number of goal heading bins to skip during the coarse search phase of analytic expansion goal-finding. When a goal is found, a fine search is performed to determine the exact path during full-resolution. This parameter is only used when the goal heading mode is set to “ALL_DIRECTION” and It helps to reduce search time of analytic expansions. g the coarse search phase of analytic expansion goal-finding. When a goal is found, a fine search is performed to determine the exact path during full-resolution. This parameter is only used when the goal heading mode is set to “ALL_DIRECTION” and it helps to reduce search time of analytic expansions. It is recommended to only do coarser search if the number of bins are > 24. Otherwise, leave as 1 (fine search).

**`Description`**
- Type: `unknown`
- Advanced feature: This allows a user to disable downsampling of the obstacle heuristic’s costmap representation to search at the costmap’s full-resolution. This will come at increased up-front costs while searching for the 2D approximate route to the goal in exchange for less search iterations and a slightly more smooth path. Withsmooth_pathon, this increased smoothness is noticeable but not massively different. When combined with all of the advanced features however, it can contribute to a better overall plan in exchange for some compute time. This scales with map size and complexity of the path plan requested. For simpler maps / paths, this may actually improve performance due to low up-front search times and lower iterations.

**`Description`**
- Type: `unknown`
- Advanced feature: This allows a user to specify a quadratic traversal and heuristic cost computation (e.g.cost*cost) rather than linear. This will speed up the planner since the optimal channel for feasible search is deeper and prunes search branches more aggressively. This will also create overall much smoother paths since search will not attempt to refine itself to stay in the center of wide aisleways or open spaces to reduce low finite costs. However, the smoothness and less sensitivity to cost also makes it come somewhat closer to obstacles. Broadly speaking the change and non-straight penalties can be disabled when this feature is in use. The cost penalty and inflation layer parameters may need to be adjusted when enabling this parameter to create optimal performance.

**`Description`**
- Type: `unknown`
- Whether to allow QoS profiles to be overwritten with parameterized values.


---

#### Trajectory Critics

##### BaseObstacleCritic

*Source: [https://docs.nav2.org/configuration/packages/trajectory_critics/base_obstacle.html](https://docs.nav2.org/configuration/packages/trajectory_critics/base_obstacle.html)*

###### BaseObstacleCritic

Scores a trajectory based on where the path passes over the costmap.
To use this properly, you must use the inflation layer in costmap to expand obstacles by the robot’s radius.

###### Parameters

`<dwb plugin>`: DWB plugin name defined in the **controller\_plugin\_ids** parameter in [Controller Server](../configuring-controller-server.html#configuring-controller-server).

`<name>`: BaseObstacleCritic critic name defined in the **<dwb plugin>.critics** parameter defined in [DWB Controller](../dwb-params/controller.html#dwb-controller).

`<dwb plugin>`.`<name>`.sum\_scores
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
> Description
> :   Whether to allow for scores to be summed up.
```

`<dwb plugin>`.`<name>`.scale
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
> Description
> :   Weighed scale for critic.
```

#### Parameters

**`<dwbplugin>.<name>.sum_scores`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to allow for scores to be summed up.

**`<dwbplugin>.<name>.scale`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionWeighed scale for critic.

**`Description`**
- Type: `unknown`
- Whether to allow for scores to be summed up.

**`Description`**
- Type: `unknown`
- Weighed scale for critic.


---

##### GoalAlignCritic

*Source: [https://docs.nav2.org/configuration/packages/trajectory_critics/goal_align.html](https://docs.nav2.org/configuration/packages/trajectory_critics/goal_align.html)*

###### GoalAlignCritic

Scores a trajectory based on how well aligned the trajectory is with the goal pose.

###### Parameters

`<dwb plugin>`: DWB plugin name defined in the **controller\_plugin\_ids** parameter in [Controller Server](../configuring-controller-server.html#configuring-controller-server).

`<name>`: GoalAlignCritic critic name defined in the **<dwb plugin>.critics** parameter defined in [DWB Controller](../dwb-params/controller.html#dwb-controller).

`<dwb plugin>`.`<name>`.forward\_point\_distance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.325 |
```

```
> Description
> :   Point in front of robot to look ahead to compute angular change from.
```

`<dwb plugin>`.`<name>`.aggregation\_type
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “last” |
```

```
> Description
> :   last, sum, or product combination methods.
```

`<dwb plugin>`.`<name>`.scale
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
> Description
> :   Weighed scale for critic.
```

#### Parameters

**`<dwbplugin>.<name>.forward_point_distance`**
- Type: `unknown`
- TypeDefaultdouble0.325DescriptionPoint in front of robot to look ahead to compute angular change from.

**`<dwbplugin>.<name>.aggregation_type`**
- Type: `unknown`
- TypeDefaultstring“last”Descriptionlast, sum, or product combination methods.

**`<dwbplugin>.<name>.scale`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionWeighed scale for critic.

**`Description`**
- Type: `unknown`
- Point in front of robot to look ahead to compute angular change from.

**`Description`**
- Type: `unknown`
- last, sum, or product combination methods.

**`Description`**
- Type: `unknown`
- Weighed scale for critic.


---

##### GoalDistCritic

*Source: [https://docs.nav2.org/configuration/packages/trajectory_critics/goal_dist.html](https://docs.nav2.org/configuration/packages/trajectory_critics/goal_dist.html)*

###### GoalDistCritic

Scores a trajectory based on how close the trajectory gets the robot to the goal pose.

###### Parameters

`<dwb plugin>`: DWB plugin name defined in the **controller\_plugin\_ids** parameter in [Controller Server](../configuring-controller-server.html#configuring-controller-server).

`<name>`: GoalDistCritic critic name defined in the **<dwb plugin>.critics** parameter defined in [DWB Controller](../dwb-params/controller.html#dwb-controller).

`<dwb plugin>`.`<name>`.aggregation\_type
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “last” |
```

```
> Description
> :   last, sum, or product combination methods.
```

`<dwb plugin>`.`<name>`.scale
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
> Description
> :   Weighed scale for critic.
```

#### Parameters

**`<dwbplugin>.<name>.aggregation_type`**
- Type: `unknown`
- TypeDefaultstring“last”Descriptionlast, sum, or product combination methods.

**`<dwbplugin>.<name>.scale`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionWeighed scale for critic.

**`Description`**
- Type: `unknown`
- last, sum, or product combination methods.

**`Description`**
- Type: `unknown`
- Weighed scale for critic.


---

##### ObstacleFootprintCritic

*Source: [https://docs.nav2.org/configuration/packages/trajectory_critics/obstacle_footprint.html](https://docs.nav2.org/configuration/packages/trajectory_critics/obstacle_footprint.html)*

###### ObstacleFootprintCritic

Scores a trajectory based on verifying all points along the robot’s footprint don’t touch an obstacle marked in the costmap.

###### Parameters

`<dwb plugin>`: DWB plugin name defined in the **controller\_plugin\_ids** parameter in [Controller Server](../configuring-controller-server.html#configuring-controller-server).

`<name>`: ObstacleFootprintCritic critic name defined in the **<dwb plugin>.critics** parameter defined in [DWB Controller](../dwb-params/controller.html#dwb-controller).

`<dwb plugin>`.`<name>`.sum\_scores
:   |  |  |
```
| --- | --- |
| Type | Default |
| bool | false |
```

```
> Description
> :   Whether to allow for scores to be summed up.
```

`<dwb plugin>`.`<name>`.scale
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
> Description
> :   Weighed scale for critic.
```

#### Parameters

**`<dwbplugin>.<name>.sum_scores`**
- Type: `unknown`
- TypeDefaultboolfalseDescriptionWhether to allow for scores to be summed up.

**`<dwbplugin>.<name>.scale`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionWeighed scale for critic.

**`Description`**
- Type: `unknown`
- Whether to allow for scores to be summed up.

**`Description`**
- Type: `unknown`
- Weighed scale for critic.


---

##### OscillationCritic

*Source: [https://docs.nav2.org/configuration/packages/trajectory_critics/oscillation.html](https://docs.nav2.org/configuration/packages/trajectory_critics/oscillation.html)*

###### OscillationCritic

Prevents the robot from just moving backwards and forwards.

###### Parameters

`<dwb plugin>`: DWB plugin name defined in the **controller\_plugin\_ids** parameter in [Controller Server](../configuring-controller-server.html#configuring-controller-server).

`<name>`: OscillationCritic critic name defined in the **<dwb plugin>.critics** parameter defined in [DWB Controller](../dwb-params/controller.html#dwb-controller).

`<dwb plugin>`.`<name>`.oscillation\_reset\_dist
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.05 |
```

```
> Description
> :   Minimum distance to move to reset oscillation watchdog (m).
```

`<dwb plugin>`.`<name>`.oscillation\_reset\_angle
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.2 |
```

```
> Description
> :   Minimum angular distance to move to reset watchdog (rad).
```

`<dwb plugin>`.`<name>`.oscillation\_reset\_time
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | -1 |
```

```
> Description
> :   Duration when a reset may be called. If -1, cannot be reset..
```

`<dwb plugin>`.`<name>`.x\_only\_threshold
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.05 |
```

```
> Description
> :   Threshold to check in the X velocity direction.
```

`<dwb plugin>`.`<name>`.scale
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
> Description
> :   Weighed scale for critic.
```

#### Parameters

**`<dwbplugin>.<name>.oscillation_reset_dist`**
- Type: `unknown`
- TypeDefaultdouble0.05DescriptionMinimum distance to move to reset oscillation watchdog (m).

**`<dwbplugin>.<name>.oscillation_reset_angle`**
- Type: `unknown`
- TypeDefaultdouble0.2DescriptionMinimum angular distance to move to reset watchdog (rad).

**`<dwbplugin>.<name>.oscillation_reset_time`**
- Type: `unknown`
- TypeDefaultdouble-1DescriptionDuration when a reset may be called. If -1, cannot be reset..

**`<dwbplugin>.<name>.x_only_threshold`**
- Type: `unknown`
- TypeDefaultdouble0.05DescriptionThreshold to check in the X velocity direction.

**`<dwbplugin>.<name>.scale`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionWeighed scale for critic.

**`Description`**
- Type: `unknown`
- Minimum distance to move to reset oscillation watchdog (m).

**`Description`**
- Type: `unknown`
- Minimum angular distance to move to reset watchdog (rad).

**`Description`**
- Type: `unknown`
- Duration when a reset may be called. If -1, cannot be reset..

**`Description`**
- Type: `unknown`
- Threshold to check in the X velocity direction.

**`Description`**
- Type: `unknown`
- Weighed scale for critic.


---

##### PathAlignCritic

*Source: [https://docs.nav2.org/configuration/packages/trajectory_critics/path_align.html](https://docs.nav2.org/configuration/packages/trajectory_critics/path_align.html)*

###### PathAlignCritic

Scores a trajectory based on how well it is aligned to the path provided by the global planner.

###### Parameters

`<name>`: PathAlignCritic critic name defined in the **<dwb plugin>.critics** parameter defined in [DWB Controller](../dwb-params/controller.html#dwb-controller).

`<dwb plugin>`.`<name>`.forward\_point\_distance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.325 |
```

```
> Description
> :   Point in front of robot to look ahead to compute angular change from.
```

`<dwb plugin>`.`<name>`.aggregation\_type
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “last” |
```

```
> Description
> :   last, sum, or product combination methods.
```

`<dwb plugin>`.`<name>`.scale
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
> Description
> :   Weighed scale for critic.
```

#### Parameters

**`<dwbplugin>.<name>.forward_point_distance`**
- Type: `unknown`
- TypeDefaultdouble0.325DescriptionPoint in front of robot to look ahead to compute angular change from.

**`<dwbplugin>.<name>.aggregation_type`**
- Type: `unknown`
- TypeDefaultstring“last”Descriptionlast, sum, or product combination methods.

**`<dwbplugin>.<name>.scale`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionWeighed scale for critic.

**`Description`**
- Type: `unknown`
- Point in front of robot to look ahead to compute angular change from.

**`Description`**
- Type: `unknown`
- last, sum, or product combination methods.

**`Description`**
- Type: `unknown`
- Weighed scale for critic.


---

##### PathDistCritic

*Source: [https://docs.nav2.org/configuration/packages/trajectory_critics/path_dist.html](https://docs.nav2.org/configuration/packages/trajectory_critics/path_dist.html)*

###### PathDistCritic

Scores a trajectory based on how well it is aligned to the path provided by the global planner.

###### Parameters

`<name>`: PathDistCritic critic name defined in the **<dwb plugin>.critics** parameter defined in [DWB Controller](../dwb-params/controller.html#dwb-controller).

`<dwb plugin>`.`<name>`.aggregation\_type
:   |  |  |
```
| --- | --- |
| Type | Default |
| string | “last” |
```

```
> Description
> :   last, sum, or product combination methods.
```

`<dwb plugin>`.`<name>`.scale
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
> Description
> :   Weighed scale for critic.
```

#### Parameters

**`<dwbplugin>.<name>.aggregation_type`**
- Type: `unknown`
- TypeDefaultstring“last”Descriptionlast, sum, or product combination methods.

**`<dwbplugin>.<name>.scale`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionWeighed scale for critic.

**`Description`**
- Type: `unknown`
- last, sum, or product combination methods.

**`Description`**
- Type: `unknown`
- Weighed scale for critic.


---

##### PreferForwardCritic

*Source: [https://docs.nav2.org/configuration/packages/trajectory_critics/prefer_forward.html](https://docs.nav2.org/configuration/packages/trajectory_critics/prefer_forward.html)*

###### PreferForwardCritic

Scores trajectories that move the robot forwards more highly.

###### Parameters

`<dwb plugin>`: DWB plugin name defined in the **controller\_plugin\_ids** parameter in [Controller Server](../configuring-controller-server.html#configuring-controller-server).

`<name>`: PreferForwardCritic critic name defined in the **<dwb plugin>.critics** parameter defined in [DWB Controller](../dwb-params/controller.html#dwb-controller).

`<dwb plugin>`.`<name>`.penalty
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
> Description
> :   Penalty to apply to backward motion.
```

`<dwb plugin>`.`<name>`.strafe\_x
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.1 |
```

```
> Description
> :   Minimum X velocity before penalty.
```

`<dwb plugin>`.`<name>`.strafe\_theta
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.2 |
```

```
> Description
> :   Minimum angular velocity before applying penalty.
```

`<dwb plugin>`.`<name>`.theta\_scale
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 10.0 |
```

```
> Description
> :   Weight for angular velocity component.
```

`<dwb plugin>`.`<name>`.scale
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
> Description
> :   Weighed scale for critic.
```

#### Parameters

**`<dwbplugin>.<name>.penalty`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionPenalty to apply to backward motion.

**`<dwbplugin>.<name>.strafe_x`**
- Type: `unknown`
- TypeDefaultdouble0.1DescriptionMinimum X velocity before penalty.

**`<dwbplugin>.<name>.strafe_theta`**
- Type: `unknown`
- TypeDefaultdouble0.2DescriptionMinimum angular velocity before applying penalty.

**`<dwbplugin>.<name>.theta_scale`**
- Type: `unknown`
- TypeDefaultdouble10.0DescriptionWeight for angular velocity component.

**`<dwbplugin>.<name>.scale`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionWeighed scale for critic.

**`Description`**
- Type: `unknown`
- Penalty to apply to backward motion.

**`Description`**
- Type: `unknown`
- Minimum X velocity before penalty.

**`Description`**
- Type: `unknown`
- Minimum angular velocity before applying penalty.

**`Description`**
- Type: `unknown`
- Weight for angular velocity component.

**`Description`**
- Type: `unknown`
- Weighed scale for critic.


---

##### RotateToGoalCritic

*Source: [https://docs.nav2.org/configuration/packages/trajectory_critics/rotate_to_goal.html](https://docs.nav2.org/configuration/packages/trajectory_critics/rotate_to_goal.html)*

###### RotateToGoalCritic

Only allows the robot to rotate to the goal orientation when it is sufficiently close to the goal location.

###### Parameters

`<dwb plugin>`: DWB plugin name defined in the **controller\_plugin\_ids** parameter in [Controller Server](../configuring-controller-server.html#configuring-controller-server).

`<name>`: RotateToGoalCritic critic name defined in the **<dwb plugin>.critics** parameter defined in [DWB Controller](../dwb-params/controller.html#dwb-controller).

`<dwb plugin>`.xy\_goal\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
> Description
> :   Tolerance to meet goal completion criteria (m).
```

`<dwb plugin>`.path\_length\_tolerance
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
> Description
> :   Tolerance to meet goal completion criteria (m).
```

`<dwb plugin>`.trans\_stopped\_velocity
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.25 |
```

```
> Description
> :   Velocity below is considered to be stopped at tolerance met (rad/s).
```

`<dwb plugin>`.`<name>`.slowing\_factor
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 5.0 |
```

```
> Description
> :   Factor to slow robot motion by while rotating to goal.
```

`<dwb plugin>`.`<name>`.lookahead\_time
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | -1 |
```

```
> Description
> :   If > 0, amount of time to look forward for a collision for..
```

`<dwb plugin>`.`<name>`.scale
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
> Description
> :   Weighed scale for critic.
```

#### Parameters

**`<dwbplugin>.xy_goal_tolerance`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionTolerance to meet goal completion criteria (m).

**`<dwbplugin>.path_length_tolerance`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionTolerance to meet goal completion criteria (m).

**`<dwbplugin>.trans_stopped_velocity`**
- Type: `unknown`
- TypeDefaultdouble0.25DescriptionVelocity below is considered to be stopped at tolerance met (rad/s).

**`<dwbplugin>.<name>.slowing_factor`**
- Type: `unknown`
- TypeDefaultdouble5.0DescriptionFactor to slow robot motion by while rotating to goal.

**`<dwbplugin>.<name>.lookahead_time`**
- Type: `unknown`
- TypeDefaultdouble-1DescriptionIf > 0, amount of time to look forward for a collision for..

**`<dwbplugin>.<name>.scale`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionWeighed scale for critic.

**`Description`**
- Type: `unknown`
- Tolerance to meet goal completion criteria (m).

**`Description`**
- Type: `unknown`
- Tolerance to meet goal completion criteria (m).

**`Description`**
- Type: `unknown`
- Velocity below is considered to be stopped at tolerance met (rad/s).

**`Description`**
- Type: `unknown`
- Factor to slow robot motion by while rotating to goal.

**`Description`**
- Type: `unknown`
- If > 0, amount of time to look forward for a collision for..

**`Description`**
- Type: `unknown`
- Weighed scale for critic.


---

##### TwirlingCritic

*Source: [https://docs.nav2.org/configuration/packages/trajectory_critics/twirling.html](https://docs.nav2.org/configuration/packages/trajectory_critics/twirling.html)*

###### TwirlingCritic

Prevents holonomic robots from spinning as they make their way to the goal.

###### Parameters

`<dwb plugin>`: DWB plugin name defined in the **controller\_plugin\_ids** parameter in [Controller Server](../configuring-controller-server.html#configuring-controller-server).

`<name>`: TwirlingCritic critic name defined in the **<dwb plugin>.critics** parameter defined in [DWB Controller](../dwb-params/controller.html#dwb-controller).

`<dwb plugin>`.`<name>`.scale
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 1.0 |
```

```
> Description
> :   Weighed scale for critic.
```

#### Parameters

**`<dwbplugin>.<name>.scale`**
- Type: `unknown`
- TypeDefaultdouble1.0DescriptionWeighed scale for critic.

**`Description`**
- Type: `unknown`
- Weighed scale for critic.


---

## Development Guides

### Development Guides

*Source: [https://docs.nav2.org/development_guides/index.html](https://docs.nav2.org/development_guides/index.html)*

#### Development Guides

This section includes guides for developing Nav2, e.g. how to build from source, how to use dev containers, and how to get involved.

* [Build and Install](build_docs/index.html)
  + [Install](build_docs/index.html#install)
  + [Build](build_docs/index.html#build)
  + [Generate Doxygen](build_docs/index.html#generate-doxygen)
  + [Help](build_docs/index.html#help)
* [Dev Containers](devcontainer_docs/index.html)
  + [What, Why, How?](devcontainer_docs/index.html#what-why-how)
  + [Prerequisites](devcontainer_docs/index.html#prerequisites)
  + [Getting started](devcontainer_docs/index.html#getting-started)
  + [Security](devcontainer_docs/index.html#security)
* [Getting Involved](involvement_docs/index.html)
  + [Getting Involved](involvement_docs/index.html#id1)
  + [Process](involvement_docs/index.html#process)
  + [Licensing](involvement_docs/index.html#licensing)
  + [Developer Certification of Origin (DCO)](involvement_docs/index.html#developer-certification-of-origin-dco)

---

### Build Docs

#### Build and Install

*Source: [https://docs.nav2.org/development_guides/build_docs/index.html](https://docs.nav2.org/development_guides/build_docs/index.html)*

##### Build and Install

###### Install

Nav2 and its dependencies are released as binaries.
You may install it via the following to get the latest stable released version:

###### For Iron and Older

```
source /opt/ros/<distro>/setup.bash
sudo apt install \
  ros-$ROS_DISTRO-navigation2 \
  ros-$ROS_DISTRO-nav2-bringup \
  ros-$ROS_DISTRO-turtlebot3*
```

###### For Jazzy and Newer

```
source /opt/ros/<distro>/setup.bash
sudo apt install \
  ros-$ROS_DISTRO-navigation2 \
  ros-$ROS_DISTRO-nav2-bringup \
  ros-$ROS_DISTRO-nav2-minimal-tb*
```

###### Build

There are a few ways to build Nav2 using:

* Released Distribution Binaries

  + Build Nav2 using readily installable binary dependencies
* Rolling Development Source

  + Build Nav2 using custom or latest source dependencies
* Docker Container Images

  + Build Nav2 using cached images and templated Dockerfiles

Tip

For a *repeatable*, *reproducible* and *streamlined* development experience, check the Nav2 documentation on using [Dev Containers](../devcontainer_docs/index.html#devcontainers)!

###### Released Distribution Binaries

To build Nav2, you’ll first need to build or install ROS 2 and related development tools, including: `colcon`, `rosdep` and `vcstool`.

See also

For more information on building or installing ROS 2 distros, see the official documentation:

* [ROS 2 Installation](https://docs.ros.org/en/rolling/Installation.html)
* [Install development tools and ROS tools](https://docs.ros.org/en/rolling/Installation/Alternatives/Ubuntu-Development-Setup.html#install-development-tools-and-ros-tools)

Once your environment is setup, clone the repo, install all dependencies, and build the workspace:

Attention

The branch naming schema for Nav2 is organized by ROS distro, while the default branch for Rolling is `main`.

```
source /opt/ros/<distro>/setup.bash
mkdir -p ~/nav2_ws/src && cd ~/nav2_ws
git clone https://github.com/ros-navigation/navigation2.git --branch $ROS_DISTRO ./src/navigation2
rosdep install -y \
  --from-paths ./src \
  --ignore-src
colcon build \
  --symlink-install
```

You can then `source ~/nav2_ws/install/setup.bash` to get ready for demonstrations!

Hint

For more examples on building Nav2 from released distribution binaries, checkout [distro.Dockerfile](https://github.com/ros-navigation/navigation2/blob/main/tools/distro.Dockerfile).

###### Rolling Development Source

Building Nav2 using rolling development source is similar to building Nav2 from released distribution binaries, where instead you build dependencies from source using the main development branches for all ROS based packages.
Nav2 does not currently release binaries on rolling, so it must be build from source.

See also

For more information on building ROS 2 from source, see the official documentation:

* [ROS 2 Building from source](https://docs.ros.org/en/rolling/Installation.html#building-from-source)

Once your environment is setup, clone the repo and build the workspace:

```
source <ros_ws>/install/setup.bash
mkdir -p ~/nav2_ws/src && cd ~/nav2_ws
git clone https://github.com/ros-navigation/navigation2.git --branch main ./src/navigation2
git clone https://github.com/ros-navigation/nav2_minimal_turtlebot_simulation.git --branch main ./src/nav2_minimal_turtlebot_simulation
rosdep install -r -y \
  --from-paths ./src \
  --ignore-src
colcon build \
  --symlink-install
```

You can then `source ~/nav2_ws/install/setup.bash` to get ready for demonstrations! It is safe
to ignore the rosdep error of from the missing `slam_toolbox` key.

Hint

If you are using `rmw_zenoh_cpp` and want to run tests without a Zenoh router,
you can enable isolated tests by building with:

```
colcon build --symlink-install \
  --cmake-args -DUSE_ISOLATED_TESTS=ON
```

Hint

For more examples on building Nav2 from rolling development source, checkout [source.Dockerfile](https://github.com/ros-navigation/navigation2/blob/main/tools/source.Dockerfile).

###### Docker Container Images

Building Nav2 using Docker container images provides a repeatable and reproducible environment to automate and self document the entire setup process. Instead of manually invoking the development tools as documented above, you can leverage the project’s Dockerfiles to build and install Nav2 for various distributions.

See also

For more information on installing Docker or leaning about Dockerfiles, see the official documentation:

* [Docker Engine](https://docs.docker.com/engine/install)
* [Dockerfile reference](https://docs.docker.com/engine/reference/builder)

Once your system is setup, you can build the Nav2 Dockerfile from the root of the repo:

```
export ROS_DISTRO=rolling
git clone https://github.com/ros-navigation/navigation2.git --branch main
docker build --tag navigation2:$ROS_DISTRO \
  --build-arg FROM_IMAGE=ros:$ROS_DISTRO \
  --build-arg OVERLAY_MIXINS="release ccache lld" \
  --cache-from ghcr.io/ros-navigation/navigation2:main \
  ./navigation2
```

The [docker build](https://docs.docker.com/engine/reference/commandline/build/) command above creates a tagged image using the Dockerfile from the context specified using the path to the repo, where build-time variables are set using additional arguments, e.g. passing a set of [colcon mixins](https://github.com/colcon/colcon-mixin-repository) to configure the workspace build. Check the `ARG` directives in the Dockerfile to discover all build-time variables available. The command also specifies an [external cache source](https://docs.docker.com/engine/reference/commandline/build/#cache-from) to pull the latest cached image from Nav2’s [Container Registry](https://github.com/ros-navigation/navigation2/pkgs/container/navigation2) to speed up the build process.

Tip

The images cached from above are used for Nav2 CI, but can also be used with Nav2 [Dev Containers](../devcontainer_docs/index.html#devcontainers)!

###### Using Pre-built nav2\_docker Images

For contributors who want to get started quickly, Nav2 provides pre-built Docker images through the [nav2\_docker](https://github.com/ros-navigation/nav2_docker) repository. These images are available for all active ROS 2 distributions and come in two variants:

* **Nightly images**: Built from the latest Nav2 branch for each distribution
* **Release images**: Built from the latest officially released Nav2 version

Supported distributions include Humble, Jazzy, Kilted, and Rolling.

To use a pre-built nav2\_docker image for development:

```
##### Pull a release image (example: Jazzy 1.3.1)
docker pull ghcr.io/ros-navigation/nav2_docker:jazzy-1.3.1

##### Or pull a nightly image for the latest features
docker pull ghcr.io/ros-navigation/nav2_docker:rolling-nightly
```

You can then use these images directly for development or as base images for your own custom deployments by specifying them in your Dockerfile.

---

###### Generate Doxygen

Run `doxygen` in the root of the Nav2 repository.
It will generate a `/doc/*` directory containing the documentation.
The documentation entrypoint in a browser is index.html.

---

###### Help

[Build Troubleshooting Guide](build_troubleshooting_guide.html#build-troubleshooting-guide)

---

#### Build Troubleshooting Guide

*Source: [https://docs.nav2.org/development_guides/build_docs/build_troubleshooting_guide.html](https://docs.nav2.org/development_guides/build_docs/build_troubleshooting_guide.html)*

##### Build Troubleshooting Guide

###### Common Nav2 Dependencies Build Failures

* Make sure that .bashrc file has no ROS environment variables in it. Open new terminals and try to build the packages again.
* Make sure to run rosdep for the correct ROS 2 distribution.
  `rosdep install -y -r -q --from-paths src --ignore-src --rosdistro <ros2-distro>`
* Make sure that the `setup.bash` is sourced in the ROS 2 installation or ROS 2 main build workspace, if applicable. Check if you can run talker and listener nodes.
* Make sure that the `setup.bash` in `nav2_depend_ws/install` is sourced.
* Check if you have the correct ROS version and distribution. `printenv | grep -i ROS`
* If you see a bunch of errors on startup about `map` or `odom` frame not existing, remember to activate drivers (or gazebo for simulation) and set an initial pose in `map` frame. Costmap2D will block activation until a full TF tree is available.
* Make sure you’ve activated the lifecycle nodes if you’re not seeing transforms or servers running.
* Search [GitHub Issues](https://github.com/ros-navigation/navigation2/issues)
* Make sure you’re using the correct branch for your distribution. There is no cross support from branch for `DistroA` in `DistroB`. The main development branch uses the rolling distribution.

Still can’t solve it? Let us know about your issue. [Open a ticket](https://github.com/ros-navigation/navigation2/issues/new).

###### Reporting Issue

* If you run into any issues when building Navigation2, you can use the search tool in the issues tab on [GitHub](https://github.com/ros-navigation/navigation2/issues) and always feel free to [open a ticket](https://github.com/ros-navigation/navigation2/issues/new).

---

### Devcontainer Docs

#### Dev Container Guide

*Source: [https://docs.nav2.org/development_guides/devcontainer_docs/devcontainer_guide.html](https://docs.nav2.org/development_guides/devcontainer_docs/devcontainer_guide.html)*

##### Dev Container Guide

In this guide, we’ll walk through the process of creating and using dev containers for the project. While included subsections will provide greater detail on the various aspects of the process, complete comprehension of the entire guide is not required to get started, but is recommended for those interested in how dev containers work, or how to customize and optimize them for their own personal workflows.

###### Creating Dev Containers

Before creating a dev container, you’ll want to choose the exact configuration to use. By default the `.devcontainer/devcontainer.json` configuration is selected, however you can also choose any other `devcontainer.json` file in the `.devcontainer/` directory, where such configurations can be nested to provide greater customization: either by targeting different stages within different Dockerfiles, overriding any merged metadata or default properties, or inclusion of additional extensions and alternate commands.

See also

The specification, reference, and schema for the `devcontainer.json` config file format can be found here:

* [Specification](https://containers.dev/implementors/spec)

  + Development Container Specification
* [Reference](https://containers.dev/implementors/json_reference)

  + Metadata and properties reference
* [Schema](https://containers.dev/implementors/json_schema)

  + JSON schema for `devcontainer.json`

###### Building the image

When first creating Dev Containers, any supporting tool or service used will download and build the docker images needed to run the container. This includes pulling any parent images the project’s Dockerfile builds `FROM`, as well as any tags or layers declared via `cacheFrom`, as specified in the chosen `devcontainer.json` config file. This can take a while, but only needs to be done once, or at least not again until such layers are updated and pushed to the image registry.

Specifically, for this project, the default `devcontainer.json` file targets the `dever` stage within the project’s root Dockerfile, the stage that also includes handy tools for developing the project, such as bash auto completion. This stage is in turn built `FROM` the `builder` stage, the stage that only includes the dependencies needed for building the project, as reused by the project’s CI. For example, the `dever` stage modifies `/etc/bash.bashrc` to automatically source `install/setup.bash` from the underlay workspace, ensuring all VS Code extensions are loaded with the correct environment, while avoiding any race conditions during installation and startup.

To speed up the initial build, images layers from this `builder` stage are cached by pulling the same image tag used by the project’s CI, hosted from the image registry. This ensures your local dev container replicates our CI environment as close as possible, while benefiting from any cached work preemptively performed by the CI. Yet, this still allows you to customize the project’s Dockerfile and rebuild the container, without needing to update CI images to reflect your local modifications.

See also

More details on the project’s CI and related docker image registry can be found here:

* [Chronicles of Caching and Containerising CI for Nav2](https://vimeo.com/649647161/5b0c278e6c)

  + Video presentation from ROS World 2021 - Ruffin White

Once the base image from the target stage is built, the supporting tool or service may then add additional layers to the image, such as installing additional [features](https://containers.dev/features) or customizations. For VS Code, this also includes some fancy file caching for any extensions to install later. Once this custom image is built, it is then used to start the dev container.

###### Starting the container

When first creating Dev Containers, any supporting tool or service will invoke a sequence of commands specified in the chosen `devcontainer.json` config file. This can take a while, but only needs to be done once, or at least not again until the container is rebuilt, triggered by either updating the Dockerfile, base image, or `.devcontainer/` config.

Specifically, for this project, the default `devcontainer.json` config executes the `onCreateCommand` to initially colcon cache, clean, and build the overlay workspace for the project. This ensures the workspace is precompiled and ready to use, while also ensuring any changes to the project’s source code are reflected in the container. This is useful for:

* IntelliSense

  + Enables VS Code extensions to parse auto generated code
  + Applicable for ROS package defining messages and services files
  + Necessary for code modeling, navigation, and syntax highlighting
* Caching

  + Enables Codespace Prebuilds to cache the workspace artifacts
  + Applicable for reducing startup time when spawning new Codespaces
  + Necessary for limiting costs from CPU and storage usage

While the colcon workspace is being built, VS Code will simultaneously install any specified extensions and settings. Next the `updateContentCommand` is executed, which reruns whenever the container is started or restarted. Specifically, for this project, this command re-cleans and re-builds the same colcon workspace as before, but only for invalidated packages detected by colcon cache using the lockfiles initialized during the `onCreateCommand`. This caching behavior also replicates the project’s CI workflow. This is useful for:

* Branching

  + Enables caching of workspace artifacts when switching between branches
  + Applicable for reviewing pull requests without rebuilding entire container
  + Necessary for reducing startup time when spawning new Codespaces

Hint

More documentation about these additional colcon verb extensions can be found here:

* [colcon-cache](https://github.com/ruffsl/colcon-cache)

  + A colcon extension to cache the processing of packages
* [colcon-clean](https://github.com/colcon/colcon-clean)

  + A colcon extension to clean package workspaces

Finally, the `postCreateCommand` is executed, which also reruns whenever the container is started or restarted. Specifically, for this project, this command makes a last few tweaks to the user’s environment to improve the development experience.

To speed up subsequent startups, volumes that are mounted to the container store a persistent ccache and colcon workspace, while the environment is set to enable [ccache](https://ccache.dev/) via [colcon mixins](https://github.com/colcon/colcon-mixin-repository). These volumes are labeled using the [`devcontainerId`](https://containers.dev/implementors/json_reference/#variables-in-devcontainerjson) variable, which uniquely identify the dev container on a Docker host, allowing us to refer to a common identifier that is unique to the dev container, while remaining stable across rebuilds. This is useful for:

* Caching

  + Enables colcon workspaces and ccache to persist between container rebuilds
  + Applicable for avoiding re-compilation when modifying dev container config files
  + Necessary for quickly customizing image or features without rebuilding from scratch

Tip

While these volumes are uniquely named, you could rename them locally to further organize or segment works-in-progress. E.g. appending branch names to the volume name to quickly switch between pull requests and cached colcon workspaces.

Additionally, the container can be granted [privileged](https://docs.docker.com/engine/reference/commandline/run/#privileged) and non-default [Linux capabilities](https://docs.docker.com/engine/reference/run/#runtime-privilege-and-linux-capabilities), connected using the [host](https://docs.docker.com/network/host/) network mode and [IPC](https://docs.docker.com/engine/reference/run/#ipc-settings---ipc) and [PID](https://docs.docker.com/engine/reference/run/#pid-settings---pid) spaces, with a relaxed [security configuration](https://docs.docker.com/engine/reference/run/#security-configuration) and seccomp confinement for native debugging and external connectivity. This is useful for:

* Hybrid development

  + Enables connecting ROS nodes external to the container
  + Applicable for debugging or visualizing distributed systems
  + Necessary for DDS discovery and shared memory transport
* Device connectivity

  + Enables hardware forwarding from host machine to container
  + Applicable for ROS package using sensors and actuators
  + Necessary for some GPU drivers and USB devices

Attention

Such `runArgs` in the `devcontainer.json` config can be enabled or customized, either expanded or narrowed in scope, to better suit your desired development environment. The default configuration merely comments out these parameters, to limit unintended side effects or cross talk between containers, but can be uncommented to accommodate the widest range of development use cases.

See also

More details on using DDS, debuggers, or devices with Docker containers can be found here:

* [How to Communicate Across Docker Containers Using the Host Driver](https://community.rti.com/kb/how-use-rti-connext-dds-communicate-across-docker-containers-using-host-driver)

  + Using the `host` network driver to access all network interfaces of the host machine from the Docker container
* [Communicate between two Docker containers using DDS and shared memory](https://community.rti.com/kb/communicate-between-two-docker-containers-using-rti-connext-dds-and-shared-memory)

  + Enabling containers to communicate with one another and with the host machine using interprocess communication (IPC)
* [Debugging programs running inside Docker containers, in production](https://nvartolomei.com/debugging-programs-running-inside-docker-containers--in-production/)

  + Using tools like strace, perf, gdb when debugging programs running inside containers

###### Using Dev Containers

Once the dev container has been created and setup completed, VS Code will open a new workspace directly from the project’s root directory, which itself is mounted within the source directory in the overlay colcon workspace. From here you can build, test, and debug the project as you normally would, with the added benefit of having the project’s dependencies, intellisense, linters, and other extensions pre-configured and ready to use. Simply open a new terminal (Crtl+Shift+`), cd to the root of the colcon workspace, and run the usual colcon commands.

Tip

You can incorporate the same scripts used by the `devcontainer.json` config file to further automate your local development workflow.

###### Terminals

If you prefer using an alternate terminal emulator, rather than the built-in VS Code terminal, you can open a separate shell session by simply using the Dev Container CLI or directly using the Docker CLI via the `exec` subcommands.

* [Dev Container CLI](https://code.visualstudio.com/docs/devcontainers/devcontainer-cli)

  + `devcontainer exec --workspace-folder $NAV2_WS/src/navigation2 bash`
* [docker exec](https://docs.docker.com/engine/reference/commandline/exec/)

  + `docker exec -it <container-id> bash`

Attention

Shell sessions spawned directly via `docker exec` do not set the same environment that `devcontainer exec` does using `userEnvProbe`. Additional environment variables include `REMOTE_CONTAINERS_IPC`, `REMOTE_CONTAINERS_SOCKETS` and are used by vscode, ssh and X11.

Hint

The environment provided by `userEnvProbe` can be sourced manually. E.g. for the default `loginInteractiveShell` probe:

```
find /tmp -type f -path "*/devcontainers-*/env-loginInteractiveShell.json" -exec \
  jq -r 'to_entries | .[] | "\(.key)=\(.value | @sh)"' {} \; > .env
source .env
```

###### Lifecycle

While using the dev container, try and keep in mind the lifecycle of the container itself. Specifically, containers are ephemeral, meaning they are normally destroyed and recreated whenever the dev environment is rebuilt or updated. Subsequently, a best practice is to avoid storing any persistent data within the container, and instead utilize the project’s source directory, or a separate mounted volume. When altering the development environment inside the container, try to remember to codify your changes into the Dockerfile, or the `devcontainer.json` config file, so that they can be easily reproduced and shared with others.

Important

This is particularly important when the host machine is inherently ephemeral as well, as the case may be when using cloud based environments such as Codespaces, so be sure to commit and push local changes to a remote repository:

* [The codespace lifecycle](https://docs.github.com/en/codespaces/getting-started/the-codespace-lifecycle)

  + Maintain your data throughout the entire codespace lifecycle

###### Rebuilding

From time to time, you may need to rebuild the dev container, either because the base image, or `.devcontainer/` config was updated, or simply out of wanting a new fresh development environment. To do so, simply open the Command Palette (Ctrl+Shift+P) and select the `Remote-Containers: Rebuild Container` command.

Caution

Rebuilding the container will destroy any changes made to the container itself, such as installing additional packages, or modifying the environment. However, the project’s source directory, and any mounted volumes, will remain unaffected.

For example, you may need to rebuild the dev container when:

* Pulling newer images from a container registry

  + specifically, image tags built `FROM` in the Dockerfile
  + or tags listed under `cacheFrom` in `devcontainer.json`
  + periodically done manually to ensure local environment reflects CI
* Updating the dev container configuration

  + specifically when modifying dependent stages in the `Dockerfile`
  + or when modifying `./devcontainer` files and commands
  + where build cache reuse correlates with severity of changes made

When necessary, you can also rebuild the container from scratch, e.i. without caching from docker, by selecting the `Remote-Containers: Rebuild Container Without Cache` command. This instead omits the `--cache-from` flag from the `docker buildx` command, while also adding the `--no-cache` and `--pull` flags to prevent caching from any existing image layers, using only the latest images from a container registry.

Caution

Rebuilding the container without cache may likely pull newer images from a container registry or install newer packages, as is common when developing for ROS 2 Rolling. You may then want to clean your overlay volume to avoid ABI incompatibilities or stale artifacts.

Rebuilding without caching may be necessary when:

* Needing to update the base image

  + specifically if dev container configurations remain unmodified
  + to forcefully rerun a `RUN` directive in the Dockerfile
  + such as unchanged `apt upgrade` or `rosdep update` commands

Specifically, for this project, volumes remain unaffected by this rebuilding process: i.e. those used to mount the ccache directory or colcon workspace. While volume management is left to the user’s discretion, other projects may of course handle this differently, so be sure to check the `./devcontainer` configuration to inspect how various container resources may be managed.

Tip

Docker volume management can be done via the Docker CLI, or the VS Code Docker extension:

* [Docker Volume CLI](https://docs.docker.com/engine/reference/commandline/volume)

  + Manage volumes using subcommands to create, inspect, list, remove, or prune volumes
* [VS Code Docker extension](https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-docker)

  + Makes it easy to create, manage, and debug containerized applications

---

#### Dev Containers

*Source: [https://docs.nav2.org/development_guides/devcontainer_docs/index.html](https://docs.nav2.org/development_guides/devcontainer_docs/index.html)*

##### Dev Containers

You can use dev containers to build the project if you prefer a streamlined setup experience. This means you can use the same tools and dependencies as the rest of the team, including our Continuous Integration (CI) workflows, without worrying about installing dependencies on your host machine. Additionally, using Dev Containers makes it simple to switch between local or remote development environments, such as GitHub Codespaces.

See also

More info on Dev Containers can be found here:

* [Development Containers](https://containers.dev/)

  + An open specification for enriching containers with development specific content and settings
* [Developing inside a Container](https://code.visualstudio.com/docs/remote/containers)

  + Learn how to use Visual Studio Code to develop inside a Docker container
* [GitHub Codespaces overview](https://docs.github.com/en/codespaces/overview)

  + A development environment hosted in the cloud

###### What, Why, How?

Lets briefly explain what dev containers are, why you should use them, and how they work.

Hint

Here we’ll assume the use of VS Code, but still applies to alternative tools and services, including other CLIs, IDEs, etc. such as:

* [Dev Container CLI](https://github.com/devcontainers/cli)

  + A reference implementation for the open specification
* [JetBrains Space | Develop in Dev Environment](https://www.jetbrains.com/help/space/develop-in-a-dev-environment.html)

  + Using Dev Containers with JetBrain based products
* [Supporting tools](https://containers.dev/supporting)

  + List of tools and services supporting the development container specification

###### What is a Dev Container?

A dev container is a Docker container that has all the tools and dependencies you need to develop the project. It runs in a self-contained environment and is isolated from other containers and your host machine. This lets you reliably develop for the project anywhere, notably for linux distributions targeted by ROS, regardless of your host machine’s operating system.

###### Why use a Dev Container?

A dev container provides a common and consistent development environment. It ensures that everyone on the team is using the same tools and dependencies. It also makes it easy to switch between projects because each project can use a different container. This is especially useful if you work on multiple projects that use different versions of the same tools and dependencies, such as different versions of ROS.

###### How do Dev Containers work?

When you open the project in VS Code, VS Code checks for the dev container configuration nested within the `.devcontainer` folder under the project’s root directory. If it finds one, it can prompt you to reopen the project in a container. If you choose to do so, it launches the container, connects to it, and mounts your project folder inside the container. You can then use VS Code in the container just as you would locally. While setting up the container, VS Code can also attempt to passthrough useful aspects of your local environment, such as git user configurations, X11 sockets, and more.

This is quite similar to earlier tools used to customize and run docker containers for development:

* [rocker | ROS + Docker](https://github.com/osrf/rocker)

  + A tool to run docker containers with overlays and convenient options for things like GUIs etc.
  + Developed by [Open Robotics](https://www.openrobotics.org/)
* [ADE Development Environment](https://ade-cli.readthedocs.io/en/latest/)

  + A modular Docker-based tool to ensure developers have a common, consistent development environment
  + Developed by [Apex.AI](https://www.apex.ai/)

###### Prerequisites

To use dev containers, you’ll need the following:

* [Docker Engine](https://docs.docker.com/engine/install/) installed and running on the host machine
* [Visual Studio Code](https://code.visualstudio.com/) installed on any remote machine
* [Dev Containers](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers) extension installed in VS Code

Note

Alternatively, you could use GitHub Codespaces directly from the project repo, or any other remote host machine:

* [Creating a codespace for a repository](https://docs.github.com/en/codespaces/developing-in-codespaces/creating-a-codespace-for-a-repository?tool=webui)

  + How to create a codespace for repository via GitHub CLI, VS Code, or Web browser
* [Develop on a remote Docker host](https://code.visualstudio.com/remote/advancedcontainers/develop-remote-host)

  + How to connect VS Code to a remote Docker host using SSH tunnels or TCP sockets

###### Getting started

Getting started using dev containers is as simple as opening the project in VS Code by either: following the notification prompt to reopen the project in a container, or explicitly opening the command palette (Crtl+Shift+P) and selecting `Remote-Containers: Reopen in Container`. This will create a new container, install any extensions specified in the project’s default `.devcontainer/devcontainer.json` config file, and mount the project’s root directory as the workspace folder. Once the container is created, VS Code will connect to it and you can start developing.

Tip

Clicking the `Starting Dev Container (show log)` notification in VS Code allows you to observe in live time how the sausage is made, while typing `Dev Containers: Show Log` into the command palette will list all the available commands to review and revisit these log files later.

While waiting for the initial setup, feel free to stretch your legs, grab a coffee, or continue to read the following guides to learn more about creating and using dev containers, or how to visualize and leverage graphical user interfaces from a headless development environment.

* **[Dev Container Guide](devcontainer_guide.html)**

  + How to develop Nav2 using dev containers and supporting tools

###### Security

Caution

Ensure you trust the authors and contents of workspaces before launching derived dev containers.

A word of caution when using dev containers: they are powerful tools, but can be a security concern, as the capability of arbitrary code execution facilitated by IDE extensions to enable such automation and convenience remains inherently dual use. Before launching a dev container, ensure you trust the workspaces and authors. For example, when reviewing a pull request, verify patches remain benign and do not introduce any malicious code. Although such vigilance is merited whenever compiling and running patched code, using containers with either elevated privileges or filesystem access renders this diligence even more prudent.

See also

More info on trusting workspaces and extensions in general can be found here:

* [Workspace Trust](https://code.visualstudio.com/docs/editor/workspace-trust)

  + VS Code user guid on trusting and configure workspaces

---

### Involvement Docs

#### Getting Involved

*Source: [https://docs.nav2.org/development_guides/involvement_docs/index.html](https://docs.nav2.org/development_guides/involvement_docs/index.html)*

##### Getting Involved

As an open-source project, we welcome and encourage the community to
submit patches directly to the Nav2. In our collaborative open
source environment, standards and methods for submitting changes help
reduce the chaos that can result from an active development community.

This document explains how to participate in project conversations, log
and track bugs and enhancement requests, and submit patches to the
project so your patch will be accepted quickly in the codebase.

###### Getting Involved

If you’re interested in getting involved in Navigation 2, first of all, welcome!
We encourage everyone to get involved from students, to junior developers, to senior developers, and executives.
There’s something to do for everyone from bug fixes, to feature development, new algorithms, and refactoring.

All ROS 2 TSC Working Groups have their meetings on the [working group calendar](https://calendar.google.com/calendar/embed?src=agf3kajirket8khktupm9go748%40group.calendar.google.com).
Here, you can find the date and time of the Navigation2 working group meeting. Make sure you’re checking in your local timezone.
From this calendar, you can add yourself to the event so it will appear on your google calendar and get the event link to the call through Google Hangouts.
We encourage everyone interested to come to the meeting to introduce yourself, your project, and see what everyone is working on.

Further, [ROS Discourse](https://discourse.ros.org/) is a good place to follow larger discussions happening in the community and announcements. This is **not** the correct place to post questions or ask for assistance. Please visit [ROS Answers](https://answers.ros.org/) for Q&A.

Lastly, we have a [Community Slack](https://join.slack.com/t/navigation2/shared_invite/zt-uj428p0x-jKx8U7OzK1IOWp5TnDS2rA) where we chat in real-time about topics in public channels or sidebar maintainers on individual projects via PMs. If you’re interested in contributing to Nav2, this is a great place to join!

If you’re looking to contribute code or bugs, please see the Process section below.

Over time, for developers that have an interest and have shown technical competence in an area of the stack, we elevate developers to a maintainers status.
That allows push rights to our protected branches, first-reviewers rights, and getting your name on [About and Contact](../../about/index.html#about).
There currently is not a clear process for getting to be a maintainer, but if you’ve been involved and contributing over a duration of several months, you may be a good candidate and should email the project lead listed on [About and Contact](../../about/index.html#about).

###### Process

After you’ve introduced yourself in a working group meeting (recommended, not required), you’re ready to get started!
We recommend a typical open-source project flow and value detail and transparency.
If you commit to something and need to pull back, say so.
We all know priorities change and appreciate the heads up so that task can go into the open queue of tasks.

The process is simple and is as follow:

1. Create a ticket for any issues or features you’d like to see. You are not required to fix / implement patches required, but it would be helpful. Reporting bugs is also a valuable contribution.
2. If this ticket, or another existing ticket, is something you would like to work on, comment in the ticket claiming ownership over it. It would be helpful at this time if you declared a strategy and a timeline for planning purposes of other folks working around you. Over time, update the ticket with progress of key markers and engage in any constructive feedback maintainers or other users may have.
3. Once you’ve completed the task you set out to complete, submit a PR! Please fill out the PR template in complete to ensure that we have a full understanding of your work. At that point, 1-2 reviewers will take a look at your work and give it some feedback to be merged into the codebase. For trivial changes, a single maintainer may merge it after review if they’re happy with it, up to their discretion. Any substantial changes should be approved by at least 1 maintainer and 1 other community member.

Note: We take code quality seriously and strive for high-quality and consistent code.
We make use of the linting and static analysis tools provided in ROS 2 (`ament_cpplint`, `ament_uncrustify`, `ament_cppcheck`, etc).
All PRs are built in CI with the appropriate ROS distributions and run through a set of unit and system level tests including static analysis.
You can see the results of these tests in the pull request.
It is expected for feature development for tests to cover this work to be added.
If any documentation must be updated due to your changes, that should be included in your pull request.

###### Licensing

Licensing is very important to open source projects. It helps ensure the
software continues to be available under the terms that the author
desired.

Because much of the source code is ported from other ROS 1 projects, each
package has it’s own license. Contributions should be made under the predominant
license of that package. Entirely new packages should be made available under
the [Apache 2.0 license](https://www.apache.org/licenses/LICENSE-2.0).

A license tells you what rights you have as a developer, as provided by
the copyright holder. It is important that the contributor fully
understands the licensing rights and agrees to them. Sometimes the
copyright holder isn’t the contributor, such as when the contributor is
doing work on behalf of a company.

If for some reason Apache 2.0 or BSD licenses are not appropriate for your work, please get in contact with a project maintainer and discuss your concerns or requirements.
We may consider special exceptions for exceptional work, within reason (we will not accept any licenses that makes it unsuitable for commercial use).

###### Developer Certification of Origin (DCO)

To make a good faith effort to ensure licensing criteria are met,
Nav2 encourages the Developer Certificate of Origin (DCO) process
to be followed.

The DCO is an attestation attached to every contribution made by a
developer. In the commit message of the contribution, (described more
fully later in this document), the developer simply adds a
`Signed-off-by` statement and thereby agrees to the DCO.

In practice, its easier to just `git commit -s -m "commit message."`.
Where `-s` adds this automatically.
If you forgot to add this to a commit, it is easy to append via: `git commit --amend -s`.

When a developer submits a patch, it is a commitment that the
contributor has the right to submit the patch per the license. The DCO
agreement is shown below and at <http://developercertificate.org/>.

```
Developer's Certificate of Origin 1.1

By making a contribution to this project, I certify that:

(a) The contribution was created in whole or in part by me and I
    have the right to submit it under the open source license
    indicated in the file; or

(b) The contribution is based upon previous work that, to the
    best of my knowledge, is covered under an appropriate open
    source license and I have the right under that license to
    submit that work with modifications, whether created in whole
    or in part by me, under the same open source license (unless
    I am permitted to submit under a different license), as
    Indicated in the file; or

(c) The contribution was provided directly to me by some other
    person who certified (a), (b) or (c) and I have not modified
    it.

(d) I understand and agree that this project and the contribution
    are public and that a record of the contribution (including
    all personal information I submit with it, including my
    sign-off) is maintained indefinitely and may be redistributed
    consistent with this project or the open source license(s)
    involved.
```

---

## Getting Started

### Getting Started

*Source: [https://docs.nav2.org/getting_started/index.html](https://docs.nav2.org/getting_started/index.html)*

#### Getting Started

This document will take you through the process of installing the Nav2 binaries
and navigating a simulated Turtlebot 3 in the Gazebo simulator.

Note

See the [Build and Install](../development_guides/build_docs/index.html#build-instructions) for other situations such as building from source or
working with other types of robots.

Warning

This is a simplified version of the Turtlebot 3 instructions. We highly
recommend you follow the [official Turtlebot 3 manual](https://emanual.robotis.com/docs/en/platform/turtlebot3/quick-start/) if you intend to
continue working with this robot beyond the minimal example provided here.

##### Installation

Jazzy introduced the new Gazebo modern simulator, replacing Gazebo Classic.
Thus, for Jazzy and newer, the installation packages and instructions are slightly different to pull in the appropriate packages.

1. Install the [ROS 2 binary packages](https://docs.ros.org/en/rolling/Installation/Ubuntu-Install-Debians.html) as described in the official docs
2. Install the Nav2 packages using your operating system’s package manager:

   ```
   sudo apt install ros-<ros2-distro>-navigation2
   sudo apt install ros-<ros2-distro>-nav2-bringup
   ```
3. Install the demo robot (Turtlebot) for gazebo:

For **Jazzy and newer**, install the Turtlebot 3 & 4 packages for Gazebo Modern. It should be automatically installed with `nav2_bringup`:

> ```
> sudo apt install ros-<ros2-distro>-nav2-minimal-tb*
> ```

For **Iron and older**, install Turtlebot 3 packages for gazebo classic:

> ```
> sudo apt install ros-<ros2-distro>-turtlebot3-gazebo
> ```

##### Running the Example

1. Start a terminal in your GUI
2. Set key environment variables, some of which are only required for Iron and older:

   ```
   source /opt/ros/<ros2-distro>/setup.bash
   export TURTLEBOT3_MODEL=waffle  # Iron and older only with Gazebo Classic
   export GAZEBO_MODEL_PATH=$GAZEBO_MODEL_PATH:/opt/ros/<ros2-distro>/share/turtlebot3_gazebo/models # Iron and older only with Gazebo Classic
   ```
3. In the same terminal, run:

   ```
   ros2 launch nav2_bringup tb3_simulation_launch.py headless:=False
   ```

   Note

   `headless` defaults to true; if not set to false, gzclient (the 3d view) is not started.

   This launch file will launch Nav2 with the AMCL localizer in the
   simulation world.
   It will also launch the robot state publisher to provide transforms,
   a Gazebo instance with the Turtlebot3 URDF, and RVIZ.

   If everything has started correctly, you will see the RViz and Gazebo GUIs like
   this (this is Gazebo Classic, but what you see with modern Gazebo is virtually identical):

   [![../_images/rviz-not-started.png](../_images/rviz-not-started.png)](../_images/rviz-not-started.png)
   [![../_images/gazebo_turtlebot1.png](../_images/gazebo_turtlebot1.png)](../_images/gazebo_turtlebot1.png)
4. If not autostarting, click the “Startup” button in the bottom left corner of RViz.
   This will cause Nav2 to change to the Active state. It should
   change appearance to show the map.

   [![Initial appearance of RViz transitioning to the Active state](../_images/rviz_initial.png)](../_images/rviz_initial.png)

##### Navigating

After starting, the robot initially has no idea where it is. By default,
Nav2 waits for you to give it an approximate starting position. Take a look
at where the robot is in the Gazebo world, and find that spot on the map. Set
the initial pose by clicking the “2D Pose Estimate” button in RViz, and then
down clicking on the map in that location. You set the orientation by dragging
forward from the down click.

If you are using the defaults so far, the robot should look roughly like this.

> [![Approximate starting location of Turtlebot](../_images/rviz-set-initial-pose.png)](../_images/rviz-set-initial-pose.png)

If you don’t get the location exactly right, that’s fine. Nav2 will refine
the position as it navigates. You can also, click the “2D Pose
Estimate” button and try again, if you prefer.

Once you’ve set the initial pose, the transform tree will be complete and
Nav2 will be fully active and ready to go. You should see the robot and particle
cloud now.

> [![|PN| is ready. Transforms and Costmap show in RViz.](../_images/navstack-ready.png)](../_images/navstack-ready.png)

Next, click the “Navigaton2 Goal” button and choose a destination.
This will call the BT navigator to go to that goal through an action server.
You can pause (cancel) or reset the action through the Nav2 rviz plugin shown.

> [![Setting the goal pose in RViz.](../_images/navigate-to-pose.png)](../_images/navigate-to-pose.png)

Now watch the robot go!

[![Navigation2 with Turtlebot 3 Demo](../_images/navigation_with_recovery_behaviours.gif)](../_images/navigation_with_recovery_behaviours.gif)

---

## Maintainer Docs

### Maintainer Docs

*Source: [https://docs.nav2.org/maintainer_docs/index.html](https://docs.nav2.org/maintainer_docs/index.html)*

#### Maintainer Docs

This page is a set of maintainer procedures and documentation used for maintenance of Nav2.
These are published publicly for visibility and as a resource for the maintainer community.

* [ROS Distribution Release Process](distribution_release.html)
* [ROS Distribution Sync Process](distribution_syncs.html)

---

### ROS Distribution Release Process

*Source: [https://docs.nav2.org/maintainer_docs/distribution_release.html](https://docs.nav2.org/maintainer_docs/distribution_release.html)*

#### ROS Distribution Release Process

This is the instructions for releasing a new Nav2 version for a ROS distribution release.

Note

We require `osrf/ros:<distro>-desktop-full` images to exist for a distribution before this process may be completed.
This usually means we wait until the release date to perform Nav2’s release and have it included in the first distribution sync.

##### 0. Initial Freeze

Look at the ROS 2 timeline for release and decide on a date to freeze Nav2 new contributions.
Mark any open tickets and/or pull requests with a new tag `<distro>-release` that we want to get in before the branch off.
These are the actions items to focus on before the chosen release date which would block release on time.

These tickets or pull requests should represent major features, meaningful bug fixes, or ABI/API breaking changes that are necessary to be included before the branch off so that those feature(s) or API change(s) are represented in the new distribution.

##### 1. Local Functional Testing

Once pre-release images are available on [ros\_oci\_images](https://github.com/sloretz/ros_oci_images), locally pull this docker image
In a workspace root containing Nav2 and `nav2_minimal_turtlebot_simulations`, run the following:

```
sudo docker pull ghcr.io/sloretz/ros-testing:<distro>-desktop-full

sudo docker run -it --net=host --privileged -v .:/root/jazzy_ws --volume="${XAUTHORITY}:/root/.Xauthority" --env="DISPLAY=$DISPLAY" -v="/tmp/.gazebo/:/root/.gazebo/" -v /tmp/.X11-unix:/tmp/.X11-unix:rw --shm-size=1000mb ghcr.io/sloretz/ros-testing:<distro>-desktop-full

apt update
apt upgrade

source /opt/ros/<distro>/setup.bash
rosdep init
rosdep update

colcon build --parallel-workers 1
colcon test --parallel-workers 1
```

This will obtain the testing docker image from `ros_oci_images`, open a container, and make sure the system can build and pass unit and system-level testing.

Next, run each major Nav2 launch file and navigate the robot around.

* `ros2 launch nav2_bringup tb3_simulation_launch.py`
* `ros2 launch nav2_bringup tb4_simulation_launch.py`
* `ros2 launch nav2_bringup tb3_loopback_sim_launch.py`
* `ros2 launch nav2_bringup tb4_loopback_sim_launch.py`

Ensure that you see all the data, costmap, footprint, path planning, control and other topics visible.
Send Navigate To Pose, Navigate Through Poses goals and cancel goals periodically.
Shutdown the Nav2 lifecycle nodes, hit Control+C, and ensure the stack shuts down cleanly.

This step may be performed early to catch and resolve issues before the release process.
Once all testing passes, move onto the next steps.

##### 2. Setup Nav2 Docker Images

Next, we need to setup Nav2’s Nightly and Release docker image jobs in [nav2\_docker](https://github.com/ros-navigation/nav2_docker).

Update `.github/workflows/build_images.yaml` to contain the new distribution in the `ros_distro` matrix.
Remove any EOL distributions at this time.
Within the `strategy.matrix.version` map, please a new entry for the distribution being added.
The `main_version` is `1` unless a new major version is set in Nav2’s `package.xml` files.
The `distro_version` should be bumped by one from the last distribution representing the release in the format `1.4.X`.
Remove any EOL distributions at this time.

Open the `README.md` and update the distributions to include this.

At this time, the build should fail because there is no `distro` branch on Nav2, which is our next step.

##### 2. Branch Off Distribution

Now, we will setup the new branch and its CI system.

First, update `.github/workflows/build_main_against_distros.yml` by adding the new `ros_distro` to the matrix.
While the `nav2_docker` nightly image does not yet exist, it will by the end of this step.
Remove any EOL distributions at this time.

Next, bump the `main` branch’s distribution number to the same set in Step 2 above (i.e. `1.4.0`).
Add the distribution branch to `.github/workflows/update_ci_image.yaml` so that future pushes will result in CI image updates.
Remove any EOL distributions at this time.

Finally, create the new distribution branch from `main` and push to the server.
Go into the GitHub Actions tab on `nav2_docker` and retrigger its build job.
The nightly and release jobs should now exist for the new distribution and return successfully (validate this).

##### 3. Mark Branch as Protected

Go to the Repo Settings -> Branches. Create a branch protection rule for the new branch that matches the last.

* Request a PR before merging -> Require approvals & override for infra-admins.
* Restrict who can push branches that match this rule.

##### 4. Setup Branch CI

The final change to the branch is to setup CI so PRs targeting it can be successfully built.
In the new distribution branch, update the files for CI ([Humble Example](https://github.com/ros-navigation/navigation2/commit/4eb4ee01967a3b881c05d962ffd856c668b2e4c0)).

* Update `.circleci/config.yml` to use the new distribution image (replace `ghcr.io/ros-navigation/navigation2:main`).
* Update `.devcontainer/devcontainer.json` to `cacheFrom` the new distribution image (replace `ghcr.io/ros-navigation/navigation2:main`).
* Update `Dockerfile` to use the new distribution’s image rather than `rolling`.
* Update `tools/distro.Dockerfile` to use the new distribution’s image rather than `rolling` in 3x places.

Then, retrigger the Update CI Image workflow in Nav2’s GitHub Actions tab, it should now also be successful.
Open a dummy PR against the new distribution branch and ensure that it builds successfully.

##### 5. Update Auxiliary Projects

Nav2 has a number of auxiliary projects that also need to be updated for a new distribution.
These include:

* `nav2_minimal_turtlebot_simulation`
* `navigation2_tutorials`

For each:

* Update the package.xml for a new distribution version
* Create a new branch from `main` for the distribution
* Update CI on the new branch to use this new distribution image
* Review and update the readme as needed

##### 6. Run Bloom Release

Once the new branches, versions, and CI are setup and ready, we can run the bloom release process.
Run the following command to create a new release for the distribution for each Nav2 repository (Nav2, Minimal Turtlebot Simulation, SLAM Toolbox, NPVL, STVL etc).

```
bloom-release navigation2 --rosdistro distro --track distro --new-track --edit
```

Be patient, this will take a while to run.

##### 7. Nav2 Docker Build

To allow the `nav2_docker` build of the released version in Step 5, we need to enable the first build to pass the latest tag check in the workflow.
You should see that the nightly of this distribution works, but the release version is failing with `Error: No matching package versions found.`.
To resolve, comment out the `exit 1` in the `latest_version` validity check.
Once the job turns over, revert this commit to reintroduce the error.

##### 8. Announcements

Finally, we can announce the updates!
Create a new migration guide page on the Nav2 website for contributors to populate with notable changes in the next distribution cycle.
Update the Roadmap page with a new table of projects and features to be added over the next distribution.

Make announcements on Slack, ROS Discourse, and LinkedIn to announce the new distribution and its major new features.
Gifs, videos, and images are always welcome to be included in the announcements!

Identify tickets to address or PRs to merge for the next distribution.
Make a call for contributions on the roadmap items, these strategic items, or other `good-first-issues`.

---

### ROS Distribution Sync Process

*Source: [https://docs.nav2.org/maintainer_docs/distribution_syncs.html](https://docs.nav2.org/maintainer_docs/distribution_syncs.html)*

#### ROS Distribution Sync Process

This is the instructions for updating a Nav2 version in a ROS distribution sync.
We do this by bulk cherry picking commits from the `main` branch after they’ve had time to soak and apply them to the branch we looking to sync with the newest features.

##### 0. Initial Setup

First we need to create a temporary workspace to perform the sync.
Typically, this is done in the `/tmp` directory so that it is cleaned up after a reboot.

```
mkdir -p /tmp/sync_ws/src
cd /tmp/sync_ws/src
git clone https://github.com/ros-navigation/navigation2.git -b <distro>
cd navigation2
git checkout -b sync_<distro>
```

Then, we want to get a list of all of the commits we may be interested in backporting.
This can be found either in the git logs of the `main` branch or using the GitHub UX at <https://github.com/ros-navigation/navigation2/commits/> and select the branch you are interested in.
If using GitHub, open two tabs - one for `main` and one for `<distro>`.

Finally, we need to identify the date of the last sync.
This can be found looking in the commit messages for `<distro>`’s branch or by looking at the release page for Nav2 and finding the date of the last release for that distribution.
Scroll back in the `main` and `<distro>` git logs to find the last sync commit to begin.

Once you have a local clone, the git logs, and the date of the last sync, we can begin the process.

##### 1. Backporting Process

Starting with the first commit in `main` after the last sync date, we will look at each commit individually.
Each commit should be evaluated for the following criteria:

* Cannot change default out-of-the-box behavior or existing configured robot behavior
* Cannot change major end-user ABI/API
* Cannot change message, action, or service definitions
* Cannot include risky changes that need more time to soak, such as for complete package rewrites or experimental features

If it does not do any of the above, it is a candidate for backporting.
It can be backported via the following command in your local branch:

```
git cherry-pick <commit_hash>
```

If this merges without issue, you may proceed.
If not, we either must resolve the conflicts or roll back the commit.
We may need to roll it back if the merge conflict is too complex or it relies on a cascading chain of other commits that could not be included due to their dependency on commits that were unable to be backported.

Note

Some commits may already have been backported by Mergify.
Use the git logs for the `<distro>` branch to check if the commit has already been backported.
If it has been, it can be skipped.

Once all commits to the present are evaluated, we can proceed to the next step.

##### 2. Testing

Before we can merge our changes, we need to ensure that everything is working correctly.
This involves compiling the code, running any unit tests, and performing functional testing.
Navigate back to the root of the workspace and build the code:

```
cd ../../
colcon build
source install/setup.bash
```

After building, we can run the tests:

```
colcon test
```

If all tests pass, we can launch the Nav2 bringup demos and navigate the TB3 and TB4 robots in both Gazebo and the loopback simulator for 10-15 minutes to validate functional stability of the backport.

##### 3. Open a PR

Once we have validated the changes, we can open a pull request (PR) against the `<distro>` branch.
Increment the package.xml versions for all packages using search and replace to increment one minor version (i.e. 1.1.X).
Open a PR with the title `<Branch> Sync: <Date>` and include a description of the changes made.
Let CI run and merge once passes for a second independent validation of compilation and testing.

##### 4. Bloom Release

Once the PR is merged, we can release the changes to the distribution.
Create a release of the same version as the `package.xml` files targeting the `<distro>` branch.
Then, follow [Steve’s Bloom Release Guide](https://gist.github.com/SteveMacenski/1c321d1c9edca096ae4d763d8327c2ee) to perform the bloom release.

---

## Migration

### Dashing to Eloquent

*Source: [https://docs.nav2.org/migration/Dashing.html](https://docs.nav2.org/migration/Dashing.html)*

#### Dashing to Eloquent

Moving from ROS 2 Dashing to Eloquent, a number of stability improvements were added that we will not specifically address here.

##### New Packages

Navigation2 now includes a new package `nav2_waypoint_follower`.
The waypoint follower is an action server that will take in a list of waypoints to follow and follow them in order.
There is a parameter `stop_on_failure` whether the robot should continue to the next waypoint on a single waypoint failure,
or to return fail to the action client.
The waypoint follower is also a reference application for how to use the Navigation2 action server to complete a basic autonomy task.

Navigation2 now supports new algorithms for control and SLAM.
The Timed-Elastic Band (TEB) controller was implemented [and can be found here](https://github.com/rst-tu-dortmund/teb_local_planner).
It is its own controller plugin that can be used instead of the DWB controller.
Nav2 also supports SLAM Toolbox as the default SLAM implementation for ROS 2.
This replaces the use of Cartographer.

##### New Plugins

Eloquent introduces back in pluginlib plugins to the navigation stack.
`nav2_core` defines the plugin header interfaces to be used to implement controller, planner, recovery, and goal checker plugins.
All algorithms (NavFn, DWB, recoveries) were added as plugin interfaces and the general packages for servers were created.
`nav2_planner` is the action server for planning that hosts a plugin for the planner.
`nav2_controller` is the action server for controller that hosts a plugin for the controller.
`nav2_recovery` is the action server for recovery that hosts a plugin for recovery.

New recovery plugins were added including backup, which will take in a distance to back up, if collision-free.
Additionally, the wait recovery was added that will wait a configurable period of time before trying to navigate again.
This plugin is especially helpful for time-dependent obstacles or pausing navigation for a scene to become less dynamic.

Many new behavior tree nodes were added. These behavior tree nodes are hard-coded in the behavior tree engine.
Behavior tree cpp v3 supports plugins and will be converted in the next release.

##### Navigation2 Architectural Changes

The `nav2_world_model` package was removed. The individual `nav2_planner` and `nav2_controller` servers now host their relevant costmaps.
This was done to reduce network traffic and ensure up-to-date information for the safety-critical elements of the system.
As above mentions, plugins were introduced into the stack and these servers each host plugins for navigation, control, and costmap layers.

Map server was substantially refactored but the external API remains the same. It now uses the SDL library for image loading.

TF-based positioning is now used for pose-estimation everywhere in the stack.
Prior, some elements of the navigation stack only updated its pose from the `/amcl_pose` topic publishing at an irregular rate.
This is obviously low-accuracy and high-latency.
All positioning is now based on the TF tree from the global frame to the robot frame.

Prior to Eloquent, there were no ROS 2 action servers and clients available.
Navigation2, rather, used an interface we called Tasks.
Eloquent now contains actions and a simple action server interface was created and is used now throughout the stack.
Tasks were removed.

---

### Eloquent to Foxy

*Source: [https://docs.nav2.org/migration/Eloquent.html](https://docs.nav2.org/migration/Eloquent.html)*

#### Eloquent to Foxy

Moving from ROS 2 Eloquent to Foxy, a number of stability improvements were added that we will not specifically address here.
We will specifically mention, however, the reduction in terminal noise.
TF2 transformation timeout errors and warnings on startup have been largely removed or throttled to be more tractable.
Additionally, message filters filling up resulting in messages being dropped were resolved in costmap 2d.

##### General

The lifecycle manager was split into 2 unique lifecycle managers.
They are the `navigation_lifecycle_manager` and `localization_lifecycle_manager`.
This gives each process their own manager to allow users to switch between SLAM and localization without effecting Navigation.
It also reduces the redundant code in `nav2_bringup`.

The lifecycle manager also now contains `Bond` connections to each lifecycle server.
This means that if a server crashes or exits, the lifecycle manager will be constantly checking and transition down its lifecycle nodes for safety.
This acts as a watchdog during run-time to complement the lifecycle manager’s transitioning up and down from active states. See [this PR for details](https://github.com/ros-navigation/navigation2/pull/1894).

A fix to the BT navigator was added to remove a rare issue where it may crash due to asynchronous issues.
As a result, a behavior tree is created for each navigation request rather than resetting an existing tree.
The creation of this tree will add a small amount of latency.
Proposals to reduce this latency will be considered before the next release.

##### Server Updates

All plugin servers (controller, planner, recovery) now supports the use of multiple plugins.
This can be done by loading a map of plugins, mapping the name of the plugin to its intended use-case.
Each server defines a parameter where the list of names for the plugins to be loaded can be defined.

| Server Name | Plugin Parameter |
| --- | --- |
| Controller Server | progress\_checker\_plugin |
| Controller Server | goal\_checker\_plugin |
| Controller Server | controller\_plugins |
| Planner Server | planner\_plugins |
| Recovery Server | recovery\_plugins |
| Costmap Node | plugins |

The type of plugin to be mapped to a particular name has to be defined using the `plugin` parameter in the plugin namespace for each name defined in the server plugin list.
Each name in the plugin parameter list is expected to have the `plugin` parameter defined.

An example: `controller_server` defines the parameter `controller_plugins` where a list of plugin names can be defined:

```
controller_server:
  ros__parameters:
    controller_plugins: ["FollowPath", "DynamicFollowPath"]
    FollowPath:
      plugin: "dwb_core/DWBLocalPlanner"
      max_vel_x: 0.26
    DynamicFollowPath:
      plugin: "teb_local_planner/TEBLocalPlanner"
      max_vel_x: 0.5
```

`FollowPath` controller is of type `dwb_local_planner/DWBLocalPlanner` and `DynamicFollowPath` of type `teb_local_planner/TEBLocalPlanner`.
Each plugin will load the parameters in their namespace, e.g. `FollowPath.max_vel_x`, rather than globally in the server namespace.
This will allow multiple plugins of the same type with different parameters and reduce conflicting parameter names.

DWB Contains new parameters as an update relative to the ROS 1 updates, [see here for more information](https://github.com/ros-navigation/navigation2/pull/1501).
Additionally, the controller and planner interfaces were updated to include a `std::string name` parameter on initialization.
This was added to the interfaces to allow the plugins to know the namespace it should load its parameters in.
E.g. for a controller to find the parameter `FollowPath.max_vel_x`, it must be given its name, `FollowPath` to get this parameter.
All plugins will be expected to look up parameters in the namespace of its given name.

##### New Plugins

Many new behavior tree nodes were added.
These behavior tree nodes are now BT plugins and dynamically loadable at run-time using behavior tree cpp v3.
The default behavior trees have been upgraded to stop the recovery behaviours and trigger a replanning when the navigation goal is preempted.
See `nav2_behavior_tree` for a full listing, or [Navigation Plugins](../plugins/index.html#plugins) for the current list of behavior tree plugins and their descriptions.
These plugins are set as default in the `nav2_bt_navigator` but may be overridden by the `bt_plugins` parameter to include your specific plugins.

Original GitHub tickets:

* [DistanceController](https://github.com/ros-navigation/navigation2/pull/1699)
* [SpeedController](https://github.com/ros-navigation/navigation2/pull/1744)
* [GoalUpdatedCondition](https://github.com/ros-navigation/navigation2/pull/1712)
* [DistanceTraveledCondition](https://github.com/ros-navigation/navigation2/pull/1705)
* [TimeExpiredCondition](https://github.com/ros-navigation/navigation2/pull/1705)
* [UpdateGoal](https://github.com/ros-navigation/navigation2/pull/1859)
* [TruncatePath](https://github.com/ros-navigation/navigation2/pull/1859)
* [IsBatteryLowCondition](https://github.com/ros-navigation/navigation2/pull/1974)
* [ProgressChecker](https://github.com/ros-navigation/navigation2/pull/1857)
* [GoalChecker](https://github.com/ros-navigation/navigation2/pull/1857)

##### Map Server Re-Work

`map_saver` was re-worked and divided into 2 parts: CLI and server.
CLI part is a command-line tool that listens incoming map topic, saves map once into a file and finishes its work. This part is remained to be almost untouched: CLI executable was renamed from `map_saver` to `map_saver_cli` without changing its functionality.
Server is a new part. It spins in the background and can be used to save map continuously through a `save_map` service. By each service request it tries to listen incoming map topic, receive a message from it and write obtained map into a file.

`map_server` was dramatically simplified and cleaned-up. `OccGridLoader` was merged with `MapServer` class as it is intended to work only with one `OccupancyGrid` type of messages in foreseeable future.

Map Server now has new `map_io` dynamic library. All functions saving/loading `OccupancyGrid` messages were moved from `map_server` and `map_saver` here. These functions could be easily called from any part of external ROS 2 code even if Map Server node was not started.

`map_loader` was completely removed from `nav2_util`. All its functionality already present in `map_io`. Please use it in your code instead.

Please refer to the [original GitHub ticket](https://github.com/ros-navigation/navigation2/issues/1010) and [Map Server README](https://github.com/ros-navigation/navigation2/blob/main/nav2_map_server/README.md) for more information.

##### New Particle Filter Messages

New particle filter messages for particle clouds were added to include the particle weights along with their poses.
`nav2_msgs/Particle` defines a single particle with a pose and a weight in a particle cloud.
`nav2_msgs/ParticleCloud` defines a set of particles, each with a pose and a weight.

`AMCL` now publishes its particle cloud as a `nav2_msgs/ParticleCloud` instead of a `geometry_msgs/PoseArray`.

[See here for more information.](https://github.com/ros-navigation/navigation2/pull/1677)

##### Selection of Behavior Tree in each navigation action

The `NavigateToPose` action allows now to select in the action request the behavior tree to be used by `bt_navigator` for carrying out the navigation action through the `string behavior_tree` field. This field indicates the absolute path of the xml file that will be used to use to carry out the action. If no file is specified, leaving this field empty, the default behavior tree specified in the `default_bt_xml_filename parameter` will be used.

This functionality has been discussed in [the ticket #1780](https://github.com/ros-navigation/navigation2/issues/1780), and carried out in [the pull request #1784](https://github.com/ros-navigation/navigation2/pull/1784).

##### FollowPoint Capability

A new behavior tree `followpoint.xml` has added. This behavior tree makes a robot follow a dynamically generated point, keeping a certain distance from the target. This can be used for moving target following maneuvers.

This functionality has been discussed in [the ticket #1660](https://github.com/ros-navigation/navigation2/issues/1660), and carried out in [the pull request #1859](https://github.com/ros-navigation/navigation2/issues/1859).

##### New Costmap Layer

The range sensor costmap has not been ported to navigation2 as `nav2_costmap_2d::RangeSensorLayer"`. It uses the same
probabilistic model as the [ROS1](http://wiki.ros.org/range_sensor_layer) layer as well as much of the
same interface. Documentation on parameters has been added to docs/parameters and the docs.nav2.org under `Configuration Guide`.

#### Parameters

**`progress_checker_plugin`**
- Type: `unknown`
- 

**`goal_checker_plugin`**
- Type: `unknown`
- 

**`controller_plugins`**
- Type: `unknown`
- 

**`planner_plugins`**
- Type: `unknown`
- 

**`recovery_plugins`**
- Type: `unknown`
- 

**`plugins`**
- Type: `unknown`
- 


---

### Foxy to Galactic

*Source: [https://docs.nav2.org/migration/Foxy.html](https://docs.nav2.org/migration/Foxy.html)*

#### Foxy to Galactic

Moving from ROS 2 Foxy to Galactic, a number of stability improvements were added that we will not specifically address here.

##### NavigateToPose Action Feedback updates

The NavigateToPose action feedback has two improvements:

* `distance_remaining` now integrates path poses to report accurate distance remaining to go. Previously, this field reported the euclidean distance between the current pose and the goal pose.
* Addition of `estimated_time_remaining` field. This field reports the estimated time remaining by dividing the remaining distance by the current speed.

##### NavigateToPose BT-node Interface Changes

The NavigateToPose input port has been changed to PoseStamped instead of Point and Quaternion.

See [NavigateToPose](../configuration/packages/bt-plugins/actions/NavigateToPose.html#bt-navigate-to-pose-action) for more information.

##### NavigateThroughPoses and ComputePathThroughPoses Actions Added

The `NavigateThroughPoses` action has been added analog to the `NavigateToPose`. Rather than going to a single position, this Action will allow a user to specify a number of hard intermediary pose constraints between the start and final pose to plan through. The new `ComputePathThroughPoses` action has been added to the `planner_server` to process these requests through `N goal_poses`.

The `ComputePathThroughPoses` action server will take in a set of `N` goals to achieve, plan through each pose and concatenate the output path for use in navigation. The controller and navigator know nothing about the semantics of the generated path, so the robot will not stop or slow on approach to these goals. It will rather continue through each pose as it were any other point on the path continuously. When paired with the `SmacPlanner`, this feature can be used to generate **completely kinematically feasible trajectories through pose constraints**.

If you wish to stop at each goal pose, consider using the waypoint follower instead, which will stop and allow a user to optionally execute a task plugin at each pose.

##### ComputePathToPose BT-node Interface Changes

The `start` input port has been added to optionally allow the request of a path from `start` to `goal` instead of from the current position of the robot to `goal`.

See [ComputePathToPose](../configuration/packages/bt-plugins/actions/ComputePathToPose.html#bt-compute-path-to-pose-action) for more information.

##### ComputePathToPose Action Interface Changes

* The goal pose field `pose` was changed to `goal`.
* The PoseStamped field `start` has been added.
* The bool field `use_start` has been added.

These two additional fields have been added to optionally allow, when `use_start` is true, the request of a path from `start` to `goal` instead of from the current position of the robot to `goal`. Corresponding changes have been done of the Planner Server.

##### BackUp BT-node Interface Changes

The `backup_dist` and `backup_speed` input ports should both be positive values indicating the distance to go backward respectively the speed with which the robot drives backward.

##### BackUp Recovery Interface Changes

`speed` in a backup recovery goal should be positive indicating the speed with which to drive backward.
`target.x` in a backup recovery goal should be positive indicating the distance to drive backward.
In both cases negative values are silently inverted.

##### Nav2 Controllers and Goal Checker Plugin Interface Changes

As of [this PR 2247](https://github.com/ros-navigation/navigation2/pull/2247), the `controller` plugins will now be given a pointer to the current goal checker in use of the navigation task in `computeAndPublishVelocity()`. This is geared to enabling controllers to have access to predictive checks for goal completion as well as access to the state information of the goal checker plugin.

The `goal_checker` plugins also have the change of including a `getTolerances()` method. This method allows a goal checker holder to access the tolerance information of the goal checker to consider at the goal. Each field of the `pose` and `velocity` represents the maximum allowable error in each dimension for a goal to be considered completed. In the case of a translational tolerance (combined X and Y components), each the X and Y will be populated with the tolerance value because it is the **maximum** tolerance in the dimension (assuming the other has no error). If the goal checker does not contain any tolerances for a dimension, the `numeric_limits<double> lowest()` value is utilized in its place.

##### FollowPath goal\_checker\_id attribute

For example: you could use for some specific navigation motion a more precise goal checker than the default one that it is used in usual motions.

```
<FollowPath path="{path}" controller_id="FollowPath" goal_checker_id="precise_goal_checker" server_name="FollowPath" server_timeout="10"/>
```

* The previous usage of the `goal_checker_plugin` parameter to declare the controller\_server goal\_checker is now obsolete and removed.
* The controller\_server parameters now support the declaration of a list of goal checkers `goal_checker_plugins` mapped to unique identifier names, such as is the case with `FollowPath` and `GridBased` for the controller and planner plugins, respectively.
* The specification of the selected goal checker is mandatory when more than one checker is defined in the controller\_server parameter configuration. If only one goal\_checker is configured in the controller\_server it is selected by default even if no goal\_checker is specified.

Below it is shown an example of goal\_checker configuration of the controller\_server node.

```
controller_server:
  ros__parameters:
      goal_checker_plugins: ["general_goal_checker", "precise_goal_checker"]
      precise_goal_checker:
          plugin: "nav2_controller::SimpleGoalChecker"
          xy_goal_tolerance: 0.25
         yaw_goal_tolerance: 0.25
      general_goal_checker:
          plugin: "nav2_controller::SimpleGoalChecker"
          xy_goal_tolerance: 0.25
```

##### Groot Support

Live Monitoring and Editing of behavior trees with Groot is now possible.
Switching bt-xmls on the fly through a new goal request is also included.
This is all done without breaking any APIs.
Enabled by default.

##### New Plugins

`nav2_waypoint_follower` has an action server that takes in a list of waypoints to follow and follow them in order. In some cases we might want robot to
perform some tasks/behaviours at arrivals of these waypoints. In order to perform such tasks, a generic plugin interface WaypointTaskExecutor has been added to `nav2_core`.
Users can inherit from this interface to implement their own plugin to perform more specific tasks at waypoint arrivals for their needs.

Several example implementations are included in `nav2_waypoint_follower`. `WaitAtWaypoint` and `PhotoAtWaypoint` plusings are included in
`nav2_waypoint_follower` as run-time loadable plugins. `WaitAtWaypoint` simply lets robot to pause for a specified amount of time in milliseconds, at waypoint arrivals.
While `PhotoAtWaypoint` takes photos at waypoint arrivals and saves the taken photos to specified directory, the format for taken photos also can be configured through parameters.
All major image formats such as `png`, `jpeg`, `jpg` etc. are supported, the default format is `png`.

Loading a plugin of this type is done through `nav2_bringup/params/nav2_param.yaml`, by specifying plugin’s name, type and it’s used parameters.

```
waypoint_follower:
  ros__parameters:
    loop_rate: 20
    stop_on_failure: false
    waypoint_task_executor_plugin: "wait_at_waypoint"
      wait_at_waypoint:
        plugin: "nav2_waypoint_follower::WaitAtWaypoint"
        enabled: True
        waypoint_pause_duration: 0
```

Original GitHub tickets:

* [WaypointTaskExecutor](https://github.com/ros-navigation/navigation2/pull/1993)
* [WaitAtWaypoint](https://github.com/ros-navigation/navigation2/pull/1993)
* [PhotoAtWaypoint](https://github.com/ros-navigation/navigation2/pull/2041)
* [InputAtWaypoint](https://github.com/ros-navigation/navigation2/pull/2049)

##### Costmap Filters

A new concept interacting with spatial-dependent objects called “Costmap Filters” appeared in Galactic (more information about this concept could be found at [Navigation Concepts](../concepts/index.html#concepts) page). Costmap filters are acting as a costmap plugins, applied to a separate costmap above common plugins. In order to make a filtered costmap and change robot’s behavior in annotated areas, filter plugin reads the data came from filter mask. Then this data is being linearly transformed into feature map in a filter space. It could be passability of an area, maximum speed limit in m/s, robot desired direction in degrees or anything else. Transformed feature map along with the map/costmap, sensors data and current robot position is used in plugin’s algorithms to make required updates in the resulting costmap and robot’s behavior.

Architecturally, costmap filters consists from `CostmapFilter` class which is a basic class incorporating much common of its inherited filter plugins:

* `KeepoutFilter`: keep-out/safety zones filter plugin.
* `SpeedFilter`: slow/speed-restricted areas filter.
* Preferred lanes in industries. This plugin is covered by `KeepoutFilter` (see discussion in [corresponding PR](https://github.com/ros-navigation/navigation2/issues/1522) for more details).

Each costmap filter subscribes to filter info topic (publishing by [Costmap Filter Info Publisher Server](https://github.com/ros-navigation/navigation2/tree/main/nav2_map_server/src/costmap_filter_info)) having all necessary information for loaded costmap filter and filter mask topic.
`SpeedFilter` additionally publishes maximum speed restricting [messages](https://github.com/ros-navigation/navigation2/blob/main/nav2_msgs/msg/SpeedLimit.msg) targeted for a Controller to enforce robot won’t exceed given limit.

High-level design of this concept could be found [here](https://github.com/ros-navigation/navigation2/tree/main/doc/design/CostmapFilters_design.pdf). The functionality of costmap filters is being discussed in [the ticket #1263](https://github.com/ros-navigation/navigation2/issues/1263) and carried out by [PR #1882](https://github.com/ros-navigation/navigation2/pull/1882). The following tutorials: [Navigating with Keepout Zones](../tutorials/docs/navigation2_with_keepout_filter.html#navigation2-with-keepout-filter) and [Navigating with Speed Limits](../tutorials/docs/navigation2_with_speed_filter.html#navigation2-with-speed-filter) will help to easily get involved with `KeepoutFilter` and `SpeedFilter` functionalities.

##### SmacPlanner

A new package, `nav2_smac_planner` was added containing 4 or 8 connected 2D A\*, and Dubin and Reed-shepp model hybrid-A\* with smoothing, multi-resolution query, and more.

The `nav2_smac_planner` package contains an optimized templated A\* search algorithm used to create multiple A\*-based planners for multiple types of robot platforms. We support differential-drive and omni-directional drive robots using the `SmacPlanner2D` planner which implements a cost-aware A\* planner. We support cars, car-like, and ackermann vehicles using the `SmacPlanner` plugin which implements a Hybrid-A\* planner. This plugin is also useful for curvature constrained planning, like when planning robot at high speeds to make sure they don’t flip over or otherwise skid out of control.

The `SmacPlanner` fully-implements the Hybrid-A\* planner as proposed in [Practical Search Techniques in Path Planning for Autonomous Driving](https://ai.stanford.edu/~ddolgov/papers/dolgov_gpp_stair08.pdf), including hybrid searching, CG smoothing, analytic expansions and heuristic functions.

##### ThetaStarPlanner

A new package, `nav2_theta_star_planner` was added containing 4 or 8 connected Theta\* implementation for 2D maps.

This package implements an optimized version of the Theta\* Path Planner (specifically the [Lazy Theta\* P](http://idm-lab.org/bib/abstracts/papers/aaai10b.pdf) variant) to plan any-angled paths for differential-drive and omni-directional robots, while also taking into account the costmap costs. This plugin is useful for the cases where you might want to plan a path at a higher rate but without requiring extremely smooth paths around the corners which, for example, could be handled by a local planner/controller.

##### RegulatedPurePursuitController

A new package, `nav2_regulated_pure_pursuit_controller` was added containing a novel variant of the Pure Pursuit algorithm.
It also includes configurations to enable Pure Pursuit and Adaptive Pure Pursuit variations as well.

This variation is specifically targeting service / industrial robot needs.
It regulates the linear velocities by curvature of the path to help reduce overshoot at high speeds around blind corners allowing operations to be much more safe.
It also better follows paths than any other variation currently available of Pure Pursuit.
It also has heuristics to slow in proximity to other obstacles so that you can slow the robot automatically when nearby potential collisions.
It also implements the Adaptive lookahead point features to be scaled by velocities to enable more stable behavior in a larger range of translational speeds.

There’s more this does, that that’s the general information. See the package’s `README` for more.

##### Costmap2D `current_` Usage

In costmap2D, `current_` was used in ROS1 to represent whether a costmap layer was still enabled and actively processing data. It would be turned to `false` only under the situation that the expected update rate of a sensor was not met, so it was getting stale or no messages. It acts as a fail-safe for if a navigation sensor stops publishing.

In galactic, that will remain turn, however it will also add additional capabilities. It is also now set to `false` when a costmap is reset due to clearing or other navigation recoveries. That stops the robot from creating a plan or control effort until after the costmap has been updated at least once after a reset. This enables us to make sure we cannot ever create a path or control with a completely empty costmap, potentially leading to collisions, due to clearing the costmap and then immediately requesting an algorithm to run.

##### Standard time units in parameters

To follow the SI units outlined in REP-103 to the “T” nodes below were modified to use seconds consistently in every parameter. Under each node name you can see which parameters changed to seconds instead of using milliseconds.

* lifecycle manager

  + `bond_timeout_ms` became `bond_timeout` in seconds
* smac planner

  + `max_planning_time_ms` became `max_planning_time` in seconds
* map saver

  + `save_map_timeout` in seconds

##### Ray Tracing Parameters

Raytracing functionality was modified to include a minimum range parameter from which ray tracing starts to clear obstacles to avoid incorrectly clearing obstacles too close to the robot. This issue was mentioned in [ROS Answers](https://answers.ros.org/question/355150/obstacles-in-sensor-deadzone/). An existing parameter `raytrace_range` was renamed to `raytrace_max_range` to reflect the functionality it affects. The renamed parameters and the plugins that they belong to are mentioned below. The changes were introduced in this [pull request](https://github.com/ros-navigation/navigation2/pull/2126).

* obstacle\_layer plugin

  + `raytrace_min_range` controls the minimum range from which ray tracing clears obstacles from the costmap
  + `raytrace_max_range` controls the maximum range to which ray tracing clears obstacles from the costmap
* voxel\_layer plugin

  + `raytrace_min_range` controls the minimum range from which ray tracing clears obstacles from the costmap
  + `raytrace_max_range` controls the maximum range to which ray tracing clears obstacles from the costmap

##### Obstacle Marking Parameters

Obstacle marking was modified to include a minimum range parameter from which obstacles are marked on the costmap to prevent addition of obstacles in the costmap due to noisy and incorrect measurements. This modification is related to the change with the raytracing parameters. The renamed parameters, newly added parameters and the plugins they belong to are given below.

* obstacle\_layer plugin

  + `obstacle_min_range` controls the minimum range from which obstacle are marked on the costmap
  + `obstacle_max_range` controls the maximum range to which obstacles are marked on the costmap
* voxel\_layer plugin

  + `obstacle_min_range` controls the minimum range from which obstacle are marked on the costmap
  + `obstacle_max_range` controls the maximum range to which obstacles are marked on the costmap

##### Recovery Action Changes

The recovery actions, `Spin` and `BackUp` were modified to correctly return `FAILURE` if the recovery action is aborted due to a potential collision. Previously, these actions incorrectly always returned `SUCCESS`. Changes to this resulted in downstream action clients, such as the default behavior tree. The changes were introduced in this [pull request 1855](https://github.com/ros-navigation/navigation2/pull/1855).

##### Default Behavior Tree Changes

The default behavior tree (BT) `navigate_w_replanning_and_recovery.xml` has been updated to allow for replanning in between recoveries. The changes were introduced in this [PR 1855](https://github.com/ros-navigation/navigation2/pull/1855). Additionally, an alternative BT `navigate_w_replanning_and_round_robin_recovery.xml` was removed due to similarity with the updated default BT.

##### NavFn Planner Parameters

The NavFn Planner has now its 3 parameters reconfigurable at runtime (`tolerance`, `use_astar` and `allow_unknown`). The changes were introduced in this [pull request 2181](https://github.com/ros-navigation/navigation2/pull/2181).

##### New ClearCostmapExceptRegion and ClearCostmapAroundRobot BT-nodes

The ClearEntireCostmap action node was already implemented but the ClearCostmapExceptRegion and ClearCostmapAroundRobot BT nodes calling the sister services `(local_or_global)_costmap/clear_except_(local_or_global)_costmap` and `clear_around_(local_or_global)_costmap` of Costmap 2D were missing, they are now implemented in a similar way. They both expose a `reset_distance` input port. See [ClearCostmapExceptRegion](../configuration/packages/bt-plugins/actions/ClearCostmapExceptRegion.html#bt-clear-costmap-except-region-action) and [ClearCostmapAroundRobot](../configuration/packages/bt-plugins/actions/ClearCostmapAroundRobot.html#bt-clear-entire-costmap-around-robot-action) for more. The changes were introduced in this [pull request 2204](https://github.com/ros-navigation/navigation2/pull/2204).

##### New Behavior Tree Nodes

A new behavior tree node was added and dynamically loadable at run-time using behavior tree cpp v3.
See `nav2_behavior_tree` for a full listing, or [Navigation Plugins](../plugins/index.html#plugins) for the current list of behavior tree plugins and their descriptions.
These plugins are set as default in the `nav2_bt_navigator` but may be overridden by the `bt_plugins` parameter to include your specific plugins.

Original GitHub tickets:

* [SingleTrigger](https://github.com/ros-navigation/navigation2/pull/2236)
* [PlannerSelector](https://github.com/ros-navigation/navigation2/pull/2249)
* [ControllerSelector](https://github.com/ros-navigation/navigation2/pull/2266)
* [GoalCheckerSelector](https://github.com/ros-navigation/navigation2/pull/2269)
* [NavigateThroughPoses](https://github.com/ros-navigation/navigation2/pull/2271)
* [RemovePassedGoals](https://github.com/ros-navigation/navigation2/pull/2271)
* [ComputePathThroughPoses](https://github.com/ros-navigation/navigation2/pull/2271)

Additionally, behavior tree nodes were modified to contain their own local executors to spin for actions, topics, services, etc to ensure that each behavior tree node is independent of each other (e.g. spinning in one BT node doesn’t trigger a callback in another).

##### sensor\_msgs/PointCloud to sensor\_msgs/PointCloud2 Change

Due to deprecation of [sensor\_msgs/PointCloud](https://docs.ros2.org/foxy/api/sensor_msgs/msg/PointCloud.html) the topics which were publishing sensor\_msgs/PointCloud are converted to sensor\_msgs/PointCloud2. The details on these topics and their respective information are listed below.

* `clearing_endpoints` topic in `voxel_layer` plugin of `nav2_costmap_2d` package
* `voxel_marked_cloud` and `voxel_unknown_cloud` topic in `costmap_2d_cloud` node of `nav2_costmap_2d` package
* `cost_cloud` topic of `publisher.cpp` of `dwb_core` package.

These changes were introduced in [pull request 2263](https://github.com/ros-navigation/navigation2/pull/2263).

##### ControllerServer New Parameter failure\_tolerance

A new parameter `failure_tolerance` was added to the Controller Server for tolerating controller plugin exceptions without failing immediately. It is analogous to `controller_patience` in ROS(1) Nav. See [Controller Server](../configuration/packages/configuring-controller-server.html#configuring-controller-server) for description.
This change was introduced in this [pull request 2264](https://github.com/ros-navigation/navigation2/pull/2264).

##### Removed BT XML Launch Configurations

The launch python configurations for CLI setting of the behavior tree XML file has been removed. Instead, you should use the yaml files to set this value. If you, however, have a `path` to the yaml file that is inconsistent in a larger deployment, you can use the `RewrittenYaml` tool in your parent launch file to remap the default XML paths utilizing the `get_shared_package_path()` directory finder (or as you were before in python3).

The use of map subscription QoS launch configuration was also removed, use parameter file.
This change was introduced in this [pull request 2295](https://github.com/ros-navigation/navigation2/pull/2295).

##### Nav2 RViz Panel Action Feedback Information

The Nav2 RViz Panel now displays the action feedback published by `nav2_msgs/NavigateToPose` and `nav2_msgs/NavigateThroughPoses` actions.
Users can find information like the estimated time of arrival, distance remaining to goal, time elapsed since navigation started, and number of recoveries performed during a navigation action directly through the RViz panel.
This feature was introduced in this [pull request 2338](https://github.com/ros-navigation/navigation2/pull/2338).

[![Navigation feedback in RViz.](../_images/panel-feedback.gif)](../_images/panel-feedback.gif)

---

### Galactic to Humble

*Source: [https://docs.nav2.org/migration/Galactic.html](https://docs.nav2.org/migration/Galactic.html)*

#### Galactic to Humble

Moving from ROS 2 Galactic to Humble, a number of stability improvements were added that we will not specifically address here.

##### Major improvements to Smac Planners

The Smac Planner was significantly improved, of both the 2D and Hybrid-A\* implementations, making the paths better, faster, and of higher quality.

> * Collision checker rejects collisions faster and queries the costmap for coordinates less often
> * Zero-copy collision checking object
> * precompute collision checking footprint orientations so no need for trig at runtime
> * Only checking full SE2 footprint when the robot is in the possibly inscribed zones
> * Computing the possibly inscribed zones, or the cost over which some part of the footprint may be in collision with a boundary to check the full footprint. Else, check center cost since promised to not be in a potential collision state
> * Renaming Hybrid-A\* planner to SmacPlannerHybrid
> * Precomputing the Reedshepp and Dubin paths offline so at runtime its just a lookup table
> * Replacing the wavefront heuristic with a new, and novel, heuristic dubbed the obstacle heuristic. This computes a Dijkstra’s path using Differential A\* search taking into account the 8 connected space, as well as weights for the cost at the positions to guide the heuristic into the center of aisle ways. It also downsamples the costmap such that it can reduce the number of expansions by 75% and have a very small error introduced into the heuristic by being off by at most a partial fraction of a single cell distance
> * Improvements to the analytic expansion algorithm to remove the possibility of loops at the end of paths, whenever possible to remove
> * Improving analytic expansions to provide maximum path length to prevent skirting close to obstacles
> * 2D A\* travel cost and heuristic improvements to speed up planning times and also increase the path quality significantly
> * Replaced smoother with a bespoke gradient descent implementation
> * Abstract out common utilities of planners into a utils file
> * tuned cost functions
> * precomputed obstacle heuristic using dynamic programming to expand only the minimum number of nodes
> * A caching heuristic setting to enable 25hz planning rates using cached obstacle heuristic values when the goal remains the same
> * Leveraging the symmetry in the dubin and reeds-sheep space to reduce cache size by 50% to increase the window size available for heuristic lookup.
> * Precompute primitives at all orientation bins
> * SmacPlanner2D parameters are now all reconfigurable
> * Both Hybrid-A\* and State Lattice planners are now fully admissible
> * Hybrid-A\* and State Lattice have had their parameterization for path smoothing re-added.
> * The smoother now enables kinematically feasible boundary conditions.
> * State Lattice supports turning in place primitive types
> * Retrospective penalty added to speed up the planner, making it prioritize later search branches before earlier ones, which have negligible chance to improve path in vast majority of situations

The tl;dr of these improvements is:
:   * Plans are 2-3x as fast as they were before, well under 200ms for nearly all situations, making it as fast as NavFn and Global Planner (but now kinematically feasible). Typical planning times are sub-100ms without even making use of the caching or downsampling features.
```
* Paths are of significantly higher quality via improved smoothers and a novel heuristic that steers the robot towards the center of aisleways implicitly. This makes smoother paths that are also further from obstacles whenever possible.
* Using caching or downsampler parameterizations, can easily achieve path planning with sub-50ms in nearly any sized space.
* Smoother is now able to do more refinements and can create kinematically feasible boundary conditions, even while reversing.
```

Additional improvements were made to include a `analytic_expansion_max_length` parameter such that analytic expansions are limited in their potential length. If the length is too far, reject this expansion. This prevents unsafe shortcutting of paths into higher cost areas far out from the goal itself, let search to the work of getting close before the analytic expansion brings it home. This should never be smaller than 4-5x the minimum turning radius being used, or planning times will begin to spike.

Further, the traversal cost and heuristic cost computations were updated **requiring retuning of your penalty functions** if you have a previously existing configuration. Defaults of the algorithm were also retuned appropriately to the change for similar our of the box behavior as before (to use as a reference).

##### Simple (Python) Commander

[This PR 2411](https://github.com/ros-navigation/navigation2/pull/2411) introduces a new package to Nav2, called the `nav2_simple_commander`. It is a set of functions in an object, `BasicNavigator`, which can be used to build Nav2-powered autonomy tasks in Python3 without concerning yourself with the Nav2, ROS 2, or Action server details. It contains a simple API taking common types (primarily `PoseStamped`) and handles all of the implementation details behind the hood. For example, this is a simple navigation task using this API:

```
def main():
    rclpy.init()
    navigator = BasicNavigator()

    # Set our demo's initial pose
    initial_pose = PoseStamped()
    ... populate pose ...
    navigator.setInitialPose(initial_pose)

    # Wait for navigation to fully activate
    navigator.waitUntilNav2Active()

    # Go to our demos first goal pose
    goal_pose = PoseStamped()
    ... populate pose ...
    navigator.goToPose(goal_pose)

    while not navigator.isTaskComplete():
        feedback = navigator.getFeedback()
        ... do something with feedback ...

        # Basic navigation timeout
        if Duration.from_msg(feedback.navigation_time) > Duration(seconds=600.0):
            navigator.cancelNav()

    result = navigator.getResult()
    if result == TaskResult.SUCCEEDED:
        print('Goal succeeded!')
    elif result == TaskResult.CANCELED:
        print('Goal was canceled!')
    elif result == TaskResult.FAILED:
        print('Goal failed!')
```

[The full API can be found in the README of the package](https://github.com/ros-navigation/navigation2/tree/main/nav2_simple_commander). A number of well commented examples and demos can also be found in the package’s source code at the link prior.

##### Reduce Nodes and Executors

In order for nav2 to make the best use of ROS 2, we need minimize the number of nodes and executors in nav2, which can improve performance.

This functionality has been discussed in [the ticket #816](https://github.com/ros-navigation/navigation2/issues/816), and carried out in

> * Remove `client_node_` in `class WaypointFollower` : [PR2441](https://github.com/ros-navigation/navigation2/pull/2441)
> * Remove `rclcpp_node_` in `class MapSaver` : [PR2454](https://github.com/ros-navigation/navigation2/pull/2454)
> * Remove `bond_client_node_` in `class LifecycleManager` : [PR2456](https://github.com/ros-navigation/navigation2/pull/2456)
> * Remove `node_` in `class LifecycleManagerClient` : [PR2469](https://github.com/ros-navigation/navigation2/pull/2469)
> * Remove `rclcpp_node_` in `class ControllerServer` : [PR2459](https://github.com/ros-navigation/navigation2/pull/2459), [PR2479](https://github.com/ros-navigation/navigation2/pull/2479)
> * Remove `rclcpp_node_` in `class PlannerServer` : [PR2459](https://github.com/ros-navigation/navigation2/pull/2459), [PR2480](https://github.com/ros-navigation/navigation2/pull/2480)
> * Remove `rclcpp_node_` in `class AmclNode` : [PR2483](https://github.com/ros-navigation/navigation2/pull/2483)
> * Remove `rclcpp_node_` and `clinet_node_` in `class Costmap2DROS` : [PR2489](https://github.com/ros-navigation/navigation2/pull/2489)
> * Remove `rclcpp_node_` in `class LifecycleNode` : [PR2993](https://github.com/ros-navigation/navigation2/pull/2993)

some APIs are changed in these PRs:
:   * [PR2489](https://github.com/ros-navigation/navigation2/pull/2489) removes arguments `client_node`, `rclcpp_node` and adds argument `callback_group` in the initialize function of class `nav2_costmap_2d::Layer`. `callback_group` is used to replace `rclcpp_node`.
```
* [PR2993](https://github.com/ros-navigation/navigation2/pull/2993) removes argument ``` use_rclcpp_node `` in the constructor of class ``nav2_util::LifecycleNode ```.
```

##### API Change for nav2\_core

[PR 2976](https://github.com/ros-navigation/navigation2/pull/2976) changes the API for `nav2_core::Controller` and `nav2_core::Smoother` by replacing the use of shared pointer references `(const shared_ptr<> &)` to shared pointers `(shared_ptr<>)`.
Use of shared pointer references meant that the shared pointer counter was never incremented.

##### Extending the BtServiceNode to process Service-Results

[This PR 2481](https://github.com/ros-navigation/navigation2/pull/2481) and [PR 2992](https://github.com/ros-navigation/navigation2/pull/2992) address [the ticket](https://github.com/ros-navigation/navigation2/issues/2467) and [this ticket](https://github.com/ros-navigation/navigation2/issues/2968) and adds a virtual `on_completion()` function to the `BtServiceNode` class ([can be found here](https://github.com/ros-navigation/navigation2/blob/c417e2fd267e1dfa880b7ff9d37aaaa7b5eab9ca/nav2_behavior_tree/include/nav2_behavior_tree/bt_service_node.hpp)).
Similar to the already existing virtual `on_wait_for_result()` function, it can be overwritten in the child class to react to a respective event with some user-defined operation.
The added `on_completion()` function will be called after the service interaction of the `BtServiceNode` has been successfully completed.

```
/**
* @brief Function to perform some user-defined operation upon successful
* completion of the service. Could put a value on the blackboard.
* @param response can be used to get the result of the service call in the BT Node.
* @return BT::NodeStatus Returns SUCCESS by default, user may override to return another value
*/
virtual BT::NodeStatus on_completion(std::shared_ptr<typename ServiceT::Response>/*response*/)
{
  return BT::NodeStatus::SUCCESS;
}
```

The returned `BT::NodeStatus` will set the current status of the BT-Node. Since the function has access to the results of the service, the returned node-status can depend on those service results, for example.
The normal behavior of the `BtServiceNode` is not affected by introducing the `on_completion()` function, since the the default implementation still simply returns `BT::NodeStatus::SUCCESS`, if the service interaction completed successfully.

##### Including new Rotation Shim Controller Plugin

[This PR 2718](https://github.com/ros-navigation/navigation2/pull/2718) introduces the new `nav2_rotation_shim_controller`. This controller will check the rough heading difference with respect to the robot and a newly received path. If within a threshold, it will pass the request onto the primary controller to execute. If it is outside of the threshold, this controller will rotate the robot towards that path heading. Once it is within the tolerance, it will then pass off control-execution from this rotation shim controller onto the primary controller plugin. At this point, the robot is still going to be rotating, allowing the current plugin to take control for a smooth hand off into path tracking.

The Rotation Shim Controller is suitable for:

* Robots that can rotate in place, such as differential and omnidirectional robots.
* Preference to rotate in place rather than ‘spiral out’ when starting to track a new path that is at a significantly different heading than the robot’s current heading.
* Using planners that are non-kinematically feasible, such as NavFn, Theta\*, or Smac 2D (Feasible planners such as Smac Hybrid-A\* and State Lattice will start search from the robot’s actual starting heading, requiring no rotation).

##### Spawning the robot in Gazebo

[This PR 2473](https://github.com/ros-navigation/navigation2/pull/2473) deletes the pkg `nav2_gazebo_spawner` inside nav2\_bringup directory. Instead of `nav2_gazebo_spawner` the Node [spawn\_entity.py](https://github.com/ros-simulation/gazebo_ros_pkgs/blob/ros2/gazebo_ros/scripts/spawn_entity.py) of `gazebo_ros` is recommended to spawn the robot in gazebo.
Note that

> * gazebo should be started with both `libgazebo_ros_init.so` and `libgazebo_ros_factory.so` to work correctly.
> * spawn\_entity node could not remap /tf and /tf\_static to tf and tf\_static in the launch file yet, used only for multi-robot situations. This problem was overcame by adding remapping argument `<remapping>/tf:=tf</remapping>` `<remapping>/tf_static:=tf_static</remapping>` under ros2 tag in each plugin which publishes transforms in the SDF file. It is essential to differentiate the tf’s of the different robot.

##### Recovery Behavior Timeout

Recoveries in Nav2, spin and backup, now have `time_allowance` ports in their BT nodes and request fields in their actions to specify a timeout. This helps ensure that the robot can exit a backup or spin primitive behavior in case it gets stuck or otherwise is unable to backup the full distance over a reasonable block of time.

##### New parameter `use_final_approach_orientation` for the 3 2D planners

[Pull request 2488](https://github.com/ros-navigation/navigation2/pull/2488) adds a new parameter `use_final_approach_orientation` to the 3 2D planners (Theta\*, SmacPlanner2D and NavFn), `false` by default. If `true`, the last pose of the path generated by the planner will have its orientation set to the approach orientation, i.e. the orientation of the vector connecting the last two points of the path. It allows sending the robot to a position (x,y) instead of a pose (x,y,theta) by effectively ignoring the goal orientation.
For example, below, for the same goal with an orientaton pointed left of the screen, `use_final_approach_orientation=false` (left) and `use_final_approach_orientation=true` (right)

[![../_images/use_final_approach_orientation_false.gif](../_images/use_final_approach_orientation_false.gif)](../_images/use_final_approach_orientation_false.gif)
[![../_images/use_final_approach_orientation_true.gif](../_images/use_final_approach_orientation_true.gif)](../_images/use_final_approach_orientation_true.gif)

##### SmacPlanner2D and Theta\*: fix goal orientation being ignored

[This pull request 2488](https://github.com/ros-navigation/navigation2/pull/2488) fixes [the issue](https://github.com/ros-navigation/navigation2/issues/2482) of the goal pose orientation being ignored (the end path pose orientation was always set to 0).

##### SmacPlanner2D, NavFn and Theta\*: fix small path corner cases

[This PR 2488](https://github.com/ros-navigation/navigation2/pull/2488) ensures the planners are not failing when the distance between the start and the goal is small (i.e. when they are on the same costmap cell), and in that case the output path is constructed with a single pose.

##### Change and fix behavior of dynamic parameter change detection

[This](https://github.com/ros-navigation/navigation2/pull/2576) and [this PR](https://github.com/ros-navigation/navigation2/pull/2585) modify the method used to catch the changes of dynamic parameters. The motivation was to fix the issue that `void on_parameter_event_callback(const rcl_interfaces::msg::ParameterEvent::SharedPtr event)` was called for every parameter change of every node leading to unwanted parameter changes if 2 different nodes had the same parameter name.

##### Dynamic Parameters

Newly added dynamic parameters to:

* [This PR 2592](https://github.com/ros-navigation/navigation2/pull/2592) makes most of the Costmap2DROS parameters dynamic
* [This PR 2607](https://github.com/ros-navigation/navigation2/pull/2607) makes most of the Regulated Pure Pursuit parameters dynamic
* [This PR 2665](https://github.com/ros-navigation/navigation2/pull/2665) makes most of the Theta \* Planner parameters dynamic
* [This PR 2704](https://github.com/ros-navigation/navigation2/pull/2704) makes Waypoint Follower, Planner Server, and Controller Server’s params reconfigurable

##### BT Action Nodes Exception Changes

When BT action nodes throw exceptions due to networking or action server failures, they now return a status code of `FAILURE` to fail that particular action in the behavior tree to react to. This is in contrast to prior where the exceptions thrown from networking were sent to the root tree which would count as a task-level failure that the tree could not react to.

##### BT Navigator Groot Multiple Navigators

[This PR 2627](https://github.com/ros-navigation/navigation2/pull/2627) creates separate parameters for groot monitoring for the NavToPose and NavThroughPoses navigator types so you can individually track the state of each behavior tree through the ZMQ publisher. This resolves a long-standing problem after we added multiple navigator types to BT Navigator that you could only view the nav to poses BT execution live. BT.CPP and Groot only support one static ZMQ stream at a time, so there is a bit of a quirk where you must locally reset Groot after switching trees in order to view the live stream of the Nav Through Poses BT, if in use. This is a state of the BT.CPP and Groot libraries and not something we can resolve within Nav2.

There is some thought into the future regarding complete deprecation of live BT monitoring using Groot due to this quirk and the almost-certain infux of tickets on the topic. Groot will however always be supported for visualizing behavior tree XML files and modifications, simply not visualizing the BT execution live during robot navigation.

##### Removed Kinematic Limiting in RPP

The parameters `max_linear_accel` and `max_linear_decel` were removed along with the kinematic limiting in the controller causing instabilities. Instead, use a velocity smoother available in the ROS ecosystem if you would like similar behavior.

##### Added Smoother Task Server

A new task server was added which loads smoother plugins and executes them to improve quality of an existing planned path. Smoothing action can be called from a behavior tree using SmoothPath action node. [PR 2569](https://github.com/ros-navigation/navigation2/pull/2569) implements and [PR 2875](https://github.com/ros-navigation/navigation2/pull/2875) adds in the first of the plugins using it with a simple smoother. Other smoothers are in development and will be added in the future.

##### Removed Use Approach Velocity Scaling Param in RPP

The parameter `use_approach_linear_velocity_scaling` is removed in favor of always on to help in smooth transitions to the goal. [This PR 2701](https://github.com/ros-navigation/navigation2/pull/2701) implements.

##### Refactored AMCL motion models as plugins

[This PR 2642](https://github.com/ros-navigation/navigation2/pull/2642) creates plugins for the different motion models currently used in AMCL. This functionality enables users to use any custom motion model by creating it as a plugin and changing the robot\_model\_type parameter to the name of the plugin in nav2\_params.yaml file. This helps to use custom motion models without the need to modify the AMCL source code.

##### Dropping Support for Live Groot Monitoring of Nav2

* <https://github.com/ros-navigation/navigation2/pull/2696>

It was a great feature idea but never quite panned out, especially after we introduced multiple navigator types in the BT Navigator server. The issue we run into primarily is that Zero-MQ prevents users from producing multiple logger types in the same process. Since BT nav has multiple servers, the swapping between them for viewing has never had a clean hand off causing folks to file tickets or have nasty logs appear or ZMQ crashes in the background. The BT.CPP client for this doesn’t allow us to have a clean shutdown process so we’re left with hoping that ZMQ properly handles the situation, which it rarely does. Further, Groot only supports visualizing one type of tree at a time so for applications often switching between navigator types, its not possible to use a single groot client, causing great frustration.

So, what I propose here is to remove live monitoring of the BT from Nav2. **We can still use Groot to modify, visualize, and generally work with behavior trees**, the only thing being removed is to live view the executing behavior tree as Nav2 is currently executing it (it used to light up the boxes of the current nodes). This was of dubious value anyhow, since the tree ticks so fast its difficult to visualize and get meaningful insights into things as the system is moving so quickly.

##### Replanning Only if Path is Invalid

[This PR 2591](https://github.com/ros-navigation/navigation2/pull/2591) creates two new condition BT node to facilitate replanning only if path becomes invalid rather than constantly replanning. These new nodes were integrated into the default BT.

##### Fix CostmapLayer clearArea invert param logic

[This PR 2772](https://github.com/ros-navigation/navigation2/pull/2772) fixes the invert paramlogic of the CostmapLayer clearArea function. Hence correcting the behavior of the clearAroundRobot and clearExceptRegion services and their corresponding BT actions.

##### Dynamic Composition

[This PR 2750](https://github.com/ros-navigation/navigation2/pull/2750) provides a optional bringup based on ROS2 dynamic composition for users. It can be used to compose all Nav2 nodes in a single process instead of launching these nodes separately, which is useful for embedded systems users that need to make optimizations due to harsh resource constraints. it’s used by default, but can be disabled by using the launch argument `use_composition:=False`.

Some experiments to show performance improvement of dynamic composition, and the cpu and memory are captured by `psutil` :

> | CPU: Intel(R) i7-8700 (6Cores 12Threads), Memory: 32GB | cpu(%) | memory(%) |
> | --- | --- | --- |
> | normal multiple processes | 44 | 0.76 |
> | dynamic composition (use `component_container_isolated`) | 38 | 0.23 |

The way of dynamic composition consumes lower memory(saves ~70%), and lower cpu (saves ~13%) than normal multiple processes.

##### BT Cancel Node

[This PR 2787](https://github.com/ros-navigation/navigation2/pull/2787) caters the users with an abstract node to develop cancel behaviors for different servers present in the Nav2 stack such as the controller\_server, recovery\_server and so on. As a start, this PR also provides the `CancelControl` behavior to cancel the goal given to the controller\_server. As an addition to the `CancelControl` [This PR 2856](https://github.com/ros-navigation/navigation2/pull/2856) provides the users with the option to cancel the recoveries such as the `backup`, `spin` and `wait`.

##### BT PathLongerOnApproach Node

In the [PR](https://github.com/ros-navigation/navigation2/pull/2802), a new Decorator BT node known as `PathLongerOnApproach` has been added to provide with the functionality to check and potentially handle longer path generated due to an obstacle in the given goal proximity. To demonstrate this functionality, a new BT `navigate_to_pose_w_replanning_goal_patience_and_recovery.xml` would serve both as an example and ready-to-use BT for a specific application that wishes to optimize their process cycle time. Demo of the developed BT can be seen below, where the robot pauses when close to a goal to see if the dynamic obstacle moves out of the way. Else, it executes the replan:

Obstacle does not clear at all, with obstacle\_clearance\_time to be 3 seconds:

![../_images/nav2_patience_near_goal_and_clear_obstacle.gif](../_images/nav2_patience_near_goal_and_clear_obstacle.gif)

Obstacle clears and you can see the robot pass through the (could have been ideally the) same path:

![../_images/nav2_patience_near_goal_and_go_around.gif](../_images/nav2_patience_near_goal_and_go_around.gif)

##### BT TruncatePathLocal Node

In the [PR 2753](https://github.com/ros-navigation/navigation2/pull/2753), a new Action BT node named `TruncatePathLocal` has been added to extract a bounded-length path section near robot to be used e.g. for collision checking or computationally expensive smoothers

##### Constrained Smoother

In [the PR 2753](https://github.com/ros-navigation/navigation2/pull/2753), a new Smoother named `nav2_constrained_smoother::ConstrainedSmoother` has been added to optimize various path criteria such as smoothness or distance from obstacles, maintaining minimum turning radius

##### Replanning at a Constant Rate and if the Path is Invalid

[This PR 2804](https://github.com/ros-navigation/navigation2/pull/2841) introduces a new behavior tree that navigates to pose with consistent replanning and if the path becomes invalid.
To facilitate the new behavior tree a new condition node PathExpiringTimer was introduced to trigger replanning at a consistent rate.

##### Euclidean Distance 2D

[This PR 2865](https://github.com/ros-navigation/navigation2/pull/2865) changes Euclidean distance calculation throughout nav2 to project on to the XY plane (i.e. discard any information related to components in Z).
This may potentially subtly change the way certain BT nodes, BT Navigators, controller servers, planner servers, and RPP behave if using custom plugins outside the Nav2 ecosystem.

##### Recovery To Behavior

[This PR 2867](https://github.com/ros-navigation/docs.nav2.org/pull/298) renames the nav2\_recoveries to nav2\_behaviors.

In navigation\_launch.py recoveries\_server -> behavior\_server and nav2\_recoveries -> nav2\_behaviors.
In nav2\_params.yaml recovery\_plugins -> behavior\_plugins and nav2\_recoveries -> nav2\_behaviors.

##### Respawn Support in Launch and Lifecycle Manager

[PR 2752](https://github.com/ros-navigation/navigation2/pull/2910) enables respawn support in Nav2. In the launch files, you may set `use_respawn` to `true` to enable respawning of servers that crash. This is only available in non-composed systems, since in composed systems, all of the nodes are under a single process and a crash anywhere will bring everything down (including the lifecycle manager itself). Even if the container was set to respawn, it would only respawn the empty container, not with all of the components loaded into it.

That PR also enables the lifecycle manager to check if a system goes down due to a crash. If so, it allows the manager to check if the server comes back online within a given timeout period. If it does, it will automatically retransition the system back up to active to continue on its task automatically.

##### New Nav2 Velocity Smoother

[PR 2964](https://github.com/ros-navigation/navigation2/pull/2964) introduces the `nav2_velocity_smoother` for smoothing velocity commands from Nav2 to a robot controller by velocity, acceleration, and deadband constraints. See [Velocity Smoother](../configuration/packages/configuring-velocity-smoother.html#configuring-velocity-smoother) for more details. It is not included in the default bringup batteries included from `nav2_bringup`.

##### Goal Checker API Changed

[PR 2965](https://github.com/ros-navigation/navigation2/pull/2965) adds an extra argument in the initialize function of the nav2\_core::GoalChecker class.
The extra argument is a costmap\_ros pointer. This is used to check if the goal is in collision, so that we can avoid moving towards the goal and replanning can be initiates using some BT plugin.

##### Added Assisted Teleop

[PR 2904](https://github.com/ros-navigation/navigation2/pull/2904) adds a new behavior for assisted teleop along with two new BT nodes AssistedTeleop and CancelAssistedTeleop.

#### Parameters

**`The tl;dr of these improvements is:`**
- Type: `unknown`
- Plans are 2-3x as fast as they were before, well under 200ms for nearly all situations, making it as fast as NavFn and Global Planner (but now kinematically feasible). Typical planning times are sub-100ms without even making use of the caching or downsampling features.Paths are of significantly higher quality via improved smoothers and a novel heuristic that steers the robot towards the center of aisleways implicitly. This makes smoother paths that are also further from obstacles whenever possible.Using caching or downsampler parameterizations, can easily achieve path planning with sub-50ms in nearly any sized space.Smoother is now able to do more refinements and can create kinematically feasible boundary conditions, even while reversing.

**`some APIs are changed in these PRs:`**
- Type: `unknown`
- PR2489removes argumentsclient_node,rclcpp_nodeand adds argumentcallback_groupin the initialize function of classnav2_costmap_2d::Layer.callback_groupis used to replacerclcpp_node.PR2993removes argumentuse_rclcpp_node``intheconstructorofclass``nav2_util::LifecycleNode.


---

### Humble to Iron

*Source: [https://docs.nav2.org/migration/Humble.html](https://docs.nav2.org/migration/Humble.html)*

#### Humble to Iron

Moving from ROS 2 Humble to Iron, a number of stability improvements were added that we will not specifically address here.

##### New Behavior-Tree Navigator Plugins

New in [PR 3345](https://github.com/ros-navigation/navigation2/pull/3345), the navigator types are exposed to users as plugins that can be replaced or new navigator types added. The default behaviors of navigate to pose and navigate through poses continue to be default behavior but are now customizable with new action interface definitions. These plugins implement the `nav2_core::BehaviorTreeNavigator` base class, which must process the action request, feedback, and completion messages. The behavior tree is handled by this base class with as much general logic as possible abstracted away from users to minimize repetition.

See [Writing a New Navigator Plugin](../plugin_tutorials/docs/writing_new_navigator_plugin.html#writing-new-nav2navigator-plugin) for a tutorial about writing new navigator plugins.

##### Added Collision Monitor

[PR 2982](https://github.com/ros-navigation/navigation2/pull/2982) adds new safety layer operating independently of Nav2 stack which ensures the robot to control the collisions with near obstacles, obtained from different sensors (LaserScan, PointCloud, IR, Sonars, etc…). See [Collision Monitor](../configuration/packages/configuring-collision-monitor.html#configuring-collision-monitor) for more details. It is not included in the default bringup batteries included from `nav2_bringup`.

##### Removed use\_sim\_time from yaml

[PR #3131](https://github.com/ros-navigation/navigation2/pull/3131) makes it possible to set the use\_sim\_time parameter from the launch file for multiple nodes instead of individually via the yaml files. If using the Nav2 launch files, you can optionally remove the use\_sim\_time parameter from your yaml files and set it via a launch argument.

##### Run-time Speed up of Smac Planner

The core data structure of the graph implementation in the Smac Planner framework was swapped out in [PR 3201](https://github.com/ros-navigation/navigation2/pull/3201) to using a specialized unordered map implementation. This speeds up the planner by 10% on trivial requests and reports up to 30% on complex plans that involve numerous rehashings.

##### Recursive Refinement of Smac and Simple Smoothers

The number of recursive refinements for the Simple and Smac Planner Smoothers have been exposed under the `refinement_num` parameter. Previous behavior had this hardcoded if `do_refinement = True` to `4`. Now, default is `2` to help decrease out-of-the-box over smoothing reducing in paths closer to collision than probably ideal, but old behavior can be achieved by changing this to `4`.

##### Simple Commander Python API

[PR 3159](https://github.com/ros-navigation/navigation2/pull/3159) and follow-up PRs add in Costmap API in Python3 simple commander to receive `OccupancyGrid` messages from Nav2 and be able to work with them natively in Python3, analog to the C++ Costmap API. It also includes a line iterator and collision checking object to perform footprint or other collision checking in Python3. See the Simple Commander API for more details.

##### Smac Planner Start Pose Included in Path

[PR 3168](https://github.com/ros-navigation/navigation2/pull/3168) adds the starting pose to the Smac Planners that was previously excluded during backtracing.

##### Parameterizable Collision Checking in RPP

[PR 3204](https://github.com/ros-navigation/navigation2/pull/3204) adds makes collision checking for RPP optional (default on).

##### Expanded Planner Benchmark Tests

[PR 3218](https://github.com/ros-navigation/navigation2/pull/3218) adds launch files and updated scripts for performing objective random planning tests across the planners in Nav2 for benchmarking and metric computation.

##### Smac Planner Path Tolerances

[PR 3219](https://github.com/ros-navigation/navigation2/pull/3219) adds path tolerances to Hybrid-A\* and State Lattice planners to return approximate paths if exact paths cannot be found, within a configurable tolerance around the goal pose.

##### costmap\_2d\_node default constructor

[PR #3222](https://github.com/ros-navigation/navigation2/pull/3222) changes the constructor used by the standalone costmap node. The new constructor does not set a name and namespace internally so it can be set via the launch file.

##### Feedback for Navigation Failures

[PR #3146](https://github.com/ros-navigation/navigation2/pull/3146) updates the global planners to throw exceptions on planning failures. These exceptions get reported back to the planner server which in turn places a error code on the Behavior Tree Navigator’s blackboard for use in contextual error handling in the autonomy application.

The following errors codes are supported (with more to come as necessary): Unknown, TF Error, Start or Goal Outside of Map, Start or Goal Occupied, Timeout, or No Valid Path Found.

[PR #3248](https://github.com/ros-navigation/navigation2/pull/3248) updates the compute path through poses action to report planning failures. These exceptions get reported back to the planner server which in turn places a error code on the Behavior Tree Navigator’s blackboard for use in contextual error handling in the autonomy application.

The following errors codes are supported (with more to come as necessary): Unknown, TF Error, Start or Goal Outside of Map, Start or Goal Occupied, Timeout, No Valid Path Found and No Waypoints given.

[PR #3227](https://github.com/ros-navigation/navigation2/pull/3227) updates the controllers to throw exceptions on failures. These exceptions get reported back to the controller server which in turn places a error code on the Behavior Tree Navigatior’s blackboard for use in contextual error handling in the autonomy application.

The following error codes are supported (with more to come as necessary): Unknown, TF Error, Invalid Path, Patience Exceeded, Failed To Make Progress, or No Valid Control.

[PR #3251](https://github.com/ros-navigation/navigation2/pull/3251) pipes the highest priority error code through the bt\_navigator and defines the error code structure.

A new parameter for the the BT Navigator called “error\_code\_id\_names” was added to the nav2\_params.yaml to define the error codes to compare.
The lowest error in the “error\_code\_id\_names” is then returned in the action request (navigate to pose, navigate through poses waypoint follower), whereas the code enums increase the higher up in the software stack - giving higher priority to lower-level failures.

The error codes produced from the servers follow the guidelines stated below.
Error codes from 0 to 9999 are reserved for nav2 while error codes from 10000-65535 are reserved for external servers.
Each server has two “reserved” error codes. 0 is reserved for NONE and the first error code in the sequence is reserved for UNKNOWN.

The current implemented servers with error codes are:

* Controller Server: NONE:0, UNKNOWN:100, server error codes: 101-199
* Planner Server(compute\_path\_to\_pose): NONE:0, UNKNOWN:201, server error codes: 201-299
* Planner Server(compute\_path\_through\_poses): NONE:0, UNKNOWN:301, server error codes: 301-399
* Smoother Server: NONE: 0, UNKNOWN: 501, server error codes: 501-599
* Waypoint Follower Server: NONE: 0, UNKNOWN: 601, server error codes: 601-699

This pr also updates the waypoint follower server to throw exceptions on failures. These exceptions get reported back to the server which in turn places a error code on the Behavior Tree Navigator’s blackboard for use in contextual error handling in the autonomy application.
The following errors codes are supported (with more to come as necessary): Unknown and Task Executor Failed.
See [Adding a New Nav2 Task Server](../tutorials/docs/adding_a_nav2_task_server.html#adding-a-nav2-task-server) and the PR for additional information.

##### Costmap Filters

Costmap Filters now are have an ability to be enabled/disabled in run-time by calling `toggle_filter` service for appropriate filter ([PR #3229](https://github.com/ros-navigation/navigation2/pull/3229)).

Added new binary flip filter, allowing e.g. to turn off camera in sensitive areas, turn on headlights/leds/other safety things or switch operating mode when robot is inside marked on mask areas ([PR #3228](https://github.com/ros-navigation/navigation2/pull/3228)).

##### Savitzky-Golay Smoother

Adding a new smoother algorithm, the Savitzky-Golay smoother to the smoother server plugin list. See the configuration guide [Savitzky-Golay Smoother](../configuration/packages/configuring-savitzky-golay-smoother.html#configuring-savitzky-golay-filter-smoother) for more details.

##### Changes to Map yaml file path for map\_server node in Launch

[PR #3174](https://github.com/ros-navigation/navigation2/pull/3174) adds a way to set the path to map yaml file for the map\_server node either from the yaml file or using the launch configuration parameter `map` giving priority to the launch configuration parameter. `yaml_filename` is no longer strictly required to be present in `nav2_params.yaml`.

##### SmootherSelector BT Node

[PR #3283](https://github.com/ros-navigation/navigation2/pull/3283) adds a BT node to set the smoother based on a topic or a default. See the configuration guide [Simple Smoother](../configuration/packages/configuring-simple-smoother.html#configuring-simple-smoother) for more details.

##### Publish Costmap Layers

[PR #3320](https://github.com/ros-navigation/navigation2/pull/3320) adds the ability for the nav2\_costmap\_2d package to publish out costmap data associated with each layer.

##### Give Behavior Server Access to Both Costmaps

[PR #3255](https://github.com/ros-navigation/navigation2/pull/3255) adds the ability for a behavior to access the local and global costmap.

To update behaviors, any reference to the global\_frame must be updated to the local\_frame parameter
along with the `configuration` method which now takes in the local and global collision checkers.
Lastly, `getResourceInfo` must be overridden to return `CostmapInfoType::LOCAL`. Other options include `GLOBAL` if the behavior uses global costmap and/or footprint)
or `BOTH` if both are required. This allows us to only create and maintain the minimum amount of expensive resources.

##### New Model Predictive Path Integral Controller

The new Nav2 MPPI Controller is a predictive controller - a successor to TEB and pure path tracking MPC controllers - with Nav2. It uses a sampling based approach to select optimal trajectories, optimizing between successive iterations. It contains plugin-based objective functions for customization and extension for various behaviors and behavioral attributes.

See the README.md and [Model Predictive Path Integral Controller](../configuration/packages/configuring-mppic.html#configuring-mppic) page for more detail.

##### Behavior Tree Uses Error Codes

[PR #3324](https://github.com/ros-navigation/navigation2/pull/3324) adds three new condition nodes to check for error codes on the blackboard set by action BT nodes which contain them.

The `AreErrorCodesPresent` condition node allows the user to specify the error code from the server along with the error codes to match against.
The `WouldAControllerRecoveryHelp` checks if the active error code is UNKNOWN, PATIENCE\_EXCEEDED, FAILED\_TO\_MAKE\_PROGRESS or NO\_VALID\_CONTROL.
If the error code is a match, the condition returns `SUCCESS`.
These error code are potentially able to be cleared by a controller recovery.

The `WouldAPlannerRecoveryHelp` checks if the active error code is UNKNOWN, NO\_VALID\_CONTROL, or TIMEOUT.
If the error code is a match, the condition returns `SUCCESS`.
These error code are potentially able to be cleared by a planner recovery.

The `WouldASmootherRecoveryHelp` checks if the active error code is UNKNOWN, TIMEOUT, FAILED\_TO\_SMOOTH\_PATH, or SMOOTHED\_PATH\_IN\_COLLISION.
If the error code is a match, the condition returns `SUCCESS`.
These error code are potentially able to be cleared by a smoother recovery.

##### Load, Save and Loop Waypoints from the Nav2 Panel in RViz

[PR #3165](https://github.com/ros-navigation/navigation2/pull/3165) provides three new functionalities for the nav2 panel in RViz, they are:

* load and save waypoints in a yaml file for waypoint following (initial pose can also be stored if required)
* loop functionality to revisit the waypoints
* pause and resume button for stopping and continuing through the waypoints

Looping functionality is not specific to the nav2 panel in RViz. Users utilizing nav2\_waypoint\_follower can take advantage of the changes made to the FollowWaypoint action, by specifying the desired number of loops in the action request that will be eventually sent to the nav2\_waypoint\_follower server.

##### DWB Forward vs Reverse Pruning

[PR #3374](https://github.com/ros-navigation/navigation2/pull/3374) adds a new `forward_prune_distance` parameter in the DWB controller. It replaces the `prune_distance` for forward path shortening, enabled through the `shorten_transformed_plan` boolean parameter. This change allows to use different values for forward and backward path shortening.

##### More stable regulation on curves for long lookahead distances

[PR #3414](https://github.com/ros-navigation/navigation2/pull/3414) adds a new `use_fixed_curvature_lookahead` parameter to the RPP controller. This makes slowing down on curve not dependent on the instantaneous lookahead point, but instead on a fixed distance set by the parameter `curvature_lookahead_dist`.

##### Publish Collision Monitor State

[PR #3504](https://github.com/ros-navigation/navigation2/pull/3504) adds a new `state_topic` parameter to the CollisionMonitor. If specified, this optional parameter enables the state topic publisher. The topic reports the currently activated polygon action type and name.

##### Renamed ROS-parameter in Collision Monitor

[PR #3513](https://github.com/ros-navigation/navigation2/pull/3513) renames `max_points` parameter to `min_points` and changes its meaning. Formerly `max_points` meant the maximum number of points inside the area still not triggering the action, while `min_points` - is a minimal number of points starting from the action to be initiated. In other words `min_points` now should be adjusted as `max_points + 1`.

##### New safety behavior model “limit” in Collision Monitor

[PR #3519](https://github.com/ros-navigation/navigation2/pull/3519) adds a new collision monitor behavior model `limit` that restricts maximum linear and angular speed to specific values (`linear_limit` and `angular_limit`) if enough points are in the given shape.

##### Velocity smoother applies deceleration when timeout

[PR #3512](https://github.com/ros-navigation/navigation2/pull/3512) makes the VelocitySmoother apply the deceleration when the input command timeout.

##### PoseProgressChecker plugin

[PR #3530](https://github.com/ros-navigation/navigation2/pull/3530) adds a new `nav2_controller::PoseProgressChecker` plugin. It builds on the behavior of the `SimpleProgressChecker` by adding a new parameter `required_movement_angle`, allowing the plugin to considers that there is still progress when there is no translation movement, from the moment there is a rotation movement superior to `required_movement_angle` within the `movement_time_allowance`.

##### Allow multiple goal checkers and change parameter progress\_checker\_plugin(s) name and type

[PR #3555](https://github.com/ros-navigation/navigation2/pull/3555) initializes the progress checker plugin(s) in the same way as for the goal checker and controller plugins: it is now a list of string and was renamed from `progress_checker_plugin` to `progress_checker_plugins`, and the type changed from `string` to `vector<string>`. This allows the initialization of multiple progress checkers that can be chosen from the added `progress_checker_id field` of the `FollowPath` action.
Beware that it is a breaking change and that configuration files will need to be updated.

##### IsBatteryChargingCondition BT Node

[PR #3553](https://github.com/ros-navigation/navigation2/pull/3553) adds a BT node to check if the battery is charging. See the configuration guide [IsBatteryCharging](../configuration/packages/bt-plugins/conditions/IsBatteryCharging.html#bt-is-battery-charging-condition) for more details.

##### Behavior Server Error Codes

[PR #3569](https://github.com/ros-navigation/navigation2/pull/3539) updates the behavior server plugins to provide error codes on failure.

* Spin: NONE: 0, UNKNOWN: 701, server error codes: 701-709
* BackUp: NONE: 0, UNKNOWN: 801, server error codes: 710-719
* DriveOnHeading: NONE: 0, UNKNOWN: 901, server error codes: 720-729
* AssistedTeleop: NONE: 0, UNKNOWN: 1001, server error codes: 730-739

##### New Denoise Costmap Layer Plugin

[PR #2567](https://github.com/ros-navigation/navigation2/pull/2567) adds the new plugin for filtering noise on the costmap.

Due to errors in `Voxel Layer` or `Obstacle Layer` measurements, salt and pepper noise may appear on the [costmap](../configuration/packages/configuring-costmaps.html#configuring-cosmaps). This noise creates false obstacles that prevent the robot from finding the best path on the map.
The new `Denoise Layer` plugin is designed to filter out noise-induced standalone obstacles or small obstacles groups. This plugin allows you to add layer that will filter local or global costmap.
More information about `Denoise Layer` plugin and how it works could be found [here](../tutorials/docs/filtering_of_noise-induced_obstacles.html#filtering-of-noise-induced-obstacles).

##### SmacPlannerHybrid viz\_expansions parameter

[PR #3577](https://github.com/ros-navigation/navigation2/pull/3577) adds a new parameter for visualising SmacPlannerHybrid expansions for debug purpose.

---

### Iron to Jazzy

*Source: [https://docs.nav2.org/migration/Iron.html](https://docs.nav2.org/migration/Iron.html)*

#### Iron to Jazzy

Moving from ROS 2 Iron to Jazzy, a number of stability improvements were added that we will not specifically address here.

##### BehaviorTree.CPP upgraded to version 4.5+

Since we migrated from version 3.8 to 4.5, users must upgrade their XML and source code accordingly.

You can refer to [this page](<https://www.behaviortree.dev/docs/migration>) for more details, but the main changes are:

* XML must be changed. This [python script can help](<https://github.com/BehaviorTree/BehaviorTree.CPP/blob/master/convert_v3_to_v4.py>).
* The syntax of SubTrees has changed; the one of SubTreePlus was adopted, instead.
* If you created a custom **ControlNode** or **DecoratorNode**, you must handle the case when a child returns BT::NodeStatus::SKIPPED.

##### Added TwistStamped Option for Commands

A new parameter `enable_stamped_cmd_vel` has been added to all of the publishers and subscribers of `cmd_vel` and related topics. This allows you to set the publication and subscription of TwistStamped messages over Twist messages to have frame and timestamp information of the set command. For now, this is default to `false` to not change current behavior, but it is planned to make `TwistStamped` the default behavior alongside Gazebo, ROS 2 Control, and related projects.

##### Add VelocityPolygon in Collision Monitor

[PR #3708](https://github.com/ros-navigation/navigation2/pull/3708) adds `VelocityPolygon` type in Collision Monitor. This allows the user to setup multiple polygons to cover the range of the robot’s velocity limits. For example, the user can configure different polygons for rotation, moving forward, or moving backward. The Collision Monitor will check the robot’s velocity against each sub polygon to determine the appropriate polygon to be used for collision checking. The tutorial is available in the [Configuring Collision Monitor with VelocityPolygon](../tutorials/docs/using_collision_monitor.html#collision-monitor-tutorial) section.

##### Change polygon points parameter format in Collision Monitor

[PR #4020](https://github.com/ros-navigation/navigation2/pull/4020) changes the format of the Polygon points parameter from `vector<double>` to `string`. This makes the polygon description more uniform across the Collision Monitor and Costmap\_2D.
Now we can define a polygon’s points in string that has a `vector<vector<double>>` structure like this `"[[p1.x, p1.y], [p2.x, p2.y], [p3.x, p3.y],...]"` with a minimum of 4 points described. An example of a Square polygon will be written as follows.

```
PolygonFront:
  type: "polygon"
  points: "[[0.3, 0.3], [0.3, -0.3], [0.0, -0.3], [0.0, 0.3]]"
  action_type: "none"
  min_points: 4
  visualize: True
  polygon_pub_topic: "polygon_front"
```

##### Introduction of Soft-Real Time Action Servers

[PR #3914](https://github.com/ros-navigation/navigation2/pull/3914) adds soft real-time prioritization to the controller server to better ensure resources to time sensitive portions of the codebase. The Simple Action Server now has a `realtime` input field exposed in the Controller Server via the parameter `use_realtime_priority` which will set the controller’s execution thread to a higher priority than the rest of the system to meet scheduling deadlines. To use this feature, you use set the following inside of `/etc/security/limits.conf` to give userspace access to elevated prioritization permissions. This is currently only enabled in the Controller Server, who’s execution thread is sensitive to scheduling priorities, but could be set with other threads in the future if found necessary.

```
<username> soft rtprio 99
<username> hard rtprio 99
```

The Collision Monitor and Velocity Smoothers also had `use_realtime_priority` added as well!

##### `opennav_coverage` Project

A new metapackage exists in: <https://github.com/open-navigation/opennav_coverage> which contains complete coverage navigator plugins, BT nodes, behavior tree demos, and coverage planning server based on `Fields2Cover`. See that project for more information. It is on long-term trajectory for inclusion into `Nav2`, but there are still yet a few missing features from Fields2Cover before we can integrate that into the main project to be up to snuff in terms of all the major features and capabilities users would expect from a coverage planning system.

If you’d like to see coverage planning in Nav2 directly, please consider contributing [to the as-of-yet needed features described here](https://github.com/Fields2Cover/Fields2Cover/issues/73).

##### `opennav_docking` Project

A new metapackage exists in: <https://github.com/open-navigation/opennav_docking> which contains complete automatic charging dock framework, BT nodes, plugins, and demos.
This allows for docking of any type of robot with any type of charging dock in a repeatable and generalized way.
It will be integrated into Nav2 directly soon (Update June 2024: within Nav2 stack directly `nav2_docking`!)

See [Using Docking Server](../tutorials/docs/using_docking.html#docking-tutorial) for a tutorial on using this new capability! Thanks to NVIDIA for sponsoring this package!

##### Introduce a new Multi-Robot Bringup Launch

[PR #3572](https://github.com/ros-navigation/navigation2/pull/3572) introduces a new way of bringup tb3 multi-robot that names as `cloned_tb3_simulation_launch.py` for simulation. `cloned_tb3_simulation_launch.py` enables to bring up multiple robots with same parameter that described in `nav2_multirobot_param_all.yaml`. And multiple robots are separated by namespaces which are given as a Launch Arguments.
Existing `multi_tb3_simulation_launch.py` which was utilized in previous is replaced with `unique_tb3_simulation_launch.py`, allowing for multiple unique robot instances utilizing `nav2_multirobot_params_<N>.yaml` configuration files.

##### New option for the Voxel and Obstacle Layers

[PR #3612](https://github.com/ros-navigation/navigation2/pull/3612) adds a new MaxWithoutUnknownOverwrite option to combination\_method parameter in Voxel and Obstacle Layers. This can be used to make sure that the static map is the dominant source of information, and
easily prevent the robot to go through places that are not present in the static map.

##### use\_interpolation RPP Parameter Depreciated

After a distribution of testing by many users, we have depreciated the use\_interpolation parameter and it is now default on at all times without the ability to disable. It improves velocity smoothness and overall quality of tracking positively in all cases.

##### Changes to MPPI Goal Critic

The MPPI Goal critic’s formulation is changed to better keep up with speed on approach to goal instead of preemptively slowing too significantly. It also allows you to better use the weight to adjust the degree at which it slows more naturally. This change involves adjusting the `threshold_to_consider` to be the same as your prediction horizon (e.g. samples \* dt \* max speed) for both the goal critic and path follower critic to have a good hand-off between them without deceleration.

##### Changes to MPPI Path Angle Critic

MPPI’s Path Angle critic now has a `mode` setting to adjust behavior depending on robot’s desired behavioral traits. Previously, it penalized path orientations that deviated far the the robot’s forward orientation to turn the robot towards sharp changes in the path. This is still default (`mode: 0`), but other modes now exist too.

`mode: 1` sets the penalization of path’s relative directions by either forward orientation or the opposite for reversing to allow for true bidirectional motion when one way or another is not preferable for a symmetric robot. This uses only the path’s relative points to the robot to decide which direction to incentivize.

`mode: 2` instead uses the path’s orientations when a feasible path is given from the Smac Planners or the Smoother server’s algorithms. This way, the globally planned orientations are followed rather than the based solely on the path’s relative points. This is useful for non-circular robots in highly confined settings where there may be restricted opportunities to change directions so following the global path’s orientation are required to end in the orientation you require.

##### Changes to MPPI Path Handling For Directionality

MPPI’s Path Align Critic and Path Handler object now have options to utilize the path’s orientation information to force the controller to change directions when and only when requested by a feasible planner. When `enforce_path_inversion` is `true`, the path handler will prune the path to the first time the directions change to force the controller to plan to the inversion point and then be set the rest of the path, once in tolerance. The Path Align critic also contains a parameter `use_path_orientations` which can be paired with it to incentivize aligning the path containing orientation information to better attempt to achieve path inversions where requested **and** not do them when not requested.

See MPPI’s configuration guide for complete information.

##### Addition of new MPPI Cost Critic

Analog to the `ObstacleCritic`, the `CostCritic` is another obstacle avoiding critic alternative if the `ObstacleCritic` is not working well for you.
This critic uses the inflated costs in the costmap to score rather than distance to obstacles as the `ObstaclesCritic` does.
See the configuration guide for more information.

##### MPPI Acceleration

New to Jazzy, MPPI is 45% faster due to a weeks long optimization campaign. Enjoy!

##### Move Error Code Enumerations

[PR #3693](https://github.com/ros-navigation/navigation2/pull/3693) moves the enumeration codes from the goal to the result section.

##### Substitution in parameter file

Enabled substitution in parameter file. For example, you can write the following

```
bt_navigator:
  ros__parameters:
    default_nav_to_pose_bt_xml: $(find-pkg-share my_package)/behavior_tree/my_nav_to_pose_bt.xml
```

For more information about substitutions syntax, see [here](https://docs.ros.org/en/rolling/How-To-Guides/Launch-files-migration-guide.html#substitutions)

##### Allow Behavior Server Plugins to Access The Action Result

[PR #3704](https://github.com/ros-navigation/navigation2/pull/3704) allows behavior servers plugins to access and modify the action result.

##### Smac Planner Debug Param Name Change

`debug_visualizations` replaces `viz_expansions` parameter in Hybrid-A\* to reflect the new inclusion of footprint debug information being published as well.

##### Smac Planner On Approach to Goal Shortcutting Solutions

PR #3962 adds new params `analytic_expansion_max_cost` and `analytic_expansion_max_cost_override` in extension of `analytic_expansion_max_length` in Humble to further limit potential shortcutting of paths near obstacles in close proximity to the goal.
It uses a maximum cost parameter (default `200`) to tell if an expansion is closer to an obstacle than a user would like. If the expansion is critically close to the goal, then it may override this constraint if `analytic_expansion_max_cost_override` is `false` - allowing the constraint to be overridden to find a successful path solution, as it may be required.
This PR also introduces additional analytic expansion scoring logic and edge case handling to improve path qualities by an analog heuristic function.

##### Added GPS Waypoint Follower Server

[This PR 2814](https://github.com/ros-navigation/navigation2/pull/2814) adds the `follow_gps_waypoints` action server in `nav2_waypoint_follower`. This server accepts a set of GPS goals instead of cartesian goals and provides all the other functionalities available on `nav2_waypoint_follower`. A new tutorial demonstrating its functionality was also added on [PR 70 on navigation2\_tutorials](https://github.com/ros-navigation/navigation2_tutorials/pull/70) and can be found on the General Tutorials directory on this website.

##### Smac Planner Hybrid-A\* New Features

New features `allow_primitive_interpolation` which allows for more primitives in the search set, `use_quadratic_cost_penalty` to impact the cost penalty order in the traversal and heuristic functions, and `downsample_obstacle_heuristic` to optionally not downsample the obstacle heuristic’s costmap were added. The default behavior will remain the same. If you would like to use these new features, please check out the Smac Planner Hybrid-A\* configuration guide.

##### New node in nav2\_collision\_monitor: Collision Detector

In this [PR #3500](https://github.com/ros-navigation/navigation2/pull/3500) A new node was introduced in the nav2\_collision\_monitor: Collision Detector.
It works similarly to the Collision Monitor, but does not affect the robot’s velocity. It will only inform that data from the configured sources has been detected within the configured polygons via message to the `collision_detector_state` topic that might be used by any external module (e.g. switching LED or sound alarm in case of collision).

##### Dynamic enabling/disabling of sources/polygons in Collision Monitor/Detector

In this [PR #3825](https://github.com/ros-navigation/navigation2/pull/3825) we added the ability to dynamically enable/disable sources and polygons in the Collision Monitor/Detector.

##### Expose action server’s result timeout

In this [PR #3787](https://github.com/ros-navigation/navigation2/pull/3787) the timeout for action server’s result was exposed in all nodes having action servers.
This is because in this [PR #1012](https://github.com/ros2/rcl/pull/1012) in rcl a change was introduced which makes action servers discard a goal handle if the result
is not produced within 10 seconds, when the default was set to 15 minutes before. Since some actions in Nav2 may take more than 10 seconds to complete, the user has now the ability
to set this value through the `action_server_result_timeout` parameter, which defaults to 15 minutes in the `bt_navigators` and `waypoint_follower` and to 10 seconds in all other nodes.

##### RewrittenYaml could add new parameters to YAMLs

Now `RewrittenYaml` widely used in Nav2 launch-scripts, could do not only substitutions of ROS-parameters existing in original YAML, but rather additions of new parameters, that did not exist in the YAML. Certainly, these parameters should be declared for target ROS-nodes, otherwise they won’t be processed in run-time. In such functionality, they should be expressed in absolute values, separated by a dot. For example, the rewrite for a `prune_distance` parameter of a `FollowPath` node will look like `'controller_server.ros__parameters.FollowPath.prune_distance': '1.0'` in a `param_rewrites` dictionary of `RewrittenYaml()` argument.
The change was intoroduced in the scope of [PR #3785](https://github.com/ros-navigation/navigation2/pull/3785) fix.

##### Simple Commander API Allows Multi-Robot Namespacing

The Simple Navigator API now allows multi-robot namespacing by exposing a `namespace` field in the constructor to allow you to specify the Nav2 stacks’ namespace for a robot or system. See [this PR for details](https://github.com/ros-navigation/navigation2/pull/3803/files).

##### Change duration type in wait\_action node

In this [PR #3871](https://github.com/ros-navigation/navigation2/pull/3871) the type of duration variable in wait\_action node is changed from int to double, which allows you to use floating values for wait\_action.

##### The costmap activation fails when required transforms are not available

In this [PR #3866](https://github.com/ros-navigation/navigation2/pull/3866) the parameter `initial_transform_timeout` is added to the costmap. The activation of the costmap now fails,
if the transformation from the robot base frame to the global frame does not become available during this timeout.

##### Subtrees Obtain Shared Resources

[PR #3911](https://github.com/ros-navigation/navigation2/pull/3911) gives all sub-trees in BT.CPP the same shared resources as the main tree (node, shared timeouts, etc).

##### Collision Monitor: added watchdog mechanism based on `source_timeout` parameter with default blocking behavior

[PR #3880](https://github.com/ros-navigation/navigation2/pull/3880) adds a watchdog mechanism that stops the robot if a source data is not published yet, or if no new data is received within the source\_timeout` parameter, or if impossible to transform data to base frame. `source_timeout` parameter can now be set per source: if `source_timeout` is not set for a source, the value of the node `source_timeout` parameter is used.

Additionally, this watchdog mechanism can be disabled by setting `source_timeout: 0.0`.

##### BtActionServer: use native library haltTree()

[PR #3950](https://github.com/ros-navigation/navigation2/pull/3950) changes the method used by BehaviorTreeEngine::haltAllActions to halt the BT nodes to the bt.cpp native method haltTree().

Before this change, only the active BT node was halted when finishing the action. After this change, all BT nodes halt() methods are called. This is very convenient to handle cleaning operation (switch off your lights when leaving) in halt().

Also updated nav2\_behavior\_tree::BtActionServer::haltTree() to use the same. It is used nowhere in nav2 but is useful for external users (like me) that want for instance to halt the tree on preemption.

##### Global Frame Removed from 2 BT Nodes

The Global Frame was removed from `RemovePassedGoals` and `GoalReached` BT nodes and instead using the `frame_id` of the goal’s headers for transformation.

##### Introduction of `CostmapUpdate.msg`

[PR #3965](https://github.com/ros-navigation/navigation2/pull/3965) introduces a new type of message - `CostmapUpdate.msg`. It is the update message related to the `Costmap.msg`. Now instead of sending the whole costmap in every message, such as with `Costmap.msg`, the `CostmapUpdate.msg` includes only the area of the costmap that has changed since the previous update message. The `Costmap.msg` is sent only once at the beginning, followed by the messages of the `CostmapUpdate.msg` type. The idea is to mimic the `OccupancyGrid.msg` and `OccupancyGridUpdate.msg` behavior.

To activate this feature, the Costmap2D ROS parameter `always_send_full_costmap` has to be set to `false`.

To subscribe to `Costmap.msg` and `CostmapUpdate.msg` it is recommended to use the `CostmapSubscriber` class.

##### Full Stack Uses Node Clocks

The stack no longer contains wall timers or wall rates. It will now use the node clocks. This will be ROS Time for simulation when `use_sim_time` is true. Else, it uses a steady clock.

##### New Graceful Motion Controller

[PR #4021](https://github.com/ros-navigation/navigation2/pull/4021) introduces a new type of controller for differential robots based on a pose-following kinematic control law that generates a smooth and comfortable trajectory.

See [Graceful Controller](../configuration/packages/configuring-graceful-motion-controller.html#configuring-graceful-motion-controller) for more information.

##### Plugin Libraries in BT Navigator Only Includes Custom Nodes

New to Jazzy, the `plugin_lib_names` parameter implicitly includes all Nav2 BT nodes automatically. It is only required now to specify additional user-generated BT plugins to load.

##### New RViz Plugin for selecting Planners, Controllers, Goal Checkers, Progress Checkers and Smoothers

[In PR #4091](https://github.com/ros-navigation/navigation2/pull/4091) a new RViz plugin was added to select the planner, controller, goal checker, progress checker, and smoother on the fly.

The primary goal of this plugin is to facilitate the developers and easy integration testing of their configuration before deploying the robot in the intended application.

In order to facilitate the dynamic selection of the specified components, the BT selector nodes for all these components were utilized and were updated to all the relevant BT nodes.

Here we can see the working demo of the plugin:

![../_images/selector_plugin_demo.gif](../_images/selector_plugin_demo.gif)

In the GIF, it can be seen that there are two controller\_ids namely, FollowPath and HighSpeedFollowPath. By default, the one defined in the Behavior tree is utilized.

In this case, the FollowPath is the default controller\_id. The difference between the two controller\_ids is that HighSpeedFollowPath has a higher max velocity compared to the FollowPath. This difference can be well noted in the GIF.

Attention

If a server is unavailable, then the combo box or the drop down list of the particular component will be empty.

##### RPP new optional `interpolate_curvature_after_goal` behavior and fix conflict between `use_rotate_to_heading` and `allow_reversing`

[In PR #4140](https://github.com/ros-navigation/navigation2/pull/4140) a new optional `interpolate_curvature_after_goal` parameter (default `false`) was added that activates the interpolation of a carrot after the goal in order to maintain a constant curvature lookahead distance. This is to avoid instabilities at the end of the path on the generation of the angular speed. The carrot used for the linear speed computation stays the same.

Interpolation is based on the orientation of the vector formed by the last 2 poses of the path. Hence paths of length 1 are rejected when `interpolate_curvature_after_goal` is `true`. It can be used only when `use_fixed_curvature_lookahead: true`.

[![../_images/rpp_goal_lookahead_interpolate.gif](../_images/rpp_goal_lookahead_interpolate.gif)](../_images/rpp_goal_lookahead_interpolate.gif)

Additionally, the conflict between `use_rotate_to_heading` and `allow_reversing` was fixed so `use_rotate_to_heading` can now be used backward.

##### Cancel Checker Interface For GlobalPlanner

[PR #4148](https://github.com/ros-navigation/navigation2/pull/4148) introduces a new interface for the `GlobalPlanner` to allow for the cancellation of the current planning task.
Before the planners would continue to plan even if the goal was cancelled, now they can check it and stop planning if the goal is cancelled.
New interface for `GlobalPlanner::createPlan`:

```
virtual nav_msgs::msg::Path createPlan(
  const geometry_msgs::msg::PoseStamped & start,
  const geometry_msgs::msg::PoseStamped & goal,
  std::function<bool()> cancel_checker)
```

This is implemented for all the planners in the stack, you can check them for the example use of `cancel_checker` function (simply check `cancel_checker()`).
Smac and Theta\* planners have a new parameter `terminal_checking_interval` which is the frequency of the cancel or timeout checking in terms of number of iterations.

##### New BtActionServer/BtNavigator parameter

[PR #4209](https://github.com/ros-navigation/navigation2/pull/4209) introduces a new boolean parameter `always_reload_bt_xml`, which enables the possibility to always reload a requested behavior tree XML description, regardless of the currently active XML. This allows keeping the action server running while changing/developing the XML description.

##### New collision monitor parameter

[PR #4207](https://github.com/ros-navigation/navigation2/pull/4207) introduces a new boolean parameter `polygon_subscribe_transient_local` (value is false by default), which set the QoS durability for polygon topic or footprint topic subscription.

##### New graceful cancellation API for Controllers

[PR #4136](https://github.com/ros-navigation/navigation2/pull/4136) introduces a new graceful cancellation API for controllers. Previously when a goal was canceled, the controller would stop the robot immediately. This API allows the controller to stop the robot in a more graceful way. The new API is implemented in the `RegulatedPurePursuitController` by adding a new parameter `cancel_deceleration`. So when the goal is canceled, a constant deceleration will be used while continuing to track the path to stop the robot instead of stopping immediately. This API can be should be added to all controllers that have acceleration limits.

##### Standardization of Plugin Naming with Double Colons (::)

[PR #4220](https://github.com/ros-planning/navigation2/pull/4220) standardizes plugin naming across the Navigation2 package to use double colons (::), replacing the previous mixed use of slashes (/) and double colons. Affected plugins include:

* Behavior Server: `nav2_behaviors::Spin`, `nav2_behaviors::BackUp`, `nav2_behaviors::DriveOnHeading`, `nav2_behaviors::Wait`, `nav2_behaviors::AssistedTeleop`
* Planner Server: `nav2_navfn_planner::NavfnPlanner`, `nav2_smac_planner::SmacPlanner2D`, `nav2_smac_planner::SmacPlannerHybrid`, `nav2_theta_star_planner::ThetaStarPlanner`
* Controller Server: `nav2_regulated_pure_pursuit_controller::RegulatedPurePursuitController`, `nav2_dwb_controller::DWBLocalPlanner`
* BT Navigator: `nav2_bt_navigator::NavigateToPoseNavigator`, `nav2_bt_navigator::NavigateThroughPosesNavigator`

##### Collision monitor: dynamic radius for circle type polygons

[PR #4226](https://github.com/ros-navigation/navigation2/pull/4226) introduces usage of parameter `<polygon_name>.polygon_sub_topic` for circle type polygons. If parameter `<polygon_name>.radius` is not set, collision monitor node subscribes to topic `<polygon_name>.polygon_sub_topic` (subscription type is `std_msgs/msg/Float32`), and the current circle polygon radius will be updating accordingly to received messages on topic.

##### Static Layer: new parameter `footprint_clearing_enabled`

[PR #4282](https://github.com/ros-navigation/navigation2/pull/4282) introduces usage of parameter `footprint_clearing_enabled` for the static layer. It works similarly to the `footprint_clearing_enabled` parameter in the obstacle and voxel layer. If set to `true`, the static layer will clear the costmap cells that are within the robot’s footprint. It is `false` by default to keep the previous behavior.

##### Lifecycle Node: added bond\_heartbeat\_period parameter (and allow disabling the bond mechanism)

[PR #4342](https://github.com/ros-navigation/navigation2/pull/4342) adds the parameter `bond_heartbeat_period` to the lifecycle nodes to customize the bond mechanism publishing period (on the `/bond` topic). Default value is 0.1s. Disabled if inferior or equal to 0.0.

##### Rotation Shim Controller: new parameter `rotate_to_goal_heading`

[PR #4332](https://github.com/ros-navigation/navigation2/pull/4332) introduces usage of parameter `rotate_to_goal_heading` for the rotation shim controller. It allows the rotation shim controller to take back control when reaching the XY goal tolerance to perform a clean rotation towards the goal heading. Some controllers will do this internally, but it is a useful option for others.

##### MPPI Controller: Addition of acceleration constraints

[PR #4352](https://github.com/ros-navigation/navigation2/pull/4352) adds new parameters `ax_max`, `ax_min`, `ay_max`, `az_max` for the MPPI controller. These parameters will enable the MPPI controller to generate local trajectories within the specified acceleration constraints.

##### RegulatedPurePursuit Controller [RPP]: new parameter `use_cancel_deceleration`

[PR #4441](https://github.com/ros-navigation/navigation2/pull/4441) adds a new parameter use\_cancel\_deceleration for the regulated pure pursuit controllers. This parameter enables the controller to use a constant deceleration to stop the robot gracefully instead of stopping immediately when a goal is canceled.

##### Clear Costamp Around Passed Pose

In [PR #5309](https://github.com/ros-navigation/navigation2/pull/5309), a new service was added to the nav2\_costmap\_2d package to clear the costmap around a passed pose.

A service client was also added to the clear costmap plugin in the nav2\_behavior\_tree package.

This is particularly useful in scenarios where the planner fails due to outdated costmap data at the goal location which is outside of your obstacle/raytrace range—often caused by dynamic obstacles that have since moved. Instead of clearing the entire costmap as a recovery behavior, this feature would enable targeted clearing, preserving useful map data.

[![../_images/ClearCostmapGoalPose.gif](../_images/ClearCostmapGoalPose.gif)](../_images/ClearCostmapGoalPose.gif)

***RViz visualization shows an example of clearing outdated cost at the desired goal location, this would have previously caused planners like SMAC planner to fail.***

The following is an example of how to use ClearCostmapAroundPose in a behavior tree to clear the costmap around a goal pose in the event that the planner fails to compute a path.

```
<RateController hz="1.0">
  <RecoveryNode number_of_retries="1" name="ComputePathToPose">
      <ComputePathToPose goal="{goal}" path="{path}" planner_id="{selected_planner}" error_code_id="{compute_path_error_code}" error_msg="{compute_path_error_msg}"/>
      <ClearCostmapAroundPose name="ClearCostmapAroundPose-Context" service_name="global_costmap/clear_around_pose_global_costmap" pose="{goal}" reset_distance="5.0"/>
  </RecoveryNode>
</RateController>
```

---

### Jazzy to Kilted

*Source: [https://docs.nav2.org/migration/Jazzy.html](https://docs.nav2.org/migration/Jazzy.html)*

#### Jazzy to Kilted

Moving from ROS 2 Jazzy to Kilted, a number of stability improvements were added that we will not specifically address here.

##### Nav2 Route Server

The Route Server in `nav2_route` implements the server for computing routes through a predefined navigation graph rather than using freespace planning like the Planner Server.
It may be used to fully replace freespace planning when following a particular route closely or to augment the global planner with long-distance routing to a goal.
In this case, the planner will generate feasible paths with localized environmental information for only the future part of the route necessary.

This is useful for industrial applications where the robot should deterministically plan within known areas, lanes, and/or routes rather than having free rein to globally navigate.
It is also useful for outdoor navigation in locations like urban centers on roadways or natural environments over vast distances.

It also includes a tracking feature that will track the route’s progression and provide live feedback on its status as well as trigger contextual operations at various nodes and edge events (change speed, turn on light, etc).

See [Route Server](../configuration/packages/configuring-route-server.html#configuring-croute-server) for additional configuration information, the tutorials on generating graphs and using it, and example graphs in `nav2_bringup` and `nav2_route`.

##### BehaviorTree error\_msg

In [PR #4459](https://github.com/ros-navigation/navigation2/pull/4459) adds error\_msg to all action result messages
and [PR #4460](https://github.com/ros-navigation/navigation2/pull/4460) captures and propagates error\_msg result strings through the bt\_navigator,
a new parameter for the BT Navigator `error_code_name_prefixes` was introduced, *AND* it is a *mandatory* replacement for `error_code_names`.

In other words the existence of the `error_code_names` parameter will be rejected as a runtime exception at startup and *MUST* be removed.

When configured correctly, and the behaviour tree xml configuration is modified appropriately, error codes and contextual error messages are propagated in the Result message of Nav2 action server requests.

This allows handling of specific errors with more contextual information, than simply the error code, to be viewed by application clients calling Nav2 or its servers.

Behavior tree based Navigator Action requests, require augmentation of behavior tree elements that support `error_code_id` and `error_msg` output ports.

The corresponding attribute values, must use port variable names that combine the relevant `error_code_names_prefix` with the suffix `_error_code` and `_error_msg`.

The following is an example of the `error_code_names` parameter that must be replaced

```
error_code_names:
  - compute_path_error_code
  - follow_path_error_code
```

with the `error_code_names_prefixes` parameter which specifies prefixes for the current set of built in action servers.

```
error_code_name_prefixes:
  - assisted_teleop
  - backup
  - compute_path
  - dock_robot
  - drive_on_heading
  - follow_path
  - nav_thru_poses
  - nav_to_pose
  - spin
  - route
  - undock_robot
  - wait
```

The following provides examples of modifications that should be made to behavior tree configurations to propagate the error messages and codes to the BT navigator result.

```
<ComputePathToPose goal="{goal}" path="{path}" planner_id="{selected_planner}" error_code_id="{compute_path_error_code}" error_msg="{compute_path_error_msg}"/>
<FollowPath path="{path}" controller_id="{selected_controller}" error_code_id="{follow_path_error_code}" error_msg="{follow_path_error_msg}"/>
<Spin spin_dist="1.57" error_code_id="{spin_error_code}" error_msg="{spin_error_msg}"/>
<Wait wait_duration="5.0" error_code_id="{wait_error_code}" error_msg="{wait_error_msg}"/>
<BackUp backup_dist="0.30" backup_speed="0.15" error_code_id="{backup_error_code}" error_msg="{backup_error_msg}"/>
<DriveOnHeading dist_to_travel="2.0" speed="0.2" time_allowance="12" error_code_id="{drive_on_heading_error_code}" error_msg="{drive_on_heading_error_msg}"/>
<UndockRobot dock_type="{dock_type}" error_code_id="{undock_robot_error_code}" error_msg="{undock_robot_error_msg}" />
<DockRobot dock_id="{dock_id}" error_code_id="{dock_robot_error_code}" error_msg="{dock_robot_error_msg}"/>
<NavigateToPose goal="{picking_location}" error_code_id="{nav_to_pose_error_code}" error_msg="{nav_to_pose_error_msg}"/>
```

The explicit specification of the `error_code_names_prefix` for both `error_code_id` and `error_msg` in the behavior tree xml is done to provide a configuration based level of indirection to enable resolution of namespace conflicts between built in Nav2 and third party actions servers.

If custom `BTActionServer`, `BehaviorTreeNavigator`, or associated BT nodes for task servers exist in your system, please review the PR to update the files to support the error code propagation.

##### TwistStamped Default CmdVel Change

In Kilted and newer, the default `cmd_vel` topic for all `Twist` publishers and subscriptions is changed to `TwistStamped` in order to enable a broader range of applications.
it also allows for rejection of stale velocity messages, which can be useful in some applications.
Your robot should now subscribe to a `TwistStamped` message instead of a `Twist` message & update your simulation appropriately.
The topic names are the same.

However, this can be disabled by setting `enable_stamped_cmd_vel` to `false` in the `nav2_params.yaml` file for all nodes that involve Twist subscriptions or publications.
See the configuration guide for more information on how to configure this parameter for each node.

An example simulation migration using Gazebo can be seen in the [following pull request for the Turtlebot 3 and 4](https://github.com/ros-navigation/nav2_minimal_turtlebot_simulation/pull/16).

##### New Nav2 Loopback Simulator

The `nav2_loopback_sim` is a stand-alone simulator to create a “loopback” for non-physical simulation to replace robot hardware, physics simulators (Gazebo, Bullet, Isaac Sim, etc).
It computes the robot’s odometry based on the command velocity’s output request to create a perfect ‘frictionless plane’-style simulation for unit testing, system testing, R&D on higher level systems, testing behaviors without concerning yourself with localization accuracy or system dynamics, and multirobot simulations.

##### Docking with Static Infrastructure or Dynamic Docking

In [PR #4627](https://github.com/ros-navigation/navigation2/pull/4627) a docking plugin type and logic was added to support non-charging dock types in the nav2 docking server.
This allows users to specify docking locations to static infrastructure, such as conveyers, or dynamic docking locations, such as a pallet.
It also includes a new docking plugin to demonstrate the new docking server capabilities `simple_non_charging_dock`.

##### New RViz panel for Docking

In [PR #4458](https://github.com/ros-navigation/navigation2/pull/4458) a new RViz panel was added to interact with the Docking Server.

This panel allows the user to:

* Dock the robot to a charger, selecting the dock id or the dock pose and type. It also allows the user to set whether or not to navigate to the staging pose.
* Undock the robot from a charger.

The panel displays the action goal status and feedback published by `nav2_msgs/DockRobot` and `nav2_msgs/UndockRobot` actions. Users can find information such as elapsed time, number of retries and the current state of the action (staging, controlling, etc.), as well as the error codes of the action.

Here we can see the working demo of the plugin:

![../_images/docking_panel.gif](../_images/docking_panel.gif)

Attention

If the docking server is unavailable, then the combo box of the dock type will be empty.

##### BT Nodes Changes

Below is a list of new BT Nodes added:

* `GetPoseFromPath`: An action to get a particular pose from an input path.
* `RemoveInCollisionGoals`: An action to remove waypoints that have a cost higher than a threshold.
* `IsStopped`: A condition to check if the robot is stopped for a certain duration.

Below is a list of changes to existing BT Nodes:

* `GoalUpdater`: It now supports updating a list of goals as well (useful for NavigateThroughPoses interface)

##### New RViz Tool for Costmap Cost Cell Inspection

In [PR #4546](https://github.com/ros-navigation/navigation2/pull/4546) a new RViz tool was added to get the costmap costcell’s cost and a service to get the costcell’s cost at the footprint pose.

Usage:

* Click on any point in the costmap with costmap rviz tool to retrieve and display the cost value at that cell.
* `nav2_msgs/GetCosts` service can be used to retrieve the cost at footprint pose

Working demo of the tool:

![../_images/rviz_costmap_cost_tool.gif](../_images/rviz_costmap_cost_tool.gif)

Attention

If the costmap service is unavailable, then the tool will not be able to fetch and display the cost values.

##### Fix flickering visualization

In [PR #4561](https://github.com/ros-navigation/navigation2/pull/4561) a `map_vis_z` parameter has been introduced to Costmap2DROS to help modify the map slightly below the default plane, aiming to eliminate rviz visualization flickering issues.

Default Value:

* map\_vis\_z: 0.0

Minimum Value Without Flickering:

* map\_vis\_z: -0.008

Before:

![../_images/fix_flickering_visualization_before.png](../_images/fix_flickering_visualization_before.png)

After:

![../_images/fix_flickering_visualization_after.png](../_images/fix_flickering_visualization_after.png)

##### Option to limit velocity through DWB trajectory

In [PR #4663](https://github.com/ros-navigation/navigation2/pull/4663) a `limit_vel_cmd_in_traj` parameter was introduced to DWB local planner to allow the user to limit the velocity used in the trajectory generation based on the robot’s current velocity.

Default value:

* false

##### Option to disable zero velocity publishing on goal exit

In [PR #4675](https://github.com/ros-navigation/navigation2/pull/4675) a `publish_zero_velocity` parameter was introduced for the [Controller server](/configuration/packages/configuring-controller-server.html#controller-server) in order to disable zero velocity publishing on goal exit.

Default value:

* true

##### Rotation Shim Disengagement Threshold

The parameter `angular_disengage_threshold` was introduced as a new threshold for disengagement of the rotation in the rotation shim controller.
Previous behavior rotated until the `angular_dist_threshold`, now it can rotate until the `angular_disengage_threshold`, which can be set closer to the path’s orientation if desired.

##### Added optional collision checking for the Docking Server

In [PR #4752](https://github.com/ros-navigation/navigation2/pull/4752) an optional collision checking feature was added to the [Docking server](/configuration/packages/configuring-docking-server.html#docking-server) to check for collisions between the robot and the dock.

Default value:

* true

##### Revamped multirobot bringup and config files to use namespaces

In [PR #4715](https://github.com/ros-navigation/navigation2/pull/4715) multirobot bringup and the use of namespaces were overhauled to be compatible out of the box with ROS namespaces and remove custom logic, specifically:

* The `use_namespace` parameter has been removed from `nav2_bringup` launch files. The `namespace` parameter will now always be used and default to `/` for “global namespace”.
* There is now a single rviz config file for both normal and namespaced robots. Topics have been changed to a relative path (i.e. `/map` -> `map`) and the rviz `namespace` will be added automatically.
* There is now a single `nav2_params.yaml` config file for both single and multirobot bringup. All the topics have been changed to relative (i.e. `/scan` -> `scan`).

Note that some plugins / nodes might have their own local namespace. This is the case for `CostmapLayer` which will be in a `/ns/[layer_name]` namespace. For these, a new function `joinWithParentNamespace` has been added to make sure joining relative paths results in `/ns/topic_name` rather than `/ns/[layer_name]/topic_name`.

If your use case doesn’t require multiple robots, keeping absolute paths in your `nav2_params.yaml` config file and rviz config file will preserve existing behavior.

For example, if you specify `topic: scan` in the `voxel_layer` of a `local_costmap` and you launch your bringup with a `tb4` namespace:

* User chosen namespace is `tb4`.
* User chosen topic is `scan`.
* Topic will be remapped to `/tb4/scan` without `local_costmap`.
* Use global topic `/scan` if you do not wish the node namespace to apply

##### Removed global map\_topic from Costmap node

In [PR #4715](https://github.com/ros-navigation/navigation2/pull/4715) the global `map_topic` parameter has been removed from the `Costmap2DROS` node. This parameterwas only used in the `StaticLayer` and should be defined as a parameter local to the `StaticLayer` instead, for example:

```
global_costmap:
  global_costmap:
    ros__parameters:
      [...]
      # Not supported anymore
      map_topic: my_map
      static_layer:
        plugin: "nav2_costmap_2d::StaticLayer"
        map_subscribe_transient_local: True
        # Do this instead
        map_topic: my_map
```

##### Simplified Costmap2DROS constructors

The following constructors for `Costmap2DROS` have been removed:

```
explicit Costmap2DROS(
 const std::string & name,
 const std::string & parent_namespace,
 const std::string & local_namespace,
 const bool & use_sim_time);

explicit Costmap2DROS(const std::string & name, const bool & use_sim_time = false);
```

They have been consolidated into a single one:

```
explicit Costmap2DROS(
 const std::string & name,
 const std::string & parent_namespace = "/",
 const bool & use_sim_time = false);
```

The `local_namespace` parameter has been removed and is now automatically set to the node’s name (which is what the second removed constructor did).
Parameters `parent_namespace` / `use_sim_time` both provide default values to maintain the ability of creating a `Costmap2DROS` object by just specifying a name.

##### Option to disable collision checking in DriveOnHeading, BackUp and Spin Actions

In [PR #4785](https://github.com/ros-navigation/navigation2/pull/4785) a new boolean parameter named disable\_collision\_checks was added to the DriveOnHeading, BackUp and Spin actions to optionally disable collision checking.
This can be useful, for example, in cases where you want to move the robot even in the presence of known obstacles.

Default value:

* false

##### New Plugin Container Layer

In [PR #4781](https://github.com/ros-navigation/navigation2/pull/4781) a costmap layer plugin type was added to support the grouping of different costmap layers under a single costmap layer. This would allow for different isolated combinations of costmap layers to be combined under one parent costmap instead of the current implementation which would indiscriminately combine all costmap layers together.

##### Iterative Target Selection for the Graceful Controller

In [PR #4795](https://github.com/ros-navigation/navigation2/pull/4795) the `nav2_graceful_controller` was updated to iteratively select motion targets. This is a large refactor which significantly improves the performance of the controller. The `motion_target_dist` parameter has been replaced by `min_lookahead` and `max_lookahead` parameters. Additional changes include:

* Improved defaults for `k_phi`, `k_delta`, `beta` parameters of the underlying control law.
* Automatic creation of orientations for the plan if they are missing.
* Addition of `v_angular_min_in_place` parameter to avoid the robot getting stuck while rotating due to mechanical limitations.
* `final_rotation` has been renamed `prefer_final_rotation` and the behavior has changed slightly.

##### Conform to ROS 2 launch syntax in Turtlebot 3 multi-robot launch file

In [PR #5000](https://github.com/ros-navigation/navigation2/pull/5000) the `cloned_multi_tb3_simulation_launch.py` launch file was updated so that parsing the robots conforms to the ROS 2 launch file standards. This change allows users to pass the `robots` from another launch file through `launch_arguments` which was not possible with the old version.

Example for including `cloned_multi_tb3_simulation_launch.py` in another launch file:

```
IncludeLaunchDescription(
    PythonLaunchDescriptionSource(
        os.path.join(get_package_share_directory('nav2_bringup'), "launch", "cloned_multi_tb3_simulation_launch.py")
    ),
    launch_arguments={"robots": "{name: 'robot1', pose: {x: 0.5, y: 0.5, yaw: 1.5707}}"}.items(),
)
```

##### ComputePathThroughPoses, NavigateThroughPoses and other BT nodes now use nav\_msgs/Goals instead of vector<PoseStamped>

In [PR #269](https://github.com/ros2/common_interfaces/pull/269) a new message type Goals was introduced to the nav\_msgs package.
In [PR #4980](https://github.com/ros-navigation/navigation2/pull/4980), all collections of PoseStamped has been migrated to use the nav\_msgs::msg::Goals message. Most notably, NavigateThroughPoses.action and ComputePathThroughPoses.action have been updated to use nav\_msgs/Goals.
Since nav\_msgs/Goals contains a header, the poses are now accessed via NavigateThroughPoses.poses.goals instead of NavigateThroughPoses.poses or ComputePathThroughPoses.goals.goals instead of ComputePathThroughPoses.poses. Please update your code accordingly when using these interfaces.

##### MPPI controller re-implemented using Eigen library and performance improved by 40-45%

In the [PR #4621](https://github.com/ros-navigation/navigation2/pull/4621) MPPI controller is fully reimplemented using Eigen as it is well supported hpc library and suits better for our use case of two dimensional batches of trajectories. GPU support for rolling out trajectories could also be possible in future using Eigen.
MPPI Optimizer’s performance is improved by 40-50%. Now MPPI Controller can also be run on ARM processors which do not support SIMD Instructions extensively.

##### Enable goal orientation non-specificity

[PR #4148](https://github.com/ros-planning/navigation2/pull/4127) introduces two new parameters(goal\_heading\_mode, coarse\_search\_resolution) in the smac planner, specifically the smac planner hybrid and smac planner lattice that allows for the
planner to plan to a goal with multiple orientations and return the best path in just one planning call. This is useful for robots that can approach a goal from multiple orientations and the user does not want to plan to each orientation separately.
In addition to this, the coarse\_search\_resolution parameter is added to the smac planner lattice to allow for a faster search for the best path.

Here is an Example of the smacHybrid planner with the default goal\_heading\_mode to see the difference in the planned path.

[![Navigation2 with smacHybrid planner with default goal_heading_mode](../_images/smacHybrid_with_default_goal_heading_mode.gif)](../_images/smacHybrid_with_default_goal_heading_mode.gif)

Here is an Example of the smacHybrid planner with the bidirectional goal\_heading\_mode to see the difference in the planned path.

[![Navigation2 with smacHybrid planner with bidirectional goal_heading_mode](../_images/smacHybrid_with_bidirectional_goal_heading_mode.gif)](../_images/smacHybrid_with_bidirectional_goal_heading_mode.gif)

Here is an Example of the smacHybrid planner with the all\_directions goal\_heading\_mode to see the difference in the planned path.

[![Navigation2 with smacHybrid planner with all_direction goal_heading_mode](../_images/smacHybrid_with_all_direction_goal_heading_mode.gif)](../_images/smacHybrid_with_all_direction_goal_heading_mode.gif)

##### DriveOnHeading and BackUp behaviors: Addition of acceleration constraints

[PR #4810](https://github.com/ros-navigation/navigation2/pull/4810) adds new parameters `acceleration_limit`, `deceleration_limit`, `minimum_speed` for the DriveOnHeading and BackUp Behaviors. The default values are as follows:

* `acceleration_limit`: 2.5
* `deceleration_limit`: -2.5
* `minimum_speed`: 0.10

##### Rotation Shim Deceleration as a function of its target orientation

In [PR #4864](https://github.com/ros-navigation/navigation2/pull/4864) the Rotation Shim Controller was updated to decelerate as a function of its target orientation. This allows the robot to slow down as it approaches its target orientation, reducing overshoot when passing to the primary controller. The deceleration is controlled by the max\_angular\_accel parameter.

A demo can be seen below with the following parameters:

```
[...]:
  plugin: "nav2_rotation_shim_controller::RotationShimController"
  angular_dist_threshold: 1.22 # (70 degrees)
  angular_disengage_threshold: 0.05 # (3 degrees)
  rotate_to_heading_angular_vel: 0.8
  max_angular_accel: 0.5
```

[![Rotation Shim Deceleration](../_images/rotation_shim_decel.gif)](../_images/rotation_shim_decel.gif)

##### Rotation Shim Open-loop Control

The parameter `closed_loop` was introduced to the Rotation Shim Controller to allow users to choose between open-loop and closed-loop control. If false, the rotationShimController will use the last commanded velocity as the next iteration’s current velocity. When acceleration limits are set appropriately and the robot’s controllers are responsive, this can be a good assumption. If true, it will use odometry to estimate the robot’s current speed. In this case it is important that the source is high-rate and low-latency to account for control delay.

Default value:

* true

##### Near collision cost in MPPI cost critic

In [PR #4996](https://github.com/ros-navigation/navigation2/pull/4996) a new parameter `near_collision_cost` was added to the MPPI cost critic to set a maximum proximity for avoidance. The critical cost will be applied to costs higher than this value even if non-collision inducing.

Default value:

* 253

##### Service introspection

In [PR #4955](https://github.com/ros-navigation/navigation2/pull/4955) the parameter `service_introspection_mode` was introduced to the Nav2 stack to allow introspection of services. The options are “disabled”, “metadata”, “contents”.

Default value:

* “disabled”

##### Rotation Shim Using Path Orientations

The parameter `use_path_orientations` was introduced to the Rotation Shim Controller to allow users to choose between using the orientations of the path points to compute the heading of the path instead of computing the heading from the path point’s relative locations. This is useful for planners that generate feasible paths with orientations for forward and reverse motion, such as the Smac Planner.

Default value:

* false

##### MPPI - Publishing Optimal Trajectory

When `publish_optimal_trajectory` is enabled, the full optimal trajectory in the form of a `nav2_msgs/Trajectory` is published for debugging, visualization, and/or injection by other systems. This provides not just the pose information but velocities and timestamps of the MPC trajectory’s viapoints which can be useful for multi-stage control systems, jerk minimization, or collision avoidance systems.

##### NavigateThroughPoses - Reporting waypoint statuses information

[PR #4994](https://github.com/ros-navigation/navigation2/pull/4994) enhances the `NavigateThroughPoses` navigator to provide real-time status feedback for waypoints.
Introduces the `WaypointStatus` message type, which indicates a waypoint’s status: pending, complete, skipped, or failed.
This also replaces the deprecated `MissedWaypoint` type used in `WaypointFollower`.
This also updates the behavior tree nodes `RemovePassedGoals` and `RemoveInCollisionGoals` to mark waypoint statuses as the action progresses.
`NavigateThroughPoses` now retrieves waypoint statuses via the blackboard (similar to path and goal(s)) and organizes them into the action server’s feedback and result messages, exposing the waypoint execution status to users.

The parameter `waypoint_statuses_blackboard_id` was introduced to the `bt_navigator` node to allow users to customize the variable name for `waypoint_statuses` in the blackboard.
In the Behavior Tree XML, the `RemovePassedGoals` and `RemoveInCollisionGoals` nodes must expose corresponding ports to align with the `waypoint_statuses` workflow to manage the waypoints’ state when removing them due to completion or skipped due to collision.
This ensures `NavigateThroughPoses` can retrieve and propagate waypoint statuses via the blackboard.
The action also populates the completed waypoints at the end when populating the action result.

The following is an example of the `RemovePassedGoals` and `RemoveInCollisionGoals` nodes configuration:

```
<RemovePassedGoals input_goals="{goals}" output_goals="{goals}" radius="0.7" input_waypoint_statuses="{waypoint_statuses}" output_waypoint_statuses="{waypoint_statuses}"/>
<RemoveInCollisionGoals input_goals="{goals}" output_goals="{goals}" cost_threshold="254.0" use_footprint="true" service_name="/global_costmap/get_cost_global_costmap" input_waypoint_statuses="{waypoint_statuses}" output_waypoint_statuses="{waypoint_statuses}" />
```

The `waypoint_statuses` array matches the length of the original input `goals` vector, with each element being a `WaypointStatus` message.
The `RemovePassedGoals` and `RemoveInCollisionGoals` nodes prune invalid or completed goals from the goals vector and update their corresponding entries in the `waypoint_statuses` array.

Custom nodes can access or modify the `waypoint_statuses` array as well if other skip, removal, completion, or failures are used when working with multiple ordered goals. Use the utility method `find_next_matching_goal_in_waypoint_statuses` (from nav2\_utils) to map goals to their status entries.
Modified statuses should then be propagated through output ports for downstream nodes.

The `NavigateThroughPoses` navigator retrieves the `waypoint_statuses` instance from the blackboard in its `onLoop` callback and writes it into the feedback message.
During the `goalCompleted` callback, it fetches the `waypoint_statuses` instance and, based on the BT’s final execution status (`final_bt_status`), updates any waypoints still in the `PENDING` state to either `COMPLETED` (if `final_bt_status` is `SUCCEEDED`) or `FAILED` (otherwise).

##### Groot 2 Support

In [PR #5065](https://github.com/ros-navigation/navigation2/pull/5065) , BT navigators: `navigate_to_pose` and `navigate_through_poses` now support live monitoring and visualization of the behavior tree using Groot 2. JSON conversions are also available to see the content of the Blackboard, allowing the introspection of the BT nodes. Switching bt-xmls on the fly through a new goal request is also included.

Because live monitoring of Behavior Tree with more than 20 nodes and visualizing the content of the blackboard is a PRO (paid) feature of Groot 2. This feature is disabled by default.

Note

Currently, there is a known bug that crashes Groot 2 when visualizing vectors and related types (e.g., `Goals` and `Path`) contained in the blackboard. Efforts are underway to resolve this issue. For updates, please refer to the following links: [Groot2 issue #55](https://github.com/BehaviorTree/Groot2/issues/55) and [BehaviorTree PR #958](https://github.com/BehaviorTree/BehaviorTree.CPP/pull/958).

##### Docking backwards as plugin parameter

In [PR #5079](https://github.com/ros-navigation/navigation2/pull/5079), the `dock_backwards` boolean parameter has been moved from the docking server to the dock plugin as the string parameter `dock_direction`. This allows the user to have multiple dock plugins with different directions in the same docking server. Default value is `forward` but may also be set as `backward`.

See [Docking Server](../configuration/packages/configuring-docking-server.html#configuring-docking-server) for more information.

##### New Position Goal Checker

In [PR #5162](https://github.com/ros-navigation/navigation2/pull/5162), a new goal checker plugin called `PositionGoalChecker` has been added to Nav2. This plugin provides an alternative to the existing goal checkers by focusing only on the position component of the robot pose, ignoring orientation. This is used by the RPP controller to create stateful behavior to rotate to heading once meeting the goal tolerance.

##### Docking backwards without sensor

In [PR #5153](https://github.com/ros-navigation/navigation2/pull/5153), the docking server was updated to allow docking backwards without a sensor for detection. It should be setup to approach the staging pose for the dock in the forward direction with sensor coverage for dock detection, then after detection it will rotate to back up into the dock using the initial detected pose only for deadreckoning.

A new parameter `reverse_to_dock` was added to the `SimpleChargingDock` and `SimpleNonChargingDock` plugins to allow this feature.

Default value:

* false

See [Docking Server](../configuration/packages/configuring-docking-server.html#configuring-docking-server) for more information.

Here we can see the working demo of the feature:

![../_images/reverse_to_dock.gif](../_images/reverse_to_dock.gif)

##### RegulatedPurePursuit Controller [RPP]: new parameter `stateful`

[PR #5167](https://github.com/ros-navigation/navigation2/pull/5167) adds a new parameter stateful for the regulated pure pursuit controllers. This parameter enables stateful goal handling behavior. When set to true, the controller will persist the goal state once the robot reaches the XY tolerance. It will then focus on aligning to the goal heading without reverting to XY position corrections.

##### Controller Server Frequency Removed Dynamic Parameter

[PR #5106](https://github.com/ros-navigation/navigation2/pull/5106) removes `control_frequency` as a dynamic parameter.
This is done so that the plugins can identify which parameters belong to itself and not the larger servers to perform dynamic reconfigurations.
The controller server would update this value but the internal plugins would not properly so it was removed.
If you rely on this behavior, please file a ticket and discuss with maintainers how to re-add.

##### Default bringup supports keepout, speed zones, and route planning

In [PR #5125](https://github.com/ros-navigation/navigation2/pull/5125), keepout zones were added to the depot and warehouse maps of the Turtlebot4 simulation in Gazebo.

For the depot map, the keepout zones were aimed at preventing the robot from entering under the shelves, blocking the entrance of the stairwell and
entering the surrounding area with the eight pallets to limit entrance from high-movement regions.

For the warehouse map, the keepout zones were aimed at preventing the robot from planning paths through free chairs and a region of high movement in the middle of the warehouse.

In [PR #5146](https://github.com/ros-navigation/navigation2/pull/5146), speed zones were added to the depot and warehouse maps of the Turtlebot4 simulation in Gazebo.

For the depot map, the shelves were encompassed in a speed zone of 75% of the maximum speed and the area around the pallets were limited to 50% of the maximum speed.

For the warehouse map, the area around the beams and the middle of the warehouse were limited to 80% of the maximum speed.

[![../_images/depot_graph.png](../_images/depot_graph.png)](../_images/depot_graph.png)

***The keepout zones are marked in pink, and the speed zones are marked with grey with proportional opacity to the speed limit.***

In [PR #5160](https://github.com/ros-navigation/navigation2/pull/5160), graph support was added to the warehouse world of the Turtlebot4 simulation in Gazebo.
This allows users to visualize the route server in action and test the new features of the route server. The demo includes a simple route with a few waypoints and a graph to follow.

[![../_images/warehouse_graph.png](../_images/warehouse_graph.png)](../_images/warehouse_graph.png)

***RViz visualization of the route graph for the warehouse environment. All nodes are bidirectional, except the ones that are annotated. Speed zones are marked in grey with proportional opacity of 0.8 to match the speed limit.***

---

### Kilted to L-turtle

*Source: [https://docs.nav2.org/migration/Kilted.html](https://docs.nav2.org/migration/Kilted.html)*

#### Kilted to L-turtle

Moving from ROS 2 Kilted to L-Turtle, a number of stability improvements were added that we will not specifically address here.

##### New Nav2 ROS Common & Nav2 Lifecycle Node

Starting in Lyrical, a new package `nav2_ros_common` was added that contains a set of Nav2, ROS 2 utilities, wrappers, and overrides for working with ROS 2 in Nav2 in a standardized and controllable way.
This ingests previous capabilities from `nav2_util` like the `LifecycleNode` and `SimpleActionServer`, but extends it to wrap all ROS 2 interfaces with Nav2 variants in the `nav2::` namespace.
The new `nav2::LifecycleNode`’s factory members (`create_client`, `create_service`, `create_publisher`, `create_subscriber`, `create_action_server`, and `create_action_client`) now return these Nav2 objects.
This requires some migration of custom plugins, Task Servers, or other components in the Nav2 styling and/or application that wish to use Nav2’s utilities.
Additionally, it contains a set of QoS profiles to be globally used within the stack to give developers complete control over the QoS settings of the system and a one-stop location to update or test different profiles and be applied globally in the stack.

This work is motived by a need to set certain global configurations for interfaces, such as enabling QoS overrides for publishers and subscribers via a run-time parameter and enabling Action and Service introspection.
It also lets us add additional configuration, tracing, advanced features, and wrappers than was previously possible throughout the codebase at large.

The expectation is that all Nav2 nodes and packages use the utilities in this package globally to be consistent and to avoid code duplication.
The lifecycle node includes factories for subscriptions, publishers, clients, and servers that return Nav2 objects in this package rather than the ROS 2 base classes as a level of abstraction of common boilerplate configurations and capabilities.
The factories are listed below:

* create\_client –> nav2::ServiceClient
* create\_service –> nav2::ServiceServer
* create\_publisher –> nav2::Publisher
* create\_subscriber –> nav2::Subscriber
* create\_action\_server –> nav2::SimpleActionServer
* create\_action\_client –> nav2::ActionClient

[A large-scale migration example can be found here](https://github.com/ros-navigation/navigation2/pull/5288).

In most cases, these are very similar to the previous `rclcpp` version.
If a previous `nav2_util` version existed, the APIs should be largely the same, except now they should be constructed using the `create_*` factory rather than manually to make use of the abstracted configuration settings and advanced features to come.
Where changed, it is typically to move the QoS profile specification to the end of the arguments, which is now optional and defaults to the nav2::qos::StandardTopicQoS profile (reliable, volitile, queue depth of 10).

* nav2\_util::LifecycleNode is now nav2::LifecycleNode, which is largely the same except for the factories and a couple of internal implementation details.
* The Service Client, Service Server, and Simple Action Server were also moved to the nav2:: namespace, but they should not be accessed directly. Use the create\_\* factories from the nav2::LifecycleNode, such as create\_action\_server or create\_action\_client.
* There are now nav2::qos profiles for QoS to be used in the codebase for homologation and later easier changing: nav2::qos::StandardTopicQoS nav2::qos::LatchedPublisherQoS, nav2::qos::LatchedSubscriberQoS and nav2::qos::SensorDataQoS. These should be used rather than rclcpp profiles.
* The APIs for create\_\* are very similar to the default ones, but slightly different to move the now optional QoS profile specification below required information. When this is not specified the StandardTopicQoS is used (reliable, queue size 10). Only override this if you want another QoS type. Avoid use of SystemDefaultsQoS.

###### Plugin Migration

All plugins now use nav2::LifecycleNode instead of rclcpp\_lifecycle::LifecycleNode or nav2\_util::LifecycleNode.
All must be updated to use this new API from planners and controllers to behavior tree nodes.
Similarly, calls to the create\_\* factories will now point to the Nav2 objects, where applicable.
See above for what those look like and below for a migration from the existing code usage to the new version in order to make use of the new features and API.

###### Service Client Migration

We no longer need to create the object manually, nor should we as it bypasses the lifecycle node factories that set introspection and other future features.
We can use the node now to do this instead of passing in a node and we don’t need to specify the node type anymore as a template.
All Nav2 servers should use `nav2::ServiceClient<T>`.

```
// If using rclcpp::Client<T> from previous create_client factor
main_client_ = node->create_client<SrvT>(main_srv_name_, rclcpp::SystemDefaultsQoS(), callback_group_);  // Type rclcpp:Client<T>

// If using nav2_util::ServiceClient<T> manually
main_client_ =
  std::make_shared<nav2_util::ServiceClient<SrvT>>(
  main_srv_name_,
  node,
  false /* Does not create and spin an internal executor*/);  // Type nav2_util::ServiceClient<T>
```

To:

```
main_client_ = node->create_client<SrvT>(main_srv_name_, false  /* Does not create and spin an internal executor*/);  // Type nav2::ServiceClient<T>
```

If migrating from the `rclcpp::Client<T>` factory, check out the `nav2::ServiceClient<T>` API for its features like `invoke()` which wraps the async call and spinning for results using the given node or another internal executor.
You may optionally directly migrate by changing calls from `async_send_request` to `async_call` and otherwise handle the future in your application code.
It now supports service introspection using the parameter `introspection_mode`.

###### Service Server Migration

Services should now use `nav2::ServiceServer<T>` instead of `rclcpp::Service<T>` or `nav2_util::ServiceServer<T>`.
The factory is now available from the node `create_service(...)`, so we can use that to create the service server.
The callback should now include the `rmw_request_id_t` header now, so we have 3 placeholders rather than 2:

```
// If using previous create_service factory
  service_ = node->create_service<std_srvs::srv::Trigger>(
    std::string(node->get_name()) + "/" + getName() + "/reroute",
    std::bind(
      &ReroutingService::serviceCb, this,
      std::placeholders::_1, std::placeholders::_2));  // type rclcpp::Service<T>

// If using nav2_util::ServiceServer<T> manually
  service_ = std::make_shared<nav2_util::ServiceServer<std_srvs::srv::Trigger,
      std::shared_ptr<rclcpp_lifecycle::LifecycleNode>>>(
    std::string(node->get_name()) + "/" + getName() + "/reroute",
    node,
    std::bind(
      &ReroutingService::serviceCb, this,
      std::placeholders::_1, std::placeholders::_2, std::placeholders::_3));  // type nav2_util::ServiceServer<T>
```

To

```
service_ = node->create_service<std_srvs::srv::Trigger>(
  std::string(node->get_name()) + "/" + getName() + "/reroute",
  std::bind(&ReroutingService::serviceCb, this,
      std::placeholders::_1, std::placeholders::_2, std::placeholders::_3));  // type nav2::ServiceServer<T>
```

No additional changes should be required since the operations are handled in the same way as before.
It now supports service introspection using the parameter `introspection_mode`.

###### Action Server Migration

We can use the factory now from the node and the node is not required as an argument.
This otherwise does not change.
This is analog to the action server but configures with action introspection and other features that are not available in the base `rclcpp_action::Server<T>`.

```
compute_and_track_route_server_ = std::make_shared<ComputeAndTrackRouteServer>(
  node, "compute_and_track_route",
  std::bind(&RouteServer::computeAndTrackRoute, this),
  nullptr, std::chrono::milliseconds(500), true);  // Type nav2_util::SimpleActionServer<T>
```

To

```
compute_and_track_route_server_ = create_action_server<ComputeAndTrackRoute>(
  "compute_and_track_route",
  std::bind(&RouteServer::computeAndTrackRoute, this),
  nullptr, std::chrono::milliseconds(500), true);  // Type nav2::SimpleActionServer<T>
```

No additional changes should be required since the operations are handled in the same way as before.
It now supports action request, feedback, and result introspection using the parameter `introspection_mode`.

###### Action Client Migration

We can use the node now to create an action client using `create_action_client` without providing all the node interfaces.
This is analog to the action client but configures with action introspection and other features that are not available in the base `rclcpp_action::Client<T>`.

```
nav_to_pose_client_ = rclcpp_action::create_client<ClientT>(
  get_node_base_interface(),
  get_node_graph_interface(),
  get_node_logging_interface(),
  get_node_waitables_interface(),
  "navigate_to_pose", callback_group_);  // Type rclcpp_action::Client<T>
```

To

```
nav_to_pose_client_ = create_action_client<ClientT>(
  "navigate_to_pose", callback_group_);  // Type nav2::ActionClient<T>
```

No additional changes should be required since the operations are handled in the same way as before.
It now supports action request, feedback, and result introspection using the parameter `introspection_mode`.

###### Publisher Subscriber Migration

To migrate, the order of the arguments in the Subscription must change since the QoS profile is now optional. It is now `(topic, callback, QoS)` whereas QoS defaults to the StandardTopicQoS, which is the same as `rclcpp::QoS` for the moment.

Publishers that explicitly specify a QoS profile do not require changes, though if the constructor using depth is used, it must now specify a policy explicitly.
Both are now `nav2::Publisher` and `nav2::Subscription` objects that today just typedef the rclcpp and rclcpp\_lifecycle versions.
In the future, more features will be added here like lifecycle support for the subscriptions, so its highly recommended as part of this migration to migrate the `rclcpp::` to `nav2::` as well so those updates are already easily available.

```
plan_publisher_ = create_publisher<nav_msgs::msg::Path>("plan", 1);
plan_publisher_ = create_publisher<nav_msgs::msg::Path>("plan", rclcpp::QoS(), callback_group);

data_sub_ = node->create_subscription<sensor_msgs::msg::Range>(
  source_topic, range_qos,
  std::bind(&Range::dataCallback, this, std::placeholders::_1));
```

To

```
plan_publisher_ = create_publisher<nav_msgs::msg::Path>("plan");  // No QoS is required if using the StandardTopicQoS, else it can be provided

data_sub_ = node->create_subscription<sensor_msgs::msg::Range>(
  source_topic,
  std::bind(&Range::dataCallback, this, std::placeholders::_1));  // QoS can be omitted if using StandardTopicQoS, else it can be provided last
```

No additional changes should be required since the operations are handled in the same way as before.
Now, it supports future extensions for lifecycle subscriptions or additional wrapper APIs for ease of use.
Additionally, it supports QoS override using the parameter `allow_parameter_qos_overrides`.

##### Removed Parameter action\_server\_result\_timeout

Removed the parameter `action_server_result_timeout` from all action servers after resolution within `rcl` and `rclcpp` to address early goal removal.
This is not longer required to be set.

##### Dock Plugin Detector Control

[PR #5218](https://github.com/ros-navigation/navigation2/pull/5218) adds on-demand detector control to `opennav_docking`.
`ChargingDock` and `NonChargingDock` now provide pure virtual `startDetectionProcess` / `stopDetectionProcess` functions that the docking server invokes around the perception loop.

* Custom dock plugins must implement the new hooks (return `true` if nothing extra is required).
* `Simple(Non)ChargingDock` gained `detector_service_name`, `detector_service_timeout`, and `subscribe_toggle` parameters so a detector service can be triggered only while detections are needed.
* See [Docking Server](../configuration/packages/configuring-docking-server.html#configuring-docking-server) for the updated parameter reference and YAML example.

##### Added Corner Smoothing functionality to route\_server

In [PR #5226](https://github.com/ros-navigation/navigation2/pull/5226) the ability to stitch two successive edges in `route_server` with a smooth circular arc has been added. Below is an example of two successive edges forming a corner being smoothed with a radius of one. The red lines are the edges of the route graph and the green line is the resultant path that can be used by a local planner.

![../_images/smoothing.png](../_images/smoothing.png)

New parameters include `smooth_corners` which enable or disable corner smoothing and `smoothing_radius` which specifies the radius of the corner to fit to a corner. The tangents of the starting and ending points of the circular arc will match the tangent of the edges that form the corner. In the event that two edges are basically straight, no corner arc is added and regular linear interpolation is done. In addition to that, if the corner arc requires a starting point and ending point that’s longer than the edge lengths, then it will not add a corner arc.

##### Added NonblockingSequence Control Node

In [PR #5325](https://github.com/ros-navigation/navigation2/pull/5325) a new Nav2 specific behavior tree control node has been added. The new behavior tree control node, `NonblockingSequence`, allows every child node in the sequence to be ticked through even if one of the child node returns `RUNNING`. This is done to prevent long running child nodes from blocking the sequence.

For additional details regarding the `NonblockingSequence` please see the [Nav2 specific node walkthrough](../behavior_trees/overview/nav2_specific_nodes.html) and [NonblockingSequence configuration guide](../configuration/packages/bt-plugins/controls/NonblockingSequence.html).

##### MPPI Optimal Trajectory Validator Plugin

The MPPI controller now has a plugin, `OptimalTrajectoryValidator`, which can be used to validate an output trajectory for execution.
This can be used to check for collisions, margin from obstacles, distance from a path, progress being made, etc.
By default, it uses the `DefaultOptimalTrajectoryValidator` which checks for collisions.
Note that kinematic and dynamic constraints are not required to be checked as the Optimizer ensures these constraints are met.

##### Added PersistentSequence and PauseResumeController Control Nodes

In [PR #5247](https://github.com/ros-navigation/navigation2/pull/5247) two new Nav2 specific behavior tree control nodes have been added.

The [PauseResumeController](../configuration/packages/bt-plugins/controls/PauseResumeController.html) adds services to pause and resume execution of the tree. Related to this, the [PersistentSequence](../configuration/packages/bt-plugins/controls/PersistentSequence.html) control node allows the child index to be exposed to the behavior tree through a bidirectional port. This allows the sequence to be continued on resume where it was paused.

##### Option to use point\_cloud\_transport

In [PR #5264](https://github.com/ros-navigation/navigation2/pull/5264), option to use [point\_cloud\_transport](https://github.com/ros-perception/point_cloud_transport) has been added.
This enables transporting PointClouds using compression libraries (such as Draco, Zstd, Zlib, etc.) to reduce network traffic and work around DDS limitations in low-bandwidth environments.

Default value:

* `"raw"` - Uses `sensor_msgs/msg/PointCloud2` with no compression.

###### Configuration guide

If your sensor already publishes compressed streams (e.g., [Seterolabs ZED X Cameras](https://www.stereolabs.com/docs/ros2/dds_and_network_tuning#use-compressed-topics)), you can enable this option in the costmap layers that ingest pointcloud sensor streams (i.e. obstacle, voxel) and in the collision monitor as well.

Example costmap layer configuration:

```
<costmap_layer>:
  observation_sources: pointcloud
  pointcloud:
    data_type: "PointCloud2"
    topic: /intel_realsense_r200_depth/points  # Change this to your topic
    transport_type: "raw"  # Change this to your compressed format (zlib, draco, zstd)
```

Similarly for the collision monitor config:

```
collision_monitor:
  ros__parameters:
    observation_sources: ["pointcloud"]
    pointcloud:
      type: "pointcloud"
      topic: /intel_realsense_r200_depth/points  # Change this to your topic
      transport_type: "raw"  # Change this to your compressed format (zlib, draco, zstd)
```

See transport\_type in [Collision Monitor Node](../configuration/packages/collision_monitor/configuring-collision-monitor-node.html#configuring-collision-monitor-node) for more information.

###### Performance Metrics

Below are measured bandwidth values for different transport types with default parameters:

| Transport Type | Bandwidth (KB) |
| --- | --- |
| raw | 593.63 |
| draco | 443.28 |
| zstd | 64.33 |
| zlib | 121.95 |

##### Private BT Navigator’s BlackBoard ID parameters

The parameters `xx_blackboard_id` used in the BT navigator to specify the name of the blackboard variables from the
behavior trees were moved into the respective navigators. They now have to be specified under the namespace of the particular navigator.

These parameters are:

> * NavigateToPose:
>
> > * `<navigate_to_pose_name>.goal_blackboard_id`
> > * `<navigate_to_pose_name>.path_blackboard_id`
>
> * NavigateThroughPoses:
>
> > * `<navigate_through_poses_name>.goals_blackboard_id`
> > * `<navigate_through_poses_name>.path_blackboard_id`
> > * `<navigate_through_poses_name>.waypoint_statuses_blackboard_id`
>
> * CoverageNavigator:
>
> > * `<coverage_navigator_name>.path_blackboard_id`
> > * `<coverage_navigator_name>.field_file_blackboard_id`
> > * `<coverage_navigator_name>.field_polygon_blackboard_id`
> > * `<coverage_navigator_name>.polygon_frame_blackboard_id`

Example:

```
bt_navigator:
  ros__parameters:
    other parameters: ....

    navigate_to_pose:
      plugin: "nav2_bt_navigator::NavigateToPoseNavigator"
      enable_groot_monitoring: false
      groot_server_port: 1667
      goal_blackboard_id: "goal"
      path_blackboard_id: "path"

    navigate_through_poses:
      plugin: "nav2_bt_navigator::NavigateThroughPosesNavigator"
      enable_groot_monitoring: false
      groot_server_port: 1669
      goals_blackboard_id: "goals"
      path_blackboard_id: "path"
      waypoint_statuses_blackboard_id: "waypoint_statuses"

    navigate_complete_coverage:
      plugin: "opennav_coverage_navigator/CoverageNavigator"
      path_blackboard_id: "path"
      field_file_blackboard_id: "field_filepath"
      field_polygon_blackboard_id: "field_polygon"
      polygon_frame_blackboard_id: "polygon_frame_id"
```

See also [Behavior-Tree Navigator](../configuration/packages/configuring-bt-navigator.html#configuring-bt-navigator)

##### Add BehaviorTree SubTrees Support

The BehaviorTree engine now supports SubTrees in different files within directory(s) set through `bt_search_directories` parameter. This allows you to modularize your behavior trees into smaller components that can be reused across different trees.
The interface now supports passing the behavior tree file or ID as input to the loadBehaviorTree method of the BT action server.
Each behavior tree is now strictly required to have its own unique ID, therefore the need to replace MainTre to a unique ID. For example, in navigate\_through\_poses\_w\_replanning\_and\_recovery.xml
` `MainTree can be replaced with NavigateThroughPosesWReplanningAndRecovery.

##### Option to have custom window size and poly order in Savitsky-Golay Smoother

In [PR #5489](https://github.com/ros-navigation/navigation2/pull/5489), option to have custom window size and polynomial order was added.
Previously, the implementation used a fixed window size of 7 and a polynomial order of 3.

Default value:

* window\_size: 7
* poly\_order: 3

##### Vector Objects were Supported for Raster Maps

[PR #5479](https://github.com/ros-navigation/navigation2/pull/5479) adds new Vector Object server into `nav2_map_server` package.
It reads vector objects (polygons and polygonal chains as `PolygonObject.msg`; and circles as `CircleObject.msg`) from input parameters, handles them by service calls (`AddShapes.srv`/`GetShapes.srv`/`RemoveShapes.srv`) and finally puts them on output raster OccupancyGrid map.
This map is typically used with costmaps by acting as an input mask for Costmap Filters.
This allows to cover such use-cases as:
adding virtual obstacles on maps, dynamic objects simulation/highlighting, hiding some areas or sticking-out robot parts, sensors noise removal, blacking-out areas on maps, adding keep-out or maximum speed restricted areas on vector basis, synthetic testing purposes, and much more.

To run Vector Object server a new `vector_object_server.launch.py` launch-file is being supplied.
[Navigating with Vector Objects](../tutorials/docs/navigation2_with_vector_objects.html#navigation2-with-vector-objects) tutorial explains how launch Vector Object server and navigate with vector objects added to raster costmaps.
The information about Vector Object server parameters set-up could be found at [Vector Object Server](../configuration/packages/map_server/configuring-vector-object-server.html#configuring-vector-object-server) configuration guide.

##### Toggle collision monitor service and BT plugin

[PR #5493](https://github.com/ros-navigation/navigation2/pull/5493) and [PR #5532](https://github.com/ros-navigation/navigation2/pull/5532) introduce a new toggle service for the collision monitor.
This service allows enabling or disabling all collision monitor polygons while keeping sensor checks within the collision monitor active.

The service is defined using a new interface, `Toggle.srv`:

```
bool enable
---
bool success
string message
```

This interface can be extended in the future if needed.

A corresponding Behavior Tree (BT) plugin was also created to call this service.
The plugin is based on `BtServiceNode` and provides the following input ports:

* `service_name`: name of the toggle service
* `server_timeout`: timeout for service calls
* `enable`: boolean flag to enable or disable the collision monitor

An example usage in a Behavior Tree XML file:

```
<ToggleCollisionMonitor enable="false" service_name="collision_monitor/toggle"/>
```

##### Following Server

[PR #5565](https://github.com/ros-navigation/navigation2/pull/5565) adds a new Following Server into the `opennav_following` package.
The Following Server implements a server for following dynamic objects or specific reference frames.
This server allows the robot to follow and maintain a determined distance from a detected object or specific frame, using topic-based detection techniques or coordinate frame tracking.

The information about Following Server parameters set-up could be found at [Following Server](../configuration/packages/configuring-following-server.html#configuring-following-server) configuration guide.

The tutorial for the Following Server has been recently updated. For the latest instructions and examples, see [Dynamic Object Following](../tutorials/docs/navigation2_dynamic_point_following.html#navigation2-dynamic-point-following).

##### Option for MPPI to use open loop mode

In [PR #5617](https://github.com/ros-navigation/navigation2/pull/5617),add new option to have open loop for MPPI.
Now it have 1 more option to use last command velocity for initial state estimation instead of odometry.
Useful when using low accelerations or when wheel odometry’s latency (motor response is poor) causes issues in MPPI initial state estimation.

Default value:

* open\_loop: false

##### Partial paths from Planner Server

[PR #5687](https://github.com/ros-navigation/navigation2/pull/5687) adds support for outputting partial paths when planning through poses with the Planner Server. This is an
alternative behavior to the existing all-or-nothing approach, where either a complete path through all poses is returned, or no path at all if any pose cannot be reached due to obstacles.
While partial path output will still remain disabled by default, it can be set using the new allow\_partial\_planning dynamic parameter.

When this feature is used, the result from compute\_path\_through\_poses action server will now indicate the last reached pose from the goals list in last\_reached\_index field.

##### Namespace added for primary controller parameters in Rotation Shim Controller

In [PR #5654](https://github.com/ros-navigation/navigation2/pull/5654), a namespace was introduced for the primary controller parameters within the Rotation Shim Controller.
This change ensures proper handling of dynamic parameter updates by grouping the primary controller’s parameters under its own namespace.

Before

```
plugin: "nav2_rotation_shim_controller::RotationShimController"
primary_controller: "nav2_regulated_pure_pursuit_controller::RegulatedPurePursuitController"
desired_linear_vel: 1.0
lookahead_dist: 0.6
```

After

```
plugin: "nav2_rotation_shim_controller::RotationShimController"
primary_controller:
  plugin: "nav2_regulated_pure_pursuit_controller::RegulatedPurePursuitController"
  desired_linear_vel: 1.0
  lookahead_dist: 0.6
```

##### New CostmapSource observation type for Collision Monitor and CollisionDetector

In [PR #5642](https://github.com/ros-navigation/navigation2/pull/5642), a new
`CostmapSource` observation type was added to both Collision Monitor and
Collision Detector, allowing them to subscribe directly to
`nav2_msgs/msg/Costmap` messages as an observation source. This source should be used with caution.

##### Options to build with isolated tests

In [PR #5516](https://github.com/ros-navigation/navigation2/pull/5516), we added an option to build with isolated tests.
This allows users of `rmw_zenoh_cpp` to run the tests without needing to start a Zenoh router in a separate terminal.
You can enable this by building with `--cmake-args -DUSE_ISOLATED_TESTS=ON`.

##### RoundRobin wrap\_around Parameter

[PR #5308](https://github.com/ros-navigation/navigation2/pull/5308) adds a new `wrap_around` parameter to the RoundRobin behavior tree control node.

This parameter controls whether the RoundRobin node wraps around to its first child after the last one fails:

* `wrap_around=false` (default): Node returns FAILURE instead of wrapping to first child
* `wrap_around=true`: Node wraps around to the first child and continues round-robin behavior

**Breaking Change**: The default behavior has changed. Previously, RoundRobin would always wrap around. Now it defaults to `wrap_around=false`, which means existing behavior trees will use the new non-wrap-around behavior unless explicitly configured.

This change addresses issues where RoundRobin index can become misaligned with RecoveryNode retry counter when used in recovery sequences, ensuring each recovery action is performed once and only once.

```
<!-- New default behavior (no wrap-around) -->
<RoundRobin wrap_around="false">
    <Action_A/>
    <Action_B/>
    <Action_C/>
</RoundRobin>

<!-- Previous behavior (wrap-around) -->
<RoundRobin wrap_around="true">
    <Action_A/>
    <Action_B/>
    <Action_C/>
</RoundRobin>
```

For additional details regarding the `RoundRobin` please see the [RoundRobin configuration guide](../configuration/packages/bt-plugins/controls/RoundRobin.html).

##### Configurable Inscribed Obstacle Cost Value for Costmap Conversion

In [PR #5781](https://github.com/ros-navigation/navigation2/pull/5781), a new parameter inscribed\_obstacle\_cost\_value is added to fix the issue where Costmap2DPublisher maps INSCRIBED\_INFLATED\_OBSTACLE (253) to value 99 in OccupancyGrid, but StaticLayer incorrectly converts it back to 251 instead of 253.

Default value:

* inscribed\_obstacle\_cost\_value: 99

##### Updated Nav2 RViz Panel

In [PR #5774](https://github.com/ros-navigation/navigation2/pull/5774), the Nav2 panel (`nav2_rviz_plugins`) has been redesigned to provide comprehensive control over navigation requests and unify goal management tools.

Key Improvements:

* **Dynamic Behavior Tree (BT) Selection**: Added a selector to specify a custom Behavior Tree XML file. This enables modifying navigation logic at runtime (e.g., specific recovery behaviors) for both `NavigateToPose` and `NavigateThroughPoses` requests.
* **Manual Coordinate Entry**: Enables precise input of coordinates (X, Y, Theta) and frame\_id via numeric fields, complementing the visual tool.

The UI workflow is now organized into two primary navigation modes:

1. **Single-Goal Navigation** (`NavigateToPose`) Designed for individual targets. The goal can be defined using the standard “Nav2 Goal” tool (clicking on the map) or by manually entering precise coordinates directly in the panel.
2. **Multiple-Goal Navigation** (`NavigateThroughPoses`, `Waypoint Following` ) Designed for executing sequences of poses. This mode utilizes a pose accumulation mode to build and manage a list of goals before execution:

> * List Building: Poses can be added via a hybrid approach: using the “Nav2 Goal” tool, manually entering coordinates, or loading a YAML file.
> * Editing: The list is fully interactive; users can modify specific pose parameters or remove individual goals from the sequence.
> * Execution: Once the list is defined, navigation can be executed via `NavigateThroughPoses` or `Waypoint Following` actions.

[![Multiple-Goal Navigation in Nav2 RViz Panel](../_images/nav2_new_rviz_panel.gif)](../_images/nav2_new_rviz_panel.gif)

GIF above shows how multiple-goal navigation is configured mixing visual goal setting and file loading for NavigateThroughPoses and Waypoint Following actions.

##### Add Dynamic Window Pure Pursuit Option to Regulated Pure Pursuit Controller

In [PR #5783](https://github.com/ros-navigation/navigation2/pull/5783), an option was added to enable the Dynamic Window Pure Pursuit (DWPP) algorithm in the Regulated Pure Pursuit controller. When this option is enabled, velocity and acceleration constraints are explicitly considered when computing command velocities. See the Configuration Guide for the new parameters associated with this feature.

* Fumiya Ohnishi and Masaki Takahashi, [DWPP: Dynamic Window Pure Pursuit Considering Velocity and Acceleration Constraints](https://arxiv.org/abs/2601.15006). arXiv:2601.15006., 2026.

[![Comparison of Dynamic Window Pure Pursuit with Other Pure Pursuit Variants](../_images/dwpp_comparison.gif)](../_images/dwpp_comparison.gif)

The following parameters are updated for this feature.

max\_linear\_vel (renamed)
:   |  |  |
```
| --- | --- |
| Type | Default |
| double | 0.5 |
```

```
Description
:   The maximum linear velocity (m/s) to use. **Previously named `desired\_linear\_vel`**
```

**Note:** The velocity smoother clips velocity commands produced by this controller according to its own velocity and acceleration limits before publishing cmd\_vel.
Therefore, the velocity smoother parameters max\_velocity, min\_velocity, max\_accel, and max\_decel must be set to values consistent with, or greater than, the corresponding velocity, acceleration, and deceleration parameters of this controller.

##### Bond Heartbeat Period Default Value Change

In L-turtle, the default value for `bond_heartbeat_period` parameter has been increased from `0.1` to `0.25` seconds across all Nav2 lifecycle nodes, including the lifecycle manager. This change was implemented to reduce computational overhead and save CPU resources in systems with many nodes.

**Migration note**: If you have explicitly set `bond_heartbeat_period` to `0.1` in your configurations, you may want to remove this explicit setting to use the new default, or explicitly set it to `0.25` if you want to be explicit about the value. This value should now also be set in the lifecycle manager node as well.

###### Performance Impact

The following table shows the performance impact of changing the bond heartbeat period from 0.1s to 0.25s:

| Bond Period (s) | Composed CPU | Single-Proc. CPU |
| --- | --- | --- |
| 0.1 | 140% | 13% |
| 0.2 | 110% | 10% |
| 0.25 | 100% | 9% |
| 0.5 | 85% | 8% |
| 1.0 | 80% | 8% |

*Note: This table should be populated with data from issue #5784 comment. Composed CPU is for all Nav2 processes combined.*

##### Centralize Path Handler logic in Controller Server

[PR #5446](https://github.com/ros-navigation/navigation2/pull/5446) centralizes
path handling logic inside the controller server. Previously, each controller
plugin implemented its own version of this logic.

With this change, users can now configure a path handler in the controller server:

```
PathHandler:
  plugin: "nav2_controller::FeasiblePathHandler"
  prune_distance: 2.0
  enforce_path_inversion: True
  enforce_path_rotation: False
  inversion_xy_tolerance: 0.2
  inversion_yaw_tolerance: 0.4
  minimum_rotation_angle: 0.785
  reject_unit_path: False
```

For more details, refer to the *Path Handler* section in the Controller Server
documentation.

This update resolves the issue where *Navigate Through Poses* could terminate
prematurely when passing near intermediate goal poses. We also introduce the following API changes as part of this fix.

###### GoalChecker

Previously:

```
virtual bool isGoalReached(
  const geometry_msgs::msg::Pose & query_pose,
  const geometry_msgs::msg::Pose & goal_pose,
  const geometry_msgs::msg::Twist & velocity) = 0;
```

Now:

```
virtual bool isGoalReached(
  const geometry_msgs::msg::Pose & query_pose,
  const geometry_msgs::msg::Pose & goal_pose,
  const geometry_msgs::msg::Twist & velocity,
  const nav_msgs::msg::Path & transformed_global_plan) = 0;
```

A new argument is added: the **transformed and pruned global plan** from the path handler.

###### Controller Plugins

Previously:

```
virtual void setPlan(const nav_msgs::msg::Path & path) = 0;
```

Now:

```
virtual void newPathReceived(const nav_msgs::msg::Path & raw_global_path) = 0;
```

This callback should now only perform lightweight tasks (e.g. resetting internal
state). The controller will be provided the processed plan during computeVelocityCommands().

Previously:

```
virtual geometry_msgs::msg::TwistStamped computeVelocityCommands(
  const geometry_msgs::msg::PoseStamped & pose,
  const geometry_msgs::msg::Twist & velocity,
  nav2_core::GoalChecker * goal_checker) = 0;
```

Now:

```
virtual geometry_msgs::msg::TwistStamped computeVelocityCommands(
  const geometry_msgs::msg::PoseStamped & pose,
  const geometry_msgs::msg::Twist & velocity,
  nav2_core::GoalChecker * goal_checker,
  const nav_msgs::msg::Path & transformed_global_plan,
  const geometry_msgs::msg::PoseStamped & global_goal) = 0;
```

Two new arguments are provided:

* the **transformed and pruned global plan** from the path handler.
* The last pose from the global plan.

Moreover, several parameters have also been added to / removed from individual controller plugin configurations as part of centralizing path-handling logic in the controller server.

###### DWB

**Removed parameters**

* `prune_plan`
* `shorten_transformed_plan`
* `prune_distance`
* `forward_prune_distance`
* `transform_tolerance`
* `publish_global_plan`
* `publish_transformed_plan`

**Added parameters**

* `path_length_tolerance`

###### RPP

**Removed parameters**

* `transform_tolerance`
* `max_robot_pose_search_dist`

###### Graceful

**Removed parameters**

* `transform_tolerance`
* `max_robot_pose_search_dist`

###### MPPI

**Removed parameters**

* `transform_tolerance`
* `prune_distance`
* `max_robot_pose_search_dist`
* `enforce_path_inversion`
* `inversion_xy_tolerance`
* `inversion_yaw_tolerance`

##### Symmetric Yaw Tolerance for Goal Checking and Navigation

[PR #5833](https://github.com/ros-navigation/navigation2/pull/5833) introduces the symmetric yaw tolerance feature for goal checking and navigation, allowing symmetric robots to reach goals without unnecessary 180° rotations.

##### Option to enable Intra-process Communication in Nav2

In [PR 5804](https://github.com/ros-navigation/navigation2/pull/5804), an option to enable Intra-process Communication in Nav2 has been added. This can be done by passing use\_intra\_process\_comms parameter as true while launching Nav2 nodes.

It is currently disabled by default. Please refer to the [Performance in ROS 2: RMW, Node Composition, Intra-process Communication, and QoS](../tuning/index.html#performance-ros2) and the [TB3/TB4 examples in the Nav2 stack](https://github.com/ros-navigation/navigation2/tree/main/nav2_bringup/launch) for reference.

##### New AxisGoalChecker Plugin

A new goal checker plugin, `AxisGoalChecker`, has been added to provide path-direction-aware goal checking. Unlike distance-based goal checkers, `AxisGoalChecker` projects the robot’s position onto the path direction defined by the last segment of the path, allowing independent tolerances along the path (`along_path_tolerance`) and perpendicular to it (`cross_track_tolerance`).

Key parameters:

* `along_path_tolerance`: Tolerance along the path direction (default: 0.25m)
* `cross_track_tolerance`: Tolerance perpendicular to the path (default: 0.25m)
* `path_length_tolerance`: Maximum remaining path length to consider for goal checking (default: 1.0m)
* `is_overshoot_valid`: When true, allows the robot to overshoot past the goal by any distance along the path while still being within tolerance (default: false)

This goal checker is particularly useful for applications requiring precise alignment along specific axes, such as docking operations or warehouse navigation where lateral precision differs from forward/backward precision.

See [AxisGoalChecker](../configuration/packages/nav2_controller-plugins/axis_goal_checker.html#configuring-nav2-controller-axis-goal-checker-plugin) for full configuration details.

##### New default\_cancel\_timeout parameter in bt\_navigator

In [PR 5895](https://github.com/ros-navigation/navigation2/pull/5895), a new default\_cancel\_timeout parameter was introduced to address timeout issues during action cancellation, such as `Failed to get result for follow_path in node halt!`.

The default value is set to 50 milliseconds, and should be adjusted based on the planning time and overall system performance.

#### Parameters

**`max_linear_vel`**
- Type: `unknown`
- TypeDefaultdouble0.5DescriptionThe maximum linear velocity (m/s) to use.Previously named `desired_linear_vel`

**`Description`**
- Type: `unknown`
- The maximum linear velocity (m/s) to use.Previously named `desired_linear_vel`


---

### Migration Guides

*Source: [https://docs.nav2.org/migration/index.html](https://docs.nav2.org/migration/index.html)*

#### Migration Guides

Navigation2 guides for migration between distributions.

* [Dashing to Eloquent](Dashing.html)
* [Eloquent to Foxy](Eloquent.html)
* [Foxy to Galactic](Foxy.html)
* [Galactic to Humble](Galactic.html)
* [Humble to Iron](Humble.html)
* [Iron to Jazzy](Iron.html)
* [Jazzy to Kilted](Jazzy.html)
* [Kilted to L-turtle](Kilted.html)

---

## Plugin Tutorials

### Plugin Tutorials

*Source: [https://docs.nav2.org/plugin_tutorials/index.html](https://docs.nav2.org/plugin_tutorials/index.html)*

#### Plugin Tutorials

Navigation2 Tutorials

* [Writing a New Behavior Plugin](docs/writing_new_behavior_plugin.html)
* [Writing a New Behavior Tree Plugin](docs/writing_new_bt_plugin.html)
* [Writing a New Controller Plugin](docs/writing_new_nav2controller_plugin.html)
* [Writing a New Costmap2D Plugin](docs/writing_new_costmap2d_plugin.html)
* [Writing a New Navigator Plugin](docs/writing_new_navigator_plugin.html)
* [Writing a New Planner Plugin](docs/writing_new_nav2planner_plugin.html)

---

### Docs

#### Writing a New Behavior Plugin

*Source: [https://docs.nav2.org/plugin_tutorials/docs/writing_new_behavior_plugin.html](https://docs.nav2.org/plugin_tutorials/docs/writing_new_behavior_plugin.html)*

##### Writing a New Behavior Plugin

* [Overview](#overview)
* [Requirements](#requirements)
* [Tutorial Steps](#tutorial-steps)

###### Overview

This tutorial shows how to create you own Behavior Plugin.
The Behavior Plugins live in the behavior server.
Unlike the planner and controller servers, each behavior will host its own unique action server.
The planners and controllers have the same API as they accomplish the same task.
However, recoveries can be used to do a wide variety of tasks, so each behavior can have its own unique action message definition and server.
This allows for massive flexibility in the behavior server enabling any behavior action imaginable that doesn’t need to have other reuse.

###### Requirements

* ROS 2 (binary or build-from-source)
* Nav2 (Including dependencies)
* Gazebo
* Turtlebot3

###### Tutorial Steps

###### 1- Creating a new Behavior Plugin

We will create a simple send sms behavior.
It will use Twilio to send a message via SMS to a remote operations center.
The code in this tutorial can be found in [navigation\_tutorials](https://github.com/ros-navigation/navigation2_tutorials) repository as `nav2_sms_behavior`.
This package can be a considered as a reference for writing Behavior Plugin.

Our example plugin implements the plugin class of `nav2_core::Behavior`.
However, we have a nice wrapper for actions in `nav2_behaviors`, so we use the `nav2_behaviors::TimedBehavior` base class for this application instead.
This wrapper class derives from the `nav2_core` class so it can be used as a plugin, but handles the vast majority of ROS 2 action server boiler plate required.

The base class from `nav2_core` provides 4 pure virtual methods to implement a Behavior Plugin.
The plugin will be used by the behavior server to host the plugins, but each plugin will provide their own unique action server interface.
Let’s learn more about the methods needed to write a Behavior Plugin **if you did not use the ``nav2\_behaviors`` wrapper**.

|  |  |  |
| --- | --- | --- |
| **Virtual method** | **Method description** | **Requires override?** |
| configure() | Method is called at when server enters on\_configure state. Ideally this method should perform declarations of ROS parameters and initialization of behavior’s member variables. This method takes 4 input parameters: shared pointer to parent node, behavior name, tf buffer pointer and shared pointer to a collision checker. | Yes |
| activate() | Method is called when behavior server enters on\_activate state. Ideally this method should implement operations which are necessary before the behavior goes to an active state. | Yes |
| deactivate() | Method is called when behavior server enters on\_deactivate state. Ideally this method should implement operations which are necessary before behavior goes to an inactive state. | Yes |
| cleanup() | Method is called when behavior server goes to on\_cleanup state. Ideally this method should clean up resources which are created for the behavior. | Yes |

For the `nav2_behaviors` wrapper, which provides the ROS 2 action interface and boilerplate, we have 4 virtual methods to implement.
This tutorial uses this wrapper so these are the main elements we will address.

|  |  |  |
| --- | --- | --- |
| **Virtual method** | **Method description** | **Requires override?** |
| onRun() | Method is called immediately when a new behavior action request is received. Gives the action goal to process and should start behavior initialization / process. | Yes |
| onCycleUpdate() | Method is called at the behavior update rate and should complete any necessary updates. An example for spinning is computing the command velocity for the current cycle, publishing it and checking for completion. | Yes |
| onConfigure() | Method is called when behavior server enters on\_configure state. Ideally this method should implement operations which are necessary before behavior goes to a configured state (get parameters, etc). | No |
| onCleanup() | Method is called when behavior server goes to on\_cleanup state. Ideally this method should clean up resources which are created for the behavior. | No |
| onActionCompletion() | Method is called when the action has completed. Ideally, this method should populate the action result. | No |

For this tutorial, we will be using methods `onRun()`, `onCycleUpdate()`, and `onConfigure()` to create the SMS behavior.
`onConfigure()` will be skipped for brevity, but only declares parameters.

In recoveries, `onRun()` method must set any initial state and kick off the behavior.
For the case of our call for help behavior, we can trivially compute all of our needs in this method.

```
ResultStatus SendSms::onRun(const std::shared_ptr<const Action::Goal> command)
{
  std::string response;
  bool message_success = _twilio->send_message(
    _to_number,
    _from_number,
    command->message,
    response,
    "",
    false);

  if (!message_success) {
    RCLCPP_INFO(node_->get_logger(), "SMS send failed.");
    return ResultStatus{Status::FAILED};
  }

  RCLCPP_INFO(node_->get_logger(), "SMS sent successfully!");
  return ResultStatus{Status::SUCCEEDED};
}
```

We receive an action goal, `command`, which we want to process.
`command` contains a field `message` that contains the message we want to communicate to our mothership.
This is the “call for help” message that we want to send via SMS to our brothers in arms in the operations center.

We use the service Twilio to complete this task.
Please [create an account](https://www.twilio.com/) and get all the relevant information needed for creating the service (e.g. `account_sid`, `auth_token`, and a phone number).
You can set these values as parameters in your configuration files corresponding to the `onConfigure()` parameter declarations.

We use the `_twilio` object to send our message with your account information from the configuration file.
We send the message and log to screen whether or not the message was sent successfully or not.
We return a `FAILED` or `SUCCEEDED` depending on this value to be returned to the action client.

`onCycleUpdate()` is trivially simple as a result of our short-running behavior.
If the behavior was instead longer running like spinning, navigating to a safe area, or getting out of a bad spot and waiting for help, then this function would be checking for timeouts or computing control values.
For our example, we simply return success because we already completed our mission in `onRun()`.

```
ResultStatus SendSms::onCycleUpdate()
{
  return ResultStatus{Status::SUCCEEDED};
}
```

The remaining methods are not used and are not mandatory to override them.

###### 2- Exporting the Behavior Plugin

Now that we have created our custom behavior, we need to export our Behavior Plugin so that it would be visible to the behavior server. Plugins are loaded at runtime and if they are not visible, then our behavior server won’t be able to load it. In ROS 2, exporting and loading plugins is handled by `pluginlib`.

Coming to our tutorial, class `nav2_sms_behavior::SendSms` is loaded dynamically as `nav2_core::Behavior` which is our base class.

1. To export the behavior, we need to provide two lines

```
#include "pluginlib/class_list_macros.hpp"
PLUGINLIB_EXPORT_CLASS(nav2_sms_behavior::SendSms, nav2_core::Behavior)
```

Note that it requires pluginlib to export out plugin’s class. Pluginlib would provide as macro `PLUGINLIB_EXPORT_CLASS` which does all the work of exporting.

It is good practice to place these lines at the end of the file but technically, you can also write at the top.

2. Next step would be to create plugin’s description file in the root directory of the package. For example, `behavior_plugin.xml` file in our tutorial package. This file contains following information

> * `library path`: Plugin’s library name and it’s location.
> * `class name`: Name of the class (optional). If not set, it will default to the `class type`.
> * `class type`: Type of class.
> * `base class`: Name of the base class.
> * `description`: Description of the plugin.

```
<library path="nav2_sms_behavior_plugin">
  <class type="nav2_sms_behavior::SendSms" base_class_type="nav2_core::Behavior">
    <description>This is an example plugin which produces an SMS text message recovery.</description>
  </class>
</library>
```

3. Next step would be to export plugin using `CMakeLists.txt` by using cmake function `pluginlib_export_plugin_description_file()`. This function installs plugin description file to `share` directory and sets ament indexes to make it discoverable.

```
pluginlib_export_plugin_description_file(nav2_core behavior_plugin.xml)
```

4. Plugin description file should also be added to `package.xml`

```
<export>
  <build_type>ament_cmake</build_type>
  <nav2_core plugin="${prefix}/behavior_plugin.xml" />
</export>
```

5. Compile and it should be registered. You can verify that it has been successfully registered by running:

```
$ ros2 plugin list
```

You should see an output similar to below:

```
nav2_sms_behavior:
      Plugin(name='nav2_sms_behavior::SendSms', type='nav2_sms_behavior::SendSms', base='nav2_core::Behavior')
```

Next, we’ll use this plugin.

###### 3- Pass the plugin name through params file

To enable the plugin, we need to modify the `nav2_params.yaml` file as below to replace following params

```
behavior_server:  # Humble and later
recoveries_server:  # Galactic and earlier
  ros__parameters:
    costmap_topic: local_costmap/costmap_raw
    footprint_topic: local_costmap/published_footprint
    cycle_frequency: 10.0
    behavior_plugins: ["spin", "backup", "wait"]  # Humble and later
    recovery_plugins: ["spin", "backup", "wait"]  # Galactic and earlier
    spin:
      plugin: "nav2_behaviors::Spin" # In Iron and older versions, "/" was used instead of "::"
    backup:
      plugin: "nav2_behaviors::BackUp" # In Iron and older versions, "/" was used instead of "::"
    wait:
      plugin: "nav2_behaviors::Wait" # In Iron and older versions, "/" was used instead of "::"
    global_frame: odom
    robot_base_frame: base_link
    transform_tolerance: 0.1
    simulate_ahead_time: 2.0
    max_rotational_vel: 1.0
    min_rotational_vel: 0.4
    rotational_acc_lim: 3.2
```

with

```
behavior_server:  # Humble and newer
recoveries_server:  # Galactic and earlier
  ros__parameters:
    local_costmap_topic: local_costmap/costmap_raw
    local_footprint_topic: local_costmap/published_footprint
    global_costmap_topic: global_costmap/costmap_raw
    global_footprint_topic: global_costmap/published_footprint
    cycle_frequency: 10.0
    behavior_plugins: ["spin", "backup", "wait","send_sms"]  # Humble and newer
    recovery_plugins: ["spin", "backup", "wait","send_sms"]  # Galactic and earlier
    spin:
      plugin: "nav2_behaviors::Spin" # In Iron and older versions, "/" was used instead of "::"
    backup:
      plugin: "nav2_behaviors::BackUp" # In Iron and older versions, "/" was used instead of "::"
    wait:
      plugin: "nav2_behaviors::Wait" # In Iron and older versions, "/" was used instead of "::"
    send_sms:
      plugin: "nav2_sms_behavior::SendSms" # In Iron and older versions, "/" was used instead of "::"
    account_sid: ... # your sid
    auth_token: ... # your token
    from_number: ... # your number
    to_number: ... # the operations center number
    global_frame: odom
    robot_base_frame: base_link
    transform_tolerance: 0.1
    simulate_ahead_time: 2.0
    max_rotational_vel: 1.0
    min_rotational_vel: 0.4
    rotational_acc_lim: 3.2
```

In the above snippet, you can observe that we add the SMS behavior under the `send_sms` ROS 2 action server name.
We also tell the behavior server that the `send_sms` is of type `SendSms` and give it our parameters for your Twilio account.

###### 4- Run Behavior Plugin

Run Turtlebot3 simulation with enabled Nav2. Detailed instruction how to make it are written at [Getting Started](../../getting_started/index.html#getting-started). Below is shortcut command for that:

```
$ ros2 launch nav2_bringup tb3_simulation_launch.py params_file:=/path/to/your_params_file.yaml
```

In a new terminal run:

```
$ ros2 action send_goal "send_sms" nav2_sms_behavior/action/SendSms "{message : Hello!! Navigation2 World }"
```

---

#### Writing a New Behavior Tree Plugin

*Source: [https://docs.nav2.org/plugin_tutorials/docs/writing_new_bt_plugin.html](https://docs.nav2.org/plugin_tutorials/docs/writing_new_bt_plugin.html)*

##### Writing a New Behavior Tree Plugin

* [Overview](#overview)
* [Requirements](#requirements)
* [Tutorial Steps](#tutorial-steps)
* [Using custom types for Input/Output ports](#using-custom-types-for-input-output-ports)
* [Visualize the content of the blackboard in Groot 2 (PRO)](#visualize-the-content-of-the-blackboard-in-groot-2-pro)

###### Overview

This tutorial shows how to create your own behavior tree (BT) plugin.
The BT plugins are used as nodes in the behavior tree XML processed by the BT Navigator for navigation logic.

###### Requirements

* ROS 2 (binary or build-from-source)
* Nav2 (Including dependencies)
* Gazebo
* Turtlebot3

###### Tutorial Steps

###### 1- Creating a new BT Plugin

We will create a simple BT plugin node to perform an action on another server.
For this example, we’re going to analyze the simplest behavior tree action node in the `nav2_behavior_tree` package, the `wait` node.
Beyond this example of an action BT node, you can also create custom decorator, condition, and control nodes.
Each node type has a unique role in the behavior tree to perform actions like planning, control the flow of the BT, check the status of a condition, or modify the output of other BT nodes.

The code in this tutorial can be found in [nav2\_behavior\_tree](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree) package as the `wait_action` node.
This action node can be considered as a reference for writing other action node plugins.

Our example plugin inherits from the base class `nav2_behavior_tree::BtActionNode`.
The base class is a wrapper on the BehaviorTree.CPP `BT::ActionNodeBase` that simplifies BT action nodes that utilize ROS 2 action clients.
An `BTActionNode` is both a BT action and uses ROS 2 action network interfaces for calling a remote server to do some work.

When working with other types of BT nodes (e.g. decorator, control, condition) use the corresponding BT node, `BT::DecoratorNode`, `BT::ControlNode`, or `BT::ConditionNode`.
For BT action nodes that do *not* utilize ROS 2 action interfaces, use the `BT::ActionNodeBase` base class itself.

The `BTActionNode` class provides 5 virtual methods to use, in addition to the information provided in the constructor.
Let’s learn more about the methods needed to write a BT action plugin.

|  |  |  |
| --- | --- | --- |
| **method** | **Method description** | **Required?** |
| Constructor | Constructor to indicate the corresponding XML tag name to that matches the plugin, the name of the action server to call using the plugin, and any BehaviorTree.CPP special configurations required. | Yes |
| providedPorts() | A function to define the input and output ports a BT node may have. These are analogous to parameters that are defined in the BT XML by hardcoded values or by the value of output ports of other nodes. | Yes |
| on\_tick() | Method is called when this BT node is ticked by the behavior tree while executing. This should be used to get dynamic updates like new blackboard values, input ports, or parameters. May also reset state for the action. | No |
| on\_wait\_for\_result() | Method is called when the behavior tree node is waiting for a result from the ROS 2 action server it called. This could be used to check for updates to preempt the current task, check for a timeout, or anything to compute while waiting for the action to complete. | No |
| on\_success() | Method is called when the ROS 2 action server returns a successful result. Returns the value the BT node will report back to the tree. | No |
| on\_aborted() | Method is called when the ROS 2 action server returns an aborted result. Returns the value the BT node will report back to the tree. | No |
| on\_cancelled() | MMethod is called when the ROS 2 action server returns a cancelled result. Returns the value the BT node will report back to the tree. | No |

For this tutorial, we will only be using the `on_tick()` method.

In the constructor, we need to get any non-variable parameters that apply to the behavior tree node.
In this example, we need to get the value of the duration to sleep from the input port of the behavior tree XML.

```
WaitAction::WaitAction(
  const std::string & xml_tag_name,
  const std::string & action_name,
  const BT::NodeConfiguration & conf)
: BtActionNode<nav2_msgs::action::Wait>(xml_tag_name, action_name, conf)
{
  int duration;
  getInput("wait_duration", duration);
  if (duration <= 0) {
    RCLCPP_WARN(
      node_->get_logger(), "Wait duration is negative or zero "
      "(%i). Setting to positive.", duration);
    duration *= -1;
  }

  goal_.time.sec = duration;
}
```

Here, we give the input of the `xml_tag_name`, which tells the BT node plugin the string in the XML that corresponds to this node.
This will be seen later when we register this BT node as a plugin.
It also takes in the string name of the action server that it will call to execute some behavior.
Finally, a set of configurations that we can safely ignore for the purposes of most node plugins.

We then call the `BTActionNode` constructor. As can be seen, it’s templated by the ROS 2 action type, so we give it the `nav2_msgs::action::Wait` action message type and forward our other inputs.
The `BTActionNode` has the `tick()` method, which is called directly by the behavior tree when this node is called from the tree.
`on_tick()` is then called before sending the action client goal.

In the body of the constructor, we get the input port `getInput` of the parameter `wait_duration`, which can be configured independently for every instance of the `wait` node in the tree.
It is set in the `duration` parameter and inserted into the `goal_`.
The `goal_` class variable is the goal that the ROS 2 action client will send to the action server.
So in this example, we set the duration to the time we want to wait by so that the action server knows the specifics of our request.

The `providedPorts()` method gives us the opportunity to define input or output ports.
Ports can be thought of as parameters that the behavior tree node has access to from the behavior tree itself.
For our example, there is only a single input port, the `wait_duration` which can be set in the BT XML for each instance of the `wait` recovery.
We set the type, `int`, the default `1`, the name `wait_duration`, and a description of the port `Wait time`.

```
static BT::PortsList providedPorts()
{
  return providedBasicPorts(
    {
      BT::InputPort<int>("wait_duration", 1, "Wait time")
    });
}
```

The `on_tick()` method is called when the behavior tree ticks a specific node.
For the wait BT node, we simply want to notify a counter on the blackboard that an action plugin that corresponds to a recovery was ticked.
This is useful to keep metrics about the number of recoveries executed during a specific navigation run.
You could also log or update the `goal_` waiting duration if that is a variable input.

```
void WaitAction::on_tick()
{
  increment_recovery_count();
}
```

The remaining methods are not used and are not mandatory to override them.
Only some BT node plugins will require overriding `on_wait_for_result()` to check for preemption or check a timeout.
The success, aborted, and cancelled methods will default to `SUCCESS`, `FAILURE`, `SUCCESS` respectively, if not overridden.

###### 2- Exporting the planner plugin

Now that we have created our custom BT node, we need to export our plugin so that it would be visible to the behavior tree when it loads a custom BT XML.
Plugins are loaded at runtime, and if they are not visible, then our BT Navigator server won’t be able to load them or use them.
In BehaviorTree.CPP, exporting and loading plugins is handled by the `BT_REGISTER_NODES` macro.

```
BT_REGISTER_NODES(factory)
{
  BT::NodeBuilder builder =
    [](const std::string & name, const BT::NodeConfiguration & config)
    {
      return std::make_unique<nav2_behavior_tree::WaitAction>(name, "wait", config);
    };

  factory.registerBuilder<nav2_behavior_tree::WaitAction>("Wait", builder);
}
```

In this macro, we must create a `NodeBuilder` so that our custom action node can have a non-default constructor signature (for the action and xml names).
This lambda will return a unique pointer to the behavior tree node we have created.
Fill in the constructor with the relevant information, giving it the `name` and `config` given in the function arguments.
Then define the ROS 2 action server’s name that this BT node will call, in this case, it’s the `Wait` action.

We finally give the builder to a factory to register.
`Wait` given to the factory is the name in the behavior tree XML file that corresponds to this BT node plugin.
An example can be seen below, where the `Wait` BT XML node specifies a non-variable input port `wait_duration` of 5 seconds.

```
<Wait wait_duration="5"/>
```

###### 3- Add plugin library name to config

In order for the BT Navigator node to discover the plugin we’ve just registered, we need to list the plugin library name under the bt\_navigator node in the configuration YAML file. Configuration should look similar to the one shown below. Take note of nav2\_wait\_action\_bt\_node listed under plugin\_lib\_names.

```
bt_navigator:
  ros__parameters:
    global_frame: map
    robot_base_frame: base_link
    odom_topic: /odom
    default_nav_to_pose_bt_xml: replace/with/path/to/bt.xml # or $(find-pkg-share my_package)/behavior_tree/my_nav_to_pose_bt.xml
    default_nav_through_poses_bt_xml: replace/with/path/to/bt.xml # or $(find-pkg-share my_package)/behavior_tree/my_nav_through_poses_bt.xml
    plugin_lib_names:
    - nav2_back_up_action_bt_node # other plugin
    - nav2_wait_action_bt_node    # our new plugin
```

###### 4- Run Your Custom plugin

Now you can use a behavior tree with your custom BT node.
For example, the `navigate_w_replanning_and_recovery.xml` file is shown below.

Select this BT XML file in your specific navigation request in `NavigateToPose` or as the default behavior tree in the BT Navigator’s configuration yaml file.

```
<root main_tree_to_execute="MainTree">
  <BehaviorTree ID="MainTree">
    <RecoveryNode number_of_retries="6" name="NavigateRecovery">
      <PipelineSequence name="NavigateWithReplanning">
        <RateController hz="1.0">
          <RecoveryNode number_of_retries="1" name="ComputePathToPose">
            <ComputePathToPose goal="{goal}" path="{path}" planner_id="GridBased"/>
            <ClearEntireCostmap name="ClearGlobalCostmap-Context" service_name="global_costmap/clear_entirely_global_costmap"/>
          </RecoveryNode>
        </RateController>
        <RecoveryNode number_of_retries="1" name="FollowPath">
          <FollowPath path="{path}" controller_id="FollowPath"/>
          <ClearEntireCostmap name="ClearLocalCostmap-Context" service_name="local_costmap/clear_entirely_local_costmap"/>
        </RecoveryNode>
      </PipelineSequence>
      <ReactiveFallback name="RecoveryFallback">
        <GoalUpdated/>
        <SequenceWithMemory name="RecoveryActions">
          <ClearEntireCostmap name="ClearLocalCostmap-Subtree" service_name="local_costmap/clear_entirely_local_costmap"/>
          <ClearEntireCostmap name="ClearGlobalCostmap-Subtree" service_name="global_costmap/clear_entirely_global_costmap"/>
          <Spin spin_dist="1.57"/>
          <Wait wait_duration="5"/>
        </SequenceWithMemory>
      </ReactiveFallback>
    </RecoveryNode>
  </BehaviorTree>
</root>
```

###### Using custom types for Input/Output ports

In addition to standard types, custom types such as those from `nav2_msgs` or `geometry_msgs` can also be used for input/output ports.

For example, you can define custom types for ports in the `providedPorts` function as follows:

```
static PortsList providedPorts()
{
  return providedBasicPorts(
    BT::OutputPort<geometry_msgs::msg::Point>("position", "Position of the robot")
  });
}
```

To use custom types for input/output ports in the behavior tree XML, it is necessary to convert them from a string. This is because ports in the XML are represented as strings and must be transformed into the corresponding data type in the code.

For example, if you have a custom type `geometry_msgs::msg::Point`, you can perform the conversion as follows:

```
namespace BT
{
template<>
inline geometry_msgs::msg::Point convertFromString(const StringView key)
{
  // three real numbers separated by semicolons
  auto parts = BT::splitString(key, ';');
  if (parts.size() != 3) {
    throw std::runtime_error("invalid number of fields for point attribute)");
  } else {
    geometry_msgs::msg::Point position;
    position.x = BT::convertFromString<double>(parts[0]);
    position.y = BT::convertFromString<double>(parts[1]);
    position.z = BT::convertFromString<double>(parts[2]);
    return position;
  }
}
}  // namespace BT
```

For more information on custom type conversion, you can refer to the [bt\_utils.hpp](https://github.com/ros-navigation/navigation2/blob/main/nav2_behavior_tree/include/nav2_behavior_tree/bt_utils.hpp) or the BT.CPP documentation: [Parsing a string](https://www.behaviortree.dev/docs/tutorial-basics/tutorial_03_generic_ports#parsing-a-string).

###### Visualize the content of the blackboard in Groot 2 (PRO)

If you are using the paid version of Groot 2 Pro, you can view the content of the blackboard of the BT nodes. To achieve this, you need to perform a conversion of the custom input/output type to JSON format. Below is an example of such a conversion:

```
namespace geometry_msgs::msg
{
BT_JSON_CONVERTER(geometry_msgs::msg::Point, msg)
{
  add_field("x", &msg.x);
  add_field("y", &msg.y);
  add_field("z", &msg.z);
}
}  // namespace geometry_msgs::msg
```

The macro `BT_JSON_CONVERTER` must be placed within the namespace of the custom type to be converted. Additionally, if the custom type is composed of other custom types, those types must be converted first before converting the parent type.

After defining the conversion, you need to register the custom type in the providedPorts function. Below is an example of how to register it:

```
static PortsList providedPorts()
{
  // Register JSON definitions for the types used in the ports
  BT::RegisterJsonDefinition<geometry_msgs::msg::Point>();
  return providedBasicPorts(
    BT::OutputPort<geometry_msgs::msg::Point>("position", "Position of the robot")
  });
}
```

For more information on custom type conversion, you can refer to the [json\_utils.hpp](https://github.com/ros-navigation/navigation2/blob/main/nav2_behavior_tree/include/nav2_behavior_tree/json_utils.hpp) or the BT.CPP documentation: [Visualize custom types in the Blackboard](https://www.behaviortree.dev/docs/tutorial-basics/tutorial_11_groot2/#visualize-custom-types-in-the-blackboard)

> Note
>
> All custom types used in Nav2 are already registered in the json\_utils.hpp file. You can use them directly without the need to register them again.

---

#### Writing a New Controller Plugin

*Source: [https://docs.nav2.org/plugin_tutorials/docs/writing_new_nav2controller_plugin.html](https://docs.nav2.org/plugin_tutorials/docs/writing_new_nav2controller_plugin.html)*

##### Writing a New Controller Plugin

* [Overview](#overview)
* [Requirements](#requirements)
* [Tutorial Steps](#tutorial-steps)

[![Animated gif of pure pursuit controller demo](../../_images/nav2_pure_pursuit_gif.gif)](../../_images/nav2_pure_pursuit_gif.gif)

###### Overview

This tutorial shows how to create your own controller [plugin](https://index.ros.org/p/pluginlib/).

In this tutorial, we will be implementing the pure pursuit path tracking algorithm based on this [paper](https://www.ri.cmu.edu/pub_files/pub3/coulter_r_craig_1992_1/coulter_r_craig_1992_1.pdf).
It is recommended you go through it.

Note: This tutorial is based on a previously existing simplified version of the Regulated Pure Pursuit controller now in the Nav2 stack.
You can find the source code matching this tutorial [here](https://github.com/ros-navigation/navigation2_tutorials/tree/126902457c5c646b136569886d6325f070c1073d/nav2_pure_pursuit_controller).

###### Requirements

* ROS 2 (binary or build-from-source)
* Nav2 (Including dependencies)
* Gazebo
* Turtlebot3

###### Tutorial Steps

###### 1- Create a new Controller Plugin

We will be implementing the pure pursuit controller. The annotated code in this tutorial can be found in [navigation\_tutorials](https://github.com/ros-navigation/navigation2_tutorials) repository
as the `nav2_pure_pursuit_controller`. This package can be considered as a reference for writing your own controller plugin.

Our example plugin class `nav2_pure_pursuit_controller::PurePursuitController` inherits from the base class `nav2_core::Controller`. The base class provides a
set of virtual methods to implement a controller plugin. These methods are called at runtime by the controller server to compute velocity commands.
The list of methods, their descriptions, and necessity are presented in the table below:

|  |  |  |
| --- | --- | --- |
| **Virtual method** | **Method description** | **Requires override?** |
| configure() | Method is called when controller server enters on\_configure state. Ideally this method should perform declarations of ROS parameters and initialization of controller’s member variables. This method takes 4 input params: weak pointer to parent node, controller name, tf buffer pointer and shared pointer to costmap. | Yes |
| activate() | Method is called when controller server enters on\_activate state. Ideally this method should implement operations which are necessary before controller goes to an active state. | Yes |
| deactivate() | Method is called when controller server enters on\_deactivate state. Ideally this method should implement operations which are necessary before controller goes to an inactive state. | Yes |
| cleanup() | Method is called when controller server goes to on\_cleanup state. Ideally this method should clean up resources which are created for the controller. | Yes |
| newPathReceived() | Method is called when the global plan is updated. Ideally this method should only perform minimal work, such as extracting global information that may be of interest (e.g. reset internal states when new path received). | Yes |
| computeVelocityCommands() | Method is called when a new velocity command is demanded by the controller server in-order for the robot to follow the global path. This method returns a geometry\_msgs::msg::TwistStamped which represents the velocity command for the robot to drive. This method passes 5 parameters: reference to the current robot pose, its current velocity, a pointer to the nav2\_core::GoalChecker, the transformed\_global\_plan output by the path handler plugin, and the last pose of the global plan. | Yes |
| cancel() | Method is called when the controller server receives a cancel request. If this method is unimplemented, the controller will immediately stop when receiving a cancel request. If this method is implemented, the controller can perform a more graceful stop and signal the controller server when it is done. | No |
| setSpeedLimit() | Method is called when it is required to limit the maximum linear speed of the robot. Speed limit could be expressed in absolute value (m/s) or in percentage from maximum robot speed. Note that typically, maximum rotational speed is being limited proportionally to the change of maximum linear speed, in order to keep current robot behavior untouched. | Yes |

In this tutorial, we will use the methods `PurePursuitController::configure`, `PurePursuitController::newPathReceived` and
`PurePursuitController::computeVelocityCommands`.

In controllers, `configure()` method must set member variables from ROS parameters and perform any initialization required.

```
void PurePursuitController::configure(
  const rclcpp_lifecycle::LifecycleNode::WeakPtr & parent,
  std::string name, std::shared_ptr<tf2_ros::Buffer> tf,
  std::shared_ptr<nav2_costmap_2d::Costmap2DROS> costmap_ros)
{
  node_ = parent;
  auto node = node_.lock();

  costmap_ros_ = costmap_ros;
  tf_ = tf;
  plugin_name_ = name;
  logger_ = node->get_logger();
  clock_ = node->get_clock();

  declare_parameter_if_not_declared(
    node, plugin_name_ + ".desired_linear_vel", rclcpp::ParameterValue(
      0.2));
  declare_parameter_if_not_declared(
    node, plugin_name_ + ".lookahead_dist",
    rclcpp::ParameterValue(0.4));
  declare_parameter_if_not_declared(
    node, plugin_name_ + ".max_angular_vel", rclcpp::ParameterValue(
      1.0));
  declare_parameter_if_not_declared(
    node, plugin_name_ + ".transform_tolerance", rclcpp::ParameterValue(
      0.1));

  node->get_parameter(plugin_name_ + ".desired_linear_vel", desired_linear_vel_);
  node->get_parameter(plugin_name_ + ".lookahead_dist", lookahead_dist_);
  node->get_parameter(plugin_name_ + ".max_angular_vel", max_angular_vel_);
  double transform_tolerance;
  node->get_parameter(plugin_name_ + ".transform_tolerance", transform_tolerance);
  transform_tolerance_ = rclcpp::Duration::from_seconds(transform_tolerance);
}
```

Here, `plugin_name_ + ".desired_linear_vel"` is fetching the ROS parameter `desired_linear_vel` which is specific to our controller.
Nav2 allows loading of multiple plugins, and to keep things organized, each plugin is mapped to some ID/name.
Now, if we want to retrieve the parameters for that specific plugin, we use `<mapped_name_of_plugin>.<name_of_parameter>` as done in the above snippet.
For example, our example controller is mapped to the name `FollowPath` and to retrieve the `desired_linear_vel` parameter, which is specific to “FollowPath”,
we used `FollowPath.desired_linear_vel`. In other words, `FollowPath` is used as a namespace for plugin-specific parameters.
We will see more on this when we discuss the parameters file (or params file).

The passed-in arguments are stored in member variables so that they can be used at a later stage if needed.

The computation for the desired velocity happens in the `computeVelocityCommands()` method. It is used to calculate the desired velocity command given the current velocity and pose.
The third argument - is a pointer to the `nav2_core::GoalChecker`, that checks whether a goal has been reached. In our example, this won’t be used.
The fourth argument - is the global plan that has already been transformed into the local costmap frame and pruned to only the relevant portion within the costmap bounds. In our example, we will transform this local plan from costmap global frame to robot base frame. This is the path that pure pursuit will track.
The fifth argument - is the last pose of the global plan. In our example, this won’t be used.
In the case of pure pursuit, the algorithm computes velocity commands such that the robot tries to follow the global path as closely as possible.
This algorithm assumes a constant linear velocity and computes the angular velocity based on the curvature of the global path.

```
geometry_msgs::msg::TwistStamped PurePursuitController::computeVelocityCommands(
  const geometry_msgs::msg::PoseStamped & pose,
  const geometry_msgs::msg::Twist & velocity,
  nav2_core::GoalChecker * /*goal_checker*/,
  const nav_msgs::msg::Path & transformed_global_plan,
  const geometry_msgs::msg::PoseStamped & /*global_goal*/)
{
  // Transform the plan from costmap's global frame to robot base frame
  nav_msgs::msg::Path transformed_plan;
  if (!nav2_util::transformPathInTargetFrame(
      transformed_global_plan, transformed_plan, *tf_,
      costmap_ros_->getBaseFrameID(), costmap_ros_->getTransformTolerance()))
  {
    throw nav2_core::ControllerTFError(
    "Unable to transform plan pose into local frame");
  }

  // Find the first pose which is at a distance greater than the specified lookahead distance
  auto goal_pose = std::find_if(
    global_plan_.poses.begin(), global_plan_.poses.end(),
    [&](const auto & global_plan_pose) {
      return hypot(
        global_plan_pose.pose.position.x,
        global_plan_pose.pose.position.y) >= lookahead_dist_;
    })->pose;

  double linear_vel, angular_vel;

  // If the goal pose is in front of the robot then compute the velocity using the pure pursuit algorithm
  // else rotate with the max angular velocity until the goal pose is in front of the robot
  if (goal_pose.position.x > 0) {

    auto curvature = 2.0 * goal_pose.position.y /
      (goal_pose.position.x * goal_pose.position.x + goal_pose.position.y * goal_pose.position.y);
    linear_vel = desired_linear_vel_;
    angular_vel = desired_linear_vel_ * curvature;
  } else {
    linear_vel = 0.0;
    angular_vel = max_angular_vel_;
  }

  // Create and publish a TwistStamped message with the desired velocity
  geometry_msgs::msg::TwistStamped cmd_vel;
  cmd_vel.header.frame_id = pose.header.frame_id;
  cmd_vel.header.stamp = clock_->now();
  cmd_vel.twist.linear.x = linear_vel;
  cmd_vel.twist.angular.z = max(
    -1.0 * abs(max_angular_vel_), min(
      angular_vel, abs(
        max_angular_vel_)));

  return cmd_vel;
}
```

The remaining methods are not used, but it’s mandatory to override them. As per the rules, we did override all but left them empty.

###### 2- Exporting the controller plugin

Now that we have created our custom controller, we need to export our controller plugin so that it will be visible to the controller server.
Plugins are loaded at runtime, and if they are not visible, then our controller server won’t be able to load them. In ROS 2, exporting and loading
plugins is handled by `pluginlib`.

Coming back to our tutorial, class `nav2_pure_pursuit_controller::PurePursuitController` is loaded dynamically as `nav2_core::Controller` which is our base class.

1. To export the controller, we need to provide two lines

```
#include "pluginlib/class_list_macros.hpp"
PLUGINLIB_EXPORT_CLASS(nav2_pure_pursuit_controller::PurePursuitController, nav2_core::Controller)
```

Note that it requires pluginlib to export out the plugin’s class. Pluginlib would provide as macro `PLUGINLIB_EXPORT_CLASS`, which does all the work of exporting.

It is good practice to place these lines at the end of the file, but technically, you can also write at the top.

2. The next step would be to create the plugin’s description file in the root directory of the package. For example, `pure_pursuit_controller_plugin.xml` file in our tutorial package. This file contains the following information

* `library path`: Plugin’s library name and its location.
* `class name`: Name of the class (optional). If not set, it will default to the `class type`.
* `class type`: Type of class.
* `base class`: Name of the base class.
* `description`: Description of the plugin.

```
<library path="nav2_pure_pursuit_controller">
  <class type="nav2_pure_pursuit_controller::PurePursuitController" base_class_type="nav2_core::Controller">
    <description>
      This is pure pursuit controller
    </description>
  </class>
</library>
```

3. Next step would be to export plugin using `CMakeLists.txt` by using CMake function `pluginlib_export_plugin_description_file()`. This function installs the plugin description file to `share` directory and sets ament indexes to make it discoverable.

```
pluginlib_export_plugin_description_file(nav2_core pure_pursuit_controller_plugin.xml)
```

4. The plugin description file should also be added to `package.xml`

```
<export>
  <build_type>ament_cmake</build_type>
  <nav2_core plugin="${prefix}/pure_pursuit_controller_plugin.xml" />
</export>
```

5. Compile, and it should be registered. You can verify that it has been successfully registered by running:

```
$ ros2 plugin list
```

You should see an output similar to below:

```
nav2_pure_pursuit_controller:
      Plugin(name='nav2_pure_pursuit_controller::PurePursuitController', type='nav2_pure_pursuit_controller::PurePursuitController', base='nav2_core::Controller')
```

Next, we’ll use this plugin.

###### 3- Pass the plugin name through the params file

To enable the plugin, we need to modify the `nav2_params.yaml` file as below

```
controller_server:
  ros__parameters:
    controller_plugins: ["FollowPath"]

    FollowPath:
      plugin: "nav2_pure_pursuit_controller::PurePursuitController" # In Iron and older versions, "/" was used instead of "::"
      debug_trajectory_details: True
      desired_linear_vel: 0.2
      lookahead_dist: 0.4
      max_angular_vel: 1.0
      transform_tolerance: 1.0
```

In the above snippet, you can observe the mapping of our `nav2_pure_pursuit_controller::PurePursuitController` controller to its id `FollowPath`.
To pass plugin-specific parameters we have used `<plugin_id>.<plugin_specific_parameter>`.

###### 4- Run Pure Pursuit Controller plugin

Run Turtlebot3 simulation with enabled Nav2. Detailed instructions on how to make it run are written at [Getting Started](../../getting_started/index.html#getting-started). Below is a shortcut command for that:

```
$ ros2 launch nav2_bringup tb3_simulation_launch.py params_file:=/path/to/your_params_file.yaml
```

Then goto RViz and click on the “2D Pose Estimate” button at the top and point the location on the map as it was described in [Getting Started](../../getting_started/index.html#getting-started).
The robot will localize on the map and then click on the “Nav2 goal” and click on the pose where you want your robot to navigate to.
After that controller will make the robot follow the global path.

---

#### Writing a New Costmap2D Plugin

*Source: [https://docs.nav2.org/plugin_tutorials/docs/writing_new_costmap2d_plugin.html](https://docs.nav2.org/plugin_tutorials/docs/writing_new_costmap2d_plugin.html)*

##### Writing a New Costmap2D Plugin

* [Overview](#overview)
* [Requirements](#requirements)
* [Tutorial Steps](#tutorial-steps)

[![Animated gif with gradient demo](../../_images/gradient_layer_preview.gif)](../../_images/gradient_layer_preview.gif)

###### Overview

This tutorial shows how to create your own simple [plugin](http://wiki.ros.org/pluginlib) for Costmap2D.

Before starting the tutorial, please check this [video](https://vimeo.com/106994708) which contains information about Costmap2D layers design and plugins basic operational principals.

###### Requirements

It is assumed that ROS 2, Gazebo and TurtleBot3 packages are installed or built locally. Please make sure that Nav2 project is also built locally as it was made in [Build and Install](../../development_guides/build_docs/index.html#build-instructions).

###### Tutorial Steps

###### 1- Write a new Costmap2D plugin

For a demonstration, this example will create a costmap plugin that puts repeating cost gradients in the costmap.
The annotated code for this tutorial can be found in [navigation2\_tutorials](https://github.com/ros-navigation/navigation2_tutorials) repository as the `nav2_gradient_costmap_plugin` ROS 2-package.
Please refer to it when making your own layer plugin for Costmap2D.

The plugin class `nav2_gradient_costmap_plugin::GradientLayer` is inherited from basic class `nav2_costmap_2d::Layer`:

```
namespace nav2_gradient_costmap_plugin
{

class GradientLayer : public nav2_costmap_2d::Layer
```

The basic class provides the set of virtual methods API for working with costmap layers in a plugin. These methods are called at runtime by `LayeredCostmap`. The list of methods, their description, and necessity to have these methods in plugin’s code is presented in the table below:

|  |  |  |
| --- | --- | --- |
| **Virtual method** | **Method description** | **Requires override?** |
| onInitialize() | Method is called at the end of plugin initialization. There is usually declarations of ROS parameters. This is where any required initialization should occur. | No |
| updateBounds() | Method is called to ask the plugin: which area of costmap layer it needs to update. The method has 3 input parameters: robot position and orientation, and 4 output parameters: pointers to window bounds. These bounds are used for performance reasons: to update the area inside the window where new info is available, avoiding updates of the whole costmap on every iteration. | Yes |
| updateCosts() | Method is called each time when costmap re-calculation is required. It updates the costmap layer only within its bounds window. The method has 4 input parameters: calculation window bounds, and 1 output parameter: reference to a resulting costmap `master_grid`. The `Layer` class provides the plugin with an internal costmap, `costmap_`, for updates. The `master_grid` should be updated with values within the window bounds using one of the following update methods: `updateWithAddition()`, `updateWithMax()`, `updateWithOverwrite()` or `updateWithTrueOverwrite()`. | Yes |
| matchSize() | Method is called each time when map size was changed. | No |
| onFootprintChanged() | Method is called each time when footprint was changed. | No |
| reset() | It may have any code to be executed during costmap reset. | Yes |

In our example these methods have the following functionality:

1. `GradientLayer::onInitialize()` contains declaration of a ROS parameter with its default value:

```
declareParameter("enabled", rclcpp::ParameterValue(true));
node_->get_parameter(name_ + "." + "enabled", enabled_);
```

and sets `need_recalculation_` bounds recalculation indicator:

```
need_recalculation_ = false;
```

2. `GradientLayer::updateBounds()` re-calculates window bounds if `need_recalculation_` is `true` and updates them regardless of `need_recalculation_` value.
3. `GradientLayer::updateCosts()` - in this method the gradient is writing directly to the resulting costmap `master_grid` without merging with previous layers. This is equal to working with internal `costmap_` and then calling `updateWithTrueOverwrite()` method. Here is the gradient making algorithm for master costmap:

```
int gradient_index;
for (int j = min_j; j < max_j; j++) {
  // Reset gradient_index each time when reaching the end of re-calculated window
  // by OY axis.
  gradient_index = 0;
  for (int i = min_i; i < max_i; i++) {
    int index = master_grid.getIndex(i, j);
    // setting the gradient cost
    unsigned char cost = (LETHAL_OBSTACLE - gradient_index*GRADIENT_FACTOR)%5;
    if (gradient_index <= GRADIENT_SIZE) {
      gradient_index++;
    } else {
      gradient_index = 0;
    }
    master_array[index] = cost;
  }
}
```

where the `GRADIENT_SIZE` is the size of each gradient period in map cells, `GRADIENT_FACTOR` - decrement of costmap’s value per each step:

![../../_images/gradient_explanation.png](../../_images/gradient_explanation.png)

These parameters are defined in plugin’s header file.

4. `GradientLayer::onFootprintChanged()` just resets `need_recalculation_` value.
5. `GradientLayer::reset()` method is dummy: it is not used in this example plugin. It remains there since pure virtual function `reset()` in parent `Layer` class required to be overridden.

###### 2- Export and make GradientLayer plugin

The written plugin will be loaded at runtime as its basic parent class and then will be called by plugin handling modules (for costmap2d by `LayeredCostmap`). Pluginlib opens a given plugin in run-time and provides methods from exported classes to be callable. The mechanism of class exporting tells pluginlib which basic class should be used during these calls. This allows to extend an application by plugins without knowing application source code or recompiling it.

In our example the `nav2_gradient_costmap_plugin::GradientLayer` plugin’s class should be dynamically loaded as a `nav2_costmap_2d::Layer` basic class. For this the plugin should be registered as follows:

1. Plugin’s class should be registered with a basic type of loaded class. For this there is a special macro `PLUGINLIB_EXPORT_CLASS` should be added to any source-file composing the plugin library:

```
#include "pluginlib/class_list_macros.hpp"
PLUGINLIB_EXPORT_CLASS(nav2_gradient_costmap_plugin::GradientLayer, nav2_costmap_2d::Layer)
```

This part is usually placed at the end of cpp-file where the plugin class was written (in our example `gradient_layer.cpp`). It is good practice to place these lines at the end of the file, but technically, you can also place at the top.

2. Plugin’s information should be stored to the plugin’s description file. This is done by using separate XML (in our example `gradient_plugins.xml`) in the plugin’s package. This file contains information about:

> * `path`: Path and name of library where plugin is placed.
> * `name`: Plugin type referenced in `plugin_types` parameter (see next section for more details). It could be whatever you want.
> * `type`: Plugin class with namespace taken from the source code.
> * `basic_class_type`: Basic parent class from which plugin class was derived.
> * `description`: Plugin description in a text form.

```
<library path="nav2_gradient_costmap_plugin_core">
  <class type="nav2_gradient_costmap_plugin::GradientLayer" base_class_type="nav2_costmap_2d::Layer">
    <description>This is an example plugin which puts repeating costs gradients to costmap</description>
  </class>
</library>
```

The export of plugin is performed by including `pluginlib_export_plugin_description_file()` cmake-function into `CMakeLists.txt`. This function installs plugin description file into `share` directory and sets ament indexes for plugin description XML to be discoverable as a plugin of selected type:

```
pluginlib_export_plugin_description_file(nav2_costmap_2d gradient_layer.xml)
```

Plugin description file is also should be added to `package.xml`. `costmap_2d` is the package of the interface definition, for our case `Layer`, and requires a path to the xml file:

```
<export>
  <costmap_2d plugin="${prefix}/gradient_layer.xml" />
  ...
</export>
```

After everything is done put the plugin package into `src` directory of a certain ROS 2-workspace, build the plugin package (`colcon build --packages-select nav2_gradient_costmap_plugin --symlink-install`) and source `setup.bash` file when it necessary.

Now the plugin is ready to use. You can verify that it has been successfully registered by running:

```
$ ros2 plugin list
```

You should see an output similar to below:

```
nav2_gradient_costmap_plugin:
      Plugin(name='nav2_gradient_costmap_plugin::GradientLayer', type='nav2_gradient_costmap_plugin::GradientLayer', base='nav2_costmap_2d::Layer')
```

###### 3- Enable the plugin in Costmap2D

At the next step it is required to tell Costmap2D about new plugin. For that the plugin should be added to `plugin_names` and `plugin_types` lists in `nav2_params.yaml` optionally for `local_costmap`/`global_costmap` in order to be enabled in run-time for Controller/Planner Server. `plugin_names` list contains the names of plugin objects. These names could be anything you want. `plugin_types` contains types of listed in `plugin_names` objects. These types should correspond to `name` field of plugin class specified in plugin description XML-file.

Note

For Galactic or later, `plugin_names` and `plugin_types` have been replaced with a single `plugins` string vector for plugin names. The types are now defined in the `plugin_name` namespace in the `plugin:` field (e.g. `plugin: MyPlugin::Plugin`). Inline comments in the code blocks will help guide you through this.

For example:

```
--- a/nav2_bringup/bringup/params/nav2_params.yaml
+++ b/nav2_bringup/bringup/params/nav2_params.yaml
@@ -124,8 +124,8 @@ local_costmap:
       width: 3
       height: 3
       resolution: 0.05
-      plugins: ["obstacle_layer", "voxel_layer", "inflation_layer"]
+      plugins: ["obstacle_layer", "voxel_layer", "gradient_layer"]
       robot_radius: 0.22
       inflation_layer:
         cost_scaling_factor: 3.0
@@ -171,8 +171,8 @@ global_costmap:
       robot_base_frame: base_link
       global_frame: map
-      plugins: ["static_layer", "obstacle_layer", "voxel_layer", "inflation_layer"]
+      plugins: ["static_layer", "obstacle_layer", "voxel_layer", "gradient_layer"]
       robot_radius: 0.22
       resolution: 0.05
       obstacle_layer:
```

YAML-file may also contain the list of parameters (if any) for each plugin, identified by plugins object name.

NOTE: there could be many simultaneously loaded plugin objects of one type. For this, `plugin_names` list should contain different plugins names whether the `plugin_types` will remain the same types. For example:

```
plugins: ["obstacle_layer", "gradient_layer_1", "gradient_layer_2"]
```

In this case each plugin object will be handled by its own parameters tree in a YAML-file, like:

```
gradient_layer_1:
  plugin: nav2_gradient_costmap_plugin::GradientLayer # In Iron and older versions, "/" was used instead of "::"
  enabled: True
  ...
gradient_layer_2:
  plugin: nav2_gradient_costmap_plugin::GradientLayer # In Iron and older versions, "/" was used instead of "::"
  enabled: False
  ...
```

Note

The order in which plugins are listed in the configuration is significant, as it determines the sequence in which they are applied to the costmap. For example, if the inflation layer is listed before the range layer, obstacles added to the costmap by the range layer will not be inflated.

###### 4- Run GradientLayer plugin

Run Turtlebot3 simulation with enabled Nav2. Detailed instructions how to make it are written at [Getting Started](../../getting_started/index.html#getting-started). Below is shortcut command for that:

```
$ ros2 launch nav2_bringup tb3_simulation_launch.py
```

Then goto RViz and click on the “2D Pose Estimate” button at the top and point the location on map as it was described in [Getting Started](../../getting_started/index.html#getting-started). Robot will be localized on map and the result should be as presented at picture below. There, the gradient costmap can be seen. There are also 2 noticeable things: dynamically updated by `GradientLayer::updateCosts()` costmap within its bounds and global path curved by gradient:

[![Image of gradient costmap used](../../_images/gradient_layer_run.png)](../../_images/gradient_layer_run.png)

---

#### Writing a New Navigator Plugin

*Source: [https://docs.nav2.org/plugin_tutorials/docs/writing_new_navigator_plugin.html](https://docs.nav2.org/plugin_tutorials/docs/writing_new_navigator_plugin.html)*

##### Writing a New Navigator Plugin

* [Overview](#overview)
* [Requirements](#requirements)
* [Tutorial Steps](#tutorial-steps)

###### Overview

This tutorial shows how to create your own behavior-tree navigator [plugin](https://index.ros.org/p/pluginlib/) based on the `nav2_core::BehaviorTreeNavigator` base class.

In this tutorial, we will be reviewing the `Navigate to Pose` behavior-tree navigator plugin, which is the foundational navigator of Nav2 and complimentary behavior to ROS 1 Navigation. This completes point-to-point navigation. This tutorial will be reviewing the code and structure as of ROS 2 Iron. While small variations may be made over time, this should be sufficient to get started writing your own navigator if you choose as we do not expect major API changes on this system.

It may be beneficial to write your own Navigator if you have a custom action message definition you’d like to use with Navigation rather than the provided `NavigateToPose` or `NavigateThroughPoses` interfaces (e.g. doing complete coverage or containing additional constraint information). The role of the Navigators are to extract information from requests to pass to the behavior tree / blackboard, populate feedback and responses, and maintain the state of the behavior tree if relevant. The behavior tree XML will define the actual navigation logic used.

###### Requirements

* ROS 2 (binary or build-from-source)
* Nav2 (Including dependencies)
* Gazebo
* Turtlebot3

###### Tutorial Steps

###### 1- Create a new Navigator Plugin

We will be implementing pure point-to-point navigation behavior. The code in this tutorial can be found in [Nav2’s BT Navigator package](https://github.com/ros-navigation/navigation2/tree/main/nav2_bt_navigator) as the `NavigateToPoseNavigator`. This package can be considered as a reference for writing your own plugin.

Our example plugin class `nav2_bt_navigator::NavigateToPoseNavigator` inherits from the base class `nav2_core::BehaviorTreeNavigator`. The base class provides a set of virtual methods to implement a navigator plugin. These methods are called at runtime by the BT Navigator server or as a response to ROS 2 actions to process a navigation request.

Note that this class has itself a base class of `NavigatorBase`. This class is to provide a non-templated base-class for use in loading the plugins into vectors for storage and calls for basic state transition in the lifecycle node. Its members (e.g. `on_XYZ`) are implemented for you in `BehaviorTreeNavigator` and marked as `final` so they are not possible to be overridden by the user. The API that you will be implementing for your navigator are the virtual methods within `BehaviorTreeNavigator`, not `NavigatorBase`. These `on_XYZ` APIs are implemented in necessary functions in `BehaviorTreeNavigator` to handle boilerplate logic regarding the behavior tree and action server to minimize code duplication across the navigator implementations (e.g. `on_configure` will create the action server, register callbacks, populate the blackboard with some necessary basic information, and then call a user-defined `configure` function for any additional user-specific needs).

The list of methods, their descriptions, and necessity are presented in the table below:

|  |  |  |
| --- | --- | --- |
| **Virtual method** | **Method description** | **Requires override?** |
| getDefaultBTFilepath() | Method is called on initialization to retrieve the default BT filepath to use for navigation. This may be done via parameters, hardcoded logic, sentinel files, etc. | Yes |
| configure() | Method is called when BT navigator server enters on\_configure state. This method should implement operations which are necessary before navigator goes to an active state, such as getting parameters, setting up the blackboard, etc. | No |
| activate() | Method is called when BT navigator server enters on\_activate state. This method should implement operations which are necessary before navigator goes to an active state, such as create clients and subscriptions. | No |
| deactivate() | Method is called when BT navigator server enters on\_deactivate state. This method should implement operations which are necessary before navigator goes to an inactive state. | No |
| cleanup() | Method is called when BT navigator server goes to on\_cleanup state. This method should clean up resources which are created for the navigator. | No |
| goalReceived() | Method is called when a new goal is received by the action server to process. It may accept or deny this goal with its return signature. If accepted, it may need to load the appropriate parameters from the request (e.g. which BT to use), add request parameters to the blackboard for your applications use, or reset internal state. | Yes |
| onLoop() | Method is called periodically while the behavior tree is looping to check statuses or more commonly to publish action feedback statuses to the client. | Yes |
| onPreempt() | Method is called when a new goal is requesting preemption over the existing goal currently being processed. If the new goal is viable, it should make all appropriate updates to the BT and blackboard such that this new request may immediately start being processed without hard cancellation of the initial task (e.g. preemption). | Yes |
| goalCompleted() | Method is called when a goal is completed to populate the action result object or do any additional checks required at the end of a task. | Yes |
| getName() | Method is called to get the name of this navigator type | Yes |

In the Navigate to Pose Navigator, `configure()` method must determine the blackboard parameter names where the goal and paths are being stored, as these are key values for processing feedback in `onLoop` and for the different behavior tree nodes to communicate this information between themselves. Additionally and uniquely to this navigator type, we also create a client to itself and a subscription to the `goal_pose` topic such that requests from the default configurations of Rviz2 using the *Goal Pose* tool will be processed.

```
bool NavigateToPoseNavigator::configure(
  rclcpp_lifecycle::LifecycleNode::WeakPtr parent_node,
  std::shared_ptr<nav2_util::OdomSmoother> odom_smoother)
{
  start_time_ = rclcpp::Time(0);
  auto node = parent_node.lock();

  if (!node->has_parameter("goal_blackboard_id")) {
    node->declare_parameter("goal_blackboard_id", std::string("goal"));
  }

  goal_blackboard_id_ = node->get_parameter("goal_blackboard_id").as_string();

  if (!node->has_parameter("path_blackboard_id")) {
    node->declare_parameter("path_blackboard_id", std::string("path"));
  }

  path_blackboard_id_ = node->get_parameter("path_blackboard_id").as_string();

  // Odometry smoother object for getting current speed
  odom_smoother_ = odom_smoother;

  self_client_ = rclcpp_action::create_client<ActionT>(node, getName());

  goal_sub_ = node->create_subscription<geometry_msgs::msg::PoseStamped>(
    "goal_pose",
    rclcpp::SystemDefaultsQoS(),
    std::bind(&NavigateToPoseNavigator::onGoalPoseReceived, this, std::placeholders::_1));
  return true;
}
```

The values of the blackboard IDs are stored alongside the odometry smoother the BT Navigator provides for populating meaningful feedback later. Complimentary to this, the `cleanup` method will reset these resources. The activate and deactivate methods are not used in this particular navigator.

```
bool NavigateToPoseNavigator::cleanup()
{
  goal_sub_.reset();
  self_client_.reset();
  return true;
}
```

In the `getDefaultBTFilepath()`, we use a parameter `default_nav_to_pose_bt_xml` to get the default behavior tree XML file to use if none is provided by the navigation request and to initialize the BT Navigator with a behavior tree hot-loaded. If one is not provided in the parameter files, then we grab a known and reasonable default XML file in the `nav2_bt_navigator` package:

```
std::string NavigateToPoseNavigator::getDefaultBTFilepath(
  rclcpp_lifecycle::LifecycleNode::WeakPtr parent_node)
{
  std::string default_bt_xml_filename;
  auto node = parent_node.lock();

  if (!node->has_parameter("default_nav_to_pose_bt_xml")) {
    std::string pkg_share_dir =
      ament_index_cpp::get_package_share_directory("nav2_bt_navigator");
    node->declare_parameter<std::string>(
      "default_nav_to_pose_bt_xml",
      pkg_share_dir +
      "/behavior_trees/navigate_to_pose_w_replanning_and_recovery.xml");
  }

  node->get_parameter("default_nav_to_pose_bt_xml", default_bt_xml_filename);

  return default_bt_xml_filename;
}
```

When a goal is received, we need to determine if this goal is valid and should be processed.
The `goalReceived` method provides you the `goal` and a return value if it is being processed or not. This information is sent back to the action server to notify the client. In this case, we want to make sure that the goal’s behavior tree is valid or else we cannot proceed. If it is valid, then we can initialize the goal pose onto the blackboard and reset some state in order to cleanly process this new request.

```
bool NavigateToPoseNavigator::goalReceived(ActionT::Goal::ConstSharedPtr goal)
{
  auto bt_xml_filename = goal->behavior_tree;

  if (!bt_action_server_->loadBehaviorTree(bt_xml_filename)) {
    RCLCPP_ERROR(
      logger_, "BT file not found: %s. Navigation canceled.",
      bt_xml_filename.c_str());
    return false;
  }

  initializeGoalPose(goal);

  return true;
}
```

Once this goal is completed, we need to populate the Action’s result, if required and meaningful. In this navigator’s case, it contains no result information when the navigation request was completed successfully, so this method is empty. For other navigator types, you may populate the `result` object provided.

```
void NavigateToPoseNavigator::goalCompleted(
  typename ActionT::Result::SharedPtr /*result*/,
  const nav2_behavior_tree::BtStatus /*final_bt_status*/)
{
}
```

If however a goal is preempted (e.g. a new action request comes in while an existing request is being processed), the `onPreempt()` method is called to determine if the new request is genuine and appropriate to preempt the currently processing goal. For example, it might not be wise to accept a preeemption request if that request is fundamentally different in nature from an existing behavior tree task or when your existing task is of a higher priority.

```
void NavigateToPoseNavigator::onPreempt(ActionT::Goal::ConstSharedPtr goal)
{
  RCLCPP_INFO(logger_, "Received goal preemption request");

  if (goal->behavior_tree == bt_action_server_->getCurrentBTFilename() ||
    (goal->behavior_tree.empty() &&
    bt_action_server_->getCurrentBTFilename() == bt_action_server_->getDefaultBTFilename()))
  {
    // if pending goal requests the same BT as the current goal, accept the pending goal
    // if pending goal has an empty behavior_tree field, it requests the default BT file
    // accept the pending goal if the current goal is running the default BT file
    initializeGoalPose(bt_action_server_->acceptPendingGoal());
  } else {
    RCLCPP_WARN(
      logger_,
      "Preemption request was rejected since the requested BT XML file is not the same "
      "as the one that the current goal is executing. Preemption with a new BT is invalid "
      "since it would require cancellation of the previous goal instead of true preemption."
      "\nCancel the current goal and send a new action request if you want to use a "
      "different BT XML file. For now, continuing to track the last goal until completion.");
    bt_action_server_->terminatePendingGoal();
  }
}
```

Note that here you can also see the `initializeGoalPose` method called. This method will set the goal parameters for this navigator onto the blackboard and reset important state information to cleanly reuse a behavior tree without old state information, as shown below:

```
void
NavigateToPoseNavigator::initializeGoalPose(ActionT::Goal::ConstSharedPtr goal)
{
  RCLCPP_INFO(
    logger_, "Begin navigating from current location to (%.2f, %.2f)",
    goal->pose.pose.position.x, goal->pose.pose.position.y);

  // Reset state for new action feedback
  start_time_ = clock_->now();
  auto blackboard = bt_action_server_->getBlackboard();
  blackboard->set<int>("number_recoveries", 0);  // NOLINT

  // Update the goal pose on the blackboard
  blackboard->set<geometry_msgs::msg::PoseStamped>(goal_blackboard_id_, goal->pose);
}
```

The recovery counter and start time are both important feedback terms for a client to understand the state of the current task (e.g. if its failing, having problems, or taking exceptionally long). The setting of the goal on the blackboard is taken by the `ComputePathToPose` BT Action node to plan a new route to the goal (and then who’s path is communicated to the `FollowPath` BT node via the blackboard ID previously set).

The final function implemented is `onLoop`, which is simplified below for tutorial purposes. While anything can be done in this method, which is called as the BT is looping through the tree, it is common to use this as an opportunity to populate any necessary feedback about the state of the navigation request, robot, or metadata that a client might be interested in.

```
void NavigateToPoseNavigator::onLoop()
{
  auto feedback_msg = std::make_shared<ActionT::Feedback>();

  geometry_msgs::msg::PoseStamped current_pose = ...;
  auto blackboard = bt_action_server_->getBlackboard();
  nav_msgs::msg::Path current_path;
  blackboard->get<nav_msgs::msg::Path>(path_blackboard_id_, current_path);

  ...

  feedback_msg->distance_remaining = distance_remaining;
  feedback_msg->estimated_time_remaining = estimated_time_remaining;

  int recovery_count = 0;
  blackboard->get<int>("number_recoveries", recovery_count);
  feedback_msg->number_of_recoveries = recovery_count;
  feedback_msg->current_pose = current_pose;
  feedback_msg->navigation_time = clock_->now() - start_time_;

  bt_action_server_->publishFeedback(feedback_msg);
}
```

###### 2- Exporting the navigator plugin

Now that we have created our custom navigator, we need to export our plugin so that it would be visible to the BT Navigator server.
Plugins are loaded at runtime, and if they are not visible, then our server won’t be able to load it. In ROS 2, exporting and loading
plugins is handled by `pluginlib`.

Coming to our tutorial, class `nav2_bt_navigator::NavigateToPoseNavigator` is loaded dynamically as `nav2_core::NavigatorBase` which is our base class due to the subtleties previously described.

1. To export the controller, we need to provide two lines

```
#include "pluginlib/class_list_macros.hpp"
PLUGINLIB_EXPORT_CLASS(nav2_bt_navigator::NavigateToPoseNavigator, nav2_core::NavigatorBase)
```

Note that it requires pluginlib to export out the plugin’s class. Pluginlib would provide as macro `PLUGINLIB_EXPORT_CLASS`, which does all the work of exporting.

It is good practice to place these lines at the end of the file, but technically, you can also write at the top.

2. The next step would be to create the plugin’s description file in the root directory of the package. For example, `navigator_plugin.xml` file in our tutorial package. This file contains the following information

* `library path`: Plugin’s library name and it’s location.
* `class name`: Name of the class (optional). If not set, it will default to the `class type`.
* `class type`: Type of class.
* `base class`: Name of the base class.
* `description`: Description of the plugin.

```
<library path="nav2_bt_navigator">
  <class type="nav2_bt_navigator::NavigateToPoseNavigator" base_class_type="nav2_core::NavigatorBase">
    <description>
      This is pure point-to-point navigation
    </description>
  </class>
</library>
```

3. Next step would be to export plugin using `CMakeLists.txt` by using CMake function `pluginlib_export_plugin_description_file()`. This function installs the plugin description file to `share` directory and sets ament indexes to make it discoverable.

```
pluginlib_export_plugin_description_file(nav2_core navigator_plugin.xml)
```

4. The plugin description file should also be added to `package.xml`

```
<export>
  <build_type>ament_cmake</build_type>
  <nav2_core plugin="${prefix}/navigator_plugin.xml" />
</export>
```

5. Compile, and it should be registered. You can verify that it has been successfully registered by running:

```
$ ros2 plugin list
```

You should see an output similar to below:

```
nav2_bt_navigator:
      Plugin(name='nav2_bt_navigator::NavigateToPoseNavigator', type='nav2_bt_navigator::NavigateToPoseNavigator', base='nav2_core::NavigatorBase')
```

Next, we’ll use this plugin.

###### 3- Pass the plugin name through the params file

To enable the plugin, we need to modify the `nav2_params.yaml` file as below

```
bt_navigator:
  ros__parameters:
    global_frame: map
    robot_base_frame: base_link
    transform_tolerance: 0.1
    default_nav_to_pose_bt_xml: replace/with/path/to/bt.xml # or $(find-pkg-share my_package)/behavior_tree/my_nav_to_pose_bt.xml
    default_nav_through_poses_bt_xml: replace/with/path/to/bt.xml # or $(find-pkg-share my_package)/behavior_tree/my_nav_through_poses_bt.xml
    goal_blackboard_id: goal
    goals_blackboard_id: goals
    path_blackboard_id: path
    navigators: ['navigate_to_pose', 'navigate_through_poses']
    navigate_to_pose:
      plugin: "nav2_bt_navigator::NavigateToPoseNavigator" # In Iron and older versions, "/" was used instead of "::"
    navigate_through_poses:
      plugin: "nav2_bt_navigator::NavigateThroughPosesNavigator" # In Iron and older versions, "/" was used instead of "::"
```

In the above snippet, you can observe the mapping of our `nav2_bt_navigator::NavigateToPoseNavigator` plugin to its id `navigate_to_pose`.
To pass plugin-specific parameters we have used `<plugin_id>.<plugin_specific_parameter>`.

###### 4- Run plugin

Run Turtlebot3 simulation with enabled Nav2. Detailed instructions on how to make it run are written at [Getting Started](../../getting_started/index.html#getting-started). Below is a shortcut command for that:

```
$ ros2 launch nav2_bringup tb3_simulation_launch.py params_file:=/path/to/your_params_file.yaml
```

Then goto RViz and click on the “2D Pose Estimate” button at the top and point the location on the map as it was described in [Getting Started](../../getting_started/index.html#getting-started).
The robot will localize on the map and then click on the “Nav2 goal” and click on the pose where you want your robot to navigate to.
After that navigator will take over with the behavior tree XML file behavior definition provided to it.

---

#### Writing a New Planner Plugin

*Source: [https://docs.nav2.org/plugin_tutorials/docs/writing_new_nav2planner_plugin.html](https://docs.nav2.org/plugin_tutorials/docs/writing_new_nav2planner_plugin.html)*

##### Writing a New Planner Plugin

* [Overview](#overview)
* [Requirements](#requirements)
* [Tutorial Steps](#tutorial-steps)

[![Animated gif with gradient demo](../../_images/nav2_straightline_gif.gif)](../../_images/nav2_straightline_gif.gif)

###### Overview

This tutorial shows how to create your own planner plugin.

###### Requirements

* ROS 2 (binary or build-from-source)
* Nav2 (Including dependencies)
* Gazebo
* Turtlebot3

###### Tutorial Steps

###### 1- Creating a new Planner Plugin

We will create a simple straight-line planner.
The annotated code in this tutorial can be found in [navigation\_tutorials](https://github.com/ros-navigation/navigation2_tutorials) repository as the `nav2_straightline_planner`.
This package can be considered as a reference for writing planner plugin.

Our example plugin inherits from the base class `nav2_core::GlobalPlanner`. The base class provides 5 pure virtual methods to implement a planner plugin. The plugin will be used by the planner server to compute trajectories.
Let’s learn more about the methods needed to write a planner plugin.

|  |  |  |
| --- | --- | --- |
| **Virtual method** | **Method description** | **Requires override?** |
| configure() | Method is called at when planner server enters on\_configure state. Ideally this methods should perform declarations of ROS parameters and initialization of planner’s member variables. This method takes 4 input params: shared pointer to parent node, planner name, tf buffer pointer and shared pointer to costmap. | Yes |
| activate() | Method is called when planner server enters on\_activate state. Ideally this method should implement operations which are necessary before planner goes to an active state. | Yes |
| deactivate() | Method is called when planner server enters on\_deactivate state. Ideally this method should implement operations which are necessary before planner goes to an inactive state. | Yes |
| cleanup() | Method is called when planner server goes to on\_cleanup state. Ideally this method should clean up resources which are created for the planner. | Yes |
| createPlan() | Method is called when planner server demands a global plan for specified start and goal pose. This method returns nav\_msgs::msg::Path carrying global plan. This method takes 3 input params: start pose, goal pose and a function to check if the action has been canceled. | Yes |

For this tutorial, we will be using methods `StraightLine::configure()` and `StraightLine::createPlan()` to create straight-line planner.

In planners, `configure()` method must set member variables from ROS parameters and any initialization required,

```
node_ = parent;
tf_ = tf;
name_ = name;
costmap_ = costmap_ros->getCostmap();
global_frame_ = costmap_ros->getGlobalFrameID();

// Parameter initialization
nav2_util::declare_parameter_if_not_declared(node_, name_ + ".interpolation_resolution", rclcpp::ParameterValue(0.1));
node_->get_parameter(name_ + ".interpolation_resolution", interpolation_resolution_);
```

Here, `name_ + ".interpolation_resolution"` is fetching the ROS parameters `interpolation_resolution` which is specific to our planner. Nav2 allows the loading of multiple plugins, and to keep things organized, each plugin is mapped to some ID/name. Now if we want to retrieve the parameters for that specific plugin, we use `<mapped_name_of_plugin>.<name_of_parameter>` as done in the above snippet. For example, our example planner is mapped to the name “GridBased” and to retrieve the `interpolation_resolution` parameter which is specific to “GridBased”, we used `Gridbased.interpolation_resolution`. In other words, `GridBased` is used as a namespace for plugin-specific parameters. We will see more on this when we discuss the parameters file (or params file).

In `createPlan()` method, we need to create a path from the given start to goal poses. The `StraightLine::createPlan()` is called using start pose and goal pose to solve the global path planning problem. Upon succeeding, it converts the path to the `nav_msgs::msg::Path` and returns to the planner server. Below annotation shows the implementation of this method.

```
nav_msgs::msg::Path global_path;

// Checking if the goal and start state is in the global frame
if (start.header.frame_id != global_frame_) {
  RCLCPP_ERROR(
    node_->get_logger(), "Planner will only except start position from %s frame",
    global_frame_.c_str());
  return global_path;
}

if (goal.header.frame_id != global_frame_) {
  RCLCPP_INFO(
    node_->get_logger(), "Planner will only except goal position from %s frame",
    global_frame_.c_str());
  return global_path;
}

global_path.poses.clear();
global_path.header.stamp = node_->now();
global_path.header.frame_id = global_frame_;
// calculating the number of loops for current value of interpolation_resolution_
int total_number_of_loop = std::hypot(
  goal.pose.position.x - start.pose.position.x,
  goal.pose.position.y - start.pose.position.y) /
  interpolation_resolution_;
double x_increment = (goal.pose.position.x - start.pose.position.x) / total_number_of_loop;
double y_increment = (goal.pose.position.y - start.pose.position.y) / total_number_of_loop;

for (int i = 0; i < total_number_of_loop; ++i) {
  geometry_msgs::msg::PoseStamped pose;
  pose.pose.position.x = start.pose.position.x + x_increment * i;
  pose.pose.position.y = start.pose.position.y + y_increment * i;
  pose.pose.position.z = 0.0;
  pose.pose.orientation.x = 0.0;
  pose.pose.orientation.y = 0.0;
  pose.pose.orientation.z = 0.0;
  pose.pose.orientation.w = 1.0;
  pose.header.stamp = node_->now();
  pose.header.frame_id = global_frame_;
  global_path.poses.push_back(pose);
}

global_path.poses.push_back(goal);

return global_path;
```

The remaining methods are not used but it’s mandatory to override them. As per the rules, we did override all but left them blank.

###### 2- Exporting the planner plugin

Now that we have created our custom planner, we need to export our planner plugin so that it will be visible to the planner server. Plugins are loaded at runtime and if they are not visible, then our planner server won’t be able to load it. In ROS 2, exporting and loading plugins is handled by `pluginlib`.

Coming back to our tutorial, class `nav2_straightline_planner::StraightLine` is loaded dynamically as `nav2_core::GlobalPlanner` which is our base class.

1. To export the planner, we need to provide two lines

```
#include "pluginlib/class_list_macros.hpp"
PLUGINLIB_EXPORT_CLASS(nav2_straightline_planner::StraightLine, nav2_core::GlobalPlanner)
```

Note that it requires pluginlib to export out plugin’s class. Pluginlib would provide as macro `PLUGINLIB_EXPORT_CLASS` which does all the work of exporting.

It is good practice to place these lines at the end of the file, but technically, you can also write at the top.

2. Next step would be to create plugin’s description file in the root directory of the package. For example, `global_planner_plugin.xml` file in our tutorial package. This file contains the following information

> * `library path`: Plugin’s library name and its location.
> * `class name`: Name of the class (optional). If not set, it will default to the `class type`.
> * `class type`: Type of class.
> * `base class`: Name of the base class.
> * `description`: Description of the plugin.

```
<library path="nav2_straightline_planner_plugin">
  <class type="nav2_straightline_planner::StraightLine" base_class_type="nav2_core::GlobalPlanner">
    <description>This is an example plugin which produces straight path.</description>
  </class>
</library>
```

3. Next step would be to export plugin using `CMakeLists.txt` by using cmake function `pluginlib_export_plugin_description_file()`. This function installs plugin description file to `share` directory and sets ament indexes to make it discoverable.

```
pluginlib_export_plugin_description_file(nav2_core global_planner_plugin.xml)
```

4. Plugin description file should also be added to `package.xml`

```
<export>
  <build_type>ament_cmake</build_type>
  <nav2_core plugin="${prefix}/global_planner_plugin.xml" />
</export>
```

5. Compile and it should be registered. You can verify that it has been successfully registered by running:

```
$ ros2 plugin list
```

You should see an output similar to below:

```
nav2_straightline_planner:
      Plugin(name='nav2_straightline_planner::StraightLine', type='nav2_straightline_planner::StraightLine', base='nav2_core::GlobalPlanner')
```

Next, we’ll use this plugin.

###### 3- Pass the plugin name through params file

To enable the plugin, we need to modify the `nav2_params.yaml` file as below to replace following params

Note

For Galactic or later, `plugin_names` and `plugin_types` have been replaced with a single `plugins` string vector for plugin names. The types are now defined in the `plugin_name` namespace in the `plugin:` field (e.g. `plugin: MyPlugin::Plugin`). Inline comments in the code blocks will help guide you through this.

```
planner_server:
  ros__parameters:
    plugins: ["GridBased"]
    GridBased:
      plugin: "nav2_navfn_planner::NavfnPlanner" # For Foxy and later. In Iron and older versions, "/" was used instead of "::"
      tolerance: 2.0
      use_astar: false
      allow_unknown: true
```

with

```
planner_server:
  ros__parameters:
    plugins: ["GridBased"]
    GridBased:
      plugin: "nav2_straightline_planner::StraightLine"
      interpolation_resolution: 0.1
```

In the above snippet, you can observe the mapping of our `nav2_straightline_planner::StraightLine` planner to its id `GridBased`. To pass plugin-specific parameters, we have used `<plugin_id>.<plugin_specific_parameter>`.

###### 4- Run StraightLine plugin

Run Turtlebot3 simulation with enabled navigation2. Detailed instruction how to make it are written at [Getting Started](../../getting_started/index.html#getting-started). Below is shortcut command for that:

```
$ ros2 launch nav2_bringup tb3_simulation_launch.py params_file:=/path/to/your_params_file.yaml
```

Then goto RViz and click on the “2D Pose Estimate” button at the top and point to the location on map as it was described in [Getting Started](../../getting_started/index.html#getting-started). Robot will localize on the map and then click on “Navigation2 goal” and click on the pose where you want your planner to consider a goal pose. After that planner will plan the path and robot will start moving towards the goal.

---

## Plugins

### Navigation Plugins

*Source: [https://docs.nav2.org/plugins/index.html](https://docs.nav2.org/plugins/index.html)*

#### Navigation Plugins

There are a number of plugin interfaces for users to create their own custom applications or algorithms with.
Namely, the costmap layer, planner, controller, behavior tree, and behavior plugins.
A list of all known plugins are listed here below for ROS 2 Navigation.
If you know of a plugin, or you have created a new plugin, please consider submitting a pull request with that information.

This file can be found and edited under `sphinx_docs/plugins/index.rst`.
For tutorials on creating your own plugins, please see [Writing a New Costmap2D Plugin](../plugin_tutorials/docs/writing_new_costmap2d_plugin.html#writing-new-costmap2d-plugin), [Writing a New Behavior Tree Plugin](../plugin_tutorials/docs/writing_new_bt_plugin.html#writing-new-nbt-plugin), [Writing a New Controller Plugin](../plugin_tutorials/docs/writing_new_nav2controller_plugin.html#writing-new-nav2controller-plugin), [Writing a New Planner Plugin](../plugin_tutorials/docs/writing_new_nav2planner_plugin.html#writing-new-nav2planner-plugin), [Writing a New Behavior Plugin](../plugin_tutorials/docs/writing_new_behavior_plugin.html#writing-new-behavior-plugin), or [Writing a New Navigator Plugin](../plugin_tutorials/docs/writing_new_navigator_plugin.html#writing-new-nav2navigator-plugin).

##### Behavior-Tree Navigators

| Plugin Name | Creator | Description |
| --- | --- | --- |
| [NavigateToPoseNavigator](https://github.com/ros-navigation/navigation2/tree/main/nav2_bt_navigator/src/navigators) | Steve Macenski | Point-to-point navigation via a behavior tree action server |
| [NavigateThroughPosesNavigator](https://github.com/ros-navigation/navigation2/tree/main/nav2_bt_navigator/src/navigators) | Steve Macenski | Point-through-points navigation via a behavior tree action server |
| [CoverageNavigator](https://github.com/open-navigation/opennav_coverage/tree/main/opennav_coverage_navigator) | Steve Macenski | Complete coverage navigation (Cartesian or GPS) via a BTs |

##### Costmap Layers

| Plugin Name | Creator | Description |
| --- | --- | --- |
| [Voxel Layer](https://github.com/ros-navigation/navigation2/tree/main/nav2_costmap_2d/plugins/voxel_layer.cpp) | Eitan Marder-Eppstein | Maintains persistent 3D voxel layer using depth and laser sensor readings and raycasting to clear free space |
| [Range Layer](https://github.com/ros-navigation/navigation2/tree/main/nav2_costmap_2d/plugins/range_sensor_layer.cpp) | David Lu | Uses a probabilistic model to put data from sensors that publish range msgs on the costmap |
| [Static Layer](https://github.com/ros-navigation/navigation2/tree/main/nav2_costmap_2d/plugins/static_layer.cpp) | Eitan Marder-Eppstein | Gets static `map` and loads occupancy information into costmap |
| [Inflation Layer](https://github.com/ros-navigation/navigation2/tree/main/nav2_costmap_2d/plugins/inflation_layer.cpp) | Eitan Marder-Eppstein | Inflates lethal obstacles in costmap with exponential decay |
| [Obstacle Layer](https://github.com/ros-navigation/navigation2/tree/main/nav2_costmap_2d/plugins/obstacle_layer.cpp) | Eitan Marder-Eppstein | Maintains persistent 2D costmap from 2D laser scans with raycasting to clear free space |
| [Spatio-Temporal Voxel Layer](https://github.com/SteveMacenski/spatio_temporal_voxel_layer/) | Steve Macenski | Maintains temporal 3D sparse volumetric voxel grid with decay through sensor models |
| [Non-Persistent Voxel Layer](https://github.com/SteveMacenski/nonpersistent_voxel_layer) | Steve Macenski | Maintains 3D occupancy grid consisting only of the most sets of measurements |
| [Denoise Layer](https://github.com/ryzhikovas/navigation2/tree/feature-costmap2d-denoise/nav2_costmap_2d/plugins/denoise_layer.cpp) | Andrey Ryzhikov | Filters noise-induced standalone obstacles or small obstacles groups |
| [Plugin Container Layer](https://github.com/ros-navigation/navigation2/tree/main/nav2_costmap_2d/plugins/plugin_container_layer.cpp) | Alexander Yuen | Combines the different costmap layers specified under this layer in order populate the same costmap with different isolated combinations of costmap layers |

##### Costmap Filters

| Plugin Name | Creator | Description |
| --- | --- | --- |
| [Keepout Filter](https://github.com/ros-navigation/navigation2/tree/main/nav2_costmap_2d/plugins/costmap_filters/keepout_filter.cpp) | Alexey Merzlyakov | Maintains keep-out/safety zones and preferred lanes for moving |
| [Speed Filter](https://github.com/ros-navigation/navigation2/tree/main/nav2_costmap_2d/plugins/costmap_filters/speed_filter.cpp) | Alexey Merzlyakov | Limits maximum velocity of robot in speed restriction areas |
| [Binary Filter](https://github.com/ros-navigation/navigation2/tree/main/nav2_costmap_2d/plugins/costmap_filters/binary_filter.cpp) | Alexey Merzlyakov | Enables binary (boolean) mask behavior to trigger actions. |

##### Controllers

| Plugin Name | Creator | Description | Drivetrain support |
| --- | --- | --- | --- |
| [DWB Controller](https://github.com/ros-navigation/navigation2/tree/main/nav2_dwb_controller) | David Lu!! | A highly configurable DWA implementation with plugin interfaces | Differential, Omnidirectional, Legged |
| [TEB Controller](https://github.com/rst-tu-dortmund/teb_local_planner) | Christoph Rösmann | A MPC-like controller suitable for ackermann, differential, and holonomic robots. | **Ackermann**, Legged, Omnidirectional, Differential |
| [Regulated Pure Pursuit](https://github.com/ros-navigation/navigation2/tree/main/nav2_regulated_pure_pursuit_controller) | Steve Macenski | A service / industrial robot variation on the pure pursuit algorithm with adaptive features. | **Ackermann**, Legged, Differential |
| [MPPI Controller](https://github.com/ros-navigation/navigation2/tree/main/nav2_mppi_controller) | Steve Macenski Aleksei Budyakov | A predictive MPC controller with modular & custom cost functions that can accomplish many tasks. | Differential, Omni, **Ackermann** |
| [Rotation Shim Controller](https://github.com/ros-navigation/navigation2/tree/main/nav2_rotation_shim_controller) | Steve Macenski | A “shim” controller to rotate to path heading before passing to main controller for tracking. | Differential, Omni, model rotate in place |
| [Graceful Controller](https://github.com/ros-navigation/navigation2/tree/main/nav2_graceful_controller) | Alberto Tudela | A controller based on a pose-following control law to generate smooth trajectories. | Differential, Omni, Legged |
| [Vector Pursuit Controller](https://github.com/blackcoffeerobotics/vector_pursuit_controller) | Black Coffee Robotics | A controller based on the vector pursuit algorithm useful for high speed accurate path tracking. | Differential, Ackermann, Legged, |

##### Planners

| Plugin Name | Creator | Description | Drivetrain support |
| --- | --- | --- | --- |
| [NavFn Planner](https://github.com/ros-navigation/navigation2/tree/main/nav2_navfn_planner) | Eitan Marder-Eppstein & Kurt Konolige | A navigation function using A\* or Dijkstras expansion, assumes 2D holonomic particle | Differential, Omnidirectional, Legged |
| [SmacPlannerHybrid](https://github.com/ros-navigation/navigation2/tree/main/nav2_smac_planner)  (formerly SmacPlanner) | Steve Macenski | A SE2 Hybrid-A\* implementation using either Dubin or Reeds-shepp motion models with smoother and multi-resolution query. Cars, car-like, and ackermann vehicles. Kinematically feasible. | **Ackermann**, Differential, Omnidirectional, Legged |
| [SmacPlanner2D](https://github.com/ros-navigation/navigation2/tree/main/nav2_smac_planner) | Steve Macenski | A 2D A\* implementation Using either 4 or 8 connected neighborhoods with smoother and multi-resolution query | Differential, Omnidirectional, Legged |
| [SmacPlannerLattice](https://github.com/ros-navigation/navigation2/tree/main/nav2_smac_planner) | Steve Macenski | An implementation of State Lattice Planner using pre-generated minimum control sets for kinematically feasible planning with any type of vehicle imaginable. Includes generator script for Ackermann, diff, omni, and legged robots. | Differential, Omnidirectional, Ackermann, Legged, Arbitrary / Custom |
| [ThetaStarPlanner](https://github.com/ros-navigation/navigation2/tree/main/nav2_theta_star_planner) | Anshumaan Singh | An implementation of Theta\* using either 4 or 8 connected neighborhoods, assumes the robot as a 2D holonomic particle | Differential, Omnidirectional |

##### Smoothers

| Plugin Name | Creator | Description |
| --- | --- | --- |
| [Simple Smoother](https://github.com/ros-navigation/navigation2/tree/main/nav2_smoother) | Steve Macenski | A simple path smoother for infeasible (e.g. 2D) planners |
| [Constrained Smoother](https://github.com/ros-navigation/navigation2/tree/main/nav2_constrained_smoother) | Matej Vargovcik & Steve Macenski | A path smoother using a constraints problem solver to optimize various criteria such as smoothness or distance from obstacles, maintaining minimum turning radius |
| [Savitzky-Golay Smoother](https://github.com/ros-navigation/navigation2/tree/main/nav2_smoother) | Steve Macenski | A path smoother using a Savitzky-Golay filter to smooth the path via digital signal processing to remove noise from the path. |

##### Behaviors

| Plugin Name | Creator | Description |
| --- | --- | --- |
| [Clear Costmap](https://github.com/ros-navigation/navigation2/blob/main/nav2_costmap_2d/src/clear_costmap_service.cpp) | Eitan Marder-Eppstein | A service to clear the given costmap in case of incorrect perception or robot is stuck |
| [Spin](https://github.com/ros-navigation/navigation2/tree/main/nav2_behaviors/plugins) | Steve Macenski | Rotate behavior of configurable angles to clear out free space and nudge robot out of potential local failures |
| [Back Up](https://github.com/ros-navigation/navigation2/tree/main/nav2_behaviors/plugins) | Brian Wilcox | Back up behavior of configurable distance to back out of a situation where the robot is stuck |
| [Wait](https://github.com/ros-navigation/navigation2/tree/main/nav2_behaviors/plugins) | Steve Macenski | Wait behavior with configurable time to wait in case of time based obstacle like human traffic or getting more sensor data |
| [Drive On Heading](https://github.com/ros-navigation/navigation2/tree/main/nav2_behaviors/plugins) | Joshua Wallace | Drive on heading behavior with configurable distance to drive |
| [Assisted Teleop](https://github.com/ros-navigation/navigation2/tree/main/nav2_behaviors/plugins) | Joshua Wallace | AssistedTeleop behavior that scales teleop commands to prevent collisions. |

##### Waypoint Task Executors

| Plugin Name | Creator | Description |
| --- | --- | --- |
| [WaitAtWaypoint](https://github.com/ros-navigation/navigation2/tree/main/nav2_waypoint_follower/plugins/wait_at_waypoint.cpp) | Fetullah Atas | A plugin to execute a wait behavior on waypoint arrivals. |
| [PhotoAtWaypoint](https://github.com/ros-navigation/navigation2/tree/main/nav2_waypoint_follower/plugins/photo_at_waypoint.cpp) | Fetullah Atas | A plugin to take and save photos to specified directory on waypoint arrivals. |
| [InputAtWaypoint](https://github.com/ros-navigation/navigation2/tree/main/nav2_waypoint_follower/plugins/input_at_waypoint.cpp) | Steve Macenski | A plugin to wait for user input before moving onto the next waypoint. |

##### Goal Checkers

| Plugin Name | Creator | Description |
| --- | --- | --- |
| [SimpleGoalChecker](https://github.com/ros-navigation/navigation2/blob/main/nav2_controller/plugins/simple_goal_checker.cpp) | David Lu!! | A plugin check whether robot is within translational distance and rotational distance of goal. |
| [StoppedGoalChecker](https://github.com/ros-navigation/navigation2/blob/main/nav2_controller/plugins/stopped_goal_checker.cpp) | David Lu!! | A plugin check whether robot is within translational distance , rotational distance of goal, and velocity threshold. |
| [PositionGoalChecker](https://github.com/ros-navigation/navigation2/blob/main/nav2_controller/plugins/position_goal_checker.cpp) | Prabhav Saxena | A plugin check whether robot is within translational distance of goal, without requiring rotational convergence. |

##### Progress Checkers

| Plugin Name | Creator | Description |
| --- | --- | --- |
| [SimpleProgressChecker](https://github.com/ros-navigation/navigation2/blob/main/nav2_controller/plugins/simple_progress_checker.cpp) | David Lu!! | A plugin to check whether the robot was able to move a minimum distance in a given time to make progress towards a goal |
| [PoseProgressChecker](https://github.com/ros-navigation/navigation2/blob/main/nav2_controller/plugins/pose_progress_checker.cpp) | Guillaume Doisy | A plugin to check whether the robot was able to move a minimum distance or angle in a given time to make progress towards a goal |

##### Path Handlers

| Plugin Name | Creator | Description |
| --- | --- | --- |
| [FeasiblePathHandler](#feasiblepathhandler) | Maurice Alexander Purnawan | A plugin that transforms global plan to the local costmap frame, prunes it to the relevant portion within the costmap bounds, and handles in-place rotation and cusp pruning. |

##### Behavior Tree Nodes

| Action Plugin Name | Creator | Description |
| --- | --- | --- |
| [Back Up Action](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/back_up_action.cpp) | Michael Jeronimo | Calls backup behavior action |
| [Drive On Heading Action](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/drive_on_heading_action.cpp) | Joshua Wallace | Calls drive on heading behavior action |
| [Assisted Teleop Action](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/assisted_teleop_action.cpp) | Joshua Wallace | Calls assisted teleop behavior action |
| [Clear Entire Costmap Service](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/clear_costmap_service.cpp) | Carl Delsey | Calls clear entire costmap service |
| [Clear Costmap Except Region Service](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/clear_costmap_service.cpp) | Guillaume Doisy | Calls clear costmap except region service |
| [Clear Costmap Around Robot Service](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/clear_costmap_service.cpp) | Guillaume Doisy | Calls clear costmap around robot service |
| [Compute Path to Pose Action](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/compute_path_to_pose_action.cpp) | Michael Jeronimo | Calls Nav2 planner server |
| [Smooth Path Action](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/smooth_path_action.cpp) | Matej Vargovcik | Calls Nav2 smoother server |
| [Follow Path Action](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/follow_path_action.cpp) | Michael Jeronimo | Calls Nav2 controller server |
| [Navigate to Pose Action](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/navigate_to_pose_action.cpp) | Michael Jeronimo | BT Node for other BehaviorTree.CPP BTs to call Navigation2 as a subtree action |
| [Reinitialize Global Localization Service](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/reinitialize_global_localization_service.cpp) | Carl Delsey | Reinitialize AMCL to a new pose |
| [Spin Action](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/spin_action.cpp) | Carl Delsey | Calls spin behavior action |
| [Wait Action](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/wait_action.cpp) | Steve Macenski | Calls wait behavior action |
| [Truncate Path](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/truncate_path_action.cpp) | Francisco Martín | Modifies a path making it shorter |
| [Truncate Path Local](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/truncate_path_local_action.cpp) | Matej Vargovcik | Extracts a path section around robot |
| [Planner Selector](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/planner_selector_node.cpp) | Pablo Iñigo Blasco | Selects the global planner based on a topic input, otherwises uses a default planner id |
| [Controller Selector](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/controller_selector_node.cpp) | Pablo Iñigo Blasco | Selects the controller based on a topic input, otherwises uses a default controller id |
| [Goal Checker Selector](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/goal_checker_selector_node.cpp) | Pablo Iñigo Blasco | Selects the goal checker based on a topic input, otherwises uses a default goal checker id |
| [Smoother Selector](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/smoother_selector_node.cpp) | Owen Hooper | Selects the smoother based on a topic input, otherwises uses a default smoother id |
| [Progress Checker Selector](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/progress_checker_selector_node.cpp) | Steve Macenski | Selects the progress checker based on a topic input, otherwises uses a default progress checker id |
| [Path Handler Selector](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/path_handler_selector_node.cpp) | Maurice Alexander Purnawan | Selects the path handler based on a topic input, otherwises uses a default path handler id |
| [Navigate Through Poses](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/navigate_through_poses_action.cpp) | Steve Macenski | BT Node for other BehaviorTree.CPP BTs to call Nav2’s NavThroughPoses action |
| [Remove Passed Goals](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/remove_passed_goals_action.cpp) | Steve Macenski | Removes goal poses passed or within a tolerance for culling old viapoints from path re-planning |
| [Remove In Collision Goals](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/remove_in_collision_goals_action.cpp) | Tony Najjar | Removes goal poses that have a footprint or point cost above a threshold. |
| [Compute Path Through Poses](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/compute_path_through_poses_action.cpp) | Steve Macenski | Computes a path through a set of poses rather than a single end goal pose using the planner plugin specified |
| [Compute Route](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/compute_route_action.cpp) | Steve Macenski | Computes a Route through a navigation graph and returns both a dense path and set of sparse route nodes and edges. |
| [Compute And Track Route](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/compute_and_track_route_action.cpp) | Steve Macenski | Computes a Route as above, but also actively tracks progress and triggers route contextual semantic operations. |
| [Cancel Control Action](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/controller_cancel_node.cpp) | Pradheep Padmanabhan | Cancels Nav2 controller server |
| [Cancel BackUp Action](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/back_up_cancel_node.cpp) | Pradheep Padmanabhan | Cancels backup behavior action |
| [Cancel Spin Action](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/spin_cancel_node.cpp) | Pradheep Padmanabhan | Cancels spin behavior action |
| [Cancel Wait Action](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/wait_cancel_node.cpp) | Pradheep Padmanabhan | Cancels wait behavior action |
| [Cancel Route Action](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/compute_and_track_route_cancel_node.cpp) | Steve Macenski | Cancels ComputeAndTrackRoute action |
| [Cancel Drive on Heading Action](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/drive_on_heading_cancel_node.cpp) | Joshua Wallace | Cancels drive on heading behavior action |
| [Cancel Assisted Teleop Action](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/action/assisted_teleop_cancel_node.cpp) | Joshua Wallace | Cancels assisted teleop behavior action |
| [Cancel Complete Coverage Action](https://github.com/open-navigation/opennav_coverage/blob/main/opennav_coverage_bt/src/cancel_complete_coverage_path.cpp) | Steve Macenski | Cancels compute complete coverage |
| [Compute Complete Coverage Path Action](https://github.com/open-navigation/opennav_coverage/blob/main/opennav_coverage_bt/src/compute_complete_coverage_path.cpp) | Steve Macenski | Calls coverage planner server |
| [Get Pose From Path Action](https://github.com/ros-navigation/navigation2/blob/main/nav2_behavior_tree/plugins/action/get_pose_from_path_action.cpp) | Marc Morcos | Extracts a pose from a path |
| [Dock Robot Action](https://github.com/ros-navigation/navigation2/blob/main/nav2_docking/opennav_docking_bt/src/dock_robot.cpp) | Steve Macenski | Calls dock robot action |
| [Undock Robot Action](https://github.com/ros-navigation/navigation2/blob/main/nav2_docking/opennav_docking_bt/src/undock_robot.cpp) | Steve Macenski | Calls undock robot action |
| [Concatenate Paths Action](https://github.com/ros-navigation/navigation2/blob/main/nav2_behavior_tree/plugins/action/concatenate_paths_action.cpp) | Steve Macenski | Concatenates 2 paths together |
| [Get Current Pose Action](https://github.com/ros-navigation/navigation2/blob/main/nav2_behavior_tree/plugins/action/get_current_pose_action.cpp) | Steve Macenski | Gets current pose to the blackboard |
| [Append Goal Pose To Goals Action](https://github.com/ros-navigation/navigation2/blob/main/nav2_behavior_tree/plugins/action/append_goal_pose_to_goals_action.cpp) | Steve Macenski | Appends a goal pose to a goals vector |
| [Extract Route Nodes To Goals Action](https://github.com/ros-navigation/navigation2/blob/main/nav2_behavior_tree/plugins/action/extract_route_nodes_as_goals_action.cpp) | Steve Macenski | Converts Route Nodes to Goals |
| [Get Next Few Goals Action](https://github.com/ros-navigation/navigation2/blob/main/nav2_behavior_tree/plugins/action/get_next_few_goals_action.cpp) | Steve Macenski | Obtains the next N goals in a goal vector |
| [Toggle Collision Monitor Service](https://github.com/ros-navigation/navigation2/blob/main/nav2_behavior_tree/plugins/action/toggle_collision_monitor_service.cpp) | David Grbac | Calls toggle collision monitor service |
| [Follow Object](https://github.com/ros-navigation/navigation2/blob/main/nav2_behavior_tree/plugins/action/follow_object_action.cpp) | Alberto Tudela | Dynamically follows an object |
| [Cancel Follow Object](https://github.com/ros-navigation/navigation2/blob/main/nav2_behavior_tree/plugins/action/follow_object_cancel_node.cpp) | Alberto Tudela | Cancels follow object action |

| Condition Plugin Name | Creator | Description |
| --- | --- | --- |
| [Goal Reached Condition](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/condition/goal_reached_condition.cpp) | Carl Delsey | Checks if goal is reached within tol. |
| [Goal Updated Condition](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/condition/goal_updated_condition.cpp) | Aitor Miguel Blanco | Checks if goal is preempted. |
| [Global Updated Goal Condition](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/condition/globally_updated_goal_condition.cpp) | Joshua Wallace | Checks if goal is preempted in the global BT context |
| [Initial Pose received Condition](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/condition/initial_pose_received_condition.cpp) | Carl Delsey | Checks if initial pose has been set |
| [Is Stuck Condition](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/condition/is_stuck_condition.cpp) | Michael Jeronimo | Checks if robot is making progress or stuck |
| [Is Stopped Condition](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/condition/is_stopped_condition.cpp) | Tony Najjar | Checks if robot is stopped for a duration |
| [Transform Available Condition](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/condition/transform_available_condition.cpp) | Steve Macenski | Checks if a TF transformation is available. When succeeds returns success for subsequent calls. |
| [Distance Traveled Condition](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/condition/distance_traveled_condition.cpp) | Sarthak Mittal | Checks is robot has traveled a given distance. |
| [Time Expired Condition](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/condition/time_expired_condition.cpp) | Sarthak Mittal | Checks if a given time period has passed. |
| [Is Battery Low Condition](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/condition/is_battery_low_condition.cpp) | Sarthak Mittal | Checks if battery percentage is below a specified value. |
| [Is Path Valid Condition](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/condition/is_path_valid_condition.cpp) | Joshua Wallace | Checks if a path is valid by making sure there are no LETHAL obstacles along the path. |
| [Path Expiring Timer](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/condition/path_expiring_timer_condition.cpp) | Joshua Wallace | Checks if the timer has expired. The timer is reset if the path gets updated. |
| [Are Error Codes Present](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/condition/are_error_codes_present_condition.cpp) | Joshua Wallace | Checks if the specified error codes are present. |
| [Would A Controller Recovery Help](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/condition/would_a_controller_recovery_help_condition.cpp) | Joshua Wallace | Checks if a controller recovery could help clear the controller server error code. |
| [Would A Planner Recovery Help](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/condition/would_a_planner_recovery_help_condition.cpp) | Joshua Wallace | Checks if a planner recovery could help clear the planner server error code. |
| [Would A Smoother Recovery Help](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/condition/would_a_smoother_recovery_help_condition.cpp) | Joshua Wallace | Checks if a Smoother recovery could help clear the smoother server error code. |
| [Would A Route Recovery Help](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/condition/would_a_route_recovery_help_condition.cpp) | Steve Macenski | Checks if a Route recovery could help clear the route server error code. |
| [Is Battery Charging Condition](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/condition/is_battery_charging_condition.cpp) | Alberto Tudela | Checks if the battery is charging. |
| [Are Poses Near Condition](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/condition/are_poses_near_condition.cpp) | Steve Macenski | Checks if 2 poses are nearby to each other. |
| [Is Pose Occupied Condition](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/condition/is_pose_occupied_condition.cpp) | Maurice Alexander Purnawan | Checks if a pose is occupied. |
| [Is Goal Nearby Condition](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/condition/is_goal_nearby_condition.cpp) | Jakub Chudziński | Checks if the robot is near the goal based on remaining path length. |

| Decorator Plugin Name | Creator | Description |
| --- | --- | --- |
| [Rate Controller](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/decorator/rate_controller.cpp) | Michael Jeronimo | Throttles child node to a given rate |
| [Distance Controller](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/decorator/distance_controller.cpp) | Sarthak Mittal | Ticks child node based on the distance traveled by the robot |
| [Speed Controller](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/decorator/speed_controller.cpp) | Sarthak Mittal | Throttles child node to a rate based on current robot speed. |
| [Goal Updater](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/decorator/goal_updater_node.cpp) | Francisco Martín | Updates the goal received via topic subscription. |
| [Single Trigger](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/decorator/single_trigger_node.cpp) | Steve Macenski | Triggers nodes/subtrees below only a single time per BT run. |
| [PathLongerOnApproach](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/decorator/path_longer_on_approach.cpp) | Pradheep Padmanabhan | Triggers child nodes if the new global path is significantly larger than the old global path on approach to the goal |
| [GoalUpdatedController](https://github.com/ros-navigation/navigation2/blob/main/nav2_behavior_tree/plugins/decorator/goal_updated_controller.cpp) | Sophia Koffler | Ticks child node if the goal has been updated |

| Control Plugin Name | Creator | Description |
| --- | --- | --- |
| [Pipeline Sequence](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/control/pipeline_sequence.cpp) | Carl Delsey | A variant of a sequence node that will re-tick previous children even if another child is running |
| [Recovery](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/control/recovery_node.cpp) | Carl Delsey | Node must contain 2 children and returns success if first succeeds. If first fails, the second will be ticked. If successful, it will retry the first and then return its value |
| [Round Robin](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/control/round_robin_node.cpp) | Mohammad Haghighipanah | Will tick `i` th child until a result and move on to `i+1` |
| [Nonblocking Sequence](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/control/nonblocking_sequence.cpp) | Alexander Yuen | A variant of a sequence node that will tick through the whole sequence even if a child returns running. On reticks of this control node, successful children will be ticked once again to prevent a stale state from being latched. |
| [Persistent Sequence](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/control/persistent_sequence.cpp) | Enjoy Robotics | A variant of a sequence node that exposes `current_child_idx` as a bidirectional port. |
| [Pause Resume Controller](https://github.com/ros-navigation/navigation2/tree/main/nav2_behavior_tree/plugins/control/pause_resume_controller.cpp) | Enjoy Robotics | Controlled through service calls to pause and resume the execution of the tree. |

##### Route Plugins

###### Edge Scorers

| Plugin Name | Creator | Description |
| --- | --- | --- |
| DistanceScorer | Steve Macenski | Scores an edge’s length, optionally scaled by relative speed limits. |
| TimeScorer | Steve Macenski | Scores and edge traversal time using absolute speed limits or previous traversal times. |
| PenaltyScorer | Steve Macenski | Scores using a static semantic penalty. |
| SemanticScorer | Steve Macenski | Scores using stored semantic data regarding the edge and/or nodes. |
| StartPoseOrientationScorer | Alex Yuen | Scores based on the initial pose and start edge orientations. |
| GoalPoseOrientationScorer | Alex Yuen | Scores based on the goal pose and goal edge orientations. |
| DynamicEdgesScorer | Steve Macenski | Scores based on a dynamically set service cost and/or closure. |

###### Route Operations

| Plugin Name | Creator | Description |
| --- | --- | --- |
| AdjustSpeedLimit | Steve Macenski | Adjusts robot speed limits using an edge’s semantic data. |
| CollisionMoniter | Steve Macenski | Checks for collision in the immediate future which tracking a route. |
| TimeMarker | Steve Macenski | Records the traversal time for an edge in the edge’s metadata. |
| ReroutingService | Steve Macenski | Triggers a rereoute from an external server. |
| TriggerEvent | Steve Macenski | Triggers an event based on a configurable server name. |

###### Graph File Parsers

Currently, only `geojson` parsing is supported.

#### Parameters

**`SmacPlannerHybrid`**
- Type: `unknown`
- (formerlySmacPlanner)

**`NavigateToPoseNavigator`**
- Type: `unknown`
- Point-to-point navigation via a
behavior tree action server

**`NavigateThroughPosesNavigator`**
- Type: `unknown`
- Point-through-points navigation
via a behavior tree action server

**`CoverageNavigator`**
- Type: `unknown`
- Complete coverage navigation
(Cartesian or GPS) via a BTs

**`Voxel Layer`**
- Type: `unknown`
- Maintains persistent
3D voxel layer using depth and
laser sensor readings and
raycasting to clear free space

**`Range Layer`**
- Type: `unknown`
- Uses a probabilistic model to
put data from sensors that
publish range msgs on the costmap

**`Static Layer`**
- Type: `unknown`
- Gets staticmapand loads
occupancy information into
costmap

**`Inflation Layer`**
- Type: `unknown`
- Inflates lethal obstacles in
costmap with exponential decay

**`Obstacle Layer`**
- Type: `unknown`
- Maintains persistent 2D costmap
from 2D laser scans with
raycasting to clear free space

**`Spatio-Temporal Voxel Layer`**
- Type: `unknown`
- Maintains temporal 3D sparse
volumetric voxel grid with decay
through sensor models

**`Non-Persistent Voxel Layer`**
- Type: `unknown`
- Maintains 3D occupancy grid
consisting only of the most
sets of measurements

**`Denoise Layer`**
- Type: `unknown`
- Filters noise-induced
standalone obstacles or small
obstacles groups

**`Plugin Container Layer`**
- Type: `unknown`
- Combines the different costmap
layers specified under this
layer in order populate the same
costmap with different isolated
combinations of costmap layers

**`Keepout Filter`**
- Type: `unknown`
- Maintains keep-out/safety zones
and preferred lanes for moving

**`Speed Filter`**
- Type: `unknown`
- Limits maximum velocity of robot
in speed restriction areas

**`Binary Filter`**
- Type: `unknown`
- Enables binary (boolean) mask
behavior to trigger actions.

**`DWB Controller`**
- Type: `unknown`
- A highly configurable  DWA
implementation with plugin
interfaces

**`TEB Controller`**
- Type: `unknown`
- A MPC-like controller suitable
for ackermann, differential, and
holonomic robots.

**`Regulated Pure Pursuit`**
- Type: `unknown`
- A service / industrial robot
variation on the pure pursuit
algorithm with adaptive features.

**`MPPI Controller`**
- Type: `unknown`
- A predictive MPC controller with
modular & custom cost functions
that can accomplish many tasks.

**`Rotation Shim Controller`**
- Type: `unknown`
- A “shim” controller to rotate
to path heading before passing
to main controller for  tracking.

**`Graceful Controller`**
- Type: `unknown`
- A controller based on a
pose-following control law to
generate smooth trajectories.

**`Vector Pursuit Controller`**
- Type: `unknown`
- A controller based on the vector
pursuit algorithm useful for
high speed accurate path tracking.

**`NavFn Planner`**
- Type: `unknown`
- A navigation function
using A* or Dijkstras
expansion, assumes 2D
holonomic particle

**`SmacPlannerHybrid(formerlySmacPlanner)`**
- Type: `unknown`
- A SE2 Hybrid-A*
implementation using either
Dubin or Reeds-shepp motion
models with smoother and
multi-resolution query.
Cars, car-like, and
ackermann vehicles.
Kinematically feasible.

**`SmacPlanner2D`**
- Type: `unknown`
- A 2D A* implementation
Using either 4 or 8
connected neighborhoods
with smoother and
multi-resolution query

**`SmacPlannerLattice`**
- Type: `unknown`
- An implementation of State
Lattice Planner using
pre-generated minimum control
sets for kinematically
feasible planning with any
type of vehicle imaginable.
Includes generator script for
Ackermann, diff, omni, and
legged robots.

**`ThetaStarPlanner`**
- Type: `unknown`
- An implementation of Theta*
using either 4 or 8
connected neighborhoods,
assumes the robot as a
2D holonomic particle

**`Simple Smoother`**
- Type: `unknown`
- A simple path smoother for
infeasible (e.g. 2D)
planners

**`Constrained Smoother`**
- Type: `unknown`
- A path smoother using a
constraints problem solver
to optimize various criteria
such as smoothness or
distance from obstacles,
maintaining minimum turning
radius

**`Savitzky-Golay Smoother`**
- Type: `unknown`
- A path smoother using a
Savitzky-Golay filter
to smooth the path via
digital signal processing
to remove noise from the
path.

**`Clear Costmap`**
- Type: `unknown`
- A service to clear the given
costmap in case of incorrect
perception or robot is stuck

**`Spin`**
- Type: `unknown`
- Rotate behavior of configurable
angles to clear out free space
and nudge robot out of potential
local failures

**`Back Up`**
- Type: `unknown`
- Back up behavior of configurable
distance to back out of a
situation where the robot is
stuck

**`Wait`**
- Type: `unknown`
- Wait behavior with configurable
time to wait in case of time
based obstacle like human traffic
or getting more sensor data

**`Drive On Heading`**
- Type: `unknown`
- Drive on heading behavior with
configurable distance to drive

**`Assisted Teleop`**
- Type: `unknown`
- AssistedTeleop behavior that
scales teleop commands to
prevent collisions.

**`WaitAtWaypoint`**
- Type: `unknown`
- A plugin to execute a wait
behavior  on
waypoint arrivals.

**`PhotoAtWaypoint`**
- Type: `unknown`
- A plugin to take and save photos
to specified directory on
waypoint arrivals.

**`InputAtWaypoint`**
- Type: `unknown`
- A plugin to wait for user input
before moving onto the next
waypoint.

**`SimpleGoalChecker`**
- Type: `unknown`
- A plugin check whether robot
is within translational distance
and rotational distance of goal.

**`StoppedGoalChecker`**
- Type: `unknown`
- A plugin check whether robot
is within translational distance
, rotational distance of goal,
and velocity threshold.

**`PositionGoalChecker`**
- Type: `unknown`
- A plugin check whether robot
is within translational distance
of goal, without requiring
rotational convergence.

**`SimpleProgressChecker`**
- Type: `unknown`
- A plugin to check whether the
robot was able to move a minimum
distance in a given time to
make progress towards a goal

**`PoseProgressChecker`**
- Type: `unknown`
- A plugin to check whether the
robot was able to move a minimum
distance or angle in a given time
to make progress towards a goal

**`FeasiblePathHandler`**
- Type: `unknown`
- A plugin that transforms global
plan to the local costmap frame,
prunes it to the relevant portion
within the costmap bounds, and
handles in-place rotation and
cusp pruning.

**`Back Up Action`**
- Type: `unknown`
- Calls backup behavior action

**`Drive On Heading Action`**
- Type: `unknown`
- Calls drive on heading behavior action

**`Assisted Teleop Action`**
- Type: `unknown`
- Calls assisted teleop behavior action

**`Clear Entire Costmap Service`**
- Type: `unknown`
- Calls clear entire costmap service

**`Clear Costmap Except Region Service`**
- Type: `unknown`
- Calls clear costmap except region service

**`Clear Costmap Around Robot Service`**
- Type: `unknown`
- Calls clear costmap around robot service

**`Compute Path to Pose Action`**
- Type: `unknown`
- Calls Nav2 planner server

**`Smooth Path Action`**
- Type: `unknown`
- Calls Nav2 smoother server

**`Follow Path Action`**
- Type: `unknown`
- Calls Nav2 controller server

**`Navigate to Pose Action`**
- Type: `unknown`
- BT Node for other
BehaviorTree.CPP BTs to call
Navigation2 as a subtree action

**`Reinitialize Global Localization Service`**
- Type: `unknown`
- Reinitialize AMCL to a new pose

**`Spin Action`**
- Type: `unknown`
- Calls spin behavior action

**`Wait Action`**
- Type: `unknown`
- Calls wait behavior action

**`Truncate Path`**
- Type: `unknown`
- Modifies a path making it shorter

**`Truncate Path Local`**
- Type: `unknown`
- Extracts a path section around robot

**`Planner Selector`**
- Type: `unknown`
- Selects the global planner based on a
topic input, otherwises uses a default
planner id

**`Controller Selector`**
- Type: `unknown`
- Selects the controller based on a
topic input, otherwises uses a default
controller id

**`Goal Checker Selector`**
- Type: `unknown`
- Selects the goal checker based on a
topic input, otherwises uses a default
goal checker id

**`Smoother Selector`**
- Type: `unknown`
- Selects the smoother based on a
topic input, otherwises uses a default
smoother id

**`Progress Checker Selector`**
- Type: `unknown`
- Selects the progress checker based on a
topic input, otherwises uses a default
progress checker id

**`Path Handler Selector`**
- Type: `unknown`
- Selects the path handler based on a
topic input, otherwises uses a default
path handler id

**`Navigate Through Poses`**
- Type: `unknown`
- BT Node for other BehaviorTree.CPP BTs
to call Nav2’s NavThroughPoses action

**`Remove Passed Goals`**
- Type: `unknown`
- Removes goal poses passed or within a
tolerance for culling old viapoints from
path re-planning

**`Remove In Collision Goals`**
- Type: `unknown`
- Removes goal poses that have a footprint
or point cost above a threshold.

**`Compute Path Through Poses`**
- Type: `unknown`
- Computes a path through a set of poses
rather than a single end goal pose
using the planner plugin specified

**`Compute Route`**
- Type: `unknown`
- Computes a Route through a navigation
graph and returns both a dense path and
set of sparse route nodes and edges.

**`Compute And Track Route`**
- Type: `unknown`
- Computes a Route as above, but also
actively tracks progress and triggers
route contextual semantic operations.

**`Cancel Control Action`**
- Type: `unknown`
- Cancels Nav2 controller server

**`Cancel BackUp Action`**
- Type: `unknown`
- Cancels backup behavior action

**`Cancel Spin Action`**
- Type: `unknown`
- Cancels spin behavior action

**`Cancel Wait Action`**
- Type: `unknown`
- Cancels wait behavior action

**`Cancel Route Action`**
- Type: `unknown`
- Cancels ComputeAndTrackRoute action

**`Cancel Drive on Heading Action`**
- Type: `unknown`
- Cancels drive on heading behavior action

**`Cancel Assisted Teleop Action`**
- Type: `unknown`
- Cancels assisted teleop behavior action

**`Cancel Complete Coverage Action`**
- Type: `unknown`
- Cancels compute complete coverage

**`Compute Complete Coverage Path Action`**
- Type: `unknown`
- Calls coverage planner server

**`Get Pose From Path Action`**
- Type: `unknown`
- Extracts a pose from a path

**`Dock Robot Action`**
- Type: `unknown`
- Calls dock robot action

**`Undock Robot Action`**
- Type: `unknown`
- Calls undock robot action

**`Concatenate Paths Action`**
- Type: `unknown`
- Concatenates 2 paths together

**`Get Current Pose Action`**
- Type: `unknown`
- Gets current pose to the blackboard

**`Append Goal Pose To Goals Action`**
- Type: `unknown`
- Appends a goal pose to a goals vector

**`Extract Route Nodes To Goals Action`**
- Type: `unknown`
- Converts Route Nodes to Goals

**`Get Next Few Goals Action`**
- Type: `unknown`
- Obtains the next N goals in a goal vector

**`Toggle Collision Monitor Service`**
- Type: `unknown`
- Calls toggle collision monitor service

**`Follow Object`**
- Type: `unknown`
- Dynamically follows an object

**`Cancel Follow Object`**
- Type: `unknown`
- Cancels follow object action

**`Goal Reached Condition`**
- Type: `unknown`
- Checks if goal is
reached within tol.

**`Goal Updated Condition`**
- Type: `unknown`
- Checks if goal is
preempted.

**`Global Updated Goal Condition`**
- Type: `unknown`
- Checks if goal is
preempted in the global
BT context

**`Initial Pose received Condition`**
- Type: `unknown`
- Checks if initial pose
has been set

**`Is Stuck Condition`**
- Type: `unknown`
- Checks if robot is
making progress or
stuck

**`Is Stopped Condition`**
- Type: `unknown`
- Checks if robot is
stopped for a duration

**`Transform Available Condition`**
- Type: `unknown`
- Checks if a TF
transformation is
available. When
succeeds returns
success for subsequent
calls.

**`Distance Traveled Condition`**
- Type: `unknown`
- Checks is robot has
traveled a given
distance.

**`Time Expired Condition`**
- Type: `unknown`
- Checks if a given
time period has
passed.

**`Is Battery Low Condition`**
- Type: `unknown`
- Checks if battery
percentage is below
a specified value.

**`Is Path Valid Condition`**
- Type: `unknown`
- Checks if a path is
valid by making sure
there are no LETHAL
obstacles along the
path.

**`Path Expiring Timer`**
- Type: `unknown`
- Checks if the timer has
expired. The timer is
reset if the path gets
updated.

**`Are Error Codes Present`**
- Type: `unknown`
- Checks if the specified
error codes are
present.

**`Would A Controller Recovery Help`**
- Type: `unknown`
- Checks if a controller
recovery could help
clear the controller
server error code.

**`Would A Planner Recovery Help`**
- Type: `unknown`
- Checks if a planner
recovery could help
clear the planner
server error code.

**`Would A Smoother Recovery Help`**
- Type: `unknown`
- Checks if a Smoother
recovery could help
clear the smoother
server error code.

**`Would A Route Recovery Help`**
- Type: `unknown`
- Checks if a Route
recovery could help
clear the route
server error code.

**`Is Battery Charging Condition`**
- Type: `unknown`
- Checks if the battery
is charging.

**`Are Poses Near Condition`**
- Type: `unknown`
- Checks if 2 poses are
nearby to each other.

**`Is Pose Occupied Condition`**
- Type: `unknown`
- Checks if a pose is
occupied.

**`Is Goal Nearby Condition`**
- Type: `unknown`
- Checks if the robot is
near the goal based on
remaining path length.

**`Rate Controller`**
- Type: `unknown`
- Throttles child node to a given
rate

**`Distance Controller`**
- Type: `unknown`
- Ticks child node based on the
distance traveled by the robot

**`Speed Controller`**
- Type: `unknown`
- Throttles child node to a rate
based on current robot speed.

**`Goal Updater`**
- Type: `unknown`
- Updates the goal received via
topic subscription.

**`Single Trigger`**
- Type: `unknown`
- Triggers nodes/subtrees below
only a single time per BT run.

**`PathLongerOnApproach`**
- Type: `unknown`
- Triggers child nodes if the new
global path is significantly
larger than the old global path
on approach to the goal

**`GoalUpdatedController`**
- Type: `unknown`
- Ticks child node if the goal
has been updated

**`Pipeline Sequence`**
- Type: `unknown`
- A variant of a sequence node that
will re-tick previous children
even if another child is running

**`Recovery`**
- Type: `unknown`
- Node must contain 2 children
and returns success if first
succeeds. If first fails, the
second will be ticked. If
successful, it will retry the
first and then return its value

**`Round Robin`**
- Type: `unknown`
- Will tickith child until
a result and move on toi+1

**`Nonblocking Sequence`**
- Type: `unknown`
- A variant of a sequence node that
will tick through the whole
sequence even if a child returns
running. On reticks of this
control node, successful children
will be ticked once again to
prevent a stale state from being
latched.

**`Persistent Sequence`**
- Type: `unknown`
- A variant of a sequence node that
exposescurrent_child_idxas
a bidirectional port.

**`Pause Resume Controller`**
- Type: `unknown`
- Controlled through service calls
to pause and resume the
execution of the tree.

**`DistanceScorer`**
- Type: `unknown`
- Scores an edge’s length,
optionally scaled by relative
speed limits.

**`TimeScorer`**
- Type: `unknown`
- Scores and edge traversal time
using absolute speed limits or
previous traversal times.

**`PenaltyScorer`**
- Type: `unknown`
- Scores using a static semantic
penalty.

**`SemanticScorer`**
- Type: `unknown`
- Scores using stored semantic data
regarding the edge and/or nodes.

**`StartPoseOrientationScorer`**
- Type: `unknown`
- Scores based on the initial pose
and start edge orientations.

**`GoalPoseOrientationScorer`**
- Type: `unknown`
- Scores based on the goal pose and
goal edge orientations.

**`DynamicEdgesScorer`**
- Type: `unknown`
- Scores based on a dynamically set
service cost and/or closure.

**`AdjustSpeedLimit`**
- Type: `unknown`
- Adjusts robot speed limits using
an edge’s semantic data.

**`CollisionMoniter`**
- Type: `unknown`
- Checks for collision in the
immediate future which tracking
a route.

**`TimeMarker`**
- Type: `unknown`
- Records the traversal time for an
edge in the edge’s metadata.

**`ReroutingService`**
- Type: `unknown`
- Triggers a rereoute from an
external server.

**`TriggerEvent`**
- Type: `unknown`
- Triggers an event based on a
configurable server name.


---

## Roadmap

### Roadmaps

*Source: [https://docs.nav2.org/roadmap/roadmap.html](https://docs.nav2.org/roadmap/roadmap.html)*

#### Roadmaps

This is the list of major issues and features the Nav2 maintainers are committing for completion for various ROS 2 releases.
This is *not* an exhaustive list of planned features or what changes may be found in the new distribution.
It represents only the items of direct commitment to give insight into commitments for REP-2005 repositories in the [ROS 2 Roadmap](https://docs.ros.org/en/rolling/Roadmap.html).
For a full list of important completed changes in the project, see the Migration Guides [Migration Guides](../migration/index.html#migration).

##### Lyrical Roadmap

|  |  |
| --- | --- |
| Controller Server and Plugin factor for centralized path handling and crosstrack error estimation and enforcement. | Large (In Progress) |
| Massive refactor of `rclcpp` types to `nav2` types for ROS API abstraction | Large (in progress) |
| Improve dynamic feasibility on approach to goal on all control and behavior plugins | Medium (DONE) |
| Introduce Vector Object Server to augment Costmap Filters with polygons rather than annotated masks | Medium (DONE) |
| [Continued Route Server](https://github.com/ros-navigation/navigation2/issues/5082) | Medium |
| Add Pause and Resume feature to Nav2 behavior tree tasks | Medium (DONE) |
| Use PointCloud Transport for all pointcloud subscriptions | Medium (DONE) |
| Update and refine behavior trees for more intelligent behavior | Medium |
| Fix for statics in Smac Planner to allow for multiple instances in a server not to conflict | Medium |
| Create initial prototype of a framework for environmental modeling, sensor processing, and external model integration | Large |

##### Kilted Roadmap

|  |  |
| --- | --- |
| Release of Route server | Large (DONE) |
| Allow non-orientation sp. for smac planner goals | Medium (DONE) |
| Allow docking server to operate forward and backwards | Medium (DONE) |

##### Jazzy Roadmap

|  |  |
| --- | --- |
| [Smac Planner Improvements](https://github.com/ros-navigation/navigation2/issues/3172) | Large (DONE) |
| Get CI Green Again | Small (DONE) |
| Various MPPI Improvements | Medium (DONE) |
| [Fuse Migration](https://github.com/ros-navigation/navigation2/issues/2598) | Medium (incomplete) |
| [Ignition Migration](https://github.com/ros-navigation/navigation2/issues/2997) | Medium (DONE) |
| [Route Graph Planner](https://github.com/ros-navigation/navigation2/issues/2229) | Large (in progress) |
| Provide Advanced Capabilities Tutorials (e.g. gps, vio) | Medium (DONE) |
| ROS Time Respect Across Stack | Medium (DONE) |
| TwistStamped Migration | Medium (DONE) |
| Velocity-Scheduled Collision Monitor Polygons | Medium (DONE) |
| Nav2 auto-docking capability | Medium (DONE) |

##### Iron Roadmap

| Plugin Name | Size |
| --- | --- |
| [Pluginize Navigators](https://github.com/ros-navigation/navigation2/issues/3335) | Medium (DONE) |
| [MPPI Controller](https://github.com/ros-navigation/navigation2/pull/3350) | Very Large (DONE) |
| [Route Graph Planner](https://github.com/ros-navigation/navigation2/issues/2229) | Large (incomplete) |
| 90% unit test coverage | Small (DONE) |
| [Velocity Smoother](https://github.com/ros-navigation/navigation2/pull/2964) | Medium (DONE) |
| ROS Time Respect Across Stack | Medium (incomplete) |

##### Humble Roadmap

| Plugin Name | Size |
| --- | --- |
| [Nav2 1 Node Per Server](https://github.com/ros-navigation/navigation2/issues/816) | Medium (DONE) |
| [Smac Lattice Planner](https://github.com/ros-navigation/navigation2/issues/1710) | Large (DONE) |
| [Safety Collision Nodes](https://github.com/ros-navigation/navigation2/issues/1899) | Medium (DONE) |
| [Fix Min Range Bug](https://github.com/ros-navigation/navigation2/pull/2460) | Small (DONE) |
| [Move Development from Master to Rolling](https://github.com/ros-navigation/navigation2/issues/2337) | Small (DONE) |
| Push Test Coverage to 88% | Medium (DONE) |
| [Complete First Time Guide](https://github.com/ros-navigation/navigation2/issues/1589) | Medium (DONE) |
| [Rotation Shim Controller](https://github.com/ros-navigation/navigation2/pull/2718) | Small (DONE) |
| [Dynamic Composition](https://github.com/ros-navigation/navigation2/issues/2147) | Medium (DONE) |

#### Parameters

**`Pluginize Navigators`**
- Type: `unknown`
- 

**`MPPI Controller`**
- Type: `unknown`
- 

**`Route Graph Planner`**
- Type: `unknown`
- 

**`90% unit test coverage`**
- Type: `unknown`
- 

**`Velocity Smoother`**
- Type: `unknown`
- 

**`ROS Time Respect Across Stack`**
- Type: `unknown`
- 

**`Nav2 1 Node Per Server`**
- Type: `unknown`
- 

**`Smac Lattice Planner`**
- Type: `unknown`
- 

**`Safety Collision Nodes`**
- Type: `unknown`
- 

**`Fix Min Range Bug`**
- Type: `unknown`
- 

**`Move Development
from Master to Rolling`**
- Type: `unknown`
- 

**`Push Test Coverage to 88%`**
- Type: `unknown`
- 

**`Complete First Time Guide`**
- Type: `unknown`
- 

**`Rotation Shim Controller`**
- Type: `unknown`
- 

**`Dynamic Composition`**
- Type: `unknown`
- 


---

## Setup Guides

### First-Time Robot Setup Guide

*Source: [https://docs.nav2.org/setup_guides/index.html](https://docs.nav2.org/setup_guides/index.html)*

#### First-Time Robot Setup Guide

This section is a collection of guides that aims to provide readers a good resource for setting up Nav2. The objectives for this section are as follows:

* Help new users with setting up Navigation2 with a new robot
* Help people with custom built robots to properly set up their robots to be used in ROS/Navigation2
* Act as a checklist, template or boilerplate reference for more experienced readers
* Provide examples which can be run on simulators/tools like Gazebo or RViz to guide readers on the Nav2 setup process even without a physical robot.
* Broad strokes, tips, and tricks for configuring certain packages and integrating different components of the robot platform (sensors, odometry, etc.)

To guide you through the first-time setup of your robot, we will be tackling the following topics:

* Introduce TF2 and setup your robot URDF & SDF
* Setup sensor sources for robot odometry
* Setup sensor sources for perception
* Configure round or arbitrary shaped footprints for your robot
* Select and set up planner and controller navigation plugins for your robot’s navigation tasks
* Lifecycle node management for easy bringup of other related sensors or nodes

There are tutorials below for the Gazebo Classic simulator and the Gazebo simulator. Gazebo Classic is used with ROS 2 Humble and previous ROS distributions, while Gazebo (Gazebo Harmonic or newer) is used with ROS 2 Jazzy or newer.

##### Table of Contents

###### Gazebo

* [Setting Up Transformations](transformation/setup_transforms.html)
* [Setting Up The URDF](urdf/setup_urdf.html)
* [Setting Up The SDF - Gazebo](sdf/setup_sdf.html)
* [Setting Up Odometry - Gazebo](odom/setup_odom_gz.html)
* [Smoothing Odometry using Robot Localization](odom/setup_robot_localization.html)
* [Setting Up Sensors - Gazebo](sensors/setup_sensors_gz.html)
* [Mapping and Localization](sensors/mapping_localization.html)
* [Setting Up the Robot’s Footprint](footprint/setup_footprint.html)
* [Setting Up Navigation Plugins](algorithm/select_algorithm.html)

###### Gazebo Classic

* [Setting Up Transformations](transformation/setup_transforms.html)
* [Setting Up The URDF](urdf/setup_urdf.html)
* [Setting Up Odometry - Gazebo Classic](odom/setup_odom_gz_classic.html)
* [Smoothing Odometry using Robot Localization](odom/setup_robot_localization.html)
* [Setting Up Sensors - Gazebo Classic](sensors/setup_sensors_gz_classic.html)
* [Mapping and Localization](sensors/mapping_localization.html)
* [Setting Up the Robot’s Footprint](footprint/setup_footprint.html)
* [Setting Up Navigation Plugins](algorithm/select_algorithm.html)

Note

These tutorials are not meant to be full tuning and configuration guides since they only aim to help you get your robot up and running with a basic configuration. For more detailed discussions and guides on how to customize and tune Nav2 for your robot, head on to the [Configuration Guide](../configuration/index.html#configuration) section.

---

### Algorithm

#### Setting Up Navigation Plugins

*Source: [https://docs.nav2.org/setup_guides/algorithm/select_algorithm.html](https://docs.nav2.org/setup_guides/algorithm/select_algorithm.html)*

##### Setting Up Navigation Plugins

In this part of the guide, we discuss how your robot can utilize different planner and controller algorithms to complete navigation tasks. We will discuss some of the available algorithm plugins you can use based on your robot type and environment.

###### Planner and Controller Servers

Navigation algorithms are implemented in Nav2 through the use of plugins running on ROS action servers - the planner, controller and behavior servers (among others). For this section, we discuss the planner and controller servers, which are the heart of the navigation stack. These servers may implement one or more algorithm plugins each with its own configuration tailored for a specific action or robot state. This guide will highlight the different algorithms based on the type of robot and environment the robot is deployed in. This guide will not cover behaviors, smoothers, etc as those are dependent on application and not hardware/environment to offer generalized advice.

The planner server is responsible for implementing algorithms that compute the robot’s path. For example, one plugin can be configured to compute a simple shortest path between two relatively near locations while another plugin computes for a path to locations that cover the entire robot environment.

The controller server generates the appropriate control efforts needed for a robot to complete a task in its local environment. These tasks include but are not limited to: following a path generated by the planner server, avoiding dynamic obstacles along this path, and even charging at a docking station.

As mentioned before, the planner and controller servers host a map of one or multiple plugins wherein a certain plugin will be used for a certain environment, scenario, or task. For instance, the controller server can have a plugin for following a path when in long corridors to stay in the middle of the aisle, and then another plugin for avoiding dynamic obstacles in a crowded place. Selecting which planning algorithm to execute based on the robot’s task can be done through the behavior tree of your navigation system or application server.

See also

For a more in-depth discussion on Navigation Servers, we suggest to have a look at the [Navigation Servers](https://docs.nav2.org/concepts/index.html#navigation-servers) section under the Navigation Concepts category.

###### Selecting the Algorithm Plugins

In this section, we discuss some of the available algorithm plugins for the planner and controller servers. We also discuss the purpose of each algorithm, and for which type of robot they are recommended to be used. Lastly, we show some sample yaml configuration that specifies the plugin to be used for each server.

Note

The algorithm plugins you can use are not limited to the ones mentioned in this section. You may create custom plugins as well and new plugins are added to Nav2 regularly. For tutorials on how to write your own plugins, please see [Writing a New Planner Plugin](https://docs.nav2.org/plugin_tutorials/docs/writing_new_nav2planner_plugin.html) and [Writing a New Controller Plugin](https://docs.nav2.org/plugin_tutorials/docs/writing_new_nav2controller_plugin.html). The list of all available Nav2 plugins and their descriptions can be found in [Navigation Plugins Section](https://docs.nav2.org/plugins/index.html).

###### Planner Server

The algorithm plugins for the planner server find the robot’s path using a representation of its environment captured by its different sensors. Some of these algorithms operate by searching through the environment’s grid space while others expand the robot’s possible states while accounting for path feasibility.

As mentioned, the planner server may utilize plugins that work on the grid space such as the `NavFn Planner`, `Smac Planner 2D`, and `Theta Star Planner`. The [NavFn planner](https://docs.nav2.org/configuration/packages/configuring-navfn.html) is a navigation function planner that uses either Dijkstra or A\*. Next, the [Smac 2D planner](https://docs.nav2.org/configuration/packages/configuring-smac-planner.html) implements a 2D A\* algorithm using 4 or 8 connected neighborhoods with a smoother and multi-resolution query. Lastly, the [Theta Star planner](https://docs.nav2.org/configuration/packages/configuring-thetastar.html#) is an implementation of Theta\* using either line of sight to create non-discretely oriented path segments.

One issue you may encounter when using algorithms that work on the grid space is that there is no guarantee that a drivable path can be generated for any type of robot. For example, it is not guaranteed that the `NavFn Planner` can plan a feasible path for a non-circular robot in a tight space since it uses the circular footprint of a robot (by approximating the robot’s largest cross-sectional radius) and checks for collisions per costmap grid cell. In addition, these algorithms are also not suitable for ackermann and legged robots since they have turning constraints. That being said, these plugins are best used on robots that can drive in any direction or rotate safely in place, such as **circular differential and circular omnidirectional** robots.

Another planner plugin is the [Smac Hybrid-A\* planner](https://docs.nav2.org/configuration/packages/configuring-smac-planner.html) that supports **arbitrary shaped ackermann and legged** robots. It is a highly optimized and fully reconfigurable Hybrid-A\* implementation supporting Dubin and Reeds-Shepp motion models. This algorithm expands the robot’s candidate paths while considering the robot’s minimum turning radius constraint and the robot’s full footprint for collision avoidance. Thus, this plugin is suitable for arbitrary shaped robots that require full footprint collision checking. It may also be used for high-speed robots that must be navigated carefully to not flip over, skid, or dump load at high speeds.

There is also the `Smac Lattice planner` plugin which is based on a State Lattice planner. This plugin functions by expanding the robot state space while ensuring the path complies with the robot’s kinematic constraints. The algorithm provides minimum control sets which allows it to support **differential, omnidirectional, and ackermann** vehicles of any shape and size with minimal reconfiguration.

###### Summary

| Plugin Name | Supported Robot Types |
| --- | --- |
| NavFn Planner | Circular Differential, Circular Omnidirectional |
| Smac Planner 2D |
| Theta Star Planner |
| Smac Hybrid-A\* Planner | Non-circular or Circular Ackermann, Non-circular or Circular Legged |
| Smac Lattice Planner | Non-circular Differential, Non-circular Omnidirectional |

###### Example Configuration

```
planner_server:
  ros__parameters:
    planner_plugins: ['GridBased']
    GridBased:
      plugin: 'nav2_navfn_planner::NavfnPlanner' # In Iron and older versions, "/" was used instead of "::"
```

An example configuration of the planner server is shown above. The `planner_plugins` parameter accepts a list of mapped planner plugin names. For each plugin namespace defined in `planner_plugins` (`GridBased` in our example), we specify the type of plugin to be loaded in the `plugin` parameter. Additional configurations must then be specified in this namespace based on the algorithm to be used. Please see the [Configuration Guide](https://docs.nav2.org/configuration/index.html) for more details.

###### Controller Server

The default controller plugin is the [DWB controller](https://docs.nav2.org/configuration/packages/configuring-dwb-controller.html). It implements a modified Dynamic Window Approach (DWA) algorithm with configurable plugins to compute the control commands for the robot. This controller makes use of a `Trajectory Generator plugin` that generates the set of possible trajectories. These are then evaluated by one or more `Critic plugins`, each of which may give a different score based on how they are configured. The sum of the scores from these `Critic plugins` determine the overall score of a trajectory. The best scoring trajectory then determines the output command velocity.

The `DWB controller` can be used on **circular or non-circular differential, and circular or non-circular omnidirectional** robots. It may also be configured for **ackerman and legged** robots if it is given a `Trajectory Generation plugin` that produces a set of possible trajectories that considers the robot’s minimum curvature constraint.

Next example of a controller server plugin is the [TEB controller](https://github.com/rst-tu-dortmund/teb_local_planner) which is an MPC time optimal controller. It implements the Timed Elastic Band (TEB) approach which optimizes the robot’s trajectory based on its execution time, distance from obstacles, and feasibility with respect to the robot’s kinematic constraints. This controller can be used on **differential, omnidirectional, ackermann, and legged** robots.

Another example for this section is the [Regulated Pure Pursuit controller (RPP)](https://docs.nav2.org/configuration/packages/configuring-regulated-pp.html) . This controller implements a variant of the pure pursuit algorithm with added regulation heuristic functions to manage collision and velocity constraints. This variation is implemented to target the needs of service or industrial robots and is suitable for use with **differential, ackermann, and legged** robots.

The last example is the [Vector Pursuit Controller](https://github.com/blackcoffeerobotics/vector_pursuit_controller) . It implements the [Vector Pursuit algorithm](https://apps.dtic.mil/sti/pdfs/ADA468928.pdf) and calculates the command velocity using screw theory. This controller is suitable for high speed path tracking and sharp turns or when computation resources are limited. It can be used for **differential, ackermann, and legged** robots.

###### Summary

| Plugin Name | Supported Robot Types | Task |
| --- | --- | --- |
| DWB controller | Differential, Omnidirectional | Dynamic obstacle avoidance |
| TEB Controller | Differential, Omnidirectional, Ackermann, Legged |
| RPP controller | Differential, Ackermann, Legged | Exact path following |
| MPPI controller | Differential, Ackermann, Legged, Omnidirectional | Modern MPC controller |
| VP controller | Differential, Ackermann, Legged | High speed path tracking |

All of these algorithms work for both circular and non-circular robots.

###### Example Configuration

```
controller_server:
  ros__parameters:
    controller_plugins: ["FollowPath"]
    FollowPath:
       plugin: "dwb_core::DWBLocalPlanner"
```

Shown above is a sample basic configuration of the controller server. The list of mapped names for controller plugins are defined in the `controller_plugins` parameter. Similar to the planner server, each namespace defined in the `controller_plugins` (`FollowPath` in our example) must define the type of plugin it will use in the `plugin` parameter. Additional configurations must also be made for the selected algorithm in the namespace. Please see the [Configuration Guide](https://docs.nav2.org/configuration/index.html) for more details.

Note

The planner and controller servers, along with the other servers of Nav2, are launched in ROS 2 through lifecycle nodes. Lifecycle nodes allow for easier bringup and teardown of the servers. Lifecycle node management will be discussed in the next tutorial.

###### Conclusion

In this tutorial, we have discussed the roles and configuration of Nav2’s planner and controller servers. To summarize, these servers host a map of one or more algorithm plugins which are selected depending on your robot’s structure and surroundings. We also described a few of the available plugins for the planner and controller servers to help you identify which plugins are suitable for your robot. Lastly, we also provided some simple configuration examples to show how these plugins are instantiated on the servers. You can refer to the configuration guide of the algorithm plugin you will select for more details on its configuration parameters.

#### Parameters

**`NavFn Planner`**
- Type: `Circular Differential, Circular Omnidirectional`
- 

**`Smac Planner 2D`**
- Type: `unknown`
- 

**`Theta Star Planner`**
- Type: `unknown`
- 

**`Smac Hybrid-A* Planner`**
- Type: `Non-circular or Circular Ackermann, Non-circular or Circular Legged`
- 

**`Smac Lattice Planner`**
- Type: `Non-circular Differential, Non-circular Omnidirectional`
- 

**`DWB controller`**
- Type: `Differential, Omnidirectional`
- 

**`TEB Controller`**
- Type: `Differential, Omnidirectional, Ackermann, Legged`
- 

**`RPP controller`**
- Type: `Differential, Ackermann, Legged`
- 

**`MPPI controller`**
- Type: `Differential, Ackermann, Legged, Omnidirectional`
- 

**`VP controller`**
- Type: `Differential, Ackermann, Legged`
- 


---

### Footprint

#### Setting Up the Robot’s Footprint

*Source: [https://docs.nav2.org/setup_guides/footprint/setup_footprint.html](https://docs.nav2.org/setup_guides/footprint/setup_footprint.html)*

##### Setting Up the Robot’s Footprint

In this guide, we will discuss how to configure the footprint of your robot for the navigation algorithms used by Nav2. We will also show a sample footprint configuration on `sam_bot`, the simulated robot that we have been building in this series of setup guides. Lastly, we will also show the visualization of `sam_bot`’s footprint in RViz to ensure that we have set it up correctly.

###### Footprint Introduction

The footprint outlines the robot’s 2D shape when projected to the ground and is primarily used by Nav2 to avoid collisions during planning. The algorithms involved in this task makes sure that the robot does not collide with the obstacles in the costmap while it computes the robot’s paths or plans.

The footprint is set up using the `footprint` or `robot_radius` parameter of the global and local costmaps which we tackled in the previous tutorials ([Setting Up Sensors Guide](../sensors/setup_sensors_gz.html#setup-sensors-gz)). The value defined in the `footprint` parameter is an ordered vector of 2-D points defining the robot’s footprint with the `base_link` frame as the origin. The first and last points in the vector are joined into the last line segment to close the footprint’s shape. As an alternative, you may also use the `robot_radius` parameter wherein circular footprint is automatically generated and centered at `base_link`. In cases both the `footprint` and `robot_radius` parameters have been defined in the configuration, the `footprint` is used.

See also

A section in the previous guide, [Configuring nav2\_costmap\_2d](../sensors/mapping_localization.html#configuring-nav2-costmap-2d), explains how to configure basic costmap parameters. Please refer to that guide for more details on costmap configuration.

For the global costmap footprint, the decision to choose between the `robot_radius` (circular) or `footprint` (polygon) parameter depends on the robot, its environment, and the path planning algorithm you will use. Even if you are working with a non-circular robot, there may be situations where a circular footprint is acceptable. For example, path planning algorithms like [NavFn](https://docs.nav2.org/configuration/packages/configuring-navfn.html) assume that the robot is circular since it only checks for collision per grid cell, so it will not be necessary to outline the robot’s exact shape for its footprint. On the other hand, algorithms such as [Smac Planner’s Hybrid-A\*](https://docs.nav2.org/configuration/packages/configuring-smac-planner.html) perform collision checking on the robot’s polygon-shaped footprint if possible and necessary. Hence, it might be useful to use a polygon-shaped footprint. Another example is having a small RC car sized robot roaming a warehouse. This robot is so small it won’t need to make confined maneuvers – thusly approximating it with the largest cross-sectional radius is a good time-saving optimization.

For the local costmap footprint, it is typical for non-circular robots to be set up with `footprint` (polygon). Some situations where this is not recommended is when you do not have enough computing resources to implement collision avoidance algorithms on a polygon-shaped footprint. Another possible reason to use `robot_radius` (circular) for the local costmap is when the robot is very small relative to its environment such that precise collision avoidance is not necessary. However, generally the local trajectory planner should use the actual footprint polygon of the robot.

Note that this can also be adjusted over time using the costmap’s `~/footprint` topic, which will update the polygon over time as needed due to changes in the robot’s state, such as movement of an attached manipulator, picking up a pallet, or other actions that adjust a robot’s shape. That polygon will then automatically be used by the planners and controllers.

###### Configuring the Robot’s Footprint

In this section, we will configure the footprint of `sam_bot` such that `footprint` (polygon) is used for the local costmap and `robot_radius` (circular) is used for the global costmap. We will utilize the default configuration file of Nav2 with a modified footprint parameter for the global and local costmaps.

Note

The complete source code for `sam_bot` can be found in [navigation2\_tutorials](https://github.com/ros-navigation/navigation2_tutorials/tree/master/sam_bot_description) repository.

Under the `config` directory, create a new file named `nav2_params.yaml`. Next, copy the contents of [config/nav2\_params.yaml](https://github.com/ros-navigation/navigation2_tutorials/blob/master/sam_bot_description/config/nav2_params.yaml) and paste them into the newly created file. The contents of [config/nav2\_params.yaml](https://github.com/ros-navigation/navigation2_tutorials/blob/master/sam_bot_description/config/nav2_params.yaml) are copied from the default configuration file of Nav2 but with changes in the `footprint` and `robot_radius` parameters to match the shape of `sam_bot`.

See also

The default configuration file for Nav2 can be found in the official [Navigation2 repository](https://github.com/ros-navigation/navigation2/blob/galactic/nav2_bringup/bringup/params/nav2_params.yaml).

Below is the code snippet from `nav2_params.yaml` defining the local costmap footprint. In this configuration file, the `footprint` parameter of the local costmap has already been set with a rectangular-shaped footprint. This box is centered at the `base_link` frame of `sam_bot`.

```
188resolution: 0.05
189footprint: "[ [0.21, 0.195], [0.21, -0.195], [-0.21, -0.195], [-0.21, 0.195] ]"
190plugins: ["voxel_layer", "inflation_layer"]
```

For the global costmap, we have already set the `robot_radius` parameter to create a circular footprint that matches `sam_bot`’s size and centered at `base_link`. The parameter that was modified is shown in the code snippet below.

```
232robot_radius: 0.3
233resolution: 0.05
```

###### Build, Run and Verification

We will now confirm that we have properly set up `sam_bot`’s footprint.

First, we launch [launch/display.launch.py](https://github.com/ros-navigation/navigation2_tutorials/blob/master/sam_bot_description/launch/display.launch.py) to launch the robot state publisher, spawn `sam_bot` in Gazebo, and visualize `sam_bot` and its footprint in Rviz. The robot state publisher publishes the `base_link` => `sensors` transforms defined in `sam_bot`’s URDF, while Gazebo’s differential drive plugin publishes the `odom` => `base_link` transform. Open a new terminal and execute the lines below.

```
colcon build
. install/setup.bash
ros2 launch sam_bot_description display.launch.py
```

After launching `display.launch.py`, RViz and Gazebo should open. RViz should show `sam_bot`, the frames of `sam_bot`’s parts, and the `odom` frame without errors. Gazebo should show `sam_bot` with a sphere and a cube detectable by `sambot`’s lidar sensor.

Next, we will publish the `map` => `odom` transform using the `static_transform_publisher`. We publish the `map` => `odom` transform as static in this guide as a simple way to publish the transform and visualize the footprint. Open a new terminal and execute the lines below.

```
ros2 run tf2_ros static_transform_publisher 0 0 0 0 0 0 map odom
```

The `map` => `odom` transform should now be being published and the `map` frame should be added in RViz without errors.

Lastly, we will launch Nav2 using the `nav2_params.yaml` configuration file we just made and `navigation_launch.py`, the built-in launch file of `nav2_bringup`. Open a new terminal and execute the following:

```
ros2 launch nav2_bringup navigation_launch.py params_file:=<full/path/to/config/nav2_params.yaml>
```

We should now be able to visualize the footprints in RViz, which will be discussed in the next section.

###### Visualizing Footprint in RViz

To visualize the footprint of the local costmap, click the add button at the bottom-left part of the RViz window. Under the `By topic` tab, select the `Polygon` under the `/local_costmap/published_footprint` topic, as shown below.

[![../../_images/add_topic_local_costmap.png](../../_images/add_topic_local_costmap.png)](../../_images/add_topic_local_costmap.png)

Set the fixed frame in RViz to `odom` and you should see the rectangular-shaped footprint of `sam_bot`:

![../../_images/polygon_footprint.png](../../_images/polygon_footprint.png)

On the other hand, for the global costmap, click the add button at the bottom-left part of the RViz window. Go to `By topic` tab then select the `Polygon` under the `/global_costmap/published_footprint` topic, as shown below.

[![../../_images/add_topic_global_costmap.png](../../_images/add_topic_global_costmap.png)](../../_images/add_topic_global_costmap.png)

Set the fixed frame in RViz to `map` and you should see the circular footprint of `sam_bot`:

![../../_images/circular_footprint.png](../../_images/circular_footprint.png)

###### Conclusion

In this guide, we have shown how to configure a circular and polygon-shaped footprint for your robot. This footprint is important since it plays a major role in Nav2’s pathfinding algorithms function.

As a demo, we have configured the costmap footprint parameters of `sam_bot`. We set the local costmap to use a polygon-shaped footprint following `sam_bot`’s shape while we set the the global costmap to use a circular footprint. Lastly, we visualized and confirmed the footprints of the local and global costmaps in RViz.

---

### Odom

#### Setting Up Odometry - Gazebo

*Source: [https://docs.nav2.org/setup_guides/odom/setup_odom_gz.html](https://docs.nav2.org/setup_guides/odom/setup_odom_gz.html)*

##### Setting Up Odometry - Gazebo

In this guide, we will be looking at how to integrate our robot’s odometry system with Nav2.
First we will provide a brief introduction on odometry, plus the necessary messages and transforms that need to be published for Nav2 to function correctly.
Next, we will show how to setup odometry with two different cases.
In the first case, we will show how to setup an odometry system for a robot with already available wheel encoders.
In the second case, we will build a demo that simulates a functioning odometry system on `sam_bot` (the robot that we built in the previous section) using Gazebo.

See also

The complete source code in this tutorial can be found in [navigation2\_tutorials](https://github.com/ros-navigation/navigation2_tutorials/tree/rolling/sam_bot_description) repository under the `sam_bot_description` package. Note that the repository contains the full code after accomplishing all the tutorials in this guide.

###### Odometry Introduction

The odometry system provides a locally accurate estimate of a robot’s pose and velocity based on its motion. The odometry information can be obtained from various sources such as IMU, LIDAR, RADAR, VIO, and wheel encoders. One thing to note is that IMUs drift over time while wheel encoders drift over distance traveled, thus they are often used together to counter each other’s negative characteristics.

The `odom` frame and the transformation associated with it use a robot’s odometry system to publish localization information that is continuous but becomes less accurate over time or distance (depending on the sensor modalities and drift). In spite of this, the information can still be used by the robot to navigate its immediate vicinity (e.g collision avoidance). To obtain consistently accurate odometry information over time, the `map` frame provides globally accurate information that is used to correct the `odom` frame.

As discussed in the previous guides and in [REP 105](https://www.ros.org/reps/rep-0105.html), the `odom` frame is connected to the rest of the system and Nav2 through the `odom` => `base_link` transform. This transform is published by a tf2 broadcaster or by frameworks such as `robot_localization`, which also provide additional functionalities. We will be talking more about `robot_localization` in a following section.

In addition to the required `odom` => `base_link` transform, Nav2 also requires the publishing of `nav_msgs/Odometry` message because this message provides the velocity information of the robot. In detail, the `nav_msgs/Odometry` message contains the following information:

```
##### This represents estimates of position and velocity in free space.
##### The pose in this message should be specified in the coordinate frame given by header.frame_id
##### The twist in this message should be specified in the coordinate frame given by the child_frame_id

##### Includes the frame id of the pose parent.
std_msgs/Header header

##### Frame id the pose is pointing at. The twist is in this coordinate frame.
string child_frame_id

##### Estimated pose that is typically relative to a fixed world frame.
geometry_msgs/PoseWithCovariance pose

##### Estimated linear and angular velocity relative to child_frame_id.
geometry_msgs/TwistWithCovariance twist
```

This message tells us the estimates for the pose and velocity of the robot. The `header` message provides the timestamped data in a given coordinate frame. The `pose` message provides the position and orientation of the robot relative to the frame specified in `header.frame_id`. The `twist` message gives the linear and angular velocity relative to the frame defined in `child_frame_id`.

###### Setting Up Odometry on your Robot

Setting up the odometry system for Nav2 for your physical robot depends a lot on which odometry sensors are available with your robot. Due to the large number of configurations your robot may have, specific setup instructions will not be within the scope of this tutorial. Instead, we will provide some basic examples and useful resources to help you configure your robot for Nav2.

To start, we will use an example of a robot with wheel encoders as its odometry source. Note that wheel encoders are not required for Nav2 but it is common in most setups. The goal in setting up the odometry is to compute the odometry information and publish the `nav_msgs/Odometry` message and `odom` => `base_link` transform over ROS 2. To calculate this information, you will need to setup some code that will translate wheel encoder information into odometry information, similar to the snippet below:

```
linear = (right_wheel_est_vel + left_wheel_est_vel) / 2
angular = (right_wheel_est_vel - left_wheel_est_vel) / wheel_separation;
```

The `right_wheel_est_vel` and `left_wheel_est_vel` are the estimated velocities of the right and left wheels respectively, and the `wheel separation` is the distance between the wheels. The values of `right_wheel_est_vel` and `left_wheel_est_vel` can be obtained by simply getting the changes in the positions of the wheel joints over time. This information can then be used to publish the Nav2 requirements. A basic example on how to do this can be found in the Navigation documentation on odometry [located here](http://wiki.ros.org/navigation/Tutorials/RobotSetup/Odom/)

An alternative to manually publishing this information that we recommend is through the `ros2_control` framework. The `ros2_control` framework contains various packages for real-time control of robots in ROS 2. For wheel encoders, `ros2_control` has a `diff_drive_controller` (differential drive controller) under the `ros2_controller` package. The `diff_drive_controller` takes in the `geometry_msgs/Twist` messages published on `cmd_vel` topic, computes odometry information, and publishes `nav_msgs/Odometry` messages on `odom` topic. Other packages that deal with different kind of sensors are also available in `ros2_control`.

See also

For more information, see the [ros2\_control documentation](https://control.ros.org/) and the [Github repository of diff\_drive\_controller](https://github.com/ros-controls/ros2_controllers/tree/master/diff_drive_controller/).

For other types of sensors such as IMU, VIO, etc, their respective ROS drivers should have documentation on how publish the odometry information. Keep in mind that Nav2 requires the `nav_msgs/Odometry` message and `odom` => `base_link` transforms to be published and this should be your goal when setting up your odometry system.

###### Simulating an Odometry System using Gazebo

In this section, we will be using Gazebo to simulate the odometry system of `sam_bot`, the robot that we built in the previous section of this tutorial series. You may go through that guide first or grab the [complete source here](https://github.com/ros-navigation/navigation2_tutorials/tree/rolling/sam_bot_description/).

Note

If you are working on your own physical robot and have already set up your odometry sensors, you may opt to skip this section and head onto the next one where we fuse IMU and odometry messages to provide a smooth `odom` => `base_link` transformation.

As an overview for this section, we will first setup Gazebo and the necessary packages required to make it work with ROS 2. Next, we will be adding Gazebo plugins, which simulate an IMU sensor and a differential drive odometry system, in order to publish `sensor_msgs/Imu` and `nav_msgs/Odometry` messages respectively. Lastly, we will spawn `sam_bot` in a Gazebo environment and verify the published `sensor_msgs/Imu` and `nav_msgs/Odometry` messages over ROS 2.

###### Setup and Prerequisites

[Gazebo](http://gazebosim.org/) is a 3D simulator that allows us to observe how our virtual robot will function in a simulated environment. To start using Gazebo with ROS 2, follow the installation instructions in the [Gazebo Installation Documentation](https://gazebosim.org/docs/latest/ros_installation/).

```
sudo apt install ros-<ros2-distro>-ros-gz
```

###### Adding Gazebo Plugins to a URDF/SDF

We will now add the IMU sensor and the differential drive plugins of Gazebo to our URDF/SDF. For an overview of the different sensors available in Gazebo, have a look at the [Sensor Documentation](https://gazebosim.org/docs/latest/sensors).

A sensor must be attached to a link, thus we will create an `imu_link` to which the IMU sensor will be attached. This link will be referenced under the `<gazebo>` element if using URDF. Next, we will set `/demo/imu` as the topic to which the IMU will be publishing its information, and we will comply with [REP145](https://www.ros.org/reps/rep-0145.html) by setting `initialOrientationAsReference` to `false`. We will also add some noise to the sensor configuration using Gazebo’s [sensor noise model](https://classic.gazebosim.org/tutorials?tut=sensor_noise).

Now, we will set up our IMU sensor according to the description above.

Add the following lines before the `</model>` line in your robot SDF:

```
<joint name='imu_joint' type='fixed'>
  <parent>base_link</parent>
  <child>imu_link</child>
  <pose relative_to="base_link">0.0 0.0 0.01 0 0 0</pose>
</joint>

<link name='imu_link'>
  <pose relative_to="imu_joint"/>
  <visual name="imu_link_visual">
    <geometry>
      <box><size>
        0.1 0.1 0.1
      </size></box>
    </geometry>
  </visual>

  <collision name="imu_link_collision">
    <geometry>
      <box><size>
        0.1 0.1 0.1
      </size></box>
    </geometry>
  </collision>

  <xacro:box_inertia m="0.1" w="0.1" d="0.1" h="0.1"/>

  <sensor name="imu_sensor" type="imu">
    <always_on>true</always_on>
    <update_rate>100</update_rate>
    <visualize>true</visualize>
    <topic>demo/imu</topic>
    <gz_frame_id>imu_link</gz_frame_id>
    <imu>
      <angular_velocity>
        <x>
          <noise type="gaussian">
            <mean>0.0</mean>
            <stddev>2e-4</stddev>
            <bias_mean>0.0000075</bias_mean>
            <bias_stddev>0.0000008</bias_stddev>
          </noise>
        </x>
        <y>
          <noise type="gaussian">
            <mean>0.0</mean>
            <stddev>2e-4</stddev>
            <bias_mean>0.0000075</bias_mean>
            <bias_stddev>0.0000008</bias_stddev>
          </noise>
        </y>
        <z>
          <noise type="gaussian">
            <mean>0.0</mean>
            <stddev>2e-4</stddev>
            <bias_mean>0.0000075</bias_mean>
            <bias_stddev>0.0000008</bias_stddev>
          </noise>
        </z>
      </angular_velocity>
      <linear_acceleration>
        <x>
          <noise type="gaussian">
            <mean>0.0</mean>
            <stddev>1.7e-2</stddev>
            <bias_mean>0.1</bias_mean>
            <bias_stddev>0.001</bias_stddev>
          </noise>
        </x>
        <y>
          <noise type="gaussian">
            <mean>0.0</mean>
            <stddev>1.7e-2</stddev>
            <bias_mean>0.1</bias_mean>
            <bias_stddev>0.001</bias_stddev>
          </noise>
        </y>
        <z>
          <noise type="gaussian">
            <mean>0.0</mean>
            <stddev>1.7e-2</stddev>
            <bias_mean>0.1</bias_mean>
            <bias_stddev>0.001</bias_stddev>
          </noise>
        </z>
      </linear_acceleration>
    </imu>
  </sensor>
</link>
```

Now, let us add the DiffDrive plugin and the JointStatePublisher plugin. We will configure the plugins such that `nav_msgs/Odometry` messages are published on the `/demo/odom` topic, `tf2_msgs/msg/TFMessage` messages on the `/tf` topic, and the `sensor_msgs/msg/JointState` messages for the two wheels are published on `/joint_states`. The joints of the left and right wheels will be set to the wheel joints of `sam_bot`.
The wheel separation and wheel radius are set according to the values of the defined values of `wheel_ygap` and `wheel_radius` respectively.

Add the following lines after the `</link>` tag of the IMU sensor in your SDF:

```
<plugin filename="gz-sim-diff-drive-system" name="gz::sim::systems::DiffDrive">
  <!-- wheels -->
  <left_joint>drivewhl_l_joint</left_joint>
  <right_joint>drivewhl_r_joint</right_joint>

  <!-- kinematics -->
  <wheel_separation>0.4</wheel_separation>
  <wheel_radius>${wheel_radius}</wheel_radius>

  <!-- limits -->
  <max_linear_acceleration>0.1</max_linear_acceleration>

  <!-- input -->
  <topic>/demo/cmd_vel</topic>

  <!-- output -->
  <odom_topic>/demo/odom</odom_topic>
  <tf_topic>/tf</tf_topic>

  <frame_id>odom</frame_id>
  <child_frame_id>base_link</child_frame_id>
</plugin>

<plugin
  filename="gz-sim-joint-state-publisher-system"
  name="gz::sim::systems::JointStatePublisher">
  <topic>joint_states</topic>
</plugin>
```

Also set the friction of the caster wheel to near zero by modifying the caster link in your SDF as shown below. This is to keep things simple.

```
<link name="front_caster">
  <pose relative_to="caster_joint"/>

  <visual name="front_caster_visual">
    <geometry>
      <sphere>
        <radius>${(wheel_radius+wheel_zoff-(base_height/2))}</radius>
      </sphere>
    </geometry>
    <material>
      <ambient>0 1 1 1</ambient>
      <diffuse>0 1 1 1</diffuse>
    </material>
  </visual>

  <collision name="front_caster_collision">
    <geometry>
      <sphere>
        <radius>${(wheel_radius+wheel_zoff-(base_height/2))}</radius>
      </sphere>
    </geometry>
    <surface><friction><ode>
      <mu>0.001</mu>
      <mu2>0.001</mu2>
    </ode></friction></surface>
  </collision>

  <xacro:sphere_inertia m="0.5" r="${(wheel_radius+wheel_zoff-(base_height/2))}"/>
</link>
```

###### Creating ROS<->Gazebo Bridge

There is a bridge included in the `ros_gz_bridge` package which allows us to translate Gazebo topics into ROS topics and vice-versa. We need to launch the bridge with a configuration which tells it about what topics we want to bridge.

Now, create a file named `bridge_config.yaml` in the `config` directory of your package and add the following lines to it to define what topics we want to bridge between ROS and Gazebo:

```
---
- ros_topic_name: "/clock"
  gz_topic_name: "/clock"
  ros_type_name: "rosgraph_msgs/msg/Clock"
  gz_type_name: "gz.msgs.Clock"
  direction: GZ_TO_ROS

- ros_topic_name: "/demo/imu"
  gz_topic_name: "/demo/imu"
  ros_type_name: "sensor_msgs/msg/Imu"
  gz_type_name: "gz.msgs.IMU"
  direction: GZ_TO_ROS

##### Topic published by DiffDrive plugin
- ros_topic_name: "/demo/odom"
  gz_topic_name: "/demo/odom"
  ros_type_name: "nav_msgs/msg/Odometry"
  gz_type_name: "gz.msgs.Odometry"
  direction: GZ_TO_ROS

##### Topic published by JointStatePublisher plugin
- ros_topic_name: "/joint_states"
  gz_topic_name: "/joint_states"
  ros_type_name: "sensor_msgs/msg/JointState"
  gz_type_name: "gz.msgs.Model"
  direction: GZ_TO_ROS

##### Topic subscribed to by DiffDrive plugin
- ros_topic_name: "/demo/cmd_vel"
  gz_topic_name: "/demo/cmd_vel"
  ros_type_name: "geometry_msgs/msg/TwistStamped"
  gz_type_name: "gz.msgs.Twist"
  direction: ROS_TO_GZ

- ros_topic_name: "/tf"
  gz_topic_name: "/tf"
  ros_type_name: "tf2_msgs/msg/TFMessage"
  gz_type_name: "gz.msgs.Pose_V"
  direction: GZ_TO_ROS
```

Finally, add the below variable to the launch file which we will use in the next section to tell the bridge where the config file is:

```
bridge_config_path = os.path.join(pkg_share, 'config', 'bridge_config.yaml')
```

###### Making a Gazebo world

Create a `world` directory in your package and add [this code](https://github.com/ros-navigation/navigation2_tutorials/blob/rolling/sam_bot_description/world/my_world.sdf) to a new file named `my_world.sdf`:

We also have to add the `world` directory to our `CMakeLists.txt` file. Open [CMakeLists.txt](https://github.com/ros-navigation/navigation2_tutorials/blob/rolling/sam_bot_description/CMakeLists.txt) and append the `world` directory inside the install(DIRECTORY…), as shown in the snippet below.

```
install(
  DIRECTORY src launch rviz config world
  DESTINATION share/${PROJECT_NAME}
)
```

Finally, add the below variable to the launch file which we will use in the next section to tell Gazebo where the world file is located:

```
world_path = os.path.join(pkg_share, 'world', 'my_world.sdf')
```

###### Launch and Build Files

We will now edit our launch file to spawn `sam_bot` in Gazebo. Since the JointStatePublisher plugin will now publish the `joint_states`, we can remove everything related to the joint state publisher by deleting the following lines inside the `generate_launch_description()`:

```
joint_state_publisher_node = Node(
    package='joint_state_publisher',
    executable='joint_state_publisher',
    name='joint_state_publisher',
    parameters=[{'robot_description': Command(['xacro ', default_model_path])}],
    condition=UnlessCondition(LaunchConfiguration('gui'))
)
joint_state_publisher_gui_node = Node(
    package='joint_state_publisher_gui',
    executable='joint_state_publisher_gui',
    name='joint_state_publisher_gui',
    condition=IfCondition(LaunchConfiguration('gui'))
)
```

Remove the following from `return LaunchDescription([])`:

```
DeclareLaunchArgument(name='gui', default_value='True', description='Flag to enable joint_state_publisher_gui'),
joint_state_publisher_node,
joint_state_publisher_gui_node,
```

Next, open [package.xml](https://github.com/ros-navigation/navigation2_tutorials/blob/master/sam_bot_description/package.xml) and delete the lines:

```
<exec_depend>joint_state_publisher</exec_depend>
<exec_depend>joint_state_publisher_gui</exec_depend>
```

Replace your import statements with the following lines.
We use `RosGzBridge` to start the bridge between ROS 2 and Gazebo and `GzServer` to start the Gazebo simulation.
We also import `get_package_share_directory`, `ExecuteProcess`, `IncludeLaunchDescription` and `PythonLaunchDescriptionSource` for additional changes in the launch file.

```
import os

from ament_index_python.packages import get_package_share_directory
from launch import LaunchDescription
from launch.actions import DeclareLaunchArgument, ExecuteProcess, IncludeLaunchDescription
from launch.launch_description_sources import PythonLaunchDescriptionSource
from launch.substitutions import Command, LaunchConfiguration
from launch_ros.actions import Node
from ros_gz_bridge.actions import RosGzBridge
from ros_gz_sim.actions import GzServer
```

Since we do not import `FindPackageShare` anymore, we use the function `get_package_share_directory` instead to find the package share directory.
Edit the variable definition of `pkg_share`:

```
pkg_share = get_package_share_directory('sam_bot_description')
```

Add this two variables, which are needed for starting the Gazebo world and spawning the robot:

```
ros_gz_sim_share = get_package_share_directory('ros_gz_sim')
gz_spawn_model_launch_source = os.path.join(ros_gz_sim_share, "launch", "gz_spawn_model.launch.py")
```

To make `robot_state_publisher` `use_sim_time` change it in the following way:

```
robot_state_publisher_node = Node(
    package='robot_state_publisher',
    executable='robot_state_publisher',
    parameters=[{'robot_description': Command(['xacro ', LaunchConfiguration('model')])}, {'use_sim_time': LaunchConfiguration('use_sim_time')}]
)
```

Also declare the `use_sim_time` argument in `LaunchDescription([])` by adding the below line to it:

```
DeclareLaunchArgument(name='use_sim_time', default_value='True', description='Flag to enable use_sim_time'),
```

To launch Gazebo and spawn `sam_bot` in it, add the following after the `rviz_node` definition `display.launch.py`:

```
gz_server = GzServer(
    world_sdf_file=world_path,
    container_name='ros_gz_container',
    create_own_container='True',
    use_composition='True',
)
ros_gz_bridge = RosGzBridge(
    bridge_name='ros_gz_bridge',
    config_file=bridge_config_path,
    container_name='ros_gz_container',
    create_own_container='False',
    use_composition='True',
)
spawn_entity = IncludeLaunchDescription(
    PythonLaunchDescriptionSource(gz_spawn_model_launch_source),
    launch_arguments={
        'world': 'my_world',
        'topic': '/robot_description',
        'entity_name': 'sam_bot',
        'z': '0.65',
    }.items(),
)
```

Also add the following lines to `LaunchDescription([])`:

```
ExecuteProcess(cmd=['gz', 'sim', '-g'], output='screen'),
gz_server,
ros_gz_bridge,
spawn_entity,
```

Finally, add the below lines to your package.xml:

```
<exec_depend>ros_gz_bridge</exec_depend>
<exec_depend>ros_gz_sim</exec_depend>
```

At this point, your entire launch file should look like this:

```
import os

from ament_index_python.packages import get_package_share_directory
from launch import LaunchDescription
from launch.actions import DeclareLaunchArgument, ExecuteProcess, IncludeLaunchDescription
from launch.launch_description_sources import PythonLaunchDescriptionSource
from launch.substitutions import Command, LaunchConfiguration
from launch_ros.actions import Node
from ros_gz_bridge.actions import RosGzBridge
from ros_gz_sim.actions import GzServer

def generate_launch_description():
    pkg_share = get_package_share_directory('sam_bot_description')
    ros_gz_sim_share = get_package_share_directory('ros_gz_sim')
    gz_spawn_model_launch_source = os.path.join(ros_gz_sim_share, "launch", "gz_spawn_model.launch.py")
    default_model_path = os.path.join(pkg_share, 'src', 'description', 'sam_bot_description.sdf')
    default_rviz_config_path = os.path.join(pkg_share, 'rviz', 'config.rviz')
    world_path = os.path.join(pkg_share, 'world', 'my_world.sdf')
    bridge_config_path = os.path.join(pkg_share, 'config', 'bridge_config.yaml')

    robot_state_publisher_node = Node(
        package='robot_state_publisher',
        executable='robot_state_publisher',
        parameters=[{'robot_description': Command(['xacro ', LaunchConfiguration('model')])}, {'use_sim_time': LaunchConfiguration('use_sim_time')}]
    )
    rviz_node = Node(
        package='rviz2',
        executable='rviz2',
        name='rviz2',
        output='screen',
        arguments=['-d', LaunchConfiguration('rvizconfig')],
    )
    gz_server = GzServer(
        world_sdf_file=world_path,
        container_name='ros_gz_container',
        create_own_container='True',
        use_composition='True',
    )
    ros_gz_bridge = RosGzBridge(
        bridge_name='ros_gz_bridge',
        config_file=bridge_config_path,
        container_name='ros_gz_container',
        create_own_container='False',
        use_composition='True',
    )
    spawn_entity = IncludeLaunchDescription(
        PythonLaunchDescriptionSource(gz_spawn_model_launch_source),
        launch_arguments={
            'world': 'my_world',
            'topic': '/robot_description',
            'entity_name': 'sam_bot',
            'z': '0.65',
        }.items(),
    )

    return LaunchDescription([
        DeclareLaunchArgument(name='use_sim_time', default_value='True', description='Flag to enable use_sim_time'),
        DeclareLaunchArgument(name='model', default_value=default_model_path, description='Absolute path to robot model file'),
        DeclareLaunchArgument(name='rvizconfig', default_value=default_rviz_config_path, description='Absolute path to rviz config file'),
        ExecuteProcess(cmd=['gz', 'sim', '-g'], output='screen'),
        robot_state_publisher_node,
        rviz_node,
        gz_server,
        ros_gz_bridge,
        spawn_entity,
    ])
```

###### Build, Run and Verification

Let us run our package to check if the `/demo/imu` and `/demo/odom` topics are active in the system.

Navigate to the root of the project and execute the following lines:

```
colcon build
. install/setup.bash
ros2 launch sam_bot_description display.launch.py
```

Gazebo should launch and you should see a 3D model of `sam_bot`:

[![../../_images/gazebo_sam_bot.png](../../_images/gazebo_sam_bot.png)](../../_images/gazebo_sam_bot.png)

To see the active topics in the system, open a new terminal and execute:

```
ros2 topic list
```

You should see the below topics in the list of topics:

```
/clock
/demo/cmd_vel
/demo/imu
/demo/odom
/joint_states
/tf
```

To see more information about the topics, execute:

```
ros2 topic info /topic
```

Now set the fixed frame in RViz to `odom` and execute the below command in order to move the robot around:

```
ros2 run teleop_twist_keyboard teleop_twist_keyboard --ros-args -p stamped:=true --remap cmd_vel:=/demo/cmd_vel
```

You should see the robot moving in both Gazebo and RViz.
Something to note here is that we are using `TwistStamped` messages here as those are now the standard in most packages for ROS2 Jazzy and newer. Some Nav2 nodes come with the `enable_stamped_cmd_vel` parameter which you can set to `true`. It defaults to true for any distro newer than ROS2 Jazzy.

###### Conclusion

In this guide, we have discussed the messages and transforms that are expected by Nav2 from the odometry system. We have seen how to set up an odometry system and how to verify the published messages.

---

#### Setting Up Odometry - Gazebo Classic

*Source: [https://docs.nav2.org/setup_guides/odom/setup_odom_gz_classic.html](https://docs.nav2.org/setup_guides/odom/setup_odom_gz_classic.html)*

##### Setting Up Odometry - Gazebo Classic

In this guide, we will be looking at how to integrate our robot’s odometry system with Nav2.
First we will provide a brief introduction on odometry, plus the necessary messages and transforms that need to be published for Nav2 to function correctly.
Next, we will show how to setup odometry with two different cases.
In the first case, we will show how to setup an odometry system for a robot with already available wheel encoders.
In the second case, we will build a demo that simulates a functioning odometry system on `sam_bot` (the robot that we built in the previous section) using Gazebo.

See also

The complete source code in this tutorial can be found in [navigation2\_tutorials](https://github.com/ros-navigation/navigation2_tutorials/tree/humble/sam_bot_description) repository under the `sam_bot_description` package. Note that the repository contains the full code after accomplishing all the tutorials in this guide.

###### Odometry Introduction

The odometry system provides a locally accurate estimate of a robot’s pose and velocity based on its motion. The odometry information can be obtained from various sources such as IMU, LIDAR, RADAR, VIO, and wheel encoders. One thing to note is that IMUs drift over time while wheel encoders drift over distance traveled, thus they are often used together to counter each other’s negative characteristics.

The `odom` frame and the transformation associated with it use a robot’s odometry system to publish localization information that is continuous but becomes less accurate over time or distance (depending on the sensor modalities and drift). In spite of this, the information can still be used by the robot to navigate its immediate vicinity (e.g collision avoidance). To obtain consistently accurate odometry information over time, the `map` frame provides globally accurate information that is used to correct the `odom` frame.

As discussed in the previous guides and in [REP 105](https://www.ros.org/reps/rep-0105.html), the `odom` frame is connected to the rest of the system and Nav2 through the `odom` => `base_link` transform. This transform is published by a tf2 broadcaster or by frameworks such as `robot_localization`, which also provide additional functionalities. We will be talking more about `robot_localization` in a following section.

In addition to the required `odom` => `base_link` transform, Nav2 also requires the publishing of `nav_msgs/Odometry` message because this message provides the velocity information of the robot. In detail, the `nav_msgs/Odometry` message contains the following information:

```
##### This represents estimates of position and velocity in free space.
##### The pose in this message should be specified in the coordinate frame given by header.frame_id
##### The twist in this message should be specified in the coordinate frame given by the child_frame_id

##### Includes the frame id of the pose parent.
std_msgs/Header header

##### Frame id the pose is pointing at. The twist is in this coordinate frame.
string child_frame_id

##### Estimated pose that is typically relative to a fixed world frame.
geometry_msgs/PoseWithCovariance pose

##### Estimated linear and angular velocity relative to child_frame_id.
geometry_msgs/TwistWithCovariance twist
```

This message tells us the estimates for the pose and velocity of the robot. The `header` message provides the timestamped data in a given coordinate frame. The `pose` message provides the position and orientation of the robot relative to the frame specified in `header.frame_id`. The `twist` message gives the linear and angular velocity relative to the frame defined in `child_frame_id`.

###### Setting Up Odometry on your Robot

Setting up the odometry system for Nav2 for your physical robot depends a lot on which odometry sensors are available with your robot. Due to the large number of configurations your robot may have, specific setup instructions will not be within the scope of this tutorial. Instead, we will provide some basic examples and useful resources to help you configure your robot for Nav2.

To start, we will use an example of a robot with wheel encoders as its odometry source. Note that wheel encoders are not required for Nav2 but it is common in most setups. The goal in setting up the odometry is to compute the odometry information and publish the `nav_msgs/Odometry` message and `odom` => `base_link` transform over ROS 2. To calculate this information, you will need to setup some code that will translate wheel encoder information into odometry information, similar to the snippet below:

```
linear = (right_wheel_est_vel + left_wheel_est_vel) / 2
angular = (right_wheel_est_vel - left_wheel_est_vel) / wheel_separation;
```

The `right_wheel_est_vel` and `left_wheel_est_vel` are the estimated velocities of the right and left wheels respectively, and the `wheel separation` is the distance between the wheels. The values of `right_wheel_est_vel` and `left_wheel_est_vel` can be obtained by simply getting the changes in the positions of the wheel joints over time. This information can then be used to publish the Nav2 requirements. A basic example on how to do this can be found in the Navigation documentation on odometry [located here](http://wiki.ros.org/navigation/Tutorials/RobotSetup/Odom/)

An alternative to manually publishing this information that we recommend is through the `ros2_control` framework. The `ros2_control` framework contains various packages for real-time control of robots in ROS 2. For wheel encoders, `ros2_control` has a `diff_drive_controller` (differential drive controller) under the `ros2_controller` package. The `diff_drive_controller` takes in the `geometry_msgs/Twist` messages published on `cmd_vel` topic, computes odometry information, and publishes `nav_msgs/Odometry` messages on `odom` topic. Other packages that deal with different kind of sensors are also available in `ros2_control`.

See also

For more information, see the [ros2\_control documentation](https://ros-controls.github.io/control.ros.org/) and the [Github repository of diff\_drive\_controller](https://github.com/ros-controls/ros2_controllers/tree/master/diff_drive_controller/).

For other types of sensors such as IMU, VIO, etc, their respective ROS drivers should have documentation on how publish the odometry information. Keep in mind that Nav2 requires the `nav_msgs/Odometry` message and `odom` => `base_link` transforms to be published and this should be your goal when setting up your odometry system.

###### Simulating an Odometry System using Gazebo

In this section, we will be using Gazebo to simulate the odometry system of `sam_bot`, the robot that we built in the previous section of this tutorial series. You may go through that guide first or grab the [complete source here](https://github.com/ros-navigation/navigation2_tutorials/tree/humble/sam_bot_description/).

Note

If you are working on your own physical robot and have already set up your odometry sensors, you may opt to skip this section and head onto the next one where we fuse IMU and odometry messages to provide a smooth `odom` => `base_link` transformation.

As an overview for this section, we will first setup Gazebo and the necessary packages required to make it work with ROS 2. Next, we will be adding Gazebo plugins, which simulate an IMU sensor and a differential drive odometry system, in order to publish `sensor_msgs/Imu` and `nav_msgs/Odometry` messages respectively. Lastly, we will spawn `sam_bot` in a Gazebo environment and verify the published `sensor_msgs/Imu` and `nav_msgs/Odometry` messages over ROS 2.

###### Setup and Prerequisites

[Gazebo](http://classic.gazebosim.org/) is a 3D simulator that allows us to observe how our virtual robot will function in a simulated environment. To start using Gazebo with ROS 2, follow the installation instructions in the [Gazebo Installation Documentation](http://classic.gazebosim.org/tutorials?cat=install).

We also need to install the `gazebo_ros_pkgs` package to simulate odometry and control the robot with ROS 2 in Gazebo:

```
sudo apt install ros-<ros2-distro>-gazebo-ros-pkgs
```

You can test if you have successfully set up your ROS 2 and Gazebo environments by following the instructions [given here](http://classic.gazebosim.org/tutorials?tut=ros2_installing&cat=connect_ros#TestingGazeboandROS2integration).

Note that we described `sam_bot` using URDF. However, Gazebo uses [Simulation Description Format (SDF)](http://sdformat.org/) to describe a robot in its simulated environment. Fortunately, Gazebo automatically translates compatible URDF files into SDF. The main requirement for the URDF to be compatible with Gazebo is to have an `<inertia>` element within each `<link>` element. This requirement is already satisfied in the URDF file of `sam_bot`, so it can already be used in Gazebo.

See also

For more information on how to use URDF in Gazebo, see [Tutorial: Using a URDF in Gazebo](http://classic.gazebosim.org/tutorials/?tut=ros_urdf).

###### Adding Gazebo Plugins to a URDF

We will now add the IMU sensor and the differential drive plugins of Gazebo to our URDF. For an overview of the different plugins available in Gazebo, have a look at [Tutorial: Using Gazebo plugins with ROS](http://classic.gazebosim.org/tutorials?tut=ros_gzplugins).

For our robot, we will be using the [GazeboRosImuSensor](http://classic.gazebosim.org/tutorials?tut=ros_gzplugins#IMUsensor(GazeboRosImuSensor)) which is a SensorPlugin. A SensorPlugin must be attached to a link, thus we will create an `imu_link` to which the IMU sensor will be attached. This link will be referenced under the `<gazebo>` element. Next, we will set `/demo/imu` as the topic to which the IMU will be publishing its information, and we will comply with [REP145](https://www.ros.org/reps/rep-0145.html) by setting `initialOrientationAsReference` to `false`. We will also add some noise to the sensor configuration using Gazebo’s [sensor noise model](http://classic.gazebosim.org/tutorials?tut=sensor_noise).

Now, we will set up our IMU sensor plugin according to the description above by adding the following lines before the `</robot>` line in our URDF:

```
132<link name="imu_link">
133  <visual>
134    <geometry>
135      <box size="0.1 0.1 0.1"/>
136    </geometry>
137  </visual>
138
139  <collision>
140    <geometry>
141      <box size="0.1 0.1 0.1"/>
142    </geometry>
143  </collision>
144
145  <xacro:box_inertia m="0.1" w="0.1" d="0.1" h="0.1"/>
146</link>
147
148<joint name="imu_joint" type="fixed">
149  <parent link="base_link"/>
150  <child link="imu_link"/>
151  <origin xyz="0 0 0.01"/>
152</joint>
153
154 <gazebo reference="imu_link">
155  <sensor name="imu_sensor" type="imu">
156   <plugin filename="libgazebo_ros_imu_sensor.so" name="imu_plugin">
157      <ros>
158        <namespace>/demo</namespace>
159        <remapping>~/out:=imu</remapping>
160      </ros>
161      <initial_orientation_as_reference>false</initial_orientation_as_reference>
162    </plugin>
163    <always_on>true</always_on>
164    <update_rate>100</update_rate>
165    <visualize>true</visualize>
166    <imu>
167      <angular_velocity>
168        <x>
169          <noise type="gaussian">
170            <mean>0.0</mean>
171            <stddev>2e-4</stddev>
172            <bias_mean>0.0000075</bias_mean>
173            <bias_stddev>0.0000008</bias_stddev>
174          </noise>
175        </x>
176        <y>
177          <noise type="gaussian">
178            <mean>0.0</mean>
179            <stddev>2e-4</stddev>
180            <bias_mean>0.0000075</bias_mean>
181            <bias_stddev>0.0000008</bias_stddev>
182          </noise>
183        </y>
184        <z>
185          <noise type="gaussian">
186            <mean>0.0</mean>
187            <stddev>2e-4</stddev>
188            <bias_mean>0.0000075</bias_mean>
189            <bias_stddev>0.0000008</bias_stddev>
190          </noise>
191        </z>
192      </angular_velocity>
193      <linear_acceleration>
194        <x>
195          <noise type="gaussian">
196            <mean>0.0</mean>
197            <stddev>1.7e-2</stddev>
198            <bias_mean>0.1</bias_mean>
199            <bias_stddev>0.001</bias_stddev>
200          </noise>
201        </x>
202        <y>
203          <noise type="gaussian">
204            <mean>0.0</mean>
205            <stddev>1.7e-2</stddev>
206            <bias_mean>0.1</bias_mean>
207            <bias_stddev>0.001</bias_stddev>
208          </noise>
209        </y>
210        <z>
211          <noise type="gaussian">
212            <mean>0.0</mean>
213            <stddev>1.7e-2</stddev>
214            <bias_mean>0.1</bias_mean>
215            <bias_stddev>0.001</bias_stddev>
216          </noise>
217        </z>
218      </linear_acceleration>
219    </imu>
220  </sensor>
221</gazebo>
```

Now, let us add the differential drive ModelPlugin. We will configure the plugin such that `nav_msgs/Odometry` messages are published on the `/demo/odom` topic. The joints of the left and right wheels will be set to the wheel joints of `sam_bot`. The wheel separation and wheel diameter are set according to the values of the defined values of `wheel_ygap` and `wheel_radius` respectively.

To include this plugin in our URDF, add the following lines after the `</gazebo>` tag of the IMU plugin:

```
223<gazebo>
224  <plugin name='diff_drive' filename='libgazebo_ros_diff_drive.so'>
225    <ros>
226      <namespace>/demo</namespace>
227    </ros>
228
229    <!-- wheels -->
230    <left_joint>drivewhl_l_joint</left_joint>
231    <right_joint>drivewhl_r_joint</right_joint>
232
233    <!-- kinematics -->
234    <wheel_separation>0.4</wheel_separation>
235    <wheel_diameter>0.2</wheel_diameter>
236
237    <!-- limits -->
238    <max_wheel_torque>20</max_wheel_torque>
239    <max_wheel_acceleration>1.0</max_wheel_acceleration>
240
241    <!-- output -->
242    <publish_odom>true</publish_odom>
243    <publish_odom_tf>false</publish_odom_tf>
244    <publish_wheel_tf>true</publish_wheel_tf>
245
246    <odometry_frame>odom</odometry_frame>
247    <robot_base_frame>base_link</robot_base_frame>
248  </plugin>
249</gazebo>
```

###### Launch and Build Files

We will now edit our launch file, [launch/display.launch.py](https://github.com/ros-navigation/navigation2_tutorials/blob/master/sam_bot_description/launch/display.launch.py), to spawn `sam_bot` in Gazebo. Since we will be simulating our robot, we can remove the GUI for the joint state publisher by deleting the following lines inside the `generate_launch_description()`:

```
joint_state_publisher_gui_node = launch_ros.actions.Node(
  package='joint_state_publisher_gui',
  executable='joint_state_publisher_gui',
  name='joint_state_publisher_gui',
  condition=launch.conditions.IfCondition(LaunchConfiguration('gui'))
)
```

Remove the following gui param:

```
DeclareLaunchArgument(name='gui', default_value='True',
                      description='Flag to enable joint_state_publisher_gui')
```

Remove the condition and parameters. Add arguments to the joint\_state\_publisher\_node:

```
joint_state_publisher_node = launch_ros.actions.Node(
  package='joint_state_publisher',
  executable='joint_state_publisher',
  name='joint_state_publisher',
  arguments=[default_model_path], #Add this line
  parameters=[{'robot_description': Command(['xarcro ', default_model_path])}], #Remove this line
  condition=launch.conditions.UnlessCondition(LaunchConfiguration('gui')) # Remove this line
)
```

Next, open [package.xml](https://github.com/ros-navigation/navigation2_tutorials/blob/master/sam_bot_description/package.xml) and delete the line:

```
<exec_depend>joint_state_publisher_gui</exec_depend>
```

To launch Gazebo, add the following before the `joint_state_publisher_node,` line in `display.launch.py`

```
launch.actions.ExecuteProcess(cmd=['gazebo', '--verbose', '-s', 'libgazebo_ros_init.so', '-s', 'libgazebo_ros_factory.so'], output='screen'),
```

We will now add a node that spawns `sam_bot` in Gazebo. Open [launch/display.launch.py](https://github.com/ros-navigation/navigation2_tutorials/blob/master/sam_bot_description/launch/display.launch.py) again and paste the following lines before the `return launch.LaunchDescription([` line.

```
spawn_entity = launch_ros.actions.Node(
  package='gazebo_ros',
  executable='spawn_entity.py',
  arguments=['-entity', 'sam_bot', '-topic', 'robot_description'],
  output='screen'
)
```

Then add the line `spawn_entity,` before the `rviz_node` line, as shown below.

```
      robot_state_publisher_node,
      spawn_entity,
      rviz_node
])
```

###### Build, Run and Verification

Let us run our package to check if the `/demo/imu` and `/demo/odom` topics are active in the system.

Navigate to the root of the project and execute the following lines:

```
colcon build
. install/setup.bash
ros2 launch sam_bot_description display.launch.py
```

Gazebo should launch and you should see a 3D model of `sam_bot`:

[![../../_images/gazebo_sam_bot.png](../../_images/gazebo_sam_bot.png)](../../_images/gazebo_sam_bot.png)

To see the active topics in the system, open a new terminal and execute:

```
ros2 topic list
```

You should see `/demo/imu` and `/demo/odom` in the list of topics.

To see more information about the topics, execute:

```
ros2 topic info /demo/imu
ros2 topic info /demo/odom
```

You should see an output similar to below:

```
Type: sensor_msgs/msg/Imu
Publisher count: 1
Subscription count: 0
```

```
Type: nav_msgs/msg/Odometry
Publisher count: 1
Subscription count: 0
```

Observe that the `/demo/imu` topic publishes `sensor_msgs/Imu` type messages while the `/demo/odom` topic publishes `nav_msgs/Odometry` type messages. The information being published on these topics come from the gazebo simulation of the IMU sensor and the differential drive respectively. Also note that both topics currently have no subscribers. In the next section, we will create a `robot_localization` node that will subscribe to these two topics. It will then use the messages published on both topics to provide a fused, locally accurate and smooth odometry information for Nav2.

###### Conclusion

In this guide, we have discussed the messages and transforms that are expected by Nav2 from the odometry system. We have seen how to set up an odometry system and how to verify the published messages.

---

#### Smoothing Odometry using Robot Localization

*Source: [https://docs.nav2.org/setup_guides/odom/setup_robot_localization.html](https://docs.nav2.org/setup_guides/odom/setup_robot_localization.html)*

##### Smoothing Odometry using Robot Localization

In this tutorial, we will discuss how various sources of odometry can be fused to provide a smoothed odometry using the `robot_localization` package and we will also show how to publish the `odom` => `base_link` transform using `robot_localization`.

The `robot_localization` package is used to provide a fused and locally accurate smooth odometry information from the data provided by `N` odometry sensor inputs. These information can be provided to the package through `nav_msgs/Odometry`, `sensor_msgs/Imu`, `geometry_msgs/PoseWithCovarianceStamped`, and `geometry_msgs/TwistWithCovarianceStamped` messages.

A usual robot setup consists of at least the wheel encoders and IMU as its odometry sensor sources. When multiple sources are provided to `robot_localization`, it is able to fuse the odometry information given by the sensors through the use of state estimation nodes. These nodes make use of either an Extended Kalman filter (`ekf_node`) or an Unscented Kalman Filter (`ukf_node`) to implement this fusion. In addition, the package also implements a `navsat_transform_node` which transforms geographic coordinates into the robot’s world frame when working with GPS.

Fused sensor data is published by the `robot_localization` package through the `odometry/filtered` and the `accel/filtered` topics, if enabled in its configuration. In addition, it can also publish the `odom` => `base_link` transform on the `/tf` topic. Do note that if you followed [Setting Up Odometry - Gazebo](setup_odom_gz.html#setup-odom-gz), you will need to remove the /tf bridge in `bridge_config.yaml` to get the transforms from `ekf_node` instead of Gazebo.

See also

More details on `robot_localization` can be found in the official [Robot Localization Documentation](http://docs.ros.org/en/noetic/api/robot_localization/html/index.html).

If your robot is only able to provide one odometry source, the use of `robot_localization` would have minimal effects aside from smoothing. In this case, an alternative approach is to publish transforms through a tf2 broadcaster in your single source of odometry node. Nevertheless, you can still opt to use `robot_localization` to publish the transforms and some smoothing properties may still be observed in the output.

See also

For more information on how to write a tf2 broadcaster, you can check Writing a tf2 broadcaster [(C++)](https://docs.ros.org/en/rolling/Tutorials/Tf2/Writing-A-Tf2-Broadcaster-Cpp.html) [(Python)](https://docs.ros.org/en/rolling/Tutorials/Tf2/Writing-A-Tf2-Broadcaster-Py.html).

For the rest of this section, we will show how to use `robot_localization` to fuse the sensors of `sam_bot`. It will use the `sensor_msgs/Imu` messages published on `/demo/Imu` and the `nav_msgs/Odometry` message published on `/demo/odom` and then it will publish data on `odometry/filtered`, `accel/filtered`, and `/tf` topics.

###### Configuring Robot Localization

Let us now configure the `robot_localization` package to use an Extended Kalman Filter (`ekf_node`) to fuse odometry information and publish the `odom` => `base_link` transform.

First, install the `robot_localization` package using your machines package manager or by executing the following command:

```
sudo apt install ros-<ros2-distro>-robot-localization
```

Next, we specify the parameters of the `ekf_node` using a YAML file. Create a directory named `config` at the root of your project and create a file named `ekf.yaml`. Copy the following lines of code into your `ekf.yaml` file.

```
###### ekf config file ###
ekf_filter_node:
    ros__parameters:
##### The frequency, in Hz, at which the filter will output a position estimate. Note that the filter will not begin
##### computation until it receives at least one message from one of the inputs. It will then run continuously at the
##### frequency specified here, regardless of whether it receives more measurements. Defaults to 30 if unspecified.
        frequency: 30.0

##### ekf_localization_node and ukf_localization_node both use a 3D omnidirectional motion model. If this parameter is
##### set to true, no 3D information will be used in your state estimate. Use this if you are operating in a planar
##### environment and want to ignore the effect of small variations in the ground plane that might otherwise be detected
##### by, for example, an IMU. Defaults to false if unspecified.
        two_d_mode: false

##### Whether to publish the acceleration state. Defaults to false if unspecified.
        publish_acceleration: true

##### Whether to broadcast the transformation over the /tf topic. Defaults to true if unspecified.
        publish_tf: true

##### 1. Set the map_frame, odom_frame, and base_link frames to the appropriate frame names for your system.
##### 1a. If your system does not have a map_frame, just remove it, and make sure "world_frame" is set to the value of odom_frame.
##### 2. If you are fusing continuous position data such as wheel encoder odometry, visual odometry, or IMU data, set "world_frame"
##### to your odom_frame value. This is the default behavior for robot_localization's state estimation nodes.
##### 3. If you are fusing global absolute position data that is subject to discrete jumps (e.g., GPS or position updates from landmark
##### observations) then:
##### 3a. Set your "world_frame" to your map_frame value
##### 3b. MAKE SURE something else is generating the odom->base_link transform. Note that this can even be another state estimation node
##### from robot_localization! However, that instance should *not* fuse the global data.
        map_frame: map              # Defaults to "map" if unspecified
        odom_frame: odom            # Defaults to "odom" if unspecified
        base_link_frame: base_link  # Defaults to "base_link" if unspecified
        world_frame: odom           # Defaults to the value of odom_frame if unspecified

        odom0: demo/odom
        odom0_config: [false, false, false,
                      false, false, false,
                      true, true, false,
                      false, false, true,
                      false, false, false]

        imu0: demo/imu
        imu0_config: [false, false, false,
                      false, false, false,
                      false, false, false,
                      false, false, true,
                      false, false, false]
```

In this configuration, we defined the parameter values of `frequency`, `two_d_mode`, `publish_acceleration`, `publish_tf`, `map_frame`, `odom_frame`, `base_link_frame`, and `world_frame`. For more information on the other parameters you can modify, see [Parameters of state estimation nodes](http://docs.ros.org/en/melodic/api/robot_localization/html/state_estimation_nodes.html#parameters), and a sample `efk.yaml` can be found [here](https://github.com/cra-ros-pkg/robot_localization/blob/ros2/params/ekf.yaml).

To add a sensor input to the `ekf_filter_node`, add the next number in the sequence to its base name (odom, imu, pose, twist). In our case, we have one `nav_msgs/Odometry` and one `sensor_msgs/Imu` as inputs to the filter, thus we use `odom0` and `imu0`. We set the value of `odom0` to `demo/odom`, which is the topic that publishes the `nav_msgs/Odometry`. Similarly, we set the value of `imu0` to the topic that publishes `sensor_msgs/Imu`, which is `demo/imu`.

To understand how `robot_localization` is configured and understand the reasoning behind the config have a look at [Configuring robot\_localization](http://docs.ros.org/en/melodic/api/robot_localization/html/configuring_robot_localization.html).

See also

For more advice on configuration of input data to `robot_localization`, see [Preparing Your Data for Use with robot\_localization](http://docs.ros.org/en/melodic/api/robot_localization/html/preparing_sensor_data.html#odometry), and [Configuring robot\_localization](http://docs.ros.org/en/melodic/api/robot_localization/html/configuring_robot_localization.html).

###### Launch and Build Files

Now, let us add the `ekf_node` into the launch file. Open `launch/display.launch.py` and paste the following lines before the `return launch.LaunchDescription([` line.

```
robot_localization_node = Node(
    package='robot_localization',
    executable='ekf_node',
    name='ekf_filter_node',
    output='screen',
    parameters=[os.path.join(pkg_share, 'config/ekf.yaml'), {'use_sim_time': LaunchConfiguration('use_sim_time')}]
)
```

Next, add the following launch arguments within the `return launch.LaunchDescription([` block.

```
launch.actions.DeclareLaunchArgument(name='use_sim_time', default_value='True',
                                            description='Flag to enable use_sim_time'),
```

Lastly, add `robot_localization_node,` above the `rviz_node` line to launch the robot localization node.

```
      robot_state_publisher_node,
      spawn_entity,
      robot_localization_node,
      rviz_node
])
```

Next, we need to add the `robot_localization` dependency to our package definition. Open `package.xml` and add the following line below the last `<exec_depend>` tag.

```
<exec_depend>robot_localization</exec_depend>
```

Lastly, open `CMakeLists.txt` and append the `config` directory inside the `install(DIRECTORY...)`, as shown in the snippet below.

```
install(
  DIRECTORY src launch rviz config
  DESTINATION share/${PROJECT_NAME}
)
```

###### Build, Run and Verification

Let us now build and run our package. Navigate to the root of the project and execute the following lines:

```
colcon build
. install/setup.bash
ros2 launch sam_bot_description display.launch.py
```

Gazebo and RVIZ should launch. In the RVIZ window, you should see the model and TF frames of `sam_bot`:

[![../../_images/rviz.png](../../_images/rviz.png)](../../_images/rviz.png)

Next, let us verify that the `odometry/filtered`, `accel/filtered`, and `/tf` topics are active in the system. Open a new terminal and execute:

```
ros2 topic list
```

You should see `odometry/filtered`, `accel/filtered`, and `/tf` in the list of the topics.

You can also check the subscriber count of these topics again by executing:

```
ros2 topic info /demo/imu
ros2 topic info /demo/odom
```

You should see that `/demo/imu` and `/demo/odom` now both have 1 subscriber each.

To verify that the `ekf_filter_node` are the subscribers of these topics, execute:

```
ros2 node info /ekf_filter_node
```

You should see an output as shown below.

```
/ekf_filter_node
Subscribers:
  /demo/imu: sensor_msgs/msg/Imu
  /demo/odom: nav_msgs/msg/Odometry
  /parameter_events: rcl_interfaces/msg/ParameterEvent
  /set_pose: geometry_msgs/msg/PoseWithCovarianceStamped
Publishers:
  /accel/filtered: geometry_msgs/msg/AccelWithCovarianceStamped
  /diagnostics: diagnostic_msgs/msg/DiagnosticArray
  /odometry/filtered: nav_msgs/msg/Odometry
  /parameter_events: rcl_interfaces/msg/ParameterEvent
  /rosout: rcl_interfaces/msg/Log
  /tf: tf2_msgs/msg/TFMessage
Service Servers:
   ...
```

From the output above, we can see that the `ekf_filter_node` is subscribed to `/demo/imu` and `/demo/odom`. We can also see that the `ekf_filter_node` publishes on the `odometry/filtered`, `accel/filtered`, and `/tf` topics.

You may also verify that `robot_localization` is publishing the `odom` => `base_link` transform by using the tf2\_echo utility. Run the following command in a separate command line terminal:

```
ros2 run tf2_ros tf2_echo odom base_link
```

You should see a continuous output similar to what is shown below.

```
At time 8.842000000
- Translation: [0.003, -0.000, 0.127]
- Rotation: in Quaternion [-0.000, 0.092, 0.003, 0.996]
At time 9.842000000
- Translation: [0.002, -0.000, 0.127]
- Rotation: in Quaternion [-0.000, 0.092, 0.003, 0.996]
```

###### Conclusion

In this guide we have discussed how multiple odometry sensors can be used to provide a filtered and smoothed odometry using `robot_localization`. We have also checked if the `odom` => `base_link` transform is being published correctly by `robot_localization`.

---

### Sdf

#### Setting Up The SDF - Gazebo

*Source: [https://docs.nav2.org/setup_guides/sdf/setup_sdf.html](https://docs.nav2.org/setup_guides/sdf/setup_sdf.html)*

##### Setting Up The SDF - Gazebo

For this guide, we will be creating the SDF (Simulation Description Format) file for a simple differential drive robot to give you hands-on experience on building an SDF file for Gazebo simulation.

See also

The complete source code in this tutorial can be found in [navigation2\_tutorials](https://github.com/ros-navigation/navigation2_tutorials/tree/master/sam_bot_description) repository under the `sam_bot_description` package. Note that the repository contains the full code after accomplishing all the tutorials in this guide.

###### About SDF

SDF is a file format for simulators, like Gazebo, that describes the simulator environment, models (including its links, connections, and physics simulator metadata), and appropriate plugins. The SDF that we will make is for modern Gazebo, but there are other simulator options such as Open3D Engine or Isaac Sim.

We can also use our SDF with the robot\_state\_publisher using the following package. You will see how to do this in the tutorial below.

```
sudo apt install ros-<ros2-distro>-sdformat-urdf
```

This package contains a C++ library and urdf\_parser\_plugin for converting SDFormat XML into URDF C++ structures. Installing it allows one to use SDFormat XML instead of URDF XML as a robot description.

See also

If you want to learn more about the SDF and sdformat\_urdf, we encourage you to have a look at the official [SDFormat Website](http://sdformat.org/) and the [sdformat\_urdf GitHub repository](https://github.com/ros/sdformat_urdf/tree/rolling/sdformat_urdf)

###### Writing the SDF

For now the SDF will pretty much be a copy of the URDF code converted into SDFormat. Changes between the two descriptions will happen when we start adding various plugins and sensors in the next tutorials. We also add in physical properties needed by the simulator such as the ineria, mass, and material.

Here is the SDF version of the URDF code:

```
<?xml version="1.0" ?>
<sdf version="1.8" xmlns:xacro="http://ros.org/wiki/xacro">
  <model name='sam_bot' canonical_link='base_link'>

    <!-- Define robot constants -->
    <xacro:property name="base_width" value="0.31"/>
    <xacro:property name="base_length" value="0.42"/>
    <xacro:property name="base_height" value="0.18"/>

    <xacro:property name="wheel_radius" value="0.10"/>
    <xacro:property name="wheel_width" value="0.04"/>
    <xacro:property name="wheel_ygap" value="0.025"/>
    <xacro:property name="wheel_zoff" value="0.05"/>
    <xacro:property name="wheel_xoff" value="0.12"/>

    <xacro:property name="caster_xoff" value="0.14"/>

    <!-- Define some commonly used inertial properties  -->
    <xacro:macro name="box_inertia" params="m w h d">
      <inertial>
        <pose>0 0 0 ${pi/2} 0 ${pi/2}</pose>
        <mass>${m}</mass>
        <inertia>
          <ixx>${(m/12) * (h*h + d*d)}</ixx>
          <ixy>0.0</ixy>
          <ixz>0.0</ixz>
          <iyy>${(m/12) * (w*w + d*d)}</iyy>
          <iyz>0.0</iyz>
          <izz>${(m/12) * (w*w + h*h)}</izz>
        </inertia>
      </inertial>
    </xacro:macro>

    <xacro:macro name="cylinder_inertia" params="m r h">
      <inertial>
        <pose>0 0 0 ${pi/2} 0 0</pose>
        <mass>${m}</mass>
        <inertia>
          <ixx>${(m/12) * (3*r*r + h*h)}</ixx>
          <ixy>0.0</ixy>
          <ixz>0.0</ixz>
          <iyy>${(m/12) * (3*r*r + h*h)}</iyy>
          <iyz>0.0</iyz>
          <izz>${(m/2) * (r*r)}</izz>
        </inertia>
      </inertial>
    </xacro:macro>


    <xacro:macro name="sphere_inertia" params="m r">
      <inertial>
        <mass>${m}</mass>
        <inertia>
          <ixx>${(2/5) * m * (r*r)}</ixx>
          <ixy>0.0</ixy>
          <ixz>0.0</ixz>
          <iyy>${(2/5) * m * (r*r)}</iyy>
          <iyz>0.0</iyz>
          <izz>${(2/5) * m * (r*r)}</izz>
        </inertia>
      </inertial>
    </xacro:macro>

    <!-- Robot Base -->
    <link name='base_link'>
      <must_be_base_link>true</must_be_base_link>
      <visual name="base_link_visual">
        <geometry>
          <box><size>
            ${base_length} ${base_width} ${base_height}
          </size></box>
        </geometry>
        <material>
          <ambient>0 1 1 1</ambient>
          <diffuse>0 1 1 1</diffuse>
        </material>
      </visual>

      <collision name="base_link_collision">
        <geometry>
          <box><size>
            ${base_length} ${base_width} ${base_height}
          </size></box>
        </geometry>
      </collision>
    </link>

    <!-- Robot Footprint -->
    <link name='base_footprint'>
      <pose relative_to="base_joint"/>
      <xacro:box_inertia m="15" w="${base_width}" d="${base_length}" h="${base_height}"/>
    </link>

    <joint name='base_joint' type='fixed'>
      <parent>base_link</parent>
      <child>base_footprint</child>
      <pose relative_to="base_link">0.0 0.0 ${-(wheel_radius+wheel_zoff)} 0 0 0</pose>
    </joint>


    <!-- Wheels -->
    <xacro:macro name="wheel" params="prefix x_reflect y_reflect">
      <link name="${prefix}_link">
        <pose relative_to="${prefix}_joint"/>

        <visual name="${prefix}_link_visual">
          <pose relative_to="${prefix}_link">0 0 0 ${pi/2} 0 0</pose>
          <geometry>
            <cylinder>
              <radius>${wheel_radius}</radius>
              <length>${wheel_width}</length>
            </cylinder>
          </geometry>
          <material>
            <ambient>0.3 0.3 0.3 1.0</ambient>
            <diffuse>0.7 0.7 0.7 1.0</diffuse>
          </material>
        </visual>

        <collision name="${prefix}_link_collision">
          <pose relative_to="${prefix}_link">0 0 0 ${pi/2} 0 0</pose>
          <geometry>
            <cylinder>
              <radius>${wheel_radius}</radius>
              <length>${wheel_width}</length>
            </cylinder>
          </geometry>
        </collision>

        <xacro:cylinder_inertia m="0.5" r="${wheel_radius}" h="${wheel_width}"/>
      </link>

      <joint name="${prefix}_joint" type="revolute">
        <parent>base_link</parent>
        <child>${prefix}_link</child>
        <pose relative_to="base_link">${x_reflect*wheel_xoff} ${y_reflect*(base_width/2+wheel_ygap)} ${-wheel_zoff} 0 0 0</pose>
        <axis>
          <xyz>0 1 0</xyz>
          <limit>
            <lower>-inf</lower>
            <upper>inf</upper>
          </limit>
        </axis>
      </joint>
    </xacro:macro>

    <xacro:wheel prefix="drivewhl_l" x_reflect="-1" y_reflect="1" />
    <xacro:wheel prefix="drivewhl_r" x_reflect="-1" y_reflect="-1" />

    <link name="front_caster">
      <pose relative_to="caster_joint"/>

      <visual name="front_caster_visual">
        <geometry>
          <sphere>
            <radius>${(wheel_radius+wheel_zoff-(base_height/2))}</radius>
          </sphere>
        </geometry>
        <material>
          <ambient>0 1 1 1</ambient>
          <diffuse>0 1 1 1</diffuse>
        </material>
      </visual>

      <collision name="front_caster_collision">
        <geometry>
          <sphere>
            <radius>${(wheel_radius+wheel_zoff-(base_height/2))}</radius>
          </sphere>
        </geometry>
      </collision>

      <xacro:sphere_inertia m="0.5" r="${(wheel_radius+wheel_zoff-(base_height/2))}"/>
    </link>

    <joint name="caster_joint" type="fixed">
      <parent>base_link</parent>
      <child>front_caster</child>
      <pose relative_to="base_link">${caster_xoff} 0.0 ${-(base_height/2)} 0 0 0</pose>
    </joint>
  </model>
</sdf>
```

###### Build and Launch

Change the `default_model_path` in `display.launch.py` to reference the SDF description instead of the URDF one.

```
default_model_path = os.path.join(pkg_share, 'src', 'description', 'sam_bot_description.sdf')
```

Now build and source your package and launch `display.launch.py`:

```
colcon build --symlink-install
source install/setup.bash
ros2 launch sam_bot_description display.launch.py
```

Note

You may get a warning like `[kdl_parser]: The root link base_link has an inertia specified in the URDF, but KDL does not support a root link with an inertia. As a workaround, you can add an extra dummy link to your URDF.` This warning can be safely ignored as it is just a quirk of the conversion from SDF to URDF.

![../../_images/base-bot_3.png](../../_images/base-bot_3.png)

###### Conclusion

And that’s it. In this tutorial, you have successfully created a SDF for a simple differential drive robot. You have also set up a ROS 2 project that launches a robot publisher node, which then uses your SDF to publish the robot’s transforms. We have also used RViz to visualize our robot to verify whether our SDF is correct.

---

### Sensors

#### Mapping and Localization

*Source: [https://docs.nav2.org/setup_guides/sensors/mapping_localization.html](https://docs.nav2.org/setup_guides/sensors/mapping_localization.html)*

##### Mapping and Localization

Now that we have a robot with its sensors set up, we can use the obtained sensor information to build a map of the environment and to localize the robot on the map. The `slam_toolbox` package is a set of tools and capabilities for 2D Simultaneous Localization and Mapping (SLAM) in potentially massive maps with ROS2. It is also one of the officially supported SLAM libraries in Nav2, and we recommend to use this package in situations you need to use SLAM on your robot setup. Aside from the `slam_toolbox`, localization can also be implemented through the `nav2_amcl` package. This package implements Adaptive Monte Carlo Localization (AMCL) which estimates the position and orientation of the robot in a map. Other techniques may also be available, please check Nav2 documentation for more information.

Both the `slam_toolbox` and `nav2_amcl` use information from the laser scan sensor to be able to perceive the robot’s environment. Hence, to verify that they can access the laser scan sensor readings, we must make sure that they are subscribed to the correct topic that publishes the `sensor_msgs/LaserScan` message. This can be configured by setting their `scan_topic` parameters to the topic that publishes that message. It is a convention to publish the `sensor_msgs/LaserScan` messages to `/scan` topic. Thus, by default, the `scan_topic` parameter is set to `/scan`. Recall that when we added the lidar sensor to `sam_bot` in the previous section, we set the topic to which the lidar sensor will publish the `sensor_msgs/LaserScan` messages as `/scan`.

In-depth discussions on the complete configuration parameters will not be a scope of our tutorials since they can be pretty complex. Instead, we recommend you to have a look at their official documentation in the links below.

See also

For the complete list of configuration parameters of `slam_toolbox`, see the [Github repository of slam\_toolbox](https://github.com/SteveMacenski/slam_toolbox#readme).

For the complete list of configuration parameters and example configuration of `nav2_amcl`, see the [AMCL Configuration Guide](https://docs.nav2.org/configuration/packages/configuring-amcl.html).

You can also refer to the [(SLAM) Navigating While Mapping guide](https://docs.nav2.org/tutorials/docs/navigation2_with_slam.html) for the tutorial on how to use Nav2 with SLAM. You can verify that `slam_toolbox` and `nav2_amcl` have been correctly setup by visualizing the map and the robot’s pose in RViz, similar to what was shown in the previous section.

###### Costmap 2D

The costmap 2D package makes use of the sensor information to provide a representation of the robot’s environment in the form of an occupancy grid. The cells in the occupancy grid store cost values between 0-254 which denote a cost to travel through these zones. A cost of 0 means the cell is free while a cost of 254 means that the cell is lethally occupied. Values in between these extremes are used by navigation algorithms to steer your robot away from obstacles as a potential field. Costmaps in Nav2 are implemented through the `nav2_costmap_2d` package.

The costmap implementation consists of multiple layers, each of which has a certain function that contributes to a cell’s overall cost. The package consists of the following layers, but are plugin-based to allow customization and new layers to be used as well: static layer, inflation layer, range layer, obstacle layer, and voxel layer. The static layer represents the map section of the costmap, obtained from the messages published to the `/map` topic like those produced by SLAM. The obstacle layer includes the objects detected by sensors that publish either or both the `LaserScan` and `PointCloud2` messages. The voxel layer is similar to the obstacle layer such that it can use either or both the `LaserScan` and `PointCloud2` sensor information but handles 3D data instead. The range layer allows for the inclusion of information provided by sonar and infrared sensors. Lastly, the inflation layer represents the added cost values around lethal obstacles such that our robot avoids navigating into obstacles due to the robot’s geometry. In the next subsection of this tutorial, we will have some discussion about the basic configuration of the different layers in `nav2_costmap_2d`.

The layers are integrated into the costmap through a plugin interface and then inflated using a user-specified [inflation radius](http://wiki.ros.org/costmap_2d/hydro/inflation), if the inflation layer is enabled. For a deeper discussion on costmap concepts, you can have a look at the [ROS1 costmap\_2D documentation](http://wiki.ros.org/costmap_2d). Note that the `nav2_costmap_2d` package is mostly a straightforward ROS2 port of the ROS1 navigation stack version with minor changes required for ROS2 support and some new layer plugins.

###### Configuring nav2\_costmap\_2d

In this subsection, we will show an example configuration of `nav2_costmap_2d` such that it uses the information provided by the lidar sensor of `sam_bot`. We will show an example configuration that uses static layer, obstacle layer, voxel layer, and inflation layer. We set both the obstacle and voxel layer to use the `LaserScan` messages published to the `/scan` topic by the lidar sensor. We also set some of the basic parameters to define how the detected obstacles are reflected in the costmap. Note that this configuration is to be included in the configuration file of Nav2.

```
 1global_costmap:
 2  global_costmap:
 3    ros__parameters:
 4      update_frequency: 1.0
 5      publish_frequency: 1.0
 6      global_frame: map
 7      robot_base_frame: base_link
 8      robot_radius: 0.22
 9      resolution: 0.05
10      track_unknown_space: false
11      rolling_window: false
12      plugins: ["static_layer", "obstacle_layer", "inflation_layer"]
13      static_layer:
14        plugin: "nav2_costmap_2d::StaticLayer"
15        map_subscribe_transient_local: True
16      obstacle_layer:
17        plugin: "nav2_costmap_2d::ObstacleLayer"
18        enabled: True
19        observation_sources: scan
20        scan:
21          topic: /scan
22          max_obstacle_height: 2.0
23          clearing: True
24          marking: True
25          data_type: "LaserScan"
26          raytrace_max_range: 3.0
27          raytrace_min_range: 0.0
28          obstacle_max_range: 2.5
29          obstacle_min_range: 0.0
30      inflation_layer:
31        plugin: "nav2_costmap_2d::InflationLayer"
32        cost_scaling_factor: 3.0
33        inflation_radius: 0.55
34      always_send_full_costmap: True
35
36local_costmap:
37  local_costmap:
38    ros__parameters:
39      update_frequency: 5.0
40      publish_frequency: 2.0
41      global_frame: odom
42      robot_base_frame: base_link
43      rolling_window: true
44      width: 3
45      height: 3
46      resolution: 0.05
47      robot_radius: 0.22
48      plugins: ["voxel_layer", "inflation_layer"]
49      voxel_layer:
50        plugin: "nav2_costmap_2d::VoxelLayer"
51        enabled: True
52        publish_voxel_map: True
53        origin_z: 0.0
54        z_resolution: 0.05
55        z_voxels: 16
56        max_obstacle_height: 2.0
57        mark_threshold: 0
58        observation_sources: scan
59        scan:
60          topic: /scan
61          max_obstacle_height: 2.0
62          clearing: True
63          marking: True
64          data_type: "LaserScan"
65      inflation_layer:
66        plugin: "nav2_costmap_2d::InflationLayer"
67        cost_scaling_factor: 3.0
68        inflation_radius: 0.55
69      always_send_full_costmap: True
```

In the configuration above, notice that we set the parameters for two different costmaps: `global_costmap` and `local_costmap`. We set up two costmaps since the `global_costmap` is mainly used for long-term planning over the whole map while `local_costmap` is for short-term planning and collision avoidance.

The layers that we use for our configuration are defined in the `plugins` parameter, as shown in line 13 for the `global_costmap` and line 50 for the `local_costmap`. These values are set as a list of mapped layer names that also serve as namespaces for the layer parameters we set up starting at lines 14 and line 51. Note that each layer/namespace in this list must have a `plugin` parameter (as indicated in lines 15, 18, 32, 52, and 68) defining the type of plugin to be loaded for that specific layer.

For the static layer (lines 14-16), we set the `map_subscribe_transient_local` parameter to `True`. This sets the QoS settings for the map topic. Another important parameter for the static layer is the `map_topic` which defines the map topic to subscribe to. This defaults to `/map` topic when not defined.

For the obstacle layer (lines 17-30), we define its sensor source under the `observation_sources` parameter (line 20) as `scan` whose parameters are set up in lines 22-30. We set its `topic` parameter as the topic that publishes the defined sensor source and we set the `data_type` according to the sensor source it will use. In our configuration, the obstacle layer will use the `LaserScan` published by the lidar sensor to `/scan`.

Note that the obstacle layer and voxel layer can use either or both `LaserScan` and `PointCloud2` as their `data_type` but it is set to `LaserScan` by default. The code snippet below shows an example of using both the `LaserScan` and `PointCloud2` as the sensor sources. This may be particularly useful when setting up your own physical robot.

```
obstacle_layer:
  plugin: "nav2_costmap_2d::ObstacleLayer"
  enabled: True
  observation_sources: scan pointcloud
  scan:
    topic: /scan
    data_type: "LaserScan"
  pointcloud:
    topic: /depth_camera/points
    data_type: "PointCloud2"
```

For the other parameters of the obstacle layer, the `max_obstacle_height` parameter sets the maximum height of the sensor reading to return to the occupancy grid. The minimum height of the sensor reading can also be set using the `min_obstacle_height` parameter, which defaults to 0 since we did not set it in the configuration. The `clearing` parameter is used to set whether the obstacle is to be removed from the costmap or not. The clearing operation is done by raytracing through the grid. The maximum and minimum range to raytrace clear objects from the costmap is set using the `raytrace_max_range` and `raytrace_min_range` respectively. The `marking` parameter is used to set whether the inserted obstacle is marked into the costmap or not. We also set the maximum and minimum range to mark obstacles in the costmap through the `obstacle_max_range` and `obstacle_min_range` respectively.

For the inflation layer (lines 31-34 and 67-70), we set the exponential decay factor across the inflation radius using the `cost_scaling_factor` parameter. The value of the radius to inflate around lethal obstacles is defined using the `inflation_radius`.

For the voxel layer (lines 51-66), we set the `publish_voxel_map` parameter to `True` to enable the publishing of the 3D voxel grid. The resolution of the voxels in height is defined using the `z_resolution` parameter, while the number of voxels in each column is defined using the `z_voxels` parameter. The `mark_threshold` parameter sets the minimum number of voxels in a column to mark as occupied in the occupancy grid. We set the `observation_sources` parameter of the voxel layer to `scan`, and we set the scan parameters (in lines 61-66) similar to the parameters that we have discussed for the obstacle layer. As defined in its `topic` and `data_type` parameters, the voxel layer will use the `LaserScan` published on the `/scan` topic by the lidar scanner.

Note that the we are not using a range layer for our configuration but it may be useful for your own robot setup. For the range layer, its basic parameters are the `topics`, `input_sensor_type`, and `clear_on_max_reading` parameters. The range topics to subscribe to are defined in the `topics` parameter. The `input_sensor_type` is set to either `ALL`, `VARIABLE`, or `FIXED`. The `clear_on_max_reading` is a boolean parameter that sets whether to clear the sensor readings on max range. Have a look at the configuration guide in the link below in case you need to set it up.

See also

For more information on `nav2_costmap_2d` and the complete list of layer plugin parameters, see the [Costmap 2D Configuration Guide](https://docs.nav2.org/configuration/packages/configuring-costmaps.html).

###### Build, Run and Verification

We will first launch `display.launch.py` which launches the robot state publisher that provides the `base_link` => `sensors` transformations in our URDF, launches Gazebo that acts as our physics simulator, and provides the `odom` => `base_link` from the differential drive plugin or the ekf\_node. It also launches RViz which we can use to visualize the robot and sensor information.

Then we will launch `slam_toolbox` to publish to `/map` topic and provide the `map` => `odom` transform. Recall that the `map` => `odom` transform is one of the primary requirements of the Nav2 system. The messages published on the `/map` topic will then be used by the static layer of the `global_costmap`.

After we have properly setup our robot description, odometry sensors, and necessary transforms, we will finally launch the Nav2 system itself. For now, we will only be exploring the costmap generation system of Nav2. After launching Nav2, we will visualize the costmaps in RViz to confirm our output.

###### Launching Description Nodes, RViz and Gazebo

Let us now launch our Robot Description Nodes, RViz and Gazebo through the launch file `display.launch.py`. Open a new terminal and execute the lines below.

```
colcon build
. install/setup.bash
ros2 launch sam_bot_description display.launch.py
```

RViz and the Gazebo should now be launched with `sam_bot` present in both. Recall that the `base_link` => `sensors` transform is now being published by `robot_state_publisher` and the `odom` => `base_link` transform by our Gazebo plugins. Both transforms should now be displayed show without errors in RViz.

###### Launching slam\_toolbox

To be able to launch `slam_toolbox`, make sure that you have installed the `slam_toolbox` package by executing the following command:

```
sudo apt install ros-<ros2-distro>-slam-toolbox
```

We will launch the `async_slam_toolbox_node` of `slam_toolbox` using the package’s built-in launch files. Open a new terminal and then execute the following lines:

```
ros2 launch slam_toolbox online_async_launch.py use_sim_time:=true
```

The `slam_toolbox` should now be publishing to the `/map` topic and providing the `map` => `odom` transform.

We can verify in RViz that the `/map` topic is being published. In the RViz window, click the add button at the bottom-left part then go to `By topic` tab then select the `Map` under the `/map` topic. You should be able to visualize the message received in the `/map` as shown in the image below.

![../../_images/map.png](../../_images/map.png)

We can also check that the transforms are correct by executing the following lines in a new terminal:

```
ros2 run tf2_tools view_frames
```

The line above will create a `frames.pdf` file that shows the current transform tree. Your transform tree should be similar to the one shown below:

![../../_images/view_frames.png](../../_images/view_frames.png)

###### Launching Nav2

First, Make sure you have installed the Nav2 packages by executing the following:

```
sudo apt install ros-<ros2-distro>-navigation2
sudo apt install ros-<ros2-distro>-nav2-bringup
```

We will now launch Nav2 using the `nav2_bringup`’s built-in launch file, `navigation_launch.py` . Open a new terminal and execute the following:

```
ros2 launch nav2_bringup navigation_launch.py use_sim_time:=true
```

Note that the parameters of the `nav2_costmap_2d` that we discussed in the previous subsection are included in the default parameters of `navigation_launch.py`. Aside from the `nav2_costmap_2d` parameters, it also contains parameters for the other nodes that are included in Nav2 implementation.

After we have properly set up and launched Nav2, the `/global_costmap` and `/local_costmap` topics should now be active.

Note

To make the costmaps show up, run the 3 commands in this order

1. Launching Description Nodes, RViz and Gazebo - wait a bit for everything to launch
2. Launching slam\_toolbox - in logs wait for “Registering sensor”
3. Launching Nav2 - in logs wait for “Creating bond timer”

###### Visualizing Costmaps in RViz

The `global_costmap`, `local_costmap` and the voxel representation of the detected obstacles can be visualized in RViz.

To visualize the `global_costmap` in RViz, click the add button at the bottom-left part of the RViz window. Go to `By topic` tab then select the `Map` under the `/global_costmap/costmap` topic. The `global_costmap` should show in the RViz window, as shown below. The `global_costmap` shows areas which should be avoided (black) by our robot when it navigates our simulated world in Gazebo.

![../../_images/costmap_global_rviz.png](../../_images/costmap_global_rviz.png)

To visualize the `local_costmap` in RViz, select the `Map` under the `/local_costmap/costmap` topic. Set the `color scheme` in RViz to `costmap` to make it appear similar to the image below.

![../../_images/local_costmap_rviz.png](../../_images/local_costmap_rviz.png)

To visualize the voxel representation of the detected object, open a new terminal and execute the following lines:

```
ros2 run nav2_costmap_2d nav2_costmap_2d_markers voxel_grid:=/local_costmap/voxel_grid visualization_marker:=/my_marker
```

The line above sets the topic where the the markers will be published to `/my_marker`. To see the markers in RViz, select `Marker` under the `/my_marker` topic, as shown below.

[![../../_images/add_my_marker.png](../../_images/add_my_marker.png)](../../_images/add_my_marker.png)

Then set the `fixed frame` in RViz to `odom` and you should now see the voxels in RViz, which represent the cube and the sphere that we have in the Gazebo world:

![../../_images/voxel_layer.png](../../_images/voxel_layer.png)

###### Conclusion

In this section of our robot setup guide, we have discussed the importance of sensor information for different tasks associated with Nav2. More specifically, tasks such as mapping (SLAM), localization (AMCL), and perception (costmap) tasks.
Then, we set up a basic configuration for the `nav2_costmap_2d` package using different layers to produce a global and local costmap. We then verify our work by visualizing these costmaps in RViz.

---

#### Setting Up Sensors - Gazebo

*Source: [https://docs.nav2.org/setup_guides/sensors/setup_sensors_gz.html](https://docs.nav2.org/setup_guides/sensors/setup_sensors_gz.html)*

##### Setting Up Sensors - Gazebo

In this guide, we will discuss the importance of the sensors in navigating a robot safely and how to set up the sensors with Nav2. In the first half of this tutorial, we will take a brief look at commonly used sensors and common sensor messages in Nav2. Next, we will add a basic sensor setup on our previously built simulated robot, `sam_bot`. Lastly, we will then verify the simulated sensor messages of `sam_bot` by visualizing them in RViz.

Once sensors have been set up on a robot, their readings can be used in mapping, localization, and perception tasks. In the second half of this guide, we will first discuss how mapping and localization use the sensor data. Then, we will also take a look at one of Nav2’s packages, `nav2_costmap_2d`, which generates costmaps that will eventually be used in Nav2 path planning. We will set up basic configuration parameters for this package so it properly takes in sensor information from `sam_bot`. Lastly, we visualize a generated costmaps in RViz to verify its received data.

###### Sensor Introduction

Mobile robots are equipped with a multitude of sensors that allow them to see and perceive their environment. These sensors obtain information which can be used to build and maintain the map of the environment, to localize the robot on the map, and to see the obstacles in the environment. These tasks are essential to be able to safely and efficiently navigate a robot through a dynamic environment.

Examples of commonly used sensors are lidar, radar, RGB camera, depth camera, IMU, and GPS. To standardize the message formats of these sensors and allow for easier interoperation between vendors, ROS provides the `sensor_msgs` package that defines the common sensor interfaces. This also allows users to use any sensor vendor as long as it follows the standard format in `sensor_msgs`. In the next subsection, we introduce some of commonly used messages in navigation, namely the `sensor_msgs/LaserScan`, `sensor_msgs/PointCloud2`, `sensor_msgs/Range`, and `sensor_msgs/Image`.

Aside from the `sensor_msgs` package, there are also the `radar_msgs` and `vision_msgs` standard interfaces you should be aware of. The `radar_msgs` defines the messages for radar-specific sensors while the `vision_msgs` package defines the messages used in computer vision such as object detection, segmentation, and other machine learning models. Messages supported by this package are `vision_msgs/Classification2D`, `vision_msgs/Classification3D`, `vision_msgs/Detection2D`, and `vision_msgs/Detection3D`, to name a few.

See also

For more information, see the API documentation of [sensor\_msgs](http://wiki.ros.org/sensor_msgs), [radar\_msgs](http://wiki.ros.org/radar_msgs), and [vision\_msgs](http://wiki.ros.org/vision_msgs).

Your physical robot’s sensors probably have ROS drivers written for them (e.g. a ROS node that connects to the sensors, populates data into messages, and publishes them for your robot to use) that follow the standard interface in the `sensor_msgs` package. The `sensor_msgs` package makes it easy for you to use many different sensors from different manufacturers. General software packages like Nav2 can then read these standardized messages and perform tasks independent of the sensor hardware. On simulated robots such as `sam_bot`, Gazebo has sensor plugins which also publish their information following the `sensor_msgs` package.

###### Common Sensor Messages

In this subsection, we discuss some of the common types of `sensor_msgs` you might encounter when setting up Nav2. We will provide a brief description for each sensor, an image of it being simulated in Gazebo and the corresponding visualization of the sensor readings in RViz.

Note

There are other types of `sensor_msgs` aside from the ones listed below. The complete list of messages and their definitions can be found in the [sensor\_msgs documentation](http://wiki.ros.org/sensor_msgs).

###### sensor\_msgs/LaserScan

This message represents a single scan from a planar laser range-finder. This message is used in `slam_toolbox` and `nav2_amcl` for localization and mapping, or in `nav2_costmap_2d` for perception.

![../../_images/sensor_laserscan.png](../../_images/sensor_laserscan.png)

###### sensor\_msgs/PointCloud2

This message holds a collection of 3D points, plus optional additional information about each point. This can be from a 3D lidar, a 2D lidar, a depth camera or more.

![../../_images/sensor_pointcloud2.png](../../_images/sensor_pointcloud2.png)

###### sensor\_msgs/Range

This is a single range reading from an active ranger that emits energy and reports one range reading that is valid along an arc at the distance measured. A sonar, IR sensor, or 1D range finder are examples of sensors that use this message.

![../../_images/sensor_range.png](../../_images/sensor_range.png)

###### sensor\_msgs/Image

This represents the sensor readings from RGB or depth camera, corresponding to RGB or range values.

![../../_images/sensor_image.png](../../_images/sensor_image.png)

###### Simulating Sensors using Gazebo

To give you a better grasp of how to set up sensors on a simulated robot, we will build up on our previous tutorials and attach sensors to our simulated robot `sam_bot`. Similar to the previous tutorial where we used Gazebo plugins to add odometry sensors to `sam_bot`, we will be using the Gazebo plugins to simulate a lidar sensor and a depth camera on `sam_bot`. If you are working with a real robot, most of these steps are still required for setting up your URDF frames and it will not hurt to also add in the gazebo plugins for later use.

To be able to follow the rest of this section, make sure that you have properly installed Gazebo. You can follow the instructions at the [Setup and Prerequisites](https://docs.nav2.org/setup_guides/odom/setup_odom_gz.html#setup-and-prerequisites) of the previous tutorial to setup Gazebo.

###### Adding Gazebo Plugins to a URDF or SDF

Let us first add a lidar sensor to `sam_bot`. In your URDF paste the following lines before the `</robot>` tag to just add the lidar’s link and joint.

```
<link name="lidar_link">
  <inertial>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <mass value="0.125"/>
    <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001" />
  </inertial>

  <collision>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <geometry>
      <cylinder radius="0.0508" length="0.055"/>
    </geometry>
  </collision>

  <visual>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <geometry>
      <cylinder radius="0.0508" length="0.055"/>
    </geometry>
  </visual>
</link>

<joint name="lidar_joint" type="fixed">
  <parent link="base_link"/>
  <child link="lidar_link"/>
  <origin xyz="0 0 0.12" rpy="0 0 0"/>
</joint>
```

In your SDF add the below before the `</model>` line to add the lidar’s link, joint, and Gazebo specific sensor information:

```
<joint name="lidar_joint" type="fixed">
  <parent>base_link</parent>
  <child>lidar_link</child>
  <pose relative_to="base_link">0.0 0.0 0.12 0 0 0</pose>
</joint>

<link name='lidar_link'>
  <pose relative_to="lidar_joint"/>
  <visual name="lidar_link_visual">
    <geometry>
      <cylinder>
        <radius>0.0508</radius>
        <length>0.055</length>
      </cylinder>
    </geometry>
  </visual>

  <collision name="lidar_link_collision">
    <geometry>
      <cylinder>
        <radius>0.0508</radius>
        <length>0.055</length>
      </cylinder>
    </geometry>
  </collision>

  <xacro:cylinder_inertia m="0.125" r="0.0508" h="0.055"/>

  <sensor name="lidar" type="gpu_lidar">
    <always_on>true</always_on>
    <visualize>true</visualize>
    <update_rate>5</update_rate>
    <topic>scan</topic>
    <gz_frame_id>lidar_link</gz_frame_id>
    <lidar>
      <scan>
        <horizontal>
          <samples>360</samples>
          <resolution>1.000000</resolution>
          <min_angle>0.000000</min_angle>
          <max_angle>6.280000</max_angle>
        </horizontal>
      </scan>
      <range>
        <min>0.120000</min>
        <max>3.5</max>
        <resolution>0.015000</resolution>
      </range>
      <noise>
        <type>gaussian</type>
        <mean>0.0</mean>
        <stddev>0.01</stddev>
      </noise>
    </lidar>
  </sensor>
</link>
```

In the code snippet above we set the sensor values of lidar\_link to the simulated lidar’s scan and range properties and set `/scan` as the topic to which it will publish the `sensor_msgs/LaserScan` messages.

Next, let us add a depth camera to `sam_bot`. In your URDF paste the following lines after the `</joint>` tag of the lidar sensor to just add the camera’s link and joint.

```
<link name="camera_link">
  <visual>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <geometry>
      <box size="0.015 0.130 0.022"/>
    </geometry>
  </visual>

  <collision>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <geometry>
      <box size="0.015 0.130 0.022"/>
    </geometry>
  </collision>

  <inertial>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <mass value="0.035"/>
    <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001" />
  </inertial>
</link>

<joint name="camera_joint" type="fixed">
  <parent link="base_link"/>
  <child link="camera_link"/>
  <origin xyz="0.215 0 0.05" rpy="0 0 0"/>
</joint>
```

In your SDF, paste the following lines after the `</link>` tag of the lidar sensor to add the camera’s link, joint, and Gazebo specific sensor information:

```
<joint name="camera_joint" type="fixed">
  <parent>base_link</parent>
  <child>camera_link</child>
  <pose relative_to="base_link">0.215 0 0.05 0 0 0</pose>
</joint>

<link name='camera_link'>
  <pose relative_to="camera_joint"/>
  <visual name="camera_link_visual">
    <geometry>
      <box><size>
        0.015 0.130 0.0222
      </size></box>
    </geometry>
  </visual>

  <collision name="camera_link_collision">
    <geometry>
      <box><size>
        0.015 0.130 0.0222
      </size></box>
    </geometry>
  </collision>

  <xacro:box_inertia m="0.035" w="0.015" d="0.130" h="0.0222"/>

  <sensor name="depth_camera" type="rgbd_camera">
    <always_on>true</always_on>
    <visualize>true</visualize>
    <update_rate>5.0</update_rate>
    <topic>depth_camera</topic>
    <gz_frame_id>camera_link</gz_frame_id>
    <camera>
      <horizontal_fov>1.047198</horizontal_fov>
      <image>
        <width>640</width>
        <height>480</height>
      </image>
      <clip>
        <near>0.05</near>
        <far>3</far>
      </clip>
    </camera>
    <baseline>0.2</baseline>
    <pointCloudCutoff>0.5</pointCloudCutoff>
    <pointCloudCutoffMax>3.0</pointCloudCutoffMax>
    <distortionK1>0</distortionK1>
    <distortionK2>0</distortionK2>
    <distortionK3>0</distortionK3>
    <distortionT1>0</distortionT1>
    <distortionT2>0</distortionT2>
    <CxPrime>0</CxPrime>
    <Cx>0</Cx>
    <Cy>0</Cy>
    <focalLength>0</focalLength>
    <hackBaseline>0</hackBaseline>
  </sensor>
</link>
```

In the code snippet above we set the sensor values of camera\_link to the simulated depth camera’s properties and configure the sensor such that it will publish sensor\_msgs/Image and `sensor_msgs/PointCloud2` messages to /depth\_camera/image\_raw` and `/depth_camera/points` topics respectively.

###### Updating Bridge Config

We will also need to bridge the necessary sensor topics from Gazebo to ROS, add the following to your `bridge_config.yaml`:

```
- ros_topic_name: "/scan"
  gz_topic_name: "/scan"
  ros_type_name: "sensor_msgs/msg/LaserScan"
  gz_type_name: "gz.msgs.LaserScan"
  direction: GZ_TO_ROS

- ros_topic_name: "/scan/points"
  gz_topic_name: "/scan/points"
  ros_type_name: "sensor_msgs/msg/PointCloud2"
  gz_type_name: "gz.msgs.PointCloudPacked"
  direction: GZ_TO_ROS

- ros_topic_name: "/depth_camera/camera_info"
  gz_topic_name: "/depth_camera/camera_info"
  ros_type_name: "sensor_msgs/msg/CameraInfo"
  gz_type_name: "gz.msgs.CameraInfo"
  direction: GZ_TO_ROS

- ros_topic_name: "/depth_camera/points"
  gz_topic_name: "/depth_camera/points"
  ros_type_name: "sensor_msgs/msg/PointCloud2"
  gz_type_name: "gz.msgs.PointCloudPacked"
  direction: GZ_TO_ROS

 - ros_topic_name: "/depth_camera/image_raw"
   gz_topic_name: "/depth_camera/image"
   ros_type_name: "sensor_msgs/msg/Image"
   gz_type_name: "gz.msgs.Image"
   direction: GZ_TO_ROS
```

###### Build, Run and Verification

We can now build and run our project. Navigate to the root of the project and execute the following lines:

```
colcon build
. install/setup.bash
ros2 launch sam_bot_description display.launch.py
```

RViz and the Gazebo will then be launched with `sam_bot` present in both. In the Gazebo window, the world that we created should be launched and `sam_bot` should be spawned in that world. You should now be able to observe `sam_bot` with the 360 lidar sensor and the depth camera, as shown in the image below.

![../../_images/gazebo_sensors.png](../../_images/gazebo_sensors.png)

In the RViz window, we can verify if we have properly modeled our sensors and if the transforms of our newly added sensors are correct:

![../../_images/rviz_sensors.png](../../_images/rviz_sensors.png)

Lastly, we can also visualize the sensor readings in RViz. To visualize the `sensor_msgs/LaserScan` message published on `/scan` topic, click the add button at the bottom part of the RViz window. Then go to the `By topic` tab and select the `LaserScan` option under `/scan`, as shown below.

[![../../_images/add_topic_laserscan.png](../../_images/add_topic_laserscan.png)](../../_images/add_topic_laserscan.png)

Next, set the `Reliability Policy` in RViz to `Best Effort` and set the `size` to 0.1 to see the points clearer. You should see the visualized `LaserScan` detection as shown below. This corresponds to the detected cube and sphere that we added to the Gazebo world.

![../../_images/demo_laserscan_rviz.png](../../_images/demo_laserscan_rviz.png)

To visualize `sensor_msgs/Image` and `sensor_msgs/PointCloud2`, do the same for topics `/depth_camera/image_raw` and `/depth_camera/points` respectively:

![../../_images/add_topic_image_pointcloud2.png](../../_images/add_topic_image_pointcloud2.png)

After adding the `/depth_camera/image_raw` topic in RViz, set the `Reliability Policy` in RViz to `Best Effort`. Then you should see the cube in the image window at the lower-left side of the RViz window, as shown below.

![../../_images/demo_image_rviz.png](../../_images/demo_image_rviz.png)

You should also see the `sensor_msgs/PointCloud2`, as shown below.

![../../_images/pointcloud2_data.png](../../_images/pointcloud2_data.png)

###### Conclusion

In this section of our robot setup guide, we had a discussion on the common types of sensor messages in Nav2 which standardize the message formats for different sensor vendors. We also discussed how to add sensors to a simulated robot using Gazebo and how to verify that the sensors are working correctly through RViz.

---

#### Setting Up Sensors - Gazebo Classic

*Source: [https://docs.nav2.org/setup_guides/sensors/setup_sensors_gz_classic.html](https://docs.nav2.org/setup_guides/sensors/setup_sensors_gz_classic.html)*

##### Setting Up Sensors - Gazebo Classic

In this guide, we will discuss the importance of the sensors in navigating a robot safely and how to set up the sensors with Nav2. In the first half of this tutorial, we will take a brief look at commonly used sensors and common sensor messages in Nav2. Next, we will add a basic sensor setup on our previously built simulated robot, `sam_bot`. Lastly, we will then verify the simulated sensor messages of `sam_bot` by visualizing them in RViz.

Once sensors have been set up on a robot, their readings can be used in mapping, localization, and perception tasks. In the second half of this guide, we will first discuss how mapping and localization use the sensor data. Then, we will also take a look at one of Nav2’s packages, `nav2_costmap_2d`, which generates costmaps that will eventually be used in Nav2 path planning. We will set up basic configuration parameters for this package so it properly takes in sensor information from `sam_bot`. Lastly, we visualize a generated costmaps in RViz to verify its received data.

###### Sensor Introduction

Mobile robots are equipped with a multitude of sensors that allow them to see and perceive their environment. These sensors obtain information which can be used to build and maintain the map of the environment, to localize the robot on the map, and to see the obstacles in the environment. These tasks are essential to be able to safely and efficiently navigate a robot through a dynamic environment.

Examples of commonly used sensors are lidar, radar, RGB camera, depth camera, IMU, and GPS. To standardize the message formats of these sensors and allow for easier interoperation between vendors, ROS provides the `sensor_msgs` package that defines the common sensor interfaces. This also allows users to use any sensor vendor as long as it follows the standard format in `sensor_msgs`. In the next subsection, we introduce some of commonly used messages in navigation, namely the `sensor_msgs/LaserScan`, `sensor_msgs/PointCloud2`, `sensor_msgs/Range`, and `sensor_msgs/Image`.

Aside from the `sensor_msgs` package, there are also the `radar_msgs` and `vision_msgs` standard interfaces you should be aware of. The `radar_msgs` defines the messages for radar-specific sensors while the `vision_msgs` package defines the messages used in computer vision such as object detection, segmentation, and other machine learning models. Messages supported by this package are `vision_msgs/Classification2D`, `vision_msgs/Classification3D`, `vision_msgs/Detection2D`, and `vision_msgs/Detection3D`, to name a few.

See also

For more information, see the API documentation of [sensor\_msgs](http://wiki.ros.org/sensor_msgs), [radar\_msgs](http://wiki.ros.org/radar_msgs), and [vision\_msgs](http://wiki.ros.org/vision_msgs).

Your physical robot’s sensors probably have ROS drivers written for them (e.g. a ROS node that connects to the sensors, populates data into messages, and publishes them for your robot to use) that follow the standard interface in the `sensor_msgs` package. The `sensor_msgs` package makes it easy for you to use many different sensors from different manufacturers. General software packages like Nav2 can then read these standardized messages and perform tasks independent of the sensor hardware. On simulated robots such as `sam_bot`, Gazebo has sensor plugins which also publish their information following the `sensor_msgs` package.

###### Common Sensor Messages

In this subsection, we discuss some of the common types of `sensor_msgs` you might encounter when setting up Nav2. We will provide a brief description for each sensor, an image of it being simulated in Gazebo and the corresponding visualization of the sensor readings in RViz.

Note

There are other types of `sensor_msgs` aside from the ones listed below. The complete list of messages and their definitions can be found in the [sensor\_msgs documentation](http://wiki.ros.org/sensor_msgs).

###### sensor\_msgs/LaserScan

This message represents a single scan from a planar laser range-finder. This message is used in `slam_toolbox` and `nav2_amcl` for localization and mapping, or in `nav2_costmap_2d` for perception.

![../../_images/sensor_laserscan.png](../../_images/sensor_laserscan.png)

###### sensor\_msgs/PointCloud2

This message holds a collection of 3D points, plus optional additional information about each point. This can be from a 3D lidar, a 2D lidar, a depth camera or more.

![../../_images/sensor_pointcloud2.png](../../_images/sensor_pointcloud2.png)

###### sensor\_msgs/Range

This is a single range reading from an active ranger that emits energy and reports one range reading that is valid along an arc at the distance measured. A sonar, IR sensor, or 1D range finder are examples of sensors that use this message.

![../../_images/sensor_range.png](../../_images/sensor_range.png)

###### sensor\_msgs/Image

This represents the sensor readings from RGB or depth camera, corresponding to RGB or range values.

![../../_images/sensor_image.png](../../_images/sensor_image.png)

###### Simulating Sensors using Gazebo Classic

To give you a better grasp of how to set up sensors on a simulated robot, we will build up on our previous tutorials and attach sensors to our simulated robot `sam_bot`. Similar to the previous tutorial where we used Gazebo plugins to add odometry sensors to `sam_bot`, we will be using the Gazebo plugins to simulate a lidar sensor and a depth camera on `sam_bot`. If you are working with a real robot, most of these steps are still required for setting up your URDF frames and it will not hurt to also add in the gazebo plugins for later use.

To be able to follow the rest of this section, make sure that you have properly installed Gazebo. You can follow the instructions at the [Setup and Prerequisites](https://docs.nav2.org/setup_guides/odom/setup_odom_gz_classic.html#setup-and-prerequisites) of the previous tutorial to setup Gazebo.

###### Adding Gazebo Plugins to a URDF

Let us first add a lidar sensor to `sam_bot`. Open the URDF file, [src/description/sam\_bot\_description.urdf](https://github.com/ros-navigation/navigation2_tutorials/blob/humble/sam_bot_description/src/description/sam_bot_description.urdf) and paste the following lines before the `</robot>` tag.

```
251<link name="lidar_link">
252  <inertial>
253    <origin xyz="0 0 0" rpy="0 0 0"/>
254    <mass value="0.125"/>
255    <inertia ixx="0.001"  ixy="0"  ixz="0" iyy="0.001" iyz="0" izz="0.001" />
256  </inertial>
257
258  <collision>
259    <origin xyz="0 0 0" rpy="0 0 0"/>
260    <geometry>
261       <cylinder radius="0.0508" length="0.055"/>
262    </geometry>
263  </collision>
264
265  <visual>
266    <origin xyz="0 0 0" rpy="0 0 0"/>
267    <geometry>
268       <cylinder radius="0.0508" length="0.055"/>
269    </geometry>
270  </visual>
271</link>
272
273<joint name="lidar_joint" type="fixed">
274  <parent link="base_link"/>
275  <child link="lidar_link"/>
276  <origin xyz="0 0 0.12" rpy="0 0 0"/>
277</joint>
278
279<gazebo reference="lidar_link">
280  <sensor name="lidar" type="ray">
281    <always_on>true</always_on>
282    <visualize>true</visualize>
283    <update_rate>5</update_rate>
284    <ray>
285      <scan>
286        <horizontal>
287          <samples>360</samples>
288          <resolution>1.000000</resolution>
289          <min_angle>0.000000</min_angle>
290          <max_angle>6.280000</max_angle>
291        </horizontal>
292      </scan>
293      <range>
294        <min>0.120000</min>
295        <max>3.5</max>
296        <resolution>0.015000</resolution>
297      </range>
298      <noise>
299        <type>gaussian</type>
300        <mean>0.0</mean>
301        <stddev>0.01</stddev>
302      </noise>
303    </ray>
304    <plugin name="scan" filename="libgazebo_ros_ray_sensor.so">
305      <ros>
306        <remapping>~/out:=scan</remapping>
307      </ros>
308      <output_type>sensor_msgs/LaserScan</output_type>
309      <frame_name>lidar_link</frame_name>
310    </plugin>
311  </sensor>
312</gazebo>
```

In the code snippet above, we create a `lidar_link` which will be referenced by the `gazebo_ros_ray_sensor` plugin as the location to attach our sensor. We also set values to the simulated lidar’s scan and range properties. Lastly, we set the `/scan` as the topic to which it will publish the `sensor_msgs/LaserScan` messages.

Next, let us add a depth camera to `sam_bot`. Paste the following lines after the `</gazebo>` tag of the lidar sensor.

```
314<link name="camera_link">
315  <visual>
316    <origin xyz="0 0 0" rpy="0 0 0"/>
317    <geometry>
318      <box size="0.015 0.130 0.022"/>
319    </geometry>
320  </visual>
321
322  <collision>
323    <origin xyz="0 0 0" rpy="0 0 0"/>
324    <geometry>
325      <box size="0.015 0.130 0.022"/>
326    </geometry>
327  </collision>
328
329  <inertial>
330    <origin xyz="0 0 0" rpy="0 0 0"/>
331    <mass value="0.035"/>
332    <inertia ixx="0.001"  ixy="0"  ixz="0" iyy="0.001" iyz="0" izz="0.001" />
333  </inertial>
334</link>
335
336<joint name="camera_joint" type="fixed">
337  <parent link="base_link"/>
338  <child link="camera_link"/>
339  <origin xyz="0.215 0 0.05" rpy="0 0 0"/>
340</joint>
341
342<link name="camera_depth_frame"/>
343
344<joint name="camera_depth_joint" type="fixed">
345  <origin xyz="0 0 0" rpy="${-pi/2} 0 ${-pi/2}"/>
346  <parent link="camera_link"/>
347  <child link="camera_depth_frame"/>
348</joint>
349
350<gazebo reference="camera_link">
351  <sensor name="depth_camera" type="depth">
352    <visualize>true</visualize>
353    <update_rate>30.0</update_rate>
354    <camera name="camera">
355      <horizontal_fov>1.047198</horizontal_fov>
356      <image>
357        <width>640</width>
358        <height>480</height>
359        <format>R8G8B8</format>
360      </image>
361      <clip>
362        <near>0.05</near>
363        <far>3</far>
364      </clip>
365    </camera>
366    <plugin name="depth_camera_controller" filename="libgazebo_ros_camera.so">
367      <baseline>0.2</baseline>
368      <alwaysOn>true</alwaysOn>
369      <updateRate>0.0</updateRate>
370      <frame_name>camera_depth_frame</frame_name>
371      <pointCloudCutoff>0.5</pointCloudCutoff>
372      <pointCloudCutoffMax>3.0</pointCloudCutoffMax>
373      <distortionK1>0</distortionK1>
374      <distortionK2>0</distortionK2>
375      <distortionK3>0</distortionK3>
376      <distortionT1>0</distortionT1>
377      <distortionT2>0</distortionT2>
378      <CxPrime>0</CxPrime>
379      <Cx>0</Cx>
380      <Cy>0</Cy>
381      <focalLength>0</focalLength>
382      <hackBaseline>0</hackBaseline>
383    </plugin>
384  </sensor>
385</gazebo>
```

Similar to the lidar sensor, we create `camera_link` which will be referenced by the `gazebo_ros_camera` plugin as the sensor attachment location. We also create a `camera_depth_frame` that is attached to the `camera_link` and will be set as the `<frame_name>` of the depth camera plugin. We also configure the plugin such that it will publish `sensor_msgs/Image` and `sensor_msgs/PointCloud2` messages to `/depth_camera/image_raw` and `/depth_camera/points` topics respectively. Lastly, we also set up other basic configuration properties for our depth camera.

###### Launch and Build Files

To verify that the sensors are set up properly and that they can see objects in our environment, let us launch `sam_bot` in a Gazebo world with objects.
Let us create a Gazebo world with a single cube and a single sphere that are within the range of `sam_bot`’s sensors so we can verify if it can see the objects correctly.

To create the world, create a directory named `world` at the root of your project and create a file named `my_world.sdf` inside the `world` folder . Then copy the contents of [world/my\_world.sdf](https://github.com/ros-navigation/navigation2_tutorials/blob/humble/sam_bot_description/world/my_world.sdf) and paste them inside `my_world.sdf`.

Now, let us edit our launch file, [launch/display.launch.py](https://github.com/ros-navigation/navigation2_tutorials/blob/humble/sam_bot_description/launch/display.launch.py), to launch Gazebo with the world we just created. First, add the path of `my_world.sdf` by adding the following lines inside the `generate_launch_description()`:

```
world_path=os.path.join(pkg_share, 'world/my_world.sdf')
```

Lastly, add the world path in the `launch.actions.ExecuteProcess(cmd=['gazebo',...` line, as shown below.

```
launch.actions.ExecuteProcess(cmd=['gazebo', '--verbose', '-s', 'libgazebo_ros_init.so', '-s', 'libgazebo_ros_factory.so', world_path], output='screen'),
```

We also have to add the `world` directory to our `CMakeLists.txt` file. Open [CmakeLists.txt](https://github.com/ros-navigation/navigation2_tutorials/blob/humble/sam_bot_description/CMakeLists.txt) and append the `world` directory inside the install(DIRECTORY…), as shown in the snippet below.

```
install(
  DIRECTORY src launch rviz config world
  DESTINATION share/${PROJECT_NAME}
)
```

###### Build, Run and Verification

We can now build and run our project. Navigate to the root of the project and execute the following lines:

```
colcon build
. install/setup.bash
ros2 launch sam_bot_description display.launch.py
```

RViz and the Gazebo will then be launched with `sam_bot` present in both. In the Gazebo window, the world that we created should be launched and `sam_bot` should be spawned in that world. You should now be able to observe `sam_bot` with the 360 lidar sensor and the depth camera, as shown in the image below.

![../../_images/gazebo_sensors.png](../../_images/gazebo_sensors.png)

In the RViz window, we can verify if we have properly modeled our sensors and if the transforms of our newly added sensors are correct:

![../../_images/rviz_sensors.png](../../_images/rviz_sensors.png)

Lastly, we can also visualize the sensor readings in RViz. To visualize the `sensor_msgs/LaserScan` message published on `/scan` topic, click the add button at the bottom part of the RViz window. Then go to the `By topic` tab and select the `LaserScan` option under `/scan`, as shown below.

[![../../_images/add_topic_laserscan.png](../../_images/add_topic_laserscan.png)](../../_images/add_topic_laserscan.png)

Next, set the `Reliability Policy` in RViz to `Best Effort` and set the `size` to 0.1 to see the points clearer. You should see the visualized `LaserScan` detection as shown below. This corresponds to the detected cube and sphere that we added to the Gazebo world.

![../../_images/demo_laserscan_rviz.png](../../_images/demo_laserscan_rviz.png)

To visualize `sensor_msgs/Image` and `sensor_msgs/PointCloud2`, do the same for topics `/depth_camera/image_raw` and `/depth_camera/points` respectively:

![../../_images/add_topic_image_pointcloud2.png](../../_images/add_topic_image_pointcloud2.png)

After adding the `/depth_camera/image_raw` topic in RViz, set the `Reliability Policy` in RViz to `Best Effort`. Then you should see the cube in the image window at the lower-left side of the RViz window, as shown below.

![../../_images/demo_image_rviz.png](../../_images/demo_image_rviz.png)

You should also see the `sensor_msgs/PointCloud2`, as shown below.

![../../_images/pointcloud2_data.png](../../_images/pointcloud2_data.png)

###### Conclusion

In this section of our robot setup guide, we had a discussion on the common types of sensor messages in Nav2 which standardize the message formats for different sensor vendors. We also discussed how to add sensors to a simulated robot using Gazebo and how to verify that the sensors are working correctly through RViz.

---

### Transformation

#### Setting Up Transformations

*Source: [https://docs.nav2.org/setup_guides/transformation/setup_transforms.html](https://docs.nav2.org/setup_guides/transformation/setup_transforms.html)*

##### Setting Up Transformations

In this guide, we will be looking at the necessary transforms required by Nav2. These transforms allow Nav2 to interpret information coming in from various sources, such as sensors and odometry, by transforming them to the coordinate frames for use. Below is what a full transform tree for a robot looks like but we’ll start with something much more simpler.

![../../_images/tf_full_tree.png](../../_images/tf_full_tree.png)

For this tutorial, we will first provide a brief introduction to transforms in ROS. Second, we will be working on a simple command-line demo of a TF2 static publisher to see it in action. Lastly, we will outline the necessary transforms that need to be published for Nav2 to function.

###### Transforms Introduction

Note

This section of this guide has been adapted from the [Setting Up You Robot using tf](http://wiki.ros.org/navigation/Tutorials/RobotSetup/TF) tutorial in the ROS (1) Navigation documentation.

Many ROS packages require the transform tree of a robot to be published using the TF2 ROS package. A transformation tree defines the relations between different coordinate systems, in terms of translation, rotation, and relative motion. To make this more concrete, let us apply an example of a simple robot that has a mobile base with a single laser sensor mounted on top of it.

This robot has two defined coordinate frames: one corresponding to the center point of the mobile base of the robot, and one for the center point of the laser that is mounted on top of the base. We’ll call the coordinate frame attached to the mobile base `base_link` and we’ll call the coordinate frame attached to the laser `base_laser`. Note that will be talking more about the naming and conventions of these coordinate frames in the next section.

At this point, let’s assume that we have some data from the laser in the form of distance measurements from the laser’s center point. In other words, we have some data in the `base_laser` coordinate frame.

Now, suppose we want to take this data and use it to help the mobile base avoid obstacles in the world. To do this successfully, we need a way to transform the laser scan we’ve received from the `base_laser` frame to the `base_link` frame. In essence, we need to define a relationship between the `base_laser` and `base_link` coordinate frames.

![../../_images/simple_robot.png](../../_images/simple_robot.png)

In defining this relationship, let us assume that the only data we have is that the laser is mounted 10cm forward and 20cm above the center point of the mobile base. This gives us a translational offset that relates the `base_link` frame to the `base_laser` frame. Specifically, we know that to get data from the `base_link` frame to the `base_laser` frame, we must apply a translation of (x: 0.1m, y: 0.0m, z: 0.2m), and transversely, to get data from the `base_laser` frame to the `base_link` frame, we must apply the opposite translation (x: -0.1m, y: 0.0m, z: -0.20m).

We could choose to manage this relationship ourselves, meaning to store and apply the appropriate translations between the frames when necessary, but this becomes a real pain as the number of coordinate frames increases. Luckily, we don’t have to do this work ourselves. Instead, we’ll define the relationship between `base_link` and `base_laser` once using TF2 and let it manage the transformation between the two coordinate frames for us. This is especially useful when working with non-static transformations, such as a set of frames that are moving relative to each other, like a robot base frame in a map frame.

To define and store the relationship between the `base_link` and `base_laser` frames using TF2, we need to add them to a transform tree. Conceptually, each node in the transform tree corresponds to a coordinate frame, and each edge corresponds to the transform that needs to be applied to move from the current node to its child. TF2 uses a tree structure to guarantee that there is only a single traversal that links any two coordinate frames together, and assumes that all edges in the tree are directed from parent to child nodes.

![../../_images/tf_robot.png](../../_images/tf_robot.png)

To create a transform tree for our simple example, we’ll create two nodes: one for the `base_link` coordinate frame and one for the `base_laser` coordinate frame. To create the edge between them, we first need to decide which node will be the parent and which will be the child. Remember — this distinction is important because TF2 assumes that all transforms move from parent to child.

Let’s choose the `base_link` coordinate frame as the parent because when other pieces/sensors are added to the robot, it will make the most sense for them to relate to the `base_laser` frame by traversing through the `base_link` frame. This means that the transform associated with the edge connecting `base_link` and `base_laser` should be (x: 0.1m, y: 0.0m, z: 0.2m).

With this transform tree set up, converting the laser scan received in the `base_laser` frame to the `base_link` frame is as simple as making a call to the TF2 library. Our robot can now use this information to reason about laser scans in the `base_link` frame and safely plan around obstacles in its environment.

###### Static Transform Publisher Demo

Warning

If you are new to ROS 2 or do not have a working environment yet, then please take some time to properly setup your machine using the resources in the official [ROS 2 Installation Documentation](https://docs.ros.org/en/rolling/Installation.html)

Now let’s try publishing a very simple transform using the static\_transform\_publisher tool provided by TF2. We will be publishing a transformation from the link `base_link` to the link `base_laser` with a translation of (x: 0.1m, y: 0.0m, z: 0.2m). Note that we will be building the transform from the diagram earlier in this tutorial.

Open up your command line and execute the following command:

```
ros2 run tf2_ros static_transform_publisher --x 0.1 --y 0 --z 0.2 --roll 0 --pitch 0 --yaw 0 --frame-id base_link --child-frame-id base_laser
```

With this, we are now successfully publishing our `base_link` to `base_laser` transform in TF2. Let us now check if it is working properly through `tf2_echo`. Open up a separate command line window and execute the following:

```
ros2 run tf2_ros tf2_echo base_link base_laser
```

You should be able to observe a repeated output similar to the one below.

```
At time 0.0
- Translation: [0.100, 0.000, 0.200]
- Rotation: in Quaternion [0.000, 0.000, 0.000, 1.000]
```

And that’s it for this short demo - we were able to successfully publish a transform from `base_link` to `base_laser` using the TF2 library. Note that we do not recommend using the above demo in publishing transforms for your actual robotics projects, it is just a quick demo to see TF2 in action. For a real robot system, we would create a URDF file which embeds this information and more about your robot for use of the robot\_state\_publisher rather than the static\_transform\_publisher. There are more suitable and practical ways to go about this which will be discussed in the [Setting Up The URDF](../urdf/setup_urdf.html#urdf-handson) tutorial.

See also

If you would like to learn more about TF2 and how to create your own transform publishers, head onto the official [TF2 Documentation](https://wiki.ros.org/tf2/Tutorials)

###### Transforms in Navigation2

There are two important ROS REPs which we highly suggest for you to check out. These documents detail some standards set about by the ROS community to ensure proper operation across different packages. Nav2 also adheres to these standards and conventions.

1. [REP 105 - Coordinate Frames for Mobile Platforms](https://www.ros.org/reps/rep-0105.html)
2. [REP 103 - Standard Units of Measure and Coordinate Conventions](https://www.ros.org/reps/rep-0103.html)

To quickly summarize REP 105, this document specifies the naming conventions and semantic meanings of the different coordinate frames used in ROS. Of interest to this tutorial are the `base_link`, `odom` and `map` coordinate frames. The `base_link` is a coordinate frame that is attached to a fixed position on the robot, typically at its main chassis and its rotational center. The `odom` coordinate frame is a fixed frame relative to the robot’s starting position and is mainly used for locally-consistent representations of distances. Lastly, the `map` coordinate frame is a world fixed frame that is used for globally-consistent representations of distances.

REP 103, on the other hand, discusses some standard units of measure and other related conventions to keep integration issues between different ROS packages to a minimum. The basic overview is that frames are defined using the right hand rule, with Z up and X forward, and units should be standard SI units.

Now let’s move on to some specifics for the Navigation2 package to function correctly. Nav2 requires the following transformations to be published in ROS:

1. `map` => `odom`
2. `odom` => `base_link`
3. `base_link` => `base_laser` (sensor base frames)

Note

The `base_laser` coordinate frame is not included in the REP 105 standard. For this guide, we will be using this name to refer to the coordinate frame for a laser sensor on our robot platform. If there are multiple sensor base frames (e.g. camera\_link, base\_laser2, lidar\_link etc.), then a transformation back to `base_link` for each one is required.

The first transform `map` => `odom` is usually provided by a different ROS package dealing with localization and mapping such as AMCL. This transform updates live in use so we don’t set static values for this in our robot’s TF tree. Further detail about how to set this up may be pretty complex, so we highly suggest to have a look at the documentation of the mapping or localization package you are using for your platform. All ROS compliant SLAM and localization packages will provide you with this transformation automatically on launch.

The `odom` => `base_link` is usually published by our odometry system using sensors such as wheel encoders. This is typically computed via sensor fusion of odometry sensors (IMU, wheel encoders, VIO, etc) using the `robot_localization` package.

All other statically defined transforms (e.g. `base_link` => `base_laser`, `base_link` => `wheels`, `wheels` => `IMU`, etc) is what we will be talking about for the rest of this guide. This transformation tree is used by Nav2 to properly relate the information from sensors or other frame of interest to the rest of the robot. The transformation between these two coordinate frames is usually provided to Nav2 through the Robot State Publisher and the Universal Robot Descriptor File (URDF). In cases where there are more sensor coordinate frames on your platform, then a transform tree from `base_link` to each sensor coordinate frame needs to be published.

See also

For a more in-depth discussion on the usage of transforms and how these are used to estimate the current state of your robot, we highly recommend having a look at the State Estimation topic in [Navigation Concepts](../../concepts/index.html#concepts).

###### Conclusion

In this tutorial, we have discussed about the concept of transforms and how they are used in Nav2.

In the last section, we have also explored using the static\_transform\_publisher of TF2 to publish our transforms. You may use this to set up your transforms for Nav2, but this is generally not the best way to do it. In most robotics projects, we make use of the Robot State Publisher since it is much easier to use and scales well as our robot gets more complex. We will be talking about the Robot State Publisher, URDF, and how to set it up in the next tutorial on [Setting Up The URDF](../urdf/setup_urdf.html#urdf-handson).

Lastly, we also discussed the three published transform requirements of Nav2 and the necessary REPs to keep in mind when setting them up.

---

### Urdf

#### Setting Up The URDF

*Source: [https://docs.nav2.org/setup_guides/urdf/setup_urdf.html](https://docs.nav2.org/setup_guides/urdf/setup_urdf.html)*

##### Setting Up The URDF

Note

Note that you will also be setting up a SDF for simulation in Gazebo in the next tutorials. URDF is used to set up the robot frames and describe the robot’s structure for run-time use on hardware and possibly in simulation. SDF is a specific file for simulators, like Gazebo, that describes the simulator environment, model (including its frames and Gazebo-specific information), and appropriate plugins. The SDF that we will make is for Gazebo, but could be replaced with an appropriate SDF or other format file for Open3D Engine or Isaac Sim.

For this guide, we will be creating the Unified Robot Description Format (URDF) file for a simple differential drive robot to give you hands-on experience on working with URDF. We will also setup the robot state publisher and visualize our model in RVIZ. Lastly, we will be adding some kinematic properties to our robot URDF to prepare it for simulation purposes. These steps are necessary to represent all the sensor, hardware, and robot transforms of your robot for use in navigation.

See also

The complete source code in this tutorial can be found in [navigation2\_tutorials](https://github.com/ros-navigation/navigation2_tutorials/tree/master/sam_bot_description) repository under the `sam_bot_description` package. Note that the repository contains the full code after accomplishing all the tutorials in this guide.

###### URDF and the Robot State Publisher

As discussed in the previous tutorial, one of the requirements for Navigation2 is the transformation from `base_link` to the various sensors and reference frames. This transformation tree can range from a simple tree with only one link from the `base_link` to `laser_link` or a tree comprised of multiple sensors located in different locations, each having their own coordinate frame. Creating multiple publishers to handle all of these coordinate frame transformations may become tedious. Therefore, we will be making use of the Robot State Publisher package to publish our transforms.

The Robot State Publisher is a package of ROS 2 that interacts with the tf2 package to publish all of the necessary transforms that can be directly inferred from the geometry and structure of the robot. We need to provide it with the correct URDF and it will automatically handle publishing the transforms. This is very useful for complex transformations but it is still recommended for simpler transform trees.

The Unified Robot Description Format (URDF) is an XML file that represents a robot model. In this tutorial, it will mainly be used to build transformations trees related with the robot geometry, but it also has other uses. One example is how it can be used in visualizing your robot model in RVIZ, a 3D Visualization tool for ROS, by defining visual components such as materials and meshes. Another example is how the URDF can be used to define the physical properties of the robot. These properties are then used in physics simulators such as Gazebo to simulate how your robot will interact in an environment.

Another major feature of URDF is that it also supports Xacro (XML Macros) to help you create a shorter and readable XML to help in defining complex robots. We can use these macros to eliminate the need for repeating blocks of XML in our URDF. Xacro is also useful in defining configuration constants which can be reused throughout the URDF.

See also

If you want to learn more about the URDF and the Robot State Publisher, we encourage you to have a look at the official [URDF Documentation](http://wiki.ros.org/urdf) and [Robot State Publisher Documentation](http://wiki.ros.org/robot_state_publisher)

###### Setting Up the Environment

In this guide, we are assuming that you are already familiar with ROS 2 and how to setup your development environment, so we’ll breeze through the steps in this section.

Let’s begin by installing some additional ROS 2 packages that we will be using during this tutorial.

```
sudo apt install ros-<ros2-distro>-joint-state-publisher-gui
sudo apt install ros-<ros2-distro>-xacro
```

Next, create a directory for your project, initialize a ROS 2 workspace and give your robot a name. For ours, we’ll be calling it `sam_bot`.

```
ros2 pkg create --build-type ament_cmake sam_bot_description
```

###### Writing the URDF

See also

This section aims to provide you with a beginner-friendly introduction to building URDFs for your robot. If you would like to learn more about URDF and XAcro, we suggest for you to have a look at the official [URDF Documentation](http://wiki.ros.org/urdf)

Now that we have our project workspace set up, let’s dive straight into writing the URDF. Below is an image of the robot we will be trying to build.

[![../../_images/base-bot_1.png](../../_images/base-bot_1.png)](../../_images/base-bot_1.png)
[![../../_images/base-bot_2.png](../../_images/base-bot_2.png)](../../_images/base-bot_2.png)
> To get started, create a file named `sam_bot_description.urdf` under `src/description` and input the following as the initial contents of the file.

```
1<?xml version="1.0"?>
2<robot name="sam_bot" xmlns:xacro="http://ros.org/wiki/xacro">
3
4
5
6</robot>
```

Note

The following code snippets should be placed within the `<robot>` tags. We suggest to add them in the same order as introduced in this tutorial. We have also included some line numbers to give you a rough idea on where to input the code. This may differ from the actual file you are writing depending on your usage of whitespaces. Also note that the line numbers assume that you are putting in code as they appear in this guide.

Next, let us define some constants using XAcro properties that will be reused throughout the URDF.

```
 4  <!-- Define robot constants -->
 5  <xacro:property name="base_width" value="0.31"/>
 6  <xacro:property name="base_length" value="0.42"/>
 7  <xacro:property name="base_height" value="0.18"/>
 8
 9  <xacro:property name="wheel_radius" value="0.10"/>
10  <xacro:property name="wheel_width" value="0.04"/>
11  <xacro:property name="wheel_ygap" value="0.025"/>
12  <xacro:property name="wheel_zoff" value="0.05"/>
13  <xacro:property name="wheel_xoff" value="0.12"/>
14
15  <xacro:property name="caster_xoff" value="0.14"/>
```

Here is a brief discussion on what these properties will represent in our urdf. The `base_*` properties all define the size of the robot’s main chassis. The `wheel_radius` and `wheel_width` define the shape of the robot’s two back wheels. The `wheel_ygap` adjusts the gap between the wheel and the chassis along the y-axis whilst `wheel_zoff` and `wheel_xoff` position the back wheels along the z-axis and x-axis appropriately. Lastly, the `caster_xoff` positions the front caster wheel along the x-axis.

Let us then define our `base_link` - this link will be a large box and will act as the main chassis of our robot. In URDF, a `link` element describes a rigid part or component of our robot. The robot state publisher then utilizes these definitions to determine coordinate frames for each link and publish the transformations between them.

We will also be defining some of the link’s visual properties which can be used by tools such as Gazebo and Rviz to show us a 3D model of our robot. Amongst these properties are `<geometry>` which describes the link’s shape and `<material>` which describes it’s color.

For the code block below, we access the `base` properties from the robot constants sections we defined before using the `${property}` syntax. In addition, we also set the material color of the main chassis to `Cyan`. Note that we set these parameters under the `<visual>` tag so they will only be applied as visual parameters which dont affect any collision or physical properties.

```
17  <!-- Robot Base -->
18  <link name="base_link">
19    <visual>
20      <geometry>
21        <box size="${base_length} ${base_width} ${base_height}"/>
22      </geometry>
23      <material name="Cyan">
24        <color rgba="0 1.0 1.0 1.0"/>
25      </material>
26    </visual>
27  </link>
```

Next, let us define a `base_footprint` link. The `base_footprint` link is a virtual (non-physical) link which has no dimensions or collision areas. Its primary purpose is to enable various packages determine the center of a robot projected to the ground. For example, Navigation2 uses this link to determine the center of a circular footprint used in its obstacle avoidance algorithms. Again, we set this link with no dimensions and to which position the robot’s center is in when it is projected to the ground plane.

After defining our base\_link, we then add a joint to connect it to `base_link`. In URDF, a `joint` element describes the kinematic and dynamic properties between coordinate frames. For this case, we will be defining a `fixed` joint with the appropriate offsets to place our `base_footprint` link in the proper location based on the description above. Remember that we want to set our base\_footprint to be at the ground plane when projected from the center of the main chassis, hence we get the sum of the `wheel_radius` and the `wheel_zoff` to get the appropriate location along the z-axis.

```
29  <!-- Robot Footprint -->
30  <link name="base_footprint"/>
31
32  <joint name="base_joint" type="fixed">
33    <parent link="base_link"/>
34    <child link="base_footprint"/>
35    <origin xyz="0.0 0.0 ${-(wheel_radius+wheel_zoff)}" rpy="0 0 0"/>
36  </joint>
```

Now, we will be adding two large drive wheels to our robot. To make our code cleaner and avoid repetition, we will make use of macros to define a block of code that will be repeated with differing parameters. Our macro will have 3 params: `prefix` which simply adds a prefix to our link and joint names, and `x_reflect` and `y_reflect` which allows us to flip the positions of our wheels with respect to the x and y axis respectively. Within this macro, we can also define the visual properties of a single wheel. Lastly, we will also define a `continuous` joint to allow our wheels to freely rotate about an axis. This joint also connects our wheel to the `base_link` at the appropriate location.

At the end of this code block, we will be instantiating two wheels using the macro we just made through the `xacro:wheel` tags. Note that we also define the parameters to have one wheel on both sides at the back of our robot.

```
38  <!-- Wheels -->
39  <xacro:macro name="wheel" params="prefix x_reflect y_reflect">
40    <link name="${prefix}_link">
41      <visual>
42        <origin xyz="0 0 0" rpy="${pi/2} 0 0"/>
43        <geometry>
44            <cylinder radius="${wheel_radius}" length="${wheel_width}"/>
45        </geometry>
46        <material name="Gray">
47          <color rgba="0.5 0.5 0.5 1.0"/>
48        </material>
49      </visual>
50    </link>
51
52    <joint name="${prefix}_joint" type="continuous">
53      <parent link="base_link"/>
54      <child link="${prefix}_link"/>
55      <origin xyz="${x_reflect*wheel_xoff} ${y_reflect*(base_width/2+wheel_ygap)} ${-wheel_zoff}" rpy="0 0 0"/>
56      <axis xyz="0 1 0"/>
57    </joint>
58  </xacro:macro>
59
60  <xacro:wheel prefix="drivewhl_l" x_reflect="-1" y_reflect="1" />
61  <xacro:wheel prefix="drivewhl_r" x_reflect="-1" y_reflect="-1" />
```

Next, we will be adding a caster wheel at the front of our robot. We will be modelling this wheel as a sphere to keep things simple. Again, we define the wheel’s geometry, material and the joint to connect it to `base_link` at the appropriate location.

```
63  <!-- Caster Wheel -->
64  <link name="front_caster">
65    <visual>
66      <geometry>
67        <sphere radius="${(wheel_radius+wheel_zoff-(base_height/2))}"/>
68      </geometry>
69      <material name="Cyan">
70        <color rgba="0 1.0 1.0 1.0"/>
71      </material>
72    </visual>
73  </link>
74
75  <joint name="caster_joint" type="fixed">
76    <parent link="base_link"/>
77    <child link="front_caster"/>
78    <origin xyz="${caster_xoff} 0.0 ${-(base_height/2)}" rpy="0 0 0"/>
79  </joint>
```

And that’s it! We have built a URDF for a simple differential drive robot. In the next section, we will focus on building the ROS Package containing our URDF, launching the robot state publisher, and visualizing the robot in RVIz.

###### Build and Launch

See also

The launch files from this tutorial were adapted from the official [URDF Tutorials for ROS 2](https://github.com/ros/urdf_tutorial/tree/ros2)

Let’s start this section by adding some dependencies that will be required once we build this project. Open up the root of your project directory and add the following lines to your `package.xml` (preferably after the `<buildtool_depend>` tag)

```
<exec_depend>joint_state_publisher</exec_depend>
<exec_depend>joint_state_publisher_gui</exec_depend>
<exec_depend>robot_state_publisher</exec_depend>
<exec_depend>rviz</exec_depend>
<exec_depend>xacro</exec_depend>
```

Next, let us create our launch file. Launch files are used by ROS 2 to bring up the necessary nodes for our package. From the root of the project, create a directory named `launch` and a `display.launch.py` file within it. The launch file below launches a robot publisher node in ROS 2 that uses our URDF to publish the transforms for our robot. In addition, the launch file also automatically launches RVIZ so we can visualize our robot as defined by the URDF. Copy and paste the snippet below into your `display.launch.py` file.

```
from launch import LaunchDescription
from launch.actions import DeclareLaunchArgument
from launch.conditions import IfCondition, UnlessCondition
from launch.substitutions import Command, LaunchConfiguration
from launch_ros.actions import Node
from launch_ros.substitutions import FindPackageShare
import os

def generate_launch_description():
    pkg_share = FindPackageShare(package='sam_bot_description').find('sam_bot_description')
    default_model_path = os.path.join(pkg_share, 'src', 'description', 'sam_bot_description.urdf')
    default_rviz_config_path = os.path.join(pkg_share, 'rviz', 'config.rviz')

    robot_state_publisher_node = Node(
        package='robot_state_publisher',
        executable='robot_state_publisher',
        parameters=[{'robot_description': Command(['xacro ', LaunchConfiguration('model')])}]
    )
    joint_state_publisher_node = Node(
        package='joint_state_publisher',
        executable='joint_state_publisher',
        name='joint_state_publisher',
        parameters=[{'robot_description': Command(['xacro ', default_model_path])}],
        condition=UnlessCondition(LaunchConfiguration('gui'))
    )
    joint_state_publisher_gui_node = Node(
        package='joint_state_publisher_gui',
        executable='joint_state_publisher_gui',
        name='joint_state_publisher_gui',
        condition=IfCondition(LaunchConfiguration('gui'))
    )
    rviz_node = Node(
        package='rviz2',
        executable='rviz2',
        name='rviz2',
        output='screen',
        arguments=['-d', LaunchConfiguration('rvizconfig')],
    )

    return LaunchDescription([
        DeclareLaunchArgument(name='gui', default_value='True', description='Flag to enable joint_state_publisher_gui'),
        DeclareLaunchArgument(name='model', default_value=default_model_path, description='Absolute path to robot model file'),
        DeclareLaunchArgument(name='rvizconfig', default_value=default_rviz_config_path, description='Absolute path to rviz config file'),
        joint_state_publisher_node,
        joint_state_publisher_gui_node,
        robot_state_publisher_node,
        rviz_node
    ])
```

See also

For more information regarding the launch system in ROS 2, you can have a look at the official [ROS 2 Launch System Documentation](https://docs.ros.org/en/rolling/Tutorials/Launch-system.html)

To keep things simpler when we get to visualization, we have provided an RVIz config file that will be loaded when we launch our package. This configuration file initializes RVIz with the proper settings so you can view the robot immediately once it launches. Create a directory named `rviz` in the root of your project and a file named `config.rviz` under it. Place the following as the contents of `config.rviz`

```
Panels:
  - Class: rviz_common/Displays
    Help Height: 78
    Name: Displays
    Property Tree Widget:
      Expanded:
        - /Global Options1
        - /Status1
        - /RobotModel1/Links1
        - /TF1
      Splitter Ratio: 0.5
    Tree Height: 557
Visualization Manager:
  Class: ""
  Displays:
    - Alpha: 0.5
      Cell Size: 1
      Class: rviz_default_plugins/Grid
      Color: 160; 160; 164
      Enabled: true
      Name: Grid
    - Alpha: 0.6
      Class: rviz_default_plugins/RobotModel
      Description Topic:
        Depth: 5
        Durability Policy: Volatile
        History Policy: Keep Last
        Reliability Policy: Reliable
        Value: /robot_description
      Enabled: true
      Name: RobotModel
      Visual Enabled: true
    - Class: rviz_default_plugins/TF
      Enabled: true
      Name: TF
      Marker Scale: 0.3
      Show Arrows: true
      Show Axes: true
      Show Names: true
  Enabled: true
  Global Options:
    Background Color: 48; 48; 48
    Fixed Frame: base_link
    Frame Rate: 30
  Name: root
  Tools:
    - Class: rviz_default_plugins/Interact
      Hide Inactive Objects: true
    - Class: rviz_default_plugins/MoveCamera
    - Class: rviz_default_plugins/Select
    - Class: rviz_default_plugins/FocusCamera
    - Class: rviz_default_plugins/Measure
      Line color: 128; 128; 0
  Transformation:
    Current:
      Class: rviz_default_plugins/TF
  Value: true
  Views:
    Current:
      Class: rviz_default_plugins/Orbit
      Name: Current View
      Target Frame: <Fixed Frame>
      Value: Orbit (rviz)
    Saved: ~
```

Lastly, let us modify the `CMakeLists.txt` file in the project root directory to include the files we just created during the package installation process. Add the following snippet to `CMakeLists.txt` file preferably above the `if(BUILD_TESTING)` line:

```
install(
  DIRECTORY src launch rviz
  DESTINATION share/${PROJECT_NAME}
)
```

We are now ready to build our project using colcon. Navigate to the project root and execute the following commands.

```
colcon build
. install/setup.bash
```

After a successful build, execute the following commands to install the ROS 2 package and launch our project.

```
ros2 launch sam_bot_description display.launch.py
```

ROS 2 should now launch a robot publisher node and start up RVIZ using our URDF. We’ll be taking a look at our robot using RVIZ in the next section.

###### Visualization using RVIZ

RVIZ is a robot visualization tool that allows us to see a 3D model of our robot using its URDF. Upon a successful launch using the commands in the previous section, RVIZ should now be visible on your screen and should look like the image below. You may need to move around and manipulate the view to get a good look at your robot.

![../../_images/base-bot_3.png](../../_images/base-bot_3.png)

As you can see, we have successfully created a simple differential drive robot and visualized it in RVIz. It is not necessary to visualize your robot in RVIz, but it’s a good step in order to see if you have properly defined your URDF. This helps you ensure that the robot state publisher is publishing the correct transformations.

You may have noticed that another window was launched - this is a GUI for the joint state publisher. The joint state publisher is another ROS 2 package which publishes the state for our non-fixed joints. You can manipulate this publisher through the small GUI and the new pose of the joints will be reflected in RVIz. Sliding the bars for any of the two wheels will rotate these joints. You can see this in action by viewing RVIZ as you sweep the sliders in the Joint State Publisher GUI.

![../../_images/base-bot_4.png](../../_images/base-bot_4.png)

Note

We won’t be interacting much with this package for Nav2, but if you would like to know more about the joint state publisher, feel free to have a look at the official [Joint State Publisher Documentation](http://wiki.ros.org/joint_state_publisher).

At this point, you may already decide to stop with this tutorial since we have already achieved our objective of creating a URDF for a simple differential drive robot. The robot state publisher is now publishing the transforms derived from the URDF. These transforms can now be used by other packages (such as Nav2) to get information regarding the shape and structure of your robot. However, to properly use this URDF in a simulation, we need physical properties so that the robot reacts to physical environments like a real robot would. The visualization fields are only for visualization, not collision, so your robot will drive straight through obstacles. We’ll get into adding these properties in our URDF in the next section.

###### Adding Physical Properties

As an additional section to this guide, we will be modifying our current URDF to include some of our robot’s kinematic properties. This information may be used by physics simulators such as Gazebo to model and simulate how our robot will act in the virtual environment.

Let us first define macros containing the inertial properties of the geometric primitives we used in our project. Place the snippet below after our constants section in the URDF:

```
17  <!-- Define inertial property macros  -->
18  <xacro:macro name="box_inertia" params="m w h d">
19    <inertial>
20      <origin xyz="0 0 0" rpy="${pi/2} 0 ${pi/2}"/>
21      <mass value="${m}"/>
22      <inertia ixx="${(m/12) * (h*h + d*d)}" ixy="0.0" ixz="0.0" iyy="${(m/12) * (w*w + d*d)}" iyz="0.0" izz="${(m/12) * (w*w + h*h)}"/>
23    </inertial>
24  </xacro:macro>
25
26  <xacro:macro name="cylinder_inertia" params="m r h">
27    <inertial>
28      <origin xyz="0 0 0" rpy="${pi/2} 0 0" />
29      <mass value="${m}"/>
30      <inertia ixx="${(m/12) * (3*r*r + h*h)}" ixy = "0" ixz = "0" iyy="${(m/12) * (3*r*r + h*h)}" iyz = "0" izz="${(m/2) * (r*r)}"/>
31    </inertial>
32  </xacro:macro>
33
34  <xacro:macro name="sphere_inertia" params="m r">
35    <inertial>
36      <mass value="${m}"/>
37      <inertia ixx="${(2/5) * m * (r*r)}" ixy="0.0" ixz="0.0" iyy="${(2/5) * m * (r*r)}" iyz="0.0" izz="${(2/5) * m * (r*r)}"/>
38    </inertial>
39  </xacro:macro>
```

Let us start by adding collision areas to our `base_link` using the `<collision>` tag. Include the following code snippet within `<link name="base_link">` tag of `base_link` in our URDF.

```
52    <collision>
53      <geometry>
54        <box size="${base_length} ${base_width} ${base_height}"/>
55      </geometry>
56    </collision>
```

We will also be using the box\_inertia macro we defined before to add some inertial properties to our `base_link`.
The `kdl_parser` package used in `robot_state_publisher` doesn’t like inertial properties being specified in the root link, in this case the `base_link`, to combat this we will be including them in the `base_footprint` instead.
Include the following code snippet within `<link name="base_footprint">` tag of `base_footprint` in our URDF.

```
62     <xacro:box_inertia m="15" w="${base_width}" d="${base_length}" h="${base_height}"/>
```

Next, let us do the same for our wheel macros. Include the following code snippet within the `<link name="${prefix}_link">` tag of our wheel macros in our URDF.

```
83      <collision>
84        <origin xyz="0 0 0" rpy="${pi/2} 0 0"/>
85        <geometry>
86          <cylinder radius="${wheel_radius}" length="${wheel_width}"/>
87        </geometry>
88      </collision>
89
90      <xacro:cylinder_inertia m="0.5" r="${wheel_radius}" h="${wheel_width}"/>
```

Lastly, let us add the similar properties to our spherical caster wheels. Include the following in the `<link name="front_caster">` tag of our caster wheel in the URDF.

```
114    <collision>
115      <origin xyz="0 0 0" rpy="0 0 0"/>
116      <geometry>
117        <sphere radius="${(wheel_radius+wheel_zoff-(base_height/2))}"/>
118      </geometry>
119    </collision>
120
121    <xacro:sphere_inertia m="0.5" r="${(wheel_radius+wheel_zoff-(base_height/2))}"/>
```

Note

We did not add any inertial or collision properties to our `base_footprint` link since this is a virtual and non-physical link.

Build your project and then launch RViz using the same commands in the previous section.

```
colcon build
. install/setup.bash
ros2 launch sam_bot_description display.launch.py
```

You can verify whether you have properly set up the collision areas by enabling `Collision Enabled` under `RobotModel` on the left pane (it may be easier to see if you also turn off `Visual Enabled`). For this tutorial we defined a collision area which is similar to our visual properties. Note that this may not always be the case since you may opt for simpler collision areas based on how your robot looks.

![../../_images/base-bot_5.png](../../_images/base-bot_5.png)

For now, we will have to stop here since we will need to set up a lot more components to actually start simulating our robot in Gazebo. We will be coming back to this project during the course of these setup guides, and we will eventually see our robot move in a virtual environment once we get to the simulation sections. The major components that are missing from this work are the simulation plugins required to mimic your robot controllers. We will introduce those and add them to this URDF in the appropriate section.

###### Conclusion

And that’s it. In this tutorial, you have successfully created a URDF for a simple differential drive robot. You have also set up a ROS 2 project that launches a robot publisher node, which then uses your URDF to publish the robot’s transforms. We have also used RViz to visualize our robot to verify whether our URDF is correct. Lastly, we have added in some physical properties to our URDF in order to prepare it for simulation.

Feel free to use this tutorial as a template for your own robot. Remember that your main goal is to publish the correct transforms from your base\_link up to your sensor\_frames. Once these have been setup, then you may proceed to our other setup guides.

---

## Tuning

### Tuning Guide

*Source: [https://docs.nav2.org/tuning/index.html](https://docs.nav2.org/tuning/index.html)*

#### Tuning Guide

This guide is meant to assist users in tuning their navigation system. While [Configuration Guide](../configuration/index.html#configuration) is the home of the list of parameters for all of Nav2, it doesn’t contain much *color* for how to tune a system using the most important of them. The aim of this guide is to give more advice in how to setup your system beyond a first time setup, which you can find at [First-Time Robot Setup Guide](../setup_guides/index.html#setup-guides). This will by no means cover all of the parameters (so please, do review the configuration guides for the packages of interest), but will give some helpful hints and tips.

This tuning guide is a perpetual work in progress. If you see some insights you have missing, please feel free to file a ticket or pull request with the wisdom you would like to share. This is an open section supported by the generosity of Nav2 users and maintainers. Please consider paying it forward.

##### Inflation Potential Fields

Many users and ecosystem navigation configuration files the maintainers find are really missing the point of the inflation layer. While it’s true that you can simply inflate a small radius around the walls to weight against critical collisions, the *true* value of the inflation layer is creating a consistent potential field around the entire map.

Some of the most popular tuning guides for ROS Navigation / Nav2 even [call this out specifically](https://arxiv.org/pdf/1706.09068.pdf) that there’s substantial benefit to creating a gentle potential field across the width of the map - after inscribed costs are applied - yet very few users do this in practice.

This habit actually results in paths produced by NavFn, Theta\*, and Smac Planner to be somewhat suboptimal. They really want to look for a smooth potential field rather than wide open 0-cost spaces in order to stay in the middle of spaces and deal with close-by moving obstacles better. It will allow search to be weighted towards freespace far before the search algorithm runs into the obstacle that the inflation is caused by, letting the planner give obstacles as wide of a berth as possible.

So it is the maintainers’ recommendation, as well as all other cost-aware search planners available in ROS, to increase your inflation layer cost scale and radius in order to adequately produce a smooth potential across the entire map. For very large open spaces, its fine to have 0-cost areas in the middle, but for halls, aisles, and similar; **please create a smooth potential to provide the best performance**.

##### Robot Footprint vs Radius

Nav2 allows users to specify the robot’s shape in 2 ways: a geometric `footprint` or the radius of a circle encompassing the robot. In ROS (1), it was pretty reasonable to always specify a radius approximation of the robot, since the global planning algorithms didn’t use it and the local planners / costmaps were set up with the circular assumption baked in.

However, in Nav2, we now have multiple planning and controller algorithms that make use of the full SE2 footprint. If your robot is non-circular, it is recommended that you give the planners and controllers the actual, geometric footprint of your robot. This will allow the planners and controllers to plan or create trajectories into tighter spaces. For example, if you have a very long but skinny robot, the circular assumption wouldn’t allow a robot to plan into a space only a little wider than your robot, since the robot would not fit length-wise.

The kinematically feasible planners (e.g. Smac Hybrid-A\*, Smac State Lattice) will use the SE2 footprint for collision checking to create kinematically feasible plans, if provided with the actual footprint. As of December, 2021 all of the controller plugins support full footprint collision checking to ensure safe path tracking. If you provide a footprint of your robot, it will be used to make sure trajectories are valid and it is recommended you do so. It will prevent a number of “stuck robot” situations that could have been easily avoided.

If your robot is truly circular, continue to use the `robot_radius` parameter. The three valid reasons for a non-circular robot to use the radius instead:

* The robot is very small relative to the environment (e.g. RC car in a warehouse)
* The robot has such limited compute power, using SE2 footprint checking would add too much computational burden (e.g. embedded micro-processors)
* If you plan to use a holonomic planner (e.g. Theta\*, Smac 2D-A\*, or NavFn), you may continue to use the circular footprint, since these planners are not kinematically feasible and will not make use of the SE2 footprint anyway.

##### Rotate in Place Behavior

Using the [Rotation Shim Controller](../configuration/packages/configuring-rotation-shim-controller.html#configuring-rotation-shim), a robot will simply rotate in place before starting to track a holonomic path. This allows a developer to tune a controller plugin to be optimized for path tracking and give you clean rotations, out of the box.

This was added due to quirks in some existing controllers whereas tuning the controller for a task can make it rigid – or the algorithm simply doesn’t rotate in place when working with holonomic paths (if that’s a desirable trait). The result is an awkward, stuttering, or whipping around behavior when your robot’s initial and path heading’s are significantly divergent. Giving a controller a better starting point to start tracking a path makes tuning the controllers significantly easier and creates more intuitive results for on-lookers (in one maintainer’s opinion).

Note: If using a non-holonomic, kinematically feasible planner (e.g. Smac Hybrid-A\*, Smac State Lattice), this is not a necessary behavioral optimization. This class of planner will create plans that take into account the robot’s starting heading, not requiring any rotation behaviors.

This behavior is most optimally for:

* Robots that can rotate in place, such as differential and omnidirectional robots.
* Preference to rotate in place when starting to track a new path that is at a significantly different heading than the robot’s current heading – or when tuning your controller for its task makes tight rotations difficult.

##### Planner Plugin Selection

Nav2 provides a number of planning plugins out of the box. For a first-time setup, see [Setting Up Navigation Plugins](../setup_guides/algorithm/select_algorithm.html#select-algorithm) for a more verbose breakdown of algorithm styles within Nav2, and [Navigation Plugins](../plugins/index.html#plugins) for a full accounting of the current list of plugins available (which may be updated over time).

In general though, the following table is a good guide for the optimal planning plugin for different types of robot bases:

| Plugin Name | Supported Robot Types |
| --- | --- |
| NavFn Planner | Circular Differential, Circular Omnidirectional |
| Smac Planner 2D |
| Theta Star Planner |
| Smac Hybrid-A\* Planner | Non-circular or Circular Ackermann, Non-circular or Circular Legged |
| Smac Lattice Planner | Non-circular Differential, Non-circular Omnidirectional, Arbitrary |

If you are using a non-circular robot with very limited compute, it may be worth assessing the benefits of using one of the holonomic planners (e.g. particle assumption planners). It is the recommendation of the maintainers to start using one of the more advanced algorithms appropriate for your platform *first*, but to scale back the planner if need be. The run-time of the feasible planners are typically on par (or sometimes faster) than their holonomic counterparts, so don’t let the more recent nature of them fool you.

Since the planning problem is primarily driven by the robot type, the table accurately summarizes the advice to users by the maintainers. Within the circular robot regime, the choice of planning algorithm is dependent on application and desirable behavior. NavFn will typically make broad, sweeping curves; Theta\* prefers straight lines and supports them at any angle; and Smac 2D is essentially a classical A\* algorithm with cost-aware penalties.

Note

These are simply the default and available plugins from the community. For a specific application / platform, you may also choose to use none of these and create your own, and that’s the intention of the Nav2 framework. See the [Writing a New Planner Plugin](../plugin_tutorials/docs/writing_new_nav2planner_plugin.html#writing-new-nav2planner-plugin) tutorial for more details. If you’re willing to contribute this work back to the community, please file a ticket or contact a maintainer! They’d love to hear from you.

##### Controller Plugin Selection

Nav2 provides a number of controller plugins out of the box. For a first-time setup, see [Setting Up Navigation Plugins](../setup_guides/algorithm/select_algorithm.html#select-algorithm) for a more verbose breakdown of algorithm styles within Nav2, and [Navigation Plugins](../plugins/index.html#plugins) for a full accounting of the current list of plugins available (which may be updated over time).

In general though, the following table is a good first-order description of the controller plugins available for different types of robot bases:

| Plugin Name | Supported Robot Types | Task |
| --- | --- | --- |
| DWB controller | Differential, Omnidirectional | Dynamic obstacle avoidance  Dynamic obstacle avoidance |
| MPPI Controller | Differential, Omnidirectional, Ackermann, Legged |
| RPP controller | Differential, Ackermann, Legged | Exact path following |
| Rotation Shim | Differential, Omnidirectional | Rotate to rough heading |
| VP controller | Differential, Ackermann, Legged | High speed path tracking |

All of the above controllers can handle both circular and arbitrary shaped robots in configuration.

Regulated Pure Pursuit is good for exact path following and is typically paired with one of the kinematically feasible planners (eg State Lattice, Hybrid-A\*, etc) since those paths are known to be drivable given hard physical constraints. However, it can also be applied to differential drive robots who can easily pivot to match any holonomic path. This is the plugin of choice if you simply want your robot to follow the path, rather exactly, without any dynamic obstacle avoidance or deviation. It is simple and geometric, as well as slowing the robot in the presence of near-by obstacles *and* while making sharp turns.

DWB and MPPI are both options that will track paths, but also diverge from the path if there are dynamic obstacles present (in order to avoid them). DWB does this through scoring multiple trajectories on a set of critics. These trajectories are also generated via plugins that can be replaced, but support out of the box Omni and Diff robot types within the valid velocity and acceleration restrictions. These critics are plugins that can be selected at run-time and contain weights that may be tuned to create the desired behavior, such as minimizing path distance, minimizing distance to the goal or headings, and other action penalties that can be designed. This does require a bit of tuning for a given platform, application, and desired behavior, but it is possible to tune DWB to do nearly any single thing well.

MPPI on the other hand implements an optimization based approach, using randomly perturbed samples of the previous optimal trajectory to maximize a set of plugin-based objective functions. In that regard, it is similar to DWB however MPPI is a far more modern and advanced technique that will deal with dynamic agents in the environment and create intelligent behavior due to the optimization based trajectory planning, rather then DWB’s constant action model. MPPI however does have moderately higher compute costs, but it is highly recommended to go this route and has received considerable development resources and attention due to its power. This typically works pretty well out of the box, but to tune for specific behaviors, you may have to retune some of the parameters. The README.md file for this package contains details on how to tune it efficiently.

The Rotation Shim Plugin helps assist plugins like TEB and DWB (among others) to rotate the robot in place towards a new path’s heading before starting to track the path. This allows you to tune your local trajectory planner to operate with a desired behavior without having to worry about being able to rotate on a dime with a significant deviation in angular distance over a very small euclidean distance. Some controllers when heavily tuned for accurate path tracking are constrained in their actions and don’t very cleanly rotate to a new heading. Other controllers have a ‘spiral out’ behavior because their sampling requires some translational velocity, preventing it from simply rotating in place. This helps alleviate that problem and makes the robot rotate in place very smoothly.

Finally, Vector Pursuit is another good path tracking solution and just like RPP, is paired with a kinematically feasible planner. It is a bit more advanced than RPP in the sense it also takes path heading into account. Vector Pursuit can handle complex paths at high speeds, but it is still a simple geometric controller thus requiring low computation resources.

Note

These are simply the default and available plugins from the community. For a specific robot platform / company, you may also choose to use none of these and create your own. See the [Writing a New Controller Plugin](../plugin_tutorials/docs/writing_new_nav2controller_plugin.html#writing-new-nav2controller-plugin) tutorial for more details. If you’re willing to contribute this work back to the community, please file a ticket or contact a maintainer! They’d love to hear from you.

##### Caching Obstacle Heuristic in Smac Planners

Smac’s Hybrid-A\* and State Lattice Planners provide an option, `cache_obstacle_heuristic`. This can be used to cache the heuristic to use between replannings to the same goal pose, which can increase the speed of the planner **significantly** (40-300% depending on many factors). The obstacle heuristic is used to steer the robot into the middle of spaces, respecting costs, and drives the kinematically feasible search down the corridors towards a valid solution. Think of it like a 2D cost-aware search to “prime” the planner about where it should go when it needs to expend more effort in the fully feasible search / SE2 collision checking.

This is useful to speed up performance to achieve better replanning speeds. However, if you cache this heuristic, it will not be updated with the most current information in the costmap to steer search. During planning, the planner will still make use of the newest cost information for collision checking, *thusly this will not impact the safety of the path*. However, it may steer the search down newly blocked corridors or guide search towards areas that may have new dynamic obstacles in them, which can slow things down significantly if entire solution spaces are blocked.

Therefore, it is the recommendation of the maintainers to enable this only when working in largely static (e.g. not many moving things or changes, not using live sensor updates in the global costmap, etc) environments when planning across large spaces to singular goals. Between goal changes to Nav2, this heuristic will be updated with the most current set of information, so it is not very helpful if you change goals very frequently.

##### Costmap2D Plugins

Costmap2D has a number of plugins that you can use (including the availability for you to create your own!).

* `StaticLayer`: Used to set the map from SLAM (either pre-built or currently being built live) for sizing the environment and setting key features like walls and rooms for global planning.
* `InflationLayer`: Inflates with an exponential function the lethal costs to help steer navigation algorithms away from walls and quickly detect collisions
* `ObstacleLayer`: 2D costmap layer used for 2D planar lidars or when on low-compute devices where 3D layer cannot be used on 3D sensors. If you have enough compute, use the `VoxelLayer` for 3D data which provides more accurate results.
* `VoxelLayer`: 3D costmap layer for non-planar 2D lidars or depth camera processing based on raycast clearing. Not suitable for 3D lidars due to sparseness of data collected.
* `SpatioTemporalVoxelLayer`: 3D costmap layer for 3D lidars, non-planar 2D lidars, or depth camera processing based on temporal decay. Useful for robots with high sensor coverage like 3D lidars or many depth cameras at a reduced computational overhead due to lack of raycasting.
* `RangeLayer`: Models sonars, IR sensors, or other range sensors for costmap inclusion
* `DenoiseLayer`: Removes salt and pepper noise from final costmap in order to remove unfiltered noise. Also has the option to remove clusters of configurable size to remove effects of dynamic obstacles without temporal decay.
* `PluginContainerLayer`: Combines the costmap layers specified within this plugin, resulting in an internal costmap that is a product of the costmap layers specified under this layer. This would allow different isolated combinations of costmap layers within the same parent costmap, such as applying a different inflation layers to static layers and obstacle layers

In addition, costmap filters:

* `KeepoutFilter`: Marks keepout, higher weighted, or lower weighted zones in the costmap
* `SpeedFilter`: Reduces or increases robot speeds based on position
* `BinaryFilter`: Enables or disables a binary topic when in particular zones

Note: When the costmap filters can be paired with the `VectorObject` server to use vectorized zones rather than map rastered zones sharing the same software.

##### Symmetric Yaw Tolerance

For robots that can drive equally well forward and backward, you can set symmetric\_yaw\_tolerance: true to allow the robot to reach goals without unnecessary 180° rotations. This is especially useful for symmetric robots (e.g., differential drive robots with sensors on both ends) whereas you do not care which orientation it ends in for the controller algorithm to decide.

If you wish to control which orientation it ends in using a symmetric robot, check out [Bidirectional navigation with Nav2](https://vimeo.com/879000809) from ROSCon 2023 for setting up and tuning a bidirectional robot using Nav2. It highlights how to tune controllers, planners, and various other settings to obtain fully unbiased navigation with a platform with no traditional ‘front’.

* `SimpleGoalChecker`: Accepts the goal as reached if the robot is within tolerance of either the goal orientation or the goal orientation + 180°.
* `GoalAngleCritic (MPPI Controller)`: Scores trajectories based on the minimum angular distance to either the goal orientation or the flipped orientation.

##### Nav2 Launch Options

Nav2’s launch files are made to be very configurable. Obviously for any serious application, a user should use `nav2_bringup` as the basis of their navigation launch system, but should be moved to a specific repository for a users’ work. A typical thing to do is to have a `<robot_name>_nav` configuration package containing the launch and parameter files.

Within `nav2_bringup`, there is a main entryfile `tb3_simulation_launch.py`. This is the main file used for simulating the robot and contains the following configurations:

* `slam` : Whether or not to use AMCL or SLAM Toolbox for localization and/or mapping. Default `false` to AMCL.
* `map` : The filepath to the map to use for navigation. Defaults to `map.yaml` in the package’s `maps/` directory.
* `world` : The filepath to the world file to use in simulation. Defaults to the `worlds/` directory in the package.
* `params_file` : The main navigation configuration file. Defaults to `nav2_params.yaml` in the package’s `params/` directory.
* `autostart` : Whether to autostart the navigation system’s lifecycle management system. Defaults to `true` to transition up the Nav2 stack on creation to the activated state, ready for use.
* `use_composition` : Whether to launch each Nav2 server into individual processes or in a single composed node, to leverage savings in CPU and memory. Default `true` to use single process Nav2.
* `use_intra_process_comms` : Whether to use ROS 2’s intra-process communication for message passing between nodes. Default `false`.
* `use_respawn` : Whether to allow server that crash to automatically respawn. When also configured with the lifecycle manager, the manager will transition systems back up if already activated and went down due to a crash. Only works in non-composed bringup since all of the nodes are in the same process / container otherwise.
* `use_sim_time` : Whether to set all the nodes to use simulation time, needed in simulation. Default `true` for simulation.
* `rviz_config_file` : The filepath to the rviz configuration file to use. Defaults to the `rviz/` directory’s file.
* `use_simulator` : Whether or not to start the Gazebo simulator with the Nav2 stack. Defaults to `true` to launch Gazebo.
* `use_robot_state_pub` : Whether or not to start the robot state publisher to publish the robot’s URDF transformations to TF2. Defaults to `true` to publish the robot’s TF2 transformations.
* `use_rviz` : Whether or not to launch rviz for visualization. Defaults to `true` to show rviz.
* `headless` : Whether or not to launch the Gazebo front-end alongside the background Gazebo simulation. Defaults to `true` to display the Gazebo window.
* `namespace` : The namespace to launch robots into.
* `robot_name` : The name of the robot to launch.
* `robot_sdf` : The filepath to the robot’s gazebo configuration file containing the Gazebo plugins and setup to simulate the robot system.
* `x_pose`, `y_pose`, `z_pose`, `roll`, `pitch`, `yaw` : Parameters to set the initial position of the robot in the simulation.

##### Performance in ROS 2: RMW, Node Composition, Intra-process Communication, and QoS

In Nav2, we strongly recommend setting use\_composition to true, as it enables node composition, reduces process overhead, and generally improves system efficiency. However, whether to enable intra-process communication and which RMW implementation to use depends on your specific application.

The following table summarizes CPU usage results for different RMW implementations and intra-process communication (IPC) settings, measured on the TurtleBot4 simulation (ros2 launch nav2\_bringup tb4\_simulation\_launch.py). Baseline measurements correspond to the latest rolling commit at the time of testing (December 2025).

| Middleware | Configuration | CPU Usage (%) |
| --- | --- | --- |
| Zenoh | Baseline | 4.5% |
| Zenoh | IPC enabled (SharedPtr) | 6.0% |
| Zenoh | IPC + ConstSharedPtr | 5.8% |
| CycloneDDS | Baseline | 18.3% |
| CycloneDDS | IPC enabled (SharedPtr) | 17.8% |
| CycloneDDS | IPC + ConstSharedPtr | 16.1% |
| FastDDS | Baseline | 6.8% |
| FastDDS | IPC enabled (SharedPtr) | 7.8% |
| FastDDS | IPC + ConstSharedPtr | 7.8% |

As shown in the table, enabling intra-process communication leads to increased CPU usage for FastDDS and Zenoh, while CycloneDDS shows a reduction in CPU usage.

For more details, please refer to this post:
<https://discourse.openrobotics.org/t/performance-characteristics-subscription-callback-signatures-rmw-implementation-intra-process-communication-ipc/>

Regarding QoS, we provide the allow\_parameter\_qos\_overrides parameter, which allows you to customize QoS settings if needed.

If you have additional findings, please feel free to open a PR to share them, we would be happy to include that information here!

##### Other Pages We’d Love To Offer

If you are willing to chip in, some ideas are in <https://github.com/ros-navigation/docs.nav2.org/issues/204>, but we’d be open to anything you think would be insightful!

#### Parameters

**`NavFn Planner`**
- Type: `Circular Differential, Circular Omnidirectional`
- 

**`Smac Planner 2D`**
- Type: `unknown`
- 

**`Theta Star Planner`**
- Type: `unknown`
- 

**`Smac Hybrid-A* Planner`**
- Type: `Non-circular or Circular Ackermann, Non-circular or Circular Legged`
- 

**`Smac Lattice Planner`**
- Type: `Non-circular Differential, Non-circular Omnidirectional, Arbitrary`
- 

**`DWB controller`**
- Type: `Differential, Omnidirectional`
- 

**`MPPI Controller`**
- Type: `Differential, Omnidirectional, Ackermann, Legged`
- 

**`RPP controller`**
- Type: `Differential, Ackermann, Legged`
- 

**`Rotation Shim`**
- Type: `Differential, Omnidirectional`
- 

**`VP controller`**
- Type: `Differential, Ackermann, Legged`
- 


---

## Tutorials

### General Tutorials

*Source: [https://docs.nav2.org/tutorials/index.html](https://docs.nav2.org/tutorials/index.html)*

#### General Tutorials

Nav2 Tutorials

* [Navigating with a Physical Turtlebot 3](docs/navigation2_on_real_turtlebot3.html)
* [Navigating while Mapping (SLAM)](docs/navigation2_with_slam.html)
* [Using an External Costmap Plugin (STVL)](docs/navigation2_with_stvl.html)
* [Navigating using GPS Localization](docs/navigation2_with_gps.html)
* [Lidar-Free, Vision-Based Navigation](docs/using_isaac_perceptor.html)
* [Groot Tutorials](docs/using_groot.html)
* [Using VIO to Augment Robot Odometry](docs/integrating_vio.html)
* [Dynamic Object Following](docs/navigation2_dynamic_point_following.html)
* [Navigating with Keepout Zones](docs/navigation2_with_keepout_filter.html)
* [Navigating with Speed Limits](docs/navigation2_with_speed_filter.html)
* [Using Docking Server](docs/using_docking.html)
* [Using Rotation Shim Controller](docs/using_shim_controller.html)
* [Adding a Smoother to a BT](docs/adding_smoother.html)
* [Using Collision Monitor](docs/using_collision_monitor.html)
* [Adding a New Nav2 Task Server](docs/adding_a_nav2_task_server.html)
* [Filtering of Noise-Induced Obstacles](docs/filtering_of_noise-induced_obstacles.html)
* [Camera Calibration](docs/camera_calibration.html)
* [Get Backtrace in ROS 2 / Nav2](docs/get_backtrace.html)
* [Profiling in ROS 2 / Nav2](docs/get_profile.html)
* [Docker for Development: Zero to Hero](docs/docker_dev.html)
* [Route Server Tools](docs/route_server_tools.html)
* [Navigating with Vector Objects](docs/navigation2_with_vector_objects.html)
* [ROSCon UK 2025: State Estimation for Mobile Robotics Workshop](docs/roscon_uk_2025_state_estimation.html)
* [Enhanced Safety for Nav2 using 3Laws Supervisor](docs/using_3laws_supervisor.html)

---

### Docs

#### Adding a New Nav2 Task Server

*Source: [https://docs.nav2.org/tutorials/docs/adding_a_nav2_task_server.html](https://docs.nav2.org/tutorials/docs/adding_a_nav2_task_server.html)*

##### Adding a New Nav2 Task Server

A nav2 task server consists of server-side logic to complete different types of requests, usually called by the autonomy system or through the Behavior Tree Navigator. In this guide, we will discuss the core components needed to add a new task server to Nav2 (ex. Controller, Behavior, Smoother, Planner Servers). Namely, how to set up your new Lifecycle-Component Node for launch and state management and the communication of semantically meaningful error codes (if necessary).

While this tutorial does not cover how to add the complementary Behavior Tree Node to interact with this new Task Server, that is covered at length in [Writing a New Behavior Tree Plugin](../../plugin_tutorials/docs/writing_new_bt_plugin.html#writing-new-nbt-plugin) so this Task Server can be invoked in the BTs in BT Navigator.

If you’ve created a new Task Server that may have general reuse for the community, consider contacting the maintainers to add it to the Nav2 project! Nav2 gets better through contributions by users like you!

###### Lifecycle Nodes

The Lifecycle node is the first key component of a nav2 task server. Lifecycle nodes were introduced in ROS 2 to systematically manage the bringup and shutdown of the different nodes involved in the robot’s operation. The use of Lifecycle nodes ensures that all nodes are successfully instantiated before they begin execution and Nav2 shuts down all nodes if there is any unresponsive node.

Lifecycle nodes contain state machine transitions that enable deterministic behavior in ROS 2 servers. The Lifecycle node transitions in Nav2 are handled by the `Lifecycle Manager`. The Lifecycle Manager transitions the states of the Lifecycle nodes and provides greater control over the state of a system.

The primary states of a Lifecycle node are `Unconfigured`, `Inactive`, `Active`, and `Finalized`. A Lifecycle node starts in an `Unconfigured` state after being instantiated. The Lifecycle Manager transitions a node from `Unconfigured` to `Inactive` by implementing the `Configurating` transition. The `Configurating` transition sets up all configuration parameters and prepares any required setup such as memory allocation and the setup of the static publication and subscription topics. A node in the `Inactive` state is allowed to reconfigure its parameters but cannot perform any processing. From the `Inactive` state, the Lifecycle Manager implements the `Activating` transition state to transition the node from `Inactive` to `Active`, which is the main state. A node in the `Active` state is allowed to perform any processing operation. In case a node crashes, the Lifecycle Manager shuts down the system to prevent any critical failures. On shutdown, the necessary cleanup operations are performed and the nodes are transitioned to the `Finalized` state via `Deactivating`, `CleaningUp`, and `ShuttingDown` transition states.

See also

For more information on Lifecycle management, see the article on [Managed Nodes](https://design.ros2.org/articles/node_lifecycle.html).

You may wish to integrate your own nodes into the Nav2 framework or add new lifecycle nodes to your system. As an example, we will add a new notional lifecycle node `sensor_driver`, and have it be controlled via the Nav2 Lifecycle Manager to ensure sensor feeds are available before activating navigation. You can do so by adding a `sensor_driver` node in your launch file and adding it to the list of nodes to be activated by the `lifecycle_manager` before navigation, as shown in the example below.

```
lifecycle_nodes = ['sensor_driver',
                   'controller_server',
                   'smoother_server',
                   'planner_server',
                   'behavior_server',
                   'bt_navigator',
                   'waypoint_follower']

...

Node(
    package='nav2_sensor_driver',
    executable='sensor_driver',
    name='sensor_driver',
    output='screen',
    parameters=[configured_params],
    remappings=remappings),

Node(
    package='nav2_lifecycle_manager',
    executable='lifecycle_manager',
    name='lifecycle_manager_navigation',
    output='screen',
    parameters=[{'autostart': autostart},
                {'node_names': lifecycle_nodes}]),
```

In the snippet above, the nodes to be handled by the Lifecycle Manager are set using the `node_names` parameter. The `node_names` parameter takes in an ordered list of nodes to bringup through the Lifecycle transition. As shown in the snippet, the `node_names` parameter takes in `lifecycle_nodes` which contains the list of nodes to be added to the Lifecycle Manager. The Lifecycle Manager implements bringup transitions (`Configuring` and `Activating`) to the nodes one-by-one and in order, while the nodes are processed in reverse order for shutdown transitions. Hence, the `sensor_driver` is listed first before the other navigation servers so that the sensor data is available before the navigation servers are activated.

Two other parameters of the Lifecycle Manager are `autostart` and `bond_timeout`. Set `autostart` to `true` if you want to set the transition nodes to the `Active` state on startup. Otherwise, you will need to manually trigger Lifecycle Manager to transition up the system. The `bond_timeout` sets the waiting time to decide when to transition down all of the nodes if a node is not responding.

Note

More information on Lifecycle Manager parameters can be found in the [Configuration Guide of Lifecycle Manager](https://docs.nav2.org/configuration/packages/configuring-lifecycle.html)

###### Composition

Composition is the second key component nav2 task servers that was introduced to reduce the memory and CPU resources by putting multiple nodes in a single process. In Nav2, Composition can be used to compose all Nav2 nodes in a single process instead of launching them separately. This is useful for deployment on embedded systems where developers need to optimize resource usage.

See also

More information on Composition can be found [here](https://docs.ros.org/en/rolling/Tutorials/Intermediate/Composition.html).

In the following section, we give an example on how to add a new Nav2 server, which we notionally call the `route_server`, to our system.

We make use of the launch files to compose different servers into a single process. The process is established by the `ComposableNodeContainer` container that is populated with composition nodes via `ComposableNode`. This container can then be launched and used just like any other Nav2 node.

1. Add a new `ComposableNode()` instance in your launch file pointing to the component container of your choice.

   > ```
   > container = ComposableNodeContainer(
   >     name='my_container',
   >     namespace='',
   >     package='rclcpp_components',
   >     executable='component_container',
   >     composable_node_descriptions=[
   >         ComposableNode(
   >             package='nav2_route_server',
   >             plugin='nav2_route_server::RouteServer',
   >             name='nav2_route_server'),
   >     ],
   >     output='screen',
   > )
   > ```
   >
   > See also
   >
   > See example in composition demo’s [composition\_demo.launch.py](https://github.com/ros2/demos/blob/master/composition/launch/composition_demo.launch.py).
2. Add the package containing the server to your `package.xml` file.

   > ```
   > <exec_depend>nav2_route_server</exec_depend>
   > ```

###### Error codes

Your nav2 task server may also wish to return a ‘error\_code’ and ‘error\_msg’ in its action response (though not required). If there are semantically meaningful and actionable types of failures for your system, this is a systemic way to communicate those failures which may be automatically aggregated into the responses of the navigation system to your application.

It is important to note that error codes from 0-9999 are reserved for internal nav2 servers with each server offset by 100 while external servers start at 10000 and end at 65535.
The table below shows the current servers along with the expected error code structure.

| Server Name | Reserved | RANGE |
| --- | --- | --- |
| … | NONE=0, UNKNOWN=1 | 2-99 |
| [Controller Server](https://github.com/ros-navigation/navigation2/blob/main/nav2_controller/src/controller_server.cpp) | NONE=0, UNKNOWN=100 | 101-199 |
| [Planner Server](https://github.com/ros-navigation/navigation2/blob/main/nav2_planner/src/planner_server.cpp) (compute\_path\_to\_pose) | NONE=0, UNKNOWN=200 | 201-299 |
| [Planner Server](https://github.com/ros-navigation/navigation2/blob/main/nav2_planner/src/planner_server.cpp) (compute\_path\_through\_poses) | NONE=0, UNKNOWN=300 | 301-399 |
| … | … |  |
| [Smoother Server](https://github.com/ros-navigation/navigation2/blob/main/nav2_smoother/src/nav2_smoother.cpp) | NONE=0, UNKNOWN=500 | 501-599 |
| [Waypoint Follower Server](https://github.com/ros-navigation/navigation2/blob/main/nav2_waypoint_follower/src/waypoint_follower.cpp) | NONE=0, UNKNOWN=600 | 601-699 |
| [Behavior Server](https://github.com/ros-navigation/navigation2/blob/main/nav2_behaviors/src/behavior_server.cpp) | NONE=0 | 701-799 |
| Coverage Server | NONE=0, UNKNOWN=800 | 801-899 |
| … | … |  |
| Last Nav2 Server | NONE=0, UNKNOWN=8900 | 8901-8999 |
| … | … |  |
| [Navigator](https://github.com/ros-navigation/navigation2/blob/main/nav2_bt_navigator/) - (nav\_to\_pose) | NONE=0, UNKNOWN=9000 | 9001-9099 |
| [Navigator](https://github.com/ros-navigation/navigation2/blob/main/nav2_bt_navigator/) - (nav\_thru\_poses) | NONE=0, UNKNOWN=9100 | 9101-9199 |
| [Navigator](https://github.com/ros-navigation/navigation2/blob/main/nav2_bt_navigator/) - Last Navigator | NONE=0, UNKNOWN=9900 | 9901-9999 |
| … | … |  |
| First External Server | NONE=0, UNKNOWN=10000 | 10001-10099 |
| … | … |  |

Error codes and messages are attached to the response of the action message. An example can be seen below for the route server. Note it is necessary to set the error code field within the message result definition to `error_code` and the error message field to `error_msg`.

```
##### Error codes
##### Note: The expected priority order of the errors should match the message order
uint16 NONE=0 # 0 is reserved for NONE
uint16 UNKNOWN=10000 # first error code in the sequence is reserved for UNKNOWN

##### User Error codes below
int16 INVALID_START=10001
int16 NO_VALID_ROUTE=10002

#goal definition
route_msgs/PoseStamped goal
route_msgs/PoseStamped start
string route_id
---
#result definition
nav_msgs/Route route
builtin_interfaces/Duration route_time
uint16 error_code
string error_msg
---
```

As stated in the message, the priority order of the error codes should match the message order, 0 is reserved for NONE and the first error code in the sequence is reserved for UNKNOWN.
Since the route server is a external server, the error codes start at 10000 and go up to 10099.

To ensure your server’s error codes, and associated error messages, are properly communicated throughout the system, you need to configure them in your nav2\_params.yaml file.

The BT Navigator parameter error\_code\_name\_prefixes defines a list of prefixes used to search the behavior tree blackboard for the existence and content of error codes and error messages keys, that may have been generated. If the blackboard contains multiple error code keys then the lowest error code value of the sequence, and associated error message, is then returned in the result of the navigator action message. Error code enums increase the higher up they occur in the software stack. In other words higher priority is given to reporting lower-level failures.

```
error_code_name_prefixes:
  - assisted_teleop
  - backup
  - compute_path
  - dock_robot
  - drive_on_heading
  - follow_path
  - nav_thru_poses
  - nav_to_pose
  - spin
  - route
  - undock_robot
  - wait
```

###### Conclusion

In this section of the guide, we have discussed Lifecycle Nodes, Composition and Error Codes which are new and important concepts in ROS 2. We also showed how to implement Lifecycle Nodes, Composition and Error Codes to your newly created nodes/servers with Nav2. These three concepts are helpful to efficiently run your system and therefore are encouraged to be used throughout Nav2.

#### Parameters

**`…`**
- Type: `unknown`
- 

**`Controller Server`**
- Type: `unknown`
- 

**`Planner Server(compute_path_to_pose)`**
- Type: `unknown`
- 

**`Planner Server(compute_path_through_poses)`**
- Type: `unknown`
- 

**`…`**
- Type: `unknown`
- 

**`Smoother Server`**
- Type: `unknown`
- 

**`Waypoint Follower Server`**
- Type: `unknown`
- 

**`Behavior Server`**
- Type: `unknown`
- 

**`Coverage Server`**
- Type: `unknown`
- 

**`…`**
- Type: `unknown`
- 

**`Last Nav2 Server`**
- Type: `unknown`
- 

**`…`**
- Type: `unknown`
- 

**`Navigator- (nav_to_pose)`**
- Type: `unknown`
- 

**`Navigator- (nav_thru_poses)`**
- Type: `unknown`
- 

**`Navigator- Last Navigator`**
- Type: `unknown`
- 

**`…`**
- Type: `unknown`
- 

**`First External Server`**
- Type: `unknown`
- 

**`…`**
- Type: `unknown`
- 


---

#### Adding a Smoother to a BT

*Source: [https://docs.nav2.org/tutorials/docs/adding_smoother.html](https://docs.nav2.org/tutorials/docs/adding_smoother.html)*

##### Adding a Smoother to a BT

* [Overview](#overview)
* [Requirements](#requirements)
* [Tutorial Steps](#tutorial-steps)

[![../../_images/smoothing_path.png](../../_images/smoothing_path.png)](../../_images/smoothing_path.png)

###### Overview

This tutorial shows how to add a smoother to your behavior tree to smooth output paths from a path planner.
Before completing this tutorials, completing [Getting Started](../../getting_started/index.html#getting-started) is highly recommended especially if you are new to ROS and Nav2.

###### Requirements

You must install Nav2, Turtlebot3.
If you don’t have them installed, please follow [Getting Started](../../getting_started/index.html#getting-started).
You must also have a working behavior tree, such as those provided by the Nav2 BT Navigator package, for editing.
You should also have a copy of the `nav2_params.yaml` file for your system to edit as well.

###### Tutorial Steps

###### 0- Familiarization with the Smoother BT Node

The [SmoothPath](../../configuration/packages/bt-plugins/actions/Smooth.html#bt-smooth-action) BT node is a behavior tree node that interacts with the smoother task server similar to that which you may expect to find for the planner or controller servers. It contains the action client to call the server and specifies its arguments and return types as BT ports. It too calls the server via an action interface that may be separately interacted with via other servers and client library languages.

Please see the BT node’s configuration page to familiarize yourself with all aspects, but the core ports to note are the `unsmoothed_path` input port and the `smoothed_path` output port. The first takes in a raw path from a planning algorithm and the latter will set the value of the smoothed output path post-smoothing. Other ports are available that fully implements the Smoother Server’s action API.

###### 1- Specifying a Smoother Plugin

In order to use a smoother in your BT node, you must first configure the smoother server itself to contain the smoother plugins of interest. These plugins implement the specific algorithms that you would like to use.

For each smoother plugin you would like to use, a name must be given to it (e.g. `simple_smoother`, `curvature_smoother`). This name is its `smoother_id` for other servers to interact with this algorithm from a request to the Smoother Server’s action interface.

Under each name, the parameters for that particular algorithm must be specified along with the `plugin` name for pluginlib to load a given algorithm’s library. An example configuration of 2 smoother plugins is shown below that could be used in the `nav2_params.yaml` for your robot.

```
smoother_server:
  ros__parameters:
    costmap_topic: global_costmap/costmap_raw
    footprint_topic: global_costmap/published_footprint
    robot_base_frame: base_link
    transform_tolerance: 0.1
    smoother_plugins: ["simple_smoother", "curvature_smoother"]
    simple_smoother:
      plugin: "nav2_smoother::SimpleSmoother"
      tolerance: 1.0e-10
      do_refinement: True
    curvature_smoother:
      plugin: "nav2_smoother::SavitzkyGolaySmoother"
```

###### 2- Modifying your BT XML

Now that you have selected and configured the smoother server for your given plugin(s), it is time to use those smoother(s) in your behavior tree for navigation behavior. While there are many places / ways to use this in a BT, what is shown below is probably the most likely situation you would want to use the smoother in (to smooth a path returned by the path planner and then using that smoothed path for path tracking).

Note: If you use only a single type of smoothing algorithm, there is no need to specify the `smoother_id` in the BT XML entry. Since there is only a single option, that will be used for any request that does not specifically request a smoother plugin. However, if you leverage multiple smoother plugins, you **must** populate the `smoother_id` XML port.

A given behavior tree will have a line:

```
<ComputePathToPose goal="{goal}" path="{path}" planner_id="GridBased" error_code_id="{compute_path_error_code}" error_msg="{compute_path_error_msg}"/>
```

This line calls the planner server and return a path to the `path` blackboard variable in the behavior tree. We are going to replace that line with the following to compute the path, smooth the path, and finally replace the `path` blackboard variable with the new smoothed path that the system will now interact with:

```
<Sequence name="ComputeAndSmoothPath">
  <ComputePathToPose goal="{goal}" path="{path}" planner_id="GridBased" error_code_id="{compute_path_error_code}" error_msg="{compute_path_error_msg}"/>
  <SmoothPath unsmoothed_path="{path}" smoothed_path="{path}" error_code_id="{smoother_error_code}" error_msg="{smoother_error_msg}"/>
</Sequence>
```

Hint

When using this sequence inside a `PipelineSequence` node, it is recommended to remap the smoothed path to a different blackboard variable (e.g. `smoothed_path="{smoothed_path}"`).

This is because the `PipelineSequence` re-ticks all previous children when any child returns `RUNNING`. If `FollowPath` returns `RUNNING`, the `PipelineSequence` will re-tick `ComputePathToPose`, which will try to overwrite the `path` variable used by `FollowPath`.

If you wish to have recoveries for the smoother error codes, such as triggering the system recoveries branch of a behavior tree:

```
<Sequence name= "TryToResolveSmootherErrorCodes">
  <WouldASmootherRecoveryHelp error_code="{smoother_error_code}" error_msg="{smoother_error_msg}">
  <!-- recovery to resolve smoother error code goes here -->
<Sequence/>
```

And its as simple as that! You can now compile or use this behavior tree in your system and see that the plans are now smoothed and the controllers are now tracking this smoothed path. The image at the top of the tutorial shows the unsmoothed path from NavFn (red) and the smoothed path (black). Note the smoother approach to goal, turns, and transitions in the straight-line segments. Make sure to add the smoother error code prefix to the BT Navigator configuration if using the contextual error codes.

If you wish to see the difference, but not track the smoothed path, you may wish to remove the `smoothed_path="{path}"` portion to compute the smoothed path, but not replace the original path with it. Instead, the topic `/smoothed_path` contains this information published by the smoother server for visualization or use by other parts of the system. You may also remap the smoothed path to another blackboard variable to interact with it in other parts of the behavior tree (e.g. `smoothed_path="{smoothed_path}"`).

---

#### Camera Calibration

*Source: [https://docs.nav2.org/tutorials/docs/camera_calibration.html](https://docs.nav2.org/tutorials/docs/camera_calibration.html)*

##### Camera Calibration

* [Overview](#overview)
* [Requirements](#requirements)
* [Tutorial Steps](#tutorial-steps)

###### Overview

This tutorial shows how to obtain calibration parameters for monocular camera.

###### Requirements

1- Install Camera Calibration Parser, Camera Info Manager and Launch Testing Ament Cmake using operating system’s package manager:

> `sudo apt install ros-<ros2-distro>-camera-calibration-parsers`
>
> `sudo apt install ros-<ros2-distro>-camera-info-manager`
>
> `sudo apt install ros-<ros2-distro>-launch-testing-ament-cmake`

2- Image Pipeline need to be built from source in your workspace with:

> `git clone -b <ros2-distro> git@github.com:ros-perception/image_pipeline.git`

**Also, make sure you have the following:**

> * A large checkerboard with known dimensions. This tutorial uses a 7x9 checkerboard with 20mm squares. **Calibration uses the interior vertex points of the checkerboard, so an “8x10” board uses the interior vertex parameter “7x9” as in the example below.** The checkerboard with set dimensions can be downloaded from [here](https://calib.io/pages/camera-calibration-pattern-generator).
> * A well-lit area clear of obstructions and other check board patterns
> * A monocular camera publishing images over ROS

###### Tutorial Steps

1- Start a terminal in your GUI

2- Launch the ROS driver for your specific camera.

3- Make sure camera is publishing images over ROS. This can be tested by running:

> `ros2 topic list`

4- This will show you all the topics published make sure that there is an image\_raw topic /camera/image\_raw. To confirm that its a real topic and actually publishing check topic hz:

> `ros2 topic hz /camera/image_raw`

> [![../../_images/ROS2_topic_hz.png](../../_images/ROS2_topic_hz.png)](../../_images/ROS2_topic_hz.png)

5- Start the camera calibration node

> `ros2 run camera_calibration cameracalibrator --size 7x9 --square 0.02 --ros-args -r image:=/my_camera/image_raw -p camera:=/my_camera`

```
  Camera Name:

  -c, --camera_name
          name of the camera to appear in the calibration file


  Chessboard Options:

  You must specify one or more chessboards as pairs of --size and--square options.

    -p PATTERN, --pattern=PATTERN
                      calibration pattern to detect - 'chessboard','circles', 'acircles','charuco'
    -s SIZE, --size=SIZE
                      chessboard size as NxM, counting interior corners (e.g. a standard chessboard is 7x7)
    -q SQUARE, --square=SQUARE
                      chessboard square size in meters

  ROS Communication Options:

   --approximate=APPROXIMATE
                      allow specified slop (in seconds) when pairing images from unsynchronized stereo cameras
   --no-service-check
                      disable check for set_camera_info services at startup

  Calibration Optimizer Options:

   --fix-principal-point
                      fix the principal point at the image center
   --fix-aspect-ratio
                      enforce focal lengths (fx, fy) are equal
   --zero-tangent-dist
                      set tangential distortion coefficients (p1, p2) to
                      zero
   -k NUM_COEFFS, --k-coefficients=NUM_COEFFS
                      number of radial distortion coefficients to use (up to
                      6, default 2)
   --disable_calib_cb_fast_check
                      uses the CALIB_CB_FAST_CHECK flag for findChessboardCorners

This will open a calibration window which highlight the checkerboard.
```

> [![../../_images/window1.png](../../_images/window1.png)](../../_images/window1.png)

6- In order to get a good calibration you will need to move the checkerboard around in the camera frame such that:

> * checkerboard on the camera’s left, right, top and bottom of field of view
>   :   ◦ X bar - left/right in field of view
>
>       ◦ Y bar - top/bottom in field of view
>
>       ◦ Size bar - toward/away and tilt from the camera
> * checkerboard filling the whole field of view
> * checkerboard tilted to the left, right, top and bottom (Skew)

> [![../../_images/calibration.jpg](../../_images/calibration.jpg)](../../_images/calibration.jpg)

7- As the checkerboard is moved around the 4 bars on the calibration sidebar increases in length. When all then the 4 bars are green and enough data is available for calibration the CALIBRATE button will light up. Click it to see the results. It takes around the minute for calibration to take place.

> [![../../_images/greenbars.png](../../_images/greenbars.png)](../../_images/greenbars.png)

8- After the calibration is completed the save and commit buttons light up. And you can also see the result in terminal.

> [![../../_images/calibration_complete.png](../../_images/calibration_complete.png)](../../_images/calibration_complete.png)

> [![../../_images/calibration_parameters.png](../../_images/calibration_parameters.png)](../../_images/calibration_parameters.png)

9-Press the save button to see the result. Data is saved to “/tmp/calibrationdata.tar.gz”

10-To use the the calibration file unzip the calibration.tar.gz
:   `tar -xvf calibration.tar.gz`

11-In the folder images used for calibration are available and also “**ost.yaml**” and “**ost.txt**”. You can use the yaml file which contains the calibration parameters as directed by the camera driver.

#### Parameters

**`checkerboard on the camera’s left, right, top and bottom of field of view`**
- Type: `unknown`
- ◦ X bar - left/right in field of view◦ Y bar - top/bottom in field of view◦ Size bar - toward/away and tilt from the camera

**`10-To use the the calibration file unzip the calibration.tar.gz`**
- Type: `unknown`
- tar-xvfcalibration.tar.gz


---

#### Docker for Development: Zero to Hero

*Source: [https://docs.nav2.org/tutorials/docs/docker_dev.html](https://docs.nav2.org/tutorials/docs/docker_dev.html)*

##### Docker for Development: Zero to Hero

* [Overview](#overview)
* [Preliminaries](#preliminaries)
* [Important Docker Commands](#important-docker-commands)
* [Exploring Your First Container](#exploring-your-first-container)
* [Understanding ROS Docker Images](#understanding-ros-docker-images)
* [For Docker-Based Development](#for-docker-based-development)
* [For Docker-Based Deployment](#for-docker-based-deployment)
* [Conclusion](#conclusion)
* [Appendix](#appendix)

###### Overview

This tutorial is a hands on walkthrough from your first Docker usage to commands and processes you can use for development of ROS 2 applications using Docker.
This is not an exhaustive introduction by any stretch, but should help you go from nothing to a functional process you can use on a daily basis for development and testing.
If you know some basics about Docker already, you can skip to later sections about development and deployment.
You’ll also find a set of Docker images in the Appendix to this tutorial which are useful for developing with Nav2 or a containerized deployment of it.
The same process template can be used for other company applications and projects as well.

Some other useful resources:

* [Articulated Robotics](https://www.youtube.com/watch?v=XcJzOYe3E6M) 4-part series on Docker covering different detail and focuses in video format.
* [Docker Documentation](https://docs.docker.com/) for comprehensive information
* [OSRF DockerHub](https://hub.docker.com/_/ros/) containing docker images for various ROS distributions and install packages and its [source images](https://github.com/osrf/docker_images/tree/master/ros).

###### Preliminaries

Docker is a tool used to build, deploy, test, and otherwise work with software in an isolated environment, called a *container*.
This diffs from a VM in that it shares the same linux kernel as your host operating system, making it faster to spin up and share host resources.
By building or deploying software in this isolated environment, you can ensure many users, robots, or servers are running the same software with the same software versions across many instances.
It gives you a controlled environment to work in that is reproducible on other developer’s machines and even work in a different (linux-based) operating system than your computer currently runs.
For example, you can run a 22.04 Docker container that contains ROS 2 Humble on Nvidia Jetson’s Jetpack 5.1 (which is a flavor of 20.04) and deploy that container to a fleet of robots.

In common Docker language, an *image* is the built `Dockerfile` which can be used to create *containers*.
Thus, *containers* are self-contained, runnable instances of the docker *image*.
The `Dockerfile` is a set of instructions for how to build an image to create some kind of environment to work in - and often contain applications to deploy in that environment.
The Dockerfile instruct sets have a number of options such as:

* `ARG`: Obtain build-time arguments
* `FROM`: Specify a base image to build from
* `RUN`: Run a particular command
* `WORKDIR`: Set the working directory
* `COPY`: Copy a file or directory
* `ENV`: Set an environmental variable

Most of these are self explanatory, but you can reference the Docker documentation to learn more and see the full set.

Two special commands worth highlighting are `CMD` and `ENTRYPOINT` which you will see at the bottom of many `Dockerfile` s.

* `ENTRYPOINT`: A command to execute when the container is spun up which cannot be overridden
* `CMD`: A command to execute when a container is spun up which can be overridden

In the context of ROS Docker containers, you’ll see that these create a bash session and execute a `ros_entrypoint.sh` script.
This script simply sources the ROS environment `/opt/ros/.../setup.bash` for your distribution so when you open the container, you’re ready to go.
But these can be used to do more advanced things like run your application or trigger other events.

###### Important Docker Commands

Similarly unexhaustively, it is important to discuss a few docker commandline commands before we move forward.
There are many others, but these are the basic commands which we will use in this walkthrough and likely the most common you’ll use on the day-to-day.
Over the tutorial, build up some important option flags for each, but for now lets talk about the basics:

* `docker run`: Runs a given docker image to create a container
* `docker build`: Builds a Dockerfile to create an image
* `docker pull / push`: Pulls a docker image from another location or pushes a built image to another location
* `docker stop / kill`: Stops or kills a running docker container
* `docker ps`: Lists a set of docker images that are currently running
* `docker attach`: Attach a terminal to a background running docker container
* `docker exec`: Execute a command in a provided container
* `docker images`: Lists a set of containers pulled or built on your computer

###### Exploring Your First Container

Lets start this tutorial with getting the latest-and-greatest of ROS 2 Rolling.
Using the OSRF DockerHub server, we can pull down a number of different ROS 2 docker images to work with without having to create a Dockerfile or build them ourselves.

```
sudo docker pull osrf/ros:rolling-desktop-full
```

You should then see the following, where the image is being pulled down in multiple layers and finally returning the terminal once complete.

```
steve@reese:~$ sudo docker pull osrf/ros:rolling-desktop-full
rolling-desktop-full: Pulling from osrf/ros
31bd5f451a84: Already exists
d36cae3fb404: Already exists
8d68f36a56a7: Already exists
299f725c4bf1: Already exists
6e16227afc48: Already exists
02457a85146c: Downloading   83.7MB/106.5MB
fe0cbdee2808: Download complete
4b4dbddf506a: Downloading  92.86MB/98.14MB
0da90b52c355: Download complete
64de492566b2: Download complete
167d95ac0fce: Download complete
e727072615d0: Downloading  82.61MB/809.8MB
d15e176ed0af: Waiting
```

If you then attempt to run this image as a container (the instance of the image):

```
sudo docker run osrf/ros:rolling-desktop-full
```

You should see that it runs for a second then exits the terminal. Yay! It works! But… that’s not very useful, now is it?
Our `ENTRYPOINT` for the ROS 2 Docker images only sources the ROS 2 installation and so the program returns as completed.
If we want to get into the container to do something useful for ourselves in that environment, we need to open an interactive terminal session with the container.
This is easy to do with the `-it` flags:

```
sudo docker run -it osrf/ros:rolling-desktop-full
```

You should now see a terminal session open with a command prompt of `root@<some hash>:/#`.
This is your docker container.
Take a look around, it should look like any other linux OS.
If you go into `/opt/ros/rolling`, it should look familiar to you!

---

If you open a new terminal and run `sudo docker ps`, you should see now one container instance running on your system.
The ID of this container should match the hash in your command prompt.
We mentioned before that the container on spin up will automatically source the ROS installation, so we should be able to immediately play around:

```
echo $ROS_DISTRO  # --> rolling
ros2 run demo_nodes_cpp talker # --> [INFO] [1707513434.798456374] [talker]: Publishing: 'Hello World: 1'
touch navigator_dockerlayer.txt
l # <-- you should see this file
```

Nice! It all works. Now, if we exit our interactive session (type `exit`), we should reenter our computer.
In that second terminal, if you rerun `sudo docker ps`, you should see that the list of containers is now empty since our container is no longer running.
If you want to see a full list of containers, including exited containers, you can use the flag `-a` to display all containers.

```
steve@reese:~$ sudo docker ps -a
CONTAINER ID   IMAGE                           COMMAND                  CREATED         STATUS                          PORTS     NAMES
7ec0e0b7487f   osrf/ros:rolling-desktop-full   "/ros_entrypoint.sh …"   5 minutes ago   Exited (0) About a minute ago             strange_tesla
9ccd97ac14f9   osrf/ros:rolling-desktop-full   "/ros_entrypoint.sh …"   7 minutes ago   Exited (0) 7 minutes ago                  zen_perlman
```

You can see that our container exited successfully. If we now run our docker image again, you should see it back listed without `-a`.

```
sudo docker run -it osrf/ros:rolling-desktop-full
```

While we’re here, lets `ls` our container. Oh no! Our `navigator_dockerlayer.txt` file is missing!
That’s completely to be expected. When we exit the container, that instance of the image is destroyed - never again to be seen.
When we run the image again, we’re generating a brand new, clean instance of the image.
Nothing persists. This is an important behavior to understand moving forward.
For development, this is nightmare fuel of losing a day’s work by hitting the wrong button.
For deployment, this is a blessing as you can cleanly restart with no artifacts from a previously failed session and start with a clean slate.
We’ll discuss how to persist data between sessions later on in the tutorial, so fear not!

---

With our new container still open, lets explore how to work with one container across multiple terminals. If you were to run the `docker run` command in two terminals, you’d make two separate containers isolated from each other.
Instead, we need to open a new session in the container. Looking at the terminal’s hash or `sudo docker ps` to find its ID, use the `exec` command to execute the command `bash` in the container.

```
sudo docker exec -it bce2ad161bf7 bash  # <-- use your ID
```

This opens a new interactive session to the container and `exec` -utes the command `bash` to give us a shell to work with (`CMD` in our Dockerfile does this for us for the spin up terminal).
Since this isn’t a newly spun up container, the `ENTRYPOINT` script wasn’t run. If you try to run the talker demo again, it won’t find the `ros2` command.
Fear not, simply source your `/opt/ros/rolling/setup.bash` install and you’re good to go.

In either terminal session in the container, if you create a new file, you should be able to see it in the other since this is the same container!

```
touch navigator_alligator.txt
ls # <-- see the new file
##### move to the other terminal
ls # <-- also see new file
```

Now we can do something fun while we have both terminals of the same docker container open. Lets run the classic talker/listener demo. In each of the two terminals, run one of these commands.

```
ros2 run demo_nodes_cpp talker
ros2 run demo_nodes_py listener
```

---

If you now open a third terminal to your computer and run `ros2 topic list`, you’ll see a notable lack of topics.

```
steve@reese:~$ ros2 topic list
/parameter_events
/rosout
```

What gives? The container is isolated from your host system, so anything happening in the container is currently unavailable to your main computer.
Lets exit our two container terminal instances (`exit`) and talk about some more `docker run` flags that are useful to know.
This time, we want to expose ROS to our broader system, including our host computer. This time, we’ll use the flag `--net=host`, this sets the network to look like the host system (i.e. your computer).

```
sudo docker run -it --net=host osrf/ros:rolling-desktop-full
```

In this session, if we run the talker `ros2 run demo_nodes_py talker`, now we should be able to subscribe to it from our host computer!

```
steve@reese:~$ ros2 topic echo /chatter
data: 'Hello World: 0'
---
data: 'Hello World: 1'
---
data: 'Hello World: 2'
---
```

---

Lets talk about how to keep a container running for longer than than your interactive terminal session.
There are many reasons you want a container to outlive you or run in the background, so that’s what the `-d` flag is for, or detached.
Lets start off by showing that there are no containers running with `sudo docker ps`. Next start a new container with the flag.

```
sudo docker run -it --net=host -d osrf/ros:rolling-desktop-full
```

You’ll see the command run for a moment and return. `sudo docker ps` should now show a container running.
Copy that container ID and we can now `attach` to it:

```
sudo docker attach e1d7e035a824  # <-- use your ID
```

You should now be in the terminal session. After you do your work, if you want to stop the container, you can exit as we have been in this tutorial (`exit`) and that will also stop the container.
If you wish to leave the container running, you can use the key sequence Control+P+Q to exit but leave the container running.
In either case, you can show that to yourself using `ps`.
If you left it running and now wish to stop it externally, you can do so with the following. It may take a few moments to exit.

```
sudo docker stop e1d7e035a824  # <-- use your ID
```

---

Finally, `docker images` is a command used to tell you what docker images you have built or pulled which are available for use. This list will expand over time and is a useful resource to see what you have to work with.

```
steve@reese:~$ sudo docker images
REPOSITORY   TAG                    IMAGE ID       CREATED        SIZE
osrf/ros     rolling-desktop-full   7cd0c5068235   6 days ago     3.86GB
```

Note

If errors are seen *Failed to create Shared Memory Manager* or similar, use the `--shm-size=100mb` command to increase the shared memory buffer size in the container.

###### Understanding ROS Docker Images

Now that we know a bit about Docker’s basic features and explored the Rolling Desktop Full container, lets look at the Docker images you have to work with in ROS in more detail.
OSRF hosts a DockerHub server containing images of all ROS distributions which you can pull and use.
For each distribution, there are a couple of variants:

* `ros-core`: Contains only the ROS core communication protocols and utilities
* `ros-base`: Contains `ros-core` and other core utilities like pluginlib, bond, actions, etc
* `perception`: Contains `ros-base` and image common, pipeline, laser filters, laser geometry, vision opencv, etc
* `desktop`: Contains `ros-base` and tutorials, lifecycle, rviz2, teleop, and rqt
* `desktop-full`: Contains `desktop`, `perception` and simulation

These are the same as if you were to use apt install ros-rolling-desktop-full, but in container form.
Each of those containers build off of the previous one using `FROM` and then install the binaries described to serve to the container user.
Which you use depends on your application and needs, but `osrf/ros:<distro>-ros-base` is a good default for development and deployment.
We’re using desktop-full in the context of this tutorial for ease of having rviz2 and such built-in batteries-included.

You can pull and use them the same way as before, for example:

```
sudo docker pull ros:rolling-ros-base
sudo docker pull osrf/ros:humble-desktop
```

Note that some containers may require `osrf/` and others may not. The `osrf/` images are released by osrf while the non-prefixed are a part of the official docker libraries.
In general, the desktop installs are with `` osrf/` `` and the ros core and base are without.

###### For Docker-Based Development

As mentioned previously, if we create and modify files in the Docker container, these do not persist after the container is exited.
If we want to do some development work that will persist between images, it is wise to *mount* a *volume* to the docker container when we run it.
That is just fancy talk for linking a given set of directories from your host company to the container so that they can be read, modified, and deleted within the container and reflected on the outside.
That way, your work will persist even if you close a container in your local filesystem as if it were developed without the use of a container.
An awesome feature of this is that you can actually build your workspace in one container, destroy that container, and then continue development and rebuild in a new container instance later provided that (1) the same image is used both times and (2) the mounted location within the container is the same each time.

We accomplish this using the `-v` flag (for volume). There are other options to do this as well, but this is the most straight forward.
It takes in the argument in the form `-v what/local/dir:/absolute/path/in/container`.
If we start a container in our workspace’s root, the following will launch the docker container, sharing the host’s network, and putting your workspace (`.`) into the container under the directory `/my_ws_docker`:

```
sudo docker run -it --net=host -v .:/my_ws_docker  osrf/ros:rolling-desktop-full

ls
cd my_ws_docker
touch navigator_activator.txt
```

If you go to your workspace in another terminal, you should now see that file reflected on your computer! If we run rosdep to install our dependencies in the docker container, we should now be able to build your workspace.

```
apt update
rosdep init
rosdep update
rosdep install -r -y --from-paths . --ignore-src
colcon build
```

Now, you can make any changes to your code using VSCode or your favorite code editor and have it reflected in the container for building and testing!
This is especially powerful if you’re working with multiple ROS distributions or with a ROS distribution which your host OS doesn’t natively support (such as Humble on Jetpack 5.1 on Nvidia Jetsons).
However, it does get annoying over time to have to wait for all of your dependencies to install manually when you spin up a new container.
Thus, it is useful to build atop one of the provided ROS Docker images to create your own custom development image containing the packages and environment you need to build your application.
That way, you can simply jump into the container and immediately start building.

###### Building a Development Image

Building a new container is easy. The organization instructions of Docker images are outlined in `Dockerfile` s.
Typically, they start with an import `FROM` to set the starting container to build off of. In our case, a ROS 2 Rolling image.
Then, we run a series of `RUN` commands to perform actions to setup our dependencies so we can have them ready for use when we launch a container.
In the `Appendix`, you’ll find an example development image that you can use to develop on Nav2. It starts with Rolling `ros-base`, downloads Nav2, and runs rosdep over its packages to install all dependencies.
Once these steps conclude, the image is all setup for any later Nav2 build.

You can build this image using `docker build`

```
sudo docker build -t nav2deps:rolling .
```

Where `-t` sets the tagged name of the container for later use.
Its important to note that even though your install and build spaces will be reflected in your host workspace, they cannot be run locally when compiled inside of a docker container.
This example development image also upgrades packages which breaks strict version controlling of system and `ros-base` installed packages.
For a deployment situation, you want to ensure you have the same version of all packages – however for ROS 2 Rolling where ABI and API are not promised to be stable due to live development,
it is useful to upgrade so that your source code can build against the latest and greatest.

###### Visualizations from Docker

Some that skip ahead at this point might notice that when launching their applications which involve a GUI (RQT, Rviz2, Gazebo), it crashes and never appears.
Docker’s isolation isn’t just for networking, but also in visualization and other assets.
Thus, we must specifically enable carve outs for GUIs to appear on our screens.

* `--privileged`: Bypasses many of the checks to field the container from the host system. A hammer smashing isolation.
* `--env="DISPLAY=$DISPLAY`: Sets display to use for GUI
* `--volume="${XAUTHORITY}:/root/.Xauthority"`: Gets important info from the XServer for graphics display

Putting it altogether, you should now be able to open rviz2 inside of the docker container!

```
sudo docker run -it --net=host --privileged \
    --env="DISPLAY=$DISPLAY" \
    --volume="${XAUTHORITY}:/root/.Xauthority" \
    osrf/ros:rolling-desktop-full
```

```
rviz2
```

At this point, if you have an error remaining, please check docs for the right flags to use.
(Even if you copy+paste around, it shouldn’t take you more than 10 minutes to find a combo that works.)
If you’re on Nvidia Jetson hardware, reference their documentation for the correct set of flags for your Jetpack version.

###### For Docker-Based Deployment

We won’t belabor the details, but Docker is not just for development, but for application deployment as well.
You can run instances of your image on robots, cloud servers, etc as self-containing micro-services or robot application systems.

Typically speaking, you would set your `ENTRYPOINT` to launch a script which brings up and runs your server(s) for your application.
For example, you could use the deployment image in the `Appendix` with an `ENTRYPOINT` to launch your root robot navigation launch file `tb3_simulation_gazebo_launch.py`, or similar.
You could even have the container launch on bringup using `systemd` in order to have your application automatically launch, containerized, on system startup.

###### Conclusion

At the end of this, you should be able to now:

* Pull the official ROS 2 docker images of any ROS distribution and choose the right type of image for your needs
* Understand how ROS 2 docker containers are formatted and the core part of `Dockerfile` image descriptions
* Understand Docker’s filesystem and network isolation – and how to bypass it for important use-cases in development
* Be able to detach your docker containers for long-running processes
* Mount your development workspace to the container to work in
* Build your own docker image off of ROS’ for your development dependencies and setup needs
* Visualization and simulation with GUI in docker

Its useful to note at this point that the `--privileged` flag is a real hammer. If you want to avoid running this, you can find all the individual areas you need to enable for visualization to work.
Also note that `--privileged` also makes it easier to run hardware interfaces like joysticks and sensors by enabling inputs from the host operating system that are processing those inputs.
If in production, you cannot use a hammer, you may need to dig into your system a bit to allow through only the interfaces required for your hardware.

As for potential steps forward:

* Setup a config file to hide all those docker run arguments for development
* Setup a bash script to enable several different configurations of docker run and execute the run itself
* Learn more about Docker’s options and features such as [compose](https://docs.docker.com/compose/), pushing your own containers to DockerHub, and version controlling images
* Limit and regulate host resource utilization
* [Configure computer](https://docs.docker.com/engine/install/linux-postinstall/#manage-docker-as-a-non-root-user) to avoid use of `sudo` for each docker CLI command.
* Consider production considerations like build cache management, security, multi-stage builds, and such to get the most out of Docker

We hope that’s enough to get you started!

– Your Friendly Neighborhood Navigators

###### Appendix

###### Nav2 Development Image

This container downloads, but does not install Nav2.
Instead, it pulls the dependencies so that when you run this container, you obtain everything needed to immediately start building and working with Nav2 on any ROS 2 distribution, including Rolling.

```
ARG ROS_DISTRO=rolling
FROM ros:${ROS_DISTRO}-ros-core

RUN apt update \
    && DEBIAN_FRONTEND=noninteractive apt install -y --no-install-recommends --no-install-suggests \
  ros-dev-tools \
  wget

WORKDIR /root/nav2_ws
RUN mkdir -p ~/nav2_ws/src
RUN git clone https://github.com/ros-navigation/navigation2.git --branch main ./src/navigation2
RUN rosdep init
RUN apt update && apt upgrade -y \
    && rosdep update \
    && rosdep install -y --ignore-src --from-paths src -r
```

###### Nav2 Deployment Image

This image either downloads and installs Nav2 (Rolling; from source) or installs it (from binaries) to have a self contained image of everything you need to run Nav2.
From here, you can go to the [Getting Started](../../getting_started/index.html#getting-started) to test it out!

```
ARG ROS_DISTRO=rolling
FROM ros:${ROS_DISTRO}-ros-core

RUN apt update \
    && DEBIAN_FRONTEND=noninteractive apt install -y --no-install-recommends --no-install-suggests \
  ros-dev-tools \
  wget

##### For Rolling or want to build from source a particular branch / fork
WORKDIR /root/nav2_ws
RUN mkdir -p ~/nav2_ws/src
RUN git clone https://github.com/ros-navigation/navigation2.git --branch main ./src/navigation2
RUN rosdep init
RUN apt update && apt upgrade -y \
    && rosdep update \
    && rosdep install -y --ignore-src --from-paths src -r
RUN . /opt/ros/${ROS_DISTRO}/setup.sh \
    && colcon build --symlink-install

##### For all else, comment the above Rolling lines and replace with below
##### RUN rosdep init \
##### && apt update && apt upgrade -y \
##### && rosdep update \
##### && apt install -y \
##### ros-${ROS_DISTRO}-nav2-bringup \
##### ros-${ROS_DISTRO}-navigation2 \
##### ros-${ROS_DISTRO}-turtlebot3-gazebo
```

---

#### Dynamic Object Following

*Source: [https://docs.nav2.org/tutorials/docs/navigation2_dynamic_point_following.html](https://docs.nav2.org/tutorials/docs/navigation2_dynamic_point_following.html)*

##### Dynamic Object Following

Nav2 provides two different approaches for dynamic object following tasks:

1. **Following Server**: A specialized server that handles dynamic object following with built-in recovery mechanisms and smooth control.
2. **ComputePathToPose and FollowPath**: A behavior tree-based approach using traditional navigation components for custom following behaviors.

###### Using Following Server

* [Following Server Overview](#following-server-overview)
* [Following Server Tutorial Steps](#following-server-tutorial-steps)

###### Following Server Overview

The Following server is a specialized server in Nav2 designed to handle dynamic object following tasks. It dynamically follows an object while maintaining a defined distance specified by the `desired_distance` parameter. The server abstracts away the complexities of tracking and following moving objects, allowing users to focus on higher-level navigation goals.

The `FollowObject` action can be called using two different input methods:

* **pose\_topic**: Topic to publish the pose of the object to follow. When using this method, the server subscribes to the specified topic of type `geometry_msgs::msg::PoseStamped` containing the pose of the object to follow.
* **tracked\_frame**: Target TF frame to follow. When using this method, the server directly follows the specified frame name using the transform tree.

The Following server uses the same controller as the Docking server, leveraging the `SmoothControlLaw` to generate velocity commands for smoothly following the target object. This ensures consistent and predictable motion behavior across Nav2’s specialized servers.

**Recovery Mechanism**: If the object becomes undetectable for a period of time (e.g., when the pose topic stops publishing), the server implements a recovery mechanism where the robot will rotate left and right in a search pattern until it relocates the target object.

###### Following Server Tutorial Steps

To use the Following server, you need to configure it in your behavior tree. This involves setting up the necessary action nodes and parameters to ensure smooth following behavior. The `FollowObject` action node provides two different approaches for object tracking.

###### Method 1: Using pose\_topic

The simplest behavior tree for following a dynamic object using a pose topic is as follows:

```
<root main_tree_to_execute="MainTree">
  <BehaviorTree ID="MainTree">
    <FollowObject name="FollowPerson" pose_topic="/person_pose" max_duration="0.0"/>
  </BehaviorTree>
</root>
```

In this configuration:

* `pose_topic`: Specifies the topic (`/person_pose`) where `geometry_msgs::msg::PoseStamped` messages containing the object’s pose are published
* `max_duration`: Duration to run the action (0.0 means indefinitely)

###### Method 2: Using tracked\_frame

Alternatively, you can follow a specific TF frame directly:

```
<root main_tree_to_execute="MainTree">
  <BehaviorTree ID="MainTree">
    <FollowObject name="FollowPerson" tracked_frame="person_frame" max_duration="0.0"/>
  </BehaviorTree>
</root>
```

In this configuration:

* `tracked_frame`: Specifies the frame name (`person_frame`) to follow using the transform tree
* `max_duration`: Duration to run the action (0.0 means indefinitely)

**Additional Parameters**

The `FollowObject` action supports additional parameters for fine-tuning:

* `desired_distance`: Distance to maintain from the target object (in meters)
* `detection_timeout`: Time to wait without detecting the object before triggering recovery behavior
* `rotate_to_object_timeout`: Maximum time allowed for the rotation recovery mechanism to find the object
* `static_object_timeout`: Time threshold to determine if an object has been stationary
* `search_by_rotating`: Enable/disable the rotational search recovery mechanism when the object is lost

Recovery behavior is automatically activated when the target becomes undetectable, utilizing the search parameters above.

**Following Server in Action**

The following video demonstrates the Following Server functionality in a real-world scenario:


---

###### Using ComputePathToPose and FollowPath

* [ComputePathToPose Overview](#computepathtopose-overview)
* [ComputePathToPose Tutorial Steps](#computepathtopose-tutorial-steps)


###### ComputePathToPose Overview

This tutorial shows how to use Nav2 for a different task other than going from point A to point B. In this case, we will use Nav2 to follow a moving object at a distance indefinitely.

This task is useful in cases such as following a person or another robot. Below are some sample videos of applications that could be created using this capability. The “Carry My Luggage” RoboCup @ Home test, in which the [CATIE Robotics](https://robotics.catie.fr/) team performs the test successfully and this real (future) world application:


The requirements for this task are as follows:

* Changes are limited to the behavior tree used to navigate. This behavior tree can be selected in the `NavigateToPose` action when required, or it can be the default behavior tree. It is made up of run-time configurable plugins.
* The configuration of the planner and the controller will not be modified.
* The action will indefinitely run until it is canceled by who initiated it.

The detection of the dynamic object (like a person) to follow is outside the scope of this tutorial. As shown in the following diagram, your application should provide a detector for the object(s) of interest,
send the initial pose to the `NavigateToPose` action, and update it on a topic for the duration of the task. Many different types of detectors exist that you can leverage for this application:

[![../../_images/main_diagram.png](../../_images/main_diagram.png)](../../_images/main_diagram.png)

###### ComputePathToPose Tutorial Steps

###### 0- Create the Behavior Tree

Let’s start from this simple behavior tree. This behavior tree replans a new path at 1 hz and passes that path to the controller to follow:

```
<root main_tree_to_execute="MainTree">
  <BehaviorTree ID="MainTree">
    <PipelineSequence name="NavigateWithReplanning">
      <RateController hz="1.0">
        <ComputePathToPose goal="{goal}" path="{path}" planner_id="GridBased"/>
      </RateController>
      <FollowPath path="{path}" controller_id="FollowPath"/>
    </PipelineSequence>
  </BehaviorTree>
</root>
```

First, let’s make this behavior run until there’s a failure. For this purpose, we will use the `KeepRunningUntilFailure` control node.

```
<root main_tree_to_execute="MainTree">
  <BehaviorTree ID="MainTree">
    <PipelineSequence name="NavigateWithReplanning">
      <RateController hz="1.0">
        <ComputePathToPose goal="{goal}" path="{path}" planner_id="GridBased"/>
      </RateController>
      <KeepRunningUntilFailure>
        <FollowPath path="{path}" controller_id="FollowPath"/>
      </KeepRunningUntilFailure>
    </PipelineSequence>
  </BehaviorTree>
</root>
```

We will then use the decorator `GoalUpdater` to accept updates of the dynamic object pose we’re trying to follow. This node takes as input the current goal and subscribes to the topic `/goal_update`. It sets the new goal as `updated_goal` if a new goal on that topic is received.

```
<root main_tree_to_execute="MainTree">
  <BehaviorTree ID="MainTree">
    <PipelineSequence name="NavigateWithReplanning">
      <RateController hz="1.0">
        <GoalUpdater input_goal="{goal}" output_goal="{updated_goal}">
          <ComputePathToPose goal="{updated_goal}" path="{path}" planner_id="GridBased"/>
        </GoalUpdater>
      </RateController>
      <KeepRunningUntilFailure>
        <FollowPath path="{path}" controller_id="FollowPath"/>
      </KeepRunningUntilFailure>
    </PipelineSequence>
  </BehaviorTree>
</root>
```

To stay at a certain distance from the target, we will use the action node `TruncatePath`. This node modifies a path making it shorter so we don’t try to navigate into the object of interest. We can set up the desired distance to the goal using the input port `distance`.

```
<root main_tree_to_execute="MainTree">
  <BehaviorTree ID="MainTree">
    <PipelineSequence name="NavigateWithReplanning">
      <RateController hz="1.0">
        <Sequence>
          <GoalUpdater input_goal="{goal}" output_goal="{updated_goal}">
            <ComputePathToPose goal="{updated_goal}" path="{path}" planner_id="GridBased"/>
          </GoalUpdater>
         <TruncatePath distance="1.0" input_path="{path}" output_path="{truncated_path}"/>
        </Sequence>
      </RateController>
      <KeepRunningUntilFailure>
        <FollowPath path="{truncated_path}" controller_id="FollowPath"/>
      </KeepRunningUntilFailure>
    </PipelineSequence>
  </BehaviorTree>
</root>
```

Now, you may save this behavior tree and use it in our navigation task.

For reference, this exact behavior tree is [made available](https://github.com/ros-navigation/navigation2/blob/main/nav2_bt_navigator/behavior_trees/follow_point.xml) to you batteries included in the `nav2_bt_navigator` package.

###### 1- Setup Rviz clicked point

We are going to use RViz instead of a full application so you can test at home without finding a detector to get started. We will use the “clicked point” button on the toolbar to substitute object detections to provide goal updates to Nav2. This button allows you to
publish coordinates in the topic `/clicked_point`. This point needs to be sent to the behavior tree, using the program `clicked_point_to_pose`, from [this repo](https://github.com/fmrico/nav2_test_utils). Clone
this repo in your workspace, build, and type in a terminal.

`ros2 run nav2_test_utils clicked_point_to_pose`

Optionally, you can remap this topic in your rviz configuration file to `goal_updates`.

###### 2- Run Dynamic Object Following in Nav2 Simulation

Start Nav2 in one terminal:

`ros2 launch nav2_bringup tb3_simulation_launch.py headless:=False`

Open RViz and, after initialize the robot position, command the robot to navigate to any position. Use the button clicked point to simulate a new detection of the object of interest, as shown in the video in the head of this tutorial.

When you have a detector detecting your obstacle at a higher rate (1 hz, 10 hz, 100 hz) you will see a far more reactive robot following your detected object of interest!

---

#### Enhanced Safety for Nav2 using 3Laws Supervisor

*Source: [https://docs.nav2.org/tutorials/docs/using_3laws_supervisor.html](https://docs.nav2.org/tutorials/docs/using_3laws_supervisor.html)*

##### Enhanced Safety for Nav2 using 3Laws Supervisor

This tutorial provides a walkthrough of how to integrate the [3Laws Robotics](https://3laws.io/) Supervisor with the Nav2 stack to enhance safety during navigation tasks.
The 3Laws Supervisor is a dynamic collision avoidance solution that can augment Nav2 for production safety-conscious environments.
It provides a layer that monitors the robot’s behavior and sensors to adjust the robot’s desired trajectory in real-time to better avoid collisions and other hazards.
Rather than stopping or slowing as is typical in many safety or collision monitoring systems (i.e. `nav2_collision_monitor` or safety-rated lidar zones), the 3Laws Supervisor is designed to actively avoid collisions while still continuing towards its goal through a ‘force-field’ or ‘deflection’ effect.
Dynamic safety, thus, adds two types of efficiency to the production area: (1) the robots avoid stoppages and are more productive because of increased runtime; and (2) infrastructure is more *efficient* as less physical work is needed to maintain adequate or excellent safety levels.
Though, it will still stop the robot when required.

Rather than a strict replacement, this should be integrated in concert with other safety-rated systems, global replanning, trajectory planners, and/or the Nav2 Collision Monitor.
The safety zone behavior of traditional systems can be provided to the 3Laws Supervisor so it has awareness of the safety system to make informed decisions about how to adjust the robot’s trajectory without triggering it, wherever possible.
Though, the Supervisor can also be used as a standalone solution to provide collision avoidance.

The Supervisor is available in both a free community tier (Supervisor ROS CE) and two paid commercial tiers with additional features and support.
The community tier provides same functionality for collision avoidance and is suitable for many applications as Supervisor ROS, but limited to early-stage startups and R&D.
This tutorial focuses only on the features that are part of the community, Supervisor ROS (CE).
The commercial tier, Supervisor Pro, includes additional features such as: geofencing, stabilization, configuration limiting, command monitoring, altitude limitations, professional setup and support, and more.
To learn more about Supervisor Pro, [please contact 3Laws Robotics](https://3laws.io/contact/).

![3Laws Robotics Stack](../../_images/3LawsStack.svg)

Note

Disclosure: This tutorial is sponsored by 3Laws Robotics in partnership with Open Navigation.
The contents of this tutorial and demonstrations were written and performed by the Open Navigation team.
The opinions and thoughts shared are honest reflections of our independent assessment.

###### Concepts

Traditional safety systems for AMRs and mobile robots typically involve stopping or slowing down the robot when an obstacle is detected.
This is often implemented using safety-rated 2D lidars with safety zones which trigger a stop or slow down when an obstacle is detected within a certain window.
These zones are configured to ensure the robot can stop safely before colliding with an obstacle or slow down to a safer speed to avoid potential future collisions - frequently with safety zones scheduled based on the current robot velocity regime.
These solutions are generally effective when properly implemented, but they can lead to inefficiencies in dynamic operations and require purchasing expensive safety-rated hardware.
Alternatively, AGVs may use static safety measures such as light curtains and physical separation which require reconstruction and cannot be reconfigured easily.
Adding safety capabilities to the robot eliminates the burden of taking static safety measures.

Applications that do not require safety-rating or are not able to leverage expensive safety-rated lidars can typically use the Nav2 Collision Monitor or similar to stop or slow down the robot when an obstacle is detected.
This is a software-based solution that monitors the robot’s sensors (lidar, depth camera, sonar, etc) to detect obstacles and trigger a stop or slow down.
This is broadly analog to traditional safety-rated systems, but it does not provide the same level of safety assurance.
However, it has the same limitations due to the slow-and-stop nature of the solution.

![Supervisor Solution Infographic](../../_images/solution_infographic.png)

The Supervisor ROS uses a dynamic approach to collision avoidance to enhance safety while addressing the efficiency challenges and reducing the system tuning load.
Rather than solely stopping or slowing down when an obstacle is detected in proximity to the robot, the Supervisor takes over and adjusts the robot’s trajectory in real-time to avoid collisions while still making progress towards its goal - also considering lower-level safety constraints described above if present (Pro version).
This allows the robot to dynamically react to the environment while not prematurely stopping or slowing when maneuvers are available which can prevent triggering safety system reactions - increasing throughput.
It will however still stop the robot is required as any other safety system might.
For best use, a system should still contain a global replanning mechanism and/or a trajectory planner that considers collision.
The Supervisor should complement these systems rather than completely replacing them for maximum effectiveness, *especially* on robots moving fast, with heavy loads, or slow dynamics.
This can allow users to reduce the amount of tuning of Nav2’s highly configurable but complex controller parameters, moving faster to market.
It is also very good for teleoperation tasks either joysticking locally or via remote monitoring systems to avoid collisions due to remote operation delays!

![Nav2 and 3Laws Supervisor Integration Diagram](../../_images/Nav2Diagram_3laws.png)

Note

Supervisor should be paired with some global replanning and/or obstacle-avoiding trajectory planner is so that the Supervisor is not at odds with the trajectory planner, making it unable to route around obstacles and instead stops the robot. For example, if using Pure Pursuit to follow the path accurately with no global replanning, as the Supervisor deviates from the path, the algorithm will attempt to steer the robot back on the path into the obstacle. In such a case, the command’s velocity ‘intent’ to move forward along the path is now replaced with driving into the obstacle to correct for the tracking error, creating a conflict with the Supervisor’s attempt to avoid the obstacle. Thus, some kind of global replanning to avoid obstacles and/or use of a collision-avoiding trajectory planner like MPPI or DWB is recommended.

This, however, is not an issue with teleoperations since the teleoperation command will not adjust to track a path.

If you wish to learn more about the technology behind the Supervisor, checkout the [3Laws Knowledge Base](https://docs.3laws.io/en/latest/sources/knowledge.html) page.

[![3Laws AMR demo](../../_images/3laws_amr2.gif)](../../_images/3laws_amr2.gif)

###### 0. Obtain a License Key

Supervisor ROS is available in a free community tier, but still requires a license key to be used.
The license key can be obtained by requesting a key from the [3Laws Robotics Free-Trial](https://3laws.io/free-trial-new/) page or by navigating from the 3Laws home page and clicking ‘Get Started’ in the upper right corner.
Once approved, the license key will be sent to the email address provided in the request form.
It can be verified in Step 1 below in the Supervisor configuration GUI.

###### 1. Installation

The GUI can be setup using the instructions provided by [3Laws Robotics Install Supervisor](https://docs.3laws.io/en/latest/sources/getting_started.html#install-supervisor). To install the Supervisor via binaries, run the following install command:

```
bash <(curl https://raw.githubusercontent.com/3LawsRobotics/3laws/master/install.sh)
```

This may prompt you information about which ROS distribution you are using and what version of Supervisor you wish to install, if a ROS distribution is not currently sourced in this terminal.
Then, run the control panel via

```
3laws control-panel autostart enable
```

If attempting to install this script within your own application Docker image, you may use the CLI arguments of this script to specify the ROS distribution, architecture, Ubuntu version, and tag explicitly.

```
RUN bash <(curl https://raw.githubusercontent.com/3LawsRobotics/3laws/master/install.sh) -fy -r humble -a amd64 -v 22.04 -t latest
```

To run the configuration GUI server in this docker container, you will also want the following `entrypoint.sh` in your Dockerfile to start the Supervisor control panel and rosbridge server:

```
#!/bin/bash
set -e # Exit immediately if a command exits with a non-zero status

/opt/3laws/control_panel/control-panel-backend 8000 /opt/3laws/control_panel/build/ &
source /opt/ros/humble/setup.bash  # Replace with your ROS distribution if different
ros2 launch rosbridge_server rosbridge_websocket_launch.xml port:=9091 &
ros2 launch lll_supervisor supervisor.launch.py  # If you want it to run automatically only

bash
```

Note

When launching Supervisor for the first time (whether inside a docker container or not), you may see the error below. It is indicating that the Supervisor ROS node has not been configured yet and thus cannot start. As we’re going to configure it next, this is fine and the backend control panel is still running. After configuration if using Docker, the container would need to be restarted to run the Supervisor node with the newly set configuration.

```
[supervisor-1] [2025-07-23 17:44:48.878] [error] bad file: /home/3laws/.3laws/config/supervisor.yaml
[supervisor-1] [2025-07-23 17:44:48.913] [critical] Exception thrown during 3laws Supervisor initialization
[supervisor-1] [2025-07-23 17:44:48.913] [info] Stopping 3laws Supervisor...
[supervisor-1] [2025-07-23 17:44:48.913] [info] 3laws Supervisor stopped!
[ERROR] [supervisor-1]: process has died [pid 56, exit code 1, cmd '/opt/ros/humble/lib/lll_supervisor/supervisor --ros-args --disable-stdout-logs --ros-args --params-file /tmp/launch_params_g1f3o7xg'].
```

![Supervisor Control Panel Page 1](../../_images/page1.png)

Whether using the binaries or Docker image, you can now run the Supervisor control panel to configure the Supervisor and deploy it to your robot.
When you visit <http://localhost:8080>, you should now see a web-based control panel for the Supervisor, shown below.

###### 2. Initial Configuration Walkthrough

###### Initializing Configuration with Nav2

To ease the configuration of the Supervisor, we can use the `nav2_config_extractor_cli.py` script to extract parameters from a set of Nav2 and/or Robot Localization configuration files and initialize the Supervisor configuration.
In the future, this will be integrated directly into the Supervisor control panel, but for now we will run this script manually and pass them into the control panel.

These are the options for the shared parameter extractor.

> * `--verbose -v` Enable verbose logging.
> * `--files` A space separated list of file paths to Nav2 parameter files to extract.
> * `--output` File path to output the extracted shared configurations.
> * `--deconfliction` Strategy for handling duplicate possible values for shared configurations (options: ‘first’ to use the first value, ‘last’ to use the last value, and ‘prompt’ to prompt you to select the value you’d like to use).

For example:

```
python3 nav2_config_extractor_cli.py \
  --files /path/to/nav2_params.yaml /path/to/robot_localization_params.yaml \
  --output /path/to/extracted_shared_configs.json \
  --deconfliction prompt
```

When prompted in the control panel, navigate to the extracted shared configurations file and select it.
This will automatically pre-populate the Supervisor configurations with your robot’s set kinematic, dynamic, topics, frame IDs, and many sensor configurations.
However, you should still carefully validate the entries in the configuration GUI to ensure they match your desired behavior.

###### Supervisor Configuration: General

Now that we have the parameters extracted from the Nav2 configuration, we can complete the Supervisor configuration.

On the landing page shown above:

* Input your license key in the “License Key” field. When one is inputted, it should automatically validate and show the license status in the GUI
* Name the robot this configuration belongs to, whether a specific robot or a model of robot depending on the granularity of your configuration settings
* Select the ROS TF world frame to be `map` if not already set

Then, expand the Advanced Settings section and configure the `Project to SE2` toggle to enabled if your robot operates in a 2D plane (i.e. most ground robots and nearly all indoor robots). If you work outdoors on 3D terrain, you may disable this to allow the Supervisor to operate in 3D.

There are additional advanced settings that may be configured, including:

* Supervisor process niceness, to set the relative user-space priority of the Supervisor process. This is not the same as real-time scheduler priority.
* Re-timestamping incoming messages to add a current timestamp when a message is received without a properly implemented timestamp.
* Parameters related to port remapping for the supervisor and control panel. It is not recommended to change these unless you have a specific need to do so.

Note

For safest operations, re-timestamping messages should be disabled and all messages in a system should be validated to be properly timestamped. For getting started, restamping all incoming messages would be OK if you are not confident in your system’s timestamping or wish to use simulation time.

Once you are done making changes on this page, click the “Save” button at the bottom of the page to save your configuration and hit “Next” to proceed to the next page.

![Supervisor Robot Model Configuration](../../_images/kinematics_perception.svg)

###### Supervisor Configuration: Robot Model

The next page is for setting up the Robot’s kinematic and dynamic model.
Start by selecting the robot kinematic model that best matches your robot in the boxes.
Current options include Differential Drive or Omnidirectional.
Ackermann steering support is planned for a future release.

![Supervisor Robot Model Configuration](../../_images/page2.png)

Next, select the robot shape you wish to use for the Supervisor’s collision avoidance calculations.
The Supervisor supports a variety of shapes, including:

* Sphere
* Box
* Capsule
* Point
* Cone
* Cylinder
* Mesh files

For circular robots projected to 2D, `Sphere` and `Cylinder` are identical and will be projected to a circle in 2D.
For square or rectangular robots, use `Box`.
If your robot shape is asymmetric or has a complex shape, you may use `Mesh` to provide a custom mesh file or select an enveloping shape which circumscribes the robot’s shape.

Fill in the robot’s dimensions based on the selected shape.
If your robot’s origin is not at the center of the robot, you may also specify the offset from the robot’s origin to the center of the shape.
Otherwise, leave the robot collision shape’s position and rotation at the default identity values.

Your robot’s frame ID should be prepopulated from the Nav2 configuration, but you may change it if needed.
Additional frames need to be statically defined for the Supervisor to operate correctly.
The only frames that need to be defined are the frames of odometry and perception sources (if non-base frame ID) that we will later use in Localization and Perception configuration steps.
These can be found from your URDF file or using TF2’s Echo utility:

```
ros2 run tf2_ros tf2_echo <source_frame> <target_frame>

ros2 run tf2_ros tf2_echo lidar_link base_link # For example
```

Use the direct dynamical model for the robot if you are not sure which to use.
The maximum velocities should be populated from the Nav2 configuration, but you may change them if needed - especially if you have multiple controller plugins defined in your Nav2 configuration.

Finally if you have characterized your robot’s odometry noise models, you can input the covariance diagonal values here. Otherwise, do not worry and you can leave these as the default values.

Once you are done making changes on this page, click the “Save” button at the bottom of the page to save your configuration and hit “Next” to proceed to the next page.

###### Supervisor Configuration: Localization

The next page is for setting up the Robot’s localization information.
The localization topic in this page provides the frame of reference the Supervisor will use to operate within.
If not using an input of an obstacle map (i.e. using sensor data *only*), this should be the your robot’s odometry topic (ex. `odom`) that should be prepopulated.
If using a pre-localized obstacle map for collision avoidance, this should be the topic that provides the robot’s position within the obstacle map frame.

![Supervisor Localization Configuration](../../_images/page3.png)

Select the QoS settings for the localization topic subscriber, usually System Default with a depth of 10 and set the approximate update rate of the localization topic.
3Laws Default QoS will match this.
When using standard `nav_msgs/Odometry` messages, you do not need to create a mask.
This is used when the populated fields of a message are not as expected by ROS frame conventions.

If using the odometry topic, the covariances can be set as the same as in the previous section.

The Odometries topics can be set for the 3Laws diagnostics tools to provide checks on the robot’s odometry data quality and consistency.
If not interested in these diagnostics, you may leave these empty.
Otherwise, populate each odometry source you would like to monitor, including which axes of information each source meaningfully provides.
Select the frame of reference setup in the General page for each Odometry source’s frame.
If you did not set this up previously, go back now and do so. It will now be available in the dropdown menu.

Once you are done making changes on this page, click the “Save” button at the bottom of the page to save your configuration and hit “Next” to proceed to the next page.

###### Supervisor Configuration: Perception

The next page is for setting up the Robot’s sensors for receiving perception data.
This data can be from 2D lidars, 3D lidars, depth cameras, or pre-localized obstacles.
The basic data from your sensors should be broadly pre-populated from the Nav2 Costmap2D configurations, but you will need adjust them to include more information.
Set the sensor’s QoS to be Sensor Data if not already default.

![Supervisor Perception Configuration](../../_images/page4.png)

Add in the additional information about your sensors (number of rays, angles, range, update rate, etc) which should be obtained from your sensor’s documentation.
If using a consumer-grade lidar, consider hitting the *Edit Perception parameters (advanced)* button toggle on `Accept laserscan with wrong size`.
These sensors can frequently provide a different number of rays each iteration than it should based on low-cost hardware limitations.
Thus, we want to bypass usual checks for safety-rated sensors to allow it to be used for the Supervisor.
Similarly, set the Advanced *Min distance mode* to `SET_AT_INFINITY` so that readings with no range are set to infinity rather than minimal values.

Select the frame of reference setup in the General page for each Perception source’s frame.
If you did not set this up previously, go back now and do so. It will now be available in the dropdown menu.

If providing a set of pre-localized obstacles for collision advoidance, toggle on the Obstacles Map and provide the topic name for the map.
This currently supports obstacles provided in the form of:

* `lll_msgs/ObstacleArray`

Once you are done making changes on this page, click the “Save” button at the bottom of the page to save your configuration and hit “Next” to proceed to the next page.

###### Supervisor Configuration: Control

This page helps configure a method of fault management for low-level controllers.
For example, if controlling a motor with an encoder, this can monitor the encoder data to ensure the motor is converging to the desired set point.
This is a rarely used feature and is not required for the Supervisor to function - so we will skip this section.

###### Supervisor Configuration: Supervisor

The final page is for setting up the Supervisor’s system parameters.
The Supervisor Interface section highlights the configuration of the input command velocity topic and output Supervised topic.
This should be pre-populated with a `geometry_msgs/TwistStamped` topic for the input command velocity and a `geometry_msgs/TwistStamped` topic for the output Supervised topic with System Default QoS of depth 10.
Thus, we only need to update the topic names to match your Nav2 configuration.

![Supervisor System Configuration](../../_images/page6.png)

Set the Supervisor output signal to `/cmd_vel_supervised` for integration into the Nav2 post-processing pipeline.
We’ll later remap this as the input to the Nav2 Collision Monitor.
Thus, change the Motion planning output signal to `/cmd_vel_smoothed` for consumption of Velocity Smoothed messages.
If you do not wish to use the Nav2 Collision Monitor and the Supervisor, you may replace `cmd_vel_supervised` simply with `/cmd_vel`.
Select the Create Mask button and create a mask with `vx_cmd=0` & `wz_cmd=2`.

Note

Pro Tip: If you set up your robot system to continuously publish Zeros on the Nav2 output, Supervisor can continue to avoid collisions while its stopped based on obstacles coming near it!

Update the signal rate to be the same as the Nav2 controller update rate.
Similar to the localization parameters, the mask does not need to be modified if using standard `geometry_msgs/TwistStamped` messages.

The Run-time Assurance Module section configures the main Supervisor parameters for collision avoidance.
By default this should already be enabled.

If there is a tolerance for the minimum distance to obstacles, you may set it here as the *Collision distance threshold*.
The filter rate is the update rate of the Supervisor’s collision avoidance calculations, which should be kept at 50 hz to start.

For now, you may leave the configuration of Aggressiveness, Conservativeness, Pointiness, and Evasion Aggressiveness at their default values.
These parameters control how aggressively the Supervisor will adjust the robot’s trajectory to avoid collisions.
These can be fine-tuned later based on the robot’s empirical behavior and your application needs.

The fault management section is not required for the Supervisor to function, but it can be useful for monitoring the robot’s health and performance.
Set the `Can resume on failure` toggle to on so that we can resume from timeout failures from sensors and command velocity inputs if they occur.
We will skip the rest of section for now, but you may enable it if desired.

Keep Use Localization in the Advanced Settings section disabled. This defines the frame debugging information is published with respect to for a `MarkerArray` visualization.

The Robot Diagnostics section provides the ability to monitor the robot’s diagnostics and health.
This is not required for the Supervisor to function, but it can be useful for monitoring the robot’s health and performance.
This is disabled by default, but you may enable it if desired and configure each topic or process source.
Individual nodes can also be configured and monitored for expected input and output.

Once you are done making changes on this page, click the “Save” button at the bottom of the page to save your configuration.
At this point, all 6 tabs should be white meaning that the configuration is complete and valid.
If any tab is yellow, it means that there are still required fields that need to be filled in.
Save again once complete.

You should now see your complete configuration saved in ~/.3laws/config/supervisor.yaml!
Check out [tb4\_supervisor.yaml](https://github.com/open-navigation/opennav_3laws_demonstration/blob/main/lll_nav2_warehouse_demo/config/tb4_supervisor.yaml) for a fully-configured example for the Turtlebot4 robot which can be used for the simulation demonstrations in this tutorial.
Just be sure to move this file into your ~/.3laws/config/ directory, rename it to supervisor.yaml, and input your API key & desired robot name before proceeding.

###### Debugging

If you run into problems, check out the logs in the Supervisor terminal and in the Supervisor’s control panel Operations tab while the supervisor is running.
If a box is green, it means it is receiving and successfully processing data.
If it is blue, it is receiving data but not processing it correctly.
If it is red, it is not receiving data at all.

Currently, if running with Simulation Time using `use_sim_time`, restamping messages needs to be set as always on in order to restamp with system clock times. This may cause boxes to be blue if the messages are timestamped with simulation time.

Look at the robot mini-map once setup is completed to make sure the sensor frames are correct and that data is being processed in the correct areas near the robot.

###### Turtlebot4 Supervisor Example

This tutorial shows an integration demonstration of the Supervisor with Nav2 for the Turtlebot4 robot, using the standard simulation environment and maps provided by `nav2_bringup`.
A fully configured Supervisor configuration can be found in the [tb4\_supervisor.yaml](https://github.com/open-navigation/opennav_3laws_demonstration/blob/main/lll_nav2_warehouse_demo/config/tb4_supervisor.yaml) file.
This was created using the steps above:

* The Nav2 configuration in `nav2_bringup/params/nav2_params.yaml` was used to extract the shared parameters.
* The robot name is set as the robot computer’s hostname.
* The world name is verified as `map` and advanced settings projected to SE2 is enabled.
* The model is verified as differential drive with a Capsule collision shape of radius 0.22m and height of 0.7m.
* The base frame is verified as `base_link` and additional frames are added for `rplidar_link` and `oakd_link` for processing sensor data.
* Using the direct velocity model, we verified the velocity limits as -0.35 - 0.5 m/s for linear and -1.9 - 1.9 rad/s for angular.
* Localization uses the `/odom` topic, verify this is correct.
* Perception is pre-populated with the `/scan` topic for 2D lidar. We need to add in the additional scan sensor metadata. In this case, it has 336 rays, -3.14 to 3.14 radian angles, and a range of 20 meters. These were obtained from the `/scan` topic from simulation. In advanced settings, the *Accept laserscan with wrong size* is enabled as this is a cheap lidar that can provide a different number of rays each iteration.
* In the Supervisor section, the motion planning topic was set to `/cmd_vel_smoothed` and the Supervisor output signal to `/cmd_vel_supervised`.
* We set the Supervisor’s settings to Aggressiveness 1.5, Conservativeness 0.01, Pointiness 0.0, and Evasion Aggressiveness: 500.
* A collision distance threshold of 0.25 meters is set for a good sized buffer.

###### 3. Nav2-Supervisor Configuration

###### Collision Monitor Integration

Now that there is a Supervisor configuration, we need to remap Nav2’s command velocity topics to integrate the supervisor into the pipeline.
From step 1, we set the motion planning (i.e. Nav2) topic to `/cmd_vel_smoothed`.
Thus, we need to set the output of the Collision Monitor to this topic so that the new post-processing pipeline will be:

```
/cmd_vel_nav (Controller Server)
--> /cmd_vel_smoothed (Velocity Smoother)
--> /cmd_vel_supervised (Supervisor)
--> /cmd_vel (Collision Monitor)
--> Robot Base Controller
```

In your Nav2 parameters file, change the `cmd_vel_in_topic` in the Collision Monitor to `/cmd_vel_supervised`.

```
collision_monitor:
  ros__parameters:
    base_frame_id: "base_footprint"
    odom_frame_id: "odom"
    cmd_vel_in_topic: "cmd_vel_supervised" # <-- Changed from cmd_vel_smoothed
    cmd_vel_out_topic: "cmd_vel"
```

If you do not wish to use the Collision Monitor, then you can skip this step and have `/cmd_vel_smoothed` sent to the Supervisor which can directly output `/cmd_vel`.
If using the Approach Footprint Collision Monitor configuration or only using stop zones, this is likely redundant to the Supervisor.

###### Controller Configuration

Nav2 may need some custom configuration to best leverage the Supervisor in its autonomy workflow.
The changes to the controllers depend on which category of control algorithm it uses:

1. Advanced, predictive or reactive
2. Geometric or algebraic

For advanced, predictive, or reactive controllers which consider collision and actively avoids it, we do not need to modify the controller’s collision detection system.
Since these controllers will automatically deviate from the path when it is blocked and find ways around obstacles, this can remain.
The Supervisor may in some situations manipulate this command to provide additional safety margin from obstacles, it works more as a paired companion.
While replanning is not required since these algorithms can deviate from the route to get around obstacles, it may be beneficial to utilize it to navigate in environments with particularly large obstacles.
These controllers may be retuned to be more aggressive *or* do not require as close of tuning for collision avoidance when using the Supervisor.

For Geometric algorithms like Regulated Pure Pursuit and Graceful controllers, the collision detection and avoidance pipeline must be *disabled* such that the controller doesn’t give up and stop navigation when obstacles are detected in the way.
Instead, the responsibilities will be shifted to the Supervisor to detect obstacles and either deviate or stop the robot when necessary.
This is done easily within each algorithm by setting `use_collision_detection: False` in the control algorithm’s configuration.
The Supervisor needs the additional latitude to operate and immediately failing a navigation task due to a collision in the way prevents it from stepping in.
It is recommended to pair these more rudimentary path following methods with replanning to help navigate around large obstacles.
It may also be beneficial to increase the lookahead distances used by geometric algorithms.

###### Launch Integration

To launch the Supervisor for your application, you can use the following launch file in your bringup package.

```
from ament_index_python.packages import get_package_share_directory
from launch import LaunchDescription
from launch.actions import IncludeLaunchDescription, ExecuteProcess
from launch.launch_description_sources import PythonLaunchDescriptionSource
from launch.substitutions import PathJoinSubstitution, EnvironmentVariable
import os

def generate_launch_description():
    launchDesc = LaunchDescription()
    # If the Supervisor package is available on system (debian install)
    # then include the supervisor launch file
    pkg = get_package_share_directory("lll_supervisor")
    launchDesc.add_action(
        IncludeLaunchDescription(
            PythonLaunchDescriptionSource(
                PathJoinSubstitution(
                    [
                        get_package_share_directory("lll_supervisor"),
                        "launch",
                        "supervisor.launch.py",
                    ]
                )
            )
        )
    )

    return launchDesc
```

That’s it - you’re ready to use the Supervisor with Nav2!
Rebuild your Nav2 configuration package and you’re ready to get started.

###### 4. Nav2 Turtlebot4 Simulation Demonstration

In this demonstration, we use the Nav2 Turtlebot4 simulation in `nav2_bringup` with the Nav2 Route Server and insert a pallet in the middle of the graph to block the route.
The aim of this demonstration is to mimic an industrial application where the robot is not to deviate from the lane unless absolutely required due to blockages.
The lanes are defined by the Route Server’s graph of the depot map and the autonomy software sends the path generated from the graph without knowledge of blockages to the controller for tracking.
There is no replanning of the route path and no freespace planning is computed.

The Nav2 controllers could be tuned to track the path and then avoid obstacles when required, however it can be tedious and time consuming to achieve the right trade off for a given application and hardware system.
However, a similar behavior could be accomplished by using the Supervisor, as you can see below.

This clearly shows how the Supervisor when paired with the Regulated Pure Pursuit controller can now overcome some challenges it faces without stopping, failing navigation, or enacting recovery behaviors in the system-level recovery branch of the behavior tree configuration.
The robot tracks the path with a low-parameter easy to configure controller and deviates from the route as necessary to avoid the obstacle.
While it is recommended to pair a geometric technique like this with dynamic replanning to assist in avoiding large obstacles, this shows an example situation that can be handled fully by the Supervisor – although replanning would help further optimize efficiency.

Additionally, we can see that MPPI can also navigate past this goal faster than otherwise by leveraging the nudges that the Supervisor provides to commit to a new solution space.
This faster judgement call improves the time-to-goal performance of the system.
While MPPI was able to overcome this obstacle itself, the increased throughput over many such blockages and many robots in a facility can garner measurable improvements in efficiency over an entire robotics solution.

Note that a similar thing could be created via an intermediate configuration of a behavior tree designed to leverage precise path tracking algorithms like Regulated Pure Pursuit when no obstacles are on the path and switch to dynamic replanning and/or an advanced controller when obstacles are present to navigate around them.
However, that requires more effort to setup and manage and only provides benefit if strict management over the robot behavior is required.
If using replanning and MPPI (and an intermediate to advanced application-specific behavior tree), the improvements using Supervisor in such a situation are relatively nominal, but can (a) increase throughput marginally, (b) provide an additional hierarchical layer of collision avoidance as part of a larger safety story, and (c) reduce some of the most tedious fine tuning of predictive controller behavior in close proximity to obstacles.

###### 5. Hardware Demonstrations

Hardware demonstrations were performed in a bin-picking environment.
Two double-sided aisles are configured with the Nav2 Route Server to simulate the lanes of a warehouse or factory.
Each route lane is set as bidirectional to intentionally cause conflicts between two robots to demonstrate multi-robot & dynamic obstacle conflict avoidance.
The Regulated Pure Pursuit Controller’s collision avoidance is disabled as previously discussed and uses the Supervisor to avoid robots and give shelves maximum space to pass by.
Each robot was initialized at the staging point at the front of the bin picking area and sent to random goals.
The deconfliction between robots and deviations from the graph to give shelves additional clearance can be seen below:

To further test the Supervisor capabilities, the robot was sent from the start of the left most shelf to the right in order to create a testing environment for human interactions.
Below you can see how the Supervisor can handle a variety of dynamic obstacles, resolving conflict without replanning or assistance from more advanced Nav2 controller algorithms.
Note: Usually for tasks such as this, using a controller like MPPI or DWB is recommended in a production environment so Supervisor may focus on deviations as needed rather than fully relying on it for intelligent & autonomous behavior.
This is being shown in isolation to highlight what it is possible to accomplish in extreme situations whereas an autonomy controller is not attempting to avoid collisions.

As shown, this can be used to create fewer stoppages of the system so the solution can increase throughput and average speed throughout a mission.
This prevents situations where the robot stops and waits for a human or other obstacle to pass by out of safety zones.
The ‘force field’ effect of the Supervisor allows the robot to continue moving and make progress towards its goal while still avoiding collisions.

###### Narrow Doorways

Navigating through narrow doorways is often a significant challenge for autonomous navigation systems.
The difficulty lies in precisely positioning the robot in the center of the doorway to ensure that robots with minimal clearance can pass through reliably and gracefully.
Traditional path planning and control algorithms often struggle with this scenario, as small deviations from the planned path can result in rubbing against the door frame or hesitation at the entrance.

The 3Laws Supervisor excels in these kinds of situations by providing real-time trajectory adjustments that naturally align the robot with the center of narrow passages.
Rather than requiring precise path following or complex controller tuning, the Supervisor’s deflection field effect gently guides the robot to maintain safe clearances from both sides of the doorway.
This results in smooth, confident passage through narrow spaces without the need for stopping, replanning, or recovery behaviors.

The video below demonstrates the Supervisor enabling a robot to navigate through narrow doorways with ease, maintaining proper alignment and clearance throughout the passage:

As shown in the demonstration, the Supervisor’s ability to handle narrow passages makes it particularly valuable for:

* Indoor navigation in office and warehouse environments with standard doorways
* Robots with large footprints or minimal clearance margins
* Teleoperations in tight spaces where remote operators may have difficulty judging clearances
* Reducing the need for extensive controller parameter tuning for specific environmental features

###### 6. Resources

More detailed information can be found in the following documentation:

* <https://3laws.io/>
* <https://docs.3laws.io/en/latest/>

Related GitHub repositories can be found here:

* <https://github.com/open-navigation/opennav_3laws_demonstration>
* <https://github.com/3LawsRobotics/3laws-demos/tree/master>

And we have one more fun video (it didn’t fit anywhere else naturally, but is worth a gander)!

---

#### Filtering of Noise-Induced Obstacles

*Source: [https://docs.nav2.org/tutorials/docs/filtering_of_noise-induced_obstacles.html](https://docs.nav2.org/tutorials/docs/filtering_of_noise-induced_obstacles.html)*

##### Filtering of Noise-Induced Obstacles

* [Overview](#overview)
* [Requirements](#requirements)
* [Tutorial Steps](#tutorial-steps)
* [How it works](#how-it-works)

[![../../_images/title.png](../../_images/title.png)](../../_images/title.png)

###### Overview

Noisy sensor measurements can cause to errors in `Voxel Layer` or `Obstacle Layer`. As a result, salt and pepper noise may appear on the costmap. This noise creates false obstacles that prevent the robot from finding the best path on the map. While the images above show both salt and pepper noise as well as error due to mislocalization, this layer will only remove sensor noise, not mislocalized artifacts misaligned with the static map.
This tutorial shows how to configure filtering of false obstacles caused by noise. This functionality is provided by the `DenoiseLayer` costmap layer plugin which will be enabled and used in this document.

###### Requirements

It is assumed that ROS 2, Gazebo and TurtleBot3 packages are installed or built locally. Please make sure that Nav2 project is also built locally as it was made in [Build and Install](../../development_guides/build_docs/index.html#build-instructions).

###### Tutorial Steps

###### 1. Enable Denoise Layer

Denoise Layer is Costmap2D plugin. You can enable the `DenoiseLayer` plugin in Costmap2D by adding `denoise_layer` to the `plugins` parameter in `nav2_params.yaml`. You can place it in the `global_costmap` and (or) `local_costmap` to filter noise on a global or local map. The DenoiseLayer plugin should have the following parameter defined:

* `plugin`: type of plugin. In our case `nav2_costmap_2d::DenoiseLayer`.

Full list of parameters supported by `DenoiseLayer` are listed at [Denoise Layer Parameters](../../configuration/packages/costmap-plugins/denoise.html#denoise) page.

It is important to note that `DenoiseLayer` typically should be placed before the inflation layer.
This is required to prevent inflation from noise-induced obstacles.
Moreover, `DenoiseLayer` processes only obstacle information in the costmap.
Values `INSCRIBED_INFLATED_OBSTACLE`, `LETHAL_OBSTACLE` and optionally `NO_INFORMATION`
will be interpreted as obstacle cell. Cells with any other values will be interpreted as `FREE_SPACE` when processed (won’t be distorted in the cost map).
If a cell with an obstacle is recognized as noise, it will be replaced by `FREE_SPACE` after processing.

To enable `DenoiseLayer` for both global and local costmaps, use the following configuration:

```
global_costmap:
  global_costmap:
    ros__parameters:
      ...
      plugins: ["static_layer", "obstacle_layer", "denoise_layer", "inflation_layer"]
      ...
      denoise_layer:
        plugin: "nav2_costmap_2d::DenoiseLayer"
        enabled: True
...
local_costmap:
  local_costmap:
    ros__parameters:
      ...
      plugins: ["voxel_layer", "denoise_layer", inflation_layer"]
      ...
      denoise_layer:
        plugin: "nav2_costmap_2d::DenoiseLayer"
        enabled: True
```

Note

The key to success in filtering noise is to understand its type and choose the right `DenoiseLayer` parameters.
The default parameters are focused on fast removal of standalone obstacles.
More formally, an obstacle is discarded if there are no obstacles among the adjacent eight cells.
This should be sufficient in typical cases.

If some sensor generates intercorrelated noise-induced obstacles and small obstacles in the world are unlikely, small groups of obstacles can be removed.
To configure the `DenoiseLayer` to such cases and understand how it works, refer to the section [How it works](#how-it-works).

Warning

Use this plugin to filter the global costmap with caution. It introduces potential performance issues.
For example in case of typically-high-range lidars (20+ meters) update window can be massive making processing time unacceptably long.
It is worth taking this into account as an application designer.

###### 2. Run Nav2 stack

After Denoise Layer was enabled for global/local costmaps, run Nav2 stack as written in [Getting Started](../../getting_started/index.html#getting-started):

```
ros2 launch nav2_bringup tb3_simulation_launch.py headless:=False
```

And check that filter is working properly: with the default parameters,
no standalone obstacles should remain on the cost map. This can be checked, for example, in RViz main window displaying local and global costmaps after removing unnecessary particles (illustrated at the top of this tutorial).

###### How it works

The plugin is based on two algorithms.

When parameter `minimal_group_size` = 2, the first algorithm turns on.
It apply [erosion](https://docs.opencv.org/3.4/db/df6/tutorial_erosion_dilatation.html) function with kernel from image below (left if `group_connectivity_type` = 4 or right if `group_connectivity_type` = 8) to the costmap.
White color of the kernel pixel means to use the value, black means to ignore it.

[![../../_images/3x3_kernels.png](../../_images/3x3_kernels.png)](../../_images/3x3_kernels.png)

As a result of erosion function the neighbors image is created. Each possible position of the kernel on the costmap corresponds to one pixel of the neighbors image. The pixel value of this image is equal to the maximum of 4/8 costmap pixels corresponding to the white pixels of the mask.
In other words, the pixel of the neighbors image is equal to the obstacle code if there is an obstacle nearby, the free space code in other case.
After that, obstacles corresponding to free space code on neighbors image are removed.

This process is illustrated below. On the left side of the image is a costmap, on the right is a neighbors image. White pixels are free space, black pixels are obstacles, `group_connectivity_type` = 4.
Obstacles marked at the end of the animation will be removed.

[![../../_images/dilate.gif](../../_images/dilate.gif)](../../_images/dilate.gif)

When parameter `minimal_group_size` > 2, the second algorithm is executed.
This is a generalized solution that allows you to remove groups of adjacent obstacles if their total number is less than `minimal_group_size`.
To select groups of adjacent obstacles, the algorithm performs their segmentation.
The type of cell connectivity in one segment is determined by the parameter `group_connectivity_type`.
Next, the size of each segment is calculated.
Obstacles segments with size less than the `minimal_group_size` are replaced with empty cells.
This algorithm is about 10 times slower than first, so use it with caution and only when necessary.
Its execution time depends on the size of the processed map fragment (and not depend on the value of `minimal_group_size`).

This algorithm is illustrated in the animation below (`group_connectivity_type` = 8).
Obstacles marked at the end of the animation will be removed (groups that size less 3).

[![../../_images/connected_components.gif](../../_images/connected_components.gif)](../../_images/connected_components.gif)

---

#### Get Backtrace in ROS 2 / Nav2

*Source: [https://docs.nav2.org/tutorials/docs/get_backtrace.html](https://docs.nav2.org/tutorials/docs/get_backtrace.html)*

##### Get Backtrace in ROS 2 / Nav2

* [Overview](#overview)
* [Preliminaries](#preliminaries)
* [From a Node](#from-a-node)
* [From a Launch File](#from-a-launch-file)
* [From Nav2 Bringup](#from-nav2-bringup)
* [Automatic backtrace on crash](#automatic-backtrace-on-crash)

###### Overview

This document explains one set of methods for getting backtraces for ROS 2 and Nav2.
There are many ways to accomplish this, but this is a good starting point for new C++ developers without GDB experience.

The following steps show ROS 2 users how to modify the Nav2 stack to get traces from specific servers when they encounter a problem.
This tutorial applies to both simulated and physical robots.

This will cover how to get a backtrace from a specific node using `ros2 run`, from a launch file representing a single node using `ros2 launch`, and from a more complex orchestration of nodes.
By the end of this tutorial, you should be able to get a backtrace when you notice a server crashing in ROS 2.

###### Preliminaries

GDB is the most popular debugger for C++ on Unix systems.
It can be used to determine the reason for a crash and track threads.
It may also be used to add breakpoints in your code to check values in memory a particular points in your software.

Using GDB is a critical skill for all software developers working on C/C++.
Many IDEs will have some kind of debugger or profiler built in, but with ROS, there are few IDEs to choose.
Therefore it’s important to understand how to use these raw tools you have available rather than relying on an IDE to provide them.
Further, understanding these tools is a fundamental skill of C/C++ development and leaving it up to your IDE can be problematic if you change roles and no longer have access to it or are doing development on the fly through an ssh session to a remote asset.

Using GDB luckily is fairly simple after you have the basics under your belt.
The first step is to add `-g` to your compiler flags for the ROS package you want to profile / debug.
This flag builds debug symbols that GDB and valgrind can read to tell you specific lines of code in your project are failing and why.
If you do not set this flag, you can still get backtraces but it will not provide line numbers for failures.
Be sure to remove this flag after debugging, it will slow down performance at run-time.

Adding the following line to your `CMakeLists.txt` for your project should do the trick.
If your project already has a `add_compile_options()`, you can simply add `-g` to it.
Then simply rebuild your workspace with this package `colcon build --packages-select <package-name>`.
It may take a little longer than usual to compile.

```
add_compile_options(-g)
```

Now you’re ready to debug your code!
If this was a non-ROS project, at this point you might do something like below.
Here we’re launching a GDB session and telling our program to immediately run.
Once your program crashes, it will return a gdb session prompt denoted by `(gdb)`.
At this prompt you can access the information you’re interested in.
However, since this is a ROS project with lots of node configurations and other things going on, this isn’t a great option for beginners or those that don’t like tons of commandline work and understanding the filesystem.

```
gdb ex run --args /path/to/exe/program
```

Below are sections to describe the 3 major situations you could run into with ROS 2-based systems.
Read the section that best describes the problem you’re attempting to solve.

###### From a Node

Just as in our non-ROS example, we need to setup a GDB session before launching our ROS 2 node.
While we could set this up through the commandline with some knowledge of the ROS 2 file system, we can instead use the launch `--prefix` option the kind folks at Open Robotics provided for us.

`--prefix` will execute some bits of code before our `ros2` command allowing us to insert some information.
If you attempted to do `gdb ex run --args ros2 run <pkg> <node>` as analog to our example in the preliminaries, you’d find that it couldn’t find the `ros2` command.
If you’re even more clever, you’d find that trying to source your workspace would also fail for similar reasons.

Rather than having to revert to finding the install path of the executable and typing it all out, we can instead use `--prefix`.
This allows us to use the same `ros2 run` syntax you’re used to without having to worry about some of the GDB details.

```
ros2 run --prefix 'gdb -ex run --args' <pkg> <node> --all-other-launch arguments
```

Just as before, this prefix will launch a GDB session and run the node you requested with all the additional commandline arguments.
You should now have your node running and should be chugging along with some debug printing.

Once your server crashes, you’ll see a prompt like below. At this point you can now get a backtrace.

```
(gdb)
```

In this session, type `backtrace` and it will provide you with a backtrace.
Copy this for your needs.
For example:

```
(gdb) backtrace
#0  __GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:50
#1  0x00007ffff79cc859 in __GI_abort () at abort.c:79
#2  0x00007ffff7c52951 in ?? () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6
#3  0x00007ffff7c5e47c in ?? () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6
#4  0x00007ffff7c5e4e7 in std::terminate() () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6
#5  0x00007ffff7c5e799 in __cxa_throw () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6
#6  0x00007ffff7c553eb in ?? () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6
#7  0x000055555555936c in std::vector<int, std::allocator<int> >::_M_range_check (
    this=0x5555555cfdb0, __n=100) at /usr/include/c++/9/bits/stl_vector.h:1070
#8  0x0000555555558e1d in std::vector<int, std::allocator<int> >::at (this=0x5555555cfdb0,
    __n=100) at /usr/include/c++/9/bits/stl_vector.h:1091
#9  0x000055555555828b in GDBTester::VectorCrash (this=0x5555555cfb40)
    at /home/steve/Documents/nav2_ws/src/gdb_test_pkg/src/gdb_test_node.cpp:44
#10 0x0000555555559cfc in main (argc=1, argv=0x7fffffffc108)
    at /home/steve/Documents/nav2_ws/src/gdb_test_pkg/src/main.cpp:25
```

In this example you should read this in the following way, starting at the bottom:

* In the main function, on line 25 we call a function VectorCrash.
* In VectorCrash, on line 44, we crashed in the Vector’s `at()` method with input `100`.
* It crashed in `at()` on STL vector line 1091 after throwing an exception from a range check failure.

These traces take some time to get used to reading, but in general, start at the bottom and follow it up the stack until you see the line it crashed on.
Then you can deduce why it crashed.
When you are done with GDB, type `quit` and it will exit the session and kill any processes still up.
It may ask you if you want to kill some threads at the end, say yes.

###### From a Launch File

Just as in our non-ROS example, we need to setup a GDB session before launching our ROS 2 launch file.
While we could set this up through the commandline, we can instead make use of the same mechanics that we did in the `ros2 run` node example, now using a launch file.

In your launch file, find the node that you’re interested in debugging.
For this section, we assume that your launch file contains only a single node (and potentially other information as well).
The `Node` function used in the `launch_ros` package will take in a field `prefix` taking a list of prefix arguments.
We will insert the GDB snippet here with one change from our node example, use of `xterm`.
`xterm` will pop up a new terminal window to show and interact with GDB.
We do this because of issues handling `stdin` on launch files (e.g. if you hit control+C, are you talking to GDB or launch?).
See [this ticket](https://github.com/ros2/launch_ros/issues/165) for more information.
See below for an example debugging SLAM Toolbox.

```
start_sync_slam_toolbox_node = Node(
    parameters=[
      get_package_share_directory("slam_toolbox") + '/config/mapper_params_online_sync.yaml',
      {'use_sim_time': use_sim_time}
    ],
    package='slam_toolbox',
    executable='sync_slam_toolbox_node',
    name='slam_toolbox',
    prefix=['xterm -e gdb -ex run --args'],
    output='screen')
```

Just as before, this prefix will launch a GDB session, now in `xterm` and run the launch file you requested with all the additional launch arguments defined.

Once your server crashes, you’ll see a prompt like below, now in the `xterm` session. At this point you can now get a backtrace.

```
(gdb)
```

In this session, type `backtrace` and it will provide you with a backtrace.
Copy this for your needs.
See the example trace in the section above for an example.

These traces take some time to get used to reading, but in general, start at the bottom and follow it up the stack until you see the line it crashed on.
Then you can deduce why it crashed.
When you are done with GDB, type `quit` and it will exit the session and kill any processes still up.
It may ask you if you want to kill some threads at the end, say yes.

###### From Large Project

Working with launch files with multiple nodes is a little different so you can interact with your GDB session without being bogged down by other logging in the same terminal.
For this reason, when working with larger launch files, its good to pull out the specific server you’re interested in and launching it separately.
These instructions are targeting Nav2, but are applicable to any large project with many nodes of any type in a series of launch file(s).

As such, for this case, when you see a crash you’d like to investigate, its beneficial to separate this server from the others.

If your server of interest is being launched from a nested launch file (e.g. an included launch file) you may want to do the following:

* Comment out the launch file inclusion from the parent launch file
* Recompile the package of interest with `-g` flag for debug symbols
* Launch the parent launch file in a terminal
* Launch the server’s launch file in another terminal following the instructions in [From a Launch File](#from-a-launch-file).

Alternatively, if you server of interest is being launched in these files directly (e.g. you see a `Node`, `LifecycleNode`, or inside a `ComponentContainer`), you will need to separate this from the others:

* Comment out the node’s inclusion from the parent launch file
* Recompile the package of interest with `-g` flag for debug symbols
* Launch the parent launch file in a terminal
* Launch the server’s node in another terminal following the instructions in [From a Node](#from-a-node).

Note

Note that in this case, you may need to remap or provide parameter files to this node if it was previously provided by the launch file. Using `--ros-args` you can give it the path to the new parameters file, remaps, or names. See [this ROS 2 tutorial](https://docs.ros.org/en/rolling/Guides/Node-arguments.html) for the commandline arguments required.

We understand this can be a pain, so it might encourage you to rather have each node possible as a separately included launch file to make debugging easier. An example set of arguments might be `--ros-args -r __node:=<node_name> --params-file /absolute/path/to/params.yaml` (as a template).

Once your server crashes, you’ll see a prompt like below in the specific server’s terminal. At this point you can now get a backtrace.

```
(gdb)
```

In this session, type `backtrace` and it will provide you with a backtrace.
Copy this for your needs.
See the example trace in the section above for an example.

These traces take some time to get used to reading, but in general, start at the bottom and follow it up the stack until you see the line it crashed on.
Then you can deduce why it crashed.
When you are done with GDB, type `quit` and it will exit the session and kill any processes still up.
It may ask you if you want to kill some threads at the end, say yes.

###### From Nav2 Bringup

To debug directly from the nav2 bringup launch files you may want to do the following:

* Add `prefix=['xterm -e gdb -ex run --args']` to the non-composed node in the appropriate launch file.
* Recompile the package of interest with `-g` flag for debug symbols.
* Launch normally with `ros2 launch nav2_bringup tb3_simulation_launch.py use_composition:=False`. A separate xterm window will open with the process of interest running in gdb.

Note

Turning off composition has serious performance impacts. If this is important to you please follow “From Large Project”.

Once your server crashes, you’ll see a prompt like below in the xterm window. At this point you can now get a backtrace.

```
(gdb)
```

In this session, type `backtrace` and it will provide you with a backtrace.
Copy this for your needs.
See the example trace in the section above for an example.

These traces take some time to get used to reading, but in general, start at the bottom and follow it up the stack until you see the line it crashed on.
Then you can deduce why it crashed.
When you are done with GDB, type `quit` and it will exit the session and kill any processes still up.
It may ask you if you want to kill some threads at the end, say yes.

###### Automatic backtrace on crash

The [backward-cpp](https://github.com/bombela/backward-cpp) library provides beautiful stack traces, and the [backward\_ros](https://github.com/pal-robotics/backward_ros/tree/foxy-devel) wrapper simplifies its integration.

Navigation2 packages come pre-compiled with backward\_ros, so you can automatically get a backtrace when a process crashes. This changes the logs to include a backtrace when the process crashes. Instead of getting a simple error log such as:

```
[planner_server-13] [INFO] [1754377648.634265021] [planner_server]: Computing path to goal....
[ERROR] [planner_server-13]: process has died [pid 165734, exit code -11, cmd '/opt/overlay_ws/src/navigation2/install/nav2_planner/lib/nav2_planner/planner_server --ros-args --log-level info --ros-args -r __node:=planner_server -r __ns:=/ -p use_sim_time:=True --params-file /tmp/launch_params_ou47e26i -r /tf:=tf -r /tf_static:=tf_static'].
```

You get a more detailed output with a backtrace, which can help you identify the source of the crash:

```
[planner_server-13] [INFO] [1754463292.960594359] [planner_server]: Computing path to goal....
[planner_server-13] Stack trace (most recent call last) in thread 130805:
[planner_server-13] #11   Object "/usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2", at 0xffffffffffffffff, in
[planner_server-13] #10   Object "/usr/lib/x86_64-linux-gnu/libc.so.6", at 0x7509de004c3b, in
[planner_server-13] #9    Object "/usr/lib/x86_64-linux-gnu/libc.so.6", at 0x7509ddf77aa3, in
[planner_server-13] #8    Object "/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33", at 0x7509de207db3, in
[planner_server-13] #7    Object "/opt/overlay_ws/src/navigation2/install/nav2_planner/lib/libplanner_server_core.so", at 0x7509de887ee7, in std::__future_base::_Async_state_impl<std::thread::_Invoker<std::tuple<nav2::SimpleActionServer<nav2_msgs::action::ComputePathToPose>::handle_accepted(std::shared_ptr<rclcpp_action::ServerGoalHandle<nav2_msgs::action::ComputePathToPose> >)::{lambda()#1}> >, void>::_M_run()
[planner_server-13] #6    Object "/usr/lib/x86_64-linux-gnu/libc.so.6", at 0x7509ddf7ced2, in
[planner_server-13] #5    Object "/opt/overlay_ws/src/navigation2/install/nav2_planner/lib/libplanner_server_core.so", at 0x7509de8825cc, in std::__future_base::_State_baseV2::_M_do_set(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*)
[planner_server-13] #4    Object "/opt/overlay_ws/src/navigation2/install/nav2_planner/lib/libplanner_server_core.so", at 0x7509de8bd380, in std::_Function_handler<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> (), std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::thread::_Invoker<std::tuple<nav2::SimpleActionServer<nav2_msgs::action::ComputePathToPose>::handle_accepted(std::shared_ptr<rclcpp_action::ServerGoalHandle<nav2_msgs::action::ComputePathToPose> >)::{lambda()#1}> >, void> >::_M_invoke(std::_Any_data const&)
[planner_server-13] #3    Object "/opt/overlay_ws/src/navigation2/install/nav2_planner/lib/libplanner_server_core.so", at 0x7509de8bc2f4, in nav2::SimpleActionServer<nav2_msgs::action::ComputePathToPose>::work()
[planner_server-13] #2    Object "/opt/overlay_ws/src/navigation2/install/nav2_planner/lib/libplanner_server_core.so", at 0x7509de87b798, in nav2_planner::PlannerServer::computePlan()
[planner_server-13] #1    Object "/opt/overlay_ws/src/navigation2/install/nav2_planner/lib/libplanner_server_core.so", at 0x7509de873ce4, in nav2_planner::PlannerServer::publishPlan(nav_msgs::msg::Path_<std::allocator<void> > const&)
[planner_server-13] #0    Object "/opt/ros/rolling/lib/librclcpp_lifecycle.so", at 0x7509de62bf94, in rclcpp_lifecycle::SimpleManagedEntity::is_activated() const
[planner_server-13] Segmentation fault (Address not mapped to object [0x8])
[ERROR] [planner_server-13]: process has died [pid 129889, exit code -11, cmd '/opt/overlay_ws/src/navigation2/install/nav2_planner/lib/nav2_planner/planner_server --ros-args --log-level info --ros-args -r __node:=planner_server -r __ns:=/ -p use_sim_time:=True --params-file /tmp/launch_params_apyru5sq -r /tf:=tf -r /tf_static:=tf_static'].
```

Building Nav2 with the **RelWithDebInfo** or **Debug** build configuration allows for even more detailed backtraces including line numbers, file names, and relevant code blocks, in the backtrace:

```
[planner_server-13] [INFO] [1754377736.955537475] [planner_server]: Computing path to goal....
[planner_server-13] Stack trace (most recent call last) in thread 173639:
[planner_server-13] #11   Object "/usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2", at 0xffffffffffffffff, in
[planner_server-13] #10   Object "/usr/lib/x86_64-linux-gnu/libc.so.6", at 0x795ea7ac8c3b, in
[planner_server-13] #9    Object "/usr/lib/x86_64-linux-gnu/libc.so.6", at 0x795ea7a3baa3, in

⋮

[planner_server-13] #2    Source "/opt/overlay_ws/src/navigation2/nav2_planner/src/planner_server.cpp", line 546, in computePlan [0x795ea8344363]
[planner_server-13]         543:     }
[planner_server-13]         544:
[planner_server-13]         545:     // Publish the plan for visualization purposes
[planner_server-13]       > 546:     publishPlan(result->path);
[planner_server-13]         547:
[planner_server-13]         548:     auto cycle_duration = this->now() - start_time;
[planner_server-13]         549:     result->planning_time = cycle_duration;
[planner_server-13] #1    Source "/opt/overlay_ws/src/navigation2/nav2_planner/src/planner_server.cpp", line 640, in publishPlan [0x795ea833df4a]
[planner_server-13]         637:   auto msg = std::make_unique<nav_msgs::msg::Path>(path);
[planner_server-13]         638:   RCLCPP_WARN(get_logger(), "Publishing plan with %zu poses", path.poses.size());
[planner_server-13]         639:   plan_publisher_.reset();
[planner_server-13]       > 640:   if (plan_publisher_->is_activated() && plan_publisher_->get_subscription_count() > 0) {
[planner_server-13]         641:     plan_publisher_->publish(std::move(msg));
[planner_server-13]         642:   }
[planner_server-13]         643: }
[planner_server-13] #0    Object "/opt/ros/rolling/lib/librclcpp_lifecycle.so", at 0x795ea80f1f94, in rclcpp_lifecycle::SimpleManagedEntity::is_activated() const
[planner_server-13] Segmentation fault (Address not mapped to object [0x8])
[ERROR] [planner_server-13]: process has died [pid 172784, exit code -11, cmd '/opt/overlay_ws/src/navigation2/install/nav2_planner/lib/nav2_planner/planner_server --ros-args --log-level info --ros-args -r __node:=planner_server -r __ns:=/ -p use_sim_time:=True --params-file /tmp/launch_params_px13xl6j -r /tf:=tf -r /tf_static:=tf_static'].
```

If you want to enable automatic backtraces in your own packages, just add `backward_ros` as a dependency and `find_package` in your CMakeLists, then the backward libraries will be injected in all your executables and libraries.

**Note:** Currently, backward\_ros does not work with ComposedNodes due to missing support in rclcpp. Until this [issue](https://github.com/ros2/rclcpp/issues/2396) is resolved, launching the Nav2 stack with composition disabled (e.g. with a use\_composition:=False launch argument) is required to get automatic backtraces.

---

#### Groot - Interacting with Behavior Trees

*Source: [https://docs.nav2.org/tutorials/docs/groot.html](https://docs.nav2.org/tutorials/docs/groot.html)*

##### Groot - Interacting with Behavior Trees

* [Visualize Behavior Trees](#visualize-behavior-trees)
* [Edit Behavior Trees](#edit-behavior-trees)
* [Adding A Custom Node](#adding-a-custom-node)

###### Visualize Behavior Trees

To display a Behavior Tree like that in [Figure 3](#groot-nav2-default-bt), we will first start the Groot executable.
Out of the box, Groot can only display Behavior Trees and nodes that are from the defaults in BT.CPP, since it does not know anything about Nav2 or your other projects.
Therefore, we must point Groot to our palette, or index of Nav2 / custom behavior tree nodes:

1. Open Groot in editor mode. Now, Groot should look like in [Figure 1](#groot-bt-editor).
2. Select the Load palette from file option either via the context menu or the import icon in the top middle of the menu bar.
3. Open the file /path/to/navigation2/nav2\_behavior\_tree/nav2\_tree\_nodes.xml to import all the custom behavior tree nodes used for navigation. This is the palette of Nav2 custom behavior tree nodes. Now, Groot should look like in [Figure 2](#groot-bt-editor-with-nodes).
4. Select Load tree option near the top left corner
5. Browse the tree you want to visualize, then select OK. The Nav2 BTs exist in /path/to/navigation2/nav2\_bt\_navigator/behavior\_trees/

|  |  |
| --- | --- |
| ../../_images/groot_bt_editor.png Figure 1 Default Editor View | ../../_images/groot_with_nav2_custom_nodes.png Figure 2 Editor with Custom Nodes loaded in blue |

If you select the default tree navigate\_w\_replanning\_and\_recovery.xml, then a Groot editor should look like [Figure 3](#groot-nav2-default-bt).

|  |
| --- |
| ../../_images/bt_w_replanning_and_recovery.png Figure 3 Full Nav2 Default BehaviorTree |

Note

If a tree cannot be visualized because some nodes are missing in the palette, you might need to add it to your palette. While we try to keep Nav2’s BT nodes and palettes in sync, if you notice one is missing, please file a ticket or pull request and we should have that updated quickly.

###### Edit Behavior Trees

Now that you have a Nav2 BT open in Groot in editor mode, you should be able to trivially modify it using the GUI.
Starting from a screen like that shown in [Figure 3](#groot-nav2-default-bt), you can pull in new nodes from the side panel to add them to the workspace.
You may then connect the nodes using a “drag and drop” motion between the node’s input and output ports to assemble the new nodes into the tree.

If you select a given node, you can change metadata about it such as its name or values of parameterizable ports. When you’re done modifying, simply save the new configuration file and use that on your robot the next time!

###### Adding A Custom Node

Each node in the behavior tree holds a specialized function.
Sometimes, its useful to create new nodes and add them to your palette during the design process - perhaps before the implementations themselves exist.
This helps designers abstract away the implementation specifics of the nodes from the higher level logic of the tree itself and how they’d like to interact with a given node (e.g. type, ports, etc).
Within Groot, you may create new custom nodes to add to your tree and export these new nodes back to your palette.
Implementing the node itself needs to be done separately from Groot, which is described in [Writing a New Behavior Tree Plugin](../../plugin_tutorials/docs/writing_new_bt_plugin.html#writing-new-nbt-plugin).

|  |
| --- |
| ../../_images/groot_create_custom_node.png Figure 4 Create a new Custom Node |

Creating a new custom node can be started by clicking the orange marked icon in [Figure 4](#groot-create-custom-node), while Groot is in Editor mode.
This should load a new window, similar to [Figure 5](#groot-interactive-node-creation).
In this new window, it asks you to fill in the metadata about this new node, in order to create it.
It will ask you for standard information such as name (green box), type of node (orange box), and any optional ports for parameterization or access to blackboard variables (blue box).

After completing, select OK in [Figure 5](#groot-interactive-node-creation), the new custom node should appear in blue in the TreeNode Palette as in [Figure 6](#groot-export-new-node).

|  |  |
| --- | --- |
| ../../_images/groot_interactive_node_creation.png Figure 5 UI to describing new Nodes | <../../_images/groot_export_new_node.png> Figure 6 Exporting the new Custom Node |

Before starting to create a new BT based on the new custom nodes, it is recommend to export the newly created nodes to save in case of Groot crashing.
This can be performed with the icon highlighted in green from [Figure 6](#groot-export-new-node).
The resulting XML output from the node created in [Figure 5](#groot-interactive-node-creation) can be seen below.
You can see more examples in [Nav2’s BT Node Palette XML](https://github.com/ros-navigation/navigation2/blob/main/nav2_behavior_tree/nav2_tree_nodes.xml).

```
<root>
    <TreeNodesModel>
        <Action ID="MyAwesomeNewNode">
            <input_port name="key_name" default="false">coffee</input_port>
            <output_port name="key_name2" default="42">Sense of life</output_port>
            <inout_port name="next_target" default="pancakes">rolling target</inout_port>
        </Action>
    </TreeNodesModel>
</root>
```

---

#### Groot Tutorials

*Source: [https://docs.nav2.org/tutorials/docs/using_groot.html](https://docs.nav2.org/tutorials/docs/using_groot.html)*

##### Groot Tutorials

![../../_images/groot_start_menu.png](../../_images/groot_start_menu.png)

###### Overview


[Groot](https://github.com/BehaviorTree/Groot) is the companion application of the [BehaviorTree.CPP](https://github.com/BehaviorTree/BehaviorTree.CPP) library used to create, edit, and visualize behavior trees.
Behavior Trees are deeply integrated into Nav2, used as the main method of orchestrating task server logic across a complex navigation and autonomy stack.
Behavior Trees, in short BTs, consist of many nodes completing different tasks and control the flow of logic, similar to a Hierarchical or Finite State Machine, but organized in a tree structure.
These nodes are of types: Action, Condition, Control, or Decorator, and are described in more detail in [Navigation Concepts](../../concepts/index.html#concepts) and [Types of nodes in BehaviorTree.CPP](https://www.behaviortree.dev/docs/learn-the-basics/BT_basics#types-of-nodes).

[Writing a New Behavior Tree Plugin](../../plugin_tutorials/docs/writing_new_bt_plugin.html#writing-new-nbt-plugin) offers a well written example of creating a simple `Action` node if creating new BT nodes is of interest. This tutorial will focus solely on launching Groot, visualizing a Behavior Tree, and modifying that tree for a given customization, assuming a library of BT nodes. Luckily, Nav2 provides a robust number of BT nodes for your use out of the box, enumerated in [Navigation Plugins](../../plugins/index.html#plugins).

A BT configuration file in BehaviorTree.CPP is an XML file. This is used to dynamically load the BT node plugins at run-time from the appropriate libraries mapped to their names. The XML format is defined [in detail here](https://www.behaviortree.dev/docs/learn-the-basics/xml_format/). Therefore, Groot needs to have a list of nodes it has access to and important metadata about them like their type and ports (or parameters). We refer to this as the “palette” of nodes later in the tutorial.

In the video above you can see Groot side-by-side with RViz and a test platform 100% equipped with ROS-enabled hardware from SIEMENS.

There are tutorials available for both Groot and Groot2, with Groot2 being the newer version. Groot is used with BehaviorTree.CPP v3.x, while Groot2 is designed for v4.x.

###### Table of Contents

* [Groot - Interacting with Behavior Trees](groot.html)
* [Groot2 - Interacting with Behavior Trees](groot2.html)

---

#### Groot2 - Interacting with Behavior Trees

*Source: [https://docs.nav2.org/tutorials/docs/groot2.html](https://docs.nav2.org/tutorials/docs/groot2.html)*

##### Groot2 - Interacting with Behavior Trees

* [Visualize Behavior Trees](#visualize-behavior-trees)
* [Edit Behavior Trees](#edit-behavior-trees)
* [Adding A Custom Node](#adding-a-custom-node)

###### Visualize Behavior Trees

To display the default editor view, we will first start the Groot2 executable.
Out of the box, Groot2 can only display Behavior Trees and nodes that are from the defaults in BT.CPP, since it does not know anything about Nav2 or your other projects.
Therefore, we must point Groot2 to our palette, or index of Nav2 / custom behavior tree nodes:

1. Open Groot2 in editor mode. The interface should now look like the example shown in the first image below.
2. Click the red icon as shown in the second image, open the file /path/to/navigation2/nav2\_behavior\_tree/nav2\_tree\_nodes.xml to import all the custom behavior tree nodes used for navigation. Once loaded, you should see the full palette of Nav2’s custom nodes.
3. Click the blue icon as shown in the second image, browse the tree you want to visualize, then select Open. The Nav2 BTs exist in /path/to/navigation2/nav2\_bt\_navigator/behavior\_trees/.

[![../../_images/groot_bt_editor1.png](../../_images/groot_bt_editor1.png)](../../_images/groot_bt_editor1.png)
[![../../_images/groot_with_nav2_custom_nodes1.png](../../_images/groot_with_nav2_custom_nodes1.png)](../../_images/groot_with_nav2_custom_nodes1.png)

If you select the default tree navigate\_w\_replanning\_and\_recovery.xml, the Groot2 editor should now display the full behavior tree structure, as shown in the image below.

[![../../_images/bt_w_replanning_and_recovery1.png](../../_images/bt_w_replanning_and_recovery1.png)](../../_images/bt_w_replanning_and_recovery1.png)

You can also check/uncheck the Nodes visualization part in the preferences to better visualize the tree.

[![../../_images/groot_preferences.png](../../_images/groot_preferences.png)](../../_images/groot_preferences.png)

Note

If a tree cannot be visualized because some nodes are missing in the palette, you might need to add it to your palette. While we try to keep Nav2’s BT nodes and palettes in sync, if you notice one is missing, please file a ticket or pull request and we should have that updated quickly.

###### Edit Behavior Trees

Now that you have a Nav2 BT open in Groot2 in editor mode, you should be able to trivially modify it using the GUI.
You can pull in new nodes from the side panel to add them to the workspace.
You may then connect the nodes using a “drag and drop” motion between the node’s input and output ports to assemble the new nodes into the tree.

If you select a given node, you can change metadata about it such as its name or values of parameterizable ports. When you’re done modifying, simply save the new configuration file and use that on your robot the next time!

[![../../_images/editing_bt.png](../../_images/editing_bt.png)](../../_images/editing_bt.png)

###### Adding A Custom Node

Each node in the behavior tree holds a specialized function.
Sometimes, its useful to create new nodes and add them to your palette during the design process - perhaps before the implementations themselves exist.
This helps designers abstract away the implementation specifics of the nodes from the higher level logic of the tree itself and how they’d like to interact with a given node (e.g. type, ports, etc).
Within Groot2, you may create new custom nodes to add to your tree and export these new nodes back to your palette.
Implementing the node itself needs to be done separately from Groot2, which is described in [Writing a New Behavior Tree Plugin](../../plugin_tutorials/docs/writing_new_bt_plugin.html#writing-new-nbt-plugin).

Creating a new custom node can be started by clicking the red marked icon, while Groot2 is in Editor mode.

[![../../_images/groot_create_custom_node1.png](../../_images/groot_create_custom_node1.png)](../../_images/groot_create_custom_node1.png)

This should load a new window, as shown in the next image.

[![../../_images/groot_interactive_node_creation1.png](../../_images/groot_interactive_node_creation1.png)](../../_images/groot_interactive_node_creation1.png)

In this new window, it asks you to fill in the metadata about this new node, in order to create it.
It will ask you for standard information such as port name, type of node, and any optional ports for parameterization or access to blackboard variables.
After completing, select OK, the new custom node should now appear in the TreeNode Palette.

[![../../_images/groot_new_node.png](../../_images/groot_new_node.png)](../../_images/groot_new_node.png)

###### Exporting Behavior Trees

Once you have finished editing or creating your behavior tree in Groot2, you may want to export it for use in your application.
To do this, you can either use the Export Project button shown in the image below, or use the Save Current Project As button next to it.

[![../../_images/groot_export_button.png](../../_images/groot_export_button.png)](../../_images/groot_export_button.png)
[![../../_images/groot_export_page.png](../../_images/groot_export_page.png)](../../_images/groot_export_page.png)

Your behavior tree has been successfully exported! You can reload it the next time you open Groot2.

---

#### Lidar-Free, Vision-Based Navigation

*Source: [https://docs.nav2.org/tutorials/docs/using_isaac_perceptor.html](https://docs.nav2.org/tutorials/docs/using_isaac_perceptor.html)*

##### Lidar-Free, Vision-Based Navigation

In this tutorial, you’ll see how to use the NVIDIA Jetson, [Isaac ROS](https://developer.nvidia.com/isaac/ros), [Isaac Perceptor](https://developer.nvidia.com/isaac/perceptor), and [NVIDIA Nova](https://nvidia-isaac-ros.github.io/nova/index.html) technologies to implement Vision-based Navigation entirely without the use of LIDARs, active depth sensors, or other range-providing modalities.
Instead, we’ll rely solely on passive stereo cameras as the extrinsic sensing source to achieve collision avoidance, localization, and mapping — a powerful and cost-effective alternative.
The scripts and resources used can be found in [open-navigation/opennav\_visual\_navigation](https://github.com/open-navigation/opennav_visual_navigation).

This tutorial will guide you through the fundamental concepts behind vision-based navigation, explain how to configure and launch a vision-enabled Nav2 stack, and culminate in a hardware demonstration of a mobile robot performing autonomous security patrols.

Whether you’re developing for resource-constrained embedded systems or exploring alternatives to expensive sensor suites, this walk-through provides a complete introduction to deploying advanced autonomous navigation with only vision-based perception using a NVIDIA Nova reference platform, including stereo cameras and Jetson AGX Orin.

Note

While vision-based solutions offer powerful and efficient capabilities they can face challenges in certain environments. Scenarios involving glass surfaces, featureless corridors, thin obstacles, sudden movements, vibrations, or prolonged stillness under changing lighting conditions may impact performance.
It’s important to thoughtfully evaluate whether a visual navigation approach aligns with the specific demands and conditions of your application to ensure the best results.

###### Preliminaries

This tutorial assumes that you have an NVIDIA Jetson - such as the Orin NX or AGX Orin - and stereo camera sensor(s) compatible with the Nova reference platform.
This tutorial will make use of the [Jetson AGX Orin](https://amzn.to/4k8jiQh) powering the [Segway Nova Carter](https://robotics.segway.com/nova-carter/) robot built in collaboration with NVIDIA for vision-based navigation tasks.
However, another Jetson product may suffice depending on the GPU compute demands placed on it by the number of cameras, resolutions, and models being run.
Applying these technologies to a non-Nova design is possible using the general concepts and designs in this tutorial, however it involves a great deal of unique development as the launch files and nodes provided by NVIDIA assume this.

###### Additional Resources

* [Rebuilding TensorRT Engine for Isaac Perceptor on Nova Carter](isaac_perceptor/rebuilding_tensorrt_engine.html)

###### Concepts

Navigation is performed by combining sensor data map(s) of the environment, and task intent to successfully move a robot to a final destination.
Major elements of this include Path Planning, Control, Perception, Localization, and the Autonomy system to pull them all together.
If you want to learn more about Navigation, checkout [Navigation Concepts](../../concepts/index.html#concepts).

The elements that make use of sensor data are Perception and Localization.
Planning and Control make use of derivative information from these subsystems, such as the robot’s current pose or information about the location of potential obstacles, but not the direct data itself.
Structures like the environmental model fuses sensor data from many sensors together into a representation that is data agnostic, which can be used for planning and control algorithms to make decisions based off of.
In Nav2, that is commonly the Costmap package, but could be height maps, voxel grids, and so on.

Thus, for Visual Navigation, there are two major areas which need adjustment from Lidar and Depth-based navigation into Vision-based navigation: Perception and Localization.
We must replace the existing solutions for the following with Vision-based systems:

* **Data Acquisition**: Compute disparity information and derived results from stereo camera information
* **Data Fusion**: Combine multiple camera feeds into an environmental model for use in planning and control
* **Mapping**: Creating a globally-consistent view of the environment using camera data
* **Localization**: Using a globally-consistent view of the environment to later localize the robot within during task execution

Currently, these are solved in Lidar-based solutions using Costmap2D, a SLAM library like [SLAM Toolbox](https://github.com/SteveMacenski/slam_toolbox) or Cartographer, and a global localizer like AMCL.

###### NVIDIA Technologies

NVIDIA provides the necessary technologies to replace the existing Lidar-based navigation solutions.
This is made possible by leveraging the power of NVIDIA’s GPU and the Isaac ROS & Perceptor SDKs.

**Data Acquisition**:

Depth acquisition with Lidar- and Depth-based sensors is relatively straight forward.
For the majority of cases, a ROS driver will connect to the sensor and provide the depth data in a standard format like a Depth Image or PointCloud2.
Sometimes post-processing is needed to remove noise or other artifacts to improve later 3D reconstruction.

In the Vision-based navigation, we instead require more stages to obtain both the sensor data and derived results needed for 3D reconstructions to build the environmental model required for global path planning and local trajectory planning (control).

Data is first acquired via the Jetson’s `libargus` or a sensor manufacturer provided library to obtain sensor data in a low-latency, time-synchronized way to enable accurate information for Visual mapping and localization purposes.
This is key for good performance of a vision-based solution and many sensors are supported.
The disparity is then estimated using Isaac’s `isaac_ros_ess`, which computes a GPU accelerated, deep-learning based stereo disparity image.
Finally, `isaac_ros_stereo_image_proc` converts the disparity image into a Depth Image used for later 3D reconstruction.

Note

`isaac_ros_stereo_image_proc` may also compute a `PointCloud2` as well if an application calls for pointcloud rather than depth image format.

**Data Fusion**:

Once we’d obtained the depth information from the stereo pair, we can use this for environmental model construction and updates so we can leverage knowledge about the environment to make intelligent planning and control choices.
While definitionally 3D Reconstruction methods may not require depth information from camera feeds, most modern and robust solutions require it, hence the need for the Isaac SDK’s depth estimation pipeline.

NVIDIA provides a great 3D Reconstruction solution called [NvBlox](https://github.com/nvidia-isaac/nvblox).
`NvBlox` is a GPU accelerated signed-distance field library which can be used to generate environmental models using voxel grids.
This can take in multiple depth images from stereo camera pairs and populate a 3D environmental representation.

It can also accept an optional semantic segmentation mask to detect people, robots, or other dynamic objects in the scene to remove them from the environmental model’s update.
These dynamic obstacles are then later re-inserted at the end of the update to avoid artifacts in environmental updates related to dynamic obstacles without the need of expensive clearing logic.
Common demonstrations show this with a particular human segmentation model, but any model may be used trained to segment out any number of object classes.

Note

It may be necessary to regenerate these models in advance of doing any visual navigation or data collection/data fusion for visual navigation. See Troubleshooting section for details on common error messages and their solutions.

![../../_images/isaac_ros_nvblox_nodegraph.png](../../_images/isaac_ros_nvblox_nodegraph.png)

The NvBlox model is hosted inside of the Costmap2D package as a Costmap Layer Plugin used to update the occupancy grid model for use in planning and control.
Future updates to Nav2 may make it possible to use 3D environmental models natively rather than reducing dimensionality for use-cases that require 3D collision checking like mobile manipulation and traversibility estimation.

This removes the need to work with a Voxel Layer, Spatio-Temporal Voxel Layer, Obstacle Layer, or other sensor processing layers to mark and clear data from the occupancy grid.

**Mapping**:

Mapping is crucial for long-term planning to understand the environment and know how to navigate from a given point to any other point in a space most optimally.
While short-term navigation tasks with immediate visibility of the space may not require a pre-built map, most practically deployed applications require either (1) time-optimal execution and cannot get lost attempting to navigate down incorrect areas that will not lead to a solution or (2) operate in large spaces where the target poses are not commonly visible from current sensor data to establish a route to the goal.

[cuVSLAM](https://nvidia-isaac-ros.github.io/repositories_and_packages/isaac_ros_visual_slam/index.html) is used for visual SLAM (VSLAM) to create and save a map of the environment from sensor data.
This is a pure visual mapping solution that uses only stereo camera images and IMU data to map the environment using stereo feature matching.
Due to the computational demands of the mapping process on moderately large spaces, this is completed offline from a teleoperated data collection run. This fully replaces 2D, 3D, or other types of Lidar-SLAM.

**Localization**:

`cuVSLAM` is also used for run-time pure localization within the feature map generated during the mapping run.
This can run in excess of 30 fps with 4 stereo camera pairs, or even faster with fewer on the Jetson AGX Orin.

Additionally, a utility that Isaac ROS SDK provides, Visual Global Localization (cuVGL), is used to identify the initial starting pose in a localization run when one is not already previously known.
Using the features at the initial pose, it will match those with the pre-built map to identify the starting pose one-time on startup before continuing the localization session with cuVSLAM - solving the kidnapped robot problem.
This will be used to set the initial pose of the robot before starting navigation sessions.
It may also be used to relocalize the robot during runtime as well, which can be run in just under 1 second.

###### 0. NVIDIA Jetson Setup

###### Jetpack

If you don’t already have the latest jetpack installed follow the instructions below.
The current version at the time of writing is Jetpack 6.2 with Isaac 3.2.

If the Jetson is currently running Jetpack 6.0 or higher, [please use this guide to upgrade using apt to Jetpack 6.2](https://docs.nvidia.com/jetson/jetpack/install-setup/index.html#upgrade-jetpack).
Otherwise, the [NVIDIA SDK Manager](https://developer.nvidia.com/sdk-manager) is required to upgrade, either as a docker image or debian to run on a developer computer.

Note

Be sure to have the Jetson’s USB-C port used for bootloading accessible if upgrading using the SDK Manager. Use the IP addresses of this wired connection, not over a local WAN.

###### Nova Init

If not already setup, make sure to install and configure Nova Init using [the following instructions](https://nvidia-isaac-ros.github.io/nova/nova_init/index.html).

###### Power Modes

If not already setup in Max Power Mode, we recommend you do so now to be able to leverage the full power of the Jetson.
Power Mode settings are accessed and controlled with the `nvpmodel` command and the CPU/GPU clock settings are controlled via `jetsonclocks`. The following commands will set the Jetson to Max Power Mode with the CPU/GPU clocks set to maximum performance as well.

Set CPU/GPU clocks to maximum: `sudo /usr/bin/jetson_clocks`

Set Max Power Mode for power consumption: `sudo nvpmodel -m 2`

Confirm settings by running: `sudo /usr/bin/jetson_clocks --show|tail -1` and `sudo /usr/bin/nvpmodel -q|head -1`

Details on power consumption, CPU/GPU frequencies, cooling fan speeds, etc. can be found at <https://docs.nvidia.com/jetson/archives/r35.1/DeveloperGuide/text/SD/PlatformPowerAndPerformance/JetsonOrinNxSeriesAndJetsonAgxOrinSeries.html>

Users with a power constrained application, should consider which power setting make most sense for your power resources, compute requirements, and application duration. Revisit this after the demonstration to optimize for your requirements and power needs.

###### Compatible Cameras

There are several cameras that are compatible with this workflow.
We recommend the [Stereolabs ZED](https://www.stereolabs.com/) cameras for their native integration with the NVIDIA ecosystem and ease of use.
Stereolabs also provides a powerful SDK of Vision and Spatial AI features which can be further leveraged to increase the functionality and intelligence of a vision-based mobile robot.
However, stereo cameras from [Leopard Imaging](https://leopardimaging.com/leopard-imaging-hawk-stereo-cameras/) are also compatible and supported.

Cameras with tight integration and synchronization are required to work with cuVSLAM due to its timing constraints to achieve accurate results.
Thus, we recommend using one of these compatible options.
However, if you’d like to use NvBlox without cuVSLAM and using another localization and mapping solution, a broader range of camera options are available such as the Realsense.
NvBlox uses the pose estimates that cuVSLAM provides, but those pose estimates can be from any source.
It uses these pose estimates to place the sensor data in the scene to populate the environmental model.
NvBlox can work well on just a single stereo camera, but cuVSLAM typically requires two or more cameras to see enough of the scene to obtain robust results.

###### 1. Initial Setup

First, we need to set up a [Isaac ROS Dev](https://nvidia-isaac-ros.github.io/getting_started/dev_env_setup.html) environment using Docker, as highly recommended by NVIDIA.

###### Tooling Setup

This can be run as a single block of commands or one at a time in a Linux shell:

```
sudo systemctl daemon-reload && sudo systemctl restart docker
sudo apt install git-lfs
git lfs install --skip-repo
mkdir -p  /mnt/nova_ssd/workspaces/isaac_ros-dev/src
echo "export ISAAC_ROS_WS=/mnt/nova_ssd/workspaces/isaac_ros-dev/" >> ~/.bashrc
source ~/.bashrc
```

This sets up Git LFS (large file storage) for downloading weights and files stored in the Isaac ROS source repositories.
It also creates a developer workspace `isaac_ros-dev` either on an externally mounted SSD or on the local computer.
It is recommended to use an externally mounted SSD or NVME drive to have sufficient storage to run this demonstration.

For an external drive, use `echo "export ISAAC_ROS_WS=/mnt/nova_ssd/workspaces/isaac_ros-dev/" >> ~/.bashrc`

If one is not available or you are using a large(>1TB) internal drive change the line to `echo "export ISAAC_ROS_WS=/home/${USER}/workspaces/isaac_ros-dev/" >> ~/.bashrc`

This sets an environmental variable `ISAAC_ROS_WS` which is used to mount the workspace to the Isaac ROS containers and in other Isaac workflows, so it is important to always have that set.

Note

The NVIDIA Jetson Orin and Jetson Xavier family system have an M.2 Key-M(AKA 2280) slot which provides support for an onboard NVME SSD drive. The NVIDIA SDKManager install tool has configuration options to flash a Jetpack image to this drive, providing high-capacity storage at PCIe speeds without the need for an external drive or MicroSD card.

Make sure the rosbag for mapping and the output occupancy grid map directories are mounted to the docker container. You can add them in ${ISAAC\_ROS\_WS}/src/isaac\_ros\_common/scripts/.isaac\_ros\_dev-dockerargs then restart the container:

```
echo -e '-v /mnt/nova_ssd/recordings:/mnt/nova_ssd/recordings' > ${ISAAC_ROS_WS}/src/isaac_ros_common/scripts/.isaac_ros_dev-dockerargs
echo -e '-v /mnt/nova_ssd/maps:/mnt/nova_ssd/maps' > ${ISAAC_ROS_WS}/src/isaac_ros_common/scripts/.isaac_ros_dev-dockerargs
```

Next, we’re going to clone the `isaac_ros_common` package which contains key elements of Isaac ROS, including the dockerfiles and scripts needed to run Isaac in the Dev environment.

```
cd ${ISAAC_ROS_WS}/src && git clone -b release-3.2 https://github.com/NVIDIA-ISAAC-ROS/isaac_ros_common.git
```

If working with a Nova Carter device, [do the following](https://nvidia-isaac-ros.github.io/robots/nova_carter/getting_started.html#repositories-setup-optional) as well to setup the docker configs.

###### Demonstration Setup

We’re now ready to launch the container, we can do so via:

```
cd ${ISAAC_ROS_WS}/src/isaac_ros_common && ./scripts/run_dev.sh
```

Once we’ve obtained and setup Isaac, we can add in the `opennav_visual_navigation` project as a starting point.

```
##### Clones the project and creates a colcon_ws relative to your path
cd ${ISAAC_ROS_WS}/src && git clone git@github.com:open-navigation/opennav_visual_navigation.git
```

###### 2. Software & Workflow Walkthrough

The demonstration leverages the Nova Carter robot, so the hardware is brought up using the [nova\_carter\_bringup](https://github.com/NVIDIA-ISAAC-ROS/nova_carter/tree/main/nova_carter_bringup) launch file `navigation.launch.py` and `teleop.launch.py` which launches the robot hardware and other nodes needed for the demonstration.
This has been preconfigured with Nav2, Isaac Perceptor, and is highly integrated with the Nova reference platform.
Please reference this package for more information.

To adapt to another platform, make a new `my_robot_nav` package which:

* Launches the robot hardware drivers for accepting commands, bringing up sensors, providing transformation tree, etc
* Launches Isaac Perceptor, usually via `isaac_ros_perceptor_bringup` package’s `perceptor_general.launch.py` or `perceptor_rgbd.launch.py`
* Launches Nav2 with the appropriate configurations (i.e. removed AMCL for cuVSLAM, Costmap configurations for NvBlox)

Use these launch files to replace `nova_carter_bringup/launch/navigation.launch.py` used in this package.

The demonstration is setup to utilize the front, left, and right stereo cameras for localization with VSLAM and 3D reconstruction using NvBlox using live use.
While the rear camera would also provide useful information (and is also used during the VSLAM mapping dataset), it adds additional computation beyond what the AGX Orin can handle in real-time with the present Isaac release.
This may be improved at a future time or when using newer Jetson platforms such as the Thor.
The 2D and 3D lidars are disabled and not used anywhere in this work.

###### 3. Initial Environment Mapping

###### Data Collection

The first step is to generate a dataset to create the VSLAM map during offline processing.
When working in realistically large spaces, this cannot be done on the Jetson in real-time, so it is necessary to teleoperate the robot for the initial mapping session rather than completed in real-time.

Tips and Tricks:

* Start datasets with 10 seconds at the starting pose before moving the robot so it may be used in the future for localization testing
* Teleop the robot into a clear space before starting recording, ensure it is not docked and the cameras are not obstructed by a wall, furniture, etc. This ensures the starting data will contain features that can be processed later.
* For each 5x5m area, drive for around 1 minute
* Drive in closed loops and make sure to capture data at more than one angle (i.e. drive in different directions to obtain different viewpoints)
* Don’t drive for a long time in a straight line, weave and swerve.
* There’s a technique to making a good VSLAM map, it might take you a few tries to get good results.

![../../_images/mapping1.gif](../../_images/mapping1.gif)
![../../_images/mapping2.gif](../../_images/mapping2.gif)

When ready, inside of the docker image from before, run the following and joystick your robot through the space:

```
ros2 launch isaac_ros_nova_recorder nova_recorder.launch.py \
    config:=nova-carter_hawk-4_imu \
    headless:=True
```

This will launch the `isaac_ros_nova_recorder` node, which wraps `isaac_ros_data_recorder`, and a teleop node from the `nova_carter_bringup` package. You can also launch the recording from the provided convenience script in the host environment: `./scripts/run_docker_nova_recorder.sh`

Note

The `config` parameter is used to specify the set of sensors to use during mapping. The `nova-carter_hawk-4_imu` config uses only the 4 stereo cameras in the front of the Nova Carter robot, plus the onboard IMU. If you do not have the Hawk cameras or wish to use other sensors, you can check out the other configs under `/etc/nova`. Using additional sensors will result in a larger `rosbag2` recording and could result in a significantly longer post-processing time.

More details on the available configs can be found here:

<https://nvidia-isaac-ros.github.io/v/release-3.1/repositories_and_packages/isaac_ros_nova/isaac_ros_data_recorder/index.html#try-more-examples>

Follow the guidelines outlined above and begin to drive the robot around the space. In the example above the `nova_carter_recorder` node will begin recording stereo images from the Hawk cameras integrated into the Nova Carter robot. Data will be stored in the `/mnt/nova_ssd/recordings` directory by default as a `rosbag2` (MCAP) file. See the full nova\_carter\_recorder tutorial at <https://nvidia-isaac-ros.github.io/repositories_and_packages/isaac_ros_nova/isaac_ros_nova_recorder/index.html> for details on other command-line arguments that will allow storage of the mapping run to Amazon S3, etc. When you have sufficiently mapped the area, remembering to do loop closures, hit `CTRL-C` in the terminal you launched the recording from.

![../../_images/loop_closures_demo.gif](../../_images/loop_closures_demo.gif)

The loop closure technique for mapping the space.

When you are done you should see a directory contain the MCAP file(s) in `/mnt/nova_ssd/recordings` like this:

```
nvidia@carter-v24-nav2:/mnt/nova_ssd/recordings$ ls -l
total 5612708
drwxr-xr-x  2 root   root         4096 Sep 14 18:15 2025-09-15_01-07-21_rosbag2
drwxr-xr-x  2 root   root         4096 Sep 16 10:14 2025-09-16_17-13-45_rosbag2
drwxr-xr-x  2 root   root         4096 Sep 16 10:25 2025-09-16_17-14-57_rosbag2

[...]
```

Be aware that the recording files can be quite large, even for a short run:

```
nvidia@carter-v24-nav2:/mnt/nova_ssd/recordings$ du -ah -d 1 2025-09-16_17-14-57_rosbag2
16K     2025-09-16_17-14-57_rosbag2/metadata.yaml
18G     2025-09-16_17-14-57_rosbag2/2025-09-16_17-14-57_rosbag2_0.mcap
18G     2025-09-16_17-14-57_rosbag2
nvidia@carter-v24-nav2:/mnt/nova_ssd/recordings$
```

###### Data Processing

After the dataset has been collected, it must be processed to generate the cuVSLAM map for localization and cuVGL map used for initial global localization. It can be done via `./tools/create_map.sh <PATH_TO_ROSBAG> <PATH_TO_OUTPUT_FOLDER>`. For example using the recommended directories:

```
export LD_LIBRARY_PATH="/workspaces/isaac_ros-dev/ros_ws/isaac_ros_assets/models/dnn_stereo_disparity/dnn_stereo_disparity_v4.1.0_onnx/plugins/aarch64/:$LD_LIBRARY_PATH"

ros2 run isaac_mapping_ros create_map_offline.py --sensor_data_bag=/mnt/nova_ssd/recordings/<RECORDED_BAG_NAME> \
    --base_output_folder=/mnt/nova_ssd/recordings/maps \
    --print_mode all --steps_to_run edex,cuvslam,cuvgl
```

Warning

Starting with version 4.1.0 of the `isaac-ros-ess` code, the plugin architecture was changed to allow for custom plugins. This means you need to explicitly provide the path to the plugins for the models you’ve installed, even if they are the default ones provided by NVIDIA.
For the `dnn_stereo_disparity` models, installed as part of the `isaac-ros-ess-install-models` package, this looks like:

`export LD_LIBRARY_PATH="/workspaces/isaac_ros-dev/ros_ws/isaac_ros_assets/models/dnn_stereo_disparity/dnn_stereo_disparity_v4.1.0_onnx/plugins/aarch64/:$LD_LIBRARY_PATH"`

Not setting this will cause the depth and occupancy\_map generation steps to fail.

When finished, you should see something like the output below:

```
nvidia@carter-v24-nav2:/mnt/nova_ssd/recordings/maps$ ls -l 2025-11-13_04-02-21_2025-11-13_02-54-48_rosbag2/
total 68
drwxr-xr-x  5 nvidia nvidia  4096 Nov 13 16:55 cuvgl_map
drwxr-xr-x  2 nvidia nvidia  4096 Nov 12 23:11 cuvslam_map
drwxr-xr-x 10 nvidia nvidia  4096 Nov 12 23:16 edex
drwxr-xr-x  2 nvidia nvidia  4096 Nov 13 00:40 logs
drwxr-xr-x  2 nvidia nvidia  4096 Nov 12 23:12 poses
nvidia@carter-v24-nav2:/mnt/nova_ssd/recordings/maps$
```

This step may take some time(up to several hours depending on the length of your recording) and will use the full compute power of the Jetson. It is recommended to not have other workloads on the Jetson while this is processing.

###### Final results

Once all the scripts have run to completion, your final directory contents should look something like this:

```
nvidia@carter-v24-nav2:/mnt/nova_ssd/recordings/maps$ ls -l 2025-11-13_04-02-21_2025-11-13_02-54-48_rosbag2/
total 68
drwxr-xr-x  5 nvidia nvidia  4096 Nov 13 16:55 cuvgl_map
drwxr-xr-x  2 nvidia nvidia  4096 Nov 12 23:11 cuvslam_map
drwxr-xr-x 10 nvidia nvidia  4096 Nov 12 23:16 edex
drwxr-xr-x  2 nvidia nvidia  4096 Nov 26 00:40 logs
drwxr-xr-x  4 nvidia nvidia  4096 Nov 12 23:21 map_frames
-rw-r--r--  1 nvidia nvidia    93 Nov 26 00:40 metadata.yaml
-rw-r--r--  1 root   root   17267 Nov 26 01:07 occupancy_map.png
-rw-r--r--  1 root   root     134 Nov 26 01:07 occupancy_map.yaml
drwxr-xr-x  2 nvidia nvidia  4096 Nov 12 23:12 poses
nvidia@carter-v24-nav2:/mnt/nova_ssd/recordings/maps$
```

Explanation:

* `cuvgl_map` - Contains Visual Global Localization database used with the `cuvslam_map` including Visual Bag Of Words(VBOW) data, etc.
* `cuvslam_map` - Contains VSLAM map
* `edex` - camera intrinsics and frame metadata
* `depth` - depth maps generated by isaac\_ros\_dnn\_stereo\_disparity DNN models and the ESS plugin
* `map_frames` - recorded camera topic data broken out into individual frames on a per-camera basis, including raw and depth images.
* `poses` - pose database

We see that in addition to the populated map directories, we have an `occupancy_map.png` and `occupancy_map.yaml` file. These will be useful for the point-to-point VSLAM navigation. The YAML file should reference the PNG file and look like a typical 2D ROS map metadata file:

```
image: "occupancy_map.png"
mode: "trinary"
resolution: 0.05
origin: [-20.8, -16, 0]
negate: 0
occupied_thresh: 0.65
free_thresh: 0.25
```

Let’s take a look at the `occupancy_map.png` file itself:

![../../_images/occupancy_map.png](../../_images/occupancy_map.png)

We’ll note that this lacks the typical fine detail we’re used to seeing from a LIDAR-generated occupancy grid map. This is an artifact of image data being converted to depth data and highlights the importance of using the loop-closure techniques mentioned above when recording the visual data. Despite appearances, this map is quite sufficient for visual navigation around the space. The occupancy map is really only one layer in the whole localization stack used by the robot during visual navigation. Isaac ROS Perceptor will also use the cuvslam\_map, cuvgl\_map and live image data from the cameras on the robot for localization against features in the mapped space.

###### 4. Navigation Testing

Now that this initial setup is complete, we’re ready to start navigating using visual localization and collision avoidance!

![../../_images/isaac_ros_perceptor_polymath_zoomed_out.png](../../_images/isaac_ros_perceptor_polymath_zoomed_out.png)

Simply run the main demonstration launch file and see it in action!

```
ros2 launch opennav_visual_nav_demo visual_nav_demo_launch.py
```

Note

This wraps the larger command:

`ros2 launch nova_carter_bringup perceptor.launch.py use_foxglove_whitelist:=false stereo_camera_configuration:=front_left_right_configuration disable_vgl:=False vslam_load_map_folder_path:=$vslam_dir vgl_map_dir:=$vgl_dir occupancy_map_yaml_file:=$occupancy_map_path vslam_enable_slam:=True`

Running this will require the user to attach to the container from a separate terminal and run:

`ros2 launch nav2_bringup navigation_launch.py`

to launch Nav2. NVIDIA provides its own VSLAM stack, so Nav2 is not launched by default.

You should now see something like this in Foxglove Studio:

![../../_images/isaac_ros_perceptor_nvblox_kitchen.png](../../_images/isaac_ros_perceptor_nvblox_kitchen.png)

And be able to now navigate as shown in the video below! A special thanks to Nav2 Sponsor [Polymath Robotics](https://www.polymathrobotics.com/) for allowing us to use their space over the holidays to perform these demonstrations.

###### 5. Conclusions & Extensions

In this tutorial, we showed how Nav2 can be used without lidar or depth cameras to conduct vision-only navigation leveraging NVIDA’s technologies (Jetson, Isaac ROS, Isaac Perceptor, Nova reference platform).
To leverage even more vision features during Visual Navigation, you can also use the Isaac SDK, ZED SDK, or other AI technologies to leverage the GPU for:

* Object detection or semantic segmentation: `isaac-ros-peoplenet` and `isaac-ros-peoplesemsegnet` for person recognition and semantic segmentation of people from mapped spaces.
* Ground or freespace segmentation
* Explore other VSLAM, VIO, or 3D Mapping technologies

###### Resources

More detailed information can be found in the following documentation:

* [Isaac ROS Visual SLAM](https://nvidia-isaac-ros.github.io/repositories_and_packages/isaac_ros_visual_slam/isaac_ros_visual_slam/index.html)
* [Isaac ROS NvBlox](https://nvidia-isaac-ros.github.io/repositories_and_packages/isaac_ros_nvblox/index.html)
* [Isaac ROS Visual GLobal Localization](https://nvidia-isaac-ros.github.io/repositories_and_packages/isaac_ros_mapping_and_localization/isaac_ros_visual_global_localization/index.html)
* [Disparity Mapping & Image Fusion with Isaac ROS DNN ESS](https://nvidia-isaac-ros.github.io/repositories_and_packages/isaac_ros_dnn_stereo_depth/index.html)
* [Isaac ROS Stereo Image Proc](https://nvidia-isaac-ros.github.io/repositories_and_packages/isaac_ros_image_pipeline/isaac_ros_stereo_image_proc/index.html)
* [Isaac Perceptor Docs](https://nvidia-isaac-ros.github.io/reference_workflows/isaac_perceptor/index.html)
* [Isaac ROS Mapping](https://nvidia-isaac-ros.github.io/repositories_and_packages/isaac_ros_mapping_and_localization/isaac_mapping_ros/index.html)
* [Nvidia TensorRT - CUDA Accelerated TensorFlow](https://developer.nvidia.com/tensorrt)

Related GitHub repositories can be found here:

* <https://github.com/NVIDIA-ISAAC-ROS/nova_carter>
* <https://github.com/NVIDIA-ISAAC-ROS/isaac_ros_mapping_and_localization>
* <https://github.com/NVIDIA-ISAAC-ROS/isaac_ros_visual_slam/tree/main>
* <https://github.com/NVIDIA-ISAAC-ROS/isaac_perceptor/tree/main/isaac_ros_perceptor_bringup>
* <https://github.com/NVIDIA-ISAAC-ROS/isaac_ros_nova>
* <https://github.com/NVIDIA-ISAAC-ROS/isaac_ros_nvblox>

More demonstrations can be found here:

* [Tutorial: Mapping and Localization with Isaac Perceptor](https://nvidia-isaac-ros.github.io/reference_workflows/isaac_perceptor/tutorial_mapping_and_localization.html)
* [Tutorial: Camera-based 3D Perception with Isaac Perceptor on the Nova Carter](https://nvidia-isaac-ros.github.io/reference_workflows/isaac_perceptor/tutorials_on_carter/demo_perceptor.html)
* [Tutorial: Autonomous Navigation with Isaac Perceptor and Nav2 on the Nova Carter](https://nvidia-isaac-ros.github.io/reference_workflows/isaac_perceptor/tutorials_on_carter/demo_navigation.html)

###### Troubleshooting

###### Isaac Perceptor API Usage Errors

`Error Code 6: API Usage Error (The engine plan file is not compatible with this version of TensorRT, expecting library version 10.7.0.23 got...`

This error occurs when the packages on the Nova Carter host install are different from those installed on the Docker container, specifically the TensorRT and nvblox packages. More specifically, this often occurs because the Nova Carter JetPack install provides 10.3.x versions of TensorRT(tensorrt,nvinfer,etc.) and the development Docker containers use 10.7.x

See [Rebuilding TensorRT Engine for Isaac Perceptor on Nova Carter](isaac_perceptor/rebuilding_tensorrt_engine.html#rebuilding-tensorrt-engine) for a step-by-step guide to fix this error.

`Error Code 4: API Usage Error`

This error should be avoided as part of the engine regeneration solution to the `Error Code 6:` issue. In case it still occurs, the problem is related to how trtexec generated the new .engine and .plan file.
By default trtexec will generate a “lean” .engine runtime model. A “full” runtime model is necessary for the dnn\_stereo\_disparity node to run successfully.

###### Library Path Errors

`ess_engine_x.so: No such file or directory`

This is a Library pathing problem on the Docker container that `isaac_ros_mapping` may throw.
In the Docker startup/entrypoint script, set LD\_LIBRARY to include the `$ISAAC_ROS_WS/isaac_ros_assets` path as part of LD\_LIBRARY\_PATH **or** prepend it to the launch script when processing data recorded by `isaac_nova_recorder`. A one-line fix for this error looks like:

```
LD_LIBRARY_PATH="/workspaces/isaac_ros-dev/ros_ws/isaac_ros_assets/models/dnn_stereo_disparity/dnn_stereo_disparity_v4.1.0_onnx/plugins/aarch64/:$LD_LIBRARY_PATH" \
ros2 run isaac_mapping_ros create_map_offline.py \
--sensor_data_bag=/mnt/nova_ssd/recordings/<PATH_TO_RECORDED_DATA>/ \
--base_output_folder=/mnt/nova_ssd/recordings/maps/
```

This has also been observed to affect depth and occupancy map generation, with the resulting error as the isaac\_ros\_dnn\_disparity

###### Troubleshooting map generation

By default the `./tools/create_map.sh` script may fail to generate all stages of the map for a number of reasons. If this crashes repeatedly for you, one workaround is to generate the map data needed for VSLAM piecewise.

If, for example, you are running into errors generating the depth and occupancy\_map data, you can skip around these and generate the cuvgl and cuvslam assets like so:

```
ros2 run isaac_mapping_ros create_map_offline.py --sensor_data_bag=/mnt/nova_ssd/recordings/<path_to_recorded_bag_file>/ \
--steps_to_run edex cuvslam map_frames cuvgl
```

If you wanted to pick up the process using the existing data and (re)generate the cuvslam dataset you could run:

```
ros2 run isaac_mapping_ros create_map_offline.py --sensor_data_bag=/mnt/nova_ssd/recordings/<path_to_recorded_bag_file>/ \
--map_dir=/mnt/nova_ssd/recordings/maps/${EXISTING_MAP_DIR}/ --steps_to_run cuvslam
```

Similarly, to run the depth step by itself, the command-line would be:

```
export LD_LIBRARY_PATH="${ISAAC_ROS_WS}/isaac_ros_assets/models/dnn_stereo_disparity/dnn_stereo_disparity_v4.1.0_onnx/plugins/aarch64:$LD_LIBRARY_PATH"

ros2 run isaac_mapping_ros run_ess_ros_offline.py \
 --image_dir=/mnt/nova_ssd/recordings/maps/${EXISTING_MAP_DIR}/map_frames/raw \
 --output_dir=/mnt/nova_ssd/recordings/maps/${EXISTING_MAP_DIR}/map_frames/depth \
--frames_meta_file=/mnt/nova_ssd/recordings/maps/${EXISTING_MAP_DIR}/map_frames/raw/frames_meta.json
```

The occupancy\_map generation step can be run with this command:

```
ros2 run isaac_mapping_ros create_map_offline.py \
--sensor_data_bag=/mnt/nova_ssd/recordings/${BAG_DIR} \
--base_output_folder=/mnt/nova_ssd/recordings/maps \
--map_dir=/mnt/nova_ssd/recordings/maps/${EXISTING_MAP_DIR} \
--print_mode all --steps_to_run occupancy
```

Most of the tools used by `./tools/create_map.sh` can be found in the Docker container under `/opt/ros/humble/lib/isaac_mapping_ros` and run individually if necessary:

```
root@carter-v24-nav2:/opt/ros/humble/lib/isaac_mapping_ros# ls -l
total 7080
-rwxr-xr-x 1 root root  100512 Jul 10 00:17 camera_frame_selection
-rwxr-xr-x 1 root root  112816 Jul 10 00:17 copy_image_dir_main
-rwxr-xr-x 1 root root    7099 Jul 10 00:15 create_cuvgl_map.py
-rwxr-xr-x 1 root root   17072 Jul 10 00:15 create_map_offline.py
-rwxr-xr-x 1 root root  116912 Jul 10 00:17 decode_video
-rwxr-xr-x 1 root root  121016 Jul 10 00:17 mapping_pose_to_rosbag
-rwxr-xr-x 1 root root 5233656 Jul 10 00:17 optimize_vo_with_keyframe_pose_main
-rwxr-xr-x 1 root root   67680 Jul 10 00:17 rosbag_poses_to_tum_format
-rwxr-xr-x 1 root root 1129064 Jul 10 00:17 rosbag_to_mapping_data
-rwxr-xr-x 1 root root   18543 Jul 10 00:15 run_ess_ros_offline.py
-rwxr-xr-x 1 root root   43304 Jul 10 00:17 run_nvblox
-rwxr-xr-x 1 root root    4001 Jul 10 00:15 run_rosbag_to_mapping_data.py
-rwxr-xr-x 1 root root  112856 Jul 10 00:17 select_frames_meta
-rwxr-xr-x 1 root root  141512 Jul 10 00:17 update_keyframe_pose_main
root@carter-v24-nav2:/opt/ros/humble/lib/isaac_mapping_ros#
```

These are covered extensively in the NVIdia tutorial <https://nvidia-isaac-ros.github.io/reference_workflows/isaac_perceptor/tutorial_mapping_and_localization.html#creating-maps>

---

#### Navigating using GPS Localization

*Source: [https://docs.nav2.org/tutorials/docs/navigation2_with_gps.html](https://docs.nav2.org/tutorials/docs/navigation2_with_gps.html)*

##### Navigating using GPS Localization

* [Overview](#overview)
* [Requirements](#requirements)
* [GPS Localization Overview](#gps-localization-overview)
* [Tutorial Steps](#tutorial-steps)
* [Conclusion](#conclusion)


###### Overview

This tutorial shows how to set up a localization system using a GPS sensor(s) as the source of global positioning, robot\_localization (RL) for sensor fusion, and how to use Nav2 to follow GPS waypoints. It was written by Pedro Gonzalez at [Kiwibot](https://www.kiwibot.com/).

###### Requirements

It is assumed ROS2 and Nav2 dependent packages are installed or built locally. Additionally you will have to install robot\_localization and mapviz:

> ```
> source /opt/ros/<ros2-distro>/setup.bash
> sudo apt install ros-$ROS_DISTRO-nav2-minimal-tb3*
> sudo apt install ros-$ROS_DISTRO-robot-localization
> sudo apt install ros-$ROS_DISTRO-mapviz
> sudo apt install ros-$ROS_DISTRO-mapviz-plugins
> sudo apt install ros-$ROS_DISTRO-tile-map
> sudo apt install ros-$ROS_DISTRO-teleop-twist-keyboard
> ```

If some of the packages are not available by apt install, go to the respective projects and build from source.

The code for this tutorial is hosted on [nav2\_gps\_waypoint\_follower\_demo](https://github.com/ros-navigation/navigation2_tutorials/tree/master/nav2_gps_waypoint_follower_demo). Though we will go through the most important steps of the setup, it’s highly recommended that you clone and build the package when setting up your dev environment.
This is available in ROS 2 Iron and newer.

You may also need to install gazebo and turtlebot3 simulation if you have not executed previous tutorials or Nav2 demos. See Nav2’s Getting Started page for more information.

###### GPS Localization Overview

GPS (Global Positioning System) or more broadly GNSS (Global Navigation Satellite System) is a technology that relies on satellites to provide receivers with an estimate of where they are located on the earth. These satellites are in orbit at altitudes around 20.000km and use radio frequency to continuously broadcast time signals, these are picked up by receivers when satellites are along their line of sight, they use trilateration to estimate their latitude, longitude and altitude.

Commonly GPS devices calculate their position using the [WGS84 standard](https://en.wikipedia.org/wiki/World_Geodetic_System), which defines a cartesian system with its origin on the earth’s center of mass, the `z` axis pointing north and the `x` axis pointing to the first meridian as the image below shows.

[![WGS84 reference frame](../../_images/WGS_84_reference_frame.svg)](../../_images/WGS_84_reference_frame.svg)

However, this reference system is impractical for describing the motion and representing the environment around objects in or close to the earth’s surface: Imagine your robot is located on a soccer field and you want it to move from one end to the other, your navigation task would look something like:

> “go from X=4789.413km, Y=177.511km z=4194.292km to X=4789.475km, Y=177.553km z=4194.22km”

Addinally, if your robot has for instance a 2D lidar, you would have to transform its data to this reference system as well. It would make much more sense to create a local reference system where you could tell your robot “go 100 meters forward” and your sensor data could populate your environment representation accordingly, right?

To cope with this, geodesy proposes several planar projection systems for localization with respect to the surface of the earth. One of them is the [UTM coordinate system](https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system), which assumes earth is an ellipsoid and divides it in 60 zones, each of them spanning across 6 longitude degrees. A zone represents the projection of the ellipsoid’s surface over a secant cylinder parallel to its central meridian; each of them is then split into 20 latitude bands that span across 8 latitude degrees, which create local grid zones where positions are expressed using planar coordinates from the origin of the zone. The image below shows the grid zones spanning across South America.

[![UTM grid zones in South America](../../_images/South-America-UTM-zones.png)](../../_images/South-America-UTM-zones.png)

[robot\_localization](http://docs.ros.org/en/noetic/api/robot_localization/html/index.html) uses this projection system to transform GPS measurements in the WGS84 reference system to a cartesian system, which centered on the origin of the grid zone where the GPS is at. This is achieved through the [navsat\_transform node](http://docs.ros.org/en/jade/api/robot_localization/html/navsat_transform_node.html). This node complies with the ENU convention in [REP 103](https://www.ros.org/reps/rep-0103.html), meaning that the `+x` axis of the `utm` coordinate system faces east, the `+y` faces north and the `+z` axis points up.

In the real world GPS sensors can be noisy: With standalone GPSs you should expect accuracies of 1-2 meters under excellent conditions and up to 10 meters, and frequent jumps in the position as the GPS sensor picks up less or more satellites, which can degrade the quality of navigation significantly. Several positioning augmentation technologies exists to reduce the error of GPS measurements, one of the most common ones is called [RTK](https://en.wikipedia.org/wiki/Real-time_kinematic_positioning) (Real Time Kinematic Positioning), which can bring the accuracy of receivers down to 1cm. If accuracy matters in your application this technology is highly recommended; though this requires the deployment of a second fixed GPS called base, most of the US and Europe are already covered with public free to use bases that you can connect to. You can read more about RTK and how to get started [here](https://learn.sparkfun.com/tutorials/setting-up-a-rover-base-rtk-system). In this tutorial we assume the robot’s GPS produces an accurate and smooth estimation of the robot’s position.

Additionally, to fully describe a robot’s localization we need to know its heading as well, however standalone GPS sensors do not provide orientation measurements, only position measurements. In this tutorial we will refer to ‘absolute heading’ as a yaw measurement which is given w.r.t. a cardinal direction (e.g, the east), in contrast to relative heading, which is given w.r.t. the angle the robot is turned on or any other reference that cannot be directly mapped to a cardinal direction.

When using robot\_localization with GPS, measuring absolute orientation is mandatory. There are several strategies for getting absolute orientation data, like IMUs with magnetometers, dual GPS systems or matching techniques over a known map; in this tutorial we assume the robot is equipped with an IMU that can accurately measure absolute orientation following the ENU convention, meaning it will output zero yaw when facing east and +90 degrees when facing north.

Despite the above assumption, in the real world commercial grade IMU’s mounted in actual robots will often not produce accurate absolute heading measurements because:

1. They may not have a magnetometer.
2. They are hard to calibrate: outdoors robots are often big and heavy: imagine doing an eight figure in the air with an autonomous tractor.
3. Robots can be a huge source of electromagnetic noise for magnetometers: Electric motors are full of permanent magnets and can draw several amps, producing significant disturbances to the sensor.

Thus, for a particular application you should consider the behavior and localization quality you require when making decisions about how to estimate your absolute heading. When using IMU’s without relative headings to a cardinal direction, the robot may need to move around for a bit in an ‘initialization dance’ to converge to the right heading using the filter. Using dual-GPS or 3D mapping system overlay, the initial heading is quite good.

For the purposes of this tutorial, we model a well-built system using an IMU that has absolute orientation already, but that may be augmented or replaced on a practical system using one of the techniques above (or others).

###### Tutorial Steps

###### 0- Setup Gazebo World

To navigate using GPS we first need to create an outdoors Gazebo world with a robot having a GPS sensor to setup for navigation. For this tutorial we will be using the [Sonoma Raceway](https://app.gazebosim.org/OpenRobotics/fuel/models/Sonoma%20Raceway) because its aligned with the real location. A sample [world](https://github.com/ros-navigation/navigation2_tutorials/tree/master/nav2_gps_waypoint_follower_demo/worlds/tb3_sonoma_raceway.sdf.xacro) has been setup using gazebo’s navsat and spherical coordinates plugin, which creates a local tangent plane centered in the set geographic origin and provides latitude, longitude and altitude coordinates for each point in the world:

```
<!-- Navsat plugin >
<plugin
  filename="gz-sim-navsat-system"
  name="gz::sim::systems::NavSat">
</plugin>

...

<spherical_coordinates>
  <surface_model>EARTH_WGS84</surface_model>
  <world_frame_orientation>ENU</world_frame_orientation>
  <latitude_deg>38.161479</latitude_deg>
  <longitude_deg>-122.454630</longitude_deg>
  <elevation>0</elevation>
  <heading_deg>0</heading_deg>
</spherical_coordinates>
```

To get GPS readings from Gazebo, we also need to modify the xacro and urdf for the turtlebot3 robot. The final files can be found in the [nav2\_minimal\_turtlebot\_simulation repo](https://github.com/ros-navigation/nav2_minimal_turtlebot_simulation/blob/main/nav2_minimal_tb3_sim/urdf), it outputs `NavSatFix` messages on the topic `/gps/fix`.

The changes that was done in xacro file `gz_waffle_gps.sdf.xacro` was to include the `gps_link` that includes the navsat sensor. In addition we create a joint for this link that publishes a static transform w.r.t. `base_link`.

```
<link name="gps_link">
  <sensor name="navsat" type="navsat">
    <always_on>true</always_on>
    <update_rate>1</update_rate>
    <topic>$(arg namespace)/gps/fix</topic>
    <gz_frame_id>gps_link</gz_frame_id>
    <navsat>
      <position_sensing>
        <horizontal>
          <noise type="gaussian">
            <mean>0.0</mean>
            <stddev>0.0</stddev>
          </noise>
        </horizontal>
        <vertical>
          <noise type="gaussian">
            <mean>0.0</mean>
            <stddev>0.0</stddev>
          </noise>
        </vertical>
      </position_sensing>
    </navsat>
  </sensor>
</link>
```

Additionally, the joint needs to be defined again in the urdf file `turtlebot3_waffle_gps.urdf`

```
 <joint name="gps_joint" type="fixed">
  <parent link="base_link"/>
  <child link="gps_link"/>
  <origin xyz="-0.05 0 0.05" rpy="0 0 0"/>
</joint>
<link name="gps_link"/>
```

In addition you need to include the gps topic in your gazebo to ros bridge file, an example of this can be found in the `turtlebot3_waffle_gps_bridge.yaml` in the [nav2\_minimal\_turtlebot\_simulation](https://github.com/ros-navigation/nav2_minimal_turtlebot_simulation/blob/main/nav2_minimal_tb3_sim/config/turtlebot3_waffle_gps_bridge.yaml) repository.

```
##### replace navsat_bridge - check gz topic name
- topic_name: "gps/fix"
  ros_type_name: "sensor_msgs/msg/NavSatFix"
  gz_type_name: "gz.msgs.NavSat"
  direction: GZ_TO_ROS
```

Build the `nav2_gps_waypoint_follower_demo` package, source your workspace and test your gazebo world is properly set up by launching:

```
ros2 launch nav2_gps_waypoint_follower_demo gazebo_gps_world.launch.py
```

A Turtlebot waffle should appear in the Sonoma Raceway world. You may also echo the topic `/gps/fix` to verify the robot is indeed producing GPS measurements

[![Turtlebot in the sonoma raceway](../../_images/gazebo_sonoma_raceway.png)](../../_images/gazebo_sonoma_raceway.png)

###### 1- Setup GPS Localization system

Once you have your simulation (or real robot) up and running, it’s time to set up your localization system. Remember that Nav2 uses a `tf` chain with the structure `map` -> `odom` -> `base_link` -> `[sensor frames]`; global localization (`map` -> `odom`) is usually provided by `amcl`, while `odom` -> `base_link` is usually provided by the user’s odometry system (wheel odometry, visual odometry, etc).

In this tutorial, the GPS sensor on the robot will replace `amcl` in providing global localization. Though you may build a custom module that takes in the `NavSatFix` and `Imu` messages of your GPS and imu, and outputs a `tf` between your `map` and `odom` frames using a planar projection, Nav2’s GPS waypoint follower currently uses robot\_localization for converting GPS goals to cartesian goals, and thus at a [navsat\_transform\_node](http://docs.ros.org/en/jade/api/robot_localization/html/navsat_transform_node.html) should be active. Additionally, `robot_localization` features reconfigurable state estimation nodes that use Kalman Filters to fuse multiple sources of data, which is yet another reason to use it.

We will setup one Extended Kalman Filter for local odometry, fusing wheel odometry and IMU data; a second one for global localization, fusing the local cartesian converted GPS coordinates, the wheel odometry and the IMU data; and a navsat\_transform node to output cartesian odometry messages from GPS data. This is a common setup on robot\_localization when using GPS data and more details around its configuration can be found in [RL’s docs](http://docs.ros.org/en/jade/api/robot_localization/html/integrating_gps.html).

A [configuration file](https://github.com/ros-navigation/navigation2_tutorials/tree/master/nav2_gps_waypoint_follower_demo/config/dual_ekf_navsat_params.yaml) and a [launch file](https://github.com/ros-navigation/navigation2_tutorials/tree/master/nav2_gps_waypoint_follower_demo/launch/dual_ekf_navsat.launch.py) are provided for this purpose. You may take a while before continuing to understand these two files and what they configure. Let’s walk through the most relevant setting of each node.

###### Local Odometry

The local odometry is provided by the `ekf_filter_node_odom`, which publishes the transform between `odom` and `base_footprint`, the base frame of the turtlebot’s diff drive plugin in gazebo. The robot state publisher provides a static transform between `base_footprint` and `base_link`, however make sure to set the base frame properly in RL according to your configuration. Note that the EKFs are set to work in 2D mode, this is because nav2’s costmap environment representation is 2-Dimensional, and several layers rely on the `base_link` frame being on the same plane as their global frame for the height related parameters to make sense. This is encoded in the following parameters:

```
ekf_filter_node_odom:
  ros__parameters:
    two_d_mode: true
    publish_tf: true

    base_link_frame: base_footprint
    world_frame: odom
```

Since per [REP 105](https://www.ros.org/reps/rep-0105.html) the position of the robot in the `odom` frame has to be continuous over time, in this filter we just want to fuse the robot’s speed measured by its wheels published `/odom`, and the imu heading published on `/imu`:

```
odom0: odom
odom0_config: [false, false, false,
              false, false, false,
              true,  true,  true,
              false, false, true,
              false, false, false]

imu0: imu/data
imu0_config: [false, false, false,
              false,  false,  true,
              false, false, false,
              false,  false,  false,
              false,  false,  false]
```

###### Global Odometry

The global odometry is provided by the `ekf_filter_node_map`, which publishes the transform between `map` and `base_footprint`. This EKF is set to work in 2D mode as well. In addition to the IMU and wheel odometry data, this filter takes in the odometry output of the gps, published by the `navsat_transform` node on `/odometry/gps` as an odometry message:

```
ekf_filter_node_map:
  ros__parameters:
    two_d_mode: true
    publish_tf: true

    base_link_frame: base_footprint
    world_frame: map

    odom1: odometry/gps
    odom1_config: [true,  true,  false,
                  false, false, false,
                  false, false, false,
                  false, false, false,
                  false, false, false]
```

###### Navsat Transform

The navsat transform produces an odometry output with the position of the GPS in the `map` frame, which is ingested by the global EKF as said above. It exposes the `datum` parameter to set the GPS coordinates and heading of the origin of `map`; if left undeclared it will be set automatically to the coordinates of the first valid `NavSatFix` message it gets, and it may be changed in runtime as well calling the `/datum` service.

In this tutorial we will go with the automatic `datum` initialization because there is no information about the environment stored in cartesian coordinates (a static map, semantic navigation waypoints, a 3D pointcloud map, etc), however if that’s the case in your application you may fix the `datum` so a given pair of coordinates produced by the GPS always correspond to the same cartesian coordinates in your reference system.

The node also exposes the `yaw_offset` parameter to compensate for known errors that the IMU absolute yaw measurement may have with respect to the east. Since Gazebo’s IMU follows the ENU convention this is set to `0` in the tutorial, but you may want to change it if you know beforehand there’s a fixed offset in your data.

Here’s the full configuration for the `navsat_transform` node:

```
navsat_transform:
  ros__parameters:
    frequency: 30.0
    delay: 3.0
    magnetic_declination_radians: 0.0
    yaw_offset: 0.0
    zero_altitude: true
    broadcast_cartesian_transform: true
    publish_filtered_gps: true
    use_odometry_yaw: true
    wait_for_datum: false
    # datum: [38.161491, -122.4546443, 0.0] # pre-set datum if needed, [lat, lon, yaw]
```

###### Localization Testing

As a sanity check that everything is working correctly, launch RL’s launch file while Gazebo is still running:

```
ros2 launch nav2_gps_waypoint_follower_demo dual_ekf_navsat.launch.py
```

On a different terminal launch mapviz using the pre-built [config file](https://github.com/ros-navigation/navigation2_tutorials/tree/master/nav2_gps_waypoint_follower_demo/config/gps_wpf_demo.mvc) in the repo. There are multiple options to visualize satalite map on with mapviz:

* Stadiamaps: This would require an api key, see [Get a stadiamap Api key](https://docs.stadiamaps.com/static-maps/) . Modify the config file as follows:

```
- type: mapviz_plugins/tile_map
  name: new display
  config:
    visible: true
    collapsed: false
    custom_sources:
      - base_url: https://tiles.stadiamaps.com/tiles/alidade_satellite/{level}/{x}/{y}.png?api_key=api_key
        max_zoom: 15
        name: Stadia
        type: wmts
    bing_api_key: ""
    source: Stadia (alidade_satellite)
```

* For those interested in locally hosted map see [Local tile\_map imagery](https://swri-robotics.github.io/mapviz/guides/local_tile_map_imagery/)

```
ros2 launch nav2_gps_waypoint_follower_demo mapviz.launch.py
```

You should see the window below after properly setting the API key:

[![Turtlebot in the sonoma raceway](../../_images/mapviz_init.png)](../../_images/mapviz_init.png)

Finally run the teleop twist keyboard node to teleoperate the simulated Turtlebot:

```
ros2 run teleop_twist_keyboard teleop_twist_keyboard --ros-args --param stamped:=True
```

When you have everything up and running, start teleoperating the Turtlebot and check that:

1. When the robot faces east (default initial heading) and you move it forward, the `base_link` frame (green arrow) moves east consistently with the raw GPS measurements (blue dot).
2. Movement is consistent overall not only when facing east, meaning that the GPS measurements are consistent with the robot heading and movement direction, and that they are consistent with the position of the robot in the world (for instance, when the robot moves towards the finish line, GPS measurements in mapviz do as well).

The gif below shows what you should see:

[![../../_images/localization_check.gif](../../_images/localization_check.gif)](../../_images/localization_check.gif)

Sensors in a real robot may be less accurate than Gazebo’s, especially GPSs and absolute heading measurements from IMUs. To mitigate this you can leverage robot\_localization’s EKFs to complement sensor’s capabilities:

1. If your IMU does not provide absolute yaw measurements accurately, consider setting the `differential` parameter of its input to RL to `true`. This way the filter will only fuse changes in the orientation and derive the absolute value from its motion model internally, differentiating changes in the position to estimate where the robot was heading (e.g. If the robot had a speed of 1m/s forward according to the wheel odometry and moved 1 meter north according to the GPS, that means it should be facing north). Note that if that’s the case, you won’t have an accurate absolute heading until your robot moves around a bit and the filter can estimate it from that movement; if this is not possible in your application consider adding another sensor that can measure absolute heading accurately, like a dual GPS system.
2. If your GPS is noisy but you have another trustworthy odometry source (ex: wheel odometry, visual odometry), consider tuning the sensors and process noise covariances to make the filter “trust” more or less one data source or its own internal state estimate. A properly tuned filter should be able to reject wrong GPS measurements to some degree.

###### 2- Setup Navigation system

Once you have your localization system up and running it’s time to set up Nav2. Since RL is already providing the `tf` tree we don’t need to launch `amcl`, thus we can remove its parameters from the params file and not launch Nav2’s localization launch file.

There are three main possible setups for the global costmap:

1. **Rolling** (Used in the tutorial): Outdoors environments can get quite big, to a degree that it may not be practical to represent them on a single costmap. For that reason in this tutorial we use a rolling global costmap that is big enough for fitting successive pairs of waypoints. In this case you may or may not choose to use a static layer, however if you do make sure to fix the `datum` of the navsat\_transform so GPS coordinates always have the same cartesian representation on your map.

```
global_costmap:
  global_costmap:
    ros__parameters:
      ...
      rolling_window: True
      width: 50
      height: 50
```

2. **Size and position from static map**: You may also choose to keep Nav2 default setup and have the global costmap be sized and positioned according to a pre-built map by adding a static layer and using `map_server`. In this case you also need to make sure there’s consistency in your `datum` and the origin of the map.

```
global_costmap:
  global_costmap:
    ros__parameters:
      ...
      plugins: ["static_layer", "obstacle_layer", "inflation_layer"]
```

3. **Static position and size**: Finally, depending on your application you may still choose to use a fixed global costmap if you have a restricted operating environment you know beforehand, just remember to make it fit all the potential locations the robot may visit. In this case you need to set the size and origin position in the parameters:

```
global_costmap:
  global_costmap:
    ros__parameters:
      ...
      width: 50
      height: 50
      origin_x: 25.0
      origin_y: 25.0
```

We provide a [Nav2 params file](https://github.com/ros-navigation/navigation2_tutorials/tree/master/nav2_gps_waypoint_follower_demo/config/nav2_no_map_params.yaml) with the rolling costmap setup and a [launch](https://github.com/ros-navigation/navigation2_tutorials/tree/master/nav2_gps_waypoint_follower_demo/gps_waypoint_follower.launch.py) file to put it all together. Remember that the GPS setup of robot\_localization was just a means for setting up the global localization system, however Nav2 is still a cartesian navigation stack and you may still use all its cartesian tools. To confirm that everything is working, launch the provided file (this launches gazebo and RL as well so close them if you have them running from the previous steps) and use rviz to send a goal to the robot:

```
ros2 launch nav2_gps_waypoint_follower_demo gps_waypoint_follower.launch.py use_rviz:=True
```

The gif below shows what you should see Nav2 navigating the robot autonomously!

[![../../_images/navigation_check.gif](../../_images/navigation_check.gif)](../../_images/navigation_check.gif)

###### 3- Interactive GPS Waypoint Follower

Now that we have performed our complete system setup, let’s leverage Nav2 GPS waypoint follower capabilities to navigate to goals that are expressed directly in GPS coordinates. For this demo we want to build an interactive interface similar to rviz’s, that allows us to click over a map to make the robot navigate to the clicked location. For that we will use mapviz’s point click publisher on the `wgs84` reference frame, which will publish a `PointStamped` message with the GPS coordinates of the point clicked over the satellite image. This is a great way to get started in your custom GPS navigation setup!

For this purpose we provide the [interactive\_waypoint\_follower](https://github.com/ros-navigation/navigation2_tutorials/tree/master/nav2_gps_waypoint_follower_demo/nav2_gps_waypoint_follower_demo/interactive_waypoint_follower.py) python node, which subscribes to mapviz’s topic and calls the `/follow_gps_waypoints` action server with the clicked point as goal using the `BasicNavigator` in `nav2_simple_commander`. To run it source your workspace and with the rest of the system running type:

```
ros2 run nav2_gps_waypoint_follower_demo interactive_waypoint_follower
```

You can now click on the mapviz map the pose you want the robot to go. The gif below shows the robot navigating to the finish line going through some obstacles:

[![../../_images/interactive_wpf.gif](../../_images/interactive_wpf.gif)](../../_images/interactive_wpf.gif)

###### 4- Logged GPS Waypoint Follower & Waypoint Logging

Finally let’s make a robot go through a set of predefined GPS waypoints. We provide a [waypoint logging tool](https://github.com/ros-navigation/navigation2_tutorials/tree/master/nav2_gps_waypoint_follower_demo/nav2_gps_waypoint_follower_demo/gps_waypoint_logger.py) that subscribes to the robot’s GPS and IMU and offers a simple GUI to save the robot coordinates and heading on demand to a `yaml` file with the format:

```
waypoints:
- latitude: 38.161491054181276
  longitude: -122.45464431092836
  yaw: 0.0
- latitude: 38.161587576524845
  longitude: -122.4547994038464
  yaw: 1.57
```

Let’s log some waypoints for the robot to follow. Source your workspace and with the rest of the system running type:

```
ros2 run nav2_gps_waypoint_follower_demo gps_waypoint_logger </path/to/yaml/file.yaml>
```

If you don’t provide a path to save your waypoints, they will be saved in your `home` folder by default with the name `gps_waypoints.yaml`. Once the node launches you should see a small GUI with a button to log waypoints, you may now move the robot around and click that button to record its position as the gif below shows:

[![../../_images/waypoint_logging.gif](../../_images/waypoint_logging.gif)](../../_images/waypoint_logging.gif)

After that you should get a `yaml` file in the location you specified with the format shown above; let’s now make the robot follow the logged waypoints. For this purpose we provide the [logged\_waypoint\_follower](https://github.com/ros-navigation/navigation2_tutorials/tree/master/nav2_gps_waypoint_follower_demo/nav2_gps_waypoint_follower_demo/logged_waypoint_follower.py) node, which takes in the path to the waypoints file as an argument and uses the `BasicNavigator` in `nav2_simple_commander` to send the logged goals to the `/follow_gps_waypoints` action server. If not provided, the node uses the [default waypoints](https://github.com/ros-navigation/navigation2_tutorials/tree/master/nav2_gps_waypoint_follower_demo/config/demo_waypoints.yaml) in the `nav2_gps_waypoint_follower_demo` package.

To run this node source your workspace and with the rest of the system running type:

```
ros2 run nav2_gps_waypoint_follower_demo logged_waypoint_follower </path/to/yaml/file.yaml>
```

You should now see the robot following the waypoints you previously logged:

[![../../_images/logged_waypoint_follower.gif](../../_images/logged_waypoint_follower.gif)](../../_images/logged_waypoint_follower.gif)

###### Conclusion

This tutorial discussed the usage of a GPS sensor for global localization using RL and the `navsat_transform` node, covering the setup of a gazebo simulation with a GPS equipped robot as well. It also went through the configuration changes in Nav2 for navigating with GPS localization, emphasizing on some different possibilities for setting up the global costmap. Finally it showcased the capabilities of Nav2’s GPS waypoint follower as a demonstration on how to use the stack in outdoors environments.

The tutorial should be a good starting point for setting up autonomous navigation using Nav2 on an outdoors robot, however users should keep in mind that GPS is just a means for providing global localization to the stack, and that all cartesian tools in Nav2 are still available for going past the GPS waypoint follower and building custom autonomy applications according to each use case.

Happy outdoors navigating!

---

#### Navigating while Mapping (SLAM)

*Source: [https://docs.nav2.org/tutorials/docs/navigation2_with_slam.html](https://docs.nav2.org/tutorials/docs/navigation2_with_slam.html)*

##### Navigating while Mapping (SLAM)

* [Overview](#overview)
* [Requirements](#requirements)
* [Tutorial Steps](#tutorial-steps)

###### Overview

This document explains how to use Nav2 with SLAM.
The following steps show ROS 2 users how to generate occupancy grid maps and use Nav2 to move their robot around.
This tutorial applies to both simulated and physical robots, but will be completed here on a physical robot.

Before completing this tutorial, completing the [Getting Started](../../getting_started/index.html#getting-started) is highly recommended especially if you are new to ROS and Navigation2.

In this tutorial we’ll be using SLAM Toolbox. More information can be found in the [ROSCon talk for SLAM Toolbox](https://vimeo.com/378682207)

###### Requirements

You must install Navigation2, Turtlebot3, and SLAM Toolbox.
If you don’t have them installed, please follow [Getting Started](../../getting_started/index.html#getting-started).

SLAM Toolbox can be installed via:

> `sudo apt install ros-<ros2-distro>-slam-toolbox`

or from built from source in your workspace with:

> `git clone -b <ros2-distro>-devel git@github.com:stevemacenski/slam_toolbox.git`

###### Tutorial Steps

###### 0- Launch Robot Interfaces

For this tutorial, we will use the turtlebot3.
The turtlebot3 software can be installed via the following or on the [turtlebot3 repository](https://github.com/ROBOTIS-GIT/turtlebot3):

```
sudo apt install ros-<ros2-distro>-turtlebot3 ros-<ros2-distro>-turtlebot3-msgs ros-<ros2-distro>-turtlebot3-bringup
```

If you have another robot, replace with your robot specific interfaces.
Typically, this includes the robot state publisher of the URDF, simulated or physical robot interfaces, controllers, safety nodes, and the like.

Run the following commands first whenever you open a new terminal during this tutorial.

* `source /opt/ros/<ros2-distro>/setup.bash`
* `export TURTLEBOT3_MODEL=waffle`

Launch your robot’s interface and robot state publisher, for example:

> `ros2 launch turtlebot3_bringup robot.launch.py`

###### 1- Launch Navigation2

Launch Navigation without nav2\_amcl and nav2\_map\_server.
It is assumed that the SLAM node(s) will publish to /map topic and provide the map->odom transform.

> `ros2 launch nav2_bringup navigation_launch.py`

###### 2- Launch SLAM

Bring up your choice of SLAM implementation.
Make sure it provides the map->odom transform and /map topic.
Run Rviz and add the topics you want to visualize such as /map, /tf, /laserscan etc.
For this tutorial, we will use [SLAM Toolbox](https://github.com/SteveMacenski/slam_toolbox).

> `ros2 launch slam_toolbox online_async_launch.py`

###### 3- Working with SLAM

Move your robot by requesting a goal through RViz or the ROS 2 CLI, ie:

```
ros2 topic pub /goal_pose geometry_msgs/PoseStamped "{header: {stamp: {sec: 0}, frame_id: 'map'}, pose: {position: {x: 0.2, y: 0.0, z: 0.0}, orientation: {w: 1.0}}}"
```

You should see the map update live! To save this map to file:

> `ros2 run nav2_map_server map_saver_cli -f ~/map`

[![Navigation2 with SLAM](../../_images/navigation2_with_slam.gif)](../../_images/navigation2_with_slam.gif)

###### 4- Getting Started Simplification

If you’re only interested in running SLAM in the turtlebot3 getting started sandbox world, we also provide a simple way to enable SLAM as a launch configuration.
Rather than individually launching the interfaces, navigation, and SLAM, you can continue to use the `tb3_simulation_launch.py` with `slam` config set to true.
We provide the instructions above with the assumption that you’d like to run SLAM on your own robot which would have separated simulation / robot interfaces and navigation launch files that are combined in `tb3_simulation_launch.py` for the purposes of easy testing.

```
ros2 launch nav2_bringup tb3_simulation_launch.py slam:=True
```

---

#### Navigating with a Physical Turtlebot 3

*Source: [https://docs.nav2.org/tutorials/docs/navigation2_on_real_turtlebot3.html](https://docs.nav2.org/tutorials/docs/navigation2_on_real_turtlebot3.html)*

##### Navigating with a Physical Turtlebot 3

* [Overview](#overview)
* [Requirements](#requirements)
* [Tutorial Steps](#tutorial-steps)


###### Overview

This tutorial shows how to control and navigate Turtlebot 3 using the ROS 2 Nav2 on a physical Turtlebot 3 robot.
Before completing this tutorials, completing [Getting Started](../../getting_started/index.html#getting-started) is highly recommended especially if you are new to ROS and Nav2.

This tutorial may take about 1 hour to complete.
It depends on your experience with ROS, robots, and what computer system you have.

###### Requirements

You must install Nav2, Turtlebot3.
If you don’t have them installed, please follow [Getting Started](../../getting_started/index.html#getting-started).

The turtlebot3 software can be installed via the following or on the [turtlebot3 repository](https://github.com/ROBOTIS-GIT/turtlebot3):

```
sudo apt install ros-<ros2-distro>-turtlebot3 ros-<ros2-distro>-turtlebot3-msgs ros-<ros2-distro>-turtlebot3-bringup
```

###### Tutorial Steps

###### 0- Setup Your Environment Variables

Run the following commands first whenever you open a new terminal during this tutorial.

* `source /opt/ros/<ros2-distro>/setup.bash`
* `export TURTLEBOT3_MODEL=waffle`

###### 1- Launch Turtlebot 3

You will need to launch your robot’s interface, for example:

> `ros2 launch turtlebot3_bringup robot.launch.py  use_sim_time:=False`

###### 2- Launch Nav2

You need to have a map of the environment where you want to Navigate Turtlebot 3, or create one live with SLAM.

In case you are interested, there is a use case tutorial which shows how to use Nav2 with SLAM.
[Navigating while Mapping (SLAM)](navigation2_with_slam.html#navigation2-with-slam).

Required files:

> * `your-map.map`
> * `your-map.yaml`

`<your_map>.yaml` is the configuration file for the map we want to provide Nav2.
In this case, it has the map resolution value, threshold values for obstacles and free spaces, and a map file location.
You need to make sure these values are correct.
More information about the map.yaml can be found [here](http://wiki.ros.org/map_server).

Launch Nav2. If you set autostart:=False, you need to click on the start button in RViz to initialize the nodes.
Make sure use\_sim time is set to **False**, because we want to use the system time instead of the time simulation time from Gazebo.

`ros2 launch nav2_bringup bringup_launch.py use_sim_time:=False autostart:=False map:=/path/to/your-map.yaml`

Note: Don’t forget to change **/path/to/your-map.yaml** to the actual path to the your-map.yaml file.

###### 3- Launch RVIZ

Launch RVIZ with a pre-defined configuration file.

> `ros2 run rviz2 rviz2 -d $(ros2 pkg prefix nav2_bringup)/share/nav2_bringup/rviz/nav2_default_view.rviz`

Now, you should see a shadow of Turtlebot 3 robot model in the center of the plot in Rviz.
Click on the Start button (Bottom Left) if you set the auto\_start parameter to false.
Then, the map should appear in RViz.

[![../../_images/rviz_after_launch_view.png](../../_images/rviz_after_launch_view.png)](../../_images/rviz_after_launch_view.png)
[![../../_images/rviz_slam_map_view.png](../../_images/rviz_slam_map_view.png)](../../_images/rviz_slam_map_view.png)

###### 4- Initialize the Location of Turtlebot 3

First, find where the robot is on the map. Check where your robot is in the room.

Set the pose of the robot in RViz.
Click on the 2D Pose Estimate button and point the location of the robot on the map.
The direction of the green arrow is the orientation of Turtlebot.

[![Set initial pose in RViz](../../_images/rviz_set_initial_pose.png)](../../_images/rviz_set_initial_pose.png)

Now, the 3D model of Turtlebot should move to that location.
A small error in the estimated location is tolerable.

###### 5- Send a Goal Pose

Pick a target location for Turtlebot on the map.
You can send Turtlebot 3 a goal position and a goal orientation by using the **Nav2 Goal** or the **GoalTool** buttons.

Note: Nav2 Goal button uses a ROS 2 Action to send the goal and the GoalTool publishes the goal to a topic.

[![Send goal pose in RViz](../../_images/rviz_send_goal.png)](../../_images/rviz_send_goal.png)

Once you define the target pose, Nav2 will find a global path and start navigating the robot on the map.

[![Robot navigating in RViz](../../_images/rviz_robot_navigating.png)](../../_images/rviz_robot_navigating.png)

Now, you can see that Turtlebot 3 moves towards the goal position in the room. See the video below.

---

#### Navigating with Keepout Zones

*Source: [https://docs.nav2.org/tutorials/docs/navigation2_with_keepout_filter.html](https://docs.nav2.org/tutorials/docs/navigation2_with_keepout_filter.html)*

##### Navigating with Keepout Zones

* [Overview](#overview)
* [Requirements](#requirements)
* [Tutorial Steps](#tutorial-steps)


###### Overview

This tutorial shows how to simply utilize keep-out/safety zones where robots can’t enter and preferred lanes for robots moving in industrial environments and warehouses. All this functionality is being covered by `KeepoutFilter` costmap filter plugin which will be enabled and used in this document.

###### Requirements

It is assumed that ROS 2, Gazebo and TurtleBot4 packages are installed or built locally. Please make sure that Nav2 project is also built locally as it was made in [Build and Install](../../development_guides/build_docs/index.html#build-instructions).

###### Tutorial Steps

###### 1. Prepare filter mask

As was written in [Navigation Concepts](../../concepts/index.html#concepts), any Costmap Filter (including Keepout Filter) are reading the data marked in a filter mask file. Filter mask - is the usual Nav2 2D-map distributed through PGM, PNG or BMP raster file with its metadata containing in a YAML file. The following steps help to understand how to make a new filter mask:

Create a new image with a PGM/PNG/BMP format: copy [depot.pgm](https://github.com/ros-navigation/navigation2/blob/main/nav2_bringup/maps/depot.pgm) main map which will be used in a world simulation from a `Nav2` repository to a new `depot_keepout.pgm` file.

Open `depot_keepout.pgm` in your favourite raster graphics editor (as an example could be taken GIMP editor). The lightness of each pixel on the mask means an encoded information for the specific costmap filter you are going to use. Color lightness of each pixel belongs to the `[0..255]` range (or `[0..100]` in percent scale), where `0` means black color and `255` - white. Another term “darkness” will be understood as the exact opposite of lightness. In other words `color_darkness = 100% - color_lightness`.

In the GIMP lightness is expressed through color components value (e.g. `R` in percent scale) and might be set by moving `L` slider in color changing tool:

![../../_images/ligtness_in_GIMP.png](../../_images/ligtness_in_GIMP.png)

The incoming mask file is being read by the Map Server and converted into `OccupancyGrid` values from `[0..100]` range (where `0` means free cell, `100` - occupied, anything in between - less or more occupied cells on map) or be equal to `-1` for unknown value. In Nav2 stack each map has `mode` attribute which could be `trinary`, `scale` or `raw`. Depending on `mode` selected, the color lightness of PGM/PNG/BMP is being converted to `OccupancyGrid` by one of the following principles:

* `trinary` (default mode): Darkness >= `occupied_thresh` means that map occupied (`100`). Darkness <= `free_thresh` - map free (`0`). Anything in between - unknown status on map (`-1`).
* `scale`: Alpha < `1.0` - unknown. Darkness >= `occupied_thresh` means that map occupied (`100`). Darkness <= `free_thresh` - map free (`0`). Anything in between - linearly interpolate to nearest integer from `[0..100]` range.
* `raw`: Lightness = `0` (dark color) means that map is free (`0`). Lightness = `100` (in absolute value) - map is occupied (`100`). Anything in between - `OccupancyGrid` value = lightness. Lightness >= `101` - unknown (`-1`).

where `free_thresh` and `occupied_thresh` thresholds are expressed in percentage of maximum lightness/darkness level (`255`). Map mode and thresholds are placed in YAML metadata file (see below) as `mode`, `free_thresh` and `occupied_thresh` fields.

Note

There is another parameter in a YAML metadata file called `negate`. By default it is set to `false`. When it is set to `true`, blacker pixels will be considered as free, whiter pixels - as occupied. In this case we should count color lightness instead of darkness for `trinary` and `scale` modes. `negate` has no effect on `raw` mode.

For Keepout Filter `OccupancyGrid` value is proportional to the passibility of area corresponding to this cell: higher values means more impassable areas. Cells with occupied values covers keep-out zones where robot will never enter or pass through. `KeepoutFilter` can also act as a “weighted areas layer” by setting the `OccupancyGrid` to something between `[1-99]` non-occupied values. Robot is allowed to move in these areas, however its presence there would be “undesirable” there (the higher the value, the sooner planners will try to get the robot out of this area).

Keepout Filter also covers preferred lanes case, where robots should moving only on pre-defined lanes and permitted areas e.g. in warehouses. To use this feature you need to prepare the mask image where the lanes and permitted areas will be marked with free values while all other areas will be occupied. TIP for drawing the mask in a `trinary` or `scale` mode: typically, amount of pixels belonging to lanes are much less than pixels covering other areas. In this case initially all lanes data might be drawn with a black pencil over white background and then (just before saving a PGM) “color inversion” tool in a image raster editor might be used.

For simplicity, in the example fill the areas with black color (in `trinary` mode this means occupied map) that you are going to mark as a keep-out zones:

[![../../_images/drawing_keepout_mask.png](../../_images/drawing_keepout_mask.png)](../../_images/drawing_keepout_mask.png)

After all keepout areas will be filled, save the `depot_keepout.pgm` image.

Like all other maps, filter mask should have its own YAML metadata file. Copy [depot.yaml](https://github.com/ros-navigation/navigation2/blob/main/nav2_bringup/maps/depot.yaml) to `depot_keepout.yaml`. Open `depot_keepout.yaml` and correct `image` field to a newly made PGM mask:

```
image: depot.pgm
->
image: depot_keepout.pgm
```

Since filter mask image was created as a copy of main map, other fields of YAML-file do not need to be changed. Save `depot_keepout.yaml` and new filter mask is ready to use.

Note

World map itself and filter mask could have different sizes, origin and resolution which might be useful e.g. for cases when filter mask is covering smaller areas on maps or when one filter mask is used repeatedly many times (like annotating a keepout zone for same shape rooms in the hotel). For this case, you need to correct `resolution` and `origin` fields in YAML as well so that the filter mask is correctly laid on top of the original map.

Note

Another important note is that since Costmap2D does not support orientation, the last third “yaw” component of the `origin` vector should be equal to zero. For example: `origin: [1.25, -5.18, 0.0]`.

###### 2. Configure Costmap Filter Info Publisher Server

Each costmap filter reads incoming meta-information (such as filter type or data conversion coefficients) in a messages of `nav2_msgs/CostmapFilterInfo` type. These messages are being published by [Costmap Filter Info Publisher Server](https://github.com/ros-navigation/navigation2/tree/main/nav2_map_server/src/costmap_filter_info). The server is running as a lifecycle node. According to the [design document](https://github.com/ros-navigation/navigation2/blob/main/doc/design/CostmapFilters_design.pdf), `nav2_msgs/CostmapFilterInfo` messages are going in a pair with `OccupancyGrid` filter mask topic. Therefore, along with Costmap Filter Info Publisher Server there should be enabled a new instance of Map Server configured to publish filter mask.

In order to enable Keepout Filter in your configuration, both servers should be enabled as a lifecycle nodes in Python launch-file. It is also possible to add them as Composition Nodes to your Navigation Component Container, which might look as follows:

```
import os

from ament_index_python.packages import get_package_share_directory
from launch import LaunchDescription
from launch.actions import DeclareLaunchArgument, GroupAction, SetEnvironmentVariable
from launch.conditions import IfCondition
from launch.substitutions import LaunchConfiguration, PythonExpression
from launch_ros.actions import LoadComposableNodes, Node, PushROSNamespace, SetParameter
from launch_ros.descriptions import ComposableNode, ParameterFile
from nav2_common.launch import LaunchConfigAsBool, RewrittenYaml


def generate_launch_description() -> LaunchDescription:
    # Get the launch directory
    bringup_dir = get_package_share_directory('nav2_bringup')

    namespace = LaunchConfiguration('namespace')
    keepout_mask_yaml_file = LaunchConfiguration('keepout_mask')
    use_sim_time = LaunchConfigAsBool('use_sim_time')
    autostart = LaunchConfigAsBool('autostart')
    params_file = LaunchConfiguration('params_file')
    use_composition = LaunchConfigAsBool('use_composition')
    container_name = LaunchConfiguration('container_name')
    container_name_full = (namespace, '/', container_name)
    use_respawn = LaunchConfigAsBool('use_respawn')
    use_keepout_zones = LaunchConfigAsBool('use_keepout_zones')
    log_level = LaunchConfiguration('log_level')

    lifecycle_nodes = ['keepout_filter_mask_server', 'keepout_costmap_filter_info_server']

    # Map fully qualified names to relative ones so the node's namespace can be prepended.
    remappings = [('/tf', 'tf'), ('/tf_static', 'tf_static')]

    yaml_substitutions = {
        'KEEPOUT_ZONE_ENABLED': use_keepout_zones,
    }

    configured_params = ParameterFile(
        RewrittenYaml(
            source_file=params_file,
            root_key=namespace,
            param_rewrites={},
            value_rewrites=yaml_substitutions,
            convert_types=True,
        ),
        allow_substs=True,
    )

    stdout_linebuf_envvar = SetEnvironmentVariable(
        'RCUTILS_LOGGING_BUFFERED_STREAM', '1'
    )

    declare_namespace_cmd = DeclareLaunchArgument(
        'namespace', default_value='', description='Top-level namespace'
    )

    declare_keepout_mask_yaml_cmd = DeclareLaunchArgument(
        'keepout_mask',
        default_value='',
        description='Full path to keepout mask yaml file to load',
    )

    declare_use_sim_time_cmd = DeclareLaunchArgument(
        'use_sim_time',
        default_value='false',
        description='Use simulation (Gazebo) clock if true',
    )

    declare_params_file_cmd = DeclareLaunchArgument(
        'params_file',
        default_value=os.path.join(bringup_dir, 'params', 'nav2_params.yaml'),
        description='Full path to the ROS2 parameters file to use for all launched nodes',
    )

    declare_use_composition_cmd = DeclareLaunchArgument(
        'use_composition',
        default_value='False',
        description='Use composed bringup if True',
    )

    declare_container_name_cmd = DeclareLaunchArgument(
        'container_name',
        default_value='nav2_container',
        description='the name of container that nodes will load in if use composition',
    )

    declare_use_respawn_cmd = DeclareLaunchArgument(
        'use_respawn',
        default_value='False',
        description='Whether to respawn if a node crashes. Applied when composition is disabled.',
    )

    declare_use_keepout_zones_cmd = DeclareLaunchArgument(
        'use_keepout_zones', default_value='True',
        description='Whether to enable keepout zones or not'
    )

    declare_log_level_cmd = DeclareLaunchArgument(
        'log_level', default_value='info', description='log level'
    )

    load_nodes = GroupAction(
        condition=IfCondition(PythonExpression(['not ', use_composition])),
        actions=[
            PushROSNamespace(namespace),
            SetParameter('use_sim_time', use_sim_time),
            Node(
                condition=IfCondition(use_keepout_zones),
                package='nav2_map_server',
                executable='map_server',
                name='keepout_filter_mask_server',
                output='screen',
                respawn=use_respawn,
                respawn_delay=2.0,
                parameters=[configured_params, {'yaml_filename': keepout_mask_yaml_file}],
                arguments=['--ros-args', '--log-level', log_level],
                remappings=remappings,
            ),
            Node(
                condition=IfCondition(use_keepout_zones),
                package='nav2_map_server',
                executable='costmap_filter_info_server',
                name='keepout_costmap_filter_info_server',
                output='screen',
                respawn=use_respawn,
                respawn_delay=2.0,
                parameters=[configured_params],
                arguments=['--ros-args', '--log-level', log_level],
                remappings=remappings,
            ),
            Node(
                package='nav2_lifecycle_manager',
                executable='lifecycle_manager',
                name='lifecycle_manager_keepout_zone',
                output='screen',
                arguments=['--ros-args', '--log-level', log_level],
                parameters=[{'autostart': autostart}, {'node_names': lifecycle_nodes}],
            ),
        ],
    )
    # LoadComposableNode for map server twice depending if we should use the
    # value of map from a CLI or launch default or user defined value in the
    # yaml configuration file. They are separated since the conditions
    # currently only work on the LoadComposableNodes commands and not on the
    # ComposableNode node function itself
    load_composable_nodes = GroupAction(
        condition=IfCondition(use_composition),
        actions=[
            PushROSNamespace(namespace),
            SetParameter('use_sim_time', use_sim_time),
            LoadComposableNodes(
                target_container=container_name_full,
                condition=IfCondition(use_keepout_zones),
                composable_node_descriptions=[
                    ComposableNode(
                        package='nav2_map_server',
                        plugin='nav2_map_server::MapServer',
                        name='keepout_filter_mask_server',
                        parameters=[
                            configured_params,
                            {'yaml_filename': keepout_mask_yaml_file}
                        ],
                        remappings=remappings,
                    ),
                    ComposableNode(
                        package='nav2_map_server',
                        plugin='nav2_map_server::CostmapFilterInfoServer',
                        name='keepout_costmap_filter_info_server',
                        parameters=[configured_params],
                        remappings=remappings,
                    ),
                ],
            ),

            LoadComposableNodes(
                target_container=container_name_full,
                composable_node_descriptions=[
                    ComposableNode(
                        package='nav2_lifecycle_manager',
                        plugin='nav2_lifecycle_manager::LifecycleManager',
                        name='lifecycle_manager_keepout_zone',
                        parameters=[
                            {'autostart': autostart, 'node_names': lifecycle_nodes}
                        ],
                    ),
                ],
            ),
        ],
    )

    # Create the launch description and populate
    ld = LaunchDescription()

    # Set environment variables
    ld.add_action(stdout_linebuf_envvar)

    # Declare the launch options
    ld.add_action(declare_namespace_cmd)
    ld.add_action(declare_keepout_mask_yaml_cmd)
    ld.add_action(declare_use_sim_time_cmd)
    ld.add_action(declare_params_file_cmd)
    ld.add_action(declare_use_composition_cmd)
    ld.add_action(declare_container_name_cmd)
    ld.add_action(declare_use_respawn_cmd)
    ld.add_action(declare_use_keepout_zones_cmd)
    ld.add_action(declare_log_level_cmd)

    # Add the actions to launch all of the map modifier nodes
    ld.add_action(load_nodes)
    ld.add_action(load_composable_nodes)

    return ld
```

where the `params_file` variable should be set to a YAML-file having ROS parameters for Costmap Filter Info Publisher Server and Map Server nodes. These parameters and their meaning are listed at [Map Server](../../configuration/packages/configuring-map-server.html#configuring-map-server) page. Please, refer to it for more information. The example of `params_file` could be found below:

```
keepout_filter_mask_server:
  ros__parameters:
    topic_name: "keepout_filter_mask"
    # yaml_filename: ""

keepout_costmap_filter_info_server:
  ros__parameters:
    type: 0
    filter_info_topic: "keepout_costmap_filter_info"
    mask_topic: "keepout_filter_mask"
    base: 0.0
    multiplier: 1.0
```

Note, that:

> * For Keepout Filter the `type` of costmap filter should be set to `0`.
> * Filter mask topic name should be the equal for `mask_topic` parameter of Costmap Filter Info Publisher Server and `topic_name` parameter of Map Server.
> * According to the Costmap Filters design, `OccupancyGrid` values are being linearly transformed into feature map in a filter space. For a Keepout Filter these values are directly passed as a filter space values without a linear conversion. Even though `base` and `multiplier` coefficients are not used in Keepout Filter, they should be set to `0.0` and `1.0` accordingly in order to explicitly show that we have one-to-one conversion from `OccupancyGrid` values -> to a filter value space.

###### 3. Enable Keepout Filter

Costmap Filters are Costamp2D plugins. You can enable the `KeepoutFilter` plugin in Costmap2D by adding `keepout_filter` to the `plugins` parameter in `nav2_params.yaml`. You can place it in the `global_costmap` for planning with keepouts and `local_costmap` to make sure the robot won’t attempt to drive through a keepout zone. The KeepoutFilter plugin should have the following parameters defined:

* `plugin`: type of plugin. In our case `nav2_costmap_2d::KeepoutFilter`.
* `filter_info_topic`: filter info topic name. This need to be equal to `filter_info_topic` parameter of Costmap Filter Info Publisher Server from the chapter above.

Full list of parameters supported by `KeepoutFilter` are listed at [Keepout Filter Parameters](../../configuration/packages/costmap-plugins/keepout_filter.html#keepout-filter) page.

It is important to note that enabling `KeepoutFilter` for `global_costmap` only will cause the path planner to build plans bypassing keepout zones. Enabling `KeepoutFilter` for `local_costmap` only will cause the robot to not enter keepout zones, but the path may still go through them. So, the best practice is to enable `KeepoutFilter` for global and local costmaps simultaneously by adding it both in `global_costmap` and `local_costmap` in `nav2_params.yaml`. However it does not always have to be true. In some cases keepout zones don’t have to be the same for global and local costmaps, e.g. if the robot doesn’t allowed to intentionally go inside keepout zones, but if its there, the robot can drive in and out really quick if it clips an edge or corner. For this case, there is not need to use extra resources of the local costmap copy.

To enable `KeepoutFilter` with same mask for both global and local costmaps, use the following configuration:

```
global_costmap:
  global_costmap:
    ros__parameters:
      ...
      plugins: ["static_layer", "obstacle_layer", "inflation_layer"]
      filters: ["keepout_filter"]
      ...
      keepout_filter:
        plugin: "nav2_costmap_2d::KeepoutFilter"
        enabled: True
        filter_info_topic: "keepout_costmap_filter_info"
...
local_costmap:
  local_costmap:
    ros__parameters:
      ...
      plugins: ["voxel_layer", "inflation_layer"]
      filters: ["keepout_filter"]
      ...
      keepout_filter:
        plugin: "nav2_costmap_2d::KeepoutFilter"
        enabled: True
        filter_info_topic: "keepout_costmap_filter_info""
```

Note

All costmap filters should be enabled through a `filters` parameter – though it is technically possible to include in the layered costmap itself. This is separated from the layer plugins to prevent interference in the layers, particularly the inflation layer.

###### 4. Run Nav2 stack

Ready-to-go standalone Python launch-script, YAML-file with ROS parameters and filter mask example for Keepout Filter could be found in [nav2\_bringup](https://github.com/ros-navigation/navigation2/tree/main/nav2_bringup) directory. To run the demo, simply launch as follows:

```
ros2 launch nav2_bringup tb4_simulation_launch.py
```

And check that filter is working properly as in the pictures below

[![../../_images/keepout_global.png](../../_images/keepout_global.png)](../../_images/keepout_global.png)

Note

For another example and additional context, check the Navigation2 tutorials <https://github.com/ros-navigation/navigation2_tutorials/tree/rolling/nav2_costmap_filters_demo>

---

#### Navigating with Speed Limits

*Source: [https://docs.nav2.org/tutorials/docs/navigation2_with_speed_filter.html](https://docs.nav2.org/tutorials/docs/navigation2_with_speed_filter.html)*

##### Navigating with Speed Limits

* [Overview](#overview)
* [Requirements](#requirements)
* [Tutorial Steps](#tutorial-steps)


###### Overview

This tutorial shows how to simply utilize Speed Filter which is designed to limit the maximum speed of robots in speed restriction areas marked on a map. This functionality is being covered by `SpeedFilter` costmap filter plugin which will be enabled and used in this document.

###### Requirements

It is assumed that ROS 2, Gazebo and TurtleBot4 packages are installed or built locally. Please make sure that the Nav2 project is also built locally as it was made in [Build and Install](../../development_guides/build_docs/index.html#build-instructions).

###### Tutorial Steps

###### 1. Prepare filter mask

As was written in [Navigation Concepts](../../concepts/index.html#concepts), any Costmap Filter (including Speed Filter) is reading the data marked in a filter mask file. All information about filter masks, their types, detailed structure and how to make a new one is written in a [Navigating with Keepout Zones](navigation2_with_keepout_filter.html#navigation2-with-keepout-filter) tutorial at `1. Prepare filter masks` chapter. The principal of drawing the filter mask for Speed Filter is the same as for Keepout Filter (to annotate a map with the requested zones), except that `OccupancyGrid` mask values have another meaning: these values are encoded speed limits for the areas corresponding to the cell on map.

Let’s look, how it is being decoded. As we know, `OccupancyGrid` values are belonging to the `[0..100]` range. For Speed Filter `0` value means no speed limit in the area corresponding zero-cell on mask. Values from `[1..100]` range are being linearly converted into a speed limit value by the following formula:

```
speed_limit = filter_mask_data * multiplier + base;
```

where:

> * `filter_mask_data` - is an `OccupancyGrid` value of the corresponding cell on mask where maximum speed should be restricted.
> * `base` and `multiplier` are coefficients taken from `nav2_msgs/CostmapFilterInfo` messages published by Costmap Filter Info Server (see in next chapter below).

The decoded `speed_limit` value may have one of two meanings:

> * Speed limit expressed in a percent from maximum robot speed.
> * Speed limit expressed in absolute values (e.g. in `m/s`).

The meaning used by Speed Filter is being read from `nav2_msgs/CostmapFilterInfo` messages.
In this tutorial we will use the first type of speed restriction expressed in a percent from maximum robot speed.

Note

For speed restriction expressed in a percent, `speed_limit` will be used exactly as a percent belonging to `[0..100]` range, not `[0.0..1.0]` range.

Create a new image with a PGM/PNG/BMP format: copy [depot.pgm](https://github.com/ros-navigation/navigation2/blob/main/nav2_bringup/maps/depot.pgm) main map which will be used in a world simulation from a Nav2 repository to a new `depot_speed.pgm` file. Open `depot_speed.pgm` in your favourite raster graphics editor and fill speed restricted areas with grey colors. In our example darker colors will indicate areas with higher speed restriction:

[![../../_images/drawing_speed_mask.png](../../_images/drawing_speed_mask.png)](../../_images/drawing_speed_mask.png)

Area “A” is filled with `25%` gray color, area “B” - with `50%` gray, that means that speed restriction will take `100% - 25% = 75%` in area “A” and `100% - 50% = 50%` in area “B” from maximum speed value allowed for this robot.
We will use `scale` map mode with no thresholds. In this mode darker colors will have higher `OccupancyGrid` values. E.g. for area “B” with `50%` of gray `OccupancyGrid` data will be equal to `50`. So in order to hit the target, we need to choose `base = 100.0` and `multiplier = -1.0`. This will reverse the scale `OccupancyGrid` values to a desired one. No thresholds (`free_thresh` `occupied_thresh`) were chosen for the convenience in the `yaml` file: to have 1:1 full range conversion of lightness value from filter mask -> to speed restriction percent.

Note

It is typical but not a mandatory selection of `base` and `multiplier`. For example, you can choose map mode to be `raw`. In this case color lightness is being directly converted into `OccupancyGrid` values. For masks saved in a `raw` mode, `base` and `multiplier` will be equal to `0.0` and `1.0` accordingly.

Another important thing is that it is not necessary to use the whole `[0..100]` percent scale. `base` and `multiplier` coefficients could be chosen so that the speed restriction values would belong to somewhere in the middle of percent range. E.g. `base = 40.0`, `multiplier = 0.1` will give speed restrictions from `[40.0%..50.0%]` range with a step of `0.1%`. This might be useful for fine tuning.

After all speed restriction areas will be filled, save the `depot_speed.pgm` image.

Like all other maps, the filter mask should have its own YAML metadata file. Copy [depot.yaml](https://github.com/ros-navigation/navigation2/blob/main/nav2_bringup/maps/tb3_sandbox.yaml) to `speed_mask.yaml`. Open `speed_mask.yaml` and update the fields as shown below (as mentioned before for the `scale` mode to use whole color lightness range there should be no thresholds: `free_thresh = 0.0` and `occupied_thresh = 1.0`):

```
image: depot.pgm
->
image: depot_speed.pgm

mode: trinary
->
mode: scale

occupied_thresh: 0.65
free_thresh: 0.25
->
occupied_thresh: 1.0
free_thresh: 0.0
```

Since Costmap2D does not support orientation, the last third “yaw” component of the `origin` vector should be equal to zero (for example: `origin: [1.25, -5.18, 0.0]`). Save `speed_mask.yaml` and the new filter mask is ready to use.

Note

World map itself and filter mask could have different sizes, origin and resolution which might be useful (e.g. for cases when filter mask is covering smaller areas on maps or when one filter mask is used repeatedly many times, like annotating a speed restricted area for same shape rooms in the hotel). For this case, you need to correct `resolution` and `origin` fields in YAML as well so that the filter mask is correctly laid on top of the original map. This example shows using the main map as a base, but that is not required.

###### 2. Configure Costmap Filter Info Publisher Server

Each costmap filter reads incoming meta-information (such as filter type or data conversion coefficients) in messages of `nav2_msgs/CostmapFilterInfo` type. These messages are being published by [Costmap Filter Info Publisher Server](https://github.com/ros-navigation/navigation2/tree/main/nav2_map_server/src/costmap_filter_info). The server is running as a lifecycle node. According to the [design document](https://github.com/ros-navigation/navigation2/blob/main/doc/design/CostmapFilters_design.pdf), `nav2_msgs/CostmapFilterInfo` messages are going in a pair with `OccupancyGrid` filter mask topic. Therefore, along with Costmap Filter Info Publisher Server there should be enabled a new instance of Map Server configured to publish filter masks.

In order to enable Speed Filter in your configuration, both servers should be enabled as lifecycle nodes in Python launch-file. For example, this might look as follows, though adding them as Composition Nodes to your Navigation Component Container is also possible:

```
import os

from ament_index_python.packages import get_package_share_directory
from launch import LaunchDescription
from launch.actions import DeclareLaunchArgument, GroupAction, SetEnvironmentVariable
from launch.conditions import IfCondition
from launch.substitutions import LaunchConfiguration, PythonExpression
from launch_ros.actions import LoadComposableNodes, Node, PushROSNamespace, SetParameter
from launch_ros.descriptions import ComposableNode, ParameterFile
from nav2_common.launch import LaunchConfigAsBool, RewrittenYaml


def generate_launch_description() -> LaunchDescription:
    # Get the launch directory
    bringup_dir = get_package_share_directory('nav2_bringup')

    namespace = LaunchConfiguration('namespace')
    speed_mask_yaml_file = LaunchConfiguration('speed_mask')
    use_sim_time = LaunchConfigAsBool('use_sim_time')
    autostart = LaunchConfigAsBool('autostart')
    params_file = LaunchConfiguration('params_file')
    use_composition = LaunchConfigAsBool('use_composition')
    container_name = LaunchConfiguration('container_name')
    container_name_full = (namespace, '/', container_name)
    use_respawn = LaunchConfigAsBool('use_respawn')
    use_speed_zones = LaunchConfigAsBool('use_speed_zones')
    log_level = LaunchConfiguration('log_level')

    lifecycle_nodes = ['speed_filter_mask_server', 'speed_costmap_filter_info_server']

    # Map fully qualified names to relative ones so the node's namespace can be prepended.
    remappings = [('/tf', 'tf'), ('/tf_static', 'tf_static')]

    yaml_substitutions = {
        'SPEED_ZONE_ENABLED': use_speed_zones,
    }

    configured_params = ParameterFile(
        RewrittenYaml(
            source_file=params_file,
            root_key=namespace,
            param_rewrites={},
            value_rewrites=yaml_substitutions,
            convert_types=True,
        ),
        allow_substs=True,
    )

    stdout_linebuf_envvar = SetEnvironmentVariable(
        'RCUTILS_LOGGING_BUFFERED_STREAM', '1'
    )

    declare_namespace_cmd = DeclareLaunchArgument(
        'namespace', default_value='', description='Top-level namespace'
    )

    declare_speed_mask_yaml_cmd = DeclareLaunchArgument(
        'speed_mask',
        default_value='',
        description='Full path to speed mask yaml file to load',
    )

    declare_use_sim_time_cmd = DeclareLaunchArgument(
        'use_sim_time',
        default_value='false',
        description='Use simulation (Gazebo) clock if true',
    )

    declare_params_file_cmd = DeclareLaunchArgument(
        'params_file',
        default_value=os.path.join(bringup_dir, 'params', 'nav2_params.yaml'),
        description='Full path to the ROS2 parameters file to use for all launched nodes',
    )

    declare_use_composition_cmd = DeclareLaunchArgument(
        'use_composition',
        default_value='False',
        description='Use composed bringup if True',
    )

    declare_container_name_cmd = DeclareLaunchArgument(
        'container_name',
        default_value='nav2_container',
        description='the name of container that nodes will load in if use composition',
    )

    declare_use_respawn_cmd = DeclareLaunchArgument(
        'use_respawn',
        default_value='False',
        description='Whether to respawn if a node crashes. Applied when composition is disabled.',
    )

    declare_use_speed_zones_cmd = DeclareLaunchArgument(
        'use_speed_zones', default_value='True',
        description='Whether to enable speed zones or not'
    )

    declare_log_level_cmd = DeclareLaunchArgument(
        'log_level', default_value='info', description='log level'
    )

    load_nodes = GroupAction(
        condition=IfCondition(PythonExpression(['not ', use_composition])),
        actions=[
            PushROSNamespace(namespace),
            SetParameter('use_sim_time', use_sim_time),
            Node(
                condition=IfCondition(use_speed_zones),
                package='nav2_map_server',
                executable='map_server',
                name='speed_filter_mask_server',
                output='screen',
                respawn=use_respawn,
                respawn_delay=2.0,
                parameters=[configured_params, {'yaml_filename': speed_mask_yaml_file}],
                arguments=['--ros-args', '--log-level', log_level],
                remappings=remappings,
            ),
            Node(
                condition=IfCondition(use_speed_zones),
                package='nav2_map_server',
                executable='costmap_filter_info_server',
                name='speed_costmap_filter_info_server',
                output='screen',
                respawn=use_respawn,
                respawn_delay=2.0,
                parameters=[configured_params],
                arguments=['--ros-args', '--log-level', log_level],
                remappings=remappings,
            ),
            Node(
                package='nav2_lifecycle_manager',
                executable='lifecycle_manager',
                name='lifecycle_manager_speed_zone',
                output='screen',
                arguments=['--ros-args', '--log-level', log_level],
                parameters=[{'autostart': autostart}, {'node_names': lifecycle_nodes}],
            ),
        ],
    )
    # LoadComposableNode for map server twice depending if we should use the
    # value of map from a CLI or launch default or user defined value in the
    # yaml configuration file. They are separated since the conditions
    # currently only work on the LoadComposableNodes commands and not on the
    # ComposableNode node function itself
    load_composable_nodes = GroupAction(
        condition=IfCondition(use_composition),
        actions=[
            PushROSNamespace(namespace),
            SetParameter('use_sim_time', use_sim_time),
            LoadComposableNodes(
                target_container=container_name_full,
                condition=IfCondition(use_speed_zones),
                composable_node_descriptions=[
                    ComposableNode(
                        package='nav2_map_server',
                        plugin='nav2_map_server::MapServer',
                        name='speed_filter_mask_server',
                        parameters=[
                            configured_params,
                            {'yaml_filename': speed_mask_yaml_file}
                        ],
                        remappings=remappings,
                    ),
                    ComposableNode(
                        package='nav2_map_server',
                        plugin='nav2_map_server::CostmapFilterInfoServer',
                        name='speed_costmap_filter_info_server',
                        parameters=[configured_params],
                        remappings=remappings,
                    ),
                ],
            ),

            LoadComposableNodes(
                target_container=container_name_full,
                composable_node_descriptions=[
                    ComposableNode(
                        package='nav2_lifecycle_manager',
                        plugin='nav2_lifecycle_manager::LifecycleManager',
                        name='lifecycle_manager_speed_zone',
                        parameters=[
                            {'autostart': autostart, 'node_names': lifecycle_nodes}
                        ],
                    ),
                ],
            ),
        ],
    )

    # Create the launch description and populate
    ld = LaunchDescription()

    # Set environment variables
    ld.add_action(stdout_linebuf_envvar)

    # Declare the launch options
    ld.add_action(declare_namespace_cmd)
    ld.add_action(declare_speed_mask_yaml_cmd)
    ld.add_action(declare_use_sim_time_cmd)
    ld.add_action(declare_params_file_cmd)
    ld.add_action(declare_use_composition_cmd)
    ld.add_action(declare_container_name_cmd)
    ld.add_action(declare_use_respawn_cmd)
    ld.add_action(declare_use_speed_zones_cmd)
    ld.add_action(declare_log_level_cmd)

    # Add the actions to launch all of the map modifier nodes
    ld.add_action(load_nodes)
    ld.add_action(load_composable_nodes)

    return ld
```

where the `params_file` variable should be set to a YAML-file having ROS parameters for Costmap Filter Info Publisher Server and Map Server nodes. These parameters and their meaning are listed at [Map Server](../../configuration/packages/configuring-map-server.html#configuring-map-server) page. Please, refer to it for more information. The example of `params_file` could be found below:

```
speed_filter_mask_server:
  ros__parameters:
    topic_name: "speed_filter_mask"
    # yaml_filename: ""

speed_costmap_filter_info_server:
  ros__parameters:
    type: 1
    filter_info_topic: "speed_costmap_filter_info"
    mask_topic: "speed_filter_mask"
    base: 100.0
    multiplier: -1.0
```

Note, that:

> * For Speed Filter setting speed restrictions in a percent from maximum speed, the `type` of costmap filter should be set to `1`. All possible costmap filter types could be found at [Map Server](../../configuration/packages/configuring-map-server.html#configuring-map-server) page.
> * Filter mask topic name should be the equal for `mask_topic` parameter of Costmap Filter Info Publisher Server and `topic_name` parameter of Map Server.
> * As was described in a previous chapter, `base` and `multiplier` should be set to `100.0` and `-1.0` accordingly for the purposes of this tutorial example.

###### 3. Enable Speed Filter

Costmap Filters are Costmap2D plugins. You can enable the `SpeedFilter` plugin in Costmap2D by adding `speed_filter` to the `plugins` parameter in `nav2_params.yaml`. The Speed Filter plugin should have the following parameters defined:

* `plugin`: type of plugin. In our case `nav2_costmap_2d::SpeedFilter`.
* `filter_info_topic`: filter info topic name. This needs to be equal to `filter_info_topic` parameter of Costmap Filter Info Publisher Server from the chapter above.
* `speed_limit_topic`: name of topic to publish speed limit to.

Full list of parameters supported by `SpeedFilter` are listed at the [Speed Filter Parameters](../../configuration/packages/costmap-plugins/speed_filter.html#speed-filter) page.

You can place the plugin either in the `global_costmap` section in `nav2_params.yaml` to have speed restriction mask applied to global costmap or in the `local_costmap` to apply speed mask to the local costmap. However, `SpeedFilter` plugin should never be enabled simultaneously for global and local costmaps. Otherwise, it can lead to unwanted multiple “speed restriction” - “no restriction” message chains on speed restriction boundaries, that will cause jerking of the robot or another unpredictable behaviour.

In this tutorial, we will enable Speed Filter for the global costmap. For this use the following configuration:

```
global_costmap:
  global_costmap:
    ros__parameters:
      ...
      plugins: ["static_layer", "obstacle_layer", "inflation_layer"]
      filters: ["speed_filter"]
      ...
      speed_filter:
        plugin: "nav2_costmap_2d::SpeedFilter"
        enabled: True
        filter_info_topic: "speed_costmap_filter_info"
        speed_limit_topic: "speed_limit"
```

As stated in the [design](https://github.com/ros-navigation/navigation2/blob/main/doc/design/CostmapFilters_design.pdf), Speed Filter publishes speed restricting [messages](https://github.com/ros-navigation/navigation2/blob/main/nav2_msgs/msg/SpeedLimit.msg) targeted for a Controller Server so that it could restrict maximum speed of the robot when it needed. Controller Server has a `speed_limit_topic` ROS parameter for that, which should be set to the same as in `speed_filter` plugin value. This topic in the map server could also be used to any number of other speed-restricted applications beyond the speed limiting zones, such as dynamically adjusting maximum speed by payload mass.

Set `speed_limit_topic` parameter of a Controller Server to the same value as it set for `speed_filter` plugin:

```
controller_server:
  ros__parameters:
    ...
    speed_limit_topic: "speed_limit"
```

###### 4. Run Nav2 stack

Ready-to-go standalone Python launch-script, YAML-file with ROS parameters and filter mask example for Speed Filter could be found in [nav2\_bringup](https://github.com/ros-navigation/navigation2/tree/main/nav2_bringup) directory. To run the demo, simply launch as follows:

```
ros2 launch nav2_bringup tb4_simulation_launch.py
```

For better visualization of speed filter mask, in RViz in the left `Displays` pane unfold `Map` and change `Topic` from `/map` -> to `/speed_filter_mask`.
Set the goal behind the speed restriction areas and check that the filter is working properly: robot should slow down when going through a speed restricting areas. Below is how it might look:

[![../../_images/speed_global.png](../../_images/speed_global.png)](../../_images/speed_global.png)

Note

For another example and additional context, check the Navigation2 tutorials <https://github.com/ros-navigation/navigation2_tutorials/tree/rolling/nav2_costmap_filters_demo>

---

#### Navigating with Vector Objects

*Source: [https://docs.nav2.org/tutorials/docs/navigation2_with_vector_objects.html](https://docs.nav2.org/tutorials/docs/navigation2_with_vector_objects.html)*

##### Navigating with Vector Objects

* [Overview](#overview)
* [Requirements](#requirements)
* [Configuring Vector Object Server](#configuring-vector-object-server)
* [Preparing Nav2 stack](#preparing-nav2-stack)
* [Demo Execution](#demo-execution)
* [Working with Vector Objects](#working-with-vector-objects)

![../../_images/vector_objects_demo.gif](../../_images/vector_objects_demo.gif)

###### Overview

This tutorial shows how to navigate with vector objects added to raster costmaps.
They can be used for various purposes, such as programmatically generating complete occupancy grid maps for navigation, adding virtual static/dynamic obstacles on an existing map, or like [Costmap Filters](../../migration/Foxy.html#costmap-filters) do with rastered maps, but on a vector (polygon or shape) basis rather than annotating a map-sized mask.

In this tutorial, the added vector objects will be treated as obstacles in costmaps using a Keepout Filter.
To do this, we need to prepare the Nav2 stack with the Keepout Filter enabled, along with the Vector Object server which publishes an `OccupancyGrid` map with the rasterized vector objects as an input mask for the Keepout Filter.
Other use cases use similar principles and could be easily adapted after finishing this tutorial.

Note

Using with Keepout Filter is a good choice for adding virtual obstacles or removing some areas from costmaps. However, the Vector Object server is not restricted to this application. It can be paired with different Costmap Filters for other use cases or even other applications entirely. For example, to represent polygonal speed restriction areas, a polygon-defined room where the camera is to be turned off using the Binary Filter, or using custom spatial / polygon applications.

###### Requirements

It is assumed ROS 2 and Nav2 dependent packages are installed or built locally.
Please follow the instructions in [Build and Install](../../development_guides/build_docs/index.html#build-instructions).
For the best understanding how Keepout Filter works (which is the part of current configuration), it is also recommended to pass through the [Navigating with Keepout Zones](navigation2_with_keepout_filter.html#navigation2-with-keepout-filter) tutorial.

###### Configuring Vector Object Server

Vector Object server has its own `vector_object_server.launch.py` launch-file and preset parameters in the `vector_object_server_params.yaml` file for demonstration, though its trivial to add this to Nav2’s main launch file if being used in practice.

In this tutorial, we are focusing on the application how to utilize the simple setup allowing to add virtual obstacles on costmaps.
For demonstration purposes, let’s specify two obstacle shapes: triangle polygon and circle filled with “occupied” value, in order to prevent the robot to go through them. The YAML-part for polygon and circle will look as follows:

```
shapes: ["Poly", "Circle"]
Poly:
  type: "polygon"
  frame_id: "map"
  closed: True
  value: 100
  points: [0.3, 0.5, -0.4, 1.2, -0.4, -0.2]
Circle:
  type: "circle"
  frame_id: "map"
  fill: True
  value: 100
  center: [1.5, 0.5]
  radius: 0.7
```

Where the triangle polygon is specified by `{0.3, 0.5}, {-0.4, 1.2}, {-0.4, -0.2}` 3-point shape and the circle has `{1.5, 0.5}` coordinate of its center with `0.7` meter radius in the `map` frame.
`closed` true-value for the polygon and `fill` for the circle mean that both shapes to be filled the with specified `value`.
This value is equal to `100` which means “occupied” in OccupancyGrid format.

Note

The frame for vector objects were specified the same as map’s global frame. It was chosen for the simplicity to have static objects on map. However, it is possible to specify the shape in any frame different from global map’s one. For this case, Vector Object server will use dynamic output map processing & publishing, suitable for moving objects.

Note

Each shape is being addressed by UUID, which could be specified manually in a string format. In the demonstration, it was skipped to specify UUID of the shapes in the parameters, so Vector Object server will automatically generate a new one for each shape. The list of UUID could be obtained later by calling `GetShapes.srv` service.

Costmap Filters require `CostmapFilterInfo.msg` message to be published along with filter mask (rasterized map with vector shapes).
Costmap Filter Info message is being published by Costmap Filter Info server, which is also launched by the `vector_object_server.launch.py` script.

The complete `vector_object_server_params.yaml` YAML-file for the demonstration looks as follows:

```
vector_object_server:
  ros__parameters:
    map_topic: "vo_map"
    global_frame_id: "map"
    resolution: 0.05
    default_value: -1
    overlay_type: 0
    update_frequency: 1.0
    transform_tolerance: 0.1
    shapes: ["Poly", "Circle"]
    Poly:
      type: "polygon"
      frame_id: "map"
      closed: True
      value: 100
      points: [0.3, 0.5, -0.4, 1.2, -0.4, -0.2]
    Circle:
      type: "circle"
      frame_id: "map"
      fill: True
      value: 100
      center: [1.5, 0.5]
      radius: 0.7
costmap_filter_info_server:
  ros__parameters:
    type: 0
    filter_info_topic: "vo_costmap_filter_info"
    mask_topic: "vo_map"
    base: 0.0
    multiplier: 1.0
```

More detailed information about each Vector Object server parameter and its operating principle could be found on [Vector Object Server](../../configuration/packages/map_server/configuring-vector-object-server.html#configuring-vector-object-server) configuration guide page. Costmap Filter Info server parameters description could be found at [Costmap Filter Info Server](../../configuration/packages/map_server/configuring-costmap-filter-info-server.html#configuring-costmap-filter-info-server) page.

After Vector Objects and Costmap Filters Info servers were configured, launch them by command from below.
Robot should bypass vector obstacles. For the demonstration purposes it is enough to avoid path planning through them.

```
ros2 launch nav2_map_server vector_object_server.launch.py
```

###### Preparing Nav2 stack

Vector Object server puts shapes to OccupacyGrid map and publishes it in a topic, which is used as an input mask for enabled in Nav2 Keepout Filter.
Enabling of Keeput Filter in Nav2 stack principles are similar as written in [Navigating with Keepout Zones](navigation2_with_keepout_filter.html#navigation2-with-keepout-filter) tutorial.
Since vector objects are being enabled in global costmaps, Keepout Filter called as “vector\_object\_layer”, should be added to the global costmap section of the `nav2_params.yaml` standard Nav2 configuration as follows:

```
global_costmap:
  ros__parameters:
    plugins: ["static_layer", "obstacle_layer", "inflation_layer"]
    filters: ["keepout_filter", "speed_filter", "vector_object_layer"]
    ...
    vector_object_layer:
      plugin: "nav2_costmap_2d::KeepoutFilter"
      enabled: True
      filter_info_topic: "vo_costmap_filter_info"
```

###### Demo Execution

After Vector Object server was launched and Vector Object layer was enabled for the global costmap, run Nav2 stack as written in [Getting Started](../../getting_started/index.html#getting-started):

```
ros2 launch nav2_bringup tb3_simulation_launch.py headless:=False
```

We are using composable nodes technology, so in the console where Vector Object server run the following message should appear:

```
[leha@leha-PC nav2_ws]$ ros2 launch nav2_map_server vector_object_server.launch.py
[INFO] [launch]: All log files can be found below /home/leha/.ros/log/2023-11-24-13-18-42-257011-leha-PC-18207
[INFO] [launch]: Default logging verbosity is set to INFO
[INFO] [launch_ros.actions.load_composable_nodes]: Loaded node '/lifecycle_manager_vo_server' in container 'nav2_container'
[INFO] [launch_ros.actions.load_composable_nodes]: Loaded node '/vector_object_server' in container 'nav2_container'
[INFO] [launch_ros.actions.load_composable_nodes]: Loaded node '/costmap_filter_info_server' in container 'nav2_container'
```

The last lines mean that all three nodes: Vector Object server, Costmap Filter Info server, and the Lifecycle Manager handling them, were successfully loaded into the Nav2 container `nav2_container`.

Set the initial pose for the robot, and check that vector objects were appeared on global costmap:

> [![../../_images/vector_objects_on_costmap.png](../../_images/vector_objects_on_costmap.png)](../../_images/vector_objects_on_costmap.png)

As well as for the Keepout Filter, robot will consider vector objects as obstacles on costmaps and will avoid them:

> [![../../_images/vector_objects_avoidance.png](../../_images/vector_objects_avoidance.png)](../../_images/vector_objects_avoidance.png)

###### Working with Vector Objects

During the operation, vector objects can be changed, added or removed.
Let’s change triangle shape to the bar.

As was mentioned above, each shape is handled by its own UUID, which is being generated by Vector Object server if it is not specified explicitly in parameters.
To obtain shapes UUID, run the `GetShapes.srv` service request from the console:

```
ros2 service call /vector_object_server/get_shapes nav2_msgs/srv/GetShapes
```

The output is expected to be the as follows:

```
requester: making request: nav2_msgs.srv.GetShapes_Request()

response:
nav2_msgs.srv.GetShapes_Response(circles=[nav2_msgs.msg.CircleObject(header=std_msgs.msg.Header(stamp=builtin_interfaces.msg.Time(sec=0, nanosec=0), frame_id='map'), uuid=unique_identifier_msgs.msg.UUID(uuid=array([73, 141, 241, 249, 116, 24, 69, 81, 178, 153, 159, 19, 245, 152, 28, 29], dtype=uint8)), center=geometry_msgs.msg.Point32(x=1.5, y=0.5, z=0.0), radius=0.699999988079071, fill=True, value=100)], polygons=[nav2_msgs.msg.PolygonObject(header=std_msgs.msg.Header(stamp=builtin_interfaces.msg.Time(sec=0, nanosec=0), frame_id='map'), uuid=unique_identifier_msgs.msg.UUID(uuid=array([153, 128, 30, 121, 241, 60, 76, 15, 140, 187, 58, 60, 164, 241, 97, 39], dtype=uint8)), points=[geometry_msgs.msg.Point32(x=0.30000001192092896, y=0.5, z=0.0), geometry_msgs.msg.Point32(x=-0.4000000059604645, y=1.2000000476837158, z=0.0), geometry_msgs.msg.Point32(x=-0.4000000059604645, y=-0.20000000298023224, z=0.0)], closed=True, value=100)])
```

In our case, UUID for triangle polygon will be `[153, 128, 30, 121, 241, 60, 76, 15, 140, 187, 58, 60, 164, 241, 97, 39]`.

Calling `AddShapes.srv` service will add new shape if no UUID was specified, or given UUID was not found.
If UUID is already existing, the shape will be updated.
The triangle to be changed to the bar polygon with 4 points.
Call the following service request with obtained UUID to do this:

```
ros2 service call /vector_object_server/add_shapes nav2_msgs/srv/AddShapes "polygons: [{points: [{x: 0.0, y: 1.0}, {x: -0.5, y: 1.0}, {x: -0.5, y: 0.0}, {x: 0.0, y: 0.0}], closed: true, value: 100, uuid: {uuid: [153, 128, 30, 121, 241, 60, 76, 15, 140, 187, 58, 60, 164, 241, 97, 39]}}]"
```

The polygon shape in Vector Object server will be changed, `vo_map` will be updated and resulting costmap will look as follows - triangle obstacle was updated to bar:

> ![../../_images/vector_objects_updated.png](../../_images/vector_objects_updated.png)

Finally, remove all shapes from map.
To remove any existing shape, there is `RemoveShapes.srv` service supported. It has array of UUID-s to specify which shapes to remove or just `all_objects` option for the case if we want to remove all shapes at once. Let’s do the latter:

```
ros2 service call /vector_object_server/remove_shapes nav2_msgs/srv/RemoveShapes "all_objects: true"
```

As a result, all vector shapes were disappeared from global costmap:

> ![../../_images/vector_objects_removed.png](../../_images/vector_objects_removed.png)

---

#### Profiling in ROS 2 / Nav2

*Source: [https://docs.nav2.org/tutorials/docs/get_profile.html](https://docs.nav2.org/tutorials/docs/get_profile.html)*

##### Profiling in ROS 2 / Nav2

* [Overview](#overview)
* [Preliminaries](#preliminaries)
* [Profile from a Node](#profile-from-a-node)
* [Profile from a Launch File](#profile-from-a-launch-file)
* [From Nav2 Bringup](#from-nav2-bringup)

###### Overview

This document explains one method for profiling applications in ROS 2 / Nav2. The aim of profiling is to generate files that can be analyzed to see where compute time and resources are spent during the execution of a program. This can be useful to determine where the bottlenecks in your program exist and where things might be able to be improved.

The following steps show ROS 2 users how to modify the Nav2 stack to get profiling information about a particular server / algorithm when they encounter a situation they’d like to understand better. This tutorial applies to both simulated and physical robots.

###### Preliminaries

This tutorial makes use of two tools, callgrind from the `Valgrind` set of tools and `kcachegrind`. Valgrind is used to get the profiling information about the program and kcachegrind is the visualization engine used to interpret this information to do useful work.

Thus, we must install them.

```
sudo apt install valgrind kcachegrind
```

More information can be found in the [Valgrind manual](https://valgrind.org/docs/manual/cl-manual.html) including additional valgrind arguments that can be used to specify more information.

Generally speaking, to use valgrind we need to compile with debugging information. This can be done by passing `-g` as a compiling option or compile `CMAKE_BUILD_TYPE` as `Debug` or `RelWithDebInfo`. Then, we run our program using valgrind to capture the run-time statistics for later analysis. These are stored in `callgrind.out.XXX` files, where the suffix is the PID of the process. kcachegrind is used to visualize and analyze the results of the program execution.

```
##### CMakeLists.txt
add_compile_options(-g)
```

```
cmake -DCMAKE_BUILD_TYPE=RelWithDebInfo
```

```
valgrind --tool=callgrind [your-program] [program options]

kcachegrind callgrind.out.XXX
```

###### Profile from a Node

As in our generic example, for a given node, we need to compile with debug flags to capture the information for profiling with Valgrind. This can be done easily from the commandline. Note that we use `--packages-select` to only compile with this flag for the packages we want to profile nodes within.

```
colcon build --packages-select <packages of interest> --cmake-args -DCMAKE_BUILD_TYPE=RelWithDebInfo
```

Optionally, you may add the following line to the `CMakeLists.txt` of the package you’re looking to profile. This may be preferable when you have a workspace with many packages but would like to only compile a subset with debug information using a single `colcon build` invocation.

It is important that this should be added to both the host server and plugin packages(s) if you would like the results of a plugin’s run-time profile.

```
add_compile_options(-pg)
```

After either compiling method, this node should be run in its own terminal to isolate it from the rest of your system. Thus, this should not be composed in the same process as other nodes. To run a ROS 2 node with valgrind, this can be done from the commandline via:

```
ros2 run --prefix 'valgrind --tool=callgrind' <pkg> <node> --all-other-launch arguments
```

An example of this might be used for profiling the controller server with a particular controller plugin loaded. Both `nav2_controller` and the plugin package of interest are compiled with debug flags. In the example below, we are running a ROS 2 node with remapped topics and a path to its parameter file:

```
ros2 run --prefix 'valgrind --tool=callgrind' nav2_controller controller_server --ros-args -r __node:=controller_server -r cmd_vel:=cmd_vel_nav --params-file /path/to/nav2_bringup/params/nav2_params.yaml
```

Once sufficient data has been collected, cleanly exit the process with Control+C.

###### Profile from a Launch File

Just as in the Node example, we must also compile with debug flags when profiling a node from launch. We can complete the same valgrind call as from the commandline as within a launch file using launch prefixes.

As our example before, this is how we’d launch the `controller_server` node from inside a launch file.

```
start_controller_server_node = Node(
    parameters=[
      get_package_share_directory("nav2_bringup") + '/params/nav2_params.yaml',
      {'use_sim_time': use_sim_time}
    ],
    package='nav2_controller',
    executable='controller_server',
    name='controller_server',
    prefix=['xterm -e valgrind --tool=callgrind'],
    output='screen')
```

Note that just like before, we should isolate this process from others. So this should not be run with any other nodes in this launch file nor use node composition when profiling a particular node.

Once sufficient data has been collected, cleanly exit the process with Control+C.

###### From Nav2 Bringup

Because Nav2 bringup has more than one node per launch file (and in the case `use_composition=true`, more than one per process), it is necessary to separate out a particular node that you’re interested in profiling from the rest of the system. As previously described, once they’re isolated in either a launch file or as a node to be launched on the commandline, they can easily be run to collect the callgrind information.

The steps within Nav2 are as follows:

* Remove server node from the `navigation_launch.py`, ensuring to remove from both composed and non-composed options within the file
* In a separate launch file or using `ros2 run` CLI, start up the node you’d like to profile using the instructions above
* Launch Nav2 as usual with the missing node
* Once your data has been collected, control+C and cleanly finish the profiled process and the rest of the navigation

It is important that the profiler node is launched before Nav2 so that it can take the signals from the lifecycle manager to transition up.

###### Interpreting Results

Once you have your `callgrind` results, regardless of if you did it through a node, launch file, Nav2, or elsewhere, now we can analyze the results from the profiler to identify bottlenecks or potential areas of improvement. Using `kcachegrind`:

```
kcachegrind callgrind.out.XXX
```

This should open a window looking like below. The left side shows all of the calls and their relative percentages of compute time they and their children functions utilized.

> [![../../_images/kcachegrind.png](../../_images/kcachegrind.png)](../../_images/kcachegrind.png)

If you select the top level entry on the left sidebar, then select “Call Graph” at the bottom of the right workspace, it should show you a call graph of where the compute time was spent as a graph of method calls. This can be exceptionally helpful to find the methods where the most time is spent.

> [![../../_images/call_graph.png](../../_images/call_graph.png)](../../_images/call_graph.png)

---

#### ROSCon UK 2025: State Estimation for Mobile Robotics Workshop

*Source: [https://docs.nav2.org/tutorials/docs/roscon_uk_2025_state_estimation.html](https://docs.nav2.org/tutorials/docs/roscon_uk_2025_state_estimation.html)*

##### ROSCon UK 2025: State Estimation for Mobile Robotics Workshop

* [Overview](#overview)
* [Workshop Content](#workshop-content)

###### Overview

This tutorial provides comprehensive hands-on experience with state estimation techniques for mobile robotics, presented as a workshop at ROSCon UK 2025.
State estimation is a fundamental component of any autonomous mobile robot system, enabling robots to maintain accurate knowledge of their position, orientation, and velocity in the world.
This workshop covers two complementary approaches to state estimation that are widely used in production robotics systems.

The workshop materials explore both classical filtering approaches and modern optimization-based methods for sensor fusion.
Whether you’re building a warehouse robot, an outdoor autonomous vehicle, or any other mobile platform, understanding these state estimation techniques is crucial for achieving reliable navigation and localization performance.
The hands-on exercises use real ROS 2 packages that are production-tested and widely deployed in commercial robotics applications.

The complete workshop materials, including setup instructions, exercises, and solutions, are available in the official repository:

[ROSCon UK 2025 State Estimation Workshop Repository](https://github.com/locusrobotics/roscon-uk-2025-se-workshop)

###### Workshop Content

The workshop covers two powerful state estimation frameworks:

**Robot Localization - Kalman Filter-Based Sensor Fusion**

Robot Localization is a ROS package that provides Extended Kalman Filter (EKF) and Unscented Kalman Filter (UKF) implementations for fusing data from multiple sensors.
This approach is particularly well-suited for real-time state estimation where computational efficiency is critical.
The workshop demonstrates how to configure Robot Localization to fuse IMU data, wheel odometry, GPS, and other sensors to produce smooth, accurate state estimates.
Topics include:

* Understanding the Extended Kalman Filter and Unscented Kalman Filter algorithms
* Configuring sensor inputs and fusion parameters
* Tuning process and measurement noise covariances
* Setting up coordinate frame transforms for proper sensor fusion
* Handling different sensor update rates and characteristics
* Debugging common state estimation issues

**Fuse - Factor Graph Optimization**

Fuse is a general architecture for performing sensor fusion using factor graphs.
Unlike traditional filtering approaches, factor graph optimization considers a history of measurements to jointly optimize the robot’s trajectory.
This batch optimization approach can produce more accurate results by reasoning about past measurements and future constraints simultaneously.
The workshop covers:

* Introduction to factor graph concepts and optimization
* Building factor graphs for mobile robot state estimation
* Integrating various sensor modalities into the factor graph framework
* Understanding the trade-offs between filtering and optimization approaches
* Fixed-lag smoothing for real-time performance
* Loop closure detection and handling with factor graphs

Both approaches have their strengths.
The workshop provides practical experience with both methods, enabling you to choose the right approach for your specific robotics application.

Check out the full workshop materials in the repository: <https://github.com/locusrobotics/roscon-uk-2025-se-workshop>

---

#### Route Server Tools

*Source: [https://docs.nav2.org/tutorials/docs/route_server_tools.html](https://docs.nav2.org/tutorials/docs/route_server_tools.html)*

##### Route Server Tools

Route Server tools are essential components in the Nav2 ecosystem that help users create, edit, and manage route graphs for robot navigation. A route graph is a representation of valid paths that a robot can follow in its environment, consisting of nodes (waypoints) and edges (connections between waypoints). These tools simplify the process of defining preferred paths and restricted areas for robot navigation.

Unlike free-space planning, route-based navigation ensures that robots follow specific, predefined paths, which is particularly useful in:

* Industrial environments where specific routes must be followed
* Warehouse operations requiring structured movement patterns
* Facilities with restricted areas or preferred paths
* Multi-robot coordination scenarios where predefined routes help prevent conflicts
* Large scale outdoor urban or natural environments

[![../../_images/route_homepage_demo.gif](../../_images/route_homepage_demo.gif)](../../_images/route_homepage_demo.gif)

***Demonstration of Nav2 route tool using the Turtlebot4 Gazebo simulation environment visualised through RViz.***

###### Provided Tools

* [Using the Nav2 Route Tool](route_server_tools/navigation2_route_tool.html)
* [Route Graph Generation LIF Editor](route_server_tools/route_graph_generation_lif_editor.html)
* [Route Graph Generation](route_server_tools/route_graph_generation.html)
* [SWAGGER Route Graph Generation](route_server_tools/swagger_generation.html)

###### Description

There are several tools available for creating and editing route graphs for the Nav2 Route Server:

1. **Nav2 Route Tool**: An Rviz panel that allows users to create, edit, and manage route graphs directly within the ROS 2 environment. It supports loading existing graphs, adding/editing/removing nodes and edges, and saving changes to files.
2. **VDA LIF Editor**: A web-based tool that allows users to create route graphs using floor plan images. It can generate both GeoJSON and LIF formats, making it particularly useful for standardized route creation. No installation is required as it runs in a web browser.
3. **Manual Route Graph Generation**: For those who prefer direct file editing, route graphs can be created manually in GeoJSON format using QGIS. This method provides the most control over the graph structure but requires understanding of the GeoJSON format.
4. **Swagger Generation**: A tool that automatically generates route graphs from raster images using GPU-aided geometric techniques for unstructured, semistructured, or applications where specific lanes and manual annotations are not required.

Choose the tool that best fits your needs based on your workflow and requirements.

###### Demonstration

A demonstration of the assembled route server is provided to the Turtlebot4 Gazebo simulation for the Depot and Warehouse maps.

In order to run the demonstration, run the following command:

```
ros2 launch nav2_simple_commander route_example_launch.py
```

This will by default initialize the Turtlebot4 in the depot map in the **3rd node** and will navigate to the **13rd node**.

[![../../_images/route_depot_demo.gif](../../_images/route_depot_demo.gif)](../../_images/route_depot_demo.gif)

***Turtlebot4 moving from the 3rd node to the 13th node in the depot map.***

In order to run the demonstration in the warehouse map, you can set the `MAP_TYPE` variable in the
[route\_example\_launch.py](https://github.com/ros-navigation/navigation2/blob/main/nav2_simple_commander/launch/route_example_launch.py) file to `warehouse` and run the same command as above.

[![../../_images/route_warehouse_demo.gif](../../_images/route_warehouse_demo.gif)](../../_images/route_warehouse_demo.gif)

***Turtlebot4 moving from the 0th node to the 61th node in the warehouse map.***

For more information on how to configure the start and goal nodes, or the supported maps, please refer to the [Configuration Guide](https://docs.nav2.org/configuration/packages/configuring-route-server.html) page.

---

#### Using an External Costmap Plugin (STVL)

*Source: [https://docs.nav2.org/tutorials/docs/navigation2_with_stvl.html](https://docs.nav2.org/tutorials/docs/navigation2_with_stvl.html)*

##### Using an External Costmap Plugin (STVL)

* [Overview](#overview)
* [Costmap2D and STVL](#costmap2d-and-stvl)
* [Tutorial Steps](#tutorial-steps)


###### Overview

This tutorial shows how to load and use an external plugin.
This example uses the [Spatio Temporal Voxel Layer](https://github.com/SteveMacenski/spatio_temporal_voxel_layer/) (STVL) costmap [pluginlib](http://wiki.ros.org/pluginlib/) plugin as an example.
STVL is a demonstrative pluginlib plugin and the same process can be followed for other costmap plugins as well as plugin planners, controllers, and behaviors.

Before completing this tutorial, please look at the previous two tutorials on navigation in simulation and physical hardware, if available.
This tutorial assumes knowledge of navigation and basic understanding of costmaps.

Note

For Ubuntu 20.04 users before December 2021, there’s a known issue with OpenVDB and its binaries with `libjmalloc`. If you see an error such as `Could not load library LoadLibrary error: /usr/lib/x86_64-linux-gnu/libjemalloc.so.2: cannot allocate memory in static TLS block`, it can be resolved with `export LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libjemalloc.so.2` until new binaries are released of OpenVDB.

###### Costmap2D and STVL

Costmap 2D is the data object we use to buffer sensor information into a global view that the robot will use to create plans and control efforts.
Within Costmap2D, there are pluginlib plugin interfaces available to create custom behaviors loadable at runtime.
Examples of included pluginlib plugins for Costmap2D are the Obstacle Layer, Voxel Layer, Static Layer, and Inflation Layer.

However, these are simply example plugins offered by the base implementation.
Another available pluginlib plugin for Costmap2D in Navigation2 is STVL.

STVL is another 3D perception plugin similar to the Voxel Layer.
A more detailed overview of how it works can be found [in this repo](https://github.com/SteveMacenski/spatio_temporal_voxel_layer/), however it buffers 3D data from depth cameras, sonars, lidars, and more into a sparse volumetic world model and removes voxels over time proportional with a sensor model and time-based expiration.
This can be especially useful for robots in highly dynamic environments and decreases the resource utilization for 3D sensor processing by up to 2x.
STVL also treats 3D lidars and radars as first class citizens for support.
The ROSCon talk for STVL can be found [in this video](https://vimeo.com/292699571).

###### Tutorial Steps

###### 0- Setup

Follow the same process as in [Getting Started](../../getting_started/index.html#getting-started) for installing and setting up a robot for hardware testing or simulation, as applicable. Ensure ROS 2, Navigation2, and Gazebo are installed.

###### 1- Install STVL

STVL can be installed in ROS 2 via the ROS Build Farm:

* `sudo apt install ros-<ros2-distro>-spatio-temporal-voxel-layer`

It can also be built from source by cloning the repository into your Navigation2 workspace:

* `git clone -b <ros2-distro>-devel git@github.com:stevemacenski/spatio_temporal_voxel_layer`

###### 1- Modify Navigation2 Parameter

STVL is an optional plugin, like all plugins, in Costmap2D. Costmap Plugins in Navigation2 are loaded in the `plugin_names` and `plugin_types` variables inside of their respective costmaps.
For example, the following will load the static and obstacle layer plugins into the name `static_layer` and `obstacle_layer`, respectively:

```
global_costmap:
  global_costmap:
    ros__parameters:
      plugins: ["static_layer", "obstacle_layer"]
```

Note

For Galactic or later, `plugin_names` and `plugin_types` have been replaced with a single `plugins` string vector for plugin names. The types are now defined in the `plugin_name` namespace in the `plugin:` field (e.g. `plugin: MyPlugin::Plugin`). Inline comments in the code blocks will help guide you through this.

To load the STVL plugin, a new plugin name and type must be added.
For example, if the application required an STVL layer and no obstacle layer, our file would be:

```
global_costmap:
  global_costmap:
    ros__parameters:
      plugins: ["static_layer", "stvl_layer"]
```

Similar to the Voxel Layer, after registering the plugin, we can add the configuration of the STVL layer under the namespace `stvl_layer`.
An example fully-described parameterization of an STVL configuration is:

```
stvl_layer:
  plugin: "spatio_temporal_voxel_layer/SpatioTemporalVoxelLayer"
  enabled: true
  voxel_decay: 15.
  decay_model: 0
  voxel_size: 0.05
  track_unknown_space: true
  unknown_threshold: 15
  mark_threshold: 0
  update_footprint_enabled: true
  combination_method: 1
  origin_z: 0.0
  publish_voxel_map: true
  transform_tolerance: 0.2
  mapping_mode: false
  map_save_duration: 60.0
  observation_sources: pointcloud
  pointcloud:
    data_type: PointCloud2
    topic: /intel_realsense_r200_depth/points
    marking: true
    clearing: true
    obstacle_range: 3.0
    min_obstacle_height: 0.0
    max_obstacle_height: 2.0
    expected_update_rate: 0.0
    observation_persistence: 0.0
    inf_is_valid: false
    filter: "voxel"
    voxel_min_points: 0
    clear_after_reading: true
    max_z: 7.0
    min_z: 0.1
    vertical_fov_angle: 0.8745
    horizontal_fov_angle: 1.048
    decay_acceleration: 15.0
    model_type: 0
```

Please copy-paste the text above, with the `plugin_names` and `plugin_types` registration, into your `nav2_params.yaml` to enable STVL in your application.
Make sure to change both the local and global costmaps.

Note: Pluginlib plugins for other Navigation2 servers such as planning, behavior, and control can be set in this same way.

###### 2- Launch Navigation2

Follow the same process as in [Getting Started](../../getting_started/index.html#getting-started) to launch a simulated robot in gazebo with Navigation2.
Navigation2 is now using STVL as its 3D sensing costmap layer.

###### 3- RVIZ

With RViz open and `publish_voxel_map: true`, you can visualize the underlying data structure’s 3D grid using the `{local, global}_costmap/voxel_grid` topics.
Note: It is recommended in RViz to set the `PointCloud2` Size to your voxel size and the style to `Boxes` with a neutral color for best visualization.

---

#### Using Collision Monitor

*Source: [https://docs.nav2.org/tutorials/docs/using_collision_monitor.html](https://docs.nav2.org/tutorials/docs/using_collision_monitor.html)*

##### Using Collision Monitor

* [Overview](#overview)
* [Requirements](#requirements)
* [Preparing Nav2 stack](#preparing-nav2-stack)
* [Configuring Collision Monitor](#configuring-collision-monitor)
* [Configuring Collision Monitor with VelocityPolygon](#configuring-collision-monitor-with-velocitypolygon)
* [Demo Execution](#demo-execution)

[![../../_images/collision_monitor.gif](../../_images/collision_monitor.gif)](../../_images/collision_monitor.gif)

###### Overview

This tutorial shows how to use a Collision Monitor with Nav2 stack. Based on this tutorial, you can setup it for your environment and needs.

###### Requirements

It is assumed ROS2 and Nav2 dependent packages are installed or built locally.
Please make sure that Nav2 project is also built locally as it was made in [Build and Install](../../development_guides/build_docs/index.html#build-instructions).

###### Configuring Collision Monitor

The Collision Monitor node has its own `collision_monitor_node.launch.py` launch-file and preset parameters in the `collision_monitor_params.yaml` file for demonstration, though its trivial to add this to Nav2’s main launch file if being used in practice.
For the demonstration, two shapes will be created - an inner stop and a larger slowdown bounding boxes placed in the front of the robot:

[![../../_images/polygons.png](../../_images/polygons.png)](../../_images/polygons.png)

If more than 3 points will appear inside a slowdown box, the robot will decrease its speed to `30%` from its value.
For the cases when obstacles are dangerously close to the robot, inner stop zone will work.
For this setup, the following lines should be added into `collision_monitor_params.yaml` parameters file. Stop box is named as `PolygonStop` and slowdown bounding box - as `PolygonSlow`:

```
polygons: ["PolygonStop", "PolygonSlow"]
PolygonStop:
  type: "polygon"
  points: "[[0.4, 0.3], [0.4, -0.3], [0.0, -0.3], [0.0, 0.3]]"
  action_type: "stop"
  min_points: 4  # max_points: 3 for Humble
  visualize: True
  polygon_pub_topic: "polygon_stop"
PolygonSlow:
  type: "polygon"
  points: "[[0.6, 0.4], [0.6, -0.4], [0.0, -0.4], [0.0, 0.4]]"
  action_type: "slowdown"
  min_points: 4  # max_points: 3 for Humble
  slowdown_ratio: 0.3
  visualize: True
  polygon_pub_topic: "polygon_slowdown"
```

Note

The circle shape could be used instead of polygon, e.g. for the case of omni-directional robots where the collision can occur from any direction. However, for the tutorial needs, let’s focus our view on polygons. For the same reason, we leave out of scope the Approach model. Both of these cases could be easily enabled by referencing to the [Collision Monitor](../../configuration/packages/configuring-collision-monitor.html#configuring-collision-monitor) configuration guide.

Note

Both polygon shapes in the tutorial were set statically. However, there is an ability to dynamically adjust them over time using topic messages containing vertices points for polygons or footprints. For more information, please refer to the configuration guide.

For the working configuration, at least one data source should be added.
In current demonstration, it is used laser scanner (though `PointCloud2` and Range/Sonar/IR sensors are also possible), which is described by the following lines for Collision Monitor node:

```
observation_sources: ["scan"]
scan:
  type: "scan"
  topic: "scan"
```

Set topic names, frame ID-s and timeouts to work correctly with a default Nav2 setup.
The whole `nav2_collision_monitor/params/collision_monitor_params.yaml` file in this case will look as follows:

```
collision_monitor:
  ros__parameters:
    enabled: True
    base_frame_id: "base_footprint"
    odom_frame_id: "odom"
    cmd_vel_in_topic: "cmd_vel_smoothed"
    cmd_vel_out_topic: "cmd_vel"
    transform_tolerance: 0.5
    source_timeout: 5.0
    stop_pub_timeout: 2.0
    enable_stamped_cmd_vel: True # False for Jazzy or older by default
    polygons: ["PolygonStop", "PolygonSlow"]
    PolygonStop:
      type: "polygon"
      points: "[[0.4, 0.3], [0.4, -0.3], [0.0, -0.3], [0.0, 0.3]]"
      action_type: "stop"
      min_points: 4  # max_points: 3 for Humble
      visualize: True
      polygon_pub_topic: "polygon_stop"
    PolygonSlow:
      type: "polygon"
      points: "[[0.6, 0.4], [0.6, -0.4], [0.0, -0.4], [0.0, 0.4]]"
      action_type: "slowdown"
      min_points: 4  # max_points: 3 for Humble
      slowdown_ratio: 0.3
      visualize: True
      polygon_pub_topic: "polygon_slowdown"
    observation_sources: ["scan"]
    scan:
      type: "scan"
      topic: "scan"
```

###### Configuring Collision Monitor with VelocityPolygon

[![../../_images/dexory_velocity_polygon.gif](../../_images/dexory_velocity_polygon.gif)](../../_images/dexory_velocity_polygon.gif)

For this part of tutorial, we will set up the Collision Monitor with `VelocityPolygon` type for a `stop` action. `VelocityPolygon` allows the user to setup multiple polygons to cover the range of the robot’s velocity limits. For example, the user can configure different polygons for rotation, moving forward, or moving backward. The Collision Monitor will check the robot’s velocity against each sub polygon to determine the appropriate polygon to be used for collision checking.

In general, here are the steps to configure the Collision Monitor with `VelocityPolygon` type:

1. Add a `VelocityPolygon` to the `polygons` param list
2. Configure the `VelocityPolygon`
3. Specify the `holonomic` property of the polygon (default is `false`)
4. Start by adding a `stopped` sub polygon to cover the full range of the robot’s velocity limits in `velocity_polygons` list
5. Add additional sub polygons to the front of the `velocity_polygons` list to cover the range of the robot’s velocity limits for each type of motion (e.g. rotation, moving forward, moving backward)

In this example, we will consider a **non-holonomic** robot with linear velocity limits of `-1.0` to `1.0` m/s and angular velocity limits of `-1.0` to `1.0` rad/s. The `linear_min` and `linear_max` parameters of the sub polygons should be set to the robot’s linear velocity limits, while the `theta_min` and `theta_max` parameters should be set to the robot’s angular velocity limits.

Below is the example configuration using 4 sub-polygons to cover the full range of the robot’s velocity limits:

```
polygons: ["VelocityPolygonStop"]
VelocityPolygonStop:
  type: "velocity_polygon"
  action_type: "stop"
  min_points: 6
  visualize: True
  enabled: True
  polygon_pub_topic: "velocity_polygon_stop"
  velocity_polygons: ["rotation", "translation_forward", "translation_backward", "stopped"]
  holonomic: false
  rotation:
    points: "[[0.3, 0.3], [0.3, -0.3], [-0.3, -0.3], [-0.3, 0.3]]"
    linear_min: 0.0
    linear_max: 0.05
    theta_min: -1.0
    theta_max: 1.0
  translation_forward:
    points: "[[0.35, 0.3], [0.35, -0.3], [-0.2, -0.3], [-0.2, 0.3]]"
    linear_min: 0.0
    linear_max: 1.0
    theta_min: -1.0
    theta_max: 1.0
  translation_backward:
    points: "[[0.2, 0.3], [0.2, -0.3], [-0.35, -0.3], [-0.35, 0.3]]"
    linear_min: -1.0
    linear_max: 0.0
    theta_min: -1.0
    theta_max: 1.0
  # This is the last polygon to be checked, it should cover the entire range of robot's velocities
  # It is used as the stopped polygon when the robot is not moving and as a fallback if the velocity
  # is not covered by any of the other sub-polygons
  stopped:
    points: "[[0.25, 0.25], [0.25, -0.25], [-0.25, -0.25], [-0.25, 0.25]]"
    linear_min: -1.0
    linear_max: 1.0
    theta_min: -1.0
    theta_max: 1.0
```

Note

It is recommended to include a `stopped` sub polygon as the last entry in the `velocity_polygons` list to cover the entire range of the robot’s velocity limits. In cases where the velocity is not within the scope of any sub polygons, the Collision Monitor will log a warning message and continue with the previously matched polygon.

Note

When velocity is covered by multiple sub polygons, the first sub polygon in the list will be used.

**For holomic robots:**

For holomic robots, the `holonomic` property should be set to `true`. In this scenario, the `linear_min` and `linear_max` parameters should cover the robot’s resultant velocity limits, while the `theta_min` and `theta_max` parameters should cover the robot’s angular velocity limits. Additionally, there will be 2 more parameters, `direction_start_angle` and `direction_end_angle`, to specify the resultant velocity direction. The covered direction will always span from `direction_start_angle` to `direction_end_angle` in the **counter-clockwise** direction.

[![../../_images/holonomic_direction.png](../../_images/holonomic_direction.png)](../../_images/holonomic_direction.png)

Below shows some common configurations for holonomic robots that cover multiple directions of the resultant velocity:

[![../../_images/holonomic_examples1.png](../../_images/holonomic_examples1.png)](../../_images/holonomic_examples1.png)

###### Preparing Nav2 stack

The Collision Monitor is designed to operate below Nav2 as an independent safety node.
It acts as a filter for the `cmd_vel` messages from the controller to avoid potential collisions.
If no such zone is triggered, then the `cmd_vel` message is used.
Else, it is scaled or set to stop as appropriate.

By default, the Collision Monitor is configured for usage with the Nav2 bringup package, running in parallel with the `navigation_launch.py` launch file. For correct operation of the Collision Monitor with the Velocity Smoother, it is required to remove the Velocity Smoother’s `cmd_vel_smoothed` remapping in the `navigation_launch.py` bringup script as presented below. This will make the output topic of the Velocity Smoother to be untouched, which will be the input to the newly added Collision Monitor:

```
Node(
    package='nav2_velocity_smoother',
    executable='velocity_smoother',
    name='velocity_smoother',
    output='screen',
    respawn=use_respawn,
    respawn_delay=2.0,
    parameters=[configured_params],
    arguments=['--ros-args', '--log-level', log_level],
    remappings=remappings +
-           [('cmd_vel', 'cmd_vel_nav'), ('cmd_vel_smoothed', 'cmd_vel')]),
+           [('cmd_vel', 'cmd_vel_nav')]),
...
ComposableNode(
    package='nav2_velocity_smoother',
    plugin='nav2_velocity_smoother::VelocitySmoother',
    name='velocity_smoother',
    parameters=[configured_params],
    remappings=remappings +
-              [('cmd_vel', 'cmd_vel_nav'), ('cmd_vel_smoothed', 'cmd_vel')]),
+              [('cmd_vel', 'cmd_vel_nav')]),
```

If you have changed Collision Monitor’s default `cmd_vel_in_topic` and `cmd_vel_out_topic` configuration, make sure Velocity Smoother’s default output topic `cmd_vel_smoothed` should match to the input velocity `cmd_vel_in_topic` parameter value of the Collision Monitor node, and the output velocity `cmd_vel_out_topic` parameter value should be actual `cmd_vel` to fit the replacement.

Note

As the Collision Monitor acts as a safety node, it must be the last link in the velocity message post-processing chain, making it the node that publishes to the `cmd_vel` topic. It could be placed after smoothed velocity, as in our demonstration, or after non-smoothed velocity from Controller Server, e.g. if Velocity Smoother was not enabled in the system, or going after any other module in custom configuration producing the end-velocity. Therefore, in any custom Nav2 launch configuration, the last node publishing to the `cmd_vel` topic, should be remapped to publish to the Collision Monitor input topic configured by `cmd_vel_in_topic` ROS-parameter (`cmd_vel_smoothed` by default).

###### Demo Execution

Once Collision Monitor node has been tuned and `cmd_vel` topics adjusted, Collision Monitor node is ready to run.
For that, run Nav2 stack as written in [Getting Started](../../getting_started/index.html#getting-started):

```
ros2 launch nav2_bringup tb3_simulation_launch.py headless:=False
```

In parallel console, launch Collision Monitor node by using its launch-file:

```
ros2 launch nav2_collision_monitor collision_monitor_node.launch.py
```

Since both `PolygonStop` and `PolygonSlow` polygons will have their own publishers, they could be added to visualization as shown at the picture below:

[![../../_images/polygons_visualization.png](../../_images/polygons_visualization.png)](../../_images/polygons_visualization.png)

Set the initial pose and then put Nav2 goal on map.
The robot will start its movement, slowing down while running near the obstacles, and stopping in close proximity to them:

[![../../_images/collision.png](../../_images/collision.png)](../../_images/collision.png)

---

#### Using Docking Server

*Source: [https://docs.nav2.org/tutorials/docs/using_docking.html](https://docs.nav2.org/tutorials/docs/using_docking.html)*

##### Using Docking Server

* [Overview](#overview)
* [Requirements](#requirements)
* [ChargingDock Plugins](#chargingdock-plugins)
* [Dock Database](#dock-database)
* [Configuring Docking Server](#configuring-docking-server)
* [Adding Docking Server to Launch](#adding-docking-server-to-launch)
* [Putting It All Together](#putting-it-all-together)

###### Overview

This tutorial shows how to use the Docking Server with Nav2 robot systems.
The Docking Server is a general framework which can be used with arbitrary types of robots and docks in order to auto-dock them.
This is accomplished via plugins `ChargingDock` and `NonChargingDock` which implement the dock specifics like detecting the pose of the dock using sensor data, how to detect when the robot is in contact with the dock, and when charging has successfully started.
A configuration of the docking server can contain a database of many docks of different plugin `ChargingDock` and `NonChargingDock` types to handle a broad range of docking locations and hardware dock revisions.
Included with the package is an example `SimpleChargingDock` and `SimpleNonChargingDock` plugins which contains features and methods very common for robot docking.
These support charging stations and docking with static infrastructure (ex. conveyor belts) or dynamic docking (ex pallets) locations.
It is likely that you may be able to use this as well rather than developing your own dock plugin to get started.

The docking procedure is as follows:

1. Take action request and obtain the dock’s plugin and its pose
2. If the robot is not within the prestaging tolerance of the dock’s staging pose, navigate to the staging pose
3. Use the dock’s plugin to initially detect the dock and return the docking pose
4. Enter a vision-control loop where the robot attempts to reach the docking pose while its actively being refined by the vision system
5. Exit the vision-control loop once contact has been detected or charging has started
6. Wait until charging starts (if applicable) and return success.

Thanks to NVIDIA for sponsoring this Docking Server package and this tutorial!
You can find how to dock your Nova Carter robot using Nav2 and this work in the [nova\_carter\_docking package](https://github.com/open-navigation/opennav_docking/tree/main/nova_carter_docking)!


###### Requirements

It is assumed ROS2 and Nav2 dependent packages are installed or built locally - including `opennav_docking`.
Please make sure that Nav2 project is also built locally, see [Build and Install](../../development_guides/build_docs/index.html#build-instructions) for reference.

See `opennav_docking` README for complete concept explanations, parameters, and APIs.

###### ChargingDock Plugins

`opennav_docking_core::ChargingDock` and `opennav_docking_core::NonChargingDock` plugins are established to abstract out robot- and dock-specifics from the generalized framework.
This allows a system to leverage this framework and provide its own methods for detecting the dock’s current pose, when the robot is charging, and when contact is made.
Luckily, there are several common ROS APIs that allow us to create semi-generalized `SimpleChargingDock` and `SimpleNonChargingDock` plugins that allows out-of-the-box docking as long as users provide `JointState`, `BatteryState`, and detected dock pose `PoseStamped` topics.
However, one way or another, your system requires an applicable `ChargingDock` or `NonChargingDock` plugin for each type of dock you wish to use.

The plugins has a few key APIs:

* `PoseStamped getStagingPose(const Pose & pose, const string & frame)` which must provide the pre-docking staging pose given a dock’s location and frame.
* `bool getRefinedPose(PoseStamped & pose)` which must provide the detected (or pass through) pose of the dock
* `bool isDocked()` which provides if we’ve made contact with the dock
* `bool isCharging()` which provides if we’ve started charging while docked (charging docks only)
* `bool disableCharging()` which should disable charging, if under the robot’s control for undocking (charging docks only)
* `bool hasStoppedCharging()` which indicates if we’ve successfully stopped charging on undocking (charging docks only)
* `bool isCharger()` which indicates if this is a charging-typed dock
* `DockDirection getDockDirection()` which indicates the direction of the dock (if the robot should drive forwards, backwards, etc onto the dock)
* `bool shouldRotateToDock()` which indicates if the robot should rotate to dock (for example, to perform a backward docking without detections)

The `SimpleChargingDock` provides an implementation with common options for these APIs:

* `getStagingPose` - Finds a relative offset pose with translation and rotation from the dock’s pose
* `getRefinedPose` - Filters a detected pose topic of type `PoseStamped` into the fixed frame *or* is a pass through function returning the dock’s database location if detection is not enabled
* `isDocked` - Returns as dock if a pose tolerance is met relative to the dock *or* if the `JointStates` of the motors detect a clear spike due to stalling by driving into the dock’s surface, if enabled
* `isCharging` - Returns charging if `isDocked` *or* if `BatteryState`’s current is above a threshold, if enabled (charging docks only)
* `disableCharging` - Always `true`, considers disable of charging as automatic when robot leaves dock (charging docks only)
* `hasStoppedCharging` - The inverse of `isCharging` (charging docks only)

Thus, for testing (no detection, no battery information, no joint state information) and realistic application (dock detection, battery status information, joint state information), this dock plugin can be used.
It can also be used when only some of the information if available as well.
If your robot or dock does not fall into these implementations (i.e. using custom battery or detection messages that cannot be converted into ROS standard types), then you may be required to build your own plugin to meet your particular needs.
However, you can use the `SimpleChargingDock` assuming you turn off these settings and dock blind to get started.
There is an equivalent `SimpleNonChargingDock` plugin for non-charging docking needs.

If you do not currently have a way to detect your dock, dock detection can be done easily using Apriltags and the [isaac\_ros\_apriltag](https://github.com/NVIDIA-ISAAC-ROS/isaac_ros_apriltag) or [ROS image\_proc](https://github.com/ros-perception/image_pipeline/blob/rolling/image_proc/src/track_marker.cpp) nodes to get started.
Use the Isaac ROS if using a Jetson platform to obtain a GPU optimized pipeline with your camera feeds.
The defaults support this out of the box, see `nova_carter_docking` for an example.

Note

It is important to note that you should provide detected dock poses, battery status information for charging, and motor controller efforts for the highest quality and reliable docking for production use.

###### Dock Database

To dock your robot, you must provide the set of docks in your environment you’d like to utilize.
This is done in the docking server via the *Dock Database* which contains the set of docks, their instance types, and a set of shared plugins.
The plugins are separated from the dock instances so that many instances can share the same plugin to save on memory and networking overhead when potentially dozens or more docks exist in a space.

The docks plugins must be provided in your docking server’s configuration file.
However, the dock instance may be provided either in the configuration file *or* within a provided filepath to decouple the server’s configuration from a particular application environment.
The example below shows an inline configuration of the docking plugins and dock instances where one dock type (`nova_carter_dock`) is specified with 3 individual instances: a home dock, and 2 general shared fallback docks.
The docks can be specified as `[x, y, theta]` in any reference frame you like, as long as TF is aware of them.
Please update these with your own docking plugin and dock locations in your map.

```
docking_server:
  ros__parameters:
    # Types of docks
    dock_plugins: ['nova_carter_dock']
    nova_carter_dock:
      plugin: 'opennav_docking::SimpleChargingDock'
      # More parameters exist here that we will discuss later in the tutorial

    # Dock instances
    docks: ['home_dock','flex_dock1', 'flex_dock2']
    home_dock:
      type: 'nova_carter_dock'
      frame: map
      pose: [0.0, 0.0, 0.0]
    flex_dock1:
      type: 'nova_carter_dock'
      frame: map
      pose: [10.0, 10.0, 0.0]
    flex_dock2:
      type: 'nova_carter_dock'
      frame: map
      pose: [30.0, 30.0, 0.0]

    # Or use
    # dock_database: /my/path/to/dock_database.yaml
```

The analog of this is shown below as an independent `dock_database.yaml` which can be provided to the `docking_server` via the `dock_database` parameter.

```
docks:
  home_dock:
    type: "nova_carter_dock"
    frame: "map"
    pose: [0.0, 0.0, 0.0]
  flex_dock1:
    type: "nova_carter_dock"
    frame: "map"
    pose: [10.0, 10.0, 0.0]
  flex_dock2:
    type: "nova_carter_dock"
    frame: "map"
    pose: [20.0, 20.0, 0.0]
```

Note that you are required to provide at least 1 dock plugin and 1 dock instance.
The Docking Server’s Action API can take in a dock’s instance information separately to bypass the database, but its plugin must exist in the server’s configuration.
If you plan to only use this API, you can set a `dummy_dock`.
Generally speaking, its wise to set your docks in the database and use the Docking Server’s API to dock at an instance’s Dock ID to decouple the semantic information about docks from the action request (requiring your application instead to have all of the docks’ locations), but bypassing the database can be useful for testing and movable docking targets.

The dock poses in the map can be annotated using your favorite map editing tools, obtained by `/clicked_point` in rviz2, or measured location.

###### Configuring Docking Server

Now that we have both a plugin for interacting with a dock and specified the locations of docks in your map, we’re ready to configure the docking server.
For this example, we’re going to use the Nvidia-Segway Nova Carter Robot and you can find the source code of this demo in the `nova_carter_docking` package.
For a full list of parameters and their descriptions, check out the [Docking Server](../../configuration/packages/configuring-docking-server.html#configuring-docking-server).

Below is an example configuration used by the Nova Carter robot.
Notable is the setting of the `fixed_frame` to `odom`, not `map` in order to decouple localization error from the docking procedure.
We also use one dock plugin `nova_carter_dock` for all `N` docks specified in the `dock_database` file.

The simple charging dock plugin uses a 70cm staging offset from the dock’s database pose for staging.
This staging pose is selected as close enough to detect the dock but far enough away to give maneuvering space to account for expected dock movement or localization error.

Since `use_stall_detection` for the `JointStates` is `false`, we are considered successfully docked once we’re within `docking_threshold` (5cm) to the docking pose.
This docking pose is specified as the detected pose with the `external_detection_*` offsets applied to account for the robot’s intended docking pose relative to the detected feature.
In this example, Apriltags are used, so we apply the rotations to the Apriltag detected frame and a `-0.18` translational offset to account for the pose the robot should be in when docked relative to the tag’s pose.
Since `use_external_detection_pose` and `use_battery_status` are both enabled, we use both detected dock poses (apriltag) and battery state information for determining if we’re charging.

The maximum speed is 15 cm/s to slowly and carefully back into the dock and we’ll retry docking 3x in case charging is not detected or we lose detected dock tracks during the attempt.

```
docking_server:
  ros__parameters:
    controller_frequency: 50.0
    initial_perception_timeout: 5.0
    wait_charge_timeout: 5.0
    dock_approach_timeout: 30.0
    undock_linear_tolerance: 0.05
    undock_angular_tolerance: 0.1
    max_retries: 3
    base_frame: "base_link"
    fixed_frame: "odom"
    dock_backwards: false
    dock_prestaging_tolerance: 0.5

    # Types of docks
    dock_plugins: ['nova_carter_dock']
    nova_carter_dock:
      plugin: 'opennav_docking::SimpleChargingDock'
      docking_threshold: 0.05
      staging_x_offset: -0.7
      use_external_detection_pose: true
      use_battery_status: true
      use_stall_detection: false

      external_detection_timeout: 1.0
      external_detection_translation_x: -0.18
      external_detection_translation_y: 0.0
      external_detection_rotation_roll: -1.57
      external_detection_rotation_pitch: -1.57
      external_detection_rotation_yaw: 0.0
      filter_coef: 0.1

    # Sep. file of dock instances so config file can be used in multiple locations
    dock_database: /my/path/to/dock_database.yaml

    controller:
      k_phi: 3.0
      k_delta: 2.0
      v_linear_min: 0.15
      v_linear_max: 0.15
```

###### Adding Docking Server to Launch

This server can now be added to your launch file with the path to this parameter file for use (or added to your main shared configuration file).

```
nova_carter_dock_params_dir = os.path.join(
        get_package_share_directory('nova_carter_docking'), 'params')
params_file = default_value=os.path.join(nova_carter_dock_params_dir, 'nova_carter_docking.yaml')

docking_server = Node(
    package='opennav_docking',
    executable='opennav_docking',
    name='docking_server',
    output='screen',
    parameters=[params_file],
)
```

Note

The Docking Server is also a composible node like others in Nav2, so you may also launch it within the Nav2 process using `LoadComposableNodes/ComposableNode`.

###### Docking Action API

The API for docking and undocking is comparatively simple.

The `DockRobot` action consists of two main modalities: using the dock database or specifying a dock to use in the action.
If using the database, set `use_dock_id = True` (default) and you only need to specify the `dock_id` you wish to use, such as `home_dock`, `flex_dock1`, or whatever dock instance you like.
If bypassing the database, `use_dock_id` must be set to false and `dock_pose`, `dock_type` must be fully specified to make up for the lack of entry metadata in the database.
This requires the action caller to know about all of the docks, rather than pushing that into the Docking Server’s database, which is not recommended.

Optionally, you can disable using Nav2 to navigate to the staging pose if outside of the pre-staging tolerance using `navigate_to_staging_pose = False` or set the maximum time for staging navigation `max_staging_time`.

```
#goal definition
bool use_dock_id True  # Whether to use the dock_id or dock_pose fields
string dock_id  # Dock name or ID to dock at, from given dock database

geometry_msgs/PoseStamped dock_pose  # Dock pose
string dock_type  # If using dock_pose, what type of dock it is. Not necessary if only using one type of dock.

float32 max_staging_time 1000.0  # Maximum time for navigation to get to the dock's staging pose.
bool navigate_to_staging_pose True  # Whether or not to navigate to staging pose or assume robot is already at staging pose within tolerance to execute behavior

---
#result definition
bool success True  # docking success status
uint16 error_code 0  # Contextual error code, if any
uint16 num_retries 0  # Number of retries attempted

---
#feedback definition
uint16 state  # Current docking state
builtin_interfaces/Duration docking_time  # Docking time elapsed
uint16 num_retries 0  # Number of retries attempted
```

In result, you obtain if the action was successful, if it wasn’t what the error code was, and the total number of retries attempted.
During execution, feedback is provided on the current docking state - which is published irregularly only when an event occurs. It contains the state, the current total elapsed duration of attempted docking, and the current number of retries.
The feedback can be obtained from your action client if this information is useful to your application.

The `UndockRobot` action is even simpler. There are no required goal fields except `dock_type` if undocking is being called when the server’s instance did not dock the robot to store its current state information (such as after a restart on the dock).
It contains no feedback and returns the `success` state and the `error_code` if a problem occurs.

```
#goal definition
string dock_type
float32 max_undocking_time 30.0 # Maximum time to undock

---
#result definition
bool success True  # docking success status
uint16 error_code 0  # Contextual error code, if any

---
#feedback definition
```

###### Putting It All Together

At this point, if you haven’t already, create your dock plugin (or use `SimpleChargingDock`), configuration file, and launch file - along with any other nodes required like apriltags or other detectors.
You can see an example package used in this tutorial in the `nova_carter_docking` package, which contains a configuration file and launch file containing the apriltags detector and `PoseStamped` pose publisher.

If you’re interested in using Apriltags and an Nvidia Jetson, you can find the tags we used in the `media/` directory and the launch file `isaac_apriltag_detection_pipeline.launch.py` which sets it all up for you.
If not using the Jetson, you can replace the Isaac ROS apriltag detector with `image_proc`.

We can test this using the script `demo.py` in `nova_carter_docking`’s root directory.
It will set the robot’s pose as virtually the dock’s staging pose to bypass navigating to the staging pose and attempt docking immediately, then infinitely loop docking and undocking in a row.
This is a useful first-time setup to try docking, refine your detection offsets, and obtain reliability metrics of your complete system.
See the video below of this all at work!


Note that the robot is able to overcome:

* Large distances away from the dock staging pose, as long as the dock was in view
* Able to detect the dock’s offsets and compute controls to dock successfully - including when we manually move it during and between runs
* Dock repeatedly with a 100% success rate due to the detections and charging state feedback

This script demonstrates the essential use of the Docking Server.
However, it does not use the dock database of pre-mapped dock locations that you setup.
After you launch Nav2 and localize your robot in your map, we can adjust `dockRobot()` to take in your desired `dock_id` and perform docking instead:
Then, we can see the full docking system in action in a non-trivial environment!

```
def dockRobot(self, dock_id = ""):
    """Send a `DockRobot` action request."""
    print("Waiting for 'DockRobot' action server")
    while not self.docking_client.wait_for_server(timeout_sec=1.0):
        print('"DockRobot" action server not available, waiting...')

    goal_msg = DockRobot.Goal()
    goal_msg.use_dock_id = True
    goal_msg.dock_id = dock_id  # if wanting to use ID instead

    print('Docking at ID: ' + str(dock_id) + '...')
    send_goal_future = self.docking_client.send_goal_async(goal_msg,
                                                            self._feedbackCallback)
    rclpy.spin_until_future_complete(self, send_goal_future)
    self.goal_handle = send_goal_future.result()

    if not self.goal_handle.accepted:
        print('Docking request was rejected!')
        return False

    self.result_future = self.goal_handle.get_result_async()
    return True

...

dock_id = 'home_dock'
tester.dockRobot(dock_id)
```


Depending on your robot’s relative pose to the dock and your pre-staging tolerance settings, Nav2 may attempt to navigate to the staging pose before docking.
If you wish to disable that, set `goal_msg.navigate_to_staging_pose = False` and then Docking will trigger immediately.
You can see both of these in action in the video above.

Don’t want to call Docking Server from a script Python or C++ script and want to use it in your Autonomous Behavior Tree? See `opennav_docking_bt` for `DockRobot`, `UndockRobot` Behavior Tree nodes to call the Docking Server from your application behavior tree – with a provided `XML` example.
Note that if using `navigate_to_staging_pose = True`, you cannot call `DockRobot` from inside a Nav2 Behavior Tree, only from your higher level autonomy tree since it recursively calls Nav2.
If you wish to call `DockRobot` from inside your Nav2 BT, you must roughly pre-stage the robot near the dock first (which should be easy as a navigation goal).
However, you can always call `UndockRobot` from any behavior tree!

Happy docking!

---

#### Using Rotation Shim Controller

*Source: [https://docs.nav2.org/tutorials/docs/using_shim_controller.html](https://docs.nav2.org/tutorials/docs/using_shim_controller.html)*

##### Using Rotation Shim Controller

* [Overview](#overview)
* [What is the Rotation Shim Controller?](#what-is-the-rotation-shim-controller)
* [Configuring Rotation Shim Controller](#configuring-rotation-shim-controller)
* [Configuring Primary Controller](#configuring-primary-controller)
* [Demo Execution](#demo-execution)

###### Overview

This tutorial will discuss how to set up your robot to use the `RotationShimController` to help create intuitive, rotate-in-place, behavior for your robot while starting out to track a path. The goal of this tutorial is to explain to the reader the value of the controller, how to configure it, how to configure the primary controller with it, and finally an example of it in use.

Before starting this tutorial, completing the [Getting Started](../../getting_started/index.html#getting-started) is highly recommended especially if you are new to ROS and Nav2. The requirements are having the latest install of Nav2 / ROS 2 containing this package.

###### What is the Rotation Shim Controller?

This was developed due to quirks in TEB and DWB, but applicable to any other controller plugin type that you’d like to have rotation in place behavior with. `TEB`’s behavior tends to whip the robot around with small turns, or when the path is starting at a very different heading than current, in a somewhat surprising way due to the elastic band approach. `DWB` can be tuned to have any type of behavior, but typically to tune it to be an excellent path follower also makes it less optimally capable of smooth transitions to new paths at far away headings – there are always trade offs. Giving both TEB and DWB a better starting point to start tracking a path makes tuning the controllers significantly easier and creates more intuitive results for on-lookers.

Note that it is not required to use this with **any** plugin. Many users are perfectly successful without using this controller, but if a robot may rotate in place before beginning its path tracking task (or others), it can be advantageous to do so.

The `nav2_rotation_shim_controller` will check the rough heading difference with respect to the robot and a newly received path. If within a threshold, it will pass the request onto the `primary_controller` to execute the task. If it is outside of the threshold, this controller will rotate the robot in place towards that path heading. Once it is within the tolerance, it will then pass off control-execution from this rotation shim controller onto the primary controller plugin. At this point, the robot’s main plugin will take control for a smooth hand off into the task.

The `RotationShimController` is most suitable for:

* Robots that can rotate in place, such as differential and omnidirectional robots.
* Preference to rotate in place when starting to track a new path that is at a significantly different heading than the robot’s current heading – or when tuning your controller for its task makes tight rotations difficult.
* Using planners that are non-kinematically feasible, such as NavFn, Theta\*, or Smac 2D (Feasible planners such as Smac Hybrid-A\* and State Lattice will start search from the robot’s actual starting heading, requiring no rotation since their paths are guaranteed drivable by physical constraints).

Note

Regulated Pure Pursuit has this built in so it is not necessary to pair with RPP. However, it is applicable to all others. See [Navigation Plugins](../../plugins/index.html#plugins) for a full list of current controller plugins.

###### Configuring Rotation Shim Controller

This controller is a *shim* because it is placed between the primary controller plugin and the controller server. It takes commands and pre-processes them to rotate to the heading and then passes off execution-control to the primary plugin once that condition is met - acting as a simple pass through.

As such, its configuration looks very similar to that of any other plugin. In the code block below, you can see that we’ve added the `RotationShimController` as the plugin for path tracking in the controller server. You can see that we’ve also configured it below with its internal parameters, `angular_dist_threshold` through `max_angular_accel`.

```
controller_server:
  ros__parameters:
    controller_frequency: 20.0
    min_x_velocity_threshold: 0.001
    min_y_velocity_threshold: 0.5
    min_theta_velocity_threshold: 0.001
    progress_checker_plugins: ["progress_checker"] # progress_checker_plugin: "progress_checker" For Humble and older
    goal_checker_plugins: ["goal_checker"]
    controller_plugins: ["FollowPath"]
    progress_checker:
      plugin: "nav2_controller::SimpleProgressChecker"
      required_movement_radius: 0.5
      movement_time_allowance: 10.0
    goal_checker:
      plugin: "nav2_controller::SimpleGoalChecker"
      xy_goal_tolerance: 0.25
      yaw_goal_tolerance: 0.25
      stateful: True
    FollowPath:
      plugin: "nav2_rotation_shim_controller::RotationShimController"
      angular_dist_threshold: 0.785
      forward_sampling_distance: 0.5
      rotate_to_heading_angular_vel: 1.8
      max_angular_accel: 3.2
      simulate_ahead_time: 1.0
```

The Rotation Shim Controller is very simple and only has a couple of parameters to dictate the conditions it should be enacted.

* `angular_dist_threshold`: The angular distance (in radians) apart from the robot’s current heading and the approximated path heading to trigger the rotation behavior. Once the robot is within this threshold, control is handed over to the primary controller plugin.
* `forward_sampling_distance`: The distance (in meters) away from the robot to select a point on the path to approximate the path’s starting heading at. This is analogous to a “lookahead” point.
* `rotate_to_heading_angular_vel`: The angular velocity (in rad/s) to have the robot rotate to heading by, when the behavior is enacted.
* `max_angular_accel`: The angular acceleration (in rad/s/s) to have the robot rotate to heading by, when the behavior is enacted.
* `simulate_ahead_time`: The Time (s) to forward project the rotation command to check for collision

###### Configuring Primary Controller

There is one more remaining parameter of the `RotationShimController` not mentioned above, the `primary_controller`. This is the type of controller that your application would like to use as the primary modus operandi. It will share the same name and yaml namespace as the shim plugin. You can observe this below with the primary controller set the `DWB` (with the progress and goal checkers removed for brevity).

```
controller_server:
  ros__parameters:
    controller_frequency: 20.0
    min_x_velocity_threshold: 0.001
    min_y_velocity_threshold: 0.5
    min_theta_velocity_threshold: 0.001
    controller_plugins: ["FollowPath"]
    FollowPath:
      plugin: "nav2_rotation_shim_controller::RotationShimController"
      primary_controller: "dwb_core::DWBLocalPlanner"
      angular_dist_threshold: 0.785
      forward_sampling_distance: 0.5
      rotate_to_heading_angular_vel: 1.8
      max_angular_accel: 3.2
      simulate_ahead_time: 1.0

      # DWB parameters
      ...
      ...
      ...
```

An important note is that **within the same yaml namespace**, you may also include any `primary_controller` specific parameters required for a robot. Thusly, after `max_angular_accel`, you can include any of `DWB`’s parameters for your platform.

###### Demo Execution

---

#### Using VIO to Augment Robot Odometry

*Source: [https://docs.nav2.org/tutorials/docs/integrating_vio.html](https://docs.nav2.org/tutorials/docs/integrating_vio.html)*

##### Using VIO to Augment Robot Odometry

* [Overview](#overview)
* [Setting Up the ZED X Camera](#setting-up-the-zed-x-camera)
* [Setting Up ZED ROS](#setting-up-zed-ros)
* [Fusing VIO Into Local State Estimate](#fusing-vio-into-local-state-estimate)
* [Fusing VSLAM Into Global State Estimate](#fusing-vslam-into-global-state-estimate)

###### Overview

This tutorial highlights how to setup Visual-Inerial Odometry (VIO) into a Nav2 and ROS 2 based robotics system to augment robot odometry.

Many modern robotics platforms have unideal configurations for high quality wheel odometry. For example, skid-steer, tracked, omnidirectional robots using mecanum wheels, and legged robots are notorious for producing suboptimal odometry. These types of platforms are becoming increasingly common in the robotics landscape and require augmentations or replacement sources of odometry. Further, some applications of robotics technologies involve retrofitting existing equipment which may not have odometry altogether.

A subfield of computer vision and robotics focuses on how to use Visual (e.g. camera) and Inertial (e.g. IMU) data in order to compute high-speed relative motion independent of robot mechanics. This is an especially useful technology for UAVs without accurate intrinsic odometric sensing capabilities – or mobile robots with poor interinsic odometry measurements.

Thus, this tutorial walks through the integration of VIO into a robot system to replace or augment wheel odometry so that your robot can autonomously navigate with quality state estimation required for a well-engineered system that is able to accurately and predictably complete its tasks.

Throughout this tutorial, we will be using the [Stereolabs](https://www.stereolabs.com) SDK’s [Position Tracking](https://www.stereolabs.com/docs/positional-tracking/) capability as our VIO solution of choice paired with the new [ZED X](https://www.stereolabs.com/zed-x/) camera. This VIO solution is easy to use and provides production-quality performance for *free* when using a ZED camera module.


Note

While we use the Stereolabs SDK and ZED X camera, this tutorial may be broadly used with other solutions. However, we recommend this option as an optimized solution that is tightly-coupling to the camera hardware and Jetson compute architecture for high performance and fast out-of-the-box results. It is Open Navigation’s experience that it can take months of testing of open-source VIO solutions and attempting to fix time synchronization issues with Stereo camera ROS drivers to achieve results of practical quality. This is very conveniently a one stop shop integrated solution.

###### Setting Up the ZED X Camera

We’re using the ZED X for the purposes of this tutorial due to its:

* Smaller size similar to other AMR depth sensors
* High quality depth information at relevant ranges for mobile robotics and manipulation
* Hardware synchronized IMU
* Wide field of view requiring only one camera in most situations
* Use of GMSL2 connectors over USB (yay!)
* Global shutter cameras for improved quality and removed motion blur

Though, any other ZED camera with an IMU in it will work as well (ZED2, ZED2i, ZED mini, etc). If you are using the ZED X in particular, checkout [this playlist on YouTube showing step by step how to setup the Nvidia Jetson and ZED X for ROS 2](https://www.youtube.com/watch?v=sEH07WwB8X0&list=PLekRVIRfsmj-P74wmB5qXLYujbelQsW5O) or [ZED X Getting Started page](https://www.stereolabs.com/docs/get-started-with-zed-x/) to install the SDK, ZED X drivers, and ROS 2 drivers needed to proceed.

At this point, you should be able to run one of the following commands to launch the driver and visualize the sensor data in Rviz. Note that these are ROS 2 component nodes that also may be loaded into your system’s component manager to minimize latency due to serialization.

```
$ ros2 launch zed_wrapper zedx.launch.py
$ ros2 launch zed_wrapper zedxm.launch.py
```

[![../../_images/vio.png](../../_images/vio.png)](../../_images/vio.png)

As of September 2023, the driver out of the box produces the full `map->odom->base_link->camera` tree on its own. This is since the Pose SDK can produce not only VIO, but loop-closure VSLAM representing the full state estimation TF tree.

We want to be able to fuse in other information such as an external IMU, wheel odometry, GPS, or other sensors into our local or global state estimates, so we need to disable TF publication of `map->odom` and `odom->base_link` to be provided by our fused outputs. Especially considering the ZED X camera knows nothing about the nature of the `base_link` frame. However, if you would like to use the ZED’s state estimate for your entire system without further sensor fusion, you certainly can!

###### Setting Up ZED ROS

In order to run VIO alone, we need to do the following:

1. Stop computing VSLAM’s `map->odom`, TF transform. This part of the TF tree is provided by our global localization solution (e.g. AMCL, GPS, fused global state estimate).
2. Disable VIO’s publication of `odom->camera` and instead publish `nav_msgs/Odometry` of the VIO’s pose solution for fusion. By default the `zed_wrapper` publishes this under the `odom` topic, but it is recommended to remap this to a non-reserved topic name (for example, `camera_odom`).
3. Re-configure the ZED Wrapper’s parameters to obtain the best VIO as possible.

* `two_d_mode` will force the pose tracking to be in 2D dimensions (e.g. X, Y, Yaw) for indoor or 2D applications.
* `pos_tracking_enabled` will disable or enable pose tracking, if you desire it (and we do here!).
* `path_max_count` will set the maximum size of the visualization of the pose over time. By default it is infinite. We should make this finite.
* `qos_depth` will set the QoS depth throughout the driver. Set this to 3-5 for all options. 1 may result in dropping of messages in very temporary blibs in compute. 3-5 allows us to buffer a small handful of measurements to process for very short term blibs, but clears them all the same in CPU thrashing situations.

Thus, make the following parameter updates to the `zed_wrapper`’s default parameters:

```
pos_tracking:
    publish_tf: false # Disables odom -> base_link TF transformation
    publish_map_tf: true # Disables map -> odom TF transformation
    area_memory: false # Disables loop closure computation, but Pose topic for global VSLAM still published (but now pure VIO)

    # Optional optimizations
    two_d_mode: false # Or true, up to you!
    pos_tracking_enabled: true # of course!
    path_max_count: 30
    qos_depth: 5
```

Optionally, remap the zed `odom` topic to a topic that isn’t reserved or commonly used by other systems. In your ZED launch file add to the node / launch file:

```
remappings=[('odom', 'camera_odom')]
```

Note

The ZED driver will publish two pose tracking topics, `pose` and `odom`. Pose is the full V-SLAM pose with loop closures (or not, if `area_memory: false`). The odom topic contains the actual VIO that we’d like to use, which publishes at frame capture rate. The Pose topic may publish at irregular frequencies depending on loop-closures. Thus, we’d like to use `odom` for this local fusion.

###### Fusing VIO Into Local State Estimate

Now that we have the ZED ROS 2 drivers set up to publish our VIO to a topic and leave our TF tree to the fusion algorithm and Robot State Publisher (e.g. URDF), we’re finally ready to fuse in VIO into our broader state estimate using the `robot_localization` package.

This package is a generalized EKF and UKF solution to state estimation of potentially many different topics, publishing at different rates, of different types. If you’re unfamiliar with `robot_localization` checkout our [First-Time Robot Setup Guide](../../setup_guides/index.html#setup-guides)’s Odometry page for basic information and the [package’s extensive documentation](http://docs.ros.org/en/noetic/api/robot_localization/html/index.html).

Most users at this point already have a `robot_localization` configuration file in their robot systems to fuse existing sensors together, such as wheel odometry (even poor) and robot IMUs. We’ll be adding a new odom field, `odom1`, to our configuration to fuse in VIO’s position and orientation into our filter. If this is your first odometry field, use `odom0` and you can base your file on [ekf.yaml](https://github.com/cra-ros-pkg/robot_localization/blob/ros2/params/ekf.yaml).

```
odom1: camera_odom # Adjust if namespacing ZED camera (e.g. /zed/odom)
odom1_config: [true,  true,  true,  # X, Y, Z
               true,  true,  true,  # Roll, Pitch, Yaw
               false, false, false, # Vx, Vy, Vz
               false, false, false,  # Vroll, Vpitch, Vyaw
               false, false, false] # Ax, Ay, Az
odom1_differential: false
odom1_relative: true
odom1_queue_size: 2
```

Note

We’re fusing in Roll, Pitch, and Yaw. If operating your EKF or ZED in 2D modes, then set the Roll and Pitch fields to `false`. If you believe jumps in your VIO may occur, consider using `odom1_pose_rejection_threshold` which sets a threshold to reject updates if sufficiently outlandish relative to recent updates. In this case, setting differential to true may also be helpful so that single bogus updates don’t move the entire coordinate system.

Make sure to evaluate your EKF’s `frequency`, `two_d_mode`, `publish_tf`, and key frames to be appropriate for your application. We generally want to publish TF and have 2D mode on when navigating in flat indoor environments only.

###### Fusing VSLAM Into Global State Estimate

While out of the scope of this tutorial, it is possible to continue to produce VSLAM results for global localization with loop closure (both in general and using the Stereolabs Position Tracking SDK). The steps for integration are similar to the last sections, except:

* Continue to disable the TF tree for `map->odom`, but the global pose topic will continue to publish under `pose` for fusion
* Fuse that topic into a global localization EKF in `world_frame: map` along with other sources of information (e.g. external IMU, AMCL, GPS, etc).
* The fusion of multiple global localization techniques should be done carefully. The most trusted source should be set `_differential: false` to use the actual pose information. All other subsequent systems should use `_differential: true` so that diverging coordinate systems do not create bouncing solutions. Instead, this will fuse one as absolute poses and the other as the changes of poses between iterations.

###### Testing it Out!

In the below example, we’re fusing the Stereolabs SDK’s Pose Tracking VIO solution with a robot’s external IMU and odometry (e.g. `robot_localization` has `odom0` `odom1` and `imu0`) to improve performance while navigating on a legged robot platform in outdoor environments. The robot’s internal odometry based on leg motion is quite poor and causes the robot to have generally poor autonomous navigation performance.

The Visual-Inertial Odometry’s error over these datasets is 4.1% over the 70m path. Typically for ‘good’ odometry from wheel encoders + IMU, I would like to see 2-3% fully tuned (or less than 1% for ‘great’ odometry), so this is a great source! Fused in with the legged robot odometry, it improves overall performance to an acceptable level!

Note

Steve is walking his robot dog through Golden Gate Park in San Francisco, CA with a joystick to collect this data. Steve’s a bad robot driver (he doesn’t play video games), the zig-zagging you see is due to his lack of good joystick control + the quadruped has a lot of additional asymmetric weight on it. It is not representative of Nav2 and should be mocked. *Its meant to test the accuracy of the VIO solution in more harsh conditions… yeah… lets go with that*.

---

#### Isaac Perceptor

##### Rebuilding TensorRT Engine for Isaac Perceptor on Nova Carter

*Source: [https://docs.nav2.org/tutorials/docs/isaac_perceptor/rebuilding_tensorrt_engine.html](https://docs.nav2.org/tutorials/docs/isaac_perceptor/rebuilding_tensorrt_engine.html)*

###### Rebuilding TensorRT Engine for Isaac Perceptor on Nova Carter

This is a step-by-step guide for fixing Isaac Perceptor model (“Engine”) compatibility issues in the NVIDIA Isaac environment. While this has been developed (and tested) on the NVIDIA Nova Carter robot, this should work for Isaac Sim, etc. as well.

Among the collection of nodes and packages Perceptor uses for 3-D scene reconstruction are a set of “engine” and “plan” files, which are the actual neural network models used by Perceptor components such as `nvblox` to do things like object recognition, semantic segmentation, image disparity calculation, etc.

**Problem**: Incompatible “engine” files.

When running the Isaac ROS Perceptor node, the following error occurs:

```
Error Code 6: API Usage Error (The engine plan file is not compatible with this version of TensorRT, expecting library version 10.7.0.23)
```

**Root Cause**: The .engine files are shipped pre-compiled for a generic CUDA runtime built with the specific version of TensorRT installed on the system running Perceptor. Since Perceptor is typically run from a Docker container vs. in the native host Jetpack install, there is often some version drift between the Docker image the container runs and the host Jetpack.

**Solution**: Fortunately, NVIDIA provides some fine-grained tools for working with CUDA, building & converting models between different formats and NVIDIA hardware platforms. So, we can rebuild the incompatible `.engine` files with the `trtexec` tool.

Rebuild engines inside the container using `trtexec` compiled against the container’s TensorRT version with “full” runtime optimization.

Note

We will see why “full” is important later, although sneak-peek: it has to do with resolving the error message:

```
Error Code 4: API Usage Error (Cannot deserialize engine with lean runtime...
```

###### Step-by-Step Resolution

This all needs to be done inside the container you will eventually be running Isaac Perceptor from.
Do all these steps from top to bottom, preferably run from inside a `screen(1)` session.

###### 1. Access the Running Container

```
docker exec -it <container_name> /bin/bash
```

###### 2. Rebuild `trtexec` for Compatibility

```
###### Navigate to TensorRT source
cd /usr/src/tensorrt

###### Clean and rebuild trtexec
sudo make clean
sudo make -j$(nproc) trtexec

###### Verify new trtexec version
./bin/trtexec --version
```

###### 3. Reinstall ISAAC\_ROS Assets

```
###### Reinstall essential model packages
sudo apt-get install --reinstall isaac_ros_ess_models_install
###### Add other model packages as needed
```

###### 4. Remove Old Engine Files

```
###### Navigate to assets directory
cd $ISAAC_ROS_ASSETS

###### Remove all existing engine files
find . -name "*.engine" -delete
find . -name "*.plan" -delete
```

###### 5. Modify Model Installation Scripts

For each model install script (`/opt/isaac_ros_assets/install_scripts/*.sh`):

```
###### Edit the trtexec command to add --useRuntime=full
sed -i 's/trtexec --onnx=/trtexec --useRuntime=full --onnx=/' install_script.sh
```

###### 6. Regenerate Engines with Full Runtime

```
###### Run each modified installation script
sudo /opt/isaac_ros_assets/install_scripts/isaac_ros_ess_models_install.sh
###### Repeat for other model scripts as needed
```

###### 7. Commit the Container Changes

```
###### From host system
docker ps  # Get container ID/name
docker commit <container_name> nova_carter_with_new_engines
```

###### 8. Launch Perceptor

```
###### Inside container
ros2 launch nova_carter_bringup perceptor.launch.py
```

If Perceptor reads in the new .engine files successfully, you should see output similar to this on the console for each camera used:

```
[component_container_mt-9] [INFO] [1765602288.918936247] [right_stereo_camera.left.rectify_node]: Negotiating
[INFO] [launch_ros.actions.load_composable_nodes]: Loaded node '/right_stereo_camera/ess_node' in container 'nova_container'
[component_container_mt-9] [INFO] [1765602288.919007703] [right_stereo_camera.right.rectify_node]: Negotiating
[component_container_mt-9] [INFO] [1765602288.920391927] [nova_container]: Load Library: /opt/ros/humble/lib/libvisual_slam_node.so
```

As the .engine models are used by multiple nodes, such as `dnn_stereo_disparity` and `nvblox`, a successful Perceptor run will result in a LOT of console output, but eventually quiet down and stay running.

---

#### Route Server Tools

##### Route Graph Generation

*Source: [https://docs.nav2.org/tutorials/docs/route_server_tools/route_graph_generation.html](https://docs.nav2.org/tutorials/docs/route_server_tools/route_graph_generation.html)*

###### Route Graph Generation

* [Overview](#overview)
* [Requirements](#requirements)
* [Tutorial Steps](#tutorial-steps)

###### Overview

This tutorial walks a user through generating a graph for the nav2 route server.

###### Requirements

Follow <https://www.qgis.org/en/site/forusers/download.html> to install QGIS.

###### Tutorial Steps

###### 1- Create New QGIS Project

Open QGIS and create a new project by selecting Project->New. Save your project by selecting, Project -> Save As.
Set the project coordinate reference system by selecting Project->Properties->CRS. Set the coordinate system to WGS 84 / Pseudo-Mercator and click OK.

Note

The WGS 84/ Pseudo-Mercator is one of few coordinate systems that could be used.
For more information about coordinate reference systems please review <https://docs.qgis.org/3.22/en/docs/gentle_gis_introduction/coordinate_reference_systems.html>.

> [![../../../_images/coordinate_reference_system.png](../../../_images/coordinate_reference_system.png)](../../../_images/coordinate_reference_system.png)

###### 2- Setup Coordinate System

By default, the imported raster image origin will be at the top left corner, with x pointing to the right, and y pointing up.
To correctly set the origin and the resolution we will georeference the raster image.
To georeference the image, three control points will chosen. Each control point maps a pixel location to the spatial reference.

For example, let’s say you have a 100 by 200 raster image with a resolution of 0.05 and a origin in the bottom left corner.
The first control point we could select is (0, -200)px -> (0, 0)m. (0, -200)px is the bottom left corner in the pixel frame and (0, 0)m is coordinates in the spatial frame.
This is the convention of our ROS maps, typically.
For the second control point we will select the top left corner of the image as the original (0, 0)px. The associated coordinates in the spatial frame can be calculated by using the resolution
to convert the pixels to meters. In this case, (0, 0)px -> (0, 10)m. Where 10 m is 200 px\* 0.05 m/px. The last control will be the bottom right corner: (100, -200)px -> (5, 0)m.
It is recommended to set the origin of your map to the lower left corner of the image (`[0.0, 0.0, 0.0]` in your `map.yaml`), to make this process easier.

To georeference image select Raster -> Georefencer. Set the Transformation Settings to Linear for Transformation
type, WGS 84/ Pseudo-Mercator for Target SRS and set your desired path for the Output Raster.

> [![../../../_images/transformation_settings.png](../../../_images/transformation_settings.png)](../../../_images/transformation_settings.png)

Select the raster image you wish to georeference and place control point by selecting Add Point and clicking on the raster image.
The control points can be modified by clicking on the control point table and typing in new values. Once you are satisfied with your control points, apply the transformation
by selecting Start Transformation.

> [![../../../_images/georeferencer.png](../../../_images/georeferencer.png)](../../../_images/georeferencer.png)

Close the window. Drag and drop the georeferenced raster file that was just created into the layers window. This should be a tiff file, by default.

> [![../../../_images/raster_layer.png](../../../_images/raster_layer.png)](../../../_images/raster_layer.png)

To verify the transformation worked, move the mouse around the raster image and look at the coordinates being displayed at the bottom of the window.

###### 3- Add Nodes

Now that we have georeferenced the raster layer we can start placing nodes.

Select Layer -> Create Layer -> New ShapeFile Layer. Set the shapefile layer setting to be
nodes for the File name, Point for the Geometry type and WGS 84/ Pseudo-Mercator for the coordinate system. Press OK.

> [![../../../_images/node_layer.png](../../../_images/node_layer.png)](../../../_images/node_layer.png)

In order to have the id field auto increment, right click on the layer and select the Properties -> Attribute Form.
Expand the Fields drop down menu and select id. Select the Expression Dialog icon which is across from Default value field.

> [![../../../_images/attribute_form.png](../../../_images/attribute_form.png)](../../../_images/attribute_form.png)

Within the Expression Dialog select Import user expressions and import increment\_node\_id.json which exists in the scripts file with the nav2 route module. Expand User expressions and double click on increment\_node\_id.
The expression should show up in the left window. Click OK to save the expression and exit the Expression Dialog. Then click Apply and OK and save and exit the Attributes Form.
This will increment the node id by one every time a new node is added. The first node id will be zero.

> [![../../../_images/expression_dialog.png](../../../_images/expression_dialog.png)](../../../_images/expression_dialog.png)

Click on the node layer and then select Toggle Editing icon represented as a pencil to start editing the layer.
To add points, select the Add Point Feature. Start adding nodes by clicking in the main window.
Each time a node is added, a window will pop up with the auto incremented id. Press OK to continue placing points.
Once complete, unselect ‘Toggle Editing’ and save changes.

> [![../../../_images/nodes.png](../../../_images/nodes.png)](../../../_images/nodes.png)

Note

By default, if a is node deleted the id list will not be updated. It is up to the user to determine how they wish to update the ids if individual
or multiple nodes are deleted. Any node that is added will continue to increment based on the highest id, to ensure existing node are not automatically renumbered, breaking user implicit knowledge about the structure of the graph. This value can be overwritten by the user
though the pop window after node placement or though the Attribute Table. To delete features in a layer right click on the layer and select Open Attribute Table.
Click on Target Multi Edit Mode, select the features to delete, and click on the trash can icon.

###### 4- Add Edges

Now an edge layer can be created. Select Layer -> Create Layer -> New ShapeFile Layer. Set the shapefile layer setting to be
edges for the File name, LineString for the Geometry type and WGS 84/ Pseudo-Mercator for the coordinate system. Press OK.
To auto increment the id field follow the same steps as above except replace increment\_node\_id.json with increment\_edge\_id.json.
This will increment the edge id by one every time a new edge is added. The first edge id will be 10000.

> [![../../../_images/edge_layer.png](../../../_images/edge_layer.png)](../../../_images/edge_layer.png)

To see the directionality of the edges, right click on the edge layer and select Properties. Click Symbology -> Simple Line and change the Symbol layer type to Arrow.
Click Ok. You should now be able to see arrows for each line string. Note that all edges in the route graph are directional, so if you want a bidirectional connection you should duplicate it in reverse.

Click on the edge layer and then on the Toggle Editing icon represented as a pencil to start editing the layer.
To add edges, click on the Add Line Feature. Start adding edges by clicking twice in the main window.
(First point is start, second point is end). Press right click anywhere when you have finished adding the two points for the prompt to save to come up.
The edge locations must exactly match up to the node locations, so if Snapping is not already enabled by default, enable it via Views->Toolbars->Snapping Toolbar and depress the Magnet icon.
Once complete, unselect ‘Toggle Editing’ and save changes.

> [![../../../_images/edges.png](../../../_images/edges.png)](../../../_images/edges.png)

###### 5- Associate Nodes With Edges

Now that we have our node and edge layers, we can associate node IDs with edge IDs.
Select Database -> DB manager. Expand Virtual layers and expand Project layers. Open up
the SQL window by clicking on the script icon in the top left corner. In the SQL window load in generate\_start\_and\_end\_id.sql by selecting Load File.
The script can found within the scripts directory in the nav2\_route module.
Execute the script. Load the new layer by checking the Load as new layer box and clicking Load. The script associates the start and end of a line string by matching the node
point. Then export the layer as a ShapeFile by right clicking on the layer selecting Export -> Save Feature As. Change the format to type to ESRI Shapefile, name the file, and verify that the
coordinate reference system is WGS 84 /Pseudo-Mercator. Press OK.

> [![../../../_images/db_manager.png](../../../_images/db_manager.png)](../../../_images/db_manager.png)

###### 6- Export To Geojson

We are now ready to export the node and edge layer as geojson files. Execute export\_shapefiles.py <prefix\_of\_file> <path\_to\_edges\_shapefile> <path\_to\_nodes\_shapefile>
within the scripts directory located in the nav2\_route module. This script converts the nodes and edges shape file into a geojson file.

###### 7- Congratulations

Your graph is ready to be consumed by the nav2 route! If you wish to add nodes or edges to your graph,
edit the layers and repeat the process from step 5 to regenerate the graph. If you wish to adjust the graph, make sure Editing is toggled on for the
node and edge layer. Then select Vertex Tool(all Layers) and toggle on Topological Editing. Repeat the process from step 5 to regenerate the graph.

Happy Routing!

---

##### Route Graph Generation LIF Editor

*Source: [https://docs.nav2.org/tutorials/docs/route_server_tools/route_graph_generation_lif_editor.html](https://docs.nav2.org/tutorials/docs/route_server_tools/route_graph_generation_lif_editor.html)*

###### Route Graph Generation LIF Editor

* [Overview](#overview)
* [Requirements](#requirements)
* [Tutorial Steps](#tutorial-steps)

###### Overview

A route can also be created using the **VDA LIF Editor**, a web-based open-source tool. This project was developed to present floor plans in a standardized format defined by the VDA. With the VDA LIF Editor, you can generate both GeoJSON and LIF formats simultaneously.

* Website: <https://vda5050-lif-editor.vercel.app/>
* Github: <https://github.com/bekirbostanci/vda5050_lif_editor>

###### Requirements

This is an online web-based tool, so no installation is required. You can use it directly in your browser.

###### Tutorial Steps

###### 1. Create Layout

Click the **‘Edit’** button under the **‘Layout’** section in the left sidebar. This will open a new popup where you can edit the layout name. Click the **‘Save’** button to save it.

Note

You can also change the layout name after creating the layout.

[![../../../_images/frame_name.png](../../../_images/frame_name.png)](../../../_images/frame_name.png)

Click the **‘Edit’** button under the **‘Layout’** section in the left sidebar. In the popup, upload your floor plan image using the **‘Background Image’** section.
After uploading the image, four input fields will appear. Set the image width and height in meters, and specify the origin coordinates (X, Y).
The origin is the bottom-left corner of the image.
Click the **‘Save’** button to save and close the popup.

Note

If you don’t see the image, zoom out the map and check the origin position of your image.

[![../../../_images/setup_coordinate_system.png](../../../_images/setup_coordinate_system.png)](../../../_images/setup_coordinate_system.png)

###### 2. Node Operations

###### Add Node

Now you can add nodes to the map. There are two ways to do this:

1. Click directly on the map to add a node. This will create a node automatically. If you want to change its properties, click on the node and edit its information in the right sidebar.
2. Click the **‘Node’** button under the **‘Create Item’** section in the left sidebar. This will display the **‘Create Node’** section in the right sidebar. Fill in the node details and click **‘Save’** to create the node.

Note

If the **‘Fast Create’** toggle is on, you cannot create nodes using the right sidebar (method 2). You must turn the toggle off first.

[![../../../_images/add_node.png](../../../_images/add_node.png)](../../../_images/add_node.png)

###### Delete Node

To delete a node, click on it (a glowing orange border will appear around the selected node), then click the **‘Delete’** button in the right sidebar.

[![../../../_images/delete_node.png](../../../_images/delete_node.png)](../../../_images/delete_node.png)

###### 3. Edge Operations

###### Add Edge

Now we can add edges to the map. There are two ways to create edges:

1. Select a node, enter the target node ID in the **‘Connected Nodes’** input in the right sidebar, and select the node from the list. This will create an edge between the selected node and the target node.

[![../../../_images/add_edge_normal.png](../../../_images/add_edge_normal.png)](../../../_images/add_edge_normal.png)

2. If the **‘Fast Create’** toggle is on, clicking on the map will automatically connect the new node to the previously selected node.

[![../../../_images/add_edge_fast_create.png](../../../_images/add_edge_fast_create.png)](../../../_images/add_edge_fast_create.png)

###### Delete Edge

To delete an edge, click on it (the edge color will change to orange), then click the **‘Delete’** button in the right sidebar.

[![../../../_images/delete_edge.png](../../../_images/delete_edge.png)](../../../_images/delete_edge.png)

###### 4. Check GeoJSON

Click the **‘ROS’** menu button on the top bar to view the generated GeoJSON.

[![../../../_images/check_geojson.png](../../../_images/check_geojson.png)](../../../_images/check_geojson.png)[![../../../_images/check_geojson_1.png](../../../_images/check_geojson_1.png)](../../../_images/check_geojson_1.png)

###### 5. Export to GeoJSON

You are now ready to export the node and edge layers as GeoJSON files. Click the **‘Save’** button on the top bar and then select **‘Export ROS GeoJSON’**.

[![../../../_images/export_geojson.png](../../../_images/export_geojson.png)](../../../_images/export_geojson.png)

###### 6. Congratulations

Your graph is now ready to be used by the Nav2 route! If you want to edit the graph later, you should also export the LIF file.
Click the **‘Save’** button on the top bar and select **‘Export LIF’**.
To edit, reopen the LIF file in the VDA LIF Editor and make your changes. You can also re-export the LIF file as GeoJSON.

**Happy Routing!**

---

##### SWAGGER Route Graph Generation

*Source: [https://docs.nav2.org/tutorials/docs/route_server_tools/swagger_generation.html](https://docs.nav2.org/tutorials/docs/route_server_tools/swagger_generation.html)*

###### SWAGGER Route Graph Generation

* [Overview](#overview)
* [Requirements](#requirements)
* [Tutorial Steps](#tutorial-steps)

###### Overview

This tutorial walks a user through generating a graph for the nav2 route server using [NVIDIA’s SWAGGER](https://github.com/nvidia-isaac/SWAGGER).

###### Requirements

Follow <https://github.com/nvidia-isaac/SWAGGER/> to install SWAGGER using the installation instructions in the README.

###### Tutorial Steps

###### 1- Generate SWAGGER Graph

The first step is to generate a swagger graph from a raster image of the map.
This can be done by running the `generate_graph.py` script located in the `scripts`.
This will output two files, a `graph.gml` which contains the graph structure and a `graph.png` which shows a visualization of the graph overlaid on the rastered image.

```
python scripts/generate_graph.py \
    --map-path <path_to_map.png> \
    --resolution <meters_per_pixel> \
    --safety-distance <meters> \
    --output-dir <output_directory>
```

The resolution should be set as the same as in your SLAM session that generated the occupancy grid map.
The safety distance is the minimum distance away from any obstacle that the graph will be generated.
When completed, the output should look similar to the following:

[![../../../_images/waypoint_graph.png](../../../_images/waypoint_graph.png)](../../../_images/waypoint_graph.png)

This process is performed by:

* Convolving the rastered image by the safety distance to create a safety mask.
* Skeletonizing the safety mask to create a skeleton of the map.
* Adding boundary nodes around the convolved obstacles.
* Placing nodes in the center areas of the map to fill space.
* Connecting edges to skeleton, center, and boundary nodes and pruning those which do not add value.

###### 2- Convert to GeoJSON

To work with this graph in Nav2 Route, we need to convert this to a format the Nav2 Route Server can interpret.
The SWAGGER graph format is a GML file, which is not directly usable by Nav2 Route.
Rather than creating new specialized parser plugins for Route Server, we will convert the GML file to GeoJSON format using a conversion script.
This script is located within the `integrations/nav2/tools` directory of SWAGGER.
It can be run as follows:

```
python integrations/nav2/tools/gml_to_geojson.py <path_to_graph.gml>
```

The output will be a `graph.geojson` file in the same directory as the input GML file.
This conversion populates the GeoJSON with the key information about the graph and ensures that each edge are bidirectional for navigation purposes.

###### 3- Use with Nav2 Route!

At this point, this file is now ready to use with the Nav2 Route Server.
This can be passed onto your application using the `nav2_bringup`’s `graph` CLI parameter or found by your custom launch or Nav2 configuration files.

###### 4- Demonstration

For demonstration, we’re going to use the Large Warehouse map provided by SWAGGER.
This map can be found in the `maps` directory of the SWAGGER repository.
You can run the following command to generate the graph and convert it to GeoJSON:

```
python scripts/generate_graph.py \
    --map-path maps/large_warehouse.png \
    --resolution 0.05 \
    --safety-distance 0.2 \
    --output-dir graphs

python integrations/nav2/tools/gml_to_geojson.py graphs/graph.gml
```

Then, we’ll create a `large_warehouse.yaml` for the map so that we can load it into the map server:

```
image: large_warehouse.png
mode: trinary
resolution: 0.05
origin: [0.0, 0.0, 0]
negate: 0
occupied_thresh: 0.65
free_thresh: 0.25
```

Update the BT Navigator parameters in your Nav2 params to use a graph-based navigator for this demonstration:

```
bt_navigator:
  ...
  default_nav_to_pose_bt_xml: $(find-pkg-share nav2_bt_navigator)/behavior_trees/navigate_on_route_graph_w_recovery.xml
  ...
```

Finally, launch Nav2’s Loopback simulator bringup, which uses a simple backend kinematic simulator for R&D and high level testing purposes, to avoid having to create a custom Gazebo or Isaac Sim simulation for this map:

```
ros2 launch nav2_bringup tb4_loopback_simulation_launch.py map:=/path/to/your/map.yaml graph:=/path/to/your/graph.geojson
```


Happy Routing!

---

##### Using the Nav2 Route Tool

*Source: [https://docs.nav2.org/tutorials/docs/route_server_tools/navigation2_route_tool.html](https://docs.nav2.org/tutorials/docs/route_server_tools/navigation2_route_tool.html)*

###### Using the Nav2 Route Tool

* [Overview](#overview)
* [Prerequisites](#prerequisites)
* [Tutorial Steps](#tutorial-steps)

[![../../../_images/route_tool_demo.gif](../../../_images/route_tool_demo.gif)](../../../_images/route_tool_demo.gif)

###### Overview

The Nav2 route tool is an Rviz panel designed to ease the process of creating and editing the route graphs used by the Nav2 Route Server.
In contrast to a free-space planner, route graphs provided a structure path for mobile robots to follow when navigating through their environment.
Supported operations for the route tool include loading in existing route graphs, adding new nodes and edges, editing existing nodes and edges, removing nodes and edges, and saving changes to a new file.
By the end of this tutorial, you should feel comfortable creating and modifying route graphs using the route tool.

###### Prerequisites

Prior to using the route tool, you will need to create an occupancy grid map using the slam\_toolbox package.
Follow [this tutorial](https://docs.nav2.org/tutorials/docs/navigation2_with_slam.html) for instructions on how to generate and save an occupancy grid map.

###### Tutorial Steps

To start the route tool, open a terminal and run the command:

```
ros2 launch nav2_rviz_plugins route_tool.launch.py yaml_filename:=/path/to/map.yaml
```

This should open Rviz with the route tool panel on the left side and your occupancy grid map displayed in the center.

###### Loading a Route Graph

[![../../../_images/route_load.gif](../../../_images/route_load.gif)](../../../_images/route_load.gif)

To load in an existing route graph, click on the load button on the bottom left of the route tool panel.
This will open up a file explorer so you can navigate to the existing geojson file you would like to load.
After clicking open, you should see the route graph overlaid with your occupancy grid map.

###### Adding Nodes and Edges

[![../../../_images/route_add.gif](../../../_images/route_add.gif)](../../../_images/route_add.gif)

To add nodes and edges to your route graph, select the “Add” tab of the route tool panel.
You can then add nodes by selecting the “Node” option and specifying coordinates for the new node.
Coordinates can be specified manually or by using the “Publish Point” feature in Rviz.
Once you have coordinates selected, click the “Create” button to add the node to your route graph.
For edges, follow the same process with the “Edge” option selected and specifying the ID for the starting and ending node you wish to connect.

###### Editing Nodes and Edges

[![../../../_images/route_edit.gif](../../../_images/route_edit.gif)](../../../_images/route_edit.gif)

To edit an existing node or edge, select the “Edit” tab of the route tool panel.
You can edit an existing node by selecting the “Node” option, entering the ID of the node you wish to edit, and specifying the new coordinates for the node.
Similar to adding in a node, you can enter these coordinates manually or using the “Publish Point” feature.
After clicking the “Confirm” button, you should see the location of the node move.
If the node has any edges connecting to it, those will be adjusted as well.
Existing edges can be edited by selecting the “Edge” option, entering the ID of the edge you wish to edit, and specifying the IDs for the new starting and ending nodes.

###### Removing Nodes and Edges

[![../../../_images/route_delete.gif](../../../_images/route_delete.gif)](../../../_images/route_delete.gif)

To remove an existing node or edge, select the “Remove” tab of the route tool panel.
Select the “Node” option if you would like to remove a node and the “Edge” option if you would like to remove an edge.
Then enter the ID of the graph element you wish to remove and click the “Delete” button to remove it from the route graph.
If you remove a node that has edges attached to it, those edges will be removed as well.
You may need to toggle the visibility of the route graph in Rviz to see the change take effect.

###### Saving a Route Graph

[![../../../_images/route_save.gif](../../../_images/route_save.gif)](../../../_images/route_save.gif)

Once you are ready to save your route graph, click the “Save” button at the bottom right of the panel.
This will then open a file explorer so you can specify where you would like to save your graph as a geojson file.
After entering in a filepath and clicking “Save”, your route graph should be ready for use with the Nav2 route server!

---
